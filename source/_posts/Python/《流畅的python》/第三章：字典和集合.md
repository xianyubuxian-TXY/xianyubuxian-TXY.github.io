---
title: 第三章：字典和集合
date: 2026-01-09 16:00:34
tags:
	- 笔记
categories:
	- Python
	- 《流畅的python》
	- 第3章 Python数据模型
---

# 三、映射类型标准 API
**这里最先提，方便熟悉后查询**
## 1.常用映射方法概述
![](https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109172728193.png)![](https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109172753032.png)![](https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109172812129.png)

## 2.插入或更新可变的值（dict.setdefault方法）
### （1）处理缺少键的常用方法
- **抛出错误**：根据 Python 的“快速失败”原则，当键 k 不存在时，d[k] 抛出错误。
- **设置默认值**：如果觉得默认值比抛出 KeyError 更好，那么可以把 d[k] 换成 **d.get(k, default)**

**然而，如果你想更新得到的可变值，那么还有更好的方法。**

### （2）代码示例
![](https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109174026857.png)
![](https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109174123769.png)![](https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109174153949.png)
![](https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109174309417.png)![](https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109174349353.png)








# 一、字典的现代句法
## 1.字典推导式
### （1）介绍
- **功能**：从任何可迭代对象中获取键值对，构建 dict 实例。
- **来历**：由列表推导式和生成器表达式改造而来

### （2）基础语法结构
#### <1>语法结构：{key_expression: value_expression for item in iterable [if condition]}
- **key_expression: 用于生成字典的键**
- **value_expression: 用于生成字典的值**
- **for item in iterable: 迭代数据源**
- **if condition: 可选的过滤条件**

#### <2>使用示例
##### 示例 1：最简字典推导式（遍历生成）
- **只保留长度大于 5 的单词**
```python
words = ['apple', 'banana', 'cherry']
# 条件：只保留长度>5的键值对
word_len_filter = {word: len(word) for word in words if len(word) > 5}

print(word_len_filter)
# 输出：{'banana': 6, 'cherry': 6}
```

##### 示例 2：遍历两个可迭代对象（zip 配合）
- **用 zip 配对两个列表，分别作为 key 和 value**
```python
keys = ['a', 'b', 'c']
values = [1, 2, 3]
# 遍历zip后的配对数据
my_dict = {k: v for k, v in zip(keys, values)}

print(my_dict)
# 输出：{'a': 1, 'b': 2, 'c': 3}
```
**zip( \*iterables)**：用于将多个可迭代对象（列表、元组等）“打包” 成一个迭代器
- \*iterables：一个或多个可迭代对象（列表、元组、字符串、字典等）；
- 返回值：zip 对象（迭代器），**可通过 list()/dict() 转换为列表 / 字典，或直接遍历**。

##### 示例 3：对原字典做转换
- **修改原字典的键 / 值（如将 value 翻倍）**
```python
original = {'a': 1, 'b': 2, 'c': 3}
# 推导式修改value
new_dict = {k: v*2 for k, v in original.items()}

print(new_dict)
# 输出：{'a': 2, 'b': 4, 'c': 6}
```

##### 关键注意事项！
1.**键必须唯一**：如果推导式生成重复的 key，后出现的会覆盖先出现的
2.**可迭代对象的遍历**:遍历字典时需用items()获取键值对，而非直接遍历（直接遍历字典默认只取 key）
3.**简化 vs 可读性**：推导式适合简单逻辑，复杂逻辑（多条件 / 多运算）建议用普通循环，避免可读性差。

## 2.映射拆包（\*\*）
### （1）演示代码
```python
# 定义函数：**kwargs 会收集所有传入的关键字参数，打包成字典返回
>>> def dump(**kwargs): 
...     return kwargs  # 返回收集到的关键字参数字典
... 

# 调用函数：混合使用两次字典解包（**）+ 直接关键字参数（y=2）
>>> dump(**{'x': 1}, y=2, **{'z': 3}) 
{'x': 1, 'y': 2, 'z': 3}  # 最终所有参数被合并为一个字典
```

### （2）代码解析
#### <1>\*\*kwargs：关键字参数收集
- **作用**：函数定义时，\*\*kwargs 是 **「关键字参数收集器」**，会把调用时传入的所有关键字参数（如 y=2）、以及通过 **\*\*解包** 传入的字典键值对，统一收集成一个字典。
- **规则**：
	- kwargs 只是约定俗成的变量名，可换成任意合法名称（如 \*\*params），但行业惯例用kwargs（keyword arguments）；
	- **必须放在函数参数列表的最后**（否则语法报错）；
	- **只会收集「未被显式定义的关键字参数」**。

#### <2>函数调用中的 \*\*：字典解包传参
- **作用**：调用函数时，***\*\*字典*** 会把字典的 **「键值对」解包为「关键字参数」**（如 \*\*{'x':1} 等价于 x=1）。
- **关键规则**：
	- Python 3.5+ **支持多次解包**（如示例中 \*\*{'x':1} + \*\*{'z':3}），且可和直接的关键字参数（y=2\）混合使用；
	- 解包后的键必须是**字符串类型**：因为关键字参数名本质是字符串；
	- 若解包 / 直接传参出现**重复键**，后传入的会**覆盖**先传入的（如 dump(\*\*{'x':1}, x=10) → {'x':10}）;

#### <3>执行过程拆解（从调用到返回）
```python
调用 dump(**{'x': 1}, y=2, **{'z': 3}) 的步骤：
1. 解包第一个字典：**{'x':1} → 转为关键字参数 x=1；
2. 保留直接传入的关键字参数：y=2；
3. 解包第二个字典：**{'z':3} → 转为关键字参数 z=3；
4. 函数内的 **kwargs 收集所有关键字参数 → 合并为 {'x':1, 'y':2, 'z':3}；
5. 函数返回这个合并后的字典。
```

## 3.使用 | 合并映射
**Python 3.9 支持使用 | 和 |= 合并映射。这不难理解，因为二者也是
并集运算符。**
### （1）| 运算符创建一个新映射
![](https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109170521809.png)
- “键”相同时，后者覆盖前者

### （2）|= 运算符就地更新现有映射
![](https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109170630056.png)

---
# 二、使用模式匹配处理映射
**模式匹配是一种强大的工具：不同类型的模式可以组合和嵌套来进行匹配**

## 1.示例
![](https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109171401376.png)
- **模式中键的顺序无关紧要**
	- 即使 b2 是一个 OrderedDict，也能作为匹配对象。
- **就算只有部分匹配，映射模式也算成功匹配（即可以是"超集"）**
	- 在上述doctest 中，b1 和 b2 两个匹配对象中都有 'title' 键，尽管任何'book' 模式中都没有这个键，但依然可以匹配。
- **没有必要使用 \*\*extra 匹配多出的键值对**
	- 倘若你想把多出的键值对捕获到一个 dict 中，可以在一个变量前面加上 \*\*，不过**必须放在模式最后**。
- **\*\*\_ 是无效的，纯属画蛇添足**

