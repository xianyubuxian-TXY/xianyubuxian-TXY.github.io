---
title: 第4章 观测工具
date: 2026-01-06 14:17:30
tags:
	- 笔记
categories:
	- 《性能之巅》
	- 第4章 观测工具
---


# 工具类型
**概述：性能观测工具可以按照“系统级别”和“进程级别”来分类，多数的工具要么基于“计数器”要么基于“跟踪”**
![图片](/images/2026.1.6-1.png)
- 有些工具不只适用于一个象限，例如，top(1)还有一个系统级别的视图，DTrace也有进程级别的能力。

## 计数器
1.内核维护了各种统计数据，称为“计数器”，用于对事件计数。
2.计数器的使用可以认为是“零开销”的，因为它们默认是开启的，而且始终由内核维护。
![图片1](/images/2026.1.6-2.png)![图片2](/images/2026.1.6-3.png)

**一般来说，上述这些工具是从/proc文件系统里读取统计信息的**

## 跟踪
1.跟踪收集每一个时间的数据以供分析。
2.跟踪框架一般默认是不启用的，因为跟踪捕获数据会有CPU开销，另外还需要不小的存储空间来存放数据。
3.这些开销会拖慢所跟踪的对象，在解释测量时间的时候需要加以考虑。
4.日志，包括系统日志，可以认为是一种默认开启的低频跟踪。
![图片](/images/2026.1.6-4.png)![图片](/images/2026.1.6-5.png)

## 剖析
1.剖析（profiling）通过对目标收集采样或快照来归纳目标特征
- 如对于CPU的使用率，对程序计数器采样，或跟踪来找到消耗CPU周期的代码路径。这些样本采集对于所有的CPU都是按福鼎频率进行的

2.剖析也能基于非计时的硬件时间
- 如CPU硬件缓存未命中或者总线活动
- 可以显示出哪行代码路径负责任，这类信息尤其可以帮助开发人员针对系统资源的使用来优化自己的代码

![图片](/images/2026.1.6-6.png)

## 监视（sar）
1.最广泛用于监视单一操作系统的工具是star(1)。
2.sar(1)是基于计数器的，在预定的时间（通过cron）执行以记录系统计数器的状态
3.sar(1)工具支持用命令行来查看这些数据
![图片](/images/2026.1.6-7.png)

---
# 观测来源
## 概述
1.本节介绍给观测工具提供统计数据的各种接口和框架
2.系统性能统计的主要来源是：/proc、/sys、/kstat
![图片](/images/2026.1.6-8.png)

## /proc
#### 概述
1.这是一个提供内核统计信息的文件系统接口
2.其中**以进程ID命名的目录代表的就是哪个进程**
3.这些目录下的众多文件包含了进程的信息和统计数据，由内核结构映射而来
4./proc是多态创建的，不需要任何存储设备（在内存中运行）。
5.多数文件是只读的，为观测工具提供统计数据；一部分文件是可写的，用于控制进程和内核的行为
![图片](/images/2026.1.6-9.png)

