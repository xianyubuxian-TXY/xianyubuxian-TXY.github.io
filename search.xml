<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Markdownè¯­æ³•ç¬”è®°</title>
    <url>/2026/01/12/Markdown/Markdown%E7%9B%B8%E5%85%B3/</url>
    <content><![CDATA[<h1>1.å¸¸ç”¨è¯­æ³•</h1>
<h2 id="ï¼ˆ1ï¼‰åˆ›å»ºç« å†…é“¾æ¥">ï¼ˆ1ï¼‰åˆ›å»ºç« å†…é“¾æ¥</h2>
<h3 id="1-å®šä¹‰é”šç‚¹">&lt;1&gt; å®šä¹‰é”šç‚¹</h3>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">&quot;describtion&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"># æ ‡é¢˜1</span><br></pre></td></tr></table></figure>
<h3 id="2-ç”Ÿæˆé“¾æ¥">&lt;2&gt; ç”Ÿæˆé“¾æ¥</h3>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">[<span class="string">æ–‡å­—æè¿°</span>](<span class="link">#describtion</span>)</span><br></pre></td></tr></table></figure>
<h2 id="ï¼ˆ2ï¼‰ç« å¤–é“¾æ¥ï¼ˆå¼•ç”¨å…¶å®ƒæ–‡ç« ï¼‰">ï¼ˆ2ï¼‰ç« å¤–é“¾æ¥ï¼ˆå¼•ç”¨å…¶å®ƒæ–‡ç« ï¼‰</h2>
<h3 id="1-ç»å¯¹è·¯å¾„é“¾æ¥">&lt;1&gt;ç»å¯¹è·¯å¾„é“¾æ¥</h3>
<p><code>[æ˜¾ç¤ºæ–‡å­—](é“¾æ¥URLè·¯å¾„)</code></p>
<p><strong>ç¼ºç‚¹</strong>ï¼š<br>
- è¿™ç§æ–¹å¼é“¾æ¥çš„æ˜¯ç”Ÿæˆåçš„ URL è·¯å¾„ï¼Œå¦‚æœä½ <strong>ç§»åŠ¨äº†æºæ–‡ä»¶ä½ç½®</strong>æˆ–<strong>ä¿®æ”¹äº†æ–‡ä»¶å/æ—¥æœŸ</strong>ï¼Œé“¾æ¥å°±ä¼šå¤±æ•ˆã€‚</p>
<h3 id="2-Hexo-å†…ç½®æ ‡ç­¾ï¼ˆæ¨èï¼Œä¸ä¼šå¤±æ•ˆï¼‰">&lt;2&gt;Hexo å†…ç½®æ ‡ç­¾ï¼ˆæ¨èï¼Œä¸ä¼šå¤±æ•ˆï¼‰</h3>
<p><code>&#123;% post_link "æ–‡å­—æè¿°" 'æ–‡ç« å' %&#125;</code></p>
<h1>2.å¸¸ç”¨è¡¨æƒ…åŒ…ï¼ˆå¯ç›´æ¥å¤åˆ¶ä½¿ç”¨ï¼‰</h1>
<table>
<thead>
<tr>
<th>ğŸ˜Š</th>
<th>ğŸ˜‚</th>
<th>ğŸ˜«</th>
</tr>
</thead>
<tbody>
<tr>
<td>ğŸ˜„ å¤§ç¬‘</td>
<td>ğŸ¤® åé¥­</td>
<td>ğŸ˜© ç–²æƒ«</td>
</tr>
<tr>
<td>ğŸ˜Š å¾®ç¬‘</td>
<td>ğŸ˜‚ ç¬‘å“­</td>
<td>ğŸ¤·â€â™‚ï¸ éš¾æ‰‹</td>
</tr>
<tr>
<td>ğŸ‰ åº†ç¥</td>
<td>ğŸ¤£ æ‰“æ»šç¬‘</td>
<td>ğŸ˜ª å›°å€¦</td>
</tr>
<tr>
<td>ğŸŠ å½©å¸¦</td>
<td>ğŸ˜ åç¬‘</td>
<td>ğŸ¤” æ€è€ƒ</td>
</tr>
<tr>
<td>ğŸ˜ çˆ±æ…•</td>
<td>ğŸ˜œ è°ƒçš®</td>
<td>ğŸ¯ å‘½ä¸­ç›®æ ‡</td>
</tr>
<tr>
<td>ğŸ˜­ å¤§å“­</td>
<td>ğŸ˜± æƒŠæ</td>
<td>âœ… æ­£ç¡®</td>
</tr>
<tr>
<td>ğŸ˜¢ æµæ³ª</td>
<td>ğŸ˜³ ç›®çªå£å‘†</td>
<td>âŒ é”™è¯¯</td>
</tr>
<tr>
<td>ğŸ˜¿ å§”å±ˆçŒ«</td>
<td>ğŸ¤¯ è„‘è¢‹çˆ†ç‚¸</td>
<td>âš ï¸ è­¦å‘Š</td>
</tr>
<tr>
<td>ğŸ˜Ÿ æ‹…å¿§</td>
<td>ğŸ˜  ç”Ÿæ°”</td>
<td></td>
</tr>
<tr>
<td>ğŸ˜ å¤±è½</td>
<td>ğŸ˜’ ä¸æ»¡</td>
<td></td>
</tr>
</tbody>
</table>
]]></content>
      <categories>
        <category>Markdown</category>
        <category>Markdownè¯­æ³•ç¬”è®°</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>CMakeListsç¬”è®°</title>
    <url>/2026/01/15/C++/C++%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E5%B8%B8%E7%94%A8%E5%BA%93/CMakeLists%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h1>3.é¡¶å±‚ç›®å½•ç¤ºä¾‹</h1>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.16</span>)</span><br><span class="line"><span class="keyword">project</span>(UserService</span><br><span class="line">        VERSION <span class="number">1.0</span>.<span class="number">0</span></span><br><span class="line">        LANGUAGES CXX)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">17</span>)    <span class="comment"># æŒ‡å®šä½¿ç”¨ C++17 æ ‡å‡†</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD_REQUIRED <span class="keyword">ON</span>) <span class="comment">#å¼ºåˆ¶è¦æ±‚ç¼–è¯‘å™¨æ”¯æŒ C++17ï¼Œè‹¥ç¼–è¯‘å™¨ä¸æ”¯æŒï¼Œç›´æ¥æŠ¥é”™</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_EXTENSIONS <span class="keyword">OFF</span>) <span class="comment">#ç¦ç”¨ç¼–è¯‘å™¨æ‰©å±•è¯­æ³•ï¼Œ ä¿è¯ä»£ç åœ¨ä¸åŒç¼–è¯‘å™¨ä¸‹è¡Œä¸ºä¸€è‡´</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¸å¿ƒé€»è¾‘ï¼šè‹¥ç”¨æˆ·æœªæŒ‡å®š CMAKE_BUILD_TYPEï¼ˆå¦‚ç¼–è¯‘æ—¶æœªåŠ  -DCMAKE_BUILD_TYPE=Debugï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment"># é»˜è®¤è®¾ç½®ä¸º Releaseï¼ˆä¼˜åŒ–ç¼–è¯‘ï¼Œå»é™¤è°ƒè¯•ä¿¡æ¯ï¼Œé€‚åˆéƒ¨ç½²ï¼‰ï¼›</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">NOT</span> CMAKE_BUILD_TYPE <span class="keyword">AND</span> <span class="keyword">NOT</span> CMAKE_CONFIGURATION_TYPES)</span><br><span class="line">    <span class="keyword">set</span>(CMAKE_BUILD_TYPE Release CACHE <span class="keyword">STRING</span> <span class="string">&quot;Choose the build type&quot;</span> FORCE)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">option</span>(BUILD_TESTS <span class="string">&quot;Build unit tests&quot;</span> <span class="keyword">ON</span>) <span class="comment"># æ§åˆ¶æ˜¯å¦ç¼–è¯‘å•å…ƒæµ‹è¯•ä»£ç ï¼ˆtests å­ç›®å½•ï¼‰</span></span><br><span class="line"><span class="comment"># æ§åˆ¶ç”Ÿæˆ â€œåŠ¨æ€åº“ï¼ˆ.so/.dllï¼‰â€ è¿˜æ˜¯ â€œé™æ€åº“ï¼ˆ.a/.libï¼‰â€ï¼Œé»˜è®¤ OFF å³ç”Ÿæˆé™æ€åº“ï¼›</span></span><br><span class="line"><span class="keyword">option</span>(BUILD_SHARED_LIBS <span class="string">&quot;Build shared instead of static libs&quot;</span> <span class="keyword">OFF</span>) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºç›®å½•</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_RUNTIME_OUTPUT_DIRECTORY <span class="variable">$&#123;CMAKE_BINARY_DIR&#125;</span>/bin)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_LIBRARY_OUTPUT_DIRECTORY <span class="variable">$&#123;CMAKE_BINARY_DIR&#125;</span>/lib)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_ARCHIVE_OUTPUT_DIRECTORY <span class="variable">$&#123;CMAKE_BINARY_DIR&#125;</span>/lib)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># YAML é…ç½®</span></span><br><span class="line"><span class="keyword">find_package</span>(yaml-cpp CONFIG REQUIRED)</span><br><span class="line"></span><br><span class="line"><span class="comment"># spdlog æ—¥å¿—</span></span><br><span class="line"><span class="keyword">find_package</span>(spdlog CONFIG REQUIRED)</span><br><span class="line"></span><br><span class="line"><span class="comment"># MySQL</span></span><br><span class="line"><span class="keyword">find_package</span>(PkgConfig REQUIRED)</span><br><span class="line">pkg_check_modules(MYSQL REQUIRED mysqlclient)</span><br><span class="line"></span><br><span class="line"><span class="comment"># hiredis åº“ </span></span><br><span class="line"><span class="keyword">find_path</span>(HIREDIS_HEADER hiredis)</span><br><span class="line"><span class="keyword">find_library</span>(HIREDIS_LIB hiredis)</span><br><span class="line"></span><br><span class="line"><span class="comment"># redis++ åº“ </span></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šè¿™é‡Œæ˜¯ swï¼Œä¸æ˜¯ redis++</span></span><br><span class="line"><span class="keyword">find_path</span>(REDIS_PLUS_PLUS_HEADER sw)</span><br><span class="line"><span class="keyword">find_library</span>(REDIS_PLUS_PLUS_LIB redis++)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_subdirectory</span>(src)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># GTest åŒ…</span></span><br><span class="line"><span class="keyword">find_package</span>(GTest REQUIRED)</span><br><span class="line"><span class="keyword">if</span>(BUILD_TESTS)</span><br><span class="line">    <span class="keyword">enable_testing</span>()</span><br><span class="line">    <span class="keyword">find_package</span>(GTest CONFIG REQUIRED)</span><br><span class="line">    <span class="keyword">add_subdirectory</span>(tests)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>
<h1>2.å­ç›®å½•</h1>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ å¯æ‰§è¡Œæ–‡ä»¶</span></span><br><span class="line"><span class="keyword">add_executable</span>(config_test config_test.cpp)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šå¯æ‰§è¡Œæ–‡ä»¶çš„â€œå¤´æ–‡ä»¶ç›®å½•â€</span></span><br><span class="line"><span class="keyword">target_include_directories</span>(config_test PUBLIC </span><br><span class="line">    <span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/src</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡ä»¤å¯æ‰§è¡Œæ–‡ä»¶çš„â€œåº“æ–‡ä»¶ç›®å½•â€</span></span><br><span class="line"><span class="keyword">target_link_directories</span>(config_test PUBLIC</span><br><span class="line">    <span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/<span class="keyword">include</span>/lib</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®©å¯æ‰§è¡Œæ–‡ä»¶é“¾æ¥åº“</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(config_test PRIVATE</span><br><span class="line">    user_config</span><br><span class="line">    GTest::GTest</span><br><span class="line">    GTest::Main</span><br><span class="line">    pthread</span><br><span class="line">    yaml-cpp  <span class="comment"># Config æ¨¡å—éœ€è¦ yaml-cpp åº“</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å¯æ‰§è¡Œæ–‡ä»¶çš„è¾“å‡ºè·¯å¾„</span></span><br><span class="line"><span class="comment"># set_target_propertiesï¼šCMake å†…ç½®å‘½ä»¤ï¼Œç”¨äºè®¾ç½®ç›®æ ‡ï¼ˆtargetï¼‰çš„å±æ€§</span></span><br><span class="line"><span class="comment"># config_testï¼šç›®æ ‡åç§°</span></span><br><span class="line"><span class="comment"># PROPERTIESï¼šå…³é”®å­—ï¼Œè¡¨ç¤ºåé¢æ˜¯è¦è®¾ç½®çš„å±æ€§åŠå…¶å€¼</span></span><br><span class="line"><span class="comment"># RUNTIME_OUTPUT_DIRECTORYï¼šç›®æ ‡å±æ€§å</span></span><br><span class="line"><span class="comment"># $&#123;CMAKE_RUNTIME_OUTPUT_DIRECTORY&#125;/testsï¼šå±æ€§å€¼ï¼ˆè·¯å¾„ï¼‰</span></span><br><span class="line"><span class="keyword">set_target_properties</span>(config_test PROPERTIES</span><br><span class="line">    RUNTIME_OUTPUT_DIRECTORY <span class="variable">$&#123;CMAKE_RUNTIME_OUTPUT_DIRECTORY&#125;</span>/tests</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>PUBLIC å…³é”®å­—</strong>:
<ul>
<li><strong>ä½œç”¨</strong>ï¼šæŒ‡å®šäº†åŒ…å«ç›®å½•çš„å¯è§æ€§èŒƒå›´
<ul>
<li>ç¼–è¯‘ config_test ç›®æ ‡æœ¬èº«æ—¶ä¼šä½¿ç”¨è¿™äº›åŒ…å«ç›®å½•</li>
<li>ä»»ä½•é“¾æ¥åˆ° config_test çš„å…¶ä»–ç›®æ ‡ä¹Ÿä¼šç»§æ‰¿è¿™äº›åŒ…å«ç›®å½•<br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260115103707646.png" alt=""></li>
</ul>
</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>C++</category>
        <category>C++åç«¯å¼€å‘åº“</category>
        <category>CMake</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>gtestçš„ä½¿ç”¨</title>
    <url>/2026/01/15/C++/C++%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E5%B8%B8%E7%94%A8%E5%BA%93/gtest%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h1>1.å¸¸ç”¨å‘½ä»¤</h1>
<h5 id="1-åœ¨å‘½ä»¤è¡ŒæŒ‡å®šè¿è¡Œè¦è¿è¡Œçš„æµ‹è¯•ç”¨ä¾‹">1.åœ¨å‘½ä»¤è¡ŒæŒ‡å®šè¿è¡Œè¦è¿è¡Œçš„æµ‹è¯•ç”¨ä¾‹</h5>
<ul>
<li>é€šè¿‡ --gtest_filter å‚æ•°æŒ‡å®šè¦è¿è¡Œçš„æµ‹è¯•</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./bin/tests/config_test --gtest_filter=<span class="string">&quot;æµ‹è¯•å¥—ä»¶å.æµ‹è¯•ç”¨ä¾‹å&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¾‹1ï¼šè¿è¡Œå•ä¸ªæµ‹è¯•ç”¨ä¾‹</span></span><br><span class="line"><span class="comment"># è¿è¡Œ ConfigTest å¥—ä»¶ä¸­çš„ InvalidYamlFormat æµ‹è¯•</span></span><br><span class="line">./bin/tests/config_test --gtest_filter=ConfigTest.InvalidYamlFormat</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¾‹2ï¼šè¿è¡Œå¤šä¸ªæµ‹è¯•ç”¨ä¾‹ï¼ˆä½¿ç”¨å†’å·åˆ†éš”ï¼‰</span></span><br><span class="line"><span class="comment"># è¿è¡Œå¤šä¸ªæŒ‡å®šçš„æµ‹è¯•</span></span><br><span class="line">./bin/tests/config_test --gtest_filter=ConfigTest.InvalidYamlFormat:ConfigTest.ValidConfig</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¾‹3ï¼šè¿è¡Œæ•´ä¸ªæµ‹è¯•å¥—ä»¶</span></span><br><span class="line"><span class="comment"># è¿è¡Œ ConfigTest å¥—ä»¶ä¸­çš„æ‰€æœ‰æµ‹è¯•</span></span><br><span class="line">./bin/tests/config_test --gtest_filter=ConfigTest.*</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>C++</category>
        <category>C++åç«¯å¼€å‘åº“</category>
        <category>gtest</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>jsonçš„ä½¿ç”¨</title>
    <url>/2026/01/15/C++/C++%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E5%B8%B8%E7%94%A8%E5%BA%93/json%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h1>ä¸€ã€jsonåº“</h1>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260115222201657.png" alt=""></p>
<h1>äºŒã€nlohmann/json</h1>
<p><strong>æ³¨æ„</strong>ï¼š<br>
- æ‰€æœ‰æ“ä½œéœ€å¼•å…¥å¤´æ–‡ä»¶ #include &lt;nlohmann/json.hpp&gt;ï¼Œå¹¶ä½¿ç”¨å‘½åç©ºé—´ using json = nlohmann::json;</p>
<h2 id="1-jsonæ”¯æŒçš„C-æ•°æ®ç±»å‹ï¼ˆç›´æ¥è½¬æ¢ï¼‰">1.jsonæ”¯æŒçš„C++æ•°æ®ç±»å‹ï¼ˆç›´æ¥è½¬æ¢ï¼‰</h2>
<h3 id="ï¼ˆ1ï¼‰åŸºæœ¬æ•°æ®ç±»å‹-æ”¯æŒåˆ—è¡¨">ï¼ˆ1ï¼‰åŸºæœ¬æ•°æ®ç±»å‹ æ”¯æŒåˆ—è¡¨</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260115223125969.png" alt=""></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;nlohmann/json.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> json = nlohmann::json;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ========== C++ â†’ JSON ==========</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å­—ç¬¦ä¸²</span></span><br><span class="line">    json j_str = <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">    json j_str2 = std::<span class="built_in">string</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ•´æ•°</span></span><br><span class="line">    json j_int = <span class="number">42</span>;</span><br><span class="line">    json j_long = <span class="number">9876543210LL</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æµ®ç‚¹æ•°</span></span><br><span class="line">    json j_float = <span class="number">3.14</span>;</span><br><span class="line">    json j_double = <span class="number">2.718281828</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¸ƒå°”</span></span><br><span class="line">    json <span class="type">j_bool_t</span> = <span class="literal">true</span>;</span><br><span class="line">    json j_bool_f = <span class="literal">false</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç©ºå€¼</span></span><br><span class="line">    json j_null = <span class="literal">nullptr</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ========== JSON â†’ C++ ==========</span></span><br><span class="line">    </span><br><span class="line">    std::string s = j_str.<span class="built_in">get</span>&lt;std::string&gt;();       <span class="comment">// &quot;hello world&quot;</span></span><br><span class="line">    <span class="type">int</span> i = j_int.<span class="built_in">get</span>&lt;<span class="type">int</span>&gt;();                       <span class="comment">// 42</span></span><br><span class="line">    <span class="type">double</span> d = j_double.<span class="built_in">get</span>&lt;<span class="type">double</span>&gt;();              <span class="comment">// 2.718281828</span></span><br><span class="line">    <span class="type">bool</span> b = <span class="type">j_bool_t</span>.<span class="built_in">get</span>&lt;<span class="type">bool</span>&gt;();                  <span class="comment">// true</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¹Ÿå¯ä»¥ç”¨éšå¼è½¬æ¢</span></span><br><span class="line">    std::string s2 = j_str;</span><br><span class="line">    <span class="type">int</span> i2 = j_int;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ========== è¾“å‡ºéªŒè¯ ==========</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;å­—ç¬¦ä¸²: &quot;</span> &lt;&lt; j_str &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;æ•´æ•°:   &quot;</span> &lt;&lt; j_int &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;æµ®ç‚¹æ•°: &quot;</span> &lt;&lt; j_double &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;å¸ƒå°”:   &quot;</span> &lt;&lt; <span class="type">j_bool_t</span> &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;ç©ºå€¼:   &quot;</span> &lt;&lt; j_null &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰STLå®¹å™¨-æ”¯æŒåˆ—è¡¨">ï¼ˆ2ï¼‰STLå®¹å™¨ æ”¯æŒåˆ—è¡¨</h3>
<h4 id="1ï¼‰åºåˆ—å®¹å™¨-â€”â€”-JSON-æ•°ç»„">1ï¼‰åºåˆ—å®¹å™¨ &lt;â€”â€”&gt; JSON æ•°ç»„</h4>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260115223530082.png" alt=""></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;nlohmann/json.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;deque&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;array&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;forward_list&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> json = nlohmann::json;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ========== C++ STL å®¹å™¨ â†’ JSON æ•°ç»„ ==========</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// std::vector</span></span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; vec = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line">    json j_vec = vec;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// std::list</span></span><br><span class="line">    std::list&lt;std::string&gt; lst = &#123;<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;cherry&quot;</span>&#125;;</span><br><span class="line">    json j_lst = lst;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// std::deque</span></span><br><span class="line">    std::deque&lt;<span class="type">double</span>&gt; deq = &#123;<span class="number">1.1</span>, <span class="number">2.2</span>, <span class="number">3.3</span>&#125;;</span><br><span class="line">    json j_deq = deq;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// std::array</span></span><br><span class="line">    std::array&lt;<span class="type">int</span>, 4&gt; arr = &#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>&#125;;</span><br><span class="line">    json j_arr = arr;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// std::forward_list</span></span><br><span class="line">    std::forward_list&lt;<span class="type">bool</span>&gt; fwd = &#123;<span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">true</span>&#125;;</span><br><span class="line">    json j_fwd = fwd;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ========== JSON æ•°ç»„ â†’ C++ STL å®¹å™¨ ==========</span></span><br><span class="line">    </span><br><span class="line">    json j = &#123;<span class="number">100</span>, <span class="number">200</span>, <span class="number">300</span>, <span class="number">400</span>, <span class="number">500</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">auto</span> vec2 = j.get&lt;std::vector&lt;<span class="type">int</span>&gt;&gt;();</span><br><span class="line">    <span class="keyword">auto</span> lst2 = j.get&lt;std::list&lt;<span class="type">int</span>&gt;&gt;();</span><br><span class="line">    <span class="keyword">auto</span> deq2 = j.get&lt;std::deque&lt;<span class="type">int</span>&gt;&gt;();</span><br><span class="line">    <span class="keyword">auto</span> fwd2 = j.get&lt;std::forward_list&lt;<span class="type">int</span>&gt;&gt;();</span><br><span class="line">    <span class="comment">// std::array éœ€è¦å¤§å°åŒ¹é…</span></span><br><span class="line">    <span class="keyword">auto</span> arr2 = j.get&lt;std::array&lt;<span class="type">int</span>, <span class="number">5</span>&gt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="2ï¼‰å…³è”å®¹å™¨-â€”â€”-JSON-å¯¹è±¡-æ•°ç»„">2ï¼‰å…³è”å®¹å™¨ &lt;â€”â€”&gt; JSON å¯¹è±¡/æ•°ç»„</h4>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260115223609650.png" alt=""></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;nlohmann/json.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_set&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> json = nlohmann::json;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ==================== C++ â†’ JSON ====================</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// map&lt;string, T&gt; â†’ JSON å¯¹è±¡ ï¼ˆKey å¿…é¡»æ˜¯ std::stringï¼‰</span></span><br><span class="line">    std::map&lt;std::string, <span class="type">int</span>&gt; str_map = &#123;&#123;<span class="string">&quot;apple&quot;</span>, <span class="number">10</span>&#125;, &#123;<span class="string">&quot;banana&quot;</span>, <span class="number">20</span>&#125;&#125;;</span><br><span class="line">    json j_map = str_map;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// unordered_map&lt;string, T&gt; â†’ JSON å¯¹è±¡ ï¼ˆKey å¿…é¡»æ˜¯ std::stringï¼‰</span></span><br><span class="line">    std::unordered_map&lt;std::string, <span class="type">double</span>&gt; str_umap = &#123;&#123;<span class="string">&quot;pi&quot;</span>, <span class="number">3.14</span>&#125;, &#123;<span class="string">&quot;e&quot;</span>, <span class="number">2.71</span>&#125;&#125;;</span><br><span class="line">    json j_umap = str_umap;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// map&lt;int, T&gt; â†’ JSON æ•°ç»„ [[k,v], ...]</span></span><br><span class="line">    std::map&lt;<span class="type">int</span>, std::string&gt; int_map = &#123;&#123;<span class="number">1</span>, <span class="string">&quot;one&quot;</span>&#125;, &#123;<span class="number">2</span>, <span class="string">&quot;two&quot;</span>&#125;&#125;;</span><br><span class="line">    json j_int_map = int_map;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// set&lt;T&gt; â†’ JSON æ•°ç»„</span></span><br><span class="line">    std::set&lt;<span class="type">int</span>&gt; s = &#123;<span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">5</span>&#125;;</span><br><span class="line">    json j_set = s;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// unordered_set&lt;T&gt; â†’ JSON æ•°ç»„</span></span><br><span class="line">    std::unordered_set&lt;std::string&gt; us = &#123;<span class="string">&quot;red&quot;</span>, <span class="string">&quot;green&quot;</span>, <span class="string">&quot;blue&quot;</span>&#125;;</span><br><span class="line">    json j_uset = us;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// multimap / multiset â†’ JSON æ•°ç»„</span></span><br><span class="line">    std::multiset&lt;<span class="type">int</span>&gt; ms = &#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line">    json j_mset = ms;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ==================== JSON â†’ C++ ====================</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// JSON å¯¹è±¡ â†’ map / unordered_map</span></span><br><span class="line">    json obj = <span class="string">R&quot;(&#123;&quot;x&quot;: 100, &quot;y&quot;: 200, &quot;z&quot;: 300&#125;)&quot;</span>_json;</span><br><span class="line">    <span class="keyword">auto</span> map_back = obj.get&lt;std::map&lt;std::string, <span class="type">int</span>&gt;&gt;();</span><br><span class="line">    <span class="keyword">auto</span> umap_back = obj.get&lt;std::unordered_map&lt;std::string, <span class="type">int</span>&gt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// JSON æ•°ç»„ [[k,v],...] â†’ map&lt;int, T&gt;</span></span><br><span class="line">    json arr_kv = <span class="string">R&quot;([[1, &quot;a&quot;], [2, &quot;b&quot;], [3, &quot;c&quot;]])&quot;</span>_json;</span><br><span class="line">    <span class="keyword">auto</span> int_map_back = arr_kv.get&lt;std::map&lt;<span class="type">int</span>, std::string&gt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// JSON æ•°ç»„ â†’ set / unordered_set</span></span><br><span class="line">    json arr = <span class="string">R&quot;([5, 3, 1, 4, 1, 5, 9])&quot;</span>_json;</span><br><span class="line">    <span class="keyword">auto</span> set_back = arr.get&lt;std::set&lt;<span class="type">int</span>&gt;&gt;();           <span class="comment">// å»é‡æœ‰åº: &#123;1,3,4,5,9&#125;</span></span><br><span class="line">    <span class="keyword">auto</span> uset_back = arr.get&lt;std::unordered_set&lt;<span class="type">int</span>&gt;&gt;(); <span class="comment">// å»é‡æ— åº</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// JSON æ•°ç»„ â†’ multiset (ä¿ç•™é‡å¤)</span></span><br><span class="line">    <span class="keyword">auto</span> mset_back = arr.get&lt;std::multiset&lt;<span class="type">int</span>&gt;&gt;();     <span class="comment">// &#123;1,1,3,4,5,5,9&#125;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3ï¼‰å…¶ä»–å®¹å™¨-ç±»å‹">3ï¼‰å…¶ä»–å®¹å™¨/ç±»å‹</h4>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260115223649449.png" alt=""></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;nlohmann/json.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;utility&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tuple&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;optional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> json = nlohmann::json;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ==================== C++ â†’ JSON ====================</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// std::pair â†’ JSON æ•°ç»„ [key, value]</span></span><br><span class="line">    std::pair&lt;std::string, <span class="type">int</span>&gt; p = &#123;<span class="string">&quot;age&quot;</span>, <span class="number">25</span>&#125;;</span><br><span class="line">    json j_pair = p;</span><br><span class="line">    </span><br><span class="line">    std::pair&lt;<span class="type">int</span>, <span class="type">double</span>&gt; p2 = &#123;<span class="number">42</span>, <span class="number">3.14</span>&#125;;</span><br><span class="line">    json j_pair2 = p2;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// std::tuple â†’ JSON æ•°ç»„ [a, b, c, ...]</span></span><br><span class="line">    std::tuple&lt;<span class="type">int</span>, std::string, <span class="type">bool</span>&gt; t = &#123;<span class="number">100</span>, <span class="string">&quot;hello&quot;</span>, <span class="literal">true</span>&#125;;</span><br><span class="line">    json j_tuple = t;</span><br><span class="line">    </span><br><span class="line">    std::tuple&lt;<span class="type">double</span>, <span class="type">double</span>, <span class="type">double</span>&gt; t2 = &#123;<span class="number">1.1</span>, <span class="number">2.2</span>, <span class="number">3.3</span>&#125;;</span><br><span class="line">    json j_tuple2 = t2;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// std::optional â†’ T æˆ– null</span></span><br><span class="line">    std::optional&lt;<span class="type">int</span>&gt; opt_val = <span class="number">42</span>;</span><br><span class="line">    std::optional&lt;<span class="type">int</span>&gt; opt_empty = std::<span class="literal">nullopt</span>;</span><br><span class="line">    std::optional&lt;std::string&gt; opt_str = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    json j_opt_val = opt_val;      <span class="comment">// 42</span></span><br><span class="line">    json j_opt_empty = opt_empty;  <span class="comment">// null</span></span><br><span class="line">    json j_opt_str = opt_str;      <span class="comment">// &quot;hello&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ==================== JSON â†’ C++ ====================</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// JSON æ•°ç»„ â†’ std::pair</span></span><br><span class="line">    json jp = <span class="string">R&quot;([&quot;name&quot;, 100])&quot;</span>_json;</span><br><span class="line">    <span class="keyword">auto</span> pair_back = jp.get&lt;std::pair&lt;std::string, <span class="type">int</span>&gt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// JSON æ•°ç»„ â†’ std::tuple</span></span><br><span class="line">    json jt = <span class="string">R&quot;([200, &quot;world&quot;, false, 9.99])&quot;</span>_json;</span><br><span class="line">    <span class="keyword">auto</span> tuple_back = jt.get&lt;std::tuple&lt;<span class="type">int</span>, std::string, <span class="type">bool</span>, <span class="type">double</span>&gt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// JSON â†’ std::optional</span></span><br><span class="line">    json jv = <span class="number">999</span>;</span><br><span class="line">    json jn = <span class="literal">nullptr</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">auto</span> opt_back = jv.get&lt;std::optional&lt;<span class="type">int</span>&gt;&gt;();       <span class="comment">// has_value() = true</span></span><br><span class="line">    <span class="keyword">auto</span> opt_null_back = jn.get&lt;std::optional&lt;<span class="type">int</span>&gt;&gt;(); <span class="comment">// has_value() = false</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-å¤æ‚ç±»å‹ä¸jsonçš„è½¬æ¢">2.å¤æ‚ç±»å‹ä¸jsonçš„è½¬æ¢</h2>
<p><strong>jsonä¸ä¸å°‘å¤æ‚ç±»å‹éƒ½æ— æ³•ç›´æ¥è¿›è¡Œè½¬æ¢ï¼Œè¿™é‡Œä¸»è¦åˆ—ä¸¾äº†æœ€å¸¸ç”¨åˆ°äº†å‡ ä¸ªå¤æ‚ç±»å‹</strong><br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260115230954500.png" alt=""></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;nlohmann/json.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;optional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;variant&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> json = nlohmann::json;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ============================================================</span></span><br><span class="line"><span class="comment">//1.æšä¸¾ç±»å‹</span></span><br><span class="line"><span class="comment">// ============================================================</span></span><br><span class="line"><span class="comment">//æ–¹æ³•ä¸€ï¼šä½¿ç”¨å®ï¼ˆæ¨èï¼Œæœ€ç®€æ´ï¼‰</span></span><br><span class="line"><span class="comment">// å®šä¹‰æšä¸¾</span></span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">Color</span> &#123;</span><br><span class="line">    Red,</span><br><span class="line">    Green,</span><br><span class="line">    Blue,</span><br><span class="line">    Unknown</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨å®å®šä¹‰æšä¸¾ä¸å­—ç¬¦ä¸²çš„æ˜ å°„</span></span><br><span class="line"><span class="built_in">NLOHMANN_JSON_SERIALIZE_ENUM</span>(Color, &#123;</span><br><span class="line">    &#123;Color::Unknown, <span class="literal">nullptr</span>&#125;,   <span class="comment">// é»˜è®¤å€¼ï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line">    &#123;Color::Red, <span class="string">&quot;red&quot;</span>&#125;,</span><br><span class="line">    &#123;Color::Green, <span class="string">&quot;green&quot;</span>&#125;,</span><br><span class="line">    &#123;Color::Blue, <span class="string">&quot;blue&quot;</span>&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ–¹æ³•äºŒï¼šæ‰‹åŠ¨å®ç° to_json / from_json</span></span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">Status</span> &#123;</span><br><span class="line">    Pending,</span><br><span class="line">    Active,</span><br><span class="line">    Completed,</span><br><span class="line">    Failed</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æšä¸¾ â†’ JSONï¼ˆè½¬ä¸ºå­—ç¬¦ä¸²ï¼‰</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">to_json</span><span class="params">(json&amp; j, <span class="type">const</span> Status&amp; s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (s) &#123;</span><br><span class="line">        <span class="keyword">case</span> Status::Pending:   j = <span class="string">&quot;pending&quot;</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> Status::Active:    j = <span class="string">&quot;active&quot;</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> Status::Completed: j = <span class="string">&quot;completed&quot;</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> Status::Failed:    j = <span class="string">&quot;failed&quot;</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:                j = <span class="string">&quot;unknown&quot;</span>; <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// JSON â†’ æšä¸¾</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">from_json</span><span class="params">(<span class="type">const</span> json&amp; j, Status&amp; s)</span> </span>&#123;</span><br><span class="line">    std::string str = j.<span class="built_in">get</span>&lt;std::string&gt;();</span><br><span class="line">    <span class="keyword">if</span> (str == <span class="string">&quot;pending&quot;</span>)        s = Status::Pending;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (str == <span class="string">&quot;active&quot;</span>)    s = Status::Active;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (str == <span class="string">&quot;completed&quot;</span>) s = Status::Completed;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (str == <span class="string">&quot;failed&quot;</span>)    s = Status::Failed;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Unknown status: &quot;</span> + str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ============================================================</span></span><br><span class="line"><span class="comment">// 1. è‡ªå®šä¹‰ struct</span></span><br><span class="line"><span class="comment">// ============================================================</span></span><br><span class="line"><span class="comment">// æ–¹æ³•ä¸€ï¼šä½¿ç”¨å®ï¼ˆæ¨èï¼Œæœ€ç®€æ´ï¼‰</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    std::string name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">    <span class="type">double</span> salary;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NLOHMANN_DEFINE_TYPE_NON_INTRUSIVE</span>(Person, name, age, salary)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ³•äºŒï¼šæ‰‹åŠ¨å®ç°</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line">    std::string id;</span><br><span class="line">    std::string department;</span><br><span class="line">    <span class="type">bool</span> active;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">to_json</span><span class="params">(json&amp; j, <span class="type">const</span> Employee&amp; e)</span> </span>&#123;</span><br><span class="line">    j[<span class="string">&quot;id&quot;</span>] = e.id;</span><br><span class="line">    j[<span class="string">&quot;department&quot;</span>] = e.department;</span><br><span class="line">    j[<span class="string">&quot;is_active&quot;</span>] = e.active;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">from_json</span><span class="params">(<span class="type">const</span> json&amp; j, Employee&amp; e)</span> </span>&#123;</span><br><span class="line">    e.id = j[<span class="string">&quot;id&quot;</span>];                    </span><br><span class="line">    e.department = j[<span class="string">&quot;department&quot;</span>];   </span><br><span class="line">    e.active = j[<span class="string">&quot;is_active&quot;</span>];        </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ³•ä¸‰ï¼šåœ¨ç»“æ„ä½“ä¸­ä½¿ç”¨æšä¸¾</span></span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">Role</span> &#123; Admin, User, Guest &#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NLOHMANN_JSON_SERIALIZE_ENUM</span>(Role, &#123;</span><br><span class="line">    &#123;Role::Admin, <span class="string">&quot;admin&quot;</span>&#125;,</span><br><span class="line">    &#123;Role::User, <span class="string">&quot;user&quot;</span>&#125;,</span><br><span class="line">    &#123;Role::Guest, <span class="string">&quot;guest&quot;</span>&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">    std::string username;</span><br><span class="line">    Role role;              <span class="comment">// æšä¸¾æˆå‘˜</span></span><br><span class="line">    <span class="type">bool</span> active;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NLOHMANN_DEFINE_TYPE_NON_INTRUSIVE</span>(Account, username, role, active)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ============================================================</span></span><br><span class="line"><span class="comment">// 2. è‡ªå®šä¹‰ classï¼ˆç§æœ‰æˆå‘˜ï¼‰</span></span><br><span class="line"><span class="comment">// ============================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ³•ä¸€ï¼šä½¿ç”¨ä¾µå…¥å¼å®ï¼ˆINTRUSIVEï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string sku;</span><br><span class="line">    std::string name;</span><br><span class="line">    <span class="type">double</span> price;</span><br><span class="line">    <span class="type">int</span> stock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Product</span>() = <span class="keyword">default</span>;</span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¾µå…¥å¼å®ï¼šå¯è®¿é—®ç§æœ‰æˆå‘˜</span></span><br><span class="line">    <span class="built_in">NLOHMANN_DEFINE_TYPE_INTRUSIVE</span>(Product, sku, name, price, stock)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ³•äºŒï¼šä½¿ç”¨å‹å…ƒå‡½æ•°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BankAccount</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string account_number;</span><br><span class="line">    std::string holder_name;</span><br><span class="line">    <span class="type">double</span> balance;</span><br><span class="line">    <span class="type">bool</span> is_active;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">BankAccount</span>() = <span class="keyword">default</span>;</span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å£°æ˜å‹å…ƒå‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">friend</span> <span class="type">void</span> <span class="title">to_json</span><span class="params">(json&amp; j, <span class="type">const</span> BankAccount&amp; acc)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">friend</span> <span class="type">void</span> <span class="title">from_json</span><span class="params">(<span class="type">const</span> json&amp; j, BankAccount&amp; acc)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‹å…ƒå‡½æ•°å®ç°</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">to_json</span><span class="params">(json&amp; j, <span class="type">const</span> BankAccount&amp; acc)</span> </span>&#123;</span><br><span class="line">    j[<span class="string">&quot;account_number&quot;</span>] = acc.account_number;</span><br><span class="line">    j[<span class="string">&quot;holder_name&quot;</span>] = acc.holder_name;</span><br><span class="line">    j[<span class="string">&quot;balance&quot;</span>] = acc.balance;</span><br><span class="line">    j[<span class="string">&quot;is_active&quot;</span>] = acc.is_active;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">from_json</span><span class="params">(<span class="type">const</span> json&amp; j, BankAccount&amp; acc)</span> </span>&#123;</span><br><span class="line">    acc.account_number = j[<span class="string">&quot;account_number&quot;</span>]; </span><br><span class="line">    acc.holder_name = j[<span class="string">&quot;holder_name&quot;</span>];      </span><br><span class="line">    acc.balance = j[<span class="string">&quot;balance&quot;</span>];              </span><br><span class="line">    acc.is_active = j[<span class="string">&quot;is_active&quot;</span>];        </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ³•ä¸‰ï¼šé€šè¿‡ Getter/Setter</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">double</span> width;</span><br><span class="line">    <span class="type">double</span> height;</span><br><span class="line">    std::string color;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Rectangle</span>() : <span class="built_in">width</span>(<span class="number">0</span>), <span class="built_in">height</span>(<span class="number">0</span>), <span class="built_in">color</span>(<span class="string">&quot;white&quot;</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getter</span></span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">getWidth</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> width; &#125;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">getHeight</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> height; &#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">getColor</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> color; &#125;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">getArea</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> width * height; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Setter</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setWidth</span><span class="params">(<span class="type">double</span> w)</span> </span>&#123; width = w; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setHeight</span><span class="params">(<span class="type">double</span> h)</span> </span>&#123; height = h; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setColor</span><span class="params">(<span class="type">const</span> std::string&amp; c)</span> </span>&#123; color = c; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡ Getter/Setter å®ç°ï¼ˆç±»å¤–éƒ¨ï¼‰</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">to_json</span><span class="params">(json&amp; j, <span class="type">const</span> Rectangle&amp; r)</span> </span>&#123;</span><br><span class="line">    j[<span class="string">&quot;width&quot;</span>] = r.<span class="built_in">getWidth</span>();</span><br><span class="line">    j[<span class="string">&quot;height&quot;</span>] = r.<span class="built_in">getHeight</span>();</span><br><span class="line">    j[<span class="string">&quot;color&quot;</span>] = r.<span class="built_in">getColor</span>();</span><br><span class="line">    j[<span class="string">&quot;area&quot;</span>] = r.<span class="built_in">getArea</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">from_json</span><span class="params">(<span class="type">const</span> json&amp; j, Rectangle&amp; r)</span> </span>&#123;</span><br><span class="line">    r.<span class="built_in">setWidth</span>(j[<span class="string">&quot;width&quot;</span>]); </span><br><span class="line">    r.<span class="built_in">setHeight</span>(j[<span class="string">&quot;height&quot;</span>]); </span><br><span class="line">    r.<span class="built_in">setColor</span>(j[<span class="string">&quot;color&quot;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ³•å››ï¼šåŒ…å«åµŒå¥—å¯¹è±¡çš„ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> order_id;</span><br><span class="line">    Person customer;     			<span class="comment">// åµŒå¥— struct</span></span><br><span class="line">    std::vector&lt;Product&gt; items;        <span class="comment">// åµŒå¥— class æ•°ç»„</span></span><br><span class="line">    <span class="type">double</span> total_amount;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Order</span>() : <span class="built_in">order_id</span>(<span class="number">0</span>), <span class="built_in">total_amount</span>(<span class="number">0</span>) &#123;&#125;</span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*ä¾µå…¥å¼å®ï¼Œå‰æï¼š</span></span><br><span class="line"><span class="comment">        - è¦ä¹ˆä¹Ÿä½¿ç”¨ NLOHMANN_DEFINE_TYPE_INTRUSIVE å®</span></span><br><span class="line"><span class="comment">        - è¦ä¹ˆå®ç°è‡ªå®šä¹‰çš„ to_json/from_json å‡½æ•°</span></span><br><span class="line"><span class="comment">        - è¦ä¹ˆä½¿ç”¨å…¶ä»– nlohmann json æ”¯æŒçš„åºåˆ—åŒ–æ–¹å¼*/</span></span><br><span class="line">    <span class="built_in">NLOHMANN_DEFINE_TYPE_INTRUSIVE</span>(Order, order_id, customer, items, total_amount)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ³•äº”ï¼šå¸¦ç»§æ‰¿çš„ç±»</span></span><br><span class="line"><span class="comment">//çˆ¶ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    std::string type;</span><br><span class="line">    std::string color;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Shape</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="built_in">Shape</span>(std::string t, std::string c) : <span class="built_in">type</span>(std::<span class="built_in">move</span>(t)), <span class="built_in">color</span>(std::<span class="built_in">move</span>(c)) &#123;&#125;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Shape</span>() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">getType</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> type; &#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">getColor</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> color; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">friend</span> <span class="type">void</span> <span class="title">to_json</span><span class="params">(json&amp; j, <span class="type">const</span> Shape&amp; s)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">friend</span> <span class="type">void</span> <span class="title">from_json</span><span class="params">(<span class="type">const</span> json&amp; j, Shape&amp; s)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">to_json</span><span class="params">(json&amp; j, <span class="type">const</span> Shape&amp; s)</span> </span>&#123;</span><br><span class="line">    j[<span class="string">&quot;type&quot;</span>] = s.type;</span><br><span class="line">    j[<span class="string">&quot;color&quot;</span>] = s.color;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">from_json</span><span class="params">(<span class="type">const</span> json&amp; j, Shape&amp; s)</span> </span>&#123;</span><br><span class="line">    s.type = j[<span class="string">&quot;type&quot;</span>];</span><br><span class="line">    s.color = j[<span class="string">&quot;color&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å­ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> : <span class="keyword">public</span> Shape &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">double</span> radius;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Circle</span>() : <span class="built_in">Shape</span>(<span class="string">&quot;circle&quot;</span>, <span class="string">&quot;white&quot;</span>), <span class="built_in">radius</span>(<span class="number">0</span>) &#123;&#125;</span><br><span class="line">    <span class="built_in">Circle</span>(<span class="type">double</span> r, std::string c) : <span class="built_in">Shape</span>(<span class="string">&quot;circle&quot;</span>, std::<span class="built_in">move</span>(c)), <span class="built_in">radius</span>(r) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">getRadius</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> radius; &#125;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">getArea</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> <span class="number">3.14159</span> * radius * radius; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">friend</span> <span class="type">void</span> <span class="title">to_json</span><span class="params">(json&amp; j, <span class="type">const</span> Circle&amp; c)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">friend</span> <span class="type">void</span> <span class="title">from_json</span><span class="params">(<span class="type">const</span> json&amp; j, Circle&amp; c)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">to_json</span><span class="params">(json&amp; j, <span class="type">const</span> Circle&amp; c)</span> </span>&#123;</span><br><span class="line">    j[<span class="string">&quot;type&quot;</span>] = c.type;</span><br><span class="line">    j[<span class="string">&quot;color&quot;</span>] = c.color;</span><br><span class="line">    j[<span class="string">&quot;radius&quot;</span>] = c.radius;</span><br><span class="line">    j[<span class="string">&quot;area&quot;</span>] = c.<span class="built_in">getArea</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">from_json</span><span class="params">(<span class="type">const</span> json&amp; j, Circle&amp; c)</span> </span>&#123;</span><br><span class="line">    c.type = j[<span class="string">&quot;type&quot;</span>];</span><br><span class="line">    c.color = j[<span class="string">&quot;color&quot;</span>];</span><br><span class="line">    c.radius = j[<span class="string">&quot;radius&quot;</span>]; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ============================================================</span></span><br><span class="line"><span class="comment">// 3. è£¸æŒ‡é’ˆ T*</span></span><br><span class="line"><span class="comment">// ============================================================</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">to_json</span><span class="params">(json&amp; j, <span class="type">const</span> T* ptr)</span> </span>&#123;</span><br><span class="line">    j = ptr ? <span class="built_in">json</span>(*ptr) : <span class="built_in">json</span>(<span class="literal">nullptr</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">from_json</span><span class="params">(<span class="type">const</span> json&amp; j, T*&amp; ptr)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (j.<span class="built_in">is_null</span>()) &#123;</span><br><span class="line">        ptr = <span class="literal">nullptr</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ptr = <span class="keyword">new</span> <span class="built_in">T</span>(j.<span class="built_in">get</span>&lt;T&gt;());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ============================================================</span></span><br><span class="line"><span class="comment">// 4. std::shared_ptr&lt;T&gt;</span></span><br><span class="line"><span class="comment">// ============================================================</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">to_json</span><span class="params">(json&amp; j, <span class="type">const</span> std::shared_ptr&lt;T&gt;&amp; ptr)</span> </span>&#123;</span><br><span class="line">    j = ptr ? <span class="built_in">json</span>(*ptr) : <span class="built_in">json</span>(<span class="literal">nullptr</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">from_json</span><span class="params">(<span class="type">const</span> json&amp; j, std::shared_ptr&lt;T&gt;&amp; ptr)</span> </span>&#123;</span><br><span class="line">    ptr = j.<span class="built_in">is_null</span>() ? <span class="literal">nullptr</span> : std::<span class="built_in">make_shared</span>&lt;T&gt;(j.<span class="built_in">get</span>&lt;T&gt;());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ============================================================</span></span><br><span class="line"><span class="comment">// 5. std::unique_ptr&lt;T&gt;</span></span><br><span class="line"><span class="comment">// ============================================================</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">to_json</span><span class="params">(json&amp; j, <span class="type">const</span> std::unique_ptr&lt;T&gt;&amp; ptr)</span> </span>&#123;</span><br><span class="line">    j = ptr ? <span class="built_in">json</span>(*ptr) : <span class="built_in">json</span>(<span class="literal">nullptr</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">from_json</span><span class="params">(<span class="type">const</span> json&amp; j, std::unique_ptr&lt;T&gt;&amp; ptr)</span> </span>&#123;</span><br><span class="line">    ptr = j.<span class="built_in">is_null</span>() ? <span class="literal">nullptr</span> : std::<span class="built_in">make_unique</span>&lt;T&gt;(j.<span class="built_in">get</span>&lt;T&gt;());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ============================================================</span></span><br><span class="line"><span class="comment">// 6. std::variant&lt;...&gt;</span></span><br><span class="line"><span class="comment">// ============================================================</span></span><br><span class="line"><span class="keyword">using</span> MyVariant = std::variant&lt;<span class="type">int</span>, std::string, <span class="type">double</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">to_json</span><span class="params">(json&amp; j, <span class="type">const</span> MyVariant&amp; v)</span> </span>&#123;</span><br><span class="line">    std::<span class="built_in">visit</span>([&amp;j, &amp;v](<span class="keyword">auto</span>&amp;&amp; val) &#123;</span><br><span class="line">        j[<span class="string">&quot;type_index&quot;</span>] = v.<span class="built_in">index</span>();</span><br><span class="line">        j[<span class="string">&quot;value&quot;</span>] = val;</span><br><span class="line">    &#125;, v);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">from_json</span><span class="params">(<span class="type">const</span> json&amp; j, MyVariant&amp; v)</span> </span>&#123;</span><br><span class="line">    <span class="type">size_t</span> idx = j[<span class="string">&quot;type_index&quot;</span>];  <span class="comment">// ç›´æ¥èµ‹å€¼</span></span><br><span class="line">    <span class="keyword">switch</span> (idx) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>: v = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(j[<span class="string">&quot;value&quot;</span>]); <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>: v = <span class="built_in">static_cast</span>&lt;std::string&gt;(j[<span class="string">&quot;value&quot;</span>]); <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>: v = <span class="built_in">static_cast</span>&lt;<span class="type">double</span>&gt;(j[<span class="string">&quot;value&quot;</span>]); <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>: <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Unknown variant type&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ============================================================</span></span><br><span class="line"><span class="comment">// 7. std::chrono::* æ—¶é—´ç±»å‹</span></span><br><span class="line"><span class="comment">// ============================================================</span></span><br><span class="line"><span class="keyword">using</span> TimePoint = std::chrono::system_clock::time_point;</span><br><span class="line"><span class="keyword">using</span> Duration = std::chrono::milliseconds;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">to_json</span><span class="params">(json&amp; j, <span class="type">const</span> TimePoint&amp; tp)</span> </span>&#123;</span><br><span class="line">    j = std::chrono::<span class="built_in">duration_cast</span>&lt;Duration&gt;(tp.<span class="built_in">time_since_epoch</span>()).<span class="built_in">count</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">from_json</span><span class="params">(<span class="type">const</span> json&amp; j, TimePoint&amp; tp)</span> </span>&#123;</span><br><span class="line">    <span class="type">int64_t</span> ms = j;  <span class="comment">// ç›´æ¥èµ‹å€¼</span></span><br><span class="line">    tp = <span class="built_in">TimePoint</span>(<span class="built_in">Duration</span>(ms));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">to_json</span><span class="params">(json&amp; j, <span class="type">const</span> Duration&amp; d)</span> </span>&#123;</span><br><span class="line">    j = d.<span class="built_in">count</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">from_json</span><span class="params">(<span class="type">const</span> json&amp; j, Duration&amp; d)</span> </span>&#123;</span><br><span class="line">    <span class="type">int64_t</span> ms = j;  <span class="comment">// ç›´æ¥èµ‹å€¼</span></span><br><span class="line">    d = <span class="built_in">Duration</span>(ms);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ============================================================</span></span><br><span class="line"><span class="comment">// 8. std::stack&lt;T&gt; / std::queue&lt;T&gt;</span></span><br><span class="line"><span class="comment">// ============================================================</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">to_json</span><span class="params">(json&amp; j, std::stack&lt;T&gt; s)</span> </span>&#123;</span><br><span class="line">    std::vector&lt;T&gt; vec;</span><br><span class="line">    <span class="keyword">while</span> (!s.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        vec.<span class="built_in">push_back</span>(s.<span class="built_in">top</span>());</span><br><span class="line">        s.<span class="built_in">pop</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    std::<span class="built_in">reverse</span>(vec.<span class="built_in">begin</span>(), vec.<span class="built_in">end</span>());</span><br><span class="line">    j = vec;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">from_json</span><span class="params">(<span class="type">const</span> json&amp; j, std::stack&lt;T&gt;&amp; s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (!s.<span class="built_in">empty</span>()) s.<span class="built_in">pop</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; item : j) &#123;</span><br><span class="line">        T val = item;</span><br><span class="line">        s.<span class="built_in">push</span>(val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">to_json</span><span class="params">(json&amp; j, std::queue&lt;T&gt; q)</span> </span>&#123;</span><br><span class="line">    std::vector&lt;T&gt; vec;</span><br><span class="line">    <span class="keyword">while</span> (!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        vec.<span class="built_in">push_back</span>(q.<span class="built_in">front</span>());</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    j = vec;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">from_json</span><span class="params">(<span class="type">const</span> json&amp; j, std::queue&lt;T&gt;&amp; q)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (!q.<span class="built_in">empty</span>()) q.<span class="built_in">pop</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; item : j) &#123;</span><br><span class="line">        T val = item;</span><br><span class="line">        q.<span class="built_in">push</span>(val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-ä»æ–‡ä»¶è¯»å–-å†™å…¥-JSON">3.ä»æ–‡ä»¶è¯»å–/å†™å…¥ JSON</h2>
<p>jsoné‡è½½äº†â€œ&lt;&lt;â€ã€â€œ&gt;&gt;â€è¿ç®—ç¬¦ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ä»jsonè¯»å–/å†™å…¥json</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å†™å…¥ JSON åˆ°æ–‡ä»¶</span></span><br><span class="line">json js = &#123;&#123;<span class="string">&quot;name&quot;</span>, <span class="string">&quot;èµµå…­&quot;</span>&#125;, &#123;<span class="string">&quot;age&quot;</span>, <span class="number">35</span>&#125;&#125;;</span><br><span class="line"><span class="function">std::ofstream <span class="title">file_out</span><span class="params">(<span class="string">&quot;data.json&quot;</span>)</span></span>;</span><br><span class="line">file_out &lt;&lt; js.<span class="built_in">dump</span>(<span class="number">4</span>); <span class="comment">// æ ¼å¼åŒ–å†™å…¥</span></span><br><span class="line">file_out.<span class="built_in">close</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»æ–‡ä»¶è¯»å– JSON</span></span><br><span class="line"><span class="function">std::ifstream <span class="title">file_in</span><span class="params">(<span class="string">&quot;data.json&quot;</span>)</span></span>;</span><br><span class="line">json js_read;</span><br><span class="line">file_in &gt;&gt; js_read;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;ä»æ–‡ä»¶è¯»å–ï¼š&quot;</span> &lt;&lt; js_read[<span class="string">&quot;name&quot;</span>] &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure>
<h2 id="4-jsonçš„æ ¸å¿ƒå‡½æ•°">4.jsonçš„æ ¸å¿ƒå‡½æ•°</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260115225628592.png" alt=""></p>
<p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</p>
<ul>
<li><strong>å¼‚å¸¸å¤„ç†</strong>ï¼š
<ul>
<li>json::parse()ã€at() ç­‰æ“ä½œå¯èƒ½æŠ›å¼‚å¸¸ï¼ˆå¦‚æ ¼å¼é”™è¯¯ã€é”®ä¸å­˜åœ¨ï¼‰ï¼Œ<strong>å¿…é¡»ç”¨ try-catch æ•è·ï¼Œé¿å…ç¨‹åºå´©æºƒ</strong>ã€‚</li>
</ul>
</li>
<li><strong>ç±»å‹åŒ¹é…</strong>ï¼š
<ul>
<li>è¯»å–å€¼æ—¶è¦ç¡®ä¿ç±»å‹ä¸€è‡´ï¼ˆå¦‚ JSON æ˜¯æ•°å­—ï¼Œä¸èƒ½ç›´æ¥è½¬å­—ç¬¦ä¸²ï¼‰ï¼Œå¦åˆ™<strong>ä¼šæŠ› type_error</strong></li>
</ul>
</li>
<li><strong>æ€§èƒ½è€ƒé‡</strong>ï¼š
<ul>
<li>nlohmann/json æ˜“ç”¨ä½†æ€§èƒ½ç•¥ä½äº RapidJSONï¼Œè‹¥éœ€æè‡´æ€§èƒ½ï¼ˆå¦‚é«˜é¢‘è§£æ/ç”Ÿæˆï¼‰ï¼Œå¯æ›¿æ¢ä¸º RapidJSONã€‚</li>
</ul>
</li>
<li><strong>ç¼–ç é—®é¢˜</strong>ï¼š
<ul>
<li>é»˜è®¤æ”¯æŒ UTF-8ï¼Œè‹¥å¤„ç† GBK ç­‰ç¼–ç ï¼Œéœ€å…ˆè½¬æ¢ä¸º UTF-8 å†è§£æã€‚</li>
</ul>
</li>
</ul>
<h2 id="5-åºåˆ—åŒ–ä¸ååºåˆ—åŒ–">5.åºåˆ—åŒ–ä¸ååºåˆ—åŒ–</h2>
<ul>
<li><strong>åºåˆ—åŒ–</strong>ï¼š
<ul>
<li>C++ç±»å‹å…ˆè½¬ä¸ºjsonï¼Œjsonåœ¨è°ƒç”¨dumpå‡½æ•°è¿›è¡Œåºåˆ—åŒ–ï¼Œè¿”å›string</li>
</ul>
</li>
<li><strong>ååºåˆ—åŒ–</strong>ï¼š
<ul>
<li>å¯¹äºjsonåºåˆ—åŒ–åçš„stringï¼Œé€šè¿‡parseè¿›è¡Œååºåˆ—åŒ–ï¼Œå¾—åˆ°C++ç±»å‹</li>
</ul>
</li>
</ul>
<h3 id="ï¼ˆ1ï¼‰classçš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–">ï¼ˆ1ï¼‰classçš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;nlohmann/json.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> json = nlohmann::json;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ä¾µå…¥å¼å®çš„ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    std::string username;</span><br><span class="line">    std::string email;</span><br><span class="line">    std::vector&lt;std::string&gt; roles;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">User</span>() : <span class="built_in">id</span>(<span class="number">0</span>) &#123;&#125;  <span class="comment">// é»˜è®¤æ„é€ å‡½æ•°å¿…é¡»å­˜åœ¨</span></span><br><span class="line">    <span class="built_in">User</span>(<span class="type">int</span> id, std::string username, std::string email)</span><br><span class="line">        : <span class="built_in">id</span>(id), <span class="built_in">username</span>(username), <span class="built_in">email</span>(email) &#123;&#125;</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addRole</span><span class="params">(<span class="type">const</span> std::string&amp; role)</span> </span>&#123; roles.<span class="built_in">push_back</span>(role); &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Getterï¼ˆç”¨äºéªŒè¯ååºåˆ—åŒ–ç»“æœï¼‰</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getId</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> id; &#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">getUsername</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> username; &#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> std::vector&lt;std::string&gt;&amp; <span class="title">getRoles</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> roles; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨å®ç®€åŒ–åºåˆ—åŒ–/ååºåˆ—åŒ–å®šä¹‰</span></span><br><span class="line">    <span class="built_in">NLOHMANN_DEFINE_TYPE_INTRUSIVE</span>(User, id, username, email, roles)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">    <span class="function">User <span class="title">user</span><span class="params">(<span class="number">1</span>, <span class="string">&quot;johndoe&quot;</span>, <span class="string">&quot;john@example.com&quot;</span>)</span></span>;</span><br><span class="line">    user.<span class="built_in">addRole</span>(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">    user.<span class="built_in">addRole</span>(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åºåˆ—åŒ–</span></span><br><span class="line">    json j = user;</span><br><span class="line">    std::string serialized = j.<span class="built_in">dump</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">    User restoredUser = json::<span class="built_in">parse</span>(serialized);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰structçš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–">ï¼ˆ2ï¼‰structçš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;nlohmann/json.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> json = nlohmann::json;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç®€å•ç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    std::string name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">    <span class="type">bool</span> active;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éä¾µå…¥å¼åºåˆ—åŒ– - åœ¨ç»“æ„ä½“å¤–éƒ¨å®šä¹‰è½¬æ¢</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">to_json</span><span class="params">(json&amp; j, <span class="type">const</span> Person&amp; p)</span> </span>&#123;</span><br><span class="line">    j = json&#123;&#123;<span class="string">&quot;name&quot;</span>, p.name&#125;, &#123;<span class="string">&quot;age&quot;</span>, p.age&#125;, &#123;<span class="string">&quot;active&quot;</span>, p.active&#125;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">from_json</span><span class="params">(<span class="type">const</span> json&amp; j, Person&amp; p)</span> </span>&#123;</span><br><span class="line">    p.name = j[<span class="string">&quot;name&quot;</span>];</span><br><span class="line">    p.age = j[<span class="string">&quot;age&quot;</span>];</span><br><span class="line">    p.active = j[<span class="string">&quot;active&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åºåˆ—åŒ–</span></span><br><span class="line">    Person p1&#123;<span class="string">&quot;Alice&quot;</span>, <span class="number">30</span>, <span class="literal">true</span>&#125;;</span><br><span class="line">    json j = p1;</span><br><span class="line">    std::string serialized = j.<span class="built_in">dump</span>(<span class="number">4</span>);  <span class="comment">// 4æ˜¯ç¼©è¿›ç©ºæ ¼æ•°</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;åºåˆ—åŒ–ç»“æœ:\n&quot;</span> &lt;&lt; serialized &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">    Person p2;</span><br><span class="line">    json j2 = json::<span class="built_in">parse</span>(serialized);</span><br><span class="line">    <span class="built_in">from_json</span>(j2, p2);</span><br><span class="line">    <span class="comment">// æˆ–ç®€å†™ä¸º: p2 = j2.get&lt;Person&gt;();</span></span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;ååºåˆ—åŒ–å: &quot;</span> &lt;&lt; p<span class="number">2.</span>name &lt;&lt; <span class="string">&quot;, &quot;</span> &lt;&lt; p<span class="number">2.</span>age &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰æ–‡ä»¶è¯»å†™ç¤ºä¾‹ï¼ˆå¯ç”¨äºâ€œé…ç½®æ–‡ä»¶â€ï¼‰">ï¼ˆ3ï¼‰æ–‡ä»¶è¯»å†™ç¤ºä¾‹ï¼ˆå¯ç”¨äºâ€œé…ç½®æ–‡ä»¶â€ï¼‰</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;nlohmann/json.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> json = nlohmann::json;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Config</span> &#123;</span><br><span class="line">    std::string host;</span><br><span class="line">    <span class="type">int</span> port;</span><br><span class="line">    <span class="type">bool</span> debug;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NLOHMANN_DEFINE_TYPE_NON_INTRUSIVE</span>(Config, host, port, debug)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ========== å†™å…¥æ–‡ä»¶ ==========</span></span><br><span class="line">    Config config&#123;<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8080</span>, <span class="literal">true</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="function">std::ofstream <span class="title">ofs</span><span class="params">(<span class="string">&quot;config.json&quot;</span>)</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (ofs.<span class="built_in">is_open</span>()) &#123;</span><br><span class="line">        json j = config;</span><br><span class="line">        ofs &lt;&lt; j.<span class="built_in">dump</span>(<span class="number">4</span>);  <span class="comment">// 4 ç©ºæ ¼ç¼©è¿›</span></span><br><span class="line">        ofs.<span class="built_in">close</span>();</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;é…ç½®å·²ä¿å­˜åˆ° config.json&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ========== ä»æ–‡ä»¶è¯»å– ==========</span></span><br><span class="line">    <span class="function">std::ifstream <span class="title">ifs</span><span class="params">(<span class="string">&quot;config.json&quot;</span>)</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (ifs.<span class="built_in">is_open</span>()) &#123;</span><br><span class="line">        json j = json::<span class="built_in">parse</span>(ifs);</span><br><span class="line">        Config loaded = j;</span><br><span class="line">        ifs.<span class="built_in">close</span>();</span><br><span class="line">        </span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;è¯»å–é…ç½®: &quot;</span> &lt;&lt; loaded.host &lt;&lt; <span class="string">&quot;:&quot;</span> &lt;&lt; loaded.port </span><br><span class="line">                  &lt;&lt; <span class="string">&quot; (debug=&quot;</span> &lt;&lt; std::boolalpha &lt;&lt; loaded.debug &lt;&lt; <span class="string">&quot;)&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ========== å¼‚å¸¸å¤„ç† ==========</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="function">std::ifstream <span class="title">bad_file</span><span class="params">(<span class="string">&quot;not_exist.json&quot;</span>)</span></span>;</span><br><span class="line">        json j = json::<span class="built_in">parse</span>(bad_file);  <span class="comment">// ä¼šæŠ›å¼‚å¸¸</span></span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> json::parse_error&amp; e) &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;è§£æé”™è¯¯: &quot;</span> &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="è¡¥å……ï¼šæŒ‡é’ˆç±»å‹åºåˆ—åŒ–-ä¿¡æ¯æŸå¤±é—®é¢˜">è¡¥å……ï¼šæŒ‡é’ˆç±»å‹åºåˆ—åŒ– ä¿¡æ¯æŸå¤±é—®é¢˜</h2>
<p>ä¸Šé¢æ¼”ç¤ºçš„æŒ‡é’ˆçš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ˜æ˜¾æœ‰å¾ˆå¤§é—®é¢˜ï¼Œä¼šé€ æˆä¿¡æ¯çš„æŸå¤±</p>
<ul>
<li><strong>æŒ‡é’ˆçš„åºåˆ—åŒ–</strong>ï¼š
<ul>
<li>å…ˆè½¬æ¢ä¸ºå®ä½“,ç„¶åè¿›è¡Œåºåˆ—åŒ–</li>
</ul>
</li>
<li><strong>æŒ‡é’ˆçš„ååºåˆ—åŒ–</strong>ï¼š
<ul>
<li>å…ˆè·å–å®ä½“ï¼Œå†è½¬ä¸ºæŒ‡é’ˆ</li>
</ul>
</li>
<li>çœ‹ä¸ªç®€å•çš„ä¾‹å­ï¼š
<ul>
<li>åœ¨æ¤ç‰©å¤§æˆ˜åƒµå°¸ä¸­ï¼Œéœ€è¦å®ç°å­˜æ¡£åŠŸèƒ½ï¼Œæ¤ç‰©AæŒæœ‰åƒµå°¸Bçš„æŒ‡é’ˆï¼Œç”¨æ¥å®ç°Aæ”»å‡»Bï¼ŒAã€Båœ¨å­˜æ¡£æ—¶éƒ½è¦è¿›è¡Œåºåˆ—åŒ–
<ul>
<li>åºåˆ—åŒ–å‰ï¼ŒAçš„æŒ‡é’ˆæ‰§è¡ŒBï¼Œåºåˆ—åŒ–åè¿›è¡Œå­˜å‚¨ï¼›</li>
<li>ä½†ååºåˆ—åŒ–åï¼ŒAçš„æŒ‡é’ˆæŒ‡å‘çš„æ˜¯ç”¨Bçš„æ•°æ®æ–°ç”Ÿæˆçš„å¯¹è±¡ï¼Œæ˜¾ç„¶Aå·²ç»ä¸æŒ‡å‘Bäº†ï¼ŒAä¹Ÿå°±æ— æ³•æ”»å‡»åˆ°Bäº†</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š<br>
ä¸ªå…¸å‹çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨å¯¹è±¡å¼•ç”¨ç³»ç»Ÿæˆ–å¯¹è±¡IDæ˜ å°„:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŸºäºIDçš„å¯¹è±¡å¼•ç”¨ç³»ç»Ÿ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GameObject</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> id;  <span class="comment">// æ¯ä¸ªå¯¹è±¡çš„å”¯ä¸€æ ‡è¯†ç¬¦</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getId</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> id; &#125;</span><br><span class="line">    <span class="function"><span class="type">static</span> GameObject* <span class="title">findById</span><span class="params">(<span class="type">int</span> id)</span></span>; <span class="comment">// å…¨å±€æŸ¥æ‰¾å¯¹è±¡çš„æ–¹æ³•</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Plant</span> : <span class="keyword">public</span> GameObject &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> zombieTargetId; <span class="comment">// å­˜å‚¨ç›®æ ‡åƒµå°¸çš„IDè€ŒéæŒ‡é’ˆ</span></span><br><span class="line">    Zombie* zombieTarget; <span class="comment">// è¿è¡Œæ—¶ä½¿ç”¨çš„æŒ‡é’ˆ</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">serialize</span><span class="params">(json&amp; j)</span> </span>&#123;</span><br><span class="line">        j[<span class="string">&quot;id&quot;</span>] = <span class="built_in">getId</span>();</span><br><span class="line">        j[<span class="string">&quot;zombieTargetId&quot;</span>] = zombieTarget ? zombieTarget-&gt;<span class="built_in">getId</span>() : <span class="number">-1</span>;</span><br><span class="line">        <span class="comment">// å…¶ä»–å±æ€§...</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">deserialize</span><span class="params">(<span class="type">const</span> json&amp; j)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åŸºæœ¬å±æ€§ååºåˆ—åŒ–</span></span><br><span class="line">        zombieTargetId = j[<span class="string">&quot;zombieTargetId&quot;</span>];</span><br><span class="line">        <span class="comment">// æŒ‡é’ˆæš‚æ—¶ä¸è®¾ç½®ï¼Œç­‰æ‰€æœ‰å¯¹è±¡éƒ½åŠ è½½å®Œæˆåå†è§£æå¼•ç”¨å…³ç³»</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è§£æé˜¶æ®µäºŒï¼šé‡å»ºå¯¹è±¡å¼•ç”¨å…³ç³»</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">resolveReferences</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (zombieTargetId != <span class="number">-1</span>) &#123;</span><br><span class="line">            zombieTarget = <span class="built_in">dynamic_cast</span>&lt;Zombie*&gt;(GameObject::<span class="built_in">findById</span>(zombieTargetId));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>å®ä¾‹</strong>ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;nlohmann/json.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> json = nlohmann::json;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ==================== é€šç”¨çš„å¯¹è±¡ç®¡ç†å™¨ ====================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ObjectManager</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::map&lt;<span class="type">int</span>, std::shared_ptr&lt;T&gt;&gt; objects;</span><br><span class="line">    <span class="type">int</span> nextId = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// æ³¨å†Œå¯¹è±¡ï¼Œè¿”å› ID</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">registerObject</span><span class="params">(std::shared_ptr&lt;T&gt; obj)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> id = nextId++;</span><br><span class="line">        objects[id] = obj;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ ¹æ® ID æŸ¥æ‰¾å¯¹è±¡</span></span><br><span class="line">    <span class="function">std::shared_ptr&lt;T&gt; <span class="title">findById</span><span class="params">(<span class="type">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> it = objects.<span class="built_in">find</span>(id);</span><br><span class="line">        <span class="keyword">return</span> (it != objects.<span class="built_in">end</span>()) ? it-&gt;second : <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–æ‰€æœ‰å¯¹è±¡</span></span><br><span class="line">    <span class="type">const</span> std::map&lt;<span class="type">int</span>, std::shared_ptr&lt;T&gt;&gt;&amp; <span class="built_in">getAll</span>() <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> objects;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ¸…ç©º</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        objects.<span class="built_in">clear</span>();</span><br><span class="line">        nextId = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ==================== ç¤ºä¾‹ï¼šæ¤ç‰©å¤§æˆ˜åƒµå°¸ ====================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Zombie</span>;  <span class="comment">// å‰å‘å£°æ˜</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Plant</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    std::string name;</span><br><span class="line">    <span class="type">int</span> health;</span><br><span class="line">    <span class="type">int</span> targetZombieId;  <span class="comment">// å­˜å‚¨ç›®æ ‡ ID è€ŒéæŒ‡é’ˆ</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¿è¡Œæ—¶æŒ‡é’ˆï¼ˆä¸åºåˆ—åŒ–ï¼‰</span></span><br><span class="line">    std::shared_ptr&lt;Zombie&gt; targetZombie;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Plant</span>() : <span class="built_in">id</span>(<span class="number">0</span>), <span class="built_in">health</span>(<span class="number">100</span>), <span class="built_in">targetZombieId</span>(<span class="number">-1</span>) &#123;&#125;</span><br><span class="line">    <span class="built_in">Plant</span>(<span class="type">int</span> id, std::string name, <span class="type">int</span> hp) </span><br><span class="line">        : <span class="built_in">id</span>(id), <span class="built_in">name</span>(std::<span class="built_in">move</span>(name)), <span class="built_in">health</span>(hp), <span class="built_in">targetZombieId</span>(<span class="number">-1</span>) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getId</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> id; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setId</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123; id = i; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setTarget</span><span class="params">(<span class="type">int</span> zombieId)</span> </span>&#123; targetZombieId = zombieId; &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getTargetId</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> targetZombieId; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setTargetPtr</span><span class="params">(std::shared_ptr&lt;Zombie&gt; z)</span> </span>&#123; targetZombie = z; &#125;</span><br><span class="line">    <span class="function">std::shared_ptr&lt;Zombie&gt; <span class="title">getTargetPtr</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> targetZombie; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">getName</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> name; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åºåˆ—åŒ–</span></span><br><span class="line">    <span class="function"><span class="keyword">friend</span> <span class="type">void</span> <span class="title">to_json</span><span class="params">(json&amp; j, <span class="type">const</span> Plant&amp; p)</span> </span>&#123;</span><br><span class="line">        j[<span class="string">&quot;id&quot;</span>] = p.id;</span><br><span class="line">        j[<span class="string">&quot;name&quot;</span>] = p.name;</span><br><span class="line">        j[<span class="string">&quot;health&quot;</span>] = p.health;</span><br><span class="line">        j[<span class="string">&quot;target_zombie_id&quot;</span>] = p.targetZombieId;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">    <span class="function"><span class="keyword">friend</span> <span class="type">void</span> <span class="title">from_json</span><span class="params">(<span class="type">const</span> json&amp; j, Plant&amp; p)</span> </span>&#123;</span><br><span class="line">        p.id = j[<span class="string">&quot;id&quot;</span>];</span><br><span class="line">        p.name = j[<span class="string">&quot;name&quot;</span>];</span><br><span class="line">        p.health = j[<span class="string">&quot;health&quot;</span>];</span><br><span class="line">        p.targetZombieId = j[<span class="string">&quot;target_zombie_id&quot;</span>];</span><br><span class="line">        <span class="comment">// targetZombie æŒ‡é’ˆéœ€è¦åœ¨è§£æé˜¶æ®µäºŒè®¾ç½®</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Zombie</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    std::string type;</span><br><span class="line">    <span class="type">int</span> health;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Zombie</span>() : <span class="built_in">id</span>(<span class="number">0</span>), <span class="built_in">health</span>(<span class="number">200</span>) &#123;&#125;</span><br><span class="line">    <span class="built_in">Zombie</span>(<span class="type">int</span> id, std::string type, <span class="type">int</span> hp) </span><br><span class="line">        : <span class="built_in">id</span>(id), <span class="built_in">type</span>(std::<span class="built_in">move</span>(type)), <span class="built_in">health</span>(hp) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getId</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> id; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setId</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123; id = i; &#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">getType</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> type; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">friend</span> <span class="type">void</span> <span class="title">to_json</span><span class="params">(json&amp; j, <span class="type">const</span> Zombie&amp; z)</span> </span>&#123;</span><br><span class="line">        j[<span class="string">&quot;id&quot;</span>] = z.id;</span><br><span class="line">        j[<span class="string">&quot;type&quot;</span>] = z.type;</span><br><span class="line">        j[<span class="string">&quot;health&quot;</span>] = z.health;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">friend</span> <span class="type">void</span> <span class="title">from_json</span><span class="params">(<span class="type">const</span> json&amp; j, Zombie&amp; z)</span> </span>&#123;</span><br><span class="line">        z.id = j[<span class="string">&quot;id&quot;</span>];</span><br><span class="line">        z.type = j[<span class="string">&quot;type&quot;</span>];</span><br><span class="line">        z.health = j[<span class="string">&quot;health&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ==================== æ¸¸æˆå­˜æ¡£ç®¡ç†å™¨ ====================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GameSaveManager</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    ObjectManager&lt;Plant&gt; plantManager;</span><br><span class="line">    ObjectManager&lt;Zombie&gt; zombieManager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// æ·»åŠ å¯¹è±¡</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">addPlant</span><span class="params">(std::shared_ptr&lt;Plant&gt; p)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> id = plantManager.<span class="built_in">registerObject</span>(p);</span><br><span class="line">        p-&gt;<span class="built_in">setId</span>(id);</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">addZombie</span><span class="params">(std::shared_ptr&lt;Zombie&gt; z)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> id = zombieManager.<span class="built_in">registerObject</span>(z);</span><br><span class="line">        z-&gt;<span class="built_in">setId</span>(id);</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¾ç½®æ¤ç‰©çš„æ”»å‡»ç›®æ ‡</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setPlantTarget</span><span class="params">(<span class="type">int</span> plantId, <span class="type">int</span> zombieId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> plant = plantManager.<span class="built_in">findById</span>(plantId);</span><br><span class="line">        <span class="keyword">auto</span> zombie = zombieManager.<span class="built_in">findById</span>(zombieId);</span><br><span class="line">        <span class="keyword">if</span> (plant &amp;&amp; zombie) &#123;</span><br><span class="line">            plant-&gt;<span class="built_in">setTarget</span>(zombieId);</span><br><span class="line">            plant-&gt;<span class="built_in">setTargetPtr</span>(zombie);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åºåˆ—åŒ–æ•´ä¸ªæ¸¸æˆçŠ¶æ€</span></span><br><span class="line">    <span class="function">json <span class="title">serialize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        json j;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åºåˆ—åŒ–æ‰€æœ‰åƒµå°¸</span></span><br><span class="line">        j[<span class="string">&quot;zombies&quot;</span>] = json::<span class="built_in">array</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; [id, zombie] : zombieManager.<span class="built_in">getAll</span>()) &#123;</span><br><span class="line">            j[<span class="string">&quot;zombies&quot;</span>].<span class="built_in">push_back</span>(*zombie);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åºåˆ—åŒ–æ‰€æœ‰æ¤ç‰©</span></span><br><span class="line">        j[<span class="string">&quot;plants&quot;</span>] = json::<span class="built_in">array</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; [id, plant] : plantManager.<span class="built_in">getAll</span>()) &#123;</span><br><span class="line">            j[<span class="string">&quot;plants&quot;</span>].<span class="built_in">push_back</span>(*plant);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> j;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">deserialize</span><span class="params">(<span class="type">const</span> json&amp; j)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ¸…ç©ºç°æœ‰æ•°æ®</span></span><br><span class="line">        plantManager.<span class="built_in">clear</span>();</span><br><span class="line">        zombieManager.<span class="built_in">clear</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é˜¶æ®µä¸€ï¼šåˆ›å»ºæ‰€æœ‰å¯¹è±¡</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åŠ è½½åƒµå°¸</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; zj : j[<span class="string">&quot;zombies&quot;</span>]) &#123;</span><br><span class="line">            <span class="keyword">auto</span> zombie = std::<span class="built_in">make_shared</span>&lt;Zombie&gt;(zj.<span class="built_in">get</span>&lt;Zombie&gt;());</span><br><span class="line">            zombieManager.<span class="built_in">registerObject</span>(zombie);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åŠ è½½æ¤ç‰©</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; pj : j[<span class="string">&quot;plants&quot;</span>]) &#123;</span><br><span class="line">            <span class="keyword">auto</span> plant = std::<span class="built_in">make_shared</span>&lt;Plant&gt;(pj.<span class="built_in">get</span>&lt;Plant&gt;());</span><br><span class="line">            plantManager.<span class="built_in">registerObject</span>(plant);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é˜¶æ®µäºŒï¼šé‡å»ºå¼•ç”¨å…³ç³»</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; [id, plant] : plantManager.<span class="built_in">getAll</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> targetId = plant-&gt;<span class="built_in">getTargetId</span>();</span><br><span class="line">            <span class="keyword">if</span> (targetId != <span class="number">-1</span>) &#123;</span><br><span class="line">                <span class="keyword">auto</span> zombie = zombieManager.<span class="built_in">findById</span>(targetId);</span><br><span class="line">                plant-&gt;<span class="built_in">setTargetPtr</span>(zombie);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‰“å°çŠ¶æ€</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">printStatus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;=== æ¸¸æˆçŠ¶æ€ ===&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; [id, plant] : plantManager.<span class="built_in">getAll</span>()) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;æ¤ç‰© [&quot;</span> &lt;&lt; plant-&gt;<span class="built_in">getName</span>() &lt;&lt; <span class="string">&quot;] (ID:&quot;</span> &lt;&lt; id &lt;&lt; <span class="string">&quot;)&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">auto</span> target = plant-&gt;<span class="built_in">getTargetPtr</span>()) &#123;</span><br><span class="line">                std::cout &lt;&lt; <span class="string">&quot; â†’ æ”»å‡»ç›®æ ‡: &quot;</span> &lt;&lt; target-&gt;<span class="built_in">getType</span>() </span><br><span class="line">                          &lt;&lt; <span class="string">&quot; (ID:&quot;</span> &lt;&lt; target-&gt;<span class="built_in">getId</span>() &lt;&lt; <span class="string">&quot;)&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            std::cout &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; [id, zombie] : zombieManager.<span class="built_in">getAll</span>()) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;åƒµå°¸ [&quot;</span> &lt;&lt; zombie-&gt;<span class="built_in">getType</span>() &lt;&lt; <span class="string">&quot;] (ID:&quot;</span> &lt;&lt; id &lt;&lt; <span class="string">&quot;)&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    GameSaveManager game;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»ºæ¸¸æˆå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">auto</span> peashooter = std::<span class="built_in">make_shared</span>&lt;Plant&gt;(<span class="number">0</span>, <span class="string">&quot;è±Œè±†å°„æ‰‹&quot;</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="keyword">auto</span> sunflower = std::<span class="built_in">make_shared</span>&lt;Plant&gt;(<span class="number">0</span>, <span class="string">&quot;å‘æ—¥è‘µ&quot;</span>, <span class="number">80</span>);</span><br><span class="line">    <span class="keyword">auto</span> zombie1 = std::<span class="built_in">make_shared</span>&lt;Zombie&gt;(<span class="number">0</span>, <span class="string">&quot;æ™®é€šåƒµå°¸&quot;</span>, <span class="number">200</span>);</span><br><span class="line">    <span class="keyword">auto</span> zombie2 = std::<span class="built_in">make_shared</span>&lt;Zombie&gt;(<span class="number">0</span>, <span class="string">&quot;è·¯éšœåƒµå°¸&quot;</span>, <span class="number">300</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ³¨å†Œåˆ°ç®¡ç†å™¨</span></span><br><span class="line">    <span class="type">int</span> p1 = game.<span class="built_in">addPlant</span>(peashooter);</span><br><span class="line">    <span class="type">int</span> p2 = game.<span class="built_in">addPlant</span>(sunflower);</span><br><span class="line">    <span class="type">int</span> z1 = game.<span class="built_in">addZombie</span>(zombie1);</span><br><span class="line">    <span class="type">int</span> z2 = game.<span class="built_in">addZombie</span>(zombie2);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¾ç½®æ”»å‡»å…³ç³»</span></span><br><span class="line">    game.<span class="built_in">setPlantTarget</span>(p1, z1);  <span class="comment">// è±Œè±†å°„æ‰‹æ”»å‡»æ™®é€šåƒµå°¸</span></span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;========== ä¿å­˜å‰ ==========&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    game.<span class="built_in">printStatus</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åºåˆ—åŒ–</span></span><br><span class="line">    json save = game.<span class="built_in">serialize</span>();</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;\n========== JSON å­˜æ¡£ ==========\n&quot;</span> &lt;&lt; save.<span class="built_in">dump</span>(<span class="number">2</span>) &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ¨¡æ‹Ÿæ¸¸æˆé‡å¯ï¼šåˆ›å»ºæ–°çš„ç®¡ç†å™¨å¹¶åŠ è½½å­˜æ¡£</span></span><br><span class="line">    GameSaveManager newGame;</span><br><span class="line">    newGame.<span class="built_in">deserialize</span>(save);</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;\n========== åŠ è½½å ==========&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    newGame.<span class="built_in">printStatus</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">========== ä¿å­˜å‰ ==========</span><br><span class="line">=== æ¸¸æˆçŠ¶æ€ ===</span><br><span class="line">æ¤ç‰© [è±Œè±†å°„æ‰‹] (ID:<span class="number">1</span>) â†’ æ”»å‡»ç›®æ ‡: æ™®é€šåƒµå°¸ (ID:<span class="number">1</span>)</span><br><span class="line">æ¤ç‰© [å‘æ—¥è‘µ] (ID:<span class="number">2</span>)</span><br><span class="line">åƒµå°¸ [æ™®é€šåƒµå°¸] (ID:<span class="number">1</span>)</span><br><span class="line">åƒµå°¸ [è·¯éšœåƒµå°¸] (ID:<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">========== JSON å­˜æ¡£ ==========</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;plants&quot;</span>: [</span><br><span class="line">    &#123;<span class="string">&quot;health&quot;</span>: <span class="number">100</span>, <span class="string">&quot;id&quot;</span>: <span class="number">1</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;è±Œè±†å°„æ‰‹&quot;</span>, <span class="string">&quot;target_zombie_id&quot;</span>: <span class="number">1</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;health&quot;</span>: <span class="number">80</span>, <span class="string">&quot;id&quot;</span>: <span class="number">2</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;å‘æ—¥è‘µ&quot;</span>, <span class="string">&quot;target_zombie_id&quot;</span>: <span class="number">-1</span>&#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;zombies&quot;</span>: [</span><br><span class="line">    &#123;<span class="string">&quot;health&quot;</span>: <span class="number">200</span>, <span class="string">&quot;id&quot;</span>: <span class="number">1</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;æ™®é€šåƒµå°¸&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;health&quot;</span>: <span class="number">300</span>, <span class="string">&quot;id&quot;</span>: <span class="number">2</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;è·¯éšœåƒµå°¸&quot;</span>&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">========== åŠ è½½å ==========</span><br><span class="line">=== æ¸¸æˆçŠ¶æ€ ===</span><br><span class="line">æ¤ç‰© [è±Œè±†å°„æ‰‹] (ID:<span class="number">1</span>) â†’ æ”»å‡»ç›®æ ‡: æ™®é€šåƒµå°¸ (ID:<span class="number">1</span>)</span><br><span class="line">æ¤ç‰© [å‘æ—¥è‘µ] (ID:<span class="number">2</span>)</span><br><span class="line">åƒµå°¸ [æ™®é€šåƒµå°¸] (ID:<span class="number">1</span>)</span><br><span class="line">åƒµå°¸ [è·¯éšœåƒµå°¸] (ID:<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<h2 id="å¿«é€Ÿå‚è€ƒè¡¨">å¿«é€Ÿå‚è€ƒè¡¨</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260116000619101.png" alt=""></p>
]]></content>
      <categories>
        <category>C++</category>
        <category>C++åç«¯å¼€å‘åº“</category>
        <category>json</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>kafkaä½¿ç”¨æ•™ç¨‹</title>
    <url>/2026/01/15/C++/C++%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E5%B8%B8%E7%94%A8%E5%BA%93/kafka%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<h1>ä¸€ã€Kafkaä»‹ç»</h1>
<p>Kafka æ˜¯ä¸€æ¬¾åˆ†å¸ƒå¼ã€é«˜ååé‡ã€é«˜å¯é æ€§çš„<strong>åˆ†å¸ƒå¼äº‹ä»¶æµå¹³å°</strong>ï¼ˆåŸå®šä½ä¸ºï¼š<strong>åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼‰ï¼ŒåŸºäº<strong>å‘å¸ƒ/è®¢é˜…æ¨¡å¼</strong>ï¼Œä¸»è¦ç”¨äºå¤„ç†å®æ—¶æ•°æ®ç®¡é“ã€æµå¤„ç†ã€æ•°æ®é›†æˆç­‰åœºæ™¯ï¼Œèƒ½å¤Ÿé«˜æ•ˆåœ°æ”¶é›†ã€å­˜å‚¨å’Œåˆ†å‘å¤§è§„æ¨¡çš„å®æ—¶æ•°æ®æµã€‚<br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260115205205304.png" alt=""></p>
<h2 id="1-åº”ç”¨åœºæ™¯">1.åº”ç”¨åœºæ™¯</h2>
<ul>
<li><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼šæ›¿ä»£ä¼ ç»Ÿæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚ RabbitMQï¼‰ï¼Œå®ç°æœåŠ¡é—´çš„å¼‚æ­¥é€šä¿¡ã€è§£è€¦å’Œå‰Šå³°å¡«è°·ï¼ˆå¦‚ç§’æ€åœºæ™¯çš„æµé‡ç¼“å†²ï¼‰ã€‚</li>
<li><strong>å®æ—¶æ•°æ®ç®¡é“</strong>ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé—´æ„å»ºæ•°æ®ä¼ è¾“é€šé“ï¼Œå®ç°ä¸åŒç³»ç»Ÿï¼ˆå¦‚æ•°æ®åº“ã€ç¼“å­˜ã€ä¸šåŠ¡ç³»ç»Ÿï¼‰ä¹‹é—´çš„å®æ—¶æ•°æ®åŒæ­¥ã€‚</li>
<li><strong>æ—¥å¿—æ”¶é›†</strong>ï¼šé›†ä¸­æ”¶é›†åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ—¥å¿—æ•°æ®ï¼ˆå¦‚ ELK æ¶æ„ä¸­çš„æ—¥å¿—ä¼ è¾“ç¯èŠ‚ï¼‰ï¼Œä¾¿äºæ—¥å¿—åˆ†æå’Œæ•…éšœæ’æŸ¥ã€‚</li>
<li><strong>æµå¤„ç†</strong>ï¼šä½œä¸ºæµå¤„ç†æ¡†æ¶ï¼ˆå¦‚ Flinkã€Spark Streamingï¼‰çš„æ•°æ®æºå’Œæ•°æ®Sinkï¼Œæ”¯æ’‘å®æ—¶è®¡ç®—åœºæ™¯ï¼ˆå¦‚å®æ—¶ç›‘æ§ã€å®æ—¶æŠ¥è¡¨ã€é£æ§é¢„è­¦ï¼‰ã€‚</li>
<li><strong>äº‹ä»¶æº¯æº</strong>ï¼šè®°å½•ç³»ç»Ÿä¸­çš„å…³é”®äº‹ä»¶ï¼Œæ”¯æŒä¸šåŠ¡çŠ¶æ€å›æº¯å’Œå†å²æ•°æ®å®¡è®¡ã€‚</li>
</ul>
<h2 id="2-kafkaä½œä¸ºâ€œæ¶ˆæ¯é˜Ÿåˆ—â€">2.kafkaä½œä¸ºâ€œæ¶ˆæ¯é˜Ÿåˆ—â€</h2>
<h3 id="ï¼ˆ1ï¼‰ä¸ºä»€ä¹ˆéœ€è¦kafkaï¼Œå®ƒçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ">ï¼ˆ1ï¼‰ä¸ºä»€ä¹ˆéœ€è¦kafkaï¼Œå®ƒçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>ä¸‹é¢æˆ‘å°†ä»¥â€œ<strong>ç”¨æˆ·æ³¨å†Œåœºæ™¯</strong>â€ä¸ºä¾‹ï¼Œç®€è¦è®²è§£ä¸ºä»€ä¹ˆè¦å¼•å…¥kafkaä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ƒä½œä¸ºå·¥ä½œæµç¨‹çš„å“ªä¸€ä¸ªç¯èŠ‚ï¼Œå¦‚ä½•ä½¿ç”¨ã€‚</p>
<h4 id="1-å·¥ä½œæµç¨‹å›¾å¯¹æ¯”">&lt;1&gt;å·¥ä½œæµç¨‹å›¾å¯¹æ¯”</h4>
<ul>
<li>
<p><strong>1.æ²¡æœ‰ä½¿ç”¨Kafkaæˆ–ä»»ä½•ä»»åŠ¡é˜Ÿåˆ—çš„ä¼ ç»ŸåŒæ­¥å¤„ç†æµç¨‹å›¾</strong><br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260115161939911.png" alt=""></p>
</li>
<li>
<p><strong>2.ä½¿ç”¨kafkaçš„å¼‚æ­¥å¤„ç†æµç¨‹å›¾</strong><br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260115161159031.png" alt=""></p>
</li>
</ul>
<p><strong>çœ‹åˆ°è¿™ï¼Œæ•é”çš„äººå¯èƒ½æƒ³åˆ°ï¼šâ€œä¸ä½¿ç”¨kafkaï¼Œç”¨å¤šçº¿ç¨‹å¼‚æ­¥å¤„ç†ä¸æ˜¯ä¹Ÿå¯ä»¥å—ï¼Ÿâ€ æ˜¯çš„ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†ä½¿ç”¨kafkaæœ‰å¾ˆå¤šä¼˜åŠ¿ï¼Œè¿™ä¸ªä¹‹ååœ¨ä»‹ç»ã€‚</strong></p>
<h4 id="2-å®Œæ•´çš„æµç¨‹å¯¹æ¯”ï¼ˆåœºæ™¯ï¼šç”¨æˆ·æ³¨å†Œï¼‰">&lt;2&gt;å®Œæ•´çš„æµç¨‹å¯¹æ¯”ï¼ˆåœºæ™¯ï¼šç”¨æˆ·æ³¨å†Œï¼‰</h4>
<h5 id="1ï¼‰å‰æ™¯çŸ¥è¯†ä»‹ç»">1ï¼‰å‰æ™¯çŸ¥è¯†ä»‹ç»</h5>
<ul>
<li><strong>ç”¨æˆ·æ³¨å†Œçš„â€œæ ¸å¿ƒä¸šåŠ¡â€</strong>ï¼š
<ul>
<li>å‘æ•°æ®åº“ä¸­æ’å…¥æ–°æ³¨å†Œçš„ç”¨æˆ·ä¿¡æ¯ï¼ˆè¿™é‡Œå…¶å®å°±â€œæ³¨å†ŒæˆåŠŸäº†ï¼â€ï¼‰</li>
</ul>
</li>
<li><strong>ç”¨æˆ·æ³¨å†Œçš„â€œé™„åŠ ä¸šåŠ¡â€</strong>ï¼š
<ul>
<li>å‘é€é‚®ä»¶åˆ°æ³¨å†Œç”¨æˆ·çš„é‚®ç®±æç¤ºæ³¨å†ŒæˆåŠŸ</li>
<li>æ³¨å†ŒæˆåŠŸåï¼Œè¿”å›åå°æ•°æ®ç”¨äºæ¸²æŸ“å‰ç«¯é¡µé¢ï¼ˆå¦‚ï¼šç°å®ä¸­ä½ æ³¨å†ŒæˆåŠŸæ—¶ï¼Œæ˜¾ç¤ºâ€œ3s è·³è½¬é¡µé¢â€ï¼Œå°±æ˜¯å‰ç«¯åœ¨ç­‰å¾…åç«¯æ•°æ®è¿›è¡Œæ¸²æŸ“ï¼‰</li>
<li>ç»™ä½ ä¸€äº›â€œä¿¡æ¯æç¤ºâ€ï¼ˆå¦‚ï¼šåœ¨è´­ç‰©å¹³å°ï¼Œæç¤ºä½ æœ‰ä¼˜æƒ åˆ¸å¯é¢†ï¼‰</li>
<li>â€¦</li>
</ul>
</li>
<li>ä¸åŒå¹³å°/è½¯ä»¶ç”¨æˆ·æ³¨å†Œçš„â€œé™„åŠ ä¸šåŠ¡â€å„æœ‰ä¸åŒï¼Œå•â€œæ ¸å¿ƒä¸šåŠ¡â€éƒ½æ˜¯åœ¨â€œå‘æ•°æ®åº“æ’å…¥æ–°æ³¨å†Œç”¨æˆ·çš„ä¿¡æ¯â€ï¼Œæ’å…¥æˆåŠŸå…¶å®å°±ä»£è¡¨â€œæ³¨å†ŒæˆåŠŸâ€äº†ï¼Œâ€œé™„åŠ ä¸šåŠ¡â€å³ä½¿æ²¡æœ‰ä¹Ÿå¯ä»¥ã€‚</li>
</ul>
<h5 id="2-æ²¡æœ‰Kafkaï¼ˆä¼ ç»ŸåŒæ­¥ï¼‰">2)æ²¡æœ‰Kafkaï¼ˆä¼ ç»ŸåŒæ­¥ï¼‰</h5>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260115163026489.png" alt=""><br>
<strong>é—®é¢˜</strong>ï¼š</p>
<ul>
<li>âŒ ç”¨æˆ·ç­‰å¾… 3+ ç§’æ‰çœ‹åˆ°å“åº”ï¼ˆå»¶è¿Ÿé«˜ï¼‰</li>
<li>âŒ ä»»ä¸€ä¸ªç¯èŠ‚å‡ºç°é—®é¢˜ï¼ˆå¦‚ï¼šé‚®ä»¶æœåŠ¡æŒ‚äº†ï¼‰ï¼Œæ³¨å†Œå¤±è´¥ï¼ˆå¯é æ€§è¾ƒä½ï¼‰</li>
<li>âŒ é«˜å¹¶å‘æ—¶ï¼Œçº¿ç¨‹å…¨éƒ¨é˜»å¡â€œé™„åŠ ä¸šåŠ¡â€ä¸Šï¼Œâ€œé™„åŠ ä¸šåŠ¡â€æ˜¯ä¸»è¦çš„â€œæ€§èƒ½ç“¶é¢ˆâ€</li>
</ul>
<p><strong>å†æ¬¡æç¤º</strong>ï¼šè¿™é‡Œè™½ç„¶ä¹Ÿå¯ä»¥å°†â€œé™„åŠ ä¸šåŠ¡â€å†æ¬¡ç”¨å¼‚æ­¥çº¿ç¨‹å¤„ç†ï¼Œä½†æˆ‘ä»¬å…ˆä¸è®¨è®ºå®ƒã€‚</p>
<h5 id="3-æœ‰-Kafkaï¼ˆå¼‚æ­¥è§£è€¦ï¼‰">3)æœ‰ Kafkaï¼ˆå¼‚æ­¥è§£è€¦ï¼‰</h5>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260115164615280.png" alt=""><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260115164736803.png" alt=""></p>
<p><a id="P1"></a></p>
<h4 id="3-åå°æœåŠ¡å™¨ã€kafkaã€åå°ä»»åŠ¡æœåŠ¡-ä¸‰è€…çš„å…³ç³»">&lt;3&gt;åå°æœåŠ¡å™¨ã€kafkaã€åå°ä»»åŠ¡æœåŠ¡ ä¸‰è€…çš„å…³ç³»</h4>
<ul>
<li><strong>ç±»æ¯”è¿›ç¨‹æ± </strong>ï¼š
<ul>
<li><strong>åå°æœåŠ¡å™¨</strong> â€”â€”&gt; <strong>masterè¿›ç¨‹</strong></li>
<li><strong>kafka</strong>	â€”â€”&gt; <strong>ä»»åŠ¡é˜Ÿåˆ—</strong></li>
<li><strong>åå°ä»»åŠ¡æœåŠ¡</strong> â€”â€”&gt; <strong>workerå·¥ä½œè¿›ç¨‹</strong></li>
</ul>
</li>
<li>å®¢æˆ·ç«¯å‘é€è¯·æ±‚åˆ°è¾¾â€œåå°æœåŠ¡å™¨â€ï¼ˆç±»æ¯”masterè¿›ç¨‹ï¼‰æ—¶ï¼Œåå°æœåŠ¡å™¨å®Œæˆâ€œæ ¸å¿ƒä¸šåŠ¡â€ï¼ˆå¦‚ï¼šå°†æ–°ç”¨æˆ·æ•°æ®æ’å…¥æ•°æ®åº“ï¼‰ï¼Œå¹¶å°†â€œé™„åŠ ä¸šåŠ¡â€è¯·æ±‚ï¼ˆé«˜è€—æ—¶ï¼‰å‘é€åˆ°kafkaæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆç±»æ¯”ä»»åŠ¡é˜Ÿåˆ—ï¼‰ä¸­ï¼Œç„¶åç«‹å³å‘å‰ç«¯å›å¤æ‰§è¡Œç»“æœã€‚â€œåå°ä»»åŠ¡æœåŠ¡â€ï¼ˆç±»æ¯”workerè¿›ç¨‹ï¼‰åˆ™ä¸æ–­ä»kafkaçš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å‡ºâ€œé™„åŠ ä¸šåŠ¡â€è¯·æ±‚è¿›è¡Œå¤„ç†
<ul>
<li><strong>è§£è€¦äº†â€œæ ¸å¿ƒä¸šåŠ¡â€ä¸â€œé™„åŠ ä¸šåŠ¡â€ï¼Œä»è€Œä½¿â€œåå°æœåŠ¡å™¨â€å¯ä»¥å¿«é€Ÿå“åº”å‰ç«¯è¯·æ±‚</strong></li>
</ul>
</li>
</ul>
<h4 id="4-â€œkafkaæ¶ˆæ¯é˜Ÿåˆ—â€-vs-â€œè¿›ç¨‹æ± -çº¿ç¨‹æ± â€">&lt;4&gt;â€œkafkaæ¶ˆæ¯é˜Ÿåˆ—â€ vs â€œè¿›ç¨‹æ± /çº¿ç¨‹æ± â€</h4>
<p>ä»å‰é¢å¯ä»¥çŸ¥é“ï¼Œä½¿ç”¨kafkaçš„æ¨¡å¼ä¸Reactoræ¨¡å¼å¾ˆåƒï¼Œä½†kafkaæ¨¡å¼æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼š<br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260115204712186.png" alt=""></p>
<h1>äºŒã€kafka æ ¸å¿ƒæ¦‚å¿µ</h1>
<p><strong>æ¨èé˜…è¯»ã€ŠApache Kafkaå®æˆ˜ã€‹äº†è§£è¯¦æƒ…</strong><br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260115213709054.png" alt=""><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260115213729718.png" alt=""></p>
<p><strong>messageæ ¼å¼</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚                            æ¶ˆæ¯å¤´éƒ¨ (message header)                      â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚ CRC    â”‚ç‰ˆæœ¬å· â”‚ å±æ€§ â”‚ æ—¶é—´æˆ³   â”‚ Key é•¿åº¦ â”‚ Key     â”‚ Value é•¿åº¦â”‚ Value   â”‚</span><br><span class="line">â”‚ 4B     â”‚ 1B   â”‚ 1B   â”‚ 8B       â”‚ 4B       â”‚ k bytes â”‚ 4B       â”‚ v bytes â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>key</strong>ï¼šæ¶ˆæ¯é”®ï¼Œåœ¨å¯¹æ¶ˆæ¯è¿›è¡Œpartitionæ—¶ä½¿ç”¨ â€”â€”&gt;å†³å®šæ¶ˆæ¯è¢«å­˜å‚¨åœ¨ è¯¥ Topic çš„å“ªä¸ª Partitionã€‚</li>
<li><strong>Value</strong>ï¼šæ¶ˆæ¯ä½“ï¼Œæ¶ˆæ¯çš„å®é™…æ•°æ®ã€‚</li>
<li><strong>Timestamp</strong>ï¼šæ¶ˆæ¯å‘é€æ—¶é—´æˆ³ã€‚</li>
<li>æ¯ä¸ªæ¶ˆæ¯ç”± <strong>&lt;topic,partition,offset&gt;ä¸‰å…ƒç»„ å”¯ä¸€æ ‡è¯†</strong></li>
</ul>
<h1>ä¸‰ã€librdkafkaçš„ä½¿ç”¨ï¼ˆC++ 2.13.0ï¼‰</h1>
<h2 id="1-Producer-ä¸-Consumer-ä½¿ç”¨æ¦‚è¿°">1.Producer ä¸ Consumer ä½¿ç”¨æ¦‚è¿°</h2>
<h3 id="ï¼ˆ1ï¼‰Producerã€kafkaæœåŠ¡å™¨ã€Consumerä¸‰è€…çš„å…³ç³»">ï¼ˆ1ï¼‰Producerã€kafkaæœåŠ¡å™¨ã€Consumerä¸‰è€…çš„å…³ç³»</h3>
<ul>
<li><strong>Producer</strong>ï¼ˆæ¶ˆæ¯ç”Ÿäº§è€…ï¼‰ï¼š
<ul>
<li><strong>åå°æœåŠ¡å™¨</strong> è¿æ¥ kafkaæœåŠ¡å™¨çš„å¥æŸ„ â€”â€”&gt;æ ¹æ® â€œtopic,partitionâ€ å‘kafkaæœåŠ¡å™¨ä¸­å†™å…¥æ¶ˆæ¯</li>
</ul>
</li>
<li><strong>Consumer</strong>ï¼ˆæ¶ˆæ¯æ¶ˆè´¹è€…ï¼‰ï¼š
<ul>
<li><strong>åå°ä»»åŠ¡æœåŠ¡</strong> è¿æ¥ kafkaæœåŠ¡å™¨çš„å¥æŸ„ â€”â€”&gt; æ ¹æ® â€œ&lt;topic,partition,offset&gt;â€ ä»kafkaä¸­æ¶ˆè´¹æ¶ˆæ¯</li>
</ul>
</li>
<li>æ— è®ºæ˜¯<strong>Producer</strong>è¿˜æ˜¯<strong>Consumer</strong>ï¼Œéƒ½æ˜¯<strong>kafkaçš„å®¢æˆ·ç«¯</strong>ï¼Œkafkaçš„æœåŠ¡å™¨æ˜¯ä¸¤è€…çš„ä¸­ä»‹</li>
</ul>
<p><strong>å¦‚æœå¯¹â€œåå°æœåŠ¡å™¨â€ã€â€œåå°ä»»åŠ¡æœåŠ¡â€ä¸äº†è§£</strong>ï¼Œå‚è€ƒ<a href="#P1">åå°æœåŠ¡å™¨ã€kafkaã€åå°ä»»åŠ¡æœåŠ¡ ä¸‰è€…çš„å…³ç³»</a></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚                          Kafka æ¶æ„è§’è‰²                                  â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚                                                                         â”‚</span><br><span class="line">â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚</span><br><span class="line">â”‚   â”‚    Producer     â”‚                         â”‚    Consumer     â”‚      â”‚</span><br><span class="line">â”‚   â”‚   (æ¶ˆæ¯ç”Ÿäº§è€…)   â”‚                         â”‚   (æ¶ˆæ¯æ¶ˆè´¹è€…)   â”‚      â”‚</span><br><span class="line">â”‚   â”‚                 â”‚                         â”‚                 â”‚      â”‚</span><br><span class="line">â”‚   â”‚  åå°æœåŠ¡å™¨     â”‚                         â”‚  åå°ä»»åŠ¡æœåŠ¡    â”‚      â”‚</span><br><span class="line">â”‚   â”‚  è¿æ¥ Kafka å¥æŸ„ â”‚                         â”‚  è¿æ¥ Kafka å¥æŸ„ â”‚      â”‚</span><br><span class="line">â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â””â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚</span><br><span class="line">â”‚            â”‚                                           â”‚               â”‚</span><br><span class="line">â”‚            â”‚  å†™å…¥æ¶ˆæ¯                        æ¶ˆè´¹æ¶ˆæ¯  â”‚               â”‚</span><br><span class="line">â”‚            â”‚  &lt;topic, partition&gt;    &lt;topic, partition, offset&gt;         â”‚</span><br><span class="line">â”‚            â”‚                                           â”‚               â”‚</span><br><span class="line">â”‚            â–¼                                           â”‚               â”‚</span><br><span class="line">â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚</span><br><span class="line">â”‚   â”‚                      Kafka Server                           â”‚      â”‚</span><br><span class="line">â”‚   â”‚                       (ä¸­ä»‹/Broker)                          â”‚      â”‚</span><br><span class="line">â”‚   â”‚                                                             â”‚      â”‚</span><br><span class="line">â”‚   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚      â”‚</span><br><span class="line">â”‚   â”‚    â”‚ Topic A â”‚    â”‚ Topic B â”‚    â”‚ Topic C â”‚    ...        â”‚      â”‚</span><br><span class="line">â”‚   â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â” â”‚               â”‚      â”‚</span><br><span class="line">â”‚   â”‚    â”‚ â”‚ P0  â”‚ â”‚    â”‚ â”‚ P0  â”‚ â”‚    â”‚ â”‚ P0  â”‚ â”‚               â”‚      â”‚</span><br><span class="line">â”‚   â”‚    â”‚ â”‚ P1  â”‚ â”‚    â”‚ â”‚ P1  â”‚ â”‚    â”‚ â”‚ P1  â”‚ â”‚               â”‚      â”‚</span><br><span class="line">â”‚   â”‚    â”‚ â”‚ P2  â”‚ â”‚    â”‚ â”‚ P2  â”‚ â”‚    â”‚ â”‚ P2  â”‚ â”‚               â”‚      â”‚</span><br><span class="line">â”‚   â”‚    â”‚ â””â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”˜ â”‚               â”‚      â”‚</span><br><span class="line">â”‚   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚      â”‚</span><br><span class="line">â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚</span><br><span class="line">â”‚                                                                         â”‚</span><br><span class="line">â”‚   â€» Producer å’Œ Consumer éƒ½æ˜¯ Kafka çš„å®¢æˆ·ç«¯                           â”‚</span><br><span class="line">â”‚                                                                         â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚   Producer   â”‚  â”€â”€â”€â”€â–º  â”‚    Kafka     â”‚  â”€â”€â”€â”€â–º  â”‚   Consumer   â”‚</span><br><span class="line">â”‚  (åå°æœåŠ¡å™¨) â”‚  å†™å…¥    â”‚   Server     â”‚  æ¶ˆè´¹    â”‚ (åå°ä»»åŠ¡æœåŠ¡) â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   (Broker)   â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">                         </span><br><span class="line">å†™å…¥å®šä½ï¼štopic + partition</span><br><span class="line">æ¶ˆè´¹å®šä½ï¼štopic + partition + offset</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ1ï¼‰ç±»å±‚æ¬¡æ€»è§ˆ">ï¼ˆ1ï¼‰ç±»å±‚æ¬¡æ€»è§ˆ</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚                        librdkafka C++ ç±»å±‚æ¬¡ç»“æ„                             â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚                                                                             â”‚</span><br><span class="line">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚</span><br><span class="line">â”‚  â”‚                         åŸºç¡€é…ç½®å±‚                                   â”‚   â”‚</span><br><span class="line">â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚</span><br><span class="line">â”‚  â”‚   â”‚  Conf  â”‚    â”‚  TopicPartition â”‚    â”‚      Headers        â”‚     â”‚   â”‚</span><br><span class="line">â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚</span><br><span class="line">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚</span><br><span class="line">â”‚                                    â”‚                                        â”‚</span><br><span class="line">â”‚                                    â–¼                                        â”‚</span><br><span class="line">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚</span><br><span class="line">â”‚  â”‚                          æ ¸å¿ƒå¥æŸ„å±‚                                  â”‚   â”‚</span><br><span class="line">â”‚  â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚   â”‚</span><br><span class="line">â”‚  â”‚                      â”‚    Handle    â”‚ (æŠ½è±¡åŸºç±»)                    â”‚   â”‚</span><br><span class="line">â”‚  â”‚                      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚   â”‚</span><br><span class="line">â”‚  â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚   â”‚</span><br><span class="line">â”‚  â”‚               â–¼                           â–¼                         â”‚   â”‚</span><br><span class="line">â”‚  â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚   â”‚</span><br><span class="line">â”‚  â”‚        â”‚   Producer   â”‚           â”‚ KafkaConsumer â”‚                 â”‚   â”‚</span><br><span class="line">â”‚  â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚   â”‚</span><br><span class="line">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚</span><br><span class="line">â”‚                                    â”‚                                        â”‚</span><br><span class="line">â”‚                                    â–¼                                        â”‚</span><br><span class="line">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚</span><br><span class="line">â”‚  â”‚                          æ¶ˆæ¯æ•°æ®å±‚                                  â”‚   â”‚</span><br><span class="line">â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚</span><br><span class="line">â”‚  â”‚   â”‚ Message  â”‚    â”‚ MessageTimestamp â”‚    â”‚       Error        â”‚   â”‚   â”‚</span><br><span class="line">â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚</span><br><span class="line">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚</span><br><span class="line">â”‚                                    â”‚                                        â”‚</span><br><span class="line">â”‚                                    â–¼                                        â”‚</span><br><span class="line">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚</span><br><span class="line">â”‚  â”‚                          å›è°ƒæ¥å£å±‚                                  â”‚   â”‚</span><br><span class="line">â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚</span><br><span class="line">â”‚  â”‚  â”‚DeliveryReportCb â”‚ â”‚ RebalanceCb â”‚ â”‚OffsetCommit â”‚ â”‚  EventCb  â”‚ â”‚   â”‚</span><br><span class="line">â”‚  â”‚  â”‚                 â”‚ â”‚             â”‚ â”‚     Cb      â”‚ â”‚           â”‚ â”‚   â”‚</span><br><span class="line">â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚</span><br><span class="line">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚</span><br><span class="line">â”‚                                    â”‚                                        â”‚</span><br><span class="line">â”‚                                    â–¼                                        â”‚</span><br><span class="line">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚</span><br><span class="line">â”‚  â”‚                          é«˜çº§åŠŸèƒ½å±‚                                  â”‚   â”‚</span><br><span class="line">â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚</span><br><span class="line">â”‚  â”‚   â”‚ Metadata â”‚    â”‚  Queue   â”‚    â”‚  Topic   â”‚    â”‚ AdminClient â”‚  â”‚   â”‚</span><br><span class="line">â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚</span><br><span class="line">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚</span><br><span class="line">â”‚                                                                             â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰Producerçš„ä½¿ç”¨æµç¨‹å›¾">ï¼ˆ2ï¼‰Producerçš„ä½¿ç”¨æµç¨‹å›¾</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚                         åˆå§‹åŒ–é˜¶æ®µ                                       â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚                                                                         â”‚</span><br><span class="line">â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚</span><br><span class="line">â”‚   â”‚    åˆ›å»º Conf      â”‚â”€â”€â”€â†’â”‚    è®¾ç½®å‚æ•°       â”‚â”€â”€â”€â†’â”‚   æ³¨å†Œå›è°ƒ     â”‚ â”‚</span><br><span class="line">â”‚   â”‚   (å…¨å±€é…ç½®)      â”‚    â”‚  bootstrap.serversâ”‚    â”‚                â”‚ â”‚</span><br><span class="line">â”‚   â”‚                   â”‚    â”‚  acks, retries ç­‰ â”‚    â”‚ DeliveryReport â”‚ â”‚</span><br><span class="line">â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚      Cb        â”‚ â”‚</span><br><span class="line">â”‚   â”‚ â”‚  <span class="built_in">Conf</span> (GLOBAL)â”‚ â”‚                             â”‚    EventCb     â”‚ â”‚</span><br><span class="line">â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                             â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚</span><br><span class="line">â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚          â”‚</span><br><span class="line">â”‚                                                             â–¼          â”‚</span><br><span class="line">â”‚                                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚</span><br><span class="line">â”‚                                                 â”‚  åˆ›å»º Producer    â”‚  â”‚</span><br><span class="line">â”‚                                                 â”‚ Producer::<span class="built_in">create</span>()â”‚  â”‚</span><br><span class="line">â”‚                                                 â”‚                   â”‚  â”‚</span><br><span class="line">â”‚                                                 â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚</span><br><span class="line">â”‚                                                 â”‚ â”‚   Producer    â”‚ â”‚  â”‚</span><br><span class="line">â”‚                                                 â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚</span><br><span class="line">â”‚                                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">                                                            â”‚</span><br><span class="line">                                                            â–¼</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚                         ç”Ÿäº§é˜¶æ®µï¼ˆå¾ªç¯ï¼‰                                  â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚                                                                         â”‚</span><br><span class="line">â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚</span><br><span class="line">â”‚   â”‚    æ„é€ æ¶ˆæ¯       â”‚â”€â”€â”€â†’â”‚    <span class="built_in">produce</span>()      â”‚â”€â”€â”€â†’â”‚    <span class="built_in">poll</span>()      â”‚ â”‚</span><br><span class="line">â”‚   â”‚  topic/key/value  â”‚    â”‚   æ”¾å…¥å†…éƒ¨é˜Ÿåˆ—    â”‚    â”‚   è§¦å‘å›è°ƒ     â”‚ â”‚</span><br><span class="line">â”‚   â”‚                   â”‚    â”‚                   â”‚    â”‚   å¤„ç†äº‹ä»¶     â”‚ â”‚</span><br><span class="line">â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚</span><br><span class="line">â”‚   â”‚ â”‚    Topic      â”‚ â”‚    â”‚ â”‚   Producer    â”‚ â”‚            â”‚        â—„â”€â”</span><br><span class="line">â”‚   â”‚ â”‚    Headers    â”‚ â”‚    â”‚ â”‚   ::<span class="built_in">produce</span>() â”‚ â”‚            â”‚          â”‚</span><br><span class="line">â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚            â”‚          â”‚</span><br><span class="line">â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚          â”‚</span><br><span class="line">â”‚                                                             â”‚          â”‚</span><br><span class="line">â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚</span><br><span class="line">â”‚            â”‚                                                           â”‚</span><br><span class="line">â”‚            â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚</span><br><span class="line">â”‚            â”‚    â”‚  å›è°ƒè§¦å‘æ—¶æ¶‰åŠçš„ç±»ï¼š                    â”‚            â”‚</span><br><span class="line">â”‚            â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚            â”‚</span><br><span class="line">â”‚            â”‚    â”‚  â”‚ Message â”‚  â”‚  Event  â”‚  â”‚ErrorCodeâ”‚  â”‚            â”‚</span><br><span class="line">â”‚            â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚            â”‚</span><br><span class="line">â”‚            â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚</span><br><span class="line">â”‚            â”‚                                                           â”‚</span><br><span class="line">â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">â”‚                                            (æŒç»­ç”Ÿäº§åˆ™å¾ªç¯)              â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">                                                            â”‚</span><br><span class="line">                                                            â–¼</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚                         æ¸…ç†é˜¶æ®µ                                         â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚                                                                         â”‚</span><br><span class="line">â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚</span><br><span class="line">â”‚   â”‚     <span class="built_in">flush</span>()       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  <span class="keyword">delete</span> producer  â”‚                  â”‚</span><br><span class="line">â”‚   â”‚   ç­‰å¾…é˜Ÿåˆ—æ¸…ç©º    â”‚         â”‚                   â”‚                  â”‚</span><br><span class="line">â”‚   â”‚                   â”‚         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                  â”‚</span><br><span class="line">â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚         â”‚ â”‚   Producer    â”‚ â”‚                  â”‚</span><br><span class="line">â”‚   â”‚ â”‚   Producer    â”‚ â”‚         â”‚ â”‚   (é”€æ¯)      â”‚ â”‚                  â”‚</span><br><span class="line">â”‚   â”‚ â”‚   ::<span class="built_in">flush</span>()   â”‚ â”‚         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                  â”‚</span><br><span class="line">â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚</span><br><span class="line">â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚</span><br><span class="line">â”‚                                                                         â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰Consumerçš„ä½¿ç”¨æµç¨‹å›¾">ï¼ˆ3ï¼‰Consumerçš„ä½¿ç”¨æµç¨‹å›¾</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚                         åˆå§‹åŒ–é˜¶æ®µ                                       â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚                                                                         â”‚</span><br><span class="line">â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚</span><br><span class="line">â”‚   â”‚    åˆ›å»º Conf      â”‚â”€â”€â”€â†’â”‚    è®¾ç½®å‚æ•°       â”‚â”€â”€â”€â†’â”‚   æ³¨å†Œå›è°ƒ     â”‚ â”‚</span><br><span class="line">â”‚   â”‚   (å…¨å±€é…ç½®)      â”‚    â”‚  bootstrap.serversâ”‚    â”‚                â”‚ â”‚</span><br><span class="line">â”‚   â”‚                   â”‚    â”‚  group.<span class="built_in">id</span> (å¿…éœ€)  â”‚    â”‚  RebalanceCb   â”‚ â”‚</span><br><span class="line">â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚  <span class="keyword">auto</span>.offset.resetâ”‚    â”‚OffsetCommitCb  â”‚ â”‚</span><br><span class="line">â”‚   â”‚ â”‚  <span class="built_in">Conf</span> (GLOBAL)â”‚ â”‚    â”‚  enable.<span class="keyword">auto</span>.     â”‚    â”‚    EventCb     â”‚ â”‚</span><br><span class="line">â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚      commit ç­‰    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚</span><br><span class="line">â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚          â”‚</span><br><span class="line">â”‚                                                             â–¼          â”‚</span><br><span class="line">â”‚                                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚</span><br><span class="line">â”‚                                                 â”‚ åˆ›å»º KafkaConsumerâ”‚  â”‚</span><br><span class="line">â”‚                                                 â”‚ KafkaConsumer::   â”‚  â”‚</span><br><span class="line">â”‚                                                 â”‚    <span class="built_in">create</span>()       â”‚  â”‚</span><br><span class="line">â”‚                                                 â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚</span><br><span class="line">â”‚                                                 â”‚ â”‚ KafkaConsumer â”‚ â”‚  â”‚</span><br><span class="line">â”‚                                                 â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚</span><br><span class="line">â”‚                                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">                                                            â”‚</span><br><span class="line">                                                            â–¼</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚                         è®¢é˜…é˜¶æ®µ                                         â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚                                                                         â”‚</span><br><span class="line">â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚</span><br><span class="line">â”‚   â”‚                       ä¸¤ç§è®¢é˜…æ–¹å¼ï¼ˆäºŒé€‰ä¸€ï¼‰                      |  |</span><br><span class="line">    |               ç”¨äºç¡®å®šä»å“ªä¸ªï¼ˆtopicï¼Œpartitionï¼‰è·å–æ¶ˆæ¯           â”‚  â”‚</span><br><span class="line">â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚</span><br><span class="line">â”‚   â”‚                                 â”‚                               â”‚  â”‚</span><br><span class="line">â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚</span><br><span class="line">â”‚   â”‚   â”‚    <span class="built_in">subscribe</span>()        â”‚     â”‚     â”‚    <span class="built_in">assign</span>()           â”‚ â”‚  â”‚</span><br><span class="line">â”‚   â”‚   â”‚    è®¢é˜…ä¸»é¢˜åˆ—è¡¨       â”‚     â”‚     â”‚    æ‰‹åŠ¨åˆ†é…åˆ†åŒº       â”‚ â”‚  â”‚</span><br><span class="line">â”‚   â”‚   â”‚                       â”‚     â”‚     â”‚                       â”‚ â”‚  â”‚</span><br><span class="line">â”‚   â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚  â”‚</span><br><span class="line">â”‚   â”‚   â”‚ â”‚ vector&lt;string&gt;    â”‚ â”‚     â”‚     â”‚ â”‚ TopicPartition    â”‚ â”‚ â”‚  â”‚</span><br><span class="line">â”‚   â”‚   â”‚ â”‚ &#123;<span class="string">&quot;topic1&quot;</span>,<span class="string">&quot;topic2&quot;</span>&#125;â”‚ â”‚     â”‚     â”‚ â”‚ (topic, partition)â”‚ â”‚ â”‚  â”‚</span><br><span class="line">â”‚   â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚  â”‚</span><br><span class="line">â”‚   â”‚   â”‚                       â”‚     â”‚     â”‚                       â”‚ â”‚  â”‚</span><br><span class="line">â”‚   â”‚   â”‚ âœ“ è‡ªåŠ¨è´Ÿè½½å‡è¡¡       â”‚     â”‚     â”‚ âœ— æ— è‡ªåŠ¨è´Ÿè½½å‡è¡¡     â”‚ â”‚  â”‚</span><br><span class="line">â”‚   â”‚   â”‚ âœ“ è§¦å‘ RebalanceCb   â”‚     â”‚     â”‚ âœ— ä¸è§¦å‘ RebalanceCb â”‚ â”‚  â”‚</span><br><span class="line">â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚</span><br><span class="line">â”‚   â”‚                                 â”‚                               â”‚  â”‚</span><br><span class="line">â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚</span><br><span class="line">â”‚                                                                         â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">                                                            â”‚</span><br><span class="line">                                                            â–¼</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚                         æ¶ˆè´¹é˜¶æ®µï¼ˆå¾ªç¯ï¼‰                                  â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚                                                                         â”‚</span><br><span class="line">â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚</span><br><span class="line">â”‚   â”‚    <span class="built_in">consume</span>()      â”‚â”€â”€â”€â†’â”‚    å¤„ç†æ¶ˆæ¯       â”‚â”€â”€â”€â†’â”‚   æäº¤ offset  â”‚ â”‚</span><br><span class="line">â”‚   â”‚   æ‹‰å–æ¶ˆæ¯(é˜»å¡)  â”‚    â”‚   ä¸šåŠ¡é€»è¾‘å¤„ç†    â”‚    â”‚  (å¯é€‰æ‰‹åŠ¨)    â”‚ â”‚</span><br><span class="line">â”‚   â”‚                   â”‚    â”‚                   â”‚    â”‚ ç”¨äºç¡®å®šä¸‹æ¬¡è¯»å–çš„ä½ç½®â”‚ â”‚</span><br><span class="line">â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚</span><br><span class="line">â”‚   â”‚ â”‚ KafkaConsumer â”‚ â”‚    â”‚ â”‚    Message    â”‚ â”‚    â”‚ â”‚<span class="built_in">commitSync</span>()â”‚ â”‚ â”‚</span><br><span class="line">â”‚   â”‚ â”‚  ::<span class="built_in">consume</span>()  â”‚ â”‚    â”‚ â”‚  (è¿”å›æ¶ˆæ¯)   â”‚ â”‚    â”‚ â”‚   æˆ–       â”‚ â”‚ â”‚</span><br><span class="line">â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â”‚commitAsyncâ”‚ â”‚ â”‚</span><br><span class="line">â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚</span><br><span class="line">â”‚            â–²                                        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚</span><br><span class="line">â”‚            â”‚                                                â”‚          â”‚</span><br><span class="line">â”‚            â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚</span><br><span class="line">â”‚            â”‚         â”‚                                                 â”‚</span><br><span class="line">â”‚            â”‚         â–¼                                                 â”‚</span><br><span class="line">â”‚            â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚</span><br><span class="line">â”‚            â”‚    â”‚  æ¶ˆè´¹è¿‡ç¨‹ä¸­æ¶‰åŠçš„ç±»ï¼š                             â”‚   â”‚</span><br><span class="line">â”‚            â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚</span><br><span class="line">â”‚            â”‚    â”‚  â”‚ Message â”‚  â”‚TopicPartition â”‚  â”‚  Headers  â”‚  â”‚   â”‚</span><br><span class="line">â”‚            â”‚    â”‚  â”‚ payload â”‚  â”‚ offset ç®¡ç†   â”‚  â”‚ (æ¶ˆæ¯å¤´)  â”‚  â”‚   â”‚</span><br><span class="line">â”‚            â”‚    â”‚  â”‚ key     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚</span><br><span class="line">â”‚            â”‚    â”‚  â”‚ offset  â”‚                                    â”‚   â”‚</span><br><span class="line">â”‚            â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚   â”‚</span><br><span class="line">â”‚            â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚</span><br><span class="line">â”‚            â”‚                                                           â”‚</span><br><span class="line">â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">â”‚                                            (æŒç»­æ¶ˆè´¹åˆ™å¾ªç¯)              â”‚</span><br><span class="line">â”‚                                                                         â”‚</span><br><span class="line">â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚</span><br><span class="line">â”‚   â”‚                    é‡å¹³è¡¡è§¦å‘æ—¶                                   â”‚  â”‚</span><br><span class="line">â”‚   â”‚                                                                  â”‚  â”‚</span><br><span class="line">â”‚   â”‚   æ¶ˆè´¹è€…åŠ å…¥/ç¦»å¼€ç»„ â”€â”€â”€â†’ RebalanceCb è§¦å‘ â”€â”€â”€â†’ é‡æ–°åˆ†é…åˆ†åŒº     â”‚  â”‚</span><br><span class="line">â”‚   â”‚                                                                  â”‚  â”‚</span><br><span class="line">â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚</span><br><span class="line">â”‚   â”‚   â”‚  ERR__ASSIGN_PARTITIONS  â†’  <span class="built_in">assign</span>() / incremental_assignâ”‚   â”‚  â”‚</span><br><span class="line">â”‚   â”‚   â”‚  ERR__REVOKE_PARTITIONS  â†’  <span class="built_in">unassign</span>() / incremental_    â”‚   â”‚  â”‚</span><br><span class="line">â”‚   â”‚   â”‚                             <span class="built_in">unassign</span>()                   â”‚   â”‚  â”‚</span><br><span class="line">â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚</span><br><span class="line">â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚</span><br><span class="line">â”‚                                                                         â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜</span><br><span class="line">                                                                        â”‚</span><br><span class="line">                                                                        â–¼</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚                         æ¸…ç†é˜¶æ®µ                                         â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚                                                                         â”‚</span><br><span class="line">â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚</span><br><span class="line">â”‚   â”‚     <span class="built_in">close</span>()       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ <span class="keyword">delete</span> consumer   â”‚                  â”‚</span><br><span class="line">â”‚   â”‚   å…³é—­æ¶ˆè´¹è€…      â”‚         â”‚                   â”‚                  â”‚</span><br><span class="line">â”‚   â”‚                   â”‚         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                  â”‚</span><br><span class="line">â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚         â”‚ â”‚ KafkaConsumer â”‚ â”‚                  â”‚</span><br><span class="line">â”‚   â”‚ â”‚ KafkaConsumer â”‚ â”‚         â”‚ â”‚   (é”€æ¯)      â”‚ â”‚                  â”‚</span><br><span class="line">â”‚   â”‚ â”‚   ::<span class="built_in">close</span>()   â”‚ â”‚         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                  â”‚</span><br><span class="line">â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚</span><br><span class="line">â”‚   â”‚                   â”‚                                                â”‚</span><br><span class="line">â”‚   â”‚ â€¢ æäº¤æœ€ç»ˆoffset  â”‚                                                â”‚</span><br><span class="line">â”‚   â”‚ â€¢ ç¦»å¼€æ¶ˆè´¹è€…ç»„    â”‚                                                â”‚</span><br><span class="line">â”‚   â”‚ â€¢ è§¦å‘é‡å¹³è¡¡      â”‚                                                â”‚</span><br><span class="line">â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚</span><br><span class="line">â”‚                                                                         â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="2-Confç±»ï¼ˆé…ç½®ç±»ï¼‰">2.Confç±»ï¼ˆé…ç½®ç±»ï¼‰</h2>
<p>dKafka::Conf æ˜¯ librdkafka ä¸­<strong>é…ç½®ç®¡ç†çš„æ ¸å¿ƒç±»</strong>ï¼Œç”¨äºç»Ÿä¸€ç®¡ç† Kafka å®¢æˆ·ç«¯ï¼ˆç”Ÿäº§è€… / æ¶ˆè´¹è€…ï¼‰çš„<strong>å…¨å±€é…ç½®</strong>ã€<strong>ä¸»é¢˜çº§é…ç½®</strong>ï¼Œæ˜¯åˆ›å»ºç”Ÿäº§è€… / æ¶ˆè´¹è€…å®ä¾‹çš„åŸºç¡€ã€‚<br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260116100012806.png" alt=""></p>
<h3 id="ï¼ˆ1ï¼‰Confç±»çš„å®šä¹‰">ï¼ˆ1ï¼‰Confç±»çš„å®šä¹‰</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RD_EXPORT</span> Conf &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// é…ç½®ç±»å‹</span></span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">ConfType</span> &#123;</span><br><span class="line">        CONF_GLOBAL, <span class="comment">// å…¨å±€é…ç½®</span></span><br><span class="line">        CONF_TOPIC   <span class="comment">// Topicé…ç½®</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// set() è¿”å›ç </span></span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">ConfResult</span> &#123;</span><br><span class="line">        CONF_UNKNOWN = <span class="number">-2</span>, <span class="comment">// æœªçŸ¥å±æ€§</span></span><br><span class="line">        CONF_INVALID = <span class="number">-1</span>, <span class="comment">// æ— æ•ˆå€¼</span></span><br><span class="line">        CONF_OK      = <span class="number">0</span>   <span class="comment">// æˆåŠŸ</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºé…ç½®å¯¹è±¡</span></span><br><span class="line">    <span class="function"><span class="type">static</span> Conf *<span class="title">create</span><span class="params">(ConfType type)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Conf</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * @brief è®¾ç½®å­—ç¬¦ä¸²ç±»å‹çš„é…ç½®å±æ€§</span></span><br><span class="line"><span class="comment">       * @param name é…ç½®å±æ€§åç§°</span></span><br><span class="line"><span class="comment">       * @param value é…ç½®å€¼</span></span><br><span class="line"><span class="comment">       * @param errstr é”™è¯¯æ—¶è¿”å›çš„é”™è¯¯æè¿°</span></span><br><span class="line"><span class="comment">       * @return é…ç½®ç»“æœç </span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ConfResult <span class="title">set</span><span class="params">(<span class="type">const</span> std::string &amp;name,</span></span></span><br><span class="line"><span class="params"><span class="function">                           <span class="type">const</span> std::string &amp;value,</span></span></span><br><span class="line"><span class="params"><span class="function">                           std::string &amp;errstr)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®é»˜è®¤ Topic é…ç½® (name = &quot;default_topic_conf&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ConfResult <span class="title">set</span><span class="params">(<span class="type">const</span> std::string &amp;name, <span class="type">const</span> Conf *topic_conf, std::string &amp;errstr)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ===================================== è®¾ç½®å›è°ƒå‡½æ•°é…ç½® =================================================</span></span><br><span class="line">    <span class="comment">/*    1.å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">            - nameï¼šé…ç½®åï¼ˆå›ºå®šï¼‰</span></span><br><span class="line"><span class="comment">                - ç‰¹å¾å¾ˆæ˜æ˜¾ï¼Œå¦‚DeliveryReportCb *dr_cb â€”â€”&gt; nameï¼š&quot;dr_cb&quot;</span></span><br><span class="line"><span class="comment">            - xxxCbï¼šå›è°ƒå¯¹è±¡ï¼ˆæˆå‘˜å‡½æ•°ï¼šå›è°ƒå‡½æ•°ï¼‰</span></span><br><span class="line"><span class="comment">            - errstrï¼šé”™è¯¯æ—¶è¿”å›çš„é”™è¯¯æè¿°</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        2.è¿”å›å€¼ï¼š</span></span><br><span class="line"><span class="comment">            - ConfResultï¼šé…ç½®ç»“æœç ï¼ˆè§ä¸Šï¼‰</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*  1.DeliveryReportCb - æ¶ˆæ¯æŠ•é€’æŠ¥å‘Šå›è°ƒï¼ˆâ­â­â­â­â­ æé«˜ï¼ˆç”Ÿäº§è€…å¸¸ç”¨ï¼‰ï¼‰</span></span><br><span class="line"><span class="comment">               - åŠŸèƒ½ï¼šç”Ÿäº§è€…å‘é€æ¶ˆæ¯åï¼Œé€šçŸ¥æ¶ˆæ¯æ˜¯å¦æˆåŠŸæŠ•é€’åˆ° Broker </span></span><br><span class="line"><span class="comment">            - ä½¿ç”¨åœºæ™¯ï¼šç¡®è®¤æ¶ˆæ¯å‘é€æˆåŠŸ/å¤±è´¥ï¼Œå¤„ç†å‘é€å¤±è´¥çš„é‡è¯•é€»è¾‘*/</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ConfResult <span class="title">set</span><span class="params">(<span class="type">const</span> std::string &amp;name, DeliveryReportCb *dr_cb, std::string &amp;errstr)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 2.EventCb - äº‹ä»¶å›è°ƒï¼ˆâ­â­â­â­â­ æé«˜ï¼ˆç”Ÿäº§è€…/æ¶ˆè´¹è€…éƒ½å¸¸ç”¨ï¼‰ï¼‰</span></span><br><span class="line"><span class="comment">            - åŠŸèƒ½ï¼šæ¥æ”¶ Kafka å®¢æˆ·ç«¯çš„å„ç§äº‹ä»¶ï¼ˆé”™è¯¯ã€ç»Ÿè®¡ä¿¡æ¯ã€æ—¥å¿—ã€é™æµç­‰ï¼‰</span></span><br><span class="line"><span class="comment">            - ä½¿ç”¨åœºæ™¯ï¼šç›‘æ§è¿æ¥çŠ¶æ€ã€è®°å½•é”™è¯¯æ—¥å¿—ã€è·å–ç»Ÿè®¡æ•°æ®*/</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ConfResult <span class="title">set</span><span class="params">(<span class="type">const</span> std::string &amp;name, EventCb *event_cb, std::string &amp;errstr)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*    3.RebalanceCb - æ¶ˆè´¹è€…é‡å¹³è¡¡å›è°ƒ</span></span><br><span class="line"><span class="comment">            - åŠŸèƒ½ï¼šæ¶ˆè´¹è€…ç»„å‘ç”Ÿåˆ†åŒºé‡æ–°åˆ†é…æ—¶è§¦å‘ï¼ˆæˆå‘˜åŠ å…¥/ç¦»å¼€ï¼‰ï¼ˆâ­â­â­â­ é«˜ï¼ˆæ¶ˆè´¹è€…ç»„å¸¸ç”¨ï¼‰ï¼‰</span></span><br><span class="line"><span class="comment">            - ä½¿ç”¨åœºæ™¯ï¼šåœ¨é‡å¹³è¡¡å‰ä¿å­˜ offsetã€é‡Šæ”¾èµ„æºï¼›é‡å¹³è¡¡ååˆå§‹åŒ–çŠ¶æ€*/</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ConfResult <span class="title">set</span><span class="params">(<span class="type">const</span> std::string &amp;name, RebalanceCb *rebalance_cb, std::string &amp;errstr)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*    4.OffsetCommitCb - åç§»é‡æäº¤å›è°ƒï¼ˆâ­â­â­ ä¸­ç­‰ï¼ˆéœ€è¦ç²¾ç¡®æ§åˆ¶ offset æ—¶ä½¿ç”¨ï¼‰ï¼‰</span></span><br><span class="line"><span class="comment">            - åŠŸèƒ½ï¼šoffset æäº¤å®Œæˆåçš„é€šçŸ¥ï¼ˆæˆåŠŸæˆ–å¤±è´¥ï¼‰</span></span><br><span class="line"><span class="comment">            - ä½¿ç”¨åœºæ™¯ï¼šç¡®è®¤ offset æäº¤çŠ¶æ€ï¼Œå¤„ç†æäº¤å¤±è´¥</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ConfResult <span class="title">set</span><span class="params">(<span class="type">const</span> std::string &amp;name, OffsetCommitCb *cb, std::string &amp;errstr)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*    5.PartitionerCb - è‡ªå®šä¹‰åˆ†åŒºå™¨å›è°ƒï¼ˆâ­â­â­ ä¸­ç­‰ï¼ˆé»˜è®¤åˆ†åŒºå™¨å¤Ÿç”¨æ—¶ä¸éœ€è¦ï¼‰ï¼‰</span></span><br><span class="line"><span class="comment">            - åŠŸèƒ½ï¼šè‡ªå®šä¹‰æ¶ˆæ¯è·¯ç”±åˆ°å“ªä¸ªåˆ†åŒºçš„é€»è¾‘</span></span><br><span class="line"><span class="comment">            - ä½¿ç”¨åœºæ™¯ï¼šéœ€è¦ç‰¹æ®Šåˆ†åŒºç­–ç•¥ï¼ˆå¦‚æŒ‰ä¸šåŠ¡ ID åˆ†åŒºã€åœ°ç†ä½ç½®åˆ†åŒºï¼‰</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ConfResult <span class="title">set</span><span class="params">(<span class="type">const</span> std::string &amp;name, PartitionerCb *partitioner_cb, std::string &amp;errstr)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*    6.ConsumeCb - æ¶ˆæ¯æ¶ˆè´¹å›è°ƒï¼ˆâ­â­â­ ä¸­ç­‰ï¼ˆé€šå¸¸ç›´æ¥ç”¨ poll() æ›´å¸¸è§ï¼‰ï¼‰</span></span><br><span class="line"><span class="comment">        - åŠŸèƒ½ï¼šæ¶ˆè´¹åˆ°æ¶ˆæ¯æ—¶çš„å›è°ƒå¤„ç†</span></span><br><span class="line"><span class="comment">        - ä½¿ç”¨åœºæ™¯ï¼šå›è°ƒå¼æ¶ˆè´¹æ¨¡å¼ï¼ˆæ›¿ä»£ poll å¾ªç¯ï¼‰</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ConfResult <span class="title">set</span><span class="params">(<span class="type">const</span> std::string &amp;name, ConsumeCb *consume_cb, std::string &amp;errstr)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸‹é¢ä½¿ç”¨é¢‘ç‡è¾ƒä½ï¼Œå°±ä¸è¯¦ç»†æ³¨é‡Šäº†</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ConfResult <span class="title">set</span><span class="params">(<span class="type">const</span> std::string &amp;name, OAuthBearerTokenRefreshCb *cb, std::string &amp;errstr)</span> </span>= <span class="number">0</span>; <span class="comment">//ä»¤ç‰Œåˆ·æ–°å›è°ƒ</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ConfResult <span class="title">set</span><span class="params">(<span class="type">const</span> std::string &amp;name, SslCertificateVerifyCb *cb, std::string &amp;errstr)</span> </span>= <span class="number">0</span>; <span class="comment">//SSL è¯ä¹¦éªŒè¯å›è°ƒ</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ConfResult <span class="title">set</span><span class="params">(<span class="type">const</span> std::string &amp;name, SocketCb *socket_cb, std::string &amp;errstr)</span> </span>= <span class="number">0</span>; <span class="comment">//Socket åˆ›å»ºå›è°ƒ</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ConfResult <span class="title">set</span><span class="params">(<span class="type">const</span> std::string &amp;name, OpenCb *open_cb, std::string &amp;errstr)</span> </span>= <span class="number">0</span>; <span class="comment">//æ–‡ä»¶æ‰“å¼€å›è°ƒ</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ConfResult <span class="title">set</span><span class="params">(<span class="type">const</span> std::string &amp;name, PartitionerKeyPointerCb *cb, std::string &amp;errstr)</span> </span>= <span class="number">0</span>; <span class="comment">// é”®æŒ‡é’ˆåˆ†åŒºå™¨å›è°ƒ</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½® SSL è¯ä¹¦/å¯†é’¥</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ConfResult <span class="title">set_ssl_cert</span><span class="params">(RdKafka::CertificateType cert_type,</span></span></span><br><span class="line"><span class="params"><span class="function">                                    RdKafka::CertificateEncoding cert_enc,</span></span></span><br><span class="line"><span class="params"><span class="function">                                    <span class="type">const</span> <span class="type">void</span> *buffer, <span class="type">size_t</span> size,</span></span></span><br><span class="line"><span class="params"><span class="function">                                    std::string &amp;errstr)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŸ¥è¯¢å­—ç¬¦ä¸²é…ç½®å€¼</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ConfResult <span class="title">get</span><span class="params">(<span class="type">const</span> std::string &amp;name, std::string &amp;value)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ========== è·å–å›è°ƒå‡½æ•° ==========</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ConfResult <span class="title">get</span><span class="params">(DeliveryReportCb *&amp;dr_cb)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ConfResult <span class="title">get</span><span class="params">(OAuthBearerTokenRefreshCb *&amp;cb)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ConfResult <span class="title">get</span><span class="params">(EventCb *&amp;event_cb)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ConfResult <span class="title">get</span><span class="params">(PartitionerCb *&amp;partitioner_cb)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ConfResult <span class="title">get</span><span class="params">(PartitionerKeyPointerCb *&amp;cb)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ConfResult <span class="title">get</span><span class="params">(SocketCb *&amp;socket_cb)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ConfResult <span class="title">get</span><span class="params">(OpenCb *&amp;open_cb)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ConfResult <span class="title">get</span><span class="params">(RebalanceCb *&amp;rebalance_cb)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ConfResult <span class="title">get</span><span class="params">(OffsetCommitCb *&amp;cb)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ConfResult <span class="title">get</span><span class="params">(SslCertificateVerifyCb *&amp;cb)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¼å‡ºæ‰€æœ‰é…ç½® (name, value) åˆ—è¡¨</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> std::list&lt;std::string&gt; *<span class="title">dump</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–åº•å±‚ C å¥æŸ„ï¼ˆä¸æ¨èç›´æ¥ä½¿ç”¨ï¼‰</span></span><br><span class="line">    <span class="keyword">virtual</span> <span class="keyword">struct</span> <span class="title class_">rd_kafka_conf_s</span> *<span class="built_in">c_ptr_global</span>() = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> <span class="keyword">struct</span> <span class="title class_">rd_kafka_topic_conf_s</span> *<span class="built_in">c_ptr_topic</span>() = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½® SSL å¼•æ“å›è°ƒæ•°æ®</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ConfResult <span class="title">set_engine_callback_data</span><span class="params">(<span class="type">void</span> *value, std::string &amp;errstr)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯ç”¨ SASL ä¸“ç”¨é˜Ÿåˆ—</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ConfResult <span class="title">enable_sasl_queue</span><span class="params">(<span class="type">bool</span> enable, std::string &amp;errstr)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰Confç±»çš„ä½¿ç”¨">ï¼ˆ2ï¼‰Confç±»çš„ä½¿ç”¨</h3>
<h4 id="1-åˆ›å»º-RdKafka-Conf">&lt;1&gt;åˆ›å»º RdKafka::Conf</h4>
<ul>
<li>RdKafka::Conf çš„åˆ›å»ºéå¸¸ç®€å•ï¼Œä½¿ç”¨<strong>é™æ€å·¥å‚æ–¹æ³• create()</strong></li>
<li><strong>æ¨è</strong>ï¼šä½¿ç”¨â€œæ™ºèƒ½æŒ‡é’ˆâ€è‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œé¿å…æ‰‹åŠ¨ delete</li>
</ul>
<h5 id="1ï¼‰ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆç›´æ¥åˆ›å»º">1ï¼‰ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆç›´æ¥åˆ›å»º</h5>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;librdkafka/rdkafkacpp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ==================== 1. ä½¿ç”¨ unique_ptr åˆ›å»ºå…¨å±€é…ç½® ====================</span></span><br><span class="line">    <span class="function">std::unique_ptr&lt;RdKafka::Conf&gt; <span class="title">global_conf</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        RdKafka::Conf::create(RdKafka::Conf::CONF_GLOBAL)</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!global_conf) &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;åˆ›å»ºå…¨å±€é…ç½®å¤±è´¥!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;å…¨å±€é…ç½®åˆ›å»ºæˆåŠŸ&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ==================== 2. ä½¿ç”¨ unique_ptr åˆ›å»º Topic é…ç½® ====================</span></span><br><span class="line">    <span class="function">std::unique_ptr&lt;RdKafka::Conf&gt; <span class="title">topic_conf</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        RdKafka::Conf::create(RdKafka::Conf::CONF_TOPIC)</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!topic_conf) &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;åˆ›å»º Topic é…ç½®å¤±è´¥!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Topic é…ç½®åˆ›å»ºæˆåŠŸ&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2ï¼‰å°è£…ä¸ºå·¥å‚å‡½æ•°">2ï¼‰å°è£…ä¸ºå·¥å‚å‡½æ•°</h5>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;librdkafka/rdkafkacpp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å·¥å‚å‡½æ•°ï¼šåˆ›å»ºå…¨å±€é…ç½®</span></span><br><span class="line"><span class="function">std::unique_ptr&lt;RdKafka::Conf&gt; <span class="title">createGlobalConf</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">unique_ptr</span>&lt;RdKafka::Conf&gt;(</span><br><span class="line">        RdKafka::Conf::<span class="built_in">create</span>(RdKafka::Conf::CONF_GLOBAL)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å·¥å‚å‡½æ•°ï¼šåˆ›å»º Topic é…ç½®</span></span><br><span class="line"><span class="function">std::unique_ptr&lt;RdKafka::Conf&gt; <span class="title">createTopicConf</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">unique_ptr</span>&lt;RdKafka::Conf&gt;(</span><br><span class="line">        RdKafka::Conf::<span class="built_in">create</span>(RdKafka::Conf::CONF_TOPIC)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> global_conf = <span class="built_in">createGlobalConf</span>();</span><br><span class="line">    <span class="keyword">auto</span> topic_conf = <span class="built_in">createTopicConf</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!global_conf || !topic_conf) &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;é…ç½®åˆ›å»ºå¤±è´¥!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;é…ç½®åˆ›å»ºå¹¶è®¾ç½®æˆåŠŸ&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="3ï¼‰ä¸ä½¿ç”¨â€œæ™ºèƒ½æŒ‡é’ˆâ€ï¼ˆä¸æ¨èï¼ï¼‰">3ï¼‰ä¸ä½¿ç”¨â€œæ™ºèƒ½æŒ‡é’ˆâ€ï¼ˆä¸æ¨èï¼ï¼‰</h5>
<p>åœ¨â€œRdKafka::Confç±»çš„ç»“æ„â€éƒ¨åˆ†å¯çŸ¥ï¼šcreateè¿”å› â€œè£¸æŒ‡é’ˆâ€ï¼Œæ‰€ä»¥éœ€è¦â€œ<strong>æ‰‹åŠ¨é‡Šæ”¾èµ„æº</strong>â€</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;librdkafka/rdkafkacpp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::string errstr;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ==================== 1. åˆ›å»ºé…ç½®ï¼ˆè£¸æŒ‡é’ˆï¼‰ ====================</span></span><br><span class="line">    RdKafka::Conf *global_conf = RdKafka::Conf::<span class="built_in">create</span>(RdKafka::Conf::CONF_GLOBAL);</span><br><span class="line">    RdKafka::Conf *topic_conf = RdKafka::Conf::<span class="built_in">create</span>(RdKafka::Conf::CONF_TOPIC);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¿…é¡»æ£€æŸ¥æ˜¯å¦åˆ›å»ºæˆåŠŸ</span></span><br><span class="line">    <span class="keyword">if</span> (!global_conf || !topic_conf) &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;é…ç½®åˆ›å»ºå¤±è´¥!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="comment">// âš ï¸ é—®é¢˜1ï¼šå¦‚æœä¸€ä¸ªæˆåŠŸä¸€ä¸ªå¤±è´¥ï¼Œéœ€è¦å¤„ç†éƒ¨åˆ†é‡Šæ”¾</span></span><br><span class="line">        <span class="keyword">delete</span> global_conf;  <span class="comment">// å¯èƒ½æ˜¯ nullptrï¼Œä½† delete nullptr æ˜¯å®‰å…¨çš„</span></span><br><span class="line">        <span class="keyword">delete</span> topic_conf;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-è®¾ç½®-RdKafka-Conf">&lt;2&gt;è®¾ç½® RdKafka::Conf</h4>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Producer æœ€å°é…ç½®</span></span><br><span class="line">RdKafka::Conf *conf = RdKafka::Conf::<span class="built_in">create</span>(RdKafka::Conf::CONF_GLOBAL);</span><br><span class="line">conf-&gt;<span class="built_in">set</span>(<span class="string">&quot;bootstrap.servers&quot;</span>, <span class="string">&quot;localhost:9092&quot;</span>, errstr);</span><br><span class="line">conf-&gt;<span class="built_in">set</span>(<span class="string">&quot;acks&quot;</span>, <span class="string">&quot;all&quot;</span>, errstr);</span><br><span class="line">conf-&gt;<span class="built_in">set</span>(<span class="string">&quot;dr_cb&quot;</span>, &amp;delivery_cb, errstr);  <span class="comment">// æŠ•é€’å›è°ƒ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Consumer æœ€å°é…ç½®</span></span><br><span class="line">RdKafka::Conf *conf = RdKafka::Conf::<span class="built_in">create</span>(RdKafka::Conf::CONF_GLOBAL);</span><br><span class="line">conf-&gt;<span class="built_in">set</span>(<span class="string">&quot;bootstrap.servers&quot;</span>, <span class="string">&quot;localhost:9092&quot;</span>, errstr);</span><br><span class="line">conf-&gt;<span class="built_in">set</span>(<span class="string">&quot;group.id&quot;</span>, <span class="string">&quot;my-consumer-group&quot;</span>, errstr);</span><br><span class="line">conf-&gt;<span class="built_in">set</span>(<span class="string">&quot;enable.auto.commit&quot;</span>, <span class="string">&quot;false&quot;</span>, errstr);</span><br></pre></td></tr></table></figure>
<p><strong>â€œå›è°ƒç±»â€å‚è€ƒ</strong>ï¼š<a href="#cb">å›è°ƒç±»</a></p>
<h5 id="1ï¼‰ç”Ÿäº§è€…å¸¸ç”¨é…ç½®">1ï¼‰ç”Ÿäº§è€…å¸¸ç”¨é…ç½®</h5>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260116161810771.png" alt=""></p>
<h5 id="2ï¼‰æ¶ˆè´¹è€…å¸¸ç”¨é…ç½®">2ï¼‰æ¶ˆè´¹è€…å¸¸ç”¨é…ç½®</h5>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260116161420955.png" alt=""></p>
<p>æƒ³äº†è§£æ›´å¤šé…ç½®é¡¹ï¼Œ<strong>å‚è€ƒ</strong>ï¼š<a href="#config">é™„å½•1ï¼šå¸¸ç”¨é…ç½®é¡¹</a></p>
<h2 id="3-TopicPartitionç±»ï¼ˆä¸»é¢˜åˆ†åŒºç±»ï¼‰">3.TopicPartitionç±»ï¼ˆä¸»é¢˜åˆ†åŒºç±»ï¼‰</h2>
<h3 id="ï¼ˆ1ï¼‰æ¦‚è¿°">ï¼ˆ1ï¼‰æ¦‚è¿°</h3>
<h4 id="1-ä½œç”¨">&lt;1&gt;ä½œç”¨</h4>
<ul>
<li>å°è£…**&lt;topic, partition, offset&gt;**ä¸‰å…ƒç»„çš„æ ¸å¿ƒç±»</li>
<li>å®¢æˆ·ç«¯ä¸ Kafka é›†ç¾¤äº¤äº’ã€Œ<strong>åˆ†åŒºçº§æ“ä½œ</strong>ã€çš„åŸºç¡€è½½ä½“</li>
<li>æ‰€æœ‰å’Œã€Œ<strong>æŒ‡å®šåˆ†åŒºã€æ§åˆ¶æ¶ˆè´¹ä½ç½®ã€æäº¤åç§»é‡</strong>ã€ç›¸å…³çš„æ“ä½œéƒ½ä¾èµ–è¯¥ç±»</li>
</ul>
<h4 id="2-æ ¸å¿ƒå®šä½">&lt;2&gt;æ ¸å¿ƒå®šä½</h4>
<ul>
<li><strong>å…ƒæ•°æ®è½½ä½“</strong>ï¼š
<ul>
<li>æœ¬è´¨æ˜¯å­˜å‚¨ã€Œä¸»é¢˜åï¼ˆstringï¼‰ã€åˆ†åŒºå·ï¼ˆintï¼‰ã€åç§»é‡ï¼ˆint64_tï¼‰ã€çš„è½»é‡çº§ç±»ï¼Œä»…è®°å½• â€œè¦æ“ä½œçš„ç›®æ ‡åˆ†åŒº + ä½ç½®â€ï¼Œ<strong>ä¸åŒ…å«ä»»ä½•é›†ç¾¤äº¤äº’é€»è¾‘</strong>ï¼›</li>
</ul>
</li>
<li><strong>æ“ä½œæ¡¥æ¢</strong>ï¼š
<ul>
<li>ä½œä¸º assign()ï¼ˆæ‰‹åŠ¨åˆ†é…åˆ†åŒºï¼‰ã€commitSync()/commitAsync()ï¼ˆæäº¤ offsetï¼‰ã€seek()ï¼ˆé‡ç½®æ¶ˆè´¹ä½ç½®ï¼‰ç­‰æ ¸å¿ƒ API çš„å…¥å‚ / è¿”å›å€¼ï¼Œæ˜¯<strong>å®¢æˆ·ç«¯å‘ Kafka ä¼ é€’ â€œåˆ†åŒºæ“ä½œæŒ‡ä»¤â€ çš„æ ‡å‡†åŒ–æ ¼å¼</strong>ï¼›</li>
</ul>
</li>
<li><strong>æ— çŠ¶æ€ç‰¹æ€§</strong>ï¼š
<ul>
<li>è¯¥ç±»å¯¹è±¡ä»…å­˜å‚¨é™æ€å…ƒæ•°æ®ï¼Œä¸å…³è” Kafka è¿æ¥çŠ¶æ€ï¼Œ<strong>ä¿®æ”¹å¯¹è±¡å±æ€§ï¼ˆå¦‚ offsetï¼‰ä»…å½±å“æœ¬åœ°ï¼Œéœ€è°ƒç”¨ API æ‰èƒ½åŒæ­¥åˆ°é›†ç¾¤</strong>ã€‚</li>
</ul>
</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰TopicPartitionç±»çš„å®šä¹‰">ï¼ˆ2ï¼‰TopicPartitionç±»çš„å®šä¹‰</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RD_EXPORT</span> TopicPartition &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//==================== é«˜é¢‘ä½¿ç”¨ï¼ˆå¿…ç”¨ï¼‰ ====================</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief åˆ›å»º topic+partition å…³è”å¯¹è±¡ï¼ˆæ—  offsetï¼‰</span></span><br><span class="line"><span class="comment">     * éœ€ä½¿ç”¨ delete é‡Šæ”¾</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="type">static</span> TopicPartition *<span class="title">create</span><span class="params">(<span class="type">const</span> std::string &amp;topic, <span class="type">int</span> partition)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief åˆ›å»º topic+partition+offset å…³è”å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * éœ€ä½¿ç”¨ delete é‡Šæ”¾</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="type">static</span> TopicPartition *<span class="title">create</span><span class="params">(<span class="type">const</span> std::string &amp;topic,</span></span></span><br><span class="line"><span class="params"><span class="function">                                  <span class="type">int</span> partition,</span></span></span><br><span class="line"><span class="params"><span class="function">                                  <span class="type">int64_t</span> offset)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">const</span> std::string &amp;<span class="title">topic</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;    <span class="comment">// è·å– topic å</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">partition</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;               <span class="comment">// è·å–åˆ†åŒº ID</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">int64_t</span> <span class="title">offset</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;              <span class="comment">// è·å– offset</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//==================== ä¸­é¢‘ä½¿ç”¨ï¼ˆå¸¸ç”¨ï¼‰ ====================</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">destroy</span><span class="params">(std::vector&lt;TopicPartition *&gt; &amp;partitions)</span></span>;  <span class="comment">// æ‰¹é‡é”€æ¯</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ErrorCode <span class="title">err</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;               <span class="comment">// è·å–é”™è¯¯ç </span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">set_offset</span><span class="params">(<span class="type">int64_t</span> offset)</span> </span>= <span class="number">0</span>;     <span class="comment">// è®¾ç½® offset</span></span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">TopicPartition</span>() = <span class="number">0</span>;                   <span class="comment">// ææ„å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//==================== ä½é¢‘ä½¿ç”¨ï¼ˆé«˜çº§åœºæ™¯ï¼‰ ====================</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">int32_t</span> <span class="title">get_leader_epoch</span><span class="params">()</span> </span>= <span class="number">0</span>;          <span class="comment">// è·å– leader epoch</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">set_leader_epoch</span><span class="params">(<span class="type">int32_t</span> leader_epoch)</span> </span>= <span class="number">0</span>;  <span class="comment">//è®¾ç½® leader epoch</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//==================== æå°‘ä½¿ç”¨ï¼ˆç‰¹æ®Šåœºæ™¯ï¼‰ ====================</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> std::vector&lt;<span class="type">unsigned</span> <span class="type">char</span>&gt; <span class="title">get_metadata</span><span class="params">()</span> </span>= <span class="number">0</span>;  <span class="comment">// è·å–åˆ†åŒºå…ƒæ•°æ®</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">set_metadata</span><span class="params">(std::vector&lt;<span class="type">unsigned</span> <span class="type">char</span>&gt; &amp;metadata)</span> </span>= <span class="number">0</span>; <span class="comment">// è®¾ç½®åˆ†åŒºå…ƒæ•°æ®</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç‰¹æ®Š offset å¸¸é‡ï¼ˆæŒ‰ä½¿ç”¨é¢‘ç‡ï¼‰</span></span><br><span class="line"><span class="type">const</span> <span class="type">int64_t</span> OFFSET_STORED    = <span class="number">-1000</span>; <span class="comment">// â˜…â˜…â˜… æœ€å¸¸ç”¨ï¼šä»ä¸Šæ¬¡æäº¤ä½ç½®ç»§ç»­</span></span><br><span class="line"><span class="type">const</span> <span class="type">int64_t</span> OFFSET_END       = <span class="number">-1</span>;    <span class="comment">// â˜…â˜…  å¸¸ç”¨ï¼šåªæ¶ˆè´¹æ–°æ¶ˆæ¯</span></span><br><span class="line"><span class="type">const</span> <span class="type">int64_t</span> OFFSET_BEGINNING = <span class="number">-2</span>;    <span class="comment">// â˜…â˜…  å¸¸ç”¨ï¼šä»å¤´æ¶ˆè´¹æ‰€æœ‰æ¶ˆæ¯</span></span><br><span class="line"><span class="type">const</span> <span class="type">int64_t</span> OFFSET_INVALID   = <span class="number">-1001</span>; <span class="comment">// â˜…   å°‘ç”¨ï¼šè¡¨ç¤ºæ— æ•ˆçŠ¶æ€</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260116211851723.png" alt=""></p>
<h3 id="ï¼ˆ3ï¼‰å…¸å‹ä½¿ç”¨åœºæ™¯ï¼ˆç»“åˆæ ¸å¿ƒ-APIï¼‰">ï¼ˆ3ï¼‰å…¸å‹ä½¿ç”¨åœºæ™¯ï¼ˆç»“åˆæ ¸å¿ƒ APIï¼‰</h3>
<h4 id="1-æ‰‹åŠ¨åˆ†é…åˆ†åŒº">&lt;1&gt; æ‰‹åŠ¨åˆ†é…åˆ†åŒº</h4>
<p>æ— éœ€æŒ‡å®šåç§»é‡ï¼Œä»…å…³è”ã€Œä¸»é¢˜ + åˆ†åŒºã€ï¼Œä¾èµ– auto.offset.reset é…ç½®ç¡®å®šæ¶ˆè´¹ä½ç½®ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">std::vector&lt;RdKafka::TopicPartition*&gt; partitions;</span><br><span class="line">partitions.<span class="built_in">push_back</span>(RdKafka::TopicPartition::<span class="built_in">create</span>(<span class="string">&quot;topic1&quot;</span>, <span class="number">0</span>));</span><br><span class="line">partitions.<span class="built_in">push_back</span>(RdKafka::TopicPartition::<span class="built_in">create</span>(<span class="string">&quot;topic1&quot;</span>, <span class="number">1</span>));</span><br><span class="line">consumer-&gt;<span class="built_in">assign</span>(partitions); <span class="comment">// ä»…æŒ‡å®šè¦æ¶ˆè´¹çš„åˆ†åŒº</span></span><br></pre></td></tr></table></figure>
<h4 id="2-æŒ‡å®šåç§»é‡æ¶ˆè´¹">&lt;2&gt;æŒ‡å®šåç§»é‡æ¶ˆè´¹</h4>
<p>åˆ›å»ºæ—¶æŒ‡å®šåç§»é‡ï¼Œé‡ç½®æ¶ˆè´¹ä½ç½®ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä» topic1-0 åˆ†åŒºçš„ç¬¬ 100 æ¡æ¶ˆæ¯å¼€å§‹æ¶ˆè´¹</span></span><br><span class="line">RdKafka::TopicPartition *tp = RdKafka::TopicPartition::<span class="built_in">create</span>(<span class="string">&quot;topic1&quot;</span>, <span class="number">0</span>, <span class="number">100</span>);</span><br><span class="line">consumer-&gt;<span class="built_in">seek</span>(tp, <span class="number">5000</span>); <span class="comment">// 5000ms è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="keyword">delete</span> tp;</span><br></pre></td></tr></table></figure>
<h4 id="3-æ‰‹åŠ¨æäº¤æŒ‡å®š-offset">&lt;3&gt;æ‰‹åŠ¨æäº¤æŒ‡å®š offset</h4>
<p>ä¿®æ”¹å¯¹è±¡åç§»é‡åæäº¤ï¼Œå®ç°ç²¾å‡†çš„ offset ç®¡ç†ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">std::vector&lt;RdKafka::TopicPartition*&gt; partitions;</span><br><span class="line">partitions.<span class="built_in">push_back</span>(RdKafka::TopicPartition::<span class="built_in">create</span>(<span class="string">&quot;topic1&quot;</span>, <span class="number">0</span>));</span><br><span class="line">partitions[<span class="number">0</span>]-&gt;<span class="built_in">set_offset</span>(<span class="number">200</span>); <span class="comment">// æäº¤ topic1-0 çš„ offset=200</span></span><br><span class="line">consumer-&gt;<span class="built_in">commitSync</span>(partitions); <span class="comment">// åŒæ­¥æäº¤</span></span><br></pre></td></tr></table></figure>
<h4 id="4-æ‰¹é‡æ“ä½œæ‰€æœ‰åˆ†åŒº">&lt;4&gt;æ‰¹é‡æ“ä½œæ‰€æœ‰åˆ†åŒº</h4>
<p>ä½¿ç”¨ partition=-1 ä»£è¡¨ä¸»é¢˜çš„æ‰€æœ‰åˆ†åŒºï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æäº¤ topic1 æ‰€æœ‰åˆ†åŒºçš„ offset=300</span></span><br><span class="line">RdKafka::TopicPartition *tp = RdKafka::TopicPartition::<span class="built_in">create</span>(<span class="string">&quot;topic1&quot;</span>, <span class="number">-1</span>, <span class="number">300</span>);</span><br><span class="line">consumer-&gt;<span class="built_in">commitSync</span>(&#123;tp&#125;);</span><br><span class="line"><span class="keyword">delete</span> tp;</span><br></pre></td></tr></table></figure>
<h4 id="5-destroy-çš„ä½¿ç”¨ç¤ºä¾‹">&lt;5&gt;destroy() çš„ä½¿ç”¨ç¤ºä¾‹</h4>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ‰¹é‡åˆ›å»º</span></span><br><span class="line">std::vector&lt;RdKafka::TopicPartition*&gt; partitions;</span><br><span class="line">partitions.<span class="built_in">push_back</span>(RdKafka::TopicPartition::<span class="built_in">create</span>(<span class="string">&quot;topic1&quot;</span>, <span class="number">0</span>));</span><br><span class="line">partitions.<span class="built_in">push_back</span>(RdKafka::TopicPartition::<span class="built_in">create</span>(<span class="string">&quot;topic1&quot;</span>, <span class="number">1</span>));</span><br><span class="line">partitions.<span class="built_in">push_back</span>(RdKafka::TopicPartition::<span class="built_in">create</span>(<span class="string">&quot;topic2&quot;</span>, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">consumer-&gt;<span class="built_in">assign</span>(partitions);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... ä½¿ç”¨å®Œæ¯•å ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼1ï¼šæ‰‹åŠ¨é€ä¸ªåˆ é™¤</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> p : partitions) </span><br><span class="line">    <span class="keyword">delete</span> p;</span><br><span class="line">partitions.<span class="built_in">clear</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼2ï¼šä½¿ç”¨ destroy() ä¸€æ¬¡æ€§é”€æ¯å¹¶æ¸…ç©ºï¼ˆæ¨èï¼‰</span></span><br><span class="line">RdKafka::TopicPartition::<span class="built_in">destroy</span>(partitions);  <span class="comment">// åˆ é™¤æ‰€æœ‰å…ƒç´  + æ¸…ç©º vector</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ4ï¼‰å†…å­˜ç®¡ç†ï¼ˆæ ¸å¿ƒæ³¨æ„äº‹é¡¹ï¼‰">ï¼ˆ4ï¼‰å†…å­˜ç®¡ç†ï¼ˆæ ¸å¿ƒæ³¨æ„äº‹é¡¹ï¼‰</h3>
<p><strong>å¿…é¡»é‡Šæ”¾èµ„æº</strong>ï¼š</p>
<ul>
<li>create æ–¹æ³•è¿”å›çš„æ˜¯åŠ¨æ€åˆ†é…çš„è£¸æŒ‡é’ˆï¼Œæœªé‡Šæ”¾ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼Œæ¨èä¸¤ç§æ–¹å¼ï¼š
<ul>
<li>æ‰‹åŠ¨ deleteï¼ˆåŸºç¡€æ–¹å¼ï¼‰</li>
<li>å°è£…æ™ºèƒ½æŒ‡é’ˆï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰</li>
</ul>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ‰‹åŠ¨ delete</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> p : partitions) &#123;</span><br><span class="line">    <span class="keyword">delete</span> p;</span><br><span class="line">    p = <span class="literal">nullptr</span>; <span class="comment">// é¿å…é‡æŒ‡é’ˆ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆ</span></span><br><span class="line"><span class="keyword">using</span> TopicPartitionPtr = std::unique_ptr&lt;RdKafka::TopicPartition&gt;;</span><br><span class="line"><span class="function">TopicPartitionPtr <span class="title">tp</span><span class="params">(RdKafka::TopicPartition::create(<span class="string">&quot;topic1&quot;</span>, <span class="number">0</span>))</span></span>;</span><br><span class="line"><span class="comment">// è‡ªåŠ¨é‡Šæ”¾ï¼Œæ— éœ€æ‰‹åŠ¨ delete</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ5ï¼‰æ ¸å¿ƒæ˜“é”™ç‚¹ä¸æœ€ä½³å®è·µ">ï¼ˆ5ï¼‰æ ¸å¿ƒæ˜“é”™ç‚¹ä¸æœ€ä½³å®è·µ</h3>
<h4 id="1-æ˜“é”™ç‚¹">&lt;1&gt;æ˜“é”™ç‚¹</h4>
<ul>
<li><strong>æ··æ·†ã€Œå®¢æˆ·ç«¯å¯¹è±¡åˆ›å»ºã€å’Œã€Œé›†ç¾¤ç‰©ç†åˆ›å»ºã€</strong>ï¼š
<ul>
<li>TopicPartition::create ä»…åˆ›å»º<strong>æœ¬åœ°å¯¹è±¡</strong>ï¼Œä¸ä¼šåœ¨ Kafka é›†ç¾¤åˆ›å»ºä¸»é¢˜ / åˆ†åŒºï¼›</li>
</ul>
</li>
<li><strong>å¿½ç•¥å†…å­˜é‡Šæ”¾</strong>ï¼š
<ul>
<li>ç”Ÿäº§ç¯å¢ƒéœ€ä¸¥æ ¼ç®¡ç† TopicPartition æŒ‡é’ˆï¼Œ<strong>å»ºè®®å°è£…æ™ºèƒ½æŒ‡é’ˆ</strong>ï¼›</li>
</ul>
</li>
<li><strong>åç§»é‡è®¾ç½®åæœªè°ƒç”¨ API</strong>ï¼š
<ul>
<li><strong>ä¿®æ”¹ offset ä»…æ”¹æœ¬åœ°å€¼</strong>ï¼Œéœ€è°ƒç”¨ commitSync()/seek() ç­‰ API æ‰èƒ½åŒæ­¥åˆ°é›†ç¾¤ï¼›</li>
</ul>
</li>
<li><strong>åˆ†åŒºå·è¶Šç•Œ</strong>ï¼š
<ul>
<li>æŒ‡å®šçš„åˆ†åŒºå·è¶…å‡ºä¸»é¢˜å®é™…åˆ†åŒºæ•°ï¼Œä¼šå¯¼è‡´ assign()/commitSync() è¿”å› ERR_UNKNOWN_PARTITION é”™è¯¯ã€‚</li>
</ul>
</li>
</ul>
<h2 id="4-Headersç±»ï¼ˆæ¶ˆæ¯å¤´ç±»ï¼‰">4.Headersç±»ï¼ˆæ¶ˆæ¯å¤´ç±»ï¼‰</h2>
<h3 id="ï¼ˆ1ï¼‰æ¦‚è¿°-2">ï¼ˆ1ï¼‰æ¦‚è¿°</h3>
<h4 id="1-ä½œç”¨-2">&lt;1&gt;ä½œç”¨</h4>
<ul>
<li>RdKafka::Headers æ˜¯ librdkafka ä¸­<strong>å°è£… Kafka æ¶ˆæ¯å¤´ï¼ˆHeaderï¼‰çš„æ ¸å¿ƒç±»</strong>
<ul>
<li>ç”¨äºä¸ºæ¶ˆæ¯é™„<strong>åŠ é”®å€¼å¯¹</strong>å½¢å¼çš„å…ƒæ•°æ®ï¼ˆå¦‚ä¸šåŠ¡æ ‡è¯†ã€è¿½è¸ª IDã€æ¶ˆæ¯ç±»å‹ç­‰ï¼‰</li>
<li>æ˜¯æ¶ˆæ¯å†…å®¹ä¹‹å¤–çš„ â€œ<strong>è¾…åŠ©ä¿¡æ¯è½½ä½“</strong>â€ï¼Œä¸å½±å“æ¶ˆæ¯çš„åˆ†åŒºè·¯ç”±ï¼Œä»…ç”¨äºä¸šåŠ¡ä¾§çš„æ¶ˆæ¯æº¯æºã€è¿‡æ»¤ã€æ‰©å±•ã€‚</li>
</ul>
</li>
</ul>
<h4 id="2-æ ¸å¿ƒå®šä½-2">&lt;2&gt;æ ¸å¿ƒå®šä½</h4>
<ul>
<li><strong>å…ƒæ•°æ®æ‰©å±•</strong>ï¼š
<ul>
<li><strong>å¼¥è¡¥ Kafka æ¶ˆæ¯ Key/Value ä»…èƒ½å­˜å‚¨ä¸šåŠ¡æ•°æ®çš„ä¸è¶³</strong></li>
<li>æ”¯æŒé™„åŠ å¤šç»„é”®å€¼å¯¹å…ƒæ•°æ®ï¼ˆå¦‚ trace-id: 123456ã€msg-type: orderï¼‰ï¼›</li>
</ul>
</li>
<li><strong>å¯å†™ / åªè¯»ç‰¹æ€§</strong>ï¼š
<ul>
<li>ç”Ÿäº§è€…ä¾§å¯åˆ›å»ºå¹¶å†™å…¥ Headers</li>
<li>æ¶ˆè´¹è€…ä¾§ä»…èƒ½è¯»å– Headersï¼ˆ<strong>æ¶ˆæ¯ä¸€æ—¦å‘é€ï¼ŒHeaders ä¸å¯ä¿®æ”¹</strong>ï¼‰ï¼›</li>
</ul>
</li>
<li><strong>è½»é‡çº§è®¾è®¡</strong>ï¼š
<ul>
<li>Headers å­˜å‚¨çš„æ˜¯å­—ç¬¦ä¸²é”®å€¼å¯¹ï¼Œ<strong>å»ºè®®ä»…å­˜æ”¾è½»é‡å…ƒæ•°æ®</strong>ï¼ˆé¿å…å¢å¤§æ¶ˆæ¯ä½“ç§¯ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>è·¨ç³»ç»Ÿå…¼å®¹</strong>ï¼š
<ul>
<li>æ¶ˆæ¯å¤´æ˜¯ Kafka åè®®æ ‡å‡†ç‰¹æ€§ï¼Œå¯ä¸å…¶ä»– Kafka å®¢æˆ·ç«¯ï¼ˆå¦‚ Javaã€Pythonï¼‰äº’é€šï¼Œä¾¿äºå¤šè¯­è¨€ç³»ç»Ÿåä½œï¼›</li>
</ul>
</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰Headersç±»çš„å®šä¹‰">ï¼ˆ2ï¼‰Headersç±»çš„å®šä¹‰</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RD_EXPORT</span> Headers &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Headers</span>() = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief å•ä¸ª Header å¯¹è±¡ï¼ˆé”®å€¼å¯¹ + é”™è¯¯ç ï¼‰</span></span><br><span class="line"><span class="comment">     * @remark ä¸æ”¯æŒåŠ¨æ€åˆ†é…ï¼ˆnewï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Header</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * @brief æ„é€  Header</span></span><br><span class="line"><span class="comment">         * @param key    Header çš„é”®ï¼ˆå­—ç¬¦ä¸²ï¼‰</span></span><br><span class="line"><span class="comment">         * @param value  Header çš„å€¼ï¼ˆäºŒè¿›åˆ¶ï¼Œå¯ä¸º NULLï¼‰</span></span><br><span class="line"><span class="comment">         * @param value_size  å€¼çš„å­—èŠ‚é•¿åº¦</span></span><br><span class="line"><span class="comment">         * @remark key å’Œ value ä¼šè¢«å¤åˆ¶</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="built_in">Header</span>(<span class="type">const</span> std::string &amp;key, <span class="type">const</span> <span class="type">void</span> *value, <span class="type">size_t</span> value_size);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * @brief æ„é€  Headerï¼ˆå¸¦é”™è¯¯ç ï¼‰</span></span><br><span class="line"><span class="comment">         * @param key    Header çš„é”®</span></span><br><span class="line"><span class="comment">         * @param value  Header çš„å€¼</span></span><br><span class="line"><span class="comment">         * @param value_size  å€¼çš„å­—èŠ‚é•¿åº¦</span></span><br><span class="line"><span class="comment">         * @param err    é”™è¯¯ç ï¼ˆç”¨äº get_last() å†…éƒ¨æ„é€ å¤±è´¥ç»“æœï¼‰</span></span><br><span class="line"><span class="comment">         * @remark è‹¥ err != ERR_NO_ERRORï¼Œvalue å’Œ value_size å­—æ®µæœªå®šä¹‰</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="built_in">Header</span>(<span class="type">const</span> std::string &amp;key, <span class="type">const</span> <span class="type">void</span> *value, <span class="type">size_t</span> value_size, </span><br><span class="line">               <span class="type">const</span> RdKafka::ErrorCode err);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">Header</span>(<span class="type">const</span> Header &amp;other);              <span class="comment">// æ‹·è´æ„é€ </span></span><br><span class="line">        Header &amp;<span class="keyword">operator</span>=(<span class="type">const</span> Header &amp;other);   <span class="comment">// èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">        ~<span class="built_in">Header</span>();</span><br><span class="line"></span><br><span class="line">        <span class="function">std::string <span class="title">key</span><span class="params">()</span> <span class="type">const</span></span>;                  <span class="comment">// è·å–é”®å</span></span><br><span class="line">        <span class="function"><span class="type">const</span> <span class="type">void</span> *<span class="title">value</span><span class="params">()</span> <span class="type">const</span></span>;                <span class="comment">// è·å–äºŒè¿›åˆ¶å€¼ï¼ˆå¯èƒ½ä¸º NULLï¼‰</span></span><br><span class="line">        <span class="function"><span class="type">const</span> <span class="type">char</span> *<span class="title">value_string</span><span class="params">()</span> <span class="type">const</span></span>;         <span class="comment">// è·å–å€¼å¹¶è½¬ä¸º C å­—ç¬¦ä¸²ï¼ˆå¯èƒ½ä¸º NULLï¼‰</span></span><br><span class="line">        <span class="function"><span class="type">size_t</span> <span class="title">value_size</span><span class="params">()</span> <span class="type">const</span></span>;                <span class="comment">// è·å–å€¼çš„å­—èŠ‚é•¿åº¦</span></span><br><span class="line">        <span class="function">RdKafka::ErrorCode <span class="title">err</span><span class="params">()</span> <span class="type">const</span></span>;           <span class="comment">// è·å–é”™è¯¯ç ï¼ˆé€šå¸¸ä¸º ERR_NO_ERRORï¼‰</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="function"><span class="type">char</span> *<span class="title">copy_value</span><span class="params">(<span class="type">const</span> <span class="type">void</span> *value, <span class="type">size_t</span> value_size)</span></span>;</span><br><span class="line">        std::string key_;</span><br><span class="line">        RdKafka::ErrorCode err_;</span><br><span class="line">        <span class="type">char</span> *value_;</span><br><span class="line">        <span class="type">size_t</span> value_size_;</span><br><span class="line">        <span class="function"><span class="type">void</span> *<span class="keyword">operator</span> <span class="title">new</span><span class="params">(<span class="type">size_t</span>)</span></span>;               <span class="comment">// ç¦æ­¢åŠ¨æ€åˆ†é…</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief åˆ›å»ºç©ºçš„ Headers å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * @returns ç©º Headers åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="type">static</span> Headers *<span class="title">create</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief ä» std::vector åˆ›å»º Headers å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * @param headers  Header å‘é‡ï¼ˆä¼šè¢«å¤åˆ¶ï¼Œéå¼•ç”¨ï¼‰</span></span><br><span class="line"><span class="comment">     * @returns Headers åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="type">static</span> Headers *<span class="title">create</span><span class="params">(<span class="type">const</span> std::vector&lt;Header&gt; &amp;headers)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief æ·»åŠ  Headerï¼ˆäºŒè¿›åˆ¶å€¼ï¼‰</span></span><br><span class="line"><span class="comment">     * @param key    é”®å</span></span><br><span class="line"><span class="comment">     * @param value  äºŒè¿›åˆ¶å€¼ï¼ˆå¯ä¸º NULLï¼‰</span></span><br><span class="line"><span class="comment">     * @param value_size  å€¼çš„å­—èŠ‚é•¿åº¦</span></span><br><span class="line"><span class="comment">     * @returns é”™è¯¯ç </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ErrorCode <span class="title">add</span><span class="params">(<span class="type">const</span> std::string &amp;key, <span class="type">const</span> <span class="type">void</span> *value, <span class="type">size_t</span> value_size)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief æ·»åŠ  Headerï¼ˆå­—ç¬¦ä¸²å€¼ï¼Œä¾¿æ·æ–¹æ³•ï¼‰</span></span><br><span class="line"><span class="comment">     * @param key    é”®å</span></span><br><span class="line"><span class="comment">     * @param value  å­—ç¬¦ä¸²å€¼</span></span><br><span class="line"><span class="comment">     * @returns é”™è¯¯ç </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ErrorCode <span class="title">add</span><span class="params">(<span class="type">const</span> std::string &amp;key, <span class="type">const</span> std::string &amp;value)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief æ·»åŠ  Headerï¼ˆå¤åˆ¶å·²æœ‰ Header å¯¹è±¡ï¼‰</span></span><br><span class="line"><span class="comment">     * @param header  è¦å¤åˆ¶çš„ Header</span></span><br><span class="line"><span class="comment">     * @returns é”™è¯¯ç </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ErrorCode <span class="title">add</span><span class="params">(<span class="type">const</span> Header &amp;header)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief ç§»é™¤æŒ‡å®š key çš„æ‰€æœ‰ Header</span></span><br><span class="line"><span class="comment">     * @param key  è¦ç§»é™¤çš„é”®å</span></span><br><span class="line"><span class="comment">     * @returns é”™è¯¯ç </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ErrorCode <span class="title">remove</span><span class="params">(<span class="type">const</span> std::string &amp;key)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief è·å–æŒ‡å®š key çš„æ‰€æœ‰ Header</span></span><br><span class="line"><span class="comment">     * @param key  é”®å</span></span><br><span class="line"><span class="comment">     * @returns åŒ…å«æ‰€æœ‰åŒ¹é… Header çš„å‘é‡ï¼ˆæ”¯æŒé‡å¤ keyï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> std::vector&lt;Header&gt; <span class="title">get</span><span class="params">(<span class="type">const</span> std::string &amp;key)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief è·å–æŒ‡å®š key çš„æœ€åä¸€ä¸ª Header</span></span><br><span class="line"><span class="comment">     * @param key  é”®å</span></span><br><span class="line"><span class="comment">     * @returns æ‰¾åˆ°åˆ™è¿”å› Headerï¼Œæœªæ‰¾åˆ°åˆ™è¿”å› err=ERR__NOENT çš„ Header</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Header <span class="title">get_last</span><span class="params">(<span class="type">const</span> std::string &amp;key)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief è·å–æ‰€æœ‰ Header</span></span><br><span class="line"><span class="comment">     * @returns åŒ…å«æ‰€æœ‰ Header çš„å‘é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> std::vector&lt;Header&gt; <span class="title">get_all</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief è·å– Header æ•°é‡</span></span><br><span class="line"><span class="comment">     * @returns Header ä¸ªæ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">size_t</span> <span class="title">size</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰ä½¿ç”¨ç¤ºä¾‹">ï¼ˆ3ï¼‰ä½¿ç”¨ç¤ºä¾‹</h3>
<h4 id="1-ç”Ÿäº§è€…å†™å…¥-Headers-ç¤ºä¾‹">&lt;1&gt;ç”Ÿäº§è€…å†™å…¥ Headers ç¤ºä¾‹</h4>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. åˆ›å»º Headers å¯¹è±¡</span></span><br><span class="line">RdKafka::Headers *headers = RdKafka::Headers::<span class="built_in">create</span>();</span><br><span class="line"><span class="keyword">if</span> (!headers) &#123;</span><br><span class="line">    std::cerr &lt;&lt; <span class="string">&quot;åˆ›å»º Headers å¤±è´¥&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. æ·»åŠ é”®å€¼å¯¹ï¼ˆæ”¯æŒå¤šç»„ï¼‰</span></span><br><span class="line">headers-&gt;<span class="built_in">add</span>(<span class="string">&quot;trace-id&quot;</span>, <span class="string">&quot;trace-789012&quot;</span>);              <span class="comment">// å­—ç¬¦ä¸²é‡è½½ï¼ˆæ¨èï¼‰</span></span><br><span class="line">headers-&gt;<span class="built_in">add</span>(<span class="string">&quot;msg-type&quot;</span>, <span class="string">&quot;payment&quot;</span>);                   <span class="comment">// å­—ç¬¦ä¸²é‡è½½</span></span><br><span class="line">headers-&gt;<span class="built_in">add</span>(<span class="string">&quot;timestamp&quot;</span>, std::<span class="built_in">to_string</span>(<span class="built_in">time</span>(<span class="literal">nullptr</span>)));  <span class="comment">// å­—ç¬¦ä¸²é‡è½½</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–ä½¿ç”¨äºŒè¿›åˆ¶å½¢å¼</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* binary_data = <span class="string">&quot;binary-value&quot;</span>;</span><br><span class="line">headers-&gt;<span class="built_in">add</span>(<span class="string">&quot;binary-key&quot;</span>, binary_data, <span class="built_in">strlen</span>(binary_data));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. å‘é€æ¶ˆæ¯æ—¶é™„åŠ  Headers</span></span><br><span class="line">RdKafka::ErrorCode err = producer-&gt;<span class="built_in">produce</span>(</span><br><span class="line">    <span class="string">&quot;my-topic&quot;</span>,</span><br><span class="line">    RdKafka::Topic::PARTITION_UA,</span><br><span class="line">    RdKafka::Producer::RK_MSG_COPY,</span><br><span class="line">    <span class="built_in">const_cast</span>&lt;<span class="type">char</span>*&gt;(<span class="string">&quot;order-payload&quot;</span>), <span class="number">13</span>,</span><br><span class="line">    <span class="built_in">const_cast</span>&lt;<span class="type">char</span>*&gt;(<span class="string">&quot;order-key&quot;</span>), <span class="number">9</span>,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    headers,    <span class="comment">// é™„åŠ æ¶ˆæ¯å¤´</span></span><br><span class="line">    <span class="literal">nullptr</span>     <span class="comment">// opaque</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (err != RdKafka::ERR_NO_ERROR) &#123;</span><br><span class="line">    std::cerr &lt;&lt; <span class="string">&quot;å‘é€å¤±è´¥ï¼š&quot;</span> &lt;&lt; RdKafka::<span class="built_in">err2str</span>(err) &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">delete</span> headers;  <span class="comment">// âš ï¸ produce() å¤±è´¥æ—¶éœ€æ‰‹åŠ¨é‡Šæ”¾</span></span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// âš ï¸ produce() æˆåŠŸåï¼Œheaders æ‰€æœ‰æƒè½¬ç§»ç»™ librdkafkaï¼Œæ— éœ€æ‰‹åŠ¨ delete</span></span><br></pre></td></tr></table></figure>
<h4 id="2-æ¶ˆè´¹è€…è¯»å–-Headers-ç¤ºä¾‹">&lt;2&gt;æ¶ˆè´¹è€…è¯»å– Headers ç¤ºä¾‹</h4>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ¶ˆè´¹æ¶ˆæ¯å¹¶è¯»å– Headers</span></span><br><span class="line">RdKafka::Message *msg = consumer-&gt;<span class="built_in">consume</span>(<span class="number">1000</span>);</span><br><span class="line"><span class="keyword">if</span> (!msg || msg-&gt;<span class="built_in">err</span>() != RdKafka::ERR_NO_ERROR) &#123;</span><br><span class="line">    <span class="keyword">delete</span> msg;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. è·å–æ¶ˆæ¯çš„ Headers å¯¹è±¡ï¼ˆæ—  Headers åˆ™è¿”å› nullptrï¼‰</span></span><br><span class="line">RdKafka::Headers *headers = msg-&gt;<span class="built_in">headers</span>();</span><br><span class="line"><span class="keyword">if</span> (headers) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;æ¶ˆæ¯å¤´æ•°é‡ï¼š&quot;</span> &lt;&lt; headers-&gt;<span class="built_in">size</span>() &lt;&lt; std::endl;  <span class="comment">// âœ… ç”¨ size()</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. è¯»å–æŒ‡å®š key çš„æ‰€æœ‰å€¼ï¼ˆæ”¯æŒé‡å¤ keyï¼‰</span></span><br><span class="line">    std::vector&lt;RdKafka::Headers::Header&gt; trace_headers = headers-&gt;<span class="built_in">get</span>(<span class="string">&quot;trace-id&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; h : trace_headers) &#123;</span><br><span class="line">        <span class="keyword">if</span> (h.<span class="built_in">err</span>() == RdKafka::ERR_NO_ERROR) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;trace-idï¼š&quot;</span> &lt;&lt; h.<span class="built_in">value_string</span>() &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. è¯»å–æŒ‡å®š key çš„æœ€åä¸€ä¸ªå€¼</span></span><br><span class="line">    RdKafka::Headers::Header last_trace = headers-&gt;<span class="built_in">get_last</span>(<span class="string">&quot;trace-id&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (last_trace.<span class="built_in">err</span>() == RdKafka::ERR_NO_ERROR) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;æœ€åä¸€ä¸ª trace-idï¼š&quot;</span> &lt;&lt; last_trace.<span class="built_in">value_string</span>() &lt;&lt; std::endl;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;æœªæ‰¾åˆ° trace-id&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. éå†æ‰€æœ‰ Headers</span></span><br><span class="line">    std::vector&lt;RdKafka::Headers::Header&gt; all_headers = headers-&gt;<span class="built_in">get_all</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; all_headers.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">        <span class="type">const</span> <span class="keyword">auto</span>&amp; h = all_headers[i];</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Header[&quot;</span> &lt;&lt; i &lt;&lt; <span class="string">&quot;]ï¼š&quot;</span> &lt;&lt; h.<span class="built_in">key</span>() &lt;&lt; <span class="string">&quot; = &quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (h.<span class="built_in">value</span>()) &#123;</span><br><span class="line">            std::cout &lt;&lt; h.<span class="built_in">value_string</span>() &lt;&lt; std::endl;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;(null)&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;è¯¥æ¶ˆæ¯æ— æ¶ˆæ¯å¤´&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> msg;</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ4ï¼‰æ ¸å¿ƒæ³¨æ„äº‹é¡¹">ï¼ˆ4ï¼‰æ ¸å¿ƒæ³¨æ„äº‹é¡¹</h3>
<ul>
<li><strong>å†…å­˜ç®¡ç†</strong>ï¼š
<ul>
<li><strong>ç”Ÿäº§è€…ä¾§</strong>ï¼šcreate() åˆ›å»ºçš„ Headers
<ul>
<li>è‹¥ produce() <strong>æˆåŠŸ</strong>ï¼šåˆ™æ‰€æœ‰æƒè½¬ç§»ç»™ librdkafkaï¼Œ<strong>æ— éœ€æ‰‹åŠ¨é‡Šæ”¾</strong>ï¼›</li>
<li>è‹¥ produce() <strong>å¤±è´¥</strong>ï¼šåˆ™<strong>éœ€æ‰‹åŠ¨ delete</strong>ï¼›</li>
</ul>
</li>
<li><strong>æ¶ˆè´¹è€…</strong>ä¾§ä» msg-&gt;headers() è·å–çš„ Headers ç”± Message å¯¹è±¡ç®¡ç†
<ul>
<li><strong>æ— éœ€æ‰‹åŠ¨é‡Šæ”¾</strong>ï¼ˆé‡Šæ”¾ Message æ—¶è‡ªåŠ¨é‡Šæ”¾ï¼‰ï¼›</li>
</ul>
</li>
</ul>
</li>
<li><strong>ç©ºå€¼å¤„ç†</strong>ï¼š
<ul>
<li>Header çš„ Value å¯ä»¥ä¸ºç©ºï¼ˆvalue=nullptrï¼Œvalue_len=0ï¼‰ï¼Œéœ€åœ¨è¯»å–æ—¶åˆ¤æ–­ val æ˜¯å¦ä¸º nullptrï¼›</li>
</ul>
</li>
<li><strong>get_last() é”™è¯¯å¤„ç†</strong>ï¼š
<ul>
<li>æœªæ‰¾åˆ°æ—¶è¿”å› err=ERR__NOENT çš„ Headerï¼Œéœ€æ£€æŸ¥ h.err() åå†ä½¿ç”¨ value()ï¼›</li>
</ul>
</li>
<li><strong>æ€§èƒ½å½±å“</strong>ï¼š
<ul>
<li>Headers ä¼šå¢åŠ æ¶ˆæ¯ä½“ç§¯ï¼Œå»ºè®®å•æ¡æ¶ˆæ¯çš„ Headers æ€»å¤§å°ä¸è¶…è¿‡ 1KBï¼Œé¿å…å½±å“ååé‡ã€‚</li>
</ul>
</li>
</ul>
<h2 id="5-Handleç±»ï¼ˆå¥æŸ„åŸºç±»ï¼‰">5.Handleç±»ï¼ˆå¥æŸ„åŸºç±»ï¼‰</h2>
<h3 id="ï¼ˆ1ï¼‰æ¦‚è¿°-3">ï¼ˆ1ï¼‰æ¦‚è¿°</h3>
<h4 id="1-ä½œç”¨-3">&lt;1&gt;ä½œç”¨</h4>
<ul>
<li>RdKafka::Handle æ˜¯ librdkafka ä¸­<strong>ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å®¢æˆ·ç«¯</strong>ï¼ˆProducer / Consumer / KafkaConsumerï¼‰<strong>çš„æŠ½è±¡åŸºç±»</strong>
<ul>
<li><strong>å®šä¹‰äº†å®¢æˆ·ç«¯çš„é€šç”¨èƒ½åŠ›</strong>ï¼ˆäº‹ä»¶è½®è¯¢ï¼ˆpollï¼‰ã€å…ƒæ•°æ®/åç§»é‡æŸ¥è¯¢ã€æµæ§ï¼ˆpause/resumeï¼‰ã€é›†ç¾¤ä¿¡æ¯è·å–ç­‰ï¼‰ï¼Œæ˜¯æ•´ä¸ª librdkafka å®¢æˆ·ç«¯çš„ â€œåŸºç¡€éª¨æ¶â€</li>
<li><strong>ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å®¢æˆ·ç«¯</strong>ï¼ˆå¦‚ Producerã€Consumerã€KafkaConsumerï¼‰å‡ç»§æ‰¿è‡ª Handleï¼Œå› æ­¤<strong>å…·å¤‡ç»Ÿä¸€çš„åŸºç¡€è¡Œä¸º</strong>ã€‚</li>
</ul>
</li>
</ul>
<h4 id="2-æ ¸å¿ƒå®šä½-3">&lt;2&gt;æ ¸å¿ƒå®šä½</h4>
<ul>
<li><strong>æŠ½è±¡é€šç”¨èƒ½åŠ›</strong>ï¼š
<ul>
<li>æå–ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…çš„å…±æ€§æ“ä½œï¼ˆå¦‚é…ç½®è·å–ã€é”™è¯¯ç è½¬æ¢ã€èµ„æºé”€æ¯ï¼‰ï¼Œé¿å…ä»£ç å†—ä½™ï¼›</li>
</ul>
</li>
<li><strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ï¼š
<ul>
<li>å®šä¹‰å®¢æˆ·ç«¯çš„åˆ›å»º / é”€æ¯è§„èŒƒï¼Œç»Ÿä¸€ç®¡ç†ä¸ Kafka é›†ç¾¤çš„è¿æ¥èµ„æºï¼›</li>
</ul>
</li>
<li><strong>çŠ¶æ€ä¸é…ç½®ç»Ÿä¸€</strong>ï¼š
<ul>
<li>æä¾›å…¨å±€çš„é…ç½®æŸ¥è¯¢ã€é”™è¯¯å¤„ç†ã€æ—¥å¿—ç›¸å…³æ¥å£ï¼Œä¿è¯ä¸åŒå®¢æˆ·ç«¯çš„ä½¿ç”¨ä½“éªŒä¸€è‡´ï¼›</li>
</ul>
</li>
<li><strong>çº¯æŠ½è±¡ç±»ç‰¹æ€§</strong>ï¼š
<ul>
<li>Handle åŒ…å«çº¯è™šå‡½æ•°ï¼Œæ— æ³•ç›´æ¥å®ä¾‹åŒ–ï¼Œä»…èƒ½é€šè¿‡å­ç±»ï¼ˆProducer/Consumer/KafkaConsumerï¼‰ä½¿ç”¨å…¶æ¥å£ã€‚</li>
</ul>
</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰Handle-ç±»çš„å®šä¹‰">ï¼ˆ2ï¼‰Handle ç±»çš„å®šä¹‰</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RD_EXPORT</span> Handle &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Handle</span>() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//=============================================================================</span></span><br><span class="line">    <span class="comment">// ã€ç¬¬ä¸€æ¢¯é˜Ÿã€‘å‡ ä¹æ¯ä¸ªåº”ç”¨éƒ½ä¼šç”¨åˆ°</span></span><br><span class="line">    <span class="comment">//=============================================================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief è½®è¯¢äº‹ä»¶</span></span><br><span class="line"><span class="comment">     * @param timeout_ms è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œ0=éé˜»å¡ï¼Œ-1=æ— é™ç­‰å¾…</span></span><br><span class="line"><span class="comment">     * @returns å¤„ç†çš„äº‹ä»¶æ•°é‡</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @remark è§¦å‘å·²æ³¨å†Œçš„å›è°ƒå‡½æ•°ï¼ˆå¦‚ DeliveryCbã€EventCbï¼‰</span></span><br><span class="line"><span class="comment">     * @warning ç¦æ­¢åœ¨ KafkaConsumer ä¸­ä½¿ç”¨ï¼Œåº”ä½¿ç”¨ consume() ä»£æ›¿</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">poll</span><span class="params">(<span class="type">int</span> timeout_ms)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief è·å–å®¢æˆ·ç«¯åç§°</span></span><br><span class="line"><span class="comment">     * @returns å®¢æˆ·ç«¯åç§°å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> std::string <span class="title">name</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief è·å–å¾…å‘é€/å¾…ç¡®è®¤çš„æ¶ˆæ¯é˜Ÿåˆ—é•¿åº¦</span></span><br><span class="line"><span class="comment">     * @returns é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æ•°é‡</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @remark å¸¸ç”¨äºä¼˜é›…å…³é—­æ—¶ç­‰å¾…æ‰€æœ‰æ¶ˆæ¯å‘é€å®Œæˆ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">outq_len</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//=============================================================================</span></span><br><span class="line">    <span class="comment">// ã€ç¬¬äºŒæ¢¯é˜Ÿã€‘å…ƒæ•°æ®ä¸åç§»é‡æŸ¥è¯¢ï¼ˆå¸¸ç”¨ï¼‰</span></span><br><span class="line">    <span class="comment">//=============================================================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief ä» Broker è¯·æ±‚å…ƒæ•°æ®</span></span><br><span class="line"><span class="comment">     * @param all_topics   true=è¯·æ±‚æ‰€æœ‰ Topicï¼Œfalse=ä»…æœ¬åœ°å·²çŸ¥ Topic</span></span><br><span class="line"><span class="comment">     * @param only_rkt     ä»…è¯·æ±‚æŒ‡å®š Topic çš„å…ƒæ•°æ®ï¼ˆå¯ä¸º NULLï¼‰</span></span><br><span class="line"><span class="comment">     * @param metadatap    [out] å…ƒæ•°æ®ç»“æœæŒ‡é’ˆï¼Œéœ€ç”¨ delete é‡Šæ”¾</span></span><br><span class="line"><span class="comment">     * @param timeout_ms   è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span></span><br><span class="line"><span class="comment">     * @returns ERR_NO_ERROR æˆåŠŸï¼ŒERR__TIMED_OUT è¶…æ—¶ï¼Œå…¶ä»–ä¸ºé”™è¯¯ç </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ErrorCode <span class="title">metadata</span><span class="params">(<span class="type">bool</span> all_topics,</span></span></span><br><span class="line"><span class="params"><span class="function">                               <span class="type">const</span> Topic *only_rkt,</span></span></span><br><span class="line"><span class="params"><span class="function">                               Metadata **metadatap,</span></span></span><br><span class="line"><span class="params"><span class="function">                               <span class="type">int</span> timeout_ms)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief æŸ¥è¯¢åˆ†åŒºçš„æ°´ä½åç§»é‡ï¼ˆä» Broker å®æ—¶æŸ¥è¯¢ï¼‰</span></span><br><span class="line"><span class="comment">     * @param topic      Topic åç§°</span></span><br><span class="line"><span class="comment">     * @param partition  åˆ†åŒºå·</span></span><br><span class="line"><span class="comment">     * @param low        [out] æœ€ä½åç§»é‡ï¼ˆæœ€æ—©æ¶ˆæ¯ï¼‰</span></span><br><span class="line"><span class="comment">     * @param high       [out] æœ€é«˜åç§»é‡ï¼ˆæœ€æ–°æ¶ˆæ¯ï¼‰</span></span><br><span class="line"><span class="comment">     * @param timeout_ms è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="comment">     * @returns ERR_NO_ERROR æˆåŠŸï¼Œå…¶ä»–ä¸ºé”™è¯¯ç </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ErrorCode <span class="title">query_watermark_offsets</span><span class="params">(<span class="type">const</span> std::string &amp;topic,</span></span></span><br><span class="line"><span class="params"><span class="function">                                              <span class="type">int32_t</span> partition,</span></span></span><br><span class="line"><span class="params"><span class="function">                                              <span class="type">int64_t</span> *low,</span></span></span><br><span class="line"><span class="params"><span class="function">                                              <span class="type">int64_t</span> *high,</span></span></span><br><span class="line"><span class="params"><span class="function">                                              <span class="type">int</span> timeout_ms)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief è·å–ç¼“å­˜çš„åˆ†åŒºæ°´ä½åç§»é‡ï¼ˆæœ¬åœ°ç¼“å­˜ï¼Œä¸è¯·æ±‚ Brokerï¼‰</span></span><br><span class="line"><span class="comment">     * @param topic      Topic åç§°</span></span><br><span class="line"><span class="comment">     * @param partition  åˆ†åŒºå·</span></span><br><span class="line"><span class="comment">     * @param low        [out] æœ€ä½åç§»é‡</span></span><br><span class="line"><span class="comment">     * @param high       [out] æœ€é«˜åç§»é‡</span></span><br><span class="line"><span class="comment">     * @returns ERR_NO_ERROR æˆåŠŸï¼Œå…¶ä»–ä¸ºé”™è¯¯ç </span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @remark ä»…é€‚ç”¨äºæ´»è·ƒçš„æ¶ˆè´¹è€…å®ä¾‹</span></span><br><span class="line"><span class="comment">     * @remark æ— ç¼“å­˜æ—¶è¿”å› OFFSET_INVALID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ErrorCode <span class="title">get_watermark_offsets</span><span class="params">(<span class="type">const</span> std::string &amp;topic,</span></span></span><br><span class="line"><span class="params"><span class="function">                                            <span class="type">int32_t</span> partition,</span></span></span><br><span class="line"><span class="params"><span class="function">                                            <span class="type">int64_t</span> *low,</span></span></span><br><span class="line"><span class="params"><span class="function">                                            <span class="type">int64_t</span> *high)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief æ ¹æ®æ—¶é—´æˆ³æŸ¥æ‰¾åç§»é‡</span></span><br><span class="line"><span class="comment">     * @param offsets    [in/out] TopicPartition åˆ—è¡¨ï¼Œè¾“å…¥ offset å­—æ®µä¸ºæ—¶é—´æˆ³ï¼Œ</span></span><br><span class="line"><span class="comment">     *                   è¾“å‡º offset å­—æ®µä¸ºå¯¹åº”åç§»é‡</span></span><br><span class="line"><span class="comment">     * @param timeout_ms è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="comment">     * @returns ERR_NO_ERROR æˆåŠŸï¼ˆå¯èƒ½æœ‰éƒ¨åˆ†åˆ†åŒºå¤±è´¥ï¼Œéœ€æ£€æŸ¥å„åˆ†åŒºçš„ err()ï¼‰</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @remark æ—¶é—´æˆ³ä¸ºæ¯«ç§’çº§ Unix æ—¶é—´æˆ³ï¼ˆUTCï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ErrorCode <span class="title">offsetsForTimes</span><span class="params">(std::vector&lt;TopicPartition *&gt; &amp;offsets,</span></span></span><br><span class="line"><span class="params"><span class="function">                                      <span class="type">int</span> timeout_ms)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//=============================================================================</span></span><br><span class="line">    <span class="comment">// ã€ç¬¬ä¸‰æ¢¯é˜Ÿã€‘æµæ§ä¸é›†ç¾¤ä¿¡æ¯</span></span><br><span class="line">    <span class="comment">//=============================================================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief æš‚åœæŒ‡å®šåˆ†åŒºçš„ç”Ÿäº§/æ¶ˆè´¹</span></span><br><span class="line"><span class="comment">     * @param partitions åˆ†åŒºåˆ—è¡¨ï¼Œæ¯ä¸ªåˆ†åŒºçš„ç»“æœä¼šå†™å…¥å…¶ err() å­—æ®µ</span></span><br><span class="line"><span class="comment">     * @returns ERR_NO_ERROR</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ErrorCode <span class="title">pause</span><span class="params">(std::vector&lt;TopicPartition *&gt; &amp;partitions)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief æ¢å¤æŒ‡å®šåˆ†åŒºçš„ç”Ÿäº§/æ¶ˆè´¹</span></span><br><span class="line"><span class="comment">     * @param partitions åˆ†åŒºåˆ—è¡¨ï¼Œæ¯ä¸ªåˆ†åŒºçš„ç»“æœä¼šå†™å…¥å…¶ err() å­—æ®µ</span></span><br><span class="line"><span class="comment">     * @returns ERR_NO_ERROR</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ErrorCode <span class="title">resume</span><span class="params">(std::vector&lt;TopicPartition *&gt; &amp;partitions)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief è·å– Kafka é›†ç¾¤ ID</span></span><br><span class="line"><span class="comment">     * @param timeout_ms æ— ç¼“å­˜æ—¶çš„æœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œ0=éé˜»å¡</span></span><br><span class="line"><span class="comment">     * @returns é›†ç¾¤ ID å­—ç¬¦ä¸²ï¼Œå¤±è´¥è¿”å›ç©ºå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @remark è¦æ±‚ Broker ç‰ˆæœ¬ &gt;= 0.10.0 ä¸” api.version.request=true</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> std::string <span class="title">clusterid</span><span class="params">(<span class="type">int</span> timeout_ms)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief è·å–å½“å‰ Controller Broker çš„ ID</span></span><br><span class="line"><span class="comment">     * @param timeout_ms æ— ç¼“å­˜æ—¶çš„æœ€å¤§ç­‰å¾…æ—¶é—´</span></span><br><span class="line"><span class="comment">     * @returns Controller IDï¼Œå¤±è´¥è¿”å› -1</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @remark è¦æ±‚ Broker ç‰ˆæœ¬ &gt;= 0.10.0 ä¸” api.version.request=true</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">int32_t</span> <span class="title">controllerid</span><span class="params">(<span class="type">int</span> timeout_ms)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief è·å–æ¶ˆè´¹è€…çš„ç»„æˆå‘˜ ID</span></span><br><span class="line"><span class="comment">     * @returns æˆå‘˜ IDï¼Œéç»„æˆå‘˜æ—¶è¿”å›ç©ºå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @remark ä»…é€‚ç”¨äºé«˜çº§æ¶ˆè´¹è€…ï¼ˆKafkaConsumerï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> std::string <span class="title">memberid</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//=============================================================================</span></span><br><span class="line">    <span class="comment">// ã€ç¬¬å››æ¢¯é˜Ÿã€‘é˜Ÿåˆ—ç®¡ç†ä¸å›è°ƒæ§åˆ¶</span></span><br><span class="line">    <span class="comment">//=============================================================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief è·å–æŒ‡å®šåˆ†åŒºçš„ Fetch é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     * @param partition åˆ†åŒºå¯¹è±¡</span></span><br><span class="line"><span class="comment">     * @returns é˜Ÿåˆ—æŒ‡é’ˆï¼Œå¤±è´¥è¿”å› NULL</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @remark ä»…é€‚ç”¨äºæ¶ˆè´¹è€…</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Queue *<span class="title">get_partition_queue</span><span class="params">(<span class="type">const</span> TopicPartition *partition)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief å°†æ—¥å¿—è½¬å‘åˆ°æŒ‡å®šé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     * @param queue ç›®æ ‡é˜Ÿåˆ—ï¼ŒNULL è¡¨ç¤ºè½¬å‘åˆ°ä¸»é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     * @returns ERR_NO_ERROR æˆåŠŸ</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @remark éœ€åŒæ—¶è®¾ç½®é…ç½®é¡¹ log.queue=true</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ErrorCode <span class="title">set_log_queue</span><span class="params">(Queue *queue)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief è·å–åå°çº¿ç¨‹é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     * @returns åå°é˜Ÿåˆ—æŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Queue *<span class="title">get_background_queue</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief å–æ¶ˆå½“å‰çš„å›è°ƒåˆ†å‘ï¼ˆç«‹å³ä» poll/consume è¿”å›ï¼‰</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @remark åªèƒ½åœ¨ librdkafka å›è°ƒå‡½æ•°å†…éƒ¨è°ƒç”¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">yield</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//=============================================================================</span></span><br><span class="line">    <span class="comment">// ã€ç¬¬äº”æ¢¯é˜Ÿã€‘é”™è¯¯å¤„ç†ä¸è®¤è¯ï¼ˆç‰¹å®šåœºæ™¯ï¼‰</span></span><br><span class="line">    <span class="comment">//=============================================================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief è·å–é¦–ä¸ªè‡´å‘½é”™è¯¯</span></span><br><span class="line"><span class="comment">     * @param errstr [out] é”™è¯¯æè¿°å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * @returns ERR_NO_ERROR è¡¨ç¤ºæ— è‡´å‘½é”™è¯¯ï¼Œå…¶ä»–ä¸ºé”™è¯¯ç </span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @remark ä¸»è¦ç”¨äºå¹‚ç­‰ç”Ÿäº§è€…çš„é”™è¯¯æ£€æµ‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ErrorCode <span class="title">fatal_error</span><span class="params">(std::string &amp;errstr)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief è®¾ç½® SASL PLAIN/SCRAM è®¤è¯å‡­æ®</span></span><br><span class="line"><span class="comment">     * @param username ç”¨æˆ·å</span></span><br><span class="line"><span class="comment">     * @param password å¯†ç </span></span><br><span class="line"><span class="comment">     * @returns NULL æˆåŠŸï¼Œå¦åˆ™è¿”å› Error å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @remark æ–°å‡­æ®åœ¨ä¸‹æ¬¡è®¤è¯æ—¶ç”Ÿæ•ˆï¼Œä¸ä¼šæ–­å¼€ç°æœ‰è¿æ¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Error *<span class="title">sasl_set_credentials</span><span class="params">(<span class="type">const</span> std::string &amp;username,</span></span></span><br><span class="line"><span class="params"><span class="function">                                        <span class="type">const</span> std::string &amp;password)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief è®¾ç½® SASL/OAUTHBEARER Token</span></span><br><span class="line"><span class="comment">     * @param token_value      Token å€¼ï¼ˆé€šå¸¸ä¸º JWS æ ¼å¼ï¼‰</span></span><br><span class="line"><span class="comment">     * @param md_lifetime_ms   Token è¿‡æœŸæ—¶é—´ï¼ˆæ¯«ç§’çº§ Unix æ—¶é—´æˆ³ï¼‰</span></span><br><span class="line"><span class="comment">     * @param md_principal_name Kafka Principal åç§°</span></span><br><span class="line"><span class="comment">     * @param extensions       æ‰©å±•é”®å€¼å¯¹åˆ—è¡¨ï¼ˆkey1, value1, key2, value2...ï¼‰</span></span><br><span class="line"><span class="comment">     * @param errstr           [out] é”™è¯¯æè¿°</span></span><br><span class="line"><span class="comment">     * @returns ERR_NO_ERROR æˆåŠŸï¼ŒERR__INVALID_ARG å‚æ•°é”™è¯¯ï¼Œ</span></span><br><span class="line"><span class="comment">     *          ERR__NOT_IMPLEMENTED ä¸æ”¯æŒï¼ŒERR__STATE æœªé…ç½® OAUTHBEARER</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ErrorCode <span class="title">oauthbearer_set_token</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="type">const</span> std::string &amp;token_value,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="type">int64_t</span> md_lifetime_ms,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="type">const</span> std::string &amp;md_principal_name,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="type">const</span> std::list&lt;std::string&gt; &amp;extensions,</span></span></span><br><span class="line"><span class="params"><span class="function">        std::string &amp;errstr)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief æ ‡è®° SASL/OAUTHBEARER Token åˆ·æ–°å¤±è´¥</span></span><br><span class="line"><span class="comment">     * @param errstr å¤±è´¥åŸå› æè¿°</span></span><br><span class="line"><span class="comment">     * @returns ERR_NO_ERROR æˆåŠŸ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ErrorCode <span class="title">oauthbearer_set_token_failure</span><span class="params">(<span class="type">const</span> std::string &amp;errstr)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief åœ¨åå°çº¿ç¨‹å¯ç”¨ SASL OAUTHBEARER åˆ·æ–°å›è°ƒ</span></span><br><span class="line"><span class="comment">     * @returns NULL æˆåŠŸï¼Œå¦åˆ™è¿”å› Error å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @remark é€‚ç”¨äºä¸å®šæœŸè°ƒç”¨ poll() çš„åº”ç”¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Error *<span class="title">sasl_background_callbacks_enable</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief è·å– SASL å›è°ƒé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     * @returns é˜Ÿåˆ—æŒ‡é’ˆï¼Œæœªå¯ç”¨æ—¶è¿”å› NULL</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Queue *<span class="title">get_sasl_queue</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//=============================================================================</span></span><br><span class="line">    <span class="comment">// ã€ç¬¬å…­æ¢¯é˜Ÿã€‘åº•å±‚æ“ä½œï¼ˆé«˜çº§ç”¨æ³•ï¼‰</span></span><br><span class="line">    <span class="comment">//=============================================================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief è·å–åº•å±‚ C è¯­è¨€å¥æŸ„</span></span><br><span class="line"><span class="comment">     * @returns rd_kafka_t* æŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @warning ä¸æ¨èç›´æ¥è°ƒç”¨ C APIï¼Œæ— å®˜æ–¹æ”¯æŒ</span></span><br><span class="line"><span class="comment">     * @remark éœ€åœ¨ rdkafkacpp.h ä¹‹å‰åŒ…å« rdkafka.h</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">virtual</span> <span class="keyword">struct</span> <span class="title class_">rd_kafka_s</span> *<span class="built_in">c_ptr</span>() = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief ä½¿ç”¨ librdkafka çš„åˆ†é…å™¨ç”³è¯·å†…å­˜</span></span><br><span class="line"><span class="comment">     * @param size å­—èŠ‚æ•°</span></span><br><span class="line"><span class="comment">     * @returns å†…å­˜æŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @remark å¿…é¡»ä½¿ç”¨ mem_free() é‡Šæ”¾</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> *<span class="title">mem_malloc</span><span class="params">(<span class="type">size_t</span> size)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief é‡Šæ”¾ librdkafka è¿”å›çš„å†…å­˜</span></span><br><span class="line"><span class="comment">     * @param ptr å†…å­˜æŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @remark ä»…ç”¨äº API æ˜ç¡®è¯´æ˜éœ€ä½¿ç”¨æ­¤å‡½æ•°é‡Šæ”¾çš„æŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mem_free</span><span class="params">(<span class="type">void</span> *ptr)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰æ ¸å¿ƒç‰¹æ€§ä¸æ³¨æ„äº‹é¡¹">ï¼ˆ3ï¼‰æ ¸å¿ƒç‰¹æ€§ä¸æ³¨æ„äº‹é¡¹</h3>
<ul>
<li><strong>ç»§æ‰¿å…³ç³»</strong>ï¼š</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">RdKafka::Handleï¼ˆæŠ½è±¡åŸºç±»ï¼‰</span><br><span class="line">â”œâ”€ RdKafka::Producer          <span class="comment">// ç”Ÿäº§è€…</span></span><br><span class="line">â”œâ”€ RdKafka::Consumer          <span class="comment">// ä½çº§æ¶ˆè´¹è€…ï¼ˆSimple Consumerï¼Œå¾ˆå°‘ç”¨ï¼‰</span></span><br><span class="line">â””â”€ RdKafka::KafkaConsumer     <span class="comment">// é«˜çº§æ¶ˆè´¹è€…ï¼ˆHigh-Level Consumerï¼Œ90%+ç”¨å®ƒï¼‰</span></span><br><span class="line"></span><br><span class="line">RdKafka::AdminClient          <span class="comment">// ç®¡ç†å®¢æˆ·ç«¯ï¼ˆç‹¬ç«‹ï¼Œä¸ç»§æ‰¿ Handleï¼‰</span></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><strong>èµ„æºç®¡ç†</strong>ï¼š</p>
<ul>
<li>å®¢æˆ·ç«¯å®ä¾‹ç”± Conf::create() + Producer/KafkaConsumer::create() åˆ›å»º</li>
<li>å¿…é¡»é€šè¿‡ delete é‡Šæ”¾</li>
</ul>
</li>
<li>
<p>Handle å†…éƒ¨ç®¡ç†ä¸ Broker çš„è¿æ¥æ± ã€IO çº¿ç¨‹ã€å®šæ—¶å™¨ï¼Œé”€æ¯æ—¶ä¼šè‡ªåŠ¨æ¸…ç†æ‰€æœ‰èµ„æºï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚</p>
</li>
<li>
<p><strong>çº¿ç¨‹æ¨¡å‹</strong>ï¼š</p>
<ul>
<li>Handle å­ç±»ä¼šå¯åŠ¨å†…éƒ¨ IO çº¿ç¨‹ï¼ˆé»˜è®¤ 1 ä¸ªï¼Œå¯é€šè¿‡ io_threads é…ç½®ï¼‰ï¼Œå¤„ç†ç½‘ç»œé€šä¿¡ã€æ¶ˆæ¯å‘é€ / æ¥æ”¶ï¼›</li>
<li>ä¸šåŠ¡çº¿ç¨‹è°ƒç”¨ poll()/produce() ç­‰ API æ—¶ï¼Œä»…è§¦å‘é€»è¾‘è°ƒåº¦ï¼Œæ ¸å¿ƒ IO ç”±å†…éƒ¨çº¿ç¨‹å¤„ç†ã€‚</li>
</ul>
</li>
</ul>
<h2 id="6-Producerç±»ï¼ˆç”Ÿäº§è€…ç±»ï¼‰">6.Producerç±»ï¼ˆç”Ÿäº§è€…ç±»ï¼‰</h2>
<h3 id="ï¼ˆ1ï¼‰æ¦‚è¿°-4">ï¼ˆ1ï¼‰æ¦‚è¿°</h3>
<h4 id="1-ä½œç”¨-4">&lt;1&gt;ä½œç”¨</h4>
<ul>
<li>RdKafka::Producer æ˜¯ librdkafka ä¸­å®ç° Kafka <strong>â€œæ¶ˆæ¯ç”Ÿäº§é€»è¾‘â€çš„æ ¸å¿ƒç±»</strong>ï¼Œç»§æ‰¿è‡ª RdKafka::Handle æŠ½è±¡åŸºç±»</li>
<li>å°è£…äº†æ¶ˆæ¯å¼‚æ­¥å‘é€ã€åˆ†åŒºè·¯ç”±ã€å›è°ƒé€šçŸ¥ã€èµ„æºç®¡ç†ç­‰å…¨é‡ç”Ÿäº§èƒ½åŠ›ï¼Œæ˜¯<strong>å®¢æˆ·ç«¯å‘ Kafka é›†ç¾¤å‘é€æ¶ˆæ¯çš„å”¯ä¸€å…¥å£</strong>ã€‚</li>
</ul>
<h4 id="2-æ ¸å¿ƒå®šä½-4">&lt;2&gt;æ ¸å¿ƒå®šä½</h4>
<ul>
<li><strong>å¼‚æ­¥å‘é€</strong>ï¼š
<ul>
<li>é»˜è®¤é‡‡ç”¨ â€œ<strong>å¼‚æ­¥éé˜»å¡</strong>â€ æ¨¡å¼ï¼Œ<strong>produce()</strong> ä»…å°†æ¶ˆæ¯æ”¾å…¥<strong>æœ¬åœ°é˜Ÿåˆ—</strong>ï¼Œç”±å†…éƒ¨ IO çº¿ç¨‹å‘é€è‡³ Broker</li>
<li>ä»… flush()/ åŒæ­¥å‘é€ä¼šé˜»å¡</li>
</ul>
</li>
<li><strong>å›è°ƒé©±åŠ¨</strong>ï¼š
<ul>
<li>é€šè¿‡ <strong>DeliveryReportCb</strong> â€œ<strong>å¼‚æ­¥é€šçŸ¥</strong>â€æ¶ˆæ¯å‘é€ç»“æœï¼ˆæˆåŠŸ / å¤±è´¥ï¼‰</li>
</ul>
</li>
<li><strong>åˆ†åŒºè·¯ç”±</strong>ï¼š
<ul>
<li>æ”¯æŒ<strong>å†…ç½®åˆ†åŒºå™¨</strong>ï¼ˆæŒ‰ Key å“ˆå¸Œ / éšæœºï¼‰æˆ–<strong>è‡ªå®šä¹‰åˆ†åŒºå™¨</strong>ï¼ˆPartitionerCbï¼‰</li>
</ul>
</li>
<li><strong>èµ„æºç®¡ç†</strong>ï¼š
<ul>
<li>ç»§æ‰¿ Handle åŸºç±»çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†èƒ½åŠ›ï¼Œé€šè¿‡ <strong>delete</strong> æˆ– <strong>flush() + delete</strong> å®‰å…¨é‡Šæ”¾è¿æ¥ã€çº¿ç¨‹ã€é˜Ÿåˆ—ç­‰èµ„æº</li>
</ul>
</li>
<li><strong>é«˜å¯ç”¨è®¾è®¡</strong>ï¼š
<ul>
<li>æ”¯æŒ<strong>æ¶ˆæ¯é‡è¯•</strong>ã€<strong>æ‰¹é‡å‘é€</strong>ã€<strong>å‹ç¼©</strong>ï¼ˆgzip/snappy/lz4ï¼‰ï¼Œæå‡ååé‡å’Œå¯é æ€§</li>
</ul>
</li>
<li><strong>å¯é æ€§</strong>ï¼š
<ul>
<li>æ”¯æŒæ¶ˆæ¯é‡è¯•ï¼ˆretriesï¼‰ã€ACK ç¡®è®¤ï¼ˆacksï¼‰ã€å¹‚ç­‰ / äº‹åŠ¡ï¼ˆéœ€é…ç½®ï¼‰ï¼›</li>
</ul>
</li>
<li><strong>é«˜æ€§èƒ½</strong>ï¼š
<ul>
<li>æ”¯æŒæ‰¹é‡å‘é€ï¼ˆbatch.sizeï¼‰ã€å¼‚æ­¥ IOï¼Œå‡å°‘ç½‘ç»œè¯·æ±‚æ¬¡æ•°ï¼›</li>
</ul>
</li>
</ul>
<h4 id="3-ç»§æ‰¿å…³ç³»">&lt;3&gt;ç»§æ‰¿å…³ç³»</h4>
<ul>
<li>Producer ç»§æ‰¿è‡ª Handle æŠ½è±¡åŸºç±»ï¼Œå› æ­¤å…·å¤‡ä»¥ä¸‹ Handle é€šç”¨èƒ½åŠ›ï¼š
<ul>
<li><strong>poll()</strong>ï¼šè½®è¯¢äº‹ä»¶ï¼Œè§¦å‘å›è°ƒï¼ˆ<strong>ç”Ÿäº§è€…å¿…é¡»å®šæœŸè°ƒç”¨</strong>ï¼‰</li>
<li><strong>name()</strong>ï¼šè·å–å®¢æˆ·ç«¯åç§°</li>
<li><strong>outq_len()</strong>ï¼šè·å–å¾…å‘é€æ¶ˆæ¯é˜Ÿåˆ—é•¿åº¦</li>
<li>å…ƒæ•°æ®æŸ¥è¯¢ã€æµæ§ç­‰å…¶ä»– Handle æ–¹æ³•</li>
</ul>
</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰Producerç±»çš„å®šä¹‰">ï¼ˆ2ï¼‰Producerç±»çš„å®šä¹‰</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RD_EXPORT</span> Producer : <span class="keyword">public</span> <span class="keyword">virtual</span> Handle &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//=============================================================================</span></span><br><span class="line">    <span class="comment">// ã€ç¬¬ä¸€æ¢¯é˜Ÿã€‘å‡ ä¹æ¯ä¸ªç”Ÿäº§è€…åº”ç”¨éƒ½ä¼šç”¨åˆ°</span></span><br><span class="line">    <span class="comment">//=============================================================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief åˆ›å»º Kafka ç”Ÿäº§è€…å®ä¾‹</span></span><br><span class="line"><span class="comment">     * @param conf é…ç½®å¯¹è±¡ï¼ˆå¯é€‰ï¼‰ï¼Œä¸ä¼ åˆ™ä½¿ç”¨é»˜è®¤é…ç½®ï¼›é…ç½®å¯¹è±¡å¯å¤ç”¨</span></span><br><span class="line"><span class="comment">     * @param errstr [out] é”™è¯¯æè¿°å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * @returns æˆåŠŸè¿”å›ç”Ÿäº§è€…å®ä¾‹ï¼Œå¤±è´¥è¿”å› NULL</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="type">static</span> Producer *<span class="title">create</span><span class="params">(<span class="type">const</span> Conf *conf, std::string &amp;errstr)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Producer</span>() = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief æ¶ˆæ¯æ ‡å¿—ä½ï¼ˆç”¨äº produce() çš„ msgflags å‚æ•°ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">enum</span> &#123;</span><br><span class="line">        RK_MSG_FREE  = <span class="number">0x1</span>,  <span class="comment">/**&lt; librdkafka ä½¿ç”¨å®Œ payload åä¼šè‡ªåŠ¨ free()</span></span><br><span class="line"><span class="comment">                              *   ä¸ RK_MSG_COPY äº’æ–¥ */</span></span><br><span class="line">        RK_MSG_COPY  = <span class="number">0x2</span>,  <span class="comment">/**&lt; librdkafka ä¼šå¤åˆ¶ payload æ•°æ®ï¼Œ</span></span><br><span class="line"><span class="comment">                              *   è°ƒç”¨è¿”å›åä¸å†ä½¿ç”¨åŸæŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">                              *   ä¸ RK_MSG_FREE äº’æ–¥ */</span></span><br><span class="line">        RK_MSG_BLOCK = <span class="number">0x4</span>   <span class="comment">/**&lt; å½“æ¶ˆæ¯é˜Ÿåˆ—æ»¡æ—¶é˜»å¡ produce() è°ƒç”¨</span></span><br><span class="line"><span class="comment">                              *   è­¦å‘Šï¼šä½¿ç”¨æ—¶å¿…é¡»åœ¨å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ poll()</span></span><br><span class="line"><span class="comment">                              *   å¦åˆ™ä¼šå¯¼è‡´æ— é™é˜»å¡ */</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief ç”Ÿäº§å¹¶å‘é€å•æ¡æ¶ˆæ¯åˆ° Brokerï¼ˆå¼‚æ­¥éé˜»å¡ï¼‰</span></span><br><span class="line"><span class="comment">     * @param topic      Topic å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * @param partition  ç›®æ ‡åˆ†åŒºï¼šPARTITION_UA è‡ªåŠ¨åˆ†åŒºï¼Œæˆ– 0..N æŒ‡å®šåˆ†åŒº</span></span><br><span class="line"><span class="comment">     * @param msgflags   æ¶ˆæ¯æ ‡å¿—ï¼šRK_MSG_FREE / RK_MSG_COPY / RK_MSG_BLOCK</span></span><br><span class="line"><span class="comment">     * @param payload    æ¶ˆæ¯å†…å®¹æŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">     * @param len        æ¶ˆæ¯é•¿åº¦ï¼ˆå­—èŠ‚ï¼‰</span></span><br><span class="line"><span class="comment">     * @param key        æ¶ˆæ¯ Keyï¼ˆå¯é€‰ï¼‰ï¼Œç”¨äºåˆ†åŒºé€‰æ‹©å’Œä¼ é€’ç»™æ¶ˆè´¹è€…</span></span><br><span class="line"><span class="comment">     * @param msg_opaque ç”¨æˆ·è‡ªå®šä¹‰æŒ‡é’ˆï¼Œä¼šåœ¨æŠ•é€’å›è°ƒä¸­è¿”å›</span></span><br><span class="line"><span class="comment">     * @returns ERR_NO_ERROR æˆåŠŸå…¥é˜Ÿ</span></span><br><span class="line"><span class="comment">     *          ERR__QUEUE_FULL é˜Ÿåˆ—æ»¡</span></span><br><span class="line"><span class="comment">     *          ERR_MSG_SIZE_TOO_LARGE æ¶ˆæ¯è¿‡å¤§</span></span><br><span class="line"><span class="comment">     *          ERR__UNKNOWN_PARTITION / ERR__UNKNOWN_TOPIC æœªçŸ¥åˆ†åŒº/Topic</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @remark è‹¥è¿”å›é”™è¯¯ä¸”ä½¿ç”¨äº† RK_MSG_FREEï¼Œè°ƒç”¨æ–¹ä»éœ€è´Ÿè´£é‡Šæ”¾ payload</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ErrorCode <span class="title">produce</span><span class="params">(Topic *topic,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">int32_t</span> partition,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">int</span> msgflags,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">void</span> *payload,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">size_t</span> len,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">const</span> std::string *key,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">void</span> *msg_opaque)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief produce() é‡è½½ï¼šKey ä½¿ç”¨æŒ‡é’ˆ+é•¿åº¦å½¢å¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ErrorCode <span class="title">produce</span><span class="params">(Topic *topic,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">int32_t</span> partition,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">int</span> msgflags,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">void</span> *payload,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">size_t</span> len,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">const</span> <span class="type">void</span> *key,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">size_t</span> key_len,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">void</span> *msg_opaque)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief produce() é‡è½½ï¼šTopic ä½¿ç”¨å­—ç¬¦ä¸²ï¼Œæ”¯æŒæŒ‡å®šæ—¶é—´æˆ³ï¼ˆæ¨èï¼‰</span></span><br><span class="line"><span class="comment">     * @param topic_name Topic åç§°ï¼ˆæ— éœ€åˆ›å»º Topic å¯¹è±¡ï¼‰</span></span><br><span class="line"><span class="comment">     * @param timestamp  æ¶ˆæ¯æ—¶é—´æˆ³ï¼ˆæ¯«ç§’çº§ Unix æ—¶é—´æˆ³ï¼ŒUTCï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ErrorCode <span class="title">produce</span><span class="params">(<span class="type">const</span> std::string topic_name,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">int32_t</span> partition,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">int</span> msgflags,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">void</span> *payload,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">size_t</span> len,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">const</span> <span class="type">void</span> *key,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">size_t</span> key_len,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">int64_t</span> timestamp,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">void</span> *msg_opaque)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief produce() é‡è½½ï¼šæ”¯æŒæ¶ˆæ¯å¤´ï¼ˆHeadersï¼‰</span></span><br><span class="line"><span class="comment">     * @param headers æ¶ˆæ¯å¤´å¯¹è±¡ï¼ŒæˆåŠŸæ—¶ä¼šè¢«é‡Šæ”¾ï¼Œå¤±è´¥æ—¶ä¿æŒä¸å˜</span></span><br><span class="line"><span class="comment">     * @warning æˆåŠŸè°ƒç”¨å headers ä¼šè¢«è‡ªåŠ¨é‡Šæ”¾ï¼Œå¤±è´¥æ—¶éœ€è°ƒç”¨æ–¹å¤„ç†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ErrorCode <span class="title">produce</span><span class="params">(<span class="type">const</span> std::string topic_name,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">int32_t</span> partition,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">int</span> msgflags,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">void</span> *payload,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">size_t</span> len,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">const</span> <span class="type">void</span> *key,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">size_t</span> key_len,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">int64_t</span> timestamp,</span></span></span><br><span class="line"><span class="params"><span class="function">                              RdKafka::Headers *headers,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">void</span> *msg_opaque)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief produce() é‡è½½ï¼šä½¿ç”¨ vector ä¼ é€’ key å’Œ payloadï¼ˆè‡ªåŠ¨å¤åˆ¶ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ErrorCode <span class="title">produce</span><span class="params">(Topic *topic,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">int32_t</span> partition,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">const</span> std::vector&lt;<span class="type">char</span>&gt; *payload,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">const</span> std::vector&lt;<span class="type">char</span>&gt; *key,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">void</span> *msg_opaque)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief ç­‰å¾…æ‰€æœ‰å¾…å‘é€æ¶ˆæ¯å®Œæˆï¼ˆåˆ·æ–°ï¼‰</span></span><br><span class="line"><span class="comment">     * @param timeout_ms è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span></span><br><span class="line"><span class="comment">     * @returns ERR_NO_ERROR å…¨éƒ¨å®Œæˆï¼ŒERR__TIMED_OUT è¶…æ—¶</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @remark é”€æ¯ç”Ÿäº§è€…å‰åº”è°ƒç”¨æ­¤æ–¹æ³•ï¼Œç¡®ä¿æ‰€æœ‰æ¶ˆæ¯å‘é€å®Œæˆ</span></span><br><span class="line"><span class="comment">     * @remark ä¼šå¿½ç•¥ linger.ms é…ç½®ï¼Œç«‹å³å‘é€é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     * @remark å†…éƒ¨ä¼šè°ƒç”¨ poll()ï¼Œå› æ­¤ä¼šè§¦å‘å›è°ƒ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ErrorCode <span class="title">flush</span><span class="params">(<span class="type">int</span> timeout_ms)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//=============================================================================</span></span><br><span class="line">    <span class="comment">// ã€ç¬¬äºŒæ¢¯é˜Ÿã€‘ç‰¹æ®Šåœºæ™¯ä½¿ç”¨</span></span><br><span class="line">    <span class="comment">//=============================================================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief æ¸…é™¤ç”Ÿäº§è€…å½“å‰å¤„ç†çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     * @param purge_flags æ¸…é™¤æ ‡å¿—</span></span><br><span class="line"><span class="comment">     * @returns ERR_NO_ERROR æˆåŠŸ</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @remark æ¸…é™¤åéœ€è°ƒç”¨ poll() æˆ– flush() å¤„ç†æŠ•é€’æŠ¥å‘Šå›è°ƒ</span></span><br><span class="line"><span class="comment">     * @remark é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¼šæ”¶åˆ° ERR__PURGE_QUEUE é”™è¯¯</span></span><br><span class="line"><span class="comment">     * @remark ä¼ è¾“ä¸­çš„æ¶ˆæ¯ä¼šæ”¶åˆ° ERR__PURGE_INFLIGHT é”™è¯¯</span></span><br><span class="line"><span class="comment">     * @warning æ¸…é™¤ä¼ è¾“ä¸­æ¶ˆæ¯ä¼šå¯¼è‡´æ— æ³•ç¡®è®¤æ¶ˆæ¯æ˜¯å¦æˆåŠŸï¼Œå¯èƒ½äº§ç”Ÿé‡å¤</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ErrorCode <span class="title">purge</span><span class="params">(<span class="type">int</span> purge_flags)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief æ¸…é™¤æ ‡å¿—ä½</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">enum</span> &#123;</span><br><span class="line">        PURGE_QUEUE        = <span class="number">0x1</span>,  <span class="comment">/**&lt; æ¸…é™¤å†…éƒ¨é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ */</span></span><br><span class="line">        PURGE_INFLIGHT     = <span class="number">0x2</span>,  <span class="comment">/**&lt; æ¸…é™¤ä¼ è¾“ä¸­çš„æ¶ˆæ¯ï¼ˆå¯èƒ½å¯¼è‡´é‡å¤ï¼‰ */</span></span><br><span class="line">        PURGE_NON_BLOCKING = <span class="number">0x4</span>   <span class="comment">/**&lt; ä¸ç­‰å¾…åå°é˜Ÿåˆ—æ¸…é™¤å®Œæˆ */</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//=============================================================================</span></span><br><span class="line">    <span class="comment">// ã€ç¬¬ä¸‰æ¢¯é˜Ÿã€‘äº‹åŠ¡ APIï¼ˆéœ€è¦ Broker &gt;= 0.11.0ï¼‰</span></span><br><span class="line">    <span class="comment">//=============================================================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief åˆå§‹åŒ–äº‹åŠ¡</span></span><br><span class="line"><span class="comment">     * @param timeout_ms æœ€å¤§é˜»å¡æ—¶é—´ï¼Œè¶…æ—¶åå¯åœ¨åå°ç»§ç»­ï¼Œå…è®¸é‡è¯•</span></span><br><span class="line"><span class="comment">     * @returns NULL æˆåŠŸï¼Œå¦åˆ™è¿”å› Error å¯¹è±¡ï¼ˆéœ€ deleteï¼‰</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @remark ä½¿ç”¨äº‹åŠ¡å‰å¿…é¡»å…ˆè°ƒç”¨æ­¤æ–¹æ³•ï¼ˆä»…éœ€ä¸€æ¬¡ï¼‰</span></span><br><span class="line"><span class="comment">     * @remark é€šè¿‡ Error::is_retriable() åˆ¤æ–­æ˜¯å¦å¯é‡è¯•</span></span><br><span class="line"><span class="comment">     * @remark é€šè¿‡ Error::is_fatal() åˆ¤æ–­æ˜¯å¦ä¸ºè‡´å‘½é”™è¯¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Error *<span class="title">init_transactions</span><span class="params">(<span class="type">int</span> timeout_ms)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief å¼€å§‹æ–°äº‹åŠ¡</span></span><br><span class="line"><span class="comment">     * @returns NULL æˆåŠŸï¼Œå¦åˆ™è¿”å› Error å¯¹è±¡ï¼ˆéœ€ deleteï¼‰</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @remark å¿…é¡»å…ˆè°ƒç”¨ init_transactions() æˆåŠŸåæ‰èƒ½ä½¿ç”¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Error *<span class="title">begin_transaction</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief æäº¤å½“å‰äº‹åŠ¡</span></span><br><span class="line"><span class="comment">     * @param timeout_ms æœ€å¤§é˜»å¡æ—¶é—´ï¼Œ-1 è¡¨ç¤ºä½¿ç”¨å‰©ä½™äº‹åŠ¡è¶…æ—¶æ—¶é—´ï¼ˆæ¨èï¼‰</span></span><br><span class="line"><span class="comment">     * @returns NULL æˆåŠŸï¼Œå¦åˆ™è¿”å› Error å¯¹è±¡ï¼ˆéœ€ deleteï¼‰</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @remark å¼ºçƒˆå»ºè®® timeout_ms ä¼  -1</span></span><br><span class="line"><span class="comment">     * @remark æäº¤å‰ä¼šè‡ªåŠ¨ flush æ‰€æœ‰å¾…å‘é€æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     * @remark é€šè¿‡ Error::txn_requires_abort() åˆ¤æ–­æ˜¯å¦éœ€è¦ä¸­æ­¢äº‹åŠ¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Error *<span class="title">commit_transaction</span><span class="params">(<span class="type">int</span> timeout_ms)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief ä¸­æ­¢å½“å‰äº‹åŠ¡</span></span><br><span class="line"><span class="comment">     * @param timeout_ms æœ€å¤§é˜»å¡æ—¶é—´ï¼Œ-1 è¡¨ç¤ºä½¿ç”¨å‰©ä½™äº‹åŠ¡è¶…æ—¶æ—¶é—´ï¼ˆæ¨èï¼‰</span></span><br><span class="line"><span class="comment">     * @returns NULL æˆåŠŸï¼Œå¦åˆ™è¿”å› Error å¯¹è±¡ï¼ˆéœ€ deleteï¼‰</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @remark ç”¨äºä»å¯ä¸­æ­¢çš„äº‹åŠ¡é”™è¯¯ä¸­æ¢å¤</span></span><br><span class="line"><span class="comment">     * @remark ä¼šæ¸…é™¤æ‰€æœ‰å¾…å‘é€æ¶ˆæ¯ï¼Œè§¦å‘ ERR__PURGE_INFLIGHT/QUEUE</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Error *<span class="title">abort_transaction</span><span class="params">(<span class="type">int</span> timeout_ms)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief å‘é€æ¶ˆè´¹åç§»é‡åˆ°äº‹åŠ¡ï¼ˆConsume-Transform-Produce æ¨¡å¼ï¼‰</span></span><br><span class="line"><span class="comment">     * @param offsets        è¦æäº¤çš„åç§»é‡åˆ—è¡¨ï¼ˆåº”ä¸ºä¸‹ä¸€æ¡è¦æ¶ˆè´¹çš„åç§»é‡ï¼‰</span></span><br><span class="line"><span class="comment">     * @param group_metadata æ¶ˆè´¹è€…ç»„å…ƒæ•°æ®ï¼ˆä» KafkaConsumer::groupMetadata() è·å–ï¼‰</span></span><br><span class="line"><span class="comment">     * @param timeout_ms     æœ€å¤§é˜»å¡æ—¶é—´</span></span><br><span class="line"><span class="comment">     * @returns NULL æˆåŠŸï¼Œå¦åˆ™è¿”å› Error å¯¹è±¡ï¼ˆéœ€ deleteï¼‰</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @remark å¿…é¡»åœ¨ç”Ÿäº§è€…å®ä¾‹ä¸Šè°ƒç”¨ï¼Œä¸æ˜¯æ¶ˆè´¹è€…</span></span><br><span class="line"><span class="comment">     * @remark æ¶ˆè´¹è€…å¿…é¡»ç¦ç”¨è‡ªåŠ¨æäº¤ï¼ˆenable.auto.commit=falseï¼‰</span></span><br><span class="line"><span class="comment">     * @remark åœ¨ commit_transaction() ä¹‹å‰è°ƒç”¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Error *<span class="title">send_offsets_to_transaction</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="type">const</span> std::vector&lt;TopicPartition *&gt; &amp;offsets,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="type">const</span> ConsumerGroupMetadata *group_metadata,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="type">int</span> timeout_ms)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰ä½¿ç”¨ç¤ºä¾‹-2">ï¼ˆ3ï¼‰ä½¿ç”¨ç¤ºä¾‹</h3>
<h4 id="1-å¼‚æ­¥å‘é€ç¤ºä¾‹ï¼ˆç”Ÿäº§ç¯å¢ƒé¦–é€‰ï¼‰">&lt;1&gt;å¼‚æ­¥å‘é€ç¤ºä¾‹ï¼ˆç”Ÿäº§ç¯å¢ƒé¦–é€‰ï¼‰</h4>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;librdkafka/rdkafkacpp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;csignal&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¨å±€æ ‡å¿—ï¼šæ§åˆ¶ç”Ÿäº§è€…é€€å‡º</span></span><br><span class="line"><span class="keyword">volatile</span> <span class="type">sig_atomic_t</span> run = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰æŠ•é€’ç»“æœå›è°ƒï¼ˆç»§æ‰¿ DeliveryReportCbï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyDeliveryReportCb</span> : <span class="keyword">public</span> RdKafka::DeliveryReportCb &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dr_cb</span><span class="params">(RdKafka::Message &amp;msg)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å¤„ç†æ¶ˆæ¯å‘é€ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span> (msg.<span class="built_in">err</span>() != RdKafka::ERR_NO_ERROR) &#123;</span><br><span class="line">            <span class="comment">// å‘é€å¤±è´¥</span></span><br><span class="line">            std::cerr &lt;&lt; <span class="string">&quot;[å‘é€å¤±è´¥] Topicï¼š&quot;</span> &lt;&lt; msg.<span class="built_in">topic</span>()</span><br><span class="line">                      &lt;&lt; <span class="string">&quot; åˆ†åŒºï¼š&quot;</span> &lt;&lt; msg.<span class="built_in">partition</span>()</span><br><span class="line">                      &lt;&lt; <span class="string">&quot; é”™è¯¯ï¼š&quot;</span> &lt;&lt; msg.<span class="built_in">errstr</span>() &lt;&lt; std::endl;</span><br><span class="line">            <span class="comment">// å¯é€‰ï¼šè·å–å¤±è´¥æ¶ˆæ¯çš„ Key/å†…å®¹ï¼ˆéœ€è®¾ç½® RK_MSG_COPYï¼‰</span></span><br><span class="line">            <span class="type">const</span> <span class="type">char</span> *key = msg.<span class="built_in">key</span>() ? <span class="built_in">static_cast</span>&lt;<span class="type">const</span> <span class="type">char</span>*&gt;(msg.<span class="built_in">key</span>()) : <span class="string">&quot;æ— Key&quot;</span>;</span><br><span class="line">            std::cerr &lt;&lt; <span class="string">&quot;  Keyï¼š&quot;</span> &lt;&lt; key &lt;&lt; std::endl;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å‘é€æˆåŠŸ</span></span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;[å‘é€æˆåŠŸ] Topicï¼š&quot;</span> &lt;&lt; msg.<span class="built_in">topic</span>()</span><br><span class="line">                      &lt;&lt; <span class="string">&quot; åˆ†åŒºï¼š&quot;</span> &lt;&lt; msg.<span class="built_in">partition</span>()</span><br><span class="line">                      &lt;&lt; <span class="string">&quot; åç§»é‡ï¼š&quot;</span> &lt;&lt; msg.<span class="built_in">offset</span>() &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿¡å·å¤„ç†ï¼šä¼˜é›…é€€å‡º</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sigterm</span><span class="params">(<span class="type">int</span> sig)</span> </span>&#123;</span><br><span class="line">    run = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ========== 1. åˆå§‹åŒ–é…ç½® ==========</span></span><br><span class="line">    std::string errstr;</span><br><span class="line">    <span class="comment">// åˆ›å»ºå…¨å±€é…ç½®ï¼ˆCONF_GLOBALï¼‰</span></span><br><span class="line">    RdKafka::Conf *global_conf = RdKafka::Conf::<span class="built_in">create</span>(RdKafka::Conf::CONF_GLOBAL);</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸»é¢˜é…ç½®ï¼ˆCONF_TOPICï¼Œå¯é€‰ï¼‰</span></span><br><span class="line">    RdKafka::Conf *topic_conf = RdKafka::Conf::<span class="built_in">create</span>(RdKafka::Conf::CONF_TOPIC);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é…ç½®æ ¸å¿ƒå‚æ•°</span></span><br><span class="line">    global_conf-&gt;<span class="built_in">set</span>(<span class="string">&quot;bootstrap.servers&quot;</span>, <span class="string">&quot;localhost:9092&quot;</span>, errstr); <span class="comment">// å¿…å¡«</span></span><br><span class="line">    global_conf-&gt;<span class="built_in">set</span>(<span class="string">&quot;client.id&quot;</span>, <span class="string">&quot;order-producer-01&quot;</span>, errstr);      <span class="comment">// ç”Ÿäº§è€…æ ‡è¯†</span></span><br><span class="line">    global_conf-&gt;<span class="built_in">set</span>(<span class="string">&quot;acks&quot;</span>, <span class="string">&quot;1&quot;</span>, errstr);                           <span class="comment">// ACKçº§åˆ«ï¼šLeaderç¡®è®¤</span></span><br><span class="line">    global_conf-&gt;<span class="built_in">set</span>(<span class="string">&quot;retries&quot;</span>, <span class="string">&quot;3&quot;</span>, errstr);                        <span class="comment">// é‡è¯•3æ¬¡</span></span><br><span class="line">    global_conf-&gt;<span class="built_in">set</span>(<span class="string">&quot;batch.size&quot;</span>, <span class="string">&quot;16384&quot;</span>, errstr);                 <span class="comment">// æ‰¹é‡å¤§å°16KB</span></span><br><span class="line">    global_conf-&gt;<span class="built_in">set</span>(<span class="string">&quot;linger.ms&quot;</span>, <span class="string">&quot;5&quot;</span>, errstr);                      <span class="comment">// å»¶è¿Ÿ5mså‘é€ï¼ˆæ‰¹é‡ï¼‰</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»‘å®šæŠ•é€’å›è°ƒï¼ˆæ ¸å¿ƒï¼šå¼‚æ­¥è·å–å‘é€ç»“æœï¼‰</span></span><br><span class="line">    MyDeliveryReportCb dr_cb;</span><br><span class="line">    global_conf-&gt;<span class="built_in">set</span>(<span class="string">&quot;dr_cb&quot;</span>, &amp;dr_cb, errstr);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ========== 2. åˆ›å»ºç”Ÿäº§è€…å®ä¾‹ ==========</span></span><br><span class="line">    RdKafka::Producer *producer = RdKafka::Producer::<span class="built_in">create</span>(global_conf, errstr);</span><br><span class="line">    <span class="keyword">if</span> (!producer) &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;åˆ›å»ºç”Ÿäº§è€…å¤±è´¥ï¼š&quot;</span> &lt;&lt; errstr &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">delete</span> global_conf;</span><br><span class="line">        <span class="keyword">delete</span> topic_conf;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡Šæ”¾é…ç½®å¯¹è±¡ï¼ˆç”Ÿäº§è€…åˆ›å»ºåï¼Œé…ç½®å·²æ‹·è´ï¼Œå¯é‡Šæ”¾ï¼‰</span></span><br><span class="line">    <span class="keyword">delete</span> global_conf;</span><br><span class="line">    <span class="keyword">delete</span> topic_conf;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ========== 3. æ³¨å†Œä¿¡å·å¤„ç†ï¼ˆä¼˜é›…é€€å‡ºï¼‰ ==========</span></span><br><span class="line">    <span class="built_in">signal</span>(SIGINT, sigterm);</span><br><span class="line">    <span class="built_in">signal</span>(SIGTERM, sigterm);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ========== 4. å¾ªç¯å‘é€æ¶ˆæ¯ ==========</span></span><br><span class="line">    <span class="type">int</span> msg_count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (run &amp;&amp; msg_count &lt; <span class="number">10</span>) &#123; <span class="comment">// å‘é€10æ¡æµ‹è¯•æ¶ˆæ¯</span></span><br><span class="line">        std::string msg_payload = <span class="string">&quot;order_&quot;</span> + std::<span class="built_in">to_string</span>(msg_count); <span class="comment">// æ¶ˆæ¯å†…å®¹</span></span><br><span class="line">        std::string msg_key = <span class="string">&quot;user_1001&quot;</span>;                              <span class="comment">// æ¶ˆæ¯Keyï¼ˆç”¨äºåˆ†åŒºè·¯ç”±ï¼‰</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºæ¶ˆæ¯å¤´ï¼ˆå¯é€‰ï¼Œé™„åŠ å…ƒæ•°æ®ï¼‰</span></span><br><span class="line">        RdKafka::Headers *headers = RdKafka::Headers::<span class="built_in">create</span>();</span><br><span class="line">        std::string trace_id = <span class="string">&quot;trace_789012&quot;</span>;</span><br><span class="line">        std::string msg_type = <span class="string">&quot;order_create&quot;</span>;</span><br><span class="line">        headers-&gt;<span class="built_in">add</span>(<span class="string">&quot;trace-id&quot;</span>, trace_id.<span class="built_in">c_str</span>(), trace_id.<span class="built_in">size</span>());</span><br><span class="line">        headers-&gt;<span class="built_in">add</span>(<span class="string">&quot;msg-type&quot;</span>, msg_type.<span class="built_in">c_str</span>(), msg_type.<span class="built_in">size</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¼‚æ­¥å‘é€æ¶ˆæ¯</span></span><br><span class="line">        <span class="comment">// å‚æ•°è¯´æ˜ï¼š</span></span><br><span class="line">        <span class="comment">// - &quot;order_topic&quot;ï¼šç›®æ ‡Topic</span></span><br><span class="line">        <span class="comment">// - RdKafka::PARTITION_UAï¼ˆ-1ï¼‰ï¼šè‡ªåŠ¨åˆ†é…åˆ†åŒºï¼ˆç”±åˆ†åŒºå™¨å†³å®šï¼‰</span></span><br><span class="line">        <span class="comment">// - RK_MSG_COPYï¼šæ‹·è´æ¶ˆæ¯å†…å®¹ï¼ˆé¿å…æœ¬åœ°å†…å­˜é‡Šæ”¾å¯¼è‡´é—®é¢˜ï¼‰</span></span><br><span class="line">        <span class="comment">// - payload/lenï¼šæ¶ˆæ¯å†…å®¹åŠé•¿åº¦</span></span><br><span class="line">        <span class="comment">// - key/key_lenï¼šæ¶ˆæ¯KeyåŠé•¿åº¦</span></span><br><span class="line">        <span class="comment">// - 0ï¼šè‡ªå®šä¹‰æ—¶é—´æˆ³ï¼ˆ0=ä½¿ç”¨Brokeræ—¶é—´ï¼‰</span></span><br><span class="line">        <span class="comment">// - headersï¼šæ¶ˆæ¯å¤´</span></span><br><span class="line">        <span class="comment">// - nullptrï¼šé€ä¼ ä¸Šä¸‹æ–‡ï¼ˆmsg_opaqueï¼‰</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¼‚æ­¥å‘é€æ¶ˆæ¯</span></span><br><span class="line">        RdKafka::ErrorCode err = producer-&gt;<span class="built_in">produce</span>(</span><br><span class="line">            <span class="string">&quot;order_topic&quot;</span>,</span><br><span class="line">            RdKafka::Topic::PARTITION_UA,</span><br><span class="line">            RdKafka::Producer::RK_MSG_COPY,</span><br><span class="line">            <span class="built_in">const_cast</span>&lt;<span class="type">char</span>*&gt;(msg_payload.<span class="built_in">c_str</span>()), msg_payload.<span class="built_in">size</span>(),</span><br><span class="line">            <span class="built_in">const_cast</span>&lt;<span class="type">char</span>*&gt;(msg_key.<span class="built_in">c_str</span>()), msg_key.<span class="built_in">size</span>(),</span><br><span class="line">            <span class="number">0</span>,       <span class="comment">// æ—¶é—´æˆ³</span></span><br><span class="line">            headers, <span class="comment">// æ¶ˆæ¯å¤´</span></span><br><span class="line">            <span class="literal">nullptr</span>  <span class="comment">// msg_opaque</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// âš ï¸ produceæˆåŠŸè°ƒç”¨å headers ä¼šè¢«è‡ªåŠ¨é‡Šæ”¾ï¼Œå¤±è´¥æ—¶éœ€æ‰‹åŠ¨é‡Šæ”¾</span></span><br><span class="line">        <span class="keyword">if</span> (err != RdKafka::ERR_NO_ERROR) &#123;</span><br><span class="line">            std::cerr &lt;&lt; <span class="string">&quot;å‘é€æ¶ˆæ¯å¤±è´¥ï¼ˆå³æ—¶ï¼‰ï¼š&quot;</span> &lt;&lt; RdKafka::<span class="built_in">err2str</span>(err) &lt;&lt; std::endl;</span><br><span class="line">            <span class="keyword">delete</span> headers;  <span class="comment">// produce å¤±è´¥æ—¶éœ€æ‰‹åŠ¨é‡Šæ”¾ headers</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// é˜Ÿåˆ—æ»¡æ—¶ï¼Œç­‰å¾…å¹¶é‡è¯•</span></span><br><span class="line">            <span class="keyword">if</span> (err == RdKafka::ERR__QUEUE_FULL) &#123;</span><br><span class="line">                producer-&gt;<span class="built_in">poll</span>(<span class="number">100</span>); <span class="comment">// å¤„ç†å†…éƒ¨äº‹ä»¶ï¼Œè…¾å‡ºé˜Ÿåˆ—ç©ºé—´</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®šæœŸè°ƒç”¨pollï¼šé©±åŠ¨å›è°ƒæ‰§è¡Œã€å¤„ç†é‡è¯•ï¼ˆæ ¸å¿ƒï¼å¼‚æ­¥å‘é€å¿…é¡»è°ƒç”¨ï¼‰</span></span><br><span class="line">        producer-&gt;<span class="built_in">poll</span>(<span class="number">0</span>); <span class="comment">// 0msè¶…æ—¶ï¼šéé˜»å¡å¤„ç†</span></span><br><span class="line"></span><br><span class="line">        msg_count++;</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿä¸šåŠ¡å»¶è¿Ÿ</span></span><br><span class="line">        <span class="built_in">usleep</span>(<span class="number">100000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ========== 5. ä¼˜é›…å…³é—­ç”Ÿäº§è€… ==========</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;ç­‰å¾…æ‰€æœ‰æ¶ˆæ¯å‘é€å®Œæˆ...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="comment">// flushï¼šé˜»å¡ç­‰å¾…æ‰€æœ‰æœªå‘é€çš„æ¶ˆæ¯å®Œæˆï¼ˆè¶…æ—¶5ç§’ï¼‰</span></span><br><span class="line">    producer-&gt;<span class="built_in">flush</span>(<span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æŸ¥æ˜¯å¦æœ‰æœªå‘é€å®Œæˆçš„æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">if</span> (producer-&gt;<span class="built_in">outq_len</span>() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;ä»æœ‰ &quot;</span> &lt;&lt; producer-&gt;<span class="built_in">outq_len</span>() &lt;&lt; <span class="string">&quot; æ¡æ¶ˆæ¯æœªå‘é€å®Œæˆ&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ========== 6. é‡Šæ”¾èµ„æº ==========</span></span><br><span class="line">    <span class="keyword">delete</span> producer; <span class="comment">// é‡Šæ”¾ç”Ÿäº§è€…èµ„æº</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-åŒæ­¥å‘é€ç¤ºä¾‹ï¼ˆç‰¹æ®Šåœºæ™¯ä½¿ç”¨ï¼‰">&lt;2&gt;åŒæ­¥å‘é€ç¤ºä¾‹ï¼ˆç‰¹æ®Šåœºæ™¯ä½¿ç”¨ï¼‰</h4>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŒæ­¥å‘é€ï¼šé€šè¿‡ msg_opaque é˜»å¡ç­‰å¾…ç»“æœ</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sync_produce</span><span class="params">(RdKafka::Producer *producer, <span class="type">const</span> std::string &amp;topic, <span class="type">const</span> std::string &amp;payload)</span> </span>&#123;</span><br><span class="line">    std::string errstr;</span><br><span class="line">    RdKafka::ErrorCode err;</span><br><span class="line">    <span class="comment">// ç”¨äºé˜»å¡çš„ä¿¡å·é‡</span></span><br><span class="line">    <span class="type">bool</span> done = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘é€æ¶ˆæ¯ï¼ˆmsg_opaque ä¼ é€’ä¸Šä¸‹æ–‡ï¼‰</span></span><br><span class="line">    err = producer-&gt;<span class="built_in">produce</span>(</span><br><span class="line">        topic,</span><br><span class="line">        RdKafka::PARTITION_UA,</span><br><span class="line">        RdKafka::Producer::RK_MSG_COPY,</span><br><span class="line">        <span class="built_in">const_cast</span>&lt;<span class="type">char</span>*&gt;(payload.<span class="built_in">c_str</span>()), payload.<span class="built_in">size</span>(),</span><br><span class="line">        <span class="literal">nullptr</span>, <span class="number">0</span>,</span><br><span class="line">        <span class="number">0</span>, &amp;done, <span class="literal">nullptr</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (err != RdKafka::ERR_NO_ERROR) &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;åŒæ­¥å‘é€å¤±è´¥ï¼š&quot;</span> &lt;&lt; producer-&gt;<span class="built_in">err2str</span>(err) &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é˜»å¡ç­‰å¾…å‘é€ç»“æœï¼ˆè½®è¯¢+sleepï¼‰</span></span><br><span class="line">    <span class="type">int</span> timeout = <span class="number">5000</span>; <span class="comment">// 5ç§’è¶…æ—¶</span></span><br><span class="line">    <span class="type">int</span> poll_interval = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">while</span> (!done &amp;&amp; timeout &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        producer-&gt;<span class="built_in">poll</span>(poll_interval);</span><br><span class="line">        timeout -= poll_interval;</span><br><span class="line">        <span class="built_in">usleep</span>(poll_interval * <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!done) &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;åŒæ­¥å‘é€è¶…æ—¶&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éœ€ä¿®æ”¹æŠ•é€’å›è°ƒï¼Œè®¾ç½® done æ ‡å¿—ï¼š</span></span><br><span class="line"><span class="comment">// void dr_cb(RdKafka::Message &amp;msg) override &#123;</span></span><br><span class="line"><span class="comment">//     bool *done = static_cast&lt;bool*&gt;(msg.opaque());</span></span><br><span class="line"><span class="comment">//     *done = true;</span></span><br><span class="line"><span class="comment">//     // ... åŸæœ‰é€»è¾‘</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ4ï¼‰å…³é”®æ³¨æ„äº‹é¡¹">ï¼ˆ4ï¼‰å…³é”®æ³¨æ„äº‹é¡¹</h3>
<ul>
<li>
<p><strong>å¼‚æ­¥å‘é€</strong>ï¼š</p>
<ul>
<li>produce() <strong>ä»…</strong>å°†æ¶ˆæ¯å†™å…¥<strong>æœ¬åœ°ç¯å½¢é˜Ÿåˆ—</strong>ï¼Œå†…éƒ¨ IO çº¿ç¨‹å¼‚æ­¥å‘é€</li>
<li>è¿”å› ERR_NO_ERROR <strong>ä»…ä»£è¡¨ â€œå…¥é˜ŸæˆåŠŸâ€</strong>ï¼Œ<strong>ä¸ä»£è¡¨ â€œå‘é€æˆåŠŸâ€</strong></li>
</ul>
</li>
<li>
<p><strong>poll () å¿…é¡»è°ƒç”¨</strong>ï¼š</p>
<ul>
<li>å¼‚æ­¥å‘é€æ—¶ï¼Œpoll() æ˜¯<strong>é©±åŠ¨å›è°ƒæ‰§è¡Œã€å¤„ç†é‡è¯•ã€æ¸…ç†é˜Ÿåˆ—</strong>çš„æ ¸å¿ƒï¼Œéœ€å®šæœŸè°ƒç”¨ï¼ˆå»ºè®®æ¯æ¬¡ produce() åæˆ–å®šæ—¶è°ƒç”¨ï¼‰ï¼›</li>
<li>è‹¥ä¸è°ƒç”¨ poll()ï¼Œ<strong>å›è°ƒä¸ä¼šæ‰§è¡Œï¼Œæ¶ˆæ¯é‡è¯•ä¹Ÿä¼šåœæ»</strong>ï¼Œæœ€ç»ˆå¯¼è‡´å‘é€é˜Ÿåˆ—æ»¡ï¼ˆERR__QUEUE_FULLï¼‰</li>
</ul>
</li>
<li>
<p><strong>æ¶ˆæ¯å¯é æ€§</strong>ï¼š</p>
<ul>
<li>å…³é—­ç”Ÿäº§è€…å‰å¿…é¡»è°ƒç”¨ flush()ï¼Œå¦åˆ™é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¼šä¸¢å¤±ï¼›</li>
<li>acks=all + retries=N æ˜¯æœ€é«˜å¯é æ€§é…ç½®ï¼Œä½†ä¼šé™ä½ååé‡ï¼›</li>
<li>å¯ç”¨ enable.idempotence=true å¯é¿å…é‡å¤å‘é€ï¼ˆå¹‚ç­‰æ€§ï¼‰ï¼›</li>
</ul>
</li>
<li>
<p><strong>åˆ†åŒºç­–ç•¥</strong>ï¼š</p>
<ul>
<li>æŒ‡å®š partition æ•°å€¼ï¼šç›´æ¥å‘é€åˆ°è¯¥åˆ†åŒºï¼›</li>
<li>PARTITION_UAï¼ˆ-1ï¼‰ï¼šæŒ‰ key å“ˆå¸Œåˆ†åŒºï¼ˆæ—  key åˆ™éšæœºï¼‰ï¼›</li>
<li>è‡ªå®šä¹‰ PartitionerCbï¼šæŒ‰ä¸šåŠ¡è§„åˆ™è·¯ç”±ï¼ˆå¦‚ç”¨æˆ· ID å–æ¨¡ï¼‰ï¼›</li>
</ul>
</li>
<li>
<p><strong>æ¶ˆæ¯é‡è¯•</strong>ï¼š</p>
<ul>
<li>é…ç½® retriesï¼ˆé‡è¯•æ¬¡æ•°ï¼‰ã€<a href="http://retry.backoff.ms">retry.backoff.ms</a>ï¼ˆé‡è¯•é—´éš”ï¼‰ï¼Œå¤„ç†ç½‘ç»œæŠ–åŠ¨å¯¼è‡´çš„å‘é€å¤±è´¥ï¼›</li>
</ul>
</li>
<li>
<p><strong>å‹ç¼©é…ç½®</strong>ï¼š</p>
<ul>
<li>é€šè¿‡ compression.type é…ç½®ï¼ˆgzip/snappy/lz4ï¼‰ï¼Œé™ä½ç½‘ç»œä¼ è¾“é‡ã€‚</li>
</ul>
</li>
</ul>
<p><a id="cb"></a></p>
<h2 id="3-RdKafka-xxxCbå›è°ƒç±»">3.RdKafka::xxxCbå›è°ƒç±»</h2>
<ul>
<li>RdKafka::xxxCb æ˜¯ librdkafka ä¸­ä¸€ç»„<strong>æŠ½è±¡å›è°ƒåŸºç±»</strong>çš„ç»Ÿç§°ï¼Œç”¨äºå®ç°å®¢æˆ·ç«¯ä¸ Kafka é›†ç¾¤äº¤äº’çš„ â€œ<strong>å¼‚æ­¥äº‹ä»¶é€šçŸ¥â€ æœºåˆ¶</strong>
<ul>
<li>å®¢æˆ·ç«¯é€šè¿‡ç»§æ‰¿è¿™äº›å›è°ƒç±»å¹¶å®ç°çº¯è™šå‡½æ•°ï¼Œ<strong>å¯ç›‘å¬ç”Ÿäº§ / æ¶ˆè´¹è¿‡ç¨‹ä¸­çš„å…³é”®äº‹ä»¶</strong></li>
<li>å¦‚:æ¶ˆæ¯å‘é€ç»“æœã€æ¶ˆè´¹é”™è¯¯ã€é‡å¹³è¡¡ã€æ—¥å¿—è¾“å‡ºç­‰ï¼Œæ˜¯å®ç°<strong>å¼‚æ­¥åŒ–ã€å®šåˆ¶åŒ–ä¸šåŠ¡</strong>é€»è¾‘çš„æ ¸å¿ƒã€‚</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260116110908752.png" alt=""></p>
<h3 id="ï¼ˆ1ï¼‰DeliveryReportCbï¼ˆç”Ÿäº§è€…æŠ•é€’ç»“æœå›è°ƒï¼‰">ï¼ˆ1ï¼‰DeliveryReportCbï¼ˆç”Ÿäº§è€…æŠ•é€’ç»“æœå›è°ƒï¼‰</h3>
<ul>
<li><strong>ä½œç”¨</strong>ï¼š
<ul>
<li>ç”Ÿäº§è€…<strong>å¼‚æ­¥å‘é€æ¶ˆæ¯ï¼ˆproduce()ï¼‰<strong>åï¼Œé€šè¿‡è¯¥å›è°ƒè·å–æœ€ç»ˆå‘é€ç»“æœï¼Œæ˜¯</strong>å¤„ç†æ¶ˆæ¯å‘é€å¤±è´¥</strong>çš„æ ¸å¿ƒå…¥å£ï¼›</li>
</ul>
</li>
<li><strong>æ³¨æ„</strong>ï¼š
<ul>
<li><strong>ä»…å¼‚æ­¥å‘é€ç”Ÿæ•ˆ</strong>ï¼ŒåŒæ­¥å‘é€ï¼ˆproduce()+flush()ï¼‰æ— éœ€è¯¥å›è°ƒï¼›</li>
</ul>
</li>
</ul>
<h4 id="1-å®šä¹‰">&lt;1&gt;å®šä¹‰</h4>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RD_EXPORT</span> DeliveryReportCb &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// @brief æ¶ˆæ¯æŠ•é€’æŠ¥å‘Šå›è°ƒ</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">dr_cb</span><span class="params">(Message &amp;message)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">DeliveryReportCb</span>() &#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="2-ä½¿ç”¨ç¤ºä¾‹">&lt;2&gt;ä½¿ç”¨ç¤ºä¾‹</h4>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. è‡ªå®šä¹‰æŠ•é€’ç»“æœå›è°ƒç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyDeliveryReportCb</span> : <span class="keyword">public</span> RdKafka::DeliveryReportCb &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dr_cb</span><span class="params">(RdKafka::Message &amp;msg)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (msg.<span class="built_in">err</span>() != RdKafka::ERR_NO_ERROR) &#123;</span><br><span class="line">            std::cerr &lt;&lt; <span class="string">&quot;[å‘é€å¤±è´¥] ä¸»é¢˜ï¼š&quot;</span> &lt;&lt; msg.<span class="built_in">topic_name</span>()</span><br><span class="line">                      &lt;&lt; <span class="string">&quot; åˆ†åŒºï¼š&quot;</span> &lt;&lt; msg.<span class="built_in">partition</span>() </span><br><span class="line">                      &lt;&lt; <span class="string">&quot; é”™è¯¯ï¼š&quot;</span> &lt;&lt; msg.<span class="built_in">errstr</span>() &lt;&lt; std::endl;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;[å‘é€æˆåŠŸ] ä¸»é¢˜ï¼š&quot;</span> &lt;&lt; msg.<span class="built_in">topic_name</span>() </span><br><span class="line">                      &lt;&lt; <span class="string">&quot; åˆ†åŒºï¼š&quot;</span> &lt;&lt; msg.<span class="built_in">partition</span>() </span><br><span class="line">                      &lt;&lt; <span class="string">&quot; åç§»é‡ï¼š&quot;</span> &lt;&lt; msg.<span class="built_in">offset</span>() &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ç»‘å®šåˆ°ç”Ÿäº§è€…é…ç½®</span></span><br><span class="line">MyDeliveryReportCb dr_cb;</span><br><span class="line">producer_conf-&gt;<span class="built_in">set</span>(<span class="string">&quot;dr_cb&quot;</span>, &amp;dr_cb, errstr);</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰EventCbï¼ˆå®¢æˆ·ç«¯åº•å±‚äº‹ä»¶å›è°ƒï¼‰">ï¼ˆ2ï¼‰EventCbï¼ˆå®¢æˆ·ç«¯åº•å±‚äº‹ä»¶å›è°ƒï¼‰</h3>
<ul>
<li><strong>ä½œç”¨</strong>ï¼š
<ul>
<li>ç›‘å¬ librdkafka åº•å±‚æ ¸å¿ƒäº‹ä»¶ï¼ˆå¦‚ Broker è¿æ¥ / æ–­å¼€ã€å…ƒæ•°æ®æ›´æ–°ã€åˆ†åŒº Leader åˆ‡æ¢ã€é™æµï¼‰ï¼Œæ˜¯ç²¾ç»†åŒ–ç›‘æ§å®¢æˆ·ç«¯çŠ¶æ€ã€è°ƒè¯•åº•å±‚é—®é¢˜çš„å…³é”®ï¼›</li>
</ul>
</li>
<li><strong>åŒºåˆ«äº ErrorCb</strong>ï¼š
<ul>
<li>ErrorCb ä»…ç›‘å¬ â€œé”™è¯¯äº‹ä»¶â€ï¼ŒEventCb è¦†ç›– â€œé”™è¯¯ + æ­£å¸¸äº‹ä»¶â€ï¼ˆå¦‚è¿æ¥æˆåŠŸã€å…ƒæ•°æ®æ›´æ–°ï¼‰ï¼Œç²’åº¦æ›´ç»†</li>
</ul>
</li>
<li><strong>äº‹ä»¶ç±»å‹</strong>ï¼š
<ul>
<li>é€šè¿‡ <strong>Event::type()</strong> è·å–ï¼Œæ ¸å¿ƒç±»å‹åŒ…æ‹¬ï¼š
<ul>
<li><strong>EVENT_ERROR</strong>ï¼šé”™è¯¯äº‹ä»¶ï¼ˆç­‰ä»·äº ErrorCbï¼‰ï¼›</li>
<li><strong>EVENT_REBALANCE</strong>ï¼šé‡å¹³è¡¡äº‹ä»¶ï¼ˆç­‰ä»·äº RebalanceCbï¼‰ï¼›</li>
<li><strong>EVENT_LOG</strong>ï¼šæ—¥å¿—äº‹ä»¶ï¼ˆç­‰ä»·äº LogCbï¼‰ï¼›</li>
<li><strong>EVENT_THROTTLE</strong>ï¼šé™æµäº‹ä»¶ï¼ˆç­‰ä»·äº ThrottleCbï¼‰ï¼›</li>
<li><strong>EVENT_CONNECT</strong>ï¼šBroker è¿æ¥æˆåŠŸï¼›</li>
<li><strong>EVENT_DISCONNECT</strong>ï¼šBroker è¿æ¥æ–­å¼€ï¼›</li>
<li><strong>EVENT_METADATA_UPDATED</strong>ï¼šå…ƒæ•°æ®æ›´æ–°ï¼ˆå¦‚ Topic åˆ†åŒºå˜åŒ–ï¼‰ï¼›</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="1-å®šä¹‰-2">&lt;1&gt;å®šä¹‰</h4>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RD_EXPORT</span> EventCb &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// @brief äº‹ä»¶å›è°ƒ</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">event_cb</span><span class="params">(Event &amp;event)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">EventCb</span>() &#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="2-ä½¿ç”¨ç¤ºä¾‹-2">&lt;2&gt;ä½¿ç”¨ç¤ºä¾‹</h4>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. è‡ªå®šä¹‰åº•å±‚äº‹ä»¶å›è°ƒç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyEventCb</span> : <span class="keyword">public</span> RdKafka::EventCb &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// çº¯è™šå‡½æ•°å®ç°ï¼ševent=äº‹ä»¶å¯¹è±¡ï¼ˆåŒ…å«äº‹ä»¶ç±»å‹ã€è¯¦æƒ…ã€å…³è”çš„ Broker/åˆ†åŒºï¼‰</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">event_cb</span><span class="params">(RdKafka::Event &amp;event)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ ¹æ®äº‹ä»¶ç±»å‹åˆ†ç±»å¤„ç†</span></span><br><span class="line">        <span class="keyword">switch</span> (event.<span class="built_in">type</span>()) &#123;</span><br><span class="line">            <span class="keyword">case</span> RdKafka::Event::EVENT_CONNECT:</span><br><span class="line">                <span class="comment">// Broker è¿æ¥æˆåŠŸ</span></span><br><span class="line">                std::cout &lt;&lt; <span class="string">&quot;[äº‹ä»¶] è¿æ¥ Broker æˆåŠŸï¼š&quot;</span> &lt;&lt; event.<span class="built_in">broker_name</span>() &lt;&lt; std::endl;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> RdKafka::Event::EVENT_DISCONNECT:</span><br><span class="line">                <span class="comment">// Broker è¿æ¥æ–­å¼€</span></span><br><span class="line">                std::cerr &lt;&lt; <span class="string">&quot;[äº‹ä»¶] æ–­å¼€ Broker è¿æ¥ï¼š&quot;</span> &lt;&lt; event.<span class="built_in">broker_name</span>() &lt;&lt; std::endl;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> RdKafka::Event::EVENT_METADATA_UPDATED:</span><br><span class="line">                <span class="comment">// å…ƒæ•°æ®æ›´æ–°ï¼ˆå¦‚ Topic åˆ†åŒºæ•°å˜åŒ–ã€Leader åˆ‡æ¢ï¼‰</span></span><br><span class="line">                std::cout &lt;&lt; <span class="string">&quot;[äº‹ä»¶] å…ƒæ•°æ®æ›´æ–°ï¼š&quot;</span> &lt;&lt; event.<span class="built_in">str</span>() &lt;&lt; std::endl;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> RdKafka::Event::EVENT_THROTTLE:</span><br><span class="line">                <span class="comment">// è¢« Broker é™æµï¼ˆç­‰ä»·äº ThrottleCbï¼‰</span></span><br><span class="line">                std::cerr &lt;&lt; <span class="string">&quot;[äº‹ä»¶] è¢« Broker é™æµï¼š&quot;</span> &lt;&lt; event.<span class="built_in">broker_name</span>()</span><br><span class="line">                          &lt;&lt; <span class="string">&quot; é™æµæ—¶é•¿ï¼š&quot;</span> &lt;&lt; event.<span class="built_in">throttle_time_ms</span>() &lt;&lt; <span class="string">&quot;ms&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> RdKafka::Event::EVENT_ERROR:</span><br><span class="line">                <span class="comment">// é”™è¯¯äº‹ä»¶ï¼ˆç­‰ä»·äº ErrorCbï¼‰</span></span><br><span class="line">                std::cerr &lt;&lt; <span class="string">&quot;[äº‹ä»¶] é”™è¯¯ï¼š&quot;</span> &lt;&lt; event.<span class="built_in">str</span>()</span><br><span class="line">                          &lt;&lt; <span class="string">&quot; æ˜¯å¦è‡´å‘½ï¼š&quot;</span> &lt;&lt; (event.<span class="built_in">fatal</span>() ? <span class="string">&quot;æ˜¯&quot;</span> : <span class="string">&quot;å¦&quot;</span>) &lt;&lt; std::endl;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> RdKafka::Event::EVENT_REBALANCE:</span><br><span class="line">                <span class="comment">// é‡å¹³è¡¡äº‹ä»¶ï¼ˆç­‰ä»·äº RebalanceCbï¼‰</span></span><br><span class="line">                std::cout &lt;&lt; <span class="string">&quot;[äº‹ä»¶] é‡å¹³è¡¡ï¼š&quot;</span> &lt;&lt; event.<span class="built_in">str</span>() &lt;&lt; std::endl;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="comment">// å…¶ä»–äº‹ä»¶ï¼ˆå¦‚æ—¥å¿—ã€ç»Ÿè®¡ï¼‰</span></span><br><span class="line">                std::cout &lt;&lt; <span class="string">&quot;[äº‹ä»¶] æœªçŸ¥ç±»å‹ï¼š&quot;</span> &lt;&lt; event.<span class="built_in">type</span>() &lt;&lt; <span class="string">&quot; è¯¦æƒ…ï¼š&quot;</span> &lt;&lt; event.<span class="built_in">str</span>() &lt;&lt; std::endl;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ç»‘å®šåˆ°å…¨å±€é…ç½®ï¼ˆç”Ÿäº§è€…/æ¶ˆè´¹è€…å‡å¯ï¼‰</span></span><br><span class="line">MyEventCb event_cb;</span><br><span class="line">RdKafka::Conf *conf = RdKafka::Conf::<span class="built_in">create</span>(RdKafka::Conf::CONF_GLOBAL);</span><br><span class="line"><span class="keyword">if</span> (conf-&gt;<span class="built_in">set</span>(<span class="string">&quot;event_cb&quot;</span>, &amp;event_cb, errstr) != RdKafka::CONF_OK) &#123;</span><br><span class="line">    std::cerr &lt;&lt; <span class="string">&quot;ç»‘å®šåº•å±‚äº‹ä»¶å›è°ƒå¤±è´¥ï¼š&quot;</span> &lt;&lt; errstr &lt;&lt; std::endl;</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰RebalanceCbï¼ˆæ¶ˆè´¹è€…é‡å¹³è¡¡å›è°ƒï¼‰">ï¼ˆ3ï¼‰RebalanceCbï¼ˆæ¶ˆè´¹è€…é‡å¹³è¡¡å›è°ƒï¼‰</h3>
<ul>
<li><strong>ä½œç”¨</strong>ï¼š
<ul>
<li>æ¶ˆè´¹è€…ç»„å‘ç”Ÿâ€œ<strong>é‡å¹³è¡¡</strong>â€æ—¶è§¦å‘ï¼Œæ˜¯ä¿è¯æ¶ˆè´¹ä¸ä¸¢æ•°æ®ã€æ¸…ç†åˆ†åŒºèµ„æºçš„å…³é”®ï¼›</li>
</ul>
</li>
<li><strong>é‡å¹³è¡¡åœºæ™¯</strong>ï¼š
<ul>
<li>æ¶ˆè´¹è€…åŠ å…¥ / é€€å‡ºç»„ã€Topic åˆ†åŒºæ•°è°ƒæ•´ã€Broker é‡é€‰ä¸¾ï¼›</li>
</ul>
</li>
</ul>
<h4 id="1-å®šä¹‰-3">&lt;1&gt;å®šä¹‰</h4>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RD_EXPORT</span> RebalanceCb &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief æ¶ˆè´¹è€…ç»„é‡å¹³è¡¡å›è°ƒï¼Œé…åˆ RdKafka::KafkaConsumer ä½¿ç”¨</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * æ³¨å†Œ rebalance_cb åï¼Œlibrdkafka å°†å…³é—­è‡ªåŠ¨åˆ†åŒºåˆ†é…/æ’¤é”€æœºåˆ¶ï¼Œ</span></span><br><span class="line"><span class="comment">  * æ”¹ç”±åº”ç”¨ç¨‹åºçš„ rebalance_cb å…¨æƒè´Ÿè´£ã€‚</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * é‡å¹³è¡¡å›è°ƒéœ€è¦æ ¹æ®ä¸¤ç§äº‹ä»¶æ›´æ–° librdkafka çš„åˆ†åŒºåˆ†é…é›†åˆï¼š</span></span><br><span class="line"><span class="comment">  * - RdKafka::ERR__ASSIGN_PARTITIONSï¼ˆåˆ†é…åˆ†åŒºï¼‰</span></span><br><span class="line"><span class="comment">  * - RdKafka::ERR__REVOKE_PARTITIONSï¼ˆæ’¤é”€åˆ†åŒºï¼‰</span></span><br><span class="line"><span class="comment">  * åŒæ—¶ä¹Ÿè¦èƒ½å¤„ç†å…¶ä»–ä»»æ„çš„é‡å¹³è¡¡é”™è¯¯ï¼ˆerr ä¸æ˜¯ä¸Šè¿°ä¸¤ç§çš„æƒ…å†µï¼‰ã€‚</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * @remark å¯¹äºå…¶ä»–é”™è¯¯æƒ…å†µï¼Œåº”ç”¨ç¨‹åºå¿…é¡»è°ƒç”¨ unassign() æ¥åŒæ­¥çŠ¶æ€ã€‚</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * ã€Eager å…¨é‡åˆ†é…ç­–ç•¥ã€‘ï¼ˆå¦‚ rangeã€roundrobinï¼‰ï¼š</span></span><br><span class="line"><span class="comment">  *   - åˆ†é…æ—¶è°ƒç”¨ assign() è®¾ç½®å…¨éƒ¨åˆ†åŒº</span></span><br><span class="line"><span class="comment">  *   - æ’¤é”€æ—¶è°ƒç”¨ unassign() æ¸…ç©ºå…¨éƒ¨åˆ†åŒº</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * ã€Cooperative å¢é‡åˆ†é…ç­–ç•¥ã€‘ï¼ˆå¦‚ cooperative-stickyï¼‰ï¼š</span></span><br><span class="line"><span class="comment">  *   - åˆ†é…æ—¶è°ƒç”¨ incremental_assign() å¢é‡æ·»åŠ åˆ†åŒº</span></span><br><span class="line"><span class="comment">  *   - æ’¤é”€æ—¶è°ƒç”¨ incremental_unassign() å¢é‡ç§»é™¤åˆ†åŒº</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * ä¸æ³¨å†Œå›è°ƒæ—¶ï¼Œlibrdkafka ä¼šè‡ªåŠ¨å®Œæˆä¸Šè¿°æ“ä½œã€‚</span></span><br><span class="line"><span class="comment">  * æ³¨å†Œå›è°ƒåï¼Œåº”ç”¨ç¨‹åºå¯ä»¥åœ¨åˆ†é…/æ’¤é”€æ—¶æ‰§è¡Œé¢å¤–æ“ä½œï¼Œä¾‹å¦‚ï¼š</span></span><br><span class="line"><span class="comment">  *   - åˆ†é…æ—¶ï¼šä»å¤–éƒ¨å­˜å‚¨åŠ è½½è‡ªå®šä¹‰ offset</span></span><br><span class="line"><span class="comment">  *   - æ’¤é”€æ—¶ï¼šæ‰‹åŠ¨æäº¤ offsetï¼ˆå½“ auto.commit.enable=false æ—¶ï¼‰</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * @sa RdKafka::KafkaConsumer::assign()</span></span><br><span class="line"><span class="comment">  * @sa RdKafka::KafkaConsumer::incremental_assign()</span></span><br><span class="line"><span class="comment">  * @sa RdKafka::KafkaConsumer::incremental_unassign()</span></span><br><span class="line"><span class="comment">  * @sa RdKafka::KafkaConsumer::assignment_lost()</span></span><br><span class="line"><span class="comment">  * @sa RdKafka::KafkaConsumer::rebalance_protocol()</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">rebalance_cb</span><span class="params">(RdKafka::KafkaConsumer *consumer,</span></span></span><br><span class="line"><span class="params"><span class="function">                           RdKafka::ErrorCode err,</span></span></span><br><span class="line"><span class="params"><span class="function">                           std::vector&lt;TopicPartition *&gt; &amp;partitions)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">virtual</span> ~<span class="built_in">RebalanceCb</span>() &#123;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="2-ä½¿ç”¨ç¤ºä¾‹-3">&lt;2&gt;ä½¿ç”¨ç¤ºä¾‹</h4>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyRebalanceCb</span> : <span class="keyword">public</span> RdKafka::RebalanceCb &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">rebalance_cb</span><span class="params">(RdKafka::KafkaConsumer *consumer,</span></span></span><br><span class="line"><span class="params"><span class="function">                      RdKafka::ErrorCode err,</span></span></span><br><span class="line"><span class="params"><span class="function">                      std::vector&lt;RdKafka::TopicPartition*&gt; &amp;partitions)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err == RdKafka::ERR__ASSIGN_PARTITIONS) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;[é‡å¹³è¡¡] åˆ†é…åˆ†åŒºæ•°ï¼š&quot;</span> &lt;&lt; partitions.<span class="built_in">size</span>() &lt;&lt; std::endl;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> tp : partitions) &#123;</span><br><span class="line">                tp-&gt;<span class="built_in">set_offset</span>(RdKafka::Topic::OFFSET_STORED);</span><br><span class="line">            &#125;</span><br><span class="line">            consumer-&gt;<span class="built_in">assign</span>(partitions);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (err == RdKafka::ERR__REVOKE_PARTITIONS) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;[é‡å¹³è¡¡] å›æ”¶åˆ†åŒºæ•°ï¼š&quot;</span> &lt;&lt; partitions.<span class="built_in">size</span>() &lt;&lt; std::endl;</span><br><span class="line">            consumer-&gt;<span class="built_in">commitSync</span>();  <span class="comment">// æäº¤å½“å‰ offset</span></span><br><span class="line">            consumer-&gt;<span class="built_in">unassign</span>();   <span class="comment">//å–æ¶ˆåˆ†åŒºåˆ†é…</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            std::cerr &lt;&lt; <span class="string">&quot;[é‡å¹³è¡¡å¤±è´¥] é”™è¯¯ï¼š&quot;</span> &lt;&lt; RdKafka::<span class="built_in">err2str</span>(err) &lt;&lt; std::endl;</span><br><span class="line">            consumer-&gt;<span class="built_in">unassign</span>();   <span class="comment">//å–æ¶ˆåˆ†åŒºåˆ†é…</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»‘å®šåˆ°æ¶ˆè´¹è€…é…ç½®</span></span><br><span class="line">MyRebalanceCb rebalance_cb;</span><br><span class="line">consumer_conf-&gt;<span class="built_in">set</span>(<span class="string">&quot;rebalance_cb&quot;</span>, &amp;rebalance_cb, errstr);</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ4ï¼‰OffsetCommitCbï¼ˆæ¶ˆè´¹è€…-Offset-æäº¤ç»“æœå›è°ƒï¼‰">ï¼ˆ4ï¼‰OffsetCommitCbï¼ˆæ¶ˆè´¹è€… Offset æäº¤ç»“æœå›è°ƒï¼‰</h3>
<ul>
<li><strong>ä½œç”¨</strong>ï¼š
<ul>
<li>æ¶ˆè´¹è€…<strong>å¼‚æ­¥æäº¤ offset</strong>ï¼ˆcommitAsync()ï¼‰åï¼Œé€šè¿‡è¯¥å›è°ƒè·å–æäº¤ç»“æœï¼›</li>
<li>åŒæ­¥æäº¤ï¼ˆcommitSync()ï¼‰æ— éœ€æ­¤å›è°ƒï¼Œå¯ç›´æ¥é€šè¿‡è¿”å›å€¼åˆ¤æ–­ç»“æœï¼›</li>
</ul>
</li>
<li><strong>å…³é”®åœºæ™¯</strong>ï¼š
<ul>
<li>å¼‚æ­¥æäº¤ offset æ˜¯ç”Ÿäº§ç¯å¢ƒé¦–é€‰ï¼ˆéé˜»å¡ï¼‰ï¼Œè¯¥å›è°ƒæ˜¯ç›‘æ§ offset æäº¤å¤±è´¥çš„æ ¸å¿ƒå…¥å£ï¼Œé¿å…å› æäº¤å¤±è´¥å¯¼è‡´é‡å¤æ¶ˆè´¹ï¼›</li>
</ul>
</li>
</ul>
<h4 id="1-å®šä¹‰-4">&lt;1&gt;å®šä¹‰</h4>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RD_EXPORT</span> OffsetCommitCb &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief è®¾ç½® offset æäº¤å›è°ƒï¼Œç”¨äºæ¶ˆè´¹è€…ç»„</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * è‡ªåŠ¨æäº¤æˆ–æ‰‹åŠ¨æäº¤ offset çš„ç»“æœä¼šè¢«è°ƒåº¦åˆ°æ­¤å›è°ƒï¼Œ</span></span><br><span class="line"><span class="comment">  * å¹¶é€šè¿‡ RdKafka::KafkaConsumer::consume() è§¦å‘æ‰§è¡Œã€‚</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * å¦‚æœæ²¡æœ‰åˆ†åŒºæœ‰æœ‰æ•ˆçš„ offset å¯æäº¤ï¼Œæ­¤å›è°ƒä¼šä»¥ err == ERR__NO_OFFSET è¢«è°ƒç”¨ï¼Œ</span></span><br><span class="line"><span class="comment">  * è¿™ä¸åº”è¢«è§†ä¸ºé”™è¯¯ã€‚</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * offsets åˆ—è¡¨åŒ…å«æ¯ä¸ªåˆ†åŒºçš„ä¿¡æ¯ï¼š</span></span><br><span class="line"><span class="comment">  *   - topic      æäº¤çš„ Topic åç§°</span></span><br><span class="line"><span class="comment">  *   - partition  æäº¤çš„åˆ†åŒºå·</span></span><br><span class="line"><span class="comment">  *   - offset     å·²æäº¤çš„ offsetï¼ˆå°è¯•æäº¤çš„å€¼ï¼‰</span></span><br><span class="line"><span class="comment">  *   - err        æäº¤é”™è¯¯ç </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">offset_commit_cb</span><span class="params">(RdKafka::ErrorCode err,</span></span></span><br><span class="line"><span class="params"><span class="function">                               std::vector&lt;TopicPartition *&gt; &amp;offsets)</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">virtual</span> ~<span class="built_in">OffsetCommitCb</span>() &#123;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="2-ä½¿ç”¨ç¤ºä¾‹-4">&lt;2&gt;ä½¿ç”¨ç¤ºä¾‹</h4>
<p><strong>è‡ªåŠ¨/æ‰‹åŠ¨æäº¤ offset å®Œæˆåè§¦å‘</strong></p>
<ul>
<li>æäº¤é‡è¯•ã€æ¶ˆè´¹è¿›åº¦ç›‘æ§ã€lag å‘Šè­¦</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. è‡ªå®šä¹‰ Offset æäº¤ç»“æœå›è°ƒç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyOffsetCommitCb</span> : <span class="keyword">public</span> RdKafka::OffsetCommitCb &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// çº¯è™šå‡½æ•°å®ç°ï¼š</span></span><br><span class="line">    <span class="comment">// err=æ•´ä½“æäº¤é”™è¯¯ç ï¼Œpartitions=æäº¤çš„åˆ†åŒºåˆ—è¡¨ï¼ˆå«æ¯ä¸ªåˆ†åŒºçš„æäº¤ç»“æœï¼‰</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">offset_commit_cb</span><span class="params">(RdKafka::ErrorCode err,</span></span></span><br><span class="line"><span class="params"><span class="function">                          std::vector&lt;RdKafka::TopicPartition*&gt; &amp;partitions)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err != RdKafka::ERR_NO_ERROR) &#123;</span><br><span class="line">            <span class="comment">// æ•´ä½“æäº¤å¤±è´¥ï¼ˆå¦‚ç½‘ç»œå¼‚å¸¸ã€æ— æƒé™ï¼‰</span></span><br><span class="line">            std::cerr &lt;&lt; <span class="string">&quot;[Offset æäº¤å¤±è´¥] æ•´ä½“é”™è¯¯ï¼š&quot;</span> &lt;&lt; RdKafka::<span class="built_in">err2str</span>(err) &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éå†åˆ†åŒºï¼Œæ£€æŸ¥æ¯ä¸ªåˆ†åŒºçš„æäº¤ç»“æœï¼ˆç²¾ç»†åŒ–å¤„ç†ï¼‰</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> tp : partitions) &#123;</span><br><span class="line">            <span class="keyword">if</span> (tp-&gt;<span class="built_in">err</span>() != RdKafka::ERR_NO_ERROR) &#123;</span><br><span class="line">                <span class="comment">// å•ä¸ªåˆ†åŒºæäº¤å¤±è´¥</span></span><br><span class="line">                std::cerr &lt;&lt; <span class="string">&quot;[Offset æäº¤å¤±è´¥] ä¸»é¢˜ï¼š&quot;</span> &lt;&lt; tp-&gt;<span class="built_in">topic</span>()</span><br><span class="line">                          &lt;&lt; <span class="string">&quot; åˆ†åŒºï¼š&quot;</span> &lt;&lt; tp-&gt;<span class="built_in">partition</span>()</span><br><span class="line">                          &lt;&lt; <span class="string">&quot; é”™è¯¯ï¼š&quot;</span> &lt;&lt; RdKafka::<span class="built_in">err2str</span>(tp-&gt;<span class="built_in">err</span>()) &lt;&lt; std::endl;</span><br><span class="line">                <span class="comment">// ä¸šåŠ¡é€»è¾‘ï¼šè®°å½•å¤±è´¥çš„ offsetã€è§¦å‘é‡è¯•ã€å‘Šè­¦</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// å•ä¸ªåˆ†åŒºæäº¤æˆåŠŸ</span></span><br><span class="line">                std::cout &lt;&lt; <span class="string">&quot;[Offset æäº¤æˆåŠŸ] ä¸»é¢˜ï¼š&quot;</span> &lt;&lt; tp-&gt;<span class="built_in">topic</span>()</span><br><span class="line">                          &lt;&lt; <span class="string">&quot; åˆ†åŒºï¼š&quot;</span> &lt;&lt; tp-&gt;<span class="built_in">partition</span>()</span><br><span class="line">                          &lt;&lt; <span class="string">&quot; æäº¤çš„ offsetï¼š&quot;</span> &lt;&lt; tp-&gt;<span class="built_in">offset</span>() &lt;&lt; std::endl;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ç»‘å®šåˆ°æ¶ˆè´¹è€…é…ç½®</span></span><br><span class="line">MyOffsetCommitCb offset_commit_cb;</span><br><span class="line">std::string errstr;</span><br><span class="line">RdKafka::Conf *consumer_conf = RdKafka::Conf::<span class="built_in">create</span>(RdKafka::Conf::CONF_GLOBAL);</span><br><span class="line"><span class="comment">// å…³é”®ï¼šå°†å›è°ƒå¯¹è±¡ç»‘å®šåˆ° &quot;offset_commit_cb&quot; é…ç½®é¡¹</span></span><br><span class="line"><span class="keyword">if</span> (consumer_conf-&gt;<span class="built_in">set</span>(<span class="string">&quot;offset_commit_cb&quot;</span>, &amp;offset_commit_cb, errstr) != RdKafka::CONF_OK) &#123;</span><br><span class="line">    std::cerr &lt;&lt; <span class="string">&quot;ç»‘å®š Offset æäº¤å›è°ƒå¤±è´¥ï¼š&quot;</span> &lt;&lt; errstr &lt;&lt; std::endl;</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. å¼‚æ­¥æäº¤ Offsetï¼ˆè§¦å‘å›è°ƒï¼‰</span></span><br><span class="line">std::vector&lt;RdKafka::TopicPartition*&gt; partitions;</span><br><span class="line">partitions.<span class="built_in">push_back</span>(RdKafka::TopicPartition::<span class="built_in">create</span>(<span class="string">&quot;topic1&quot;</span>, <span class="number">0</span>));</span><br><span class="line">partitions[<span class="number">0</span>]-&gt;<span class="built_in">set_offset</span>(<span class="number">1000</span>);</span><br><span class="line"><span class="comment">// å¼‚æ­¥æäº¤ï¼šéé˜»å¡ï¼Œç»“æœé€šè¿‡ OffsetCommitCb è¿”å›</span></span><br><span class="line">consumer-&gt;<span class="built_in">commitAsync</span>(partitions, <span class="literal">nullptr</span>); <span class="comment">// ç¬¬äºŒä¸ªå‚æ•°ä¸º opaqueï¼ˆé€ä¼ ä¸Šä¸‹æ–‡ï¼‰</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ5ï¼‰å›è°ƒç±»é€šç”¨è§„åˆ™ä¸æ³¨æ„äº‹é¡¹">ï¼ˆ5ï¼‰å›è°ƒç±»é€šç”¨è§„åˆ™ä¸æ³¨æ„äº‹é¡¹</h3>
<h4 id="1-æ ¸å¿ƒé€šç”¨è§„åˆ™">&lt;1&gt;æ ¸å¿ƒé€šç”¨è§„åˆ™</h4>
<ul>
<li><strong>æŠ½è±¡ç±»ç‰¹æ€§</strong>ï¼š
<ul>
<li>æ‰€æœ‰ xxxCb ç±»å‡åŒ…å«çº¯è™šå‡½æ•°ï¼Œå¿…é¡»å®ç°æ‰€æœ‰çº¯è™šå‡½æ•°æ‰èƒ½å®ä¾‹åŒ–ï¼ˆæœªå®ç°ä¼šç¼–è¯‘å¤±è´¥ï¼‰ï¼›</li>
</ul>
</li>
<li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼š
<ul>
<li>å›è°ƒå‡½æ•°ç”± librdkafka å†…éƒ¨çº¿ç¨‹è°ƒç”¨ï¼ˆ<strong>éä¸šåŠ¡çº¿ç¨‹</strong>ï¼‰ï¼Œéœ€ä¿è¯ï¼š
<ul>
<li>å›è°ƒå†…æ“ä½œï¼ˆå¦‚å†™æ—¥å¿—ã€æ›´æ–°å˜é‡ï¼‰éœ€<strong>åŠ é”</strong>ï¼ˆstd::mutexï¼‰ï¼›</li>
<li><strong>é¿å…</strong>åœ¨å›è°ƒå†…æ‰§è¡Œ<strong>è€—æ—¶æ“ä½œ</strong>ï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ã€ç£ç›˜ IOï¼‰ï¼Œä¼šé˜»å¡å®¢æˆ·ç«¯æ ¸å¿ƒé€»è¾‘ï¼›</li>
</ul>
</li>
</ul>
</li>
<li><strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ï¼š
<ul>
<li><strong>å›è°ƒå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå¿…é¡» â‰¥ å®¢æˆ·ç«¯å¯¹è±¡ï¼ˆç”Ÿäº§è€… / æ¶ˆè´¹è€…ï¼‰</strong>ï¼Œå¦åˆ™ä¼šå¯¼è‡´é‡æŒ‡é’ˆå´©æºƒï¼›</li>
<li><strong>ç¦æ­¢</strong>åœ¨å›è°ƒå†…é”€æ¯å®¢æˆ·ç«¯å¯¹è±¡ï¼ˆå¦‚ delete consumerï¼‰ï¼›</li>
</ul>
</li>
<li><strong>é…ç½®é¡¹å‘½å</strong>ï¼š
<ul>
<li>ç»‘å®šå›è°ƒæ—¶çš„é…ç½®é¡¹åä¸å›è°ƒç±»åå¯¹åº”ï¼ˆå¦‚ DeliveryReportCb â†’ dr_cbï¼ŒRebalanceCb â†’ rebalance_cbï¼‰ï¼Œéœ€ä¸¥æ ¼åŒ¹é… librdkafka è§„èŒƒã€‚</li>
</ul>
</li>
</ul>
<h4 id="2-é«˜é¢‘æ˜“é”™ç‚¹">&lt;2&gt;é«˜é¢‘æ˜“é”™ç‚¹</h4>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260116224028039.png" alt=""></p>
<h2 id="4-RdKafka-Messageç±»ï¼ˆæ¶ˆæ¯ç±»ï¼‰">4.RdKafka::Messageç±»ï¼ˆæ¶ˆæ¯ç±»ï¼‰</h2>
<h3 id="ï¼ˆ1ï¼‰æ¦‚è¿°-5">ï¼ˆ1ï¼‰æ¦‚è¿°</h3>
<h4 id="1-ä½œç”¨-5">&lt;1&gt;ä½œç”¨</h4>
<ul>
<li>RdKafka::Message æ˜¯ librdkafka ä¸­<strong>æ¶ˆæ¯çš„æ ¸å¿ƒè½½ä½“ç±»</strong>,æ‰¿è½½æ¶ˆæ¯çš„å…ƒæ•°æ®ã€çŠ¶æ€ï¼ˆå¦‚é”™è¯¯ç ï¼‰ç­‰å…³é”®ä¿¡æ¯ï¼Œç”¨äºï¼š
<ul>
<li>ç”Ÿäº§è€…ç«¯ï¼šåœ¨ DeliveryReportCb å›è°ƒä¸­è·å–æŠ•é€’ç»“æœ</li>
<li>æ¶ˆè´¹è€…ç«¯ï¼šé€šè¿‡ consume() è·å–æ‹‰å–åˆ°çš„æ¶ˆæ¯</li>
</ul>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚                      Message ä½¿ç”¨åœºæ™¯                            â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚                                                                 â”‚</span><br><span class="line">â”‚   Producer                              Consumer                â”‚</span><br><span class="line">â”‚      â”‚                                      â”‚                   â”‚</span><br><span class="line">â”‚      â”‚ <span class="built_in">produce</span>()                            â”‚ <span class="built_in">consume</span>()         â”‚</span><br><span class="line">â”‚      â–¼                                      â–¼                   â”‚</span><br><span class="line">â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚</span><br><span class="line">â”‚   â”‚ å†…éƒ¨é˜Ÿåˆ— â”‚                        â”‚ Message  â”‚â—„â”€â”€ æ‹‰å–ç»“æœ  â”‚</span><br><span class="line">â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚</span><br><span class="line">â”‚        â”‚ å‘é€å®Œæˆ                                               â”‚</span><br><span class="line">â”‚        â–¼                                                       â”‚</span><br><span class="line">â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚</span><br><span class="line">â”‚   â”‚DeliveryReportCbâ”‚                                           â”‚</span><br><span class="line">â”‚   â”‚   <span class="built_in">dr_cb</span>()      â”‚                                           â”‚</span><br><span class="line">â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                           â”‚</span><br><span class="line">â”‚   â”‚  â”‚ Message  â”‚â—„â”€â”¼â”€â”€ æŠ•é€’ç»“æœ                                 â”‚</span><br><span class="line">â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                           â”‚</span><br><span class="line">â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚</span><br><span class="line">â”‚                                                                 â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260116203247930.png" alt=""></p>
<h4 id="2-æ ¸å¿ƒå®šä½-5">&lt;2&gt;æ ¸å¿ƒå®šä½</h4>
<ul>
<li><strong>æ¶ˆæ¯æ•°æ®è½½ä½“</strong>ï¼š
<ul>
<li>å­˜å‚¨æ¶ˆæ¯çš„ã€Œ<strong>å†…å®¹ã€Keyã€åˆ†åŒºã€åç§»é‡</strong>ã€ç­‰â€œæ ¸å¿ƒä¸šåŠ¡æ•°æ®â€ï¼Œæ˜¯ç”Ÿäº§è€… / æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯çš„ç›´æ¥å¯¹è±¡ï¼›</li>
</ul>
</li>
<li><strong>å…ƒæ•°æ®å®¹å™¨</strong>ï¼š
<ul>
<li>é™„å¸¦æ¶ˆæ¯çš„ã€Œ<strong>ä¸»é¢˜åã€æ—¶é—´æˆ³ã€ç”Ÿäº§ / æ¶ˆè´¹çŠ¶æ€ã€é”™è¯¯ç </strong>ã€ç­‰â€œå…ƒæ•°æ®â€ï¼Œæ”¯æ’‘æ¶ˆæ¯æº¯æºã€å¼‚å¸¸æ’æŸ¥ï¼›</li>
</ul>
</li>
<li><strong>çŠ¶æ€æ ‡è¯†</strong>ï¼š
<ul>
<li>ä¸ä»…å°è£…æ­£å¸¸æ¶ˆæ¯ï¼Œä¹Ÿå¯è¡¨ç¤º â€œç©ºæ¶ˆæ¯â€â€œé”™è¯¯æ¶ˆæ¯â€ï¼ˆå¦‚æ¶ˆè´¹è¶…æ—¶ã€åˆ†åŒº EOFï¼‰ï¼Œæ˜¯ API åé¦ˆæ“ä½œç»“æœçš„é‡è¦å½¢å¼ï¼›</li>
</ul>
</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰Messageç±»çš„å®šä¹‰">ï¼ˆ2ï¼‰Messageç±»çš„å®šä¹‰</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RD_EXPORT</span> Message &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// ================================= é”™è¯¯ç›¸å…³ =================================</span></span><br><span class="line">    <span class="comment">/** @returns å¦‚æœå¯¹è±¡è¡¨ç¤ºé”™è¯¯äº‹ä»¶åˆ™è¿”å›é”™è¯¯å­—ç¬¦ä¸²ï¼Œå¦åˆ™è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚ */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> std::string <span class="title">errstr</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** @returns å¦‚æœå¯¹è±¡è¡¨ç¤ºé”™è¯¯äº‹ä»¶åˆ™è¿”å›é”™è¯¯ç ï¼Œå¦åˆ™è¿”å› ERR_NO_ERRORï¼ˆ0ï¼‰ã€‚ */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> ErrorCode <span class="title">err</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ================================= ä½ç½®ä¿¡æ¯ =================================</span></span><br><span class="line">    <span class="comment">/** @returns æ¶ˆæ¯å¯¹åº”çš„ RdKafka::Topic å¯¹è±¡ï¼ˆå¦‚æœé€‚ç”¨ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment">    *           å¦‚æœæ²¡æœ‰é€šè¿‡ RdKafka::Topic::create() æ˜¾å¼åˆ›å»ºå¯¹åº”çš„</span></span><br><span class="line"><span class="comment">    *           RdKafka::Topic å¯¹è±¡åˆ™è¿”å› NULLã€‚</span></span><br><span class="line"><span class="comment">    *           åœ¨è¿™ç§æƒ…å†µä¸‹è¯·æ”¹ç”¨ topic_name()ã€‚ */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Topic *<span class="title">topic</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** @returns ä¸»é¢˜åç§°ï¼ˆå¦‚æœé€‚ç”¨ï¼Œå¦åˆ™è¿”å›ç©ºå­—ç¬¦ä¸²ï¼‰ */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> std::string <span class="title">topic_name</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** @returns åˆ†åŒºå·ï¼ˆå¦‚æœé€‚ç”¨ï¼‰ */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">int32_t</span> <span class="title">partition</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** @returns æ¶ˆæ¯æˆ–é”™è¯¯çš„åç§»é‡ï¼ˆå¦‚æœé€‚ç”¨ï¼‰ */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">int64_t</span> <span class="title">offset</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ================================= æ¶ˆæ¯å†…å®¹ =================================</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> *<span class="title">payload</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;           <span class="comment">// æ¶ˆæ¯ä½“æŒ‡é’ˆï¼ˆäºŒè¿›åˆ¶æ•°æ®ï¼Œæ¶ˆæ¯ä½“æŒ‡é’ˆï¼Œéœ€è½¬æ¢ç±»å‹ï¼‰</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">size_t</span> <span class="title">len</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;              <span class="comment">// æ¶ˆæ¯ä½“é•¿åº¦</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">const</span> std::string *<span class="title">key</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;  <span class="comment">// æ¶ˆæ¯ Keyï¼ˆå¯èƒ½ä¸º NULLï¼‰</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">size_t</span> <span class="title">key_len</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;          <span class="comment">// Key é•¿åº¦</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">const</span> <span class="type">void</span> *<span class="title">key_pointer</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>; <span class="comment">// Key æŒ‡é’ˆï¼ˆäºŒè¿›åˆ¶ Keyï¼‰</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ================================= æ—¶é—´æˆ³ =================================</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Timestamp <span class="title">timestamp</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;     <span class="comment">// æ—¶é—´æˆ³ï¼ˆå«ç±»å‹ï¼‰</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">int64_t</span> <span class="title">latency</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;         <span class="comment">// æ¶ˆæ¯å»¶è¿Ÿï¼ˆå¾®ç§’ï¼Œä»…ç”Ÿäº§è€…ï¼‰</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ================================= æ¶ˆæ¯å¤´ =================================</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Headers *<span class="title">headers</span><span class="params">()</span> </span>= <span class="number">0</span>;              <span class="comment">// è·å–æ¶ˆæ¯å¤´ï¼ˆå¯ä¿®æ”¹ï¼‰</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Headers *<span class="title">headers</span><span class="params">(ErrorCode *err)</span> </span>= <span class="number">0</span>;<span class="comment">// è·å–æ¶ˆæ¯å¤´ï¼Œå¹¶è¿”å›é”™è¯¯ç </span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ================================= å…¶ä»– =================================</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">int32_t</span> <span class="title">broker_id</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;       <span class="comment">// å¤„ç†è¯¥æ¶ˆæ¯çš„ Broker ID</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * @brief ä¸ºå·²æ¶ˆè´¹çš„æ¶ˆæ¯å­˜å‚¨ offset + 1ã€‚</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * æ¶ˆæ¯çš„ offset + 1 å°†æ ¹æ® \c `auto.commit.interval.ms` é…ç½®</span></span><br><span class="line"><span class="comment">    * æˆ–æ‰‹åŠ¨æ— åç§»é‡çš„ commit() è°ƒç”¨æäº¤åˆ° brokerã€‚</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * @warning æ­¤æ–¹æ³•åªèƒ½å¯¹å½“å‰å·²åˆ†é…çš„åˆ†åŒºè°ƒç”¨ã€‚</span></span><br><span class="line"><span class="comment">    *          å¯¹æœªåˆ†é…çš„åˆ†åŒºè°ƒç”¨å°†å¤±è´¥å¹¶è¿”å› ERR__STATEã€‚</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * @warning é¿å…åœ¨è°ƒç”¨ seek() ç­‰æ–¹æ³•åå­˜å‚¨åç§»é‡ï¼Œ</span></span><br><span class="line"><span class="comment">    *          å› ä¸ºè¿™å¯èƒ½ä¼šå¹²æ‰°åç»­æ¢å¤æš‚åœçš„åˆ†åŒºï¼Œ</span></span><br><span class="line"><span class="comment">    *          åº”åœ¨è°ƒç”¨ seek ä¹‹å‰å­˜å‚¨åç§»é‡ã€‚</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * @remark ä½¿ç”¨æ­¤ API æ—¶å¿…é¡»å°† \c `enable.auto.offset.store` è®¾ç½®ä¸º &quot;false&quot;ã€‚</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * @returns æˆåŠŸæ—¶è¿”å› NULLï¼Œå¤±è´¥æ—¶è¿”å›é”™è¯¯å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Error *<span class="title">offset_store</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** @brief æ¶ˆæ¯æŒä¹…åŒ–çŠ¶æ€ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ç”¨å®ƒæ¥åˆ¤æ–­ç”Ÿäº§çš„æ¶ˆæ¯æ˜¯å¦å·²è¢«æŒä¹…åŒ–åˆ°ä¸»é¢˜æ—¥å¿—ä¸­ã€‚ */</span></span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">Status</span> &#123;</span><br><span class="line">        <span class="comment">/** æ¶ˆæ¯ä»æœªå‘é€åˆ° brokerï¼Œæˆ–è€…å‘é€å¤±è´¥ä¸”é”™è¯¯è¡¨æ˜æ¶ˆæ¯æœªå†™å…¥æ—¥å¿—ã€‚</span></span><br><span class="line"><span class="comment">        *  åº”ç”¨ç¨‹åºé‡è¯•å¯èƒ½å¯¼è‡´ä¹±åºï¼Œä½†ä¸ä¼šå¯¼è‡´é‡å¤ã€‚ */</span></span><br><span class="line">        MSG_STATUS_NOT_PERSISTED = <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** æ¶ˆæ¯å·²å‘é€åˆ° brokerï¼Œä½†æœªæ”¶åˆ°ç¡®è®¤ã€‚</span></span><br><span class="line"><span class="comment">        *  åº”ç”¨ç¨‹åºé‡è¯•å¯èƒ½å¯¼è‡´ä¹±åºå’Œé‡å¤ã€‚ */</span></span><br><span class="line">        MSG_STATUS_POSSIBLY_PERSISTED = <span class="number">1</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** æ¶ˆæ¯å·²å†™å…¥æ—¥å¿—å¹¶è¢«å®Œå…¨ç¡®è®¤ã€‚</span></span><br><span class="line"><span class="comment">        *  åº”ç”¨ç¨‹åºæ— éœ€é‡è¯•ã€‚</span></span><br><span class="line"><span class="comment">        *  æ³¨æ„ï¼šæ­¤å€¼ä»…åœ¨ \c acks=all æ—¶æ‰å¯å®Œå…¨ä¿¡ä»»ã€‚ */</span></span><br><span class="line">        MSG_STATUS_PERSISTED = <span class="number">2</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//@brief è¿”å›æ¶ˆæ¯åœ¨ä¸»é¢˜æ—¥å¿—ä¸­çš„æŒä¹…åŒ–çŠ¶æ€ã€‚ï¼ˆç”Ÿäº§è€…ä¸“ç”¨ï¼‰</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Status <span class="title">status</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Message</span>() = <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚                    Message æ ¸å¿ƒå±æ€§                          â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚   å†…å®¹       â”‚  <span class="built_in">payload</span>() + <span class="built_in">len</span>()  /  <span class="built_in">key</span>() + <span class="built_in">key_len</span>()     â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚   ä½ç½®       â”‚  <span class="built_in">topic_name</span>() + <span class="built_in">partition</span>() + <span class="built_in">offset</span>()       â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚   çŠ¶æ€       â”‚  <span class="built_in">err</span>() + <span class="built_in">errstr</span>() + <span class="built_in">status</span>()                 â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚   å…ƒæ•°æ®     â”‚  <span class="built_in">timestamp</span>() + <span class="built_in">headers</span>() + <span class="built_in">broker_id</span>()       â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰å¸¸è§é”™è¯¯ç -ErrorCode">ï¼ˆ3ï¼‰å¸¸è§é”™è¯¯ç  ErrorCode</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260116205721363.png" alt=""></p>
<h3 id="ï¼ˆ4ï¼‰ä½¿ç”¨ç¤ºä¾‹">ï¼ˆ4ï¼‰ä½¿ç”¨ç¤ºä¾‹</h3>
<h4 id="1-æ¶ˆè´¹è€…æ¥æ”¶å¹¶å¤„ç†æ¶ˆæ¯ï¼ˆæ ¸å¿ƒåœºæ™¯ï¼‰">&lt;1&gt;æ¶ˆè´¹è€…æ¥æ”¶å¹¶å¤„ç†æ¶ˆæ¯ï¼ˆæ ¸å¿ƒåœºæ™¯ï¼‰</h4>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> (running) &#123;</span><br><span class="line">    <span class="comment">// consume() æ–¹æ³•è¿”å› Message å¯¹è±¡ï¼Œè¶…æ—¶æ—¶é—´ 1000ms</span></span><br><span class="line">    RdKafka::Message *msg = consumer-&gt;<span class="built_in">consume</span>(<span class="number">1000</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é€šè¿‡ err() åˆ¤æ–­æ¶ˆæ¯çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">switch</span> (msg-&gt;<span class="built_in">err</span>()) &#123;</span><br><span class="line">        <span class="keyword">case</span> RdKafka::ERR_NO_ERROR: &#123;</span><br><span class="line">            <span class="comment">// æ­£å¸¸æ¶ˆæ¯</span></span><br><span class="line">            <span class="type">const</span> <span class="type">char</span> *payload = <span class="built_in">static_cast</span>&lt;<span class="type">const</span> <span class="type">char</span>*&gt;(msg-&gt;<span class="built_in">payload</span>());</span><br><span class="line">            <span class="type">size_t</span> len = msg-&gt;<span class="built_in">len</span>();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// key() è¿”å› const std::string*</span></span><br><span class="line">            <span class="type">const</span> std::string *key = msg-&gt;<span class="built_in">key</span>();</span><br><span class="line">            std::string key_str = key ? *key : <span class="string">&quot;æ— Key&quot;</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// timestamp() è¿”å› MessageTimestamp ç»“æ„ä½“</span></span><br><span class="line">            RdKafka::MessageTimestamp ts = msg-&gt;<span class="built_in">timestamp</span>();</span><br><span class="line">            std::string ts_type = (ts.type == RdKafka::MessageTimestamp::MSG_TIMESTAMP_CREATE_TIME) </span><br><span class="line">                                  ? <span class="string">&quot;ç”Ÿäº§æ—¶é—´&quot;</span> : <span class="string">&quot;å†™å…¥æ—¶é—´&quot;</span>;</span><br><span class="line">            </span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;æ”¶åˆ°æ¶ˆæ¯ï¼š&quot;</span> &lt;&lt; std::endl</span><br><span class="line">                      &lt;&lt; <span class="string">&quot;  ä¸»é¢˜ï¼š&quot;</span> &lt;&lt; msg-&gt;<span class="built_in">topic_name</span>() &lt;&lt; std::endl</span><br><span class="line">                      &lt;&lt; <span class="string">&quot;  åˆ†åŒºï¼š&quot;</span> &lt;&lt; msg-&gt;<span class="built_in">partition</span>() &lt;&lt; std::endl</span><br><span class="line">                      &lt;&lt; <span class="string">&quot;  åç§»é‡ï¼š&quot;</span> &lt;&lt; msg-&gt;<span class="built_in">offset</span>() &lt;&lt; std::endl</span><br><span class="line">                      &lt;&lt; <span class="string">&quot;  Keyï¼š&quot;</span> &lt;&lt; key_str &lt;&lt; std::endl</span><br><span class="line">                      &lt;&lt; <span class="string">&quot;  å†…å®¹ï¼š&quot;</span> &lt;&lt; std::<span class="built_in">string</span>(payload, len) &lt;&lt; std::endl</span><br><span class="line">                      &lt;&lt; <span class="string">&quot;  æ—¶é—´æˆ³ï¼š&quot;</span> &lt;&lt; ts.timestamp &lt;&lt; <span class="string">&quot;ï¼ˆ&quot;</span> &lt;&lt; ts_type &lt;&lt; <span class="string">&quot;ï¼‰&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> RdKafka::ERR__TIMED_OUT:</span><br><span class="line">            <span class="comment">// è¶…æ—¶ï¼Œæ— æ¶ˆæ¯ï¼Œç»§ç»­</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">case</span> RdKafka::ERR__PARTITION_EOF:</span><br><span class="line">            <span class="comment">// åˆ°è¾¾åˆ†åŒºæœ«å°¾</span></span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;åˆ†åŒº EOFï¼š&quot;</span> &lt;&lt; msg-&gt;<span class="built_in">topic_name</span>() </span><br><span class="line">                      &lt;&lt; <span class="string">&quot;-&quot;</span> &lt;&lt; msg-&gt;<span class="built_in">partition</span>() &lt;&lt; std::endl;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="comment">// å…¶ä»–é”™è¯¯</span></span><br><span class="line">            std::cerr &lt;&lt; <span class="string">&quot;æ¶ˆè´¹é”™è¯¯ï¼š&quot;</span> &lt;&lt; msg-&gt;<span class="built_in">errstr</span>() &lt;&lt; std::endl;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âš ï¸ å¿…é¡»é‡Šæ”¾ï¼ˆå…³é”®ï¼šé¿å…å†…å­˜æ³„æ¼ï¼‰</span></span><br><span class="line">    <span class="keyword">delete</span> msg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åå¤„ç†å›è°ƒï¼ˆå¼‚æ­¥å‘é€ï¼‰">&lt;2&gt;ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åå¤„ç†å›è°ƒï¼ˆå¼‚æ­¥å‘é€ï¼‰</h4>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyDeliveryReportCb</span> : <span class="keyword">public</span> RdKafka::DeliveryReportCb &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// å‚æ•°æ˜¯å¼•ç”¨</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dr_cb</span><span class="params">(RdKafka::Message &amp;msg)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (msg.<span class="built_in">err</span>() != RdKafka::ERR_NO_ERROR) &#123;</span><br><span class="line">            <span class="comment">// å‘é€å¤±è´¥</span></span><br><span class="line">            <span class="type">const</span> std::string *key = msg.<span class="built_in">key</span>();</span><br><span class="line">            std::cerr &lt;&lt; <span class="string">&quot;æ¶ˆæ¯å‘é€å¤±è´¥ï¼š&quot;</span> &lt;&lt; msg.<span class="built_in">errstr</span>() &lt;&lt; std::endl</span><br><span class="line">                      &lt;&lt; <span class="string">&quot;  Keyï¼š&quot;</span> &lt;&lt; (key ? *key : <span class="string">&quot;æ— Key&quot;</span>) &lt;&lt; std::endl;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å‘é€æˆåŠŸ</span></span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;æ¶ˆæ¯å‘é€æˆåŠŸï¼š&quot;</span> &lt;&lt; std::endl</span><br><span class="line">                      &lt;&lt; <span class="string">&quot;  ä¸»é¢˜ï¼š&quot;</span> &lt;&lt; msg.<span class="built_in">topic_name</span>() &lt;&lt; std::endl  <span class="comment">// âœ… ç”¨ . ä¸ç”¨ -&gt;</span></span><br><span class="line">                      &lt;&lt; <span class="string">&quot;  åˆ†åŒºï¼š&quot;</span> &lt;&lt; msg.<span class="built_in">partition</span>() &lt;&lt; std::endl</span><br><span class="line">                      &lt;&lt; <span class="string">&quot;  åç§»é‡ï¼š&quot;</span> &lt;&lt; msg.<span class="built_in">offset</span>() &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// âš ï¸ å›è°ƒä¸­çš„ msg ç”± librdkafka ç®¡ç†ï¼Œä¸è¦ delete</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ4ï¼‰æ ¸å¿ƒç‰¹æ€§ä¸æ³¨æ„äº‹é¡¹">ï¼ˆ4ï¼‰æ ¸å¿ƒç‰¹æ€§ä¸æ³¨æ„äº‹é¡¹</h3>
<h4 id="1-æ ¸å¿ƒç‰¹å¾">&lt;1&gt;æ ¸å¿ƒç‰¹å¾</h4>
<ul>
<li><strong>åªè¯»æ€§</strong>ï¼š
<ul>
<li>æ¶ˆè´¹è€…ä¾§çš„ Message å¯¹è±¡æ‰€æœ‰å±æ€§å‡ä¸ºåªè¯»ï¼›</li>
<li>ç”Ÿäº§è€…ä¾§ä»…å‘é€å›è°ƒä¸­çš„ Message åŒ…å«å‘é€ç»“æœï¼Œæ— æ³•ä¿®æ”¹æ¶ˆæ¯å†…å®¹ï¼›</li>
</ul>
</li>
<li><strong>åˆ†åŒºå·ç‰¹æ®Šå€¼</strong>ï¼š
<ul>
<li>RdKafka::Topic::PARTITION_UAï¼ˆç­‰ä»·äº -1ï¼‰ä»£è¡¨ â€œè®© Kafka è‡ªåŠ¨åˆ†é…åˆ†åŒºâ€ï¼ˆç”Ÿäº§è€…å‘é€æ—¶ä½¿ç”¨ï¼‰ï¼›</li>
</ul>
</li>
<li><strong>å†…å­˜ç®¡ç†</strong>ï¼š
<ul>
<li><strong>æ¶ˆè´¹è€…</strong> consume() è¿”å›çš„ Message æŒ‡é’ˆ<strong>éœ€æ‰‹åŠ¨ deleteï¼Œå¦åˆ™å†…å­˜æ³„æ¼</strong>ï¼›</li>
<li><strong>ç”Ÿäº§è€…å›è°ƒä¸­</strong>çš„ Message å¯¹è±¡ç”± librdkafka ç®¡ç†ï¼Œ<strong>æ— éœ€æ‰‹åŠ¨é‡Šæ”¾</strong>ï¼›</li>
</ul>
</li>
<li><strong>é”™è¯¯æ¶ˆæ¯åˆ¤æ–­</strong>ï¼š
<ul>
<li>consume() å§‹ç»ˆè¿”å› Message å¯¹è±¡ï¼ˆä¸ä¼šè¿”å› nullptrï¼‰</li>
<li>é€šè¿‡ <strong>err()</strong> åˆ¤æ–­çŠ¶æ€ï¼š
<ul>
<li><strong>ERR_NO_ERROR</strong>ï¼šæ­£å¸¸æ¶ˆæ¯</li>
<li><strong>ERR__TIMED_OUT</strong>ï¼šè¶…æ—¶ï¼Œæ— å¯ç”¨æ¶ˆæ¯</li>
<li><strong>ERR__PARTITION_EOF</strong>ï¼šåˆ°è¾¾åˆ†åŒºæœ«å°¾</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="2-æ˜“é”™ç‚¹ä¸æœ€ä½³å®è·µ">&lt;2&gt;æ˜“é”™ç‚¹ä¸æœ€ä½³å®è·µ</h4>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260116221010502.png" alt=""></p>
<p><a id="config"></a></p>
<h1>é™„å½•1ï¼šå¸¸ç”¨é…ç½®é¡¹</h1>
<h2 id="1-Globalé€šç”¨é…ç½®ï¼ˆç”Ÿäº§è€…-æ¶ˆè´¹è€…å…±ç”¨ï¼‰">1.Globalé€šç”¨é…ç½®ï¼ˆç”Ÿäº§è€…/æ¶ˆè´¹è€…å…±ç”¨ï¼‰</h2>
<p><strong>å…³é”®é…ç½®</strong>ï¼š<br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260116144249346.png" alt=""><br>
<strong>ç½‘ç»œä¸è¿æ¥ç›¸å…³ï¼ˆç½‘ç»œä¼˜åŒ–ï¼‰</strong>ï¼š<br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260116144611415.png" alt=""><br>
<strong>å®‰å…¨è®¤è¯ç›¸å…³ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰</strong>ï¼š<br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260116153411714.png" alt=""><br>
<strong>å…ƒæ•°æ®ç›¸å…³</strong>ï¼š<br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260116151134440.png" alt=""><br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260116151233728.png" alt=""></p>
<h2 id="2-ç”Ÿäº§è€…ä¸“ç”¨">2.ç”Ÿäº§è€…ä¸“ç”¨</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260116154712623.png" alt=""></p>
<h2 id="3-æ¶ˆè´¹è€…ä¸“ç”¨">3.æ¶ˆè´¹è€…ä¸“ç”¨</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260116155332043.png" alt=""></p>
]]></content>
      <categories>
        <category>C++</category>
        <category>C++åç«¯å¼€å‘åº“</category>
        <category>Kafka</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>15.std::optional&lt;&gt;</title>
    <url>/2026/01/07/C++/%E3%80%8AC++17%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97%E3%80%8B/15-std-optional/</url>
    <content><![CDATA[<h1>1.æ¦‚è¿°</h1>
<ul>
<li><strong>1.std::optional&lt;&gt;æ¨¡æ‹Ÿäº†ä¸€ä¸ªå¯ä»¥ä¸ºç©ºçš„ä»»æ„ç±»å‹çš„å®ä¾‹,å¯ä»¥è¢«ç”¨ä½œæˆå‘˜ã€å‚æ•°ã€è¿”å›å€¼ç­‰</strong></li>
<li><strong>2.æ‹·è´ä¸€ä¸ªæ— å†…å«å€¼çš„std::optional&lt;&gt;çš„å¼€é”€å¾ˆå°</strong></li>
<li><strong>3.ä½†æ‹·è´æœ‰å†…å«å€¼çš„std::optional&lt;&gt;çš„å¼€é”€çº¦ç­‰äºæ‹·è´å†…å«å€¼çš„å¼€é”€</strong></li>
<li><strong>4.std::optional&lt;&gt;å¯¹è±¡ä¹Ÿæ”¯æŒmoveè¯­ä¹‰</strong></li>
</ul>
<h1>2.å¸¸ç”¨API</h1>
<h2 id="0-å¤´æ–‡ä»¶">0.å¤´æ–‡ä»¶</h2>
<p><strong>#include&lt;optional&gt;</strong></p>
<h2 id="1-åˆ›å»º-åˆå§‹åŒ–">1.åˆ›å»º/åˆå§‹åŒ–</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260107191619544.png" alt=""></p>
<h2 id="2-å–å€¼ç›¸å…³">2.å–å€¼ç›¸å…³</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260107192204439.png" alt=""></p>
<h2 id="3-çŠ¶æ€åˆ¤æ–­">3.çŠ¶æ€åˆ¤æ–­</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260107191715927.png" alt=""></p>
<h2 id="4-ä¿®æ”¹-é‡ç½®">4.ä¿®æ”¹/é‡ç½®</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260107191826919.png" alt=""></p>
<h2 id="5-å…¶å®ƒå¸¸ç”¨API">5.å…¶å®ƒå¸¸ç”¨API</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260107191849790.png" alt=""></p>
<p><strong>æ³¨æ„ï¼šæ™®é€šç±»å‹å¯ä»¥éšå¼è½¬æ¢ä¸º std::optional,std::optional ä¸èƒ½ç›´æ¥éšå¼è½¬æ¢ä¸ºæ™®é€šç±»å‹</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*1.æ™®é€šç±»å‹â€”â€”&gt;optional*/</span></span><br><span class="line">std::optional&lt;<span class="type">int</span>&gt; opt = <span class="number">100</span>; <span class="comment">// éšå¼è½¬æ¢ï¼ˆint â†’ optional&lt;int&gt;ï¼‰</span></span><br><span class="line">std::optional&lt;std::string&gt; opt_str = <span class="string">&quot;mysql&quot;</span>; <span class="comment">// éšå¼è½¬æ¢ï¼ˆconst char* â†’ string â†’ optional&lt;string&gt;ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*2.optionalâ€”â€”&gt;æ™®é€šç±»å‹*/</span></span><br><span class="line">std::optional&lt;<span class="type">int</span>&gt; opt = <span class="number">100</span>;</span><br><span class="line"><span class="comment">// int val = opt; // é”™è¯¯ï¼šä¸æ”¯æŒéšå¼è½¬æ¢</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­£ç¡®ï¼šæ˜¾å¼å–å€¼</span></span><br><span class="line"><span class="type">int</span> val1 = *opt;          <span class="comment">// ç¡®å®šæœ‰å€¼æ—¶ç”¨</span></span><br><span class="line"><span class="type">int</span> val2 = opt.<span class="built_in">value</span>();   <span class="comment">// å…è®¸æŠ›å¼‚å¸¸æ—¶ç”¨</span></span><br><span class="line"><span class="type">int</span> val3 = opt.<span class="built_in">value_or</span>(<span class="number">0</span>); <span class="comment">// ç©ºå€¼å…œåº•æ—¶ç”¨</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1>3.ä½¿ç”¨ç¤ºä¾‹</h1>
<h2 id="1-å¯é€‰çš„è¿”å›å€¼">1.å¯é€‰çš„è¿”å›å€¼</h2>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;optional&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">std::optional&lt;<span class="type">int</span>&gt; <span class="title">asInt</span><span class="params">(<span class="type">const</span> std::string&amp; s)</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="type">size_t</span> pos;</span><br><span class="line">        <span class="type">int</span> result = std::<span class="built_in">stoi</span>(s, &amp;pos);  <span class="comment">// stoi ä¼šæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">if</span> (pos != s.<span class="built_in">length</span>()) &#123;  <span class="comment">// éƒ¨åˆ†è½¬æ¢</span></span><br><span class="line">            <span class="keyword">return</span> std::<span class="literal">nullopt</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;<span class="built_in">catch</span>(...)&#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="literal">nullopt</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> s: &#123;<span class="string">&quot;111&quot;</span>,<span class="string">&quot;123c&quot;</span>&#125;)&#123;</span><br><span class="line">        std::optional&lt;<span class="type">int</span>&gt; oi=<span class="built_in">asInt</span>(s);</span><br><span class="line">        <span class="keyword">if</span>(oi.<span class="built_in">has_value</span>())&#123; <span class="comment">// æˆ– if(oi)</span></span><br><span class="line">            std::cout&lt;&lt;<span class="string">&quot;convert &#x27;&quot;</span>&lt;&lt;s&lt;&lt;<span class="string">&quot;&#x27; to int: &quot;</span>&lt;&lt;oi.<span class="built_in">value</span>()&lt;&lt;<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            std::cout&lt;&lt;<span class="string">&quot;convert failed&quot;</span>&lt;&lt;<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-å¯é€‰çš„å‚æ•°å’Œæ•°æ®æˆå‘˜">2.å¯é€‰çš„å‚æ•°å’Œæ•°æ®æˆå‘˜</h2>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;optional&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Name</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string first;</span><br><span class="line">    std::optional&lt;std::string&gt; middle;</span><br><span class="line">    std::string last;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Name</span> (std::string f, std::optional&lt;std::string&gt; m, std::string l)</span><br><span class="line">        :first&#123;std::<span class="built_in">move</span>(f)&#125;, middle&#123;std::<span class="built_in">move</span>(m)&#125;, last&#123;std::<span class="built_in">move</span>(l)&#125; &#123; <span class="comment">//ç§»åŠ¨æ„é€ </span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> std::ostream&amp; <span class="keyword">operator</span> &lt;&lt; (std::ostream&amp; strm, <span class="type">const</span> Name&amp; n) &#123;</span><br><span class="line">        strm &lt;&lt; n.first &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (n.middle.<span class="built_in">has_value</span>()) &#123; <span class="comment">//ä¹Ÿå¯ä»¥ç›´æ¥ï¼š n.middle</span></span><br><span class="line">            strm &lt;&lt; n.middle.<span class="built_in">value</span>() &lt;&lt; <span class="string">&#x27; &#x27;</span>;  <span class="comment">//ä¹Ÿå¯ä»¥ï¼š *n.middle</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> strm &lt;&lt; n.last;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="3-å®é™…ä½¿ç”¨åœºæ™¯ï¼šè¿æ¥æ± é…ç½®">3.å®é™…ä½¿ç”¨åœºæ™¯ï¼šè¿æ¥æ± é…ç½®</h2>
<h3 id="1-æ¦‚è¿°">(1)æ¦‚è¿°</h3>
<ul>
<li><strong>åœ¨é…ç½®ä¸­ï¼Œæœ‰äº›é…ç½®é¡¹å¯èƒ½ä½¿ç”¨ï¼Œä¹Ÿå¯èƒ½ä¸ä½¿ç”¨ï¼Œè¿™æ—¶å°±å¯ä»¥std::optional&lt;&gt;</strong></li>
<li><strong>é…ç½®æ˜¯ä»æ–‡ä»¶ä¸­è¯»å–ï¼Œç„¶åæ ¹æ®æœ‰æ— å€¼ï¼Œå­˜å‚¨åˆ°é…ç½®ç»“æ„ä½“ä¸­</strong></li>
</ul>
<h3 id="2-ä»£ç ç¤ºä¾‹">(2)ä»£ç ç¤ºä¾‹</h3>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># mysqléƒ¨åˆ†é…ç½®ï¼ˆyamlæ ¼å¼ï¼‰</span></span><br><span class="line"><span class="attr">mysql:</span></span><br><span class="line">  <span class="comment"># ...</span></span><br><span class="line">  <span class="comment"># è¶…æ—¶é…ç½®ï¼ˆæ¯«ç§’ï¼‰</span></span><br><span class="line">  <span class="attr">connection_timeout_ms:</span> <span class="number">5000</span>      <span class="comment"># å­˜åœ¨</span></span><br><span class="line">  <span class="comment"># read_timeout_ms: 30000        # ä¸å­˜åœ¨</span></span><br><span class="line">  <span class="comment"># write_timeout_ms: 30000        # ä¸å­˜åœ¨</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># é‡è¯•é…ç½®</span></span><br><span class="line">  <span class="attr">max_retries:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">retry_interval_ms:</span> <span class="number">1000</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># å…¶ä»–é…ç½®</span></span><br><span class="line">  <span class="attr">auto_reconnect:</span> <span class="literal">true</span>            <span class="comment"># å­˜åœ¨</span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//MySQLé…ç½®éƒ¨åˆ†ä»£ç </span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MySQLConfig</span> &#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¶…æ—¶é…ç½®(ms)(å¯èƒ½æœ‰ï¼Œå¯èƒ½æ— )</span></span><br><span class="line">    std::optional&lt;<span class="type">unsigned</span> <span class="type">int</span>&gt; connection_timeout_ms;</span><br><span class="line">    std::optional&lt;<span class="type">unsigned</span> <span class="type">int</span>&gt; read_timeout_ms;</span><br><span class="line">    std::optional&lt;<span class="type">unsigned</span> <span class="type">int</span>&gt; write_timeout_ms;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//è¿æ¥å¤±è´¥ï¼Œé‡è¯•é…ç½®</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> max_retries=<span class="number">3</span>; </span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> retry_interval_ms=<span class="number">1000</span>; <span class="comment">//é‡è¯•é—´éš”ï¼ˆmsï¼‰</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å…¶å®ƒé…ç½®</span></span><br><span class="line">    std::optional&lt;<span class="type">bool</span>&gt; auto_reconnect; <span class="comment">//å¯èƒ½æœ‰å¯èƒ½æ— </span></span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MySQLConnection::InitAndSetOptions</span><span class="params">(<span class="type">const</span> MySQLConfig&amp; config)</span></span>&#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¦‚æœâ€œè¿æ¥è¶…æ—¶â€å­˜åœ¨ï¼Œå°±è®¾ç½®â€œè¿æ¥è¶…æ—¶é€‰é¡¹â€</span></span><br><span class="line">    <span class="keyword">if</span>(config.connection_timeout_ms.<span class="built_in">has_value</span>())&#123;</span><br><span class="line">        <span class="type">int</span> connection_timeout=config.connection_timeout_ms.<span class="built_in">value</span>()/<span class="number">1000</span>; <span class="comment">//è·å–å€¼</span></span><br><span class="line">        <span class="built_in">mysql_options</span>(mysql_,MYSQL_OPT_CONNECT_TIMEOUT,&amp;connection_timeout);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¦‚æœâ€œè¯»è¶…æ—¶â€å­˜åœ¨ï¼Œå°±è®¾ç½®â€œè¯»è¶…æ—¶é€‰é¡¹â€</span></span><br><span class="line">    <span class="keyword">if</span>(config.read_timeout_ms.<span class="built_in">has_value</span>())&#123;</span><br><span class="line">        <span class="type">int</span> read_timeout=config.read_timeout_ms.<span class="built_in">value</span>()/<span class="number">1000</span>; <span class="comment">//è·å–å€¼</span></span><br><span class="line">        <span class="built_in">mysql_options</span>(mysql_,MYSQL_OPT_READ_TIMEOUT,&amp;read_timeout);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¦‚æœâ€œå†™è¶…æ—¶â€å­˜åœ¨ï¼Œå°±è®¾ç½®â€œå†™è¶…æ—¶é€‰é¡¹â€</span></span><br><span class="line">    <span class="keyword">if</span>(config.write_timeout_ms.<span class="built_in">has_value</span>())&#123;</span><br><span class="line">        <span class="type">int</span> write_timeout=config.write_timeout_ms.<span class="built_in">value</span>()/<span class="number">1000</span>; <span class="comment">//è·å–å€¼</span></span><br><span class="line">        <span class="built_in">mysql_options</span>(mysql_,MYSQL_OPT_WRITE_TIMEOUT,&amp;write_timeout);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¦‚æœâ€œé‡è¿æ¥â€å­˜åœ¨ï¼Œå°±è®¾ç½®â€œé‡è¿æ¥é€‰é¡¹â€</span></span><br><span class="line">    <span class="keyword">if</span>(config.auto_reconnect.<span class="built_in">has_value</span>())&#123;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">int</span> mybool=config.auto_reconnect.<span class="built_in">value</span>()?<span class="number">1</span>:<span class="number">0</span>; <span class="comment">//è·å–å€¼</span></span><br><span class="line">        <span class="built_in">mysql_options</span>(mysql_,MYSQL_OPT_RECONNECT,&amp;mybool);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MySQLConnection::<span class="built_in">MySQLConnection</span>(<span class="type">const</span> MySQLConfig&amp; config)&#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">mysql_real_connect</span>(mysql_,</span><br><span class="line">                            config.host.<span class="built_in">c_str</span>(),</span><br><span class="line">                            config.username.<span class="built_in">c_str</span>(),</span><br><span class="line">                            config.password.<span class="built_in">c_str</span>(),</span><br><span class="line">                            config.database.<span class="built_in">c_str</span>(),</span><br><span class="line">                            config.port,</span><br><span class="line">                            <span class="literal">nullptr</span>,</span><br><span class="line">                            <span class="number">0</span>))&#123;</span><br><span class="line">        <span class="comment">//è¿æ¥å¤±è´¥</span></span><br><span class="line">        ...</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//ä¸é‡è¿çš„æ¡ä»¶ï¼š é‡è¿é…ç½®ä¸å­˜åœ¨ || é‡è¿é…ç½®å­˜åœ¨ ä½† è®¾ç½®ä¸ºfalse â€”â€”&gt; value_or(false) </span></span><br><span class="line">        <span class="type">bool</span> should_retry = config.auto_reconnect.<span class="built_in">value_or</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!should_retry) &#123;</span><br><span class="line">            <span class="built_in">LOG_ERROR</span>(<span class="string">&quot;mysql_real_connect failed [&#123;&#125;]: &#123;&#125;&quot;</span>, err_code, err_msg);</span><br><span class="line">            <span class="keyword">throw</span> <span class="built_in">MySQLException</span>(err_code, err_msg);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//é‡è¿</span></span><br><span class="line">        <span class="built_in">ConnectWithRetry</span>(config);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>C++</category>
        <category>ã€ŠC++17å®Œå…¨æŒ‡å—ã€‹</category>
        <category>ä¸‰ã€æ–°çš„æ ‡å‡†åº“ç»„ä»¶</category>
        <category>15.std::optional&lt;&gt;</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>10 ç¼–è¯‘æœŸifè¯­å¥</title>
    <url>/2026/01/07/C++/%E3%80%8AC++17%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97%E3%80%8B/10-%E7%BC%96%E8%AF%91%E6%9C%9Fif%E8%AF%AD%E5%8F%A5/</url>
    <content><![CDATA[<h1>1.æ¦‚è¿°</h1>
<p>1.é€šè¿‡ä½¿ç”¨è¯­æ³•<strong>if constexpr(â€¦)</strong>ï¼Œç¼–è¯‘å™¨å¯ä»¥è®¡ç®—ç¼–è¯‘æœŸçš„æ¡ä»¶è¡¨è¾¾å¼æ¥<strong>åœ¨ç¼–è¯‘æœŸå†³å®š</strong>ä½¿ç”¨ä¸€ä¸ªifè¯­å¥<br>
çš„thençš„éƒ¨åˆ†è¿˜æ˜¯elseçš„éƒ¨åˆ†ã€‚<br>
2.å…¶ä½™éƒ¨åˆ†çš„ä»£ç å°†ä¼šè¢«ä¸¢å¼ƒï¼Œè¿™æ„å‘³ç€å®ƒä»¬ç”šè‡³ä¸ä¼šè¢«ç”Ÿæˆã€‚<br>
3.è¿™å¹¶ä¸æ„å‘³ç€è¢«ä¸¢å¼ƒçš„éƒ¨åˆ†å®Œå…¨è¢«å¿½ç•¥ï¼Œè¿™äº›éƒ¨åˆ†ä¸­çš„ä»£ç ä¹Ÿä¼šåƒæ²¡ä½¿ç”¨çš„æ¨¡æ¿ä¸€æ ·è¿›è¡Œè¯­æ³•æ£€æŸ¥ã€‚<br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/2026.1.7_1.png" alt=""></p>
<p><strong>ç‰¹åˆ«å¼ºè°ƒï¼šè¢«å¿½ç•¥çš„è¯­å¥ä¹Ÿå¿…é¡»ç¬¦åˆæ­£ç¡®çš„è¯­æ³•</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(T t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">if</span> <span class="title">constexpr</span><span class="params">(std::is_integral_v&lt;T&gt;)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (t &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">foo</span>(tâ€<span class="number">1</span>);<span class="comment">// OK</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">undeclared</span>(t); <span class="comment">// å¦‚æœæœªè¢«å£°æ˜ä¸”æœªè¢«ä¸¢å¼ƒå°†å¯¼è‡´é”™è¯¯</span></span><br><span class="line">            <span class="built_in">undeclared</span>(); <span class="comment">// å¦‚æœæœªå£°æ˜å°†å¯¼è‡´é”™è¯¯ï¼ˆå³ä½¿è¢«ä¸¢å¼ƒä¹Ÿä¸€æ ·ï¼‰</span></span><br><span class="line">            <span class="built_in">static_assert</span>(<span class="literal">false</span>, <span class="string">&quot;no integral&quot;</span>); <span class="comment">// æ€»æ˜¯ä¼šè¿›è¡Œæ–­è¨€ï¼ˆå³ä½¿è¢«ä¸¢å¼ƒä¹Ÿä¸€æ ·ï¼‰</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/2026.1.7_2.png" alt=""></p>
<h1>2.ä½¿ç”¨ç¼–è¯‘æœŸifè¯­å¥</h1>
<p><strong>1.ç†è®ºä¸Šæ¥è¯´ï¼šåªè¦æ¡ä»¶è¡¨è¾¾å¼æ˜¯ç¼–è¯‘æœŸçš„è¡¨è¾¾å¼ä½ å°±å¯ä»¥åƒä½¿ç”¨è¿è¡ŒæœŸifä¸€æ ·ä½¿ç”¨ç¼–è¯‘æœŸif</strong><br>
<strong>2.ä¹Ÿå¯ä»¥æ··åˆä½¿ç”¨ç¼–è¯‘æœŸå’Œè¿è¡ŒæœŸçš„if</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;type_traits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;limits&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(T val)</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">if</span> <span class="title">constexpr</span> <span class="params">(std::is_integral_v&lt;std::<span class="type">remove_reference_t</span>&lt;T&gt;&gt;)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (val &gt; <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">if</span> <span class="title">constexpr</span> <span class="params">(std::numeric_limits&lt;<span class="type">char</span>&gt;::is_signed)</span> </span>&#123;</span><br><span class="line">                <span class="comment">// char æ˜¯æœ‰ç¬¦å·çš„</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// char æ˜¯æ— ç¬¦å·çš„</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// val &lt;= 10</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// T ä¸æ˜¯æ•´å‹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„:ä½ ä¸èƒ½åœ¨å‡½æ•°ä½“ä¹‹å¤–ä½¿ç”¨if constexprã€‚å› æ­¤ï¼Œä½ ä¸èƒ½ä½¿ç”¨å®ƒæ¥æ›¿æ¢é¢„å¤„ç†å™¨çš„æ¡ä»¶ç¼–è¯‘(#if / #ifdef)ã€‚</strong></p>
<h2 id="2-1-ç¼–è¯‘æœŸifçš„æ³¨æ„äº‹é¡¹">2.1 ç¼–è¯‘æœŸifçš„æ³¨æ„äº‹é¡¹</h2>
<h3 id="1-ç¼–è¯‘æœŸifå¯èƒ½å½±å“è¿”å›å€¼ç±»å‹">1.ç¼–è¯‘æœŸifå¯èƒ½å½±å“è¿”å›å€¼ç±»å‹</h3>
<p><strong>ä¸‹é¢çš„ä»£ç æ€»èƒ½é€šè¿‡ç¼–è¯‘ï¼Œä½†è¿”å›å€¼çš„ç±»å‹å¯èƒ½ä¼šä¸åŒï¼š</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">foo</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">if</span> <span class="title">constexpr</span><span class="params">(<span class="keyword">sizeof</span>(<span class="type">int</span>)&gt;<span class="number">4</span>)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">42</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">42u</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å¦‚æœå¤§äº4å­—èŠ‚ï¼Œè¿”å›42çš„è¿”å›è¯­å¥å°†ä¼šç”Ÿæ•ˆï¼Œå› æ­¤è¿”å›å€¼ç±»å‹æ˜¯intã€‚</li>
<li>å¦åˆ™ï¼Œè¿”å›42uçš„è¿”å›è¯­å¥å°†ç”Ÿæ•ˆï¼Œå› æ­¤è¿”å›å€¼ç±»å‹æ˜¯unsigned intã€‚</li>
</ul>
<h3 id="2-å³ä½¿åœ¨thenéƒ¨åˆ†è¿”å›ä¹Ÿè¦è€ƒè™‘elseéƒ¨åˆ†">2.å³ä½¿åœ¨thenéƒ¨åˆ†è¿”å›ä¹Ÿè¦è€ƒè™‘elseéƒ¨åˆ†</h3>
<p><strong>è¿è¡ŒæœŸifæœ‰ä¸€ä¸ªæ¨¡å¼ä¸èƒ½åº”ç”¨äºç¼–è¯‘æœŸif</strong></p>
<ul>
<li>å¦‚æœä»£ç åœ¨thenå’Œelseéƒ¨åˆ†éƒ½ä¼šè¿”å›ï¼Œé‚£ä¹ˆåœ¨è¿è¡ŒæœŸifä¸­ä½ å¯ä»¥è·³è¿‡elseéƒ¨åˆ†<br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260107090515331.png" alt=""></li>
</ul>
<h2 id="2-2å…¶ä»–ç¼–è¯‘æœŸifçš„ç¤ºä¾‹">2.2å…¶ä»–ç¼–è¯‘æœŸifçš„ç¤ºä¾‹</h2>
<h3 id="å®Œç¾è¿”å›æ³›å‹å€¼">å®Œç¾è¿”å›æ³›å‹å€¼</h3>
<ul>
<li>å…ˆå¯¹è¿”å›å€¼è¿›è¡Œä¸€äº›å¤„ç†ï¼Œå†è¿›è¡Œå®Œç¾è½¬å‘</li>
<li>å› ä¸ºdecltype(auto)ä¸èƒ½æ¨å¯¼<br>
ä¸ºvoidï¼ˆå› ä¸ºvoidæ˜¯ä¸å®Œå…¨ç±»å‹ï¼‰ï¼Œæ‰€ä»¥ä½ å¿…é¡»åƒä¸‹é¢è¿™ä¹ˆå†™ï¼š<br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260107091404987.png" alt=""></li>
</ul>
]]></content>
      <categories>
        <category>C++</category>
        <category>ã€ŠC++17å®Œå…¨æŒ‡å—ã€‹</category>
        <category>äºŒã€æ¨¡æ¿ç‰¹æ€§</category>
        <category>10 ç¼–è¯‘æœŸifè¯­å¥</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>&lt;type_traits&gt; â€œæ ‡å‡†èƒå–åº“â€</title>
    <url>/2026/01/08/C++/%E6%A0%87%E5%87%86%E5%BA%93/type-traits-%E2%80%9C%E6%A0%87%E5%87%86%E8%90%83%E5%8F%96%E5%BA%93%E2%80%9D/</url>
    <content><![CDATA[<h1>1.ä»‹ç»</h1>
<p>1.&lt;type_traits&gt; æ˜¯ C++11 èµ·å¼•å…¥çš„<strong>ç±»å‹èƒå–</strong>æ ¸å¿ƒå¤´æ–‡ä»¶ï¼Œæä¾›<strong>ç¼–è¯‘æœŸ æŸ¥è¯¢/ä¿®æ”¹ç±»å‹å±æ€§</strong>çš„å·¥å…·ï¼Œåœ¨<strong>æ³›å‹ç¼–ç¨‹</strong>ä¸­é«˜é¢‘ä½¿ç”¨<br>
2. <strong>_v åç¼€ï¼ˆC++17ï¼‰</strong>ï¼šæ›¿ä»£ ::valueï¼Œ<strong>è¿”å›å¸ƒå°”å¸¸é‡</strong><br>
3. <strong>_t åç¼€ï¼ˆC++14ï¼‰</strong>ï¼šæ›¿ä»£ ::typeï¼Œ<strong>è¿”å›ä¿®æ”¹åçš„ç±»å‹</strong></p>
<p><strong>å…³é”®ï¼šç¼–è¯‘æœŸ</strong></p>
<h1>2.å…³é”®API</h1>
<p><strong>ä»¥ä¸‹å·¥å…·å‡æ¥è‡ª&lt;type_traits&gt;å¤´æ–‡ä»¶ï¼Œæ˜¯é«˜æ€§èƒ½å¼€å‘ï¼ˆå¦‚æ³›å‹ä¼˜åŒ–ã€å†…å­˜ç®¡ç†ã€é›¶å¼€é”€æŠ½è±¡ï¼‰çš„æ ¸å¿ƒç±»å‹æ“ä½œå·¥å…·ï¼Œå…¼å…·ç¼–è¯‘æœŸæ— å¼€é”€ã€ç±»å‹å®‰å…¨çš„ç‰¹æ€§ã€‚</strong><br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260108161948438.png" alt=""></p>
<h2 id="ä½¿ç”¨ç¤ºä¾‹">ä½¿ç”¨ç¤ºä¾‹</h2>
<h3 id="1-std-is-same-v-T1-T2-ï¼ˆæ³›å‹å‡½æ•°åˆ†æ”¯ä¼˜åŒ–ï¼‰">1.std::is_same_v&lt;T1, T2&gt;ï¼ˆæ³›å‹å‡½æ•°åˆ†æ”¯ä¼˜åŒ–ï¼‰</h3>
<p><strong>æ ¸å¿ƒåŠŸèƒ½ï¼šç¼–è¯‘æœŸåŒºåˆ†intå’Œdoubleç±»å‹ï¼Œé€‰ç”¨ä½è¿ç®—æˆ–æ™®é€šä¹˜æ³•ï¼Œå®ç°æ— è¿è¡Œæ—¶å¼€é”€çš„é«˜æ•ˆæ•°å€¼è®¡ç®—ã€‚</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;type_traits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é«˜æ€§èƒ½æ•°å€¼è®¡ç®—ï¼šæ ¹æ®ç±»å‹é€‰æ‹©æœ€ä¼˜è¿ç®—é€»è¾‘ï¼ˆç¼–è¯‘æœŸåˆ†æ”¯ï¼Œæ— è¿è¡Œæ—¶å¼€é”€ï¼‰</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">T <span class="title">high_perf_calc</span><span class="params">(T val)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ç¼–è¯‘æœŸåˆ¤æ–­ç±»å‹ï¼Œintç”¨ä½è¿ç®—ï¼ˆæ¯”ä¹˜æ³•é«˜æ•ˆï¼‰ï¼Œdoubleç”¨æ™®é€šä¹˜æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">if</span> <span class="title">constexpr</span> <span class="params">(std::is_same_v&lt;T, <span class="type">int</span>&gt;)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> val &lt;&lt; <span class="number">1</span>; <span class="comment">// ä½è¿ç®—æ›¿ä»£ *2ï¼Œæ€§èƒ½æ›´ä¼˜</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="built_in">constexpr</span> (std::is_same_v&lt;T, <span class="type">double</span>&gt;) &#123;</span><br><span class="line">        <span class="keyword">return</span> val * <span class="number">2.0</span>; <span class="comment">// doubleä¸æ”¯æŒä½è¿ç®—ï¼Œç›´æ¥ä¹˜æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> val;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨åœºæ™¯</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">10</span>;</span><br><span class="line">    <span class="type">double</span> b = <span class="number">3.14</span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">high_perf_calc</span>(a) &lt;&lt; std::endl; <span class="comment">// è¾“å‡º20ï¼ˆä½è¿ç®—ï¼‰</span></span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">high_perf_calc</span>(b) &lt;&lt; std::endl; <span class="comment">// è¾“å‡º6.28ï¼ˆä¹˜æ³•ï¼‰</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-std-remove-reference-t-T-ï¼ˆå®Œç¾è½¬å‘é…å¥—ä¼˜åŒ–ï¼‰">2.std::remove_reference_t<T>ï¼ˆå®Œç¾è½¬å‘é…å¥—ä¼˜åŒ–ï¼‰</h3>
<p><strong>æ ¸å¿ƒåŠŸèƒ½ï¼šé…åˆstd::forwardå®ç°å‚æ•°å®Œç¾è½¬å‘ï¼Œç»“åˆç¼–è¯‘æœŸç±»å‹æ ¡éªŒï¼Œé¿å…å¤§å¯¹è±¡æ„é€ æ—¶çš„å†—ä½™æ‹·è´ã€‚</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;type_traits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;utility&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é«˜æ€§èƒ½å¯¹è±¡æ„é€ ï¼šå®Œç¾è½¬å‘å‚æ•°ï¼Œé¿å…å¤§å¯¹è±¡æ‹·è´</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span>... Args&gt;</span><br><span class="line"><span class="function">T* <span class="title">create_high_perf_obj</span><span class="params">(Args&amp;&amp;... args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ç¼–è¯‘æœŸæ ¡éªŒå‚æ•°ç±»å‹ï¼ˆç§»é™¤å¼•ç”¨åï¼‰æ˜¯å¦å¯æ„é€ Tï¼Œæ— è¿è¡Œæ—¶å¼€é”€</span></span><br><span class="line">    <span class="built_in">static_assert</span>((std::is_constructible_v&lt;T, std::<span class="type">remove_reference_t</span>&lt;Args&gt;...&gt;), <span class="string">&quot;Args cannot construct T&quot;</span>);</span><br><span class="line">    <span class="comment">// ç›´æ¥è½¬å‘å‚æ•°æ„é€ å¯¹è±¡ï¼Œæ— å†—ä½™æ‹·è´ï¼ˆå³å€¼æ—¶ç§»åŠ¨ï¼Œå·¦å€¼æ—¶å¤ç”¨ï¼‰</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">T</span>(std::forward&lt;Args&gt;(args)...);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨åœºæ™¯ï¼šå¤§å¯¹è±¡ï¼ˆå¦‚std::stringï¼‰æ„é€ ï¼Œé¿å…æ‹·è´å¼€é”€</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::string big_str = <span class="string">&quot;high performance string&quot;</span>;</span><br><span class="line">    <span class="comment">// è½¬å‘å³å€¼ï¼Œç§»åŠ¨æ„é€ ï¼ˆæ— æ‹·è´ï¼‰</span></span><br><span class="line">    <span class="keyword">auto</span> p1 = <span class="built_in">create_high_perf_obj</span>&lt;std::string&gt;(std::<span class="built_in">move</span>(big_str));</span><br><span class="line">    <span class="comment">// è½¬å‘ä¸´æ—¶å³å€¼ï¼Œç›´æ¥æ„é€ ï¼ˆæ— æ‹·è´ï¼‰</span></span><br><span class="line">    <span class="keyword">auto</span> p2 = <span class="built_in">create_high_perf_obj</span>&lt;std::string&gt;(<span class="string">&quot;temporary string&quot;</span>);</span><br><span class="line">    <span class="keyword">delete</span> p1;</span><br><span class="line">    <span class="keyword">delete</span> p2;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-std-decay-t-T-ï¼ˆå®¹å™¨å…ƒç´ ç±»å‹ç»Ÿä¸€ï¼‰">3.std::decay_t<T>ï¼ˆå®¹å™¨å…ƒç´ ç±»å‹ç»Ÿä¸€ï¼‰</h3>
<p><strong>æ ¸å¿ƒåŠŸèƒ½ï¼šç»Ÿä¸€å®¹å™¨å…ƒç´ ç±»å‹ï¼Œç§»é™¤å¼•ç”¨ã€constç­‰é™å®šï¼Œé€šè¿‡åŸåœ°æ„é€ ä¼˜åŒ–å†…å­˜å¸ƒå±€ï¼Œæå‡å®¹å™¨è®¿é—®æ•ˆç‡ã€‚</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;type_traits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é«˜æ€§èƒ½å®¹å™¨åˆ›å»ºï¼šç»Ÿä¸€å…ƒç´ ç±»å‹ï¼Œä¼˜åŒ–å†…å­˜å¸ƒå±€</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">create_unified_container</span><span class="params">(T&amp;&amp; val)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// é€€åŒ–ç±»å‹ï¼šç§»é™¤å¼•ç”¨ã€constç­‰ï¼Œç¡®ä¿å®¹å™¨å…ƒç´ ç±»å‹ç»Ÿä¸€ï¼ˆé¿å…å­˜å‚¨å¼•ç”¨/constç±»å‹ï¼‰</span></span><br><span class="line">    <span class="keyword">using</span> DecayedType = std::<span class="type">decay_t</span>&lt;T&gt;;</span><br><span class="line">    <span class="comment">// å®¹å™¨å­˜å‚¨é€€åŒ–åçš„ç±»å‹ï¼Œå†…å­˜å¸ƒå±€ç´§å‡‘ï¼Œè®¿é—®æ•ˆç‡é«˜</span></span><br><span class="line">    std::vector&lt;DecayedType&gt; vec;</span><br><span class="line">    vec.<span class="built_in">emplace_back</span>(std::forward&lt;T&gt;(val)); <span class="comment">// åŸåœ°æ„é€ ï¼Œé¿å…æ‹·è´</span></span><br><span class="line">    <span class="keyword">return</span> vec;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨åœºæ™¯ï¼šé€‚é…ä¸åŒç±»å‹è¾“å…¥ï¼Œç»Ÿä¸€å®¹å™¨å…ƒç´ ç±»å‹</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">const</span> std::string&amp; ref_str = <span class="string">&quot;const reference string&quot;</span>;</span><br><span class="line">    <span class="comment">// é€€åŒ–åç±»å‹ä¸ºstd::stringï¼Œå®¹å™¨å­˜å‚¨éconstã€éå¼•ç”¨ç±»å‹</span></span><br><span class="line">    <span class="keyword">auto</span> vec = <span class="built_in">create_unified_container</span>(ref_str);</span><br><span class="line">    std::cout &lt;&lt; vec[<span class="number">0</span>] &lt;&lt; std::endl; <span class="comment">// è¾“å‡ºï¼šconst reference string</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-std-conditional-t-Cond-T1-T2-ï¼ˆåŠ¨æ€ç±»å‹é€‚é…ä¼˜åŒ–ï¼‰">4.std::conditional_t&lt;Cond, T1, T2&gt;ï¼ˆåŠ¨æ€ç±»å‹é€‚é…ä¼˜åŒ–ï¼‰</h3>
<p><strong>æ ¸å¿ƒåŠŸèƒ½ï¼šæ ¹æ®ç±»å‹å¤§å°åŠ¨æ€é€‰æ‹©å­˜å‚¨æ–¹å¼ï¼Œå°ç±»å‹æ ˆå­˜å‚¨æå‡è®¿é—®é€Ÿåº¦ï¼Œå¤§ç±»å‹å †å­˜å‚¨é¿å…æ ˆæº¢å‡ºï¼Œå¹³è¡¡å†…å­˜ä¸æ€§èƒ½ã€‚</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;type_traits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é«˜æ€§èƒ½å†…å­˜åˆ†é…ï¼šæ ¹æ®ç±»å‹å¤§å°é€‰æ‹©å­˜å‚¨æ–¹å¼ï¼ˆå°ç±»å‹æ ˆå­˜ï¼Œå¤§ç±»å‹å †å­˜ï¼‰</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">high_perf_allocate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ç¼–è¯‘æœŸåˆ¤æ–­ç±»å‹å¤§å°ï¼Œå°ç±»å‹ï¼ˆ&lt;=8å­—èŠ‚ï¼‰æ ˆå­˜å‚¨ï¼Œå¤§ç±»å‹å †å­˜å‚¨ï¼ˆå¹³è¡¡å†…å­˜ä¸é€Ÿåº¦ï¼‰</span></span><br><span class="line">    <span class="keyword">using</span> StorageType = std::<span class="type">conditional_t</span>&lt;</span><br><span class="line">        <span class="built_in">sizeof</span>(T) &lt;= <span class="number">8</span>,</span><br><span class="line">        T,                  <span class="comment">// å°ç±»å‹ï¼šæ ˆå­˜å‚¨ï¼Œè®¿é—®æ›´å¿«</span></span><br><span class="line">        std::unique_ptr&lt;T&gt;  <span class="comment">// å¤§ç±»å‹ï¼šå †å­˜å‚¨ï¼Œé¿å…æ ˆæº¢å‡º</span></span><br><span class="line">    &gt;;</span><br><span class="line">    <span class="function"><span class="keyword">if</span> <span class="title">constexpr</span> <span class="params">(<span class="keyword">sizeof</span>(T) &lt;= <span class="number">8</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> StorageType&#123;&#125;;  <span class="comment">// æ ˆä¸Šé»˜è®¤æ„é€ </span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">make_unique</span>&lt;T&gt;();  <span class="comment">// å †ä¸Šåˆ†é…</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨åœºæ™¯ï¼šä¸åŒå¤§å°ç±»å‹çš„å·®å¼‚åŒ–å­˜å‚¨ï¼Œæå‡è®¿é—®æ•ˆç‡</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// intï¼ˆ4å­—èŠ‚ï¼Œå°ç±»å‹ï¼‰ï¼šæ ˆå­˜å‚¨</span></span><br><span class="line">    <span class="keyword">auto</span> small_storage = <span class="built_in">high_perf_allocate</span>&lt;<span class="type">int</span>&gt;();</span><br><span class="line">    <span class="comment">// å¤§ç±»å‹ï¼ˆå‡è®¾BigTypeå 32å­—èŠ‚ï¼‰ï¼šå †å­˜å‚¨ï¼ˆæ™ºèƒ½æŒ‡é’ˆè‡ªåŠ¨ç®¡ç†å†…å­˜ï¼‰</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">BigType</span> &#123; <span class="type">char</span> data[<span class="number">32</span>]; &#125;;</span><br><span class="line">    <span class="keyword">auto</span> big_storage = <span class="built_in">high_perf_allocate</span>&lt;BigType&gt;();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-std-is-integral-v-T-ï¼ˆæ•°å€¼è®¡ç®—ä¼˜åŒ–ï¼‰">5.std::is_integral_v<T>ï¼ˆæ•°å€¼è®¡ç®—ä¼˜åŒ–ï¼‰</h3>
<p><strong>æ ¸å¿ƒåŠŸèƒ½ï¼šåŒºåˆ†æ•´æ•°ä¸éæ•´æ•°ç±»å‹ï¼Œæ•´æ•°ç”¨é«˜æ•ˆä½è¿ç®—å¤„ç†ï¼Œéæ•´æ•°ç”¨æ•°å­¦å‡½æ•°ï¼Œå®ç°é’ˆå¯¹æ€§çš„æ•°å€¼å¤„ç†ä¼˜åŒ–ã€‚</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;type_traits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é«˜æ€§èƒ½æ•°å€¼å¤„ç†ï¼šåŒºåˆ†æ•´æ•°/éæ•´æ•°ï¼Œæ‰§è¡Œä¸“å±ä¼˜åŒ–é€»è¾‘</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">T <span class="title">high_perf_num_process</span><span class="params">(T val)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ•´æ•°ç±»å‹ï¼šç”¨é«˜æ•ˆä½è¿ç®—å¤„ç†</span></span><br><span class="line">    <span class="function"><span class="keyword">if</span> <span class="title">constexpr</span> <span class="params">(std::is_integral_v&lt;T&gt;)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (val &amp; <span class="number">0x0F</span>); <span class="comment">// å–ä½4ä½ï¼Œä½è¿ç®—æ¯”å–æ¨¡é«˜æ•ˆ</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// éæ•´æ•°ç±»å‹ï¼šç”¨æ•°å­¦å‡½æ•°å¤„ç†</span></span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">sqrt</span>(val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨åœºæ™¯ï¼šé€šç”¨æ•°å€¼å¤„ç†å‡½æ•°ï¼Œå…¼é¡¾æ•´æ•°é«˜æ•ˆè¿ç®—</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">25</span>;</span><br><span class="line">    <span class="type">double</span> b = <span class="number">25.0</span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">high_perf_num_process</span>(a) &lt;&lt; std::endl; <span class="comment">// è¾“å‡º9ï¼ˆ25çš„ä½4ä½ï¼‰</span></span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">high_perf_num_process</span>(b) &lt;&lt; std::endl; <span class="comment">// è¾“å‡º5.0ï¼ˆå¹³æ–¹æ ¹ï¼‰</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-std-enable-if-t-Condition-T-void-æ®ç±»å‹ç‰¹æ€§å¯ç”¨ä¸åŒçš„ä¼˜åŒ–ç‰ˆæœ¬">6.std::enable_if_t&lt;Condition, T=void&gt;  æ®ç±»å‹ç‰¹æ€§å¯ç”¨ä¸åŒçš„ä¼˜åŒ–ç‰ˆæœ¬</h3>
<p><strong>æ ¸å¿ƒåŠŸèƒ½ï¼šæ ¹æ®ç±»å‹æ˜¯å¦ä¸ºç®—æœ¯ç±»å‹ï¼Œç¼–è¯‘æœŸå¯ç”¨ä¸åŒç‰ˆæœ¬å‡½æ•°ï¼Œæ•°å€¼ç±»å‹æ‰§è¡Œä¹˜æ³•ä¼˜åŒ–ï¼Œéæ•°å€¼ç±»å‹ä½¿ç”¨é€šç”¨é€»è¾‘ï¼Œå®ç°ç²¾å‡†çš„ç±»å‹é€‚é…ä¼˜åŒ–ã€‚</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;type_traits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é«˜æ€§èƒ½æ•°å€¼å¤„ç†ï¼šæ ¹æ®ç±»å‹ç‰¹æ€§å¯ç”¨ä¸åŒçš„ä¼˜åŒ–ç‰ˆæœ¬</span></span><br><span class="line"><span class="comment">// ç‰ˆæœ¬1ï¼šå¤„ç†æ•°å€¼ç±»å‹ï¼ˆå¯ç”¨æ¡ä»¶ï¼šæ˜¯æ•°å€¼ç±»å‹ï¼‰</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">std::<span class="type">enable_if_t</span>&lt;std::is_arithmetic_v&lt;T&gt;, T&gt; </span><br><span class="line"><span class="built_in">optimize_process</span>(T val) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;æ•°å€¼ç±»å‹ä¼˜åŒ–ç‰ˆæœ¬&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> val * <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç‰ˆæœ¬2ï¼šå¤„ç†éæ•°å€¼ç±»å‹ï¼ˆå¯ç”¨æ¡ä»¶ï¼šä¸æ˜¯æ•°å€¼ç±»å‹ï¼‰</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">std::<span class="type">enable_if_t</span>&lt;!std::is_arithmetic_v&lt;T&gt;, T&gt; </span><br><span class="line"><span class="built_in">optimize_process</span>(T val) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;éæ•°å€¼ç±»å‹é€šç”¨ç‰ˆæœ¬&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> val;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨åœºæ™¯ï¼šæ ¹æ®ç±»å‹ç‰¹æ€§è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜ç®—æ³•</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">optimize_process</span>(<span class="number">10</span>);     <span class="comment">// è°ƒç”¨æ•°å€¼ä¼˜åŒ–ç‰ˆæœ¬</span></span><br><span class="line">    <span class="built_in">optimize_process</span>(std::<span class="built_in">string</span>(<span class="string">&quot;test&quot;</span>)); <span class="comment">// è°ƒç”¨éæ•°å€¼é€šç”¨ç‰ˆæœ¬</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="7-std-remove-cv-t-T-ï¼ˆå†…å­˜æ“ä½œä¼˜åŒ–ï¼‰">7.std::remove_cv_t<T>ï¼ˆå†…å­˜æ“ä½œä¼˜åŒ–ï¼‰</h3>
<p><strong>æ ¸å¿ƒåŠŸèƒ½ï¼šç§»é™¤ç±»å‹çš„const/volatileé™å®šï¼Œç¡®ä¿åˆ†é…å¯å†™å†…å­˜ï¼ŒåŒæ—¶é€šè¿‡ç±»å‹è½¬æ¢å·¥å…·ä¿ç•™åŸå§‹cvé™å®šä¾›å®‰å…¨ä½¿ç”¨ï¼Œå®ç°é«˜æ€§èƒ½å†…å­˜åˆ†é…ä¸å®‰å…¨è®¿é—®çš„å¹³è¡¡ã€‚</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;type_traits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨std::remove_cv_tçš„é«˜æ€§èƒ½å†…å­˜å¤„ç†ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">high_perf_mem_alloc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ç§»é™¤const/volatileé™å®šï¼Œç¡®ä¿åˆ†é…å¯å†™å†…å­˜</span></span><br><span class="line">    <span class="keyword">using</span> MutableType = std::<span class="type">remove_cv_t</span>&lt;T&gt;;</span><br><span class="line">    <span class="comment">// åˆ†é…åŸå§‹å¯å†™å†…å­˜ï¼Œå³ä½¿Tæ˜¯constç±»å‹</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">MutableType</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç±»å‹è½¬æ¢å·¥å…·ï¼šä¿ç•™åŸå§‹ç±»å‹çš„cvé™å®šç¬¦</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">T* <span class="title">convert_to_original_type</span><span class="params">(<span class="type">void</span>* ptr)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">static_cast</span>&lt;T*&gt;(ptr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å³ä½¿è¯·æ±‚const intç±»å‹çš„å†…å­˜ï¼Œä¹Ÿåˆ†é…å¯ä¿®æ”¹çš„å†…å­˜</span></span><br><span class="line">    <span class="type">void</span>* memory = <span class="built_in">high_perf_mem_alloc</span>&lt;<span class="type">const</span> <span class="type">int</span>&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¡«å……æ•°æ®ï¼ˆå› ä¸ºå®é™…å†…å­˜æ˜¯å¯å†™çš„ï¼‰</span></span><br><span class="line">    <span class="type">int</span> value = <span class="number">42</span>;</span><br><span class="line">    std::<span class="built_in">memcpy</span>(memory, &amp;value, <span class="built_in">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è½¬æ¢å›const int*ç±»å‹ä¾›åç»­å®‰å…¨ä½¿ç”¨</span></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span>* result = <span class="built_in">convert_to_original_type</span>&lt;<span class="type">const</span> <span class="type">int</span>&gt;(memory);</span><br><span class="line">    std::cout &lt;&lt; *result &lt;&lt; std::endl; <span class="comment">// è¾“å‡º42</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ¸…ç†å†…å­˜ï¼ˆéœ€è¦è½¬å›éconstç±»å‹ï¼‰</span></span><br><span class="line">    <span class="keyword">delete</span> <span class="built_in">static_cast</span>&lt;<span class="type">int</span>*&gt;(memory);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-std-common-type-t-T1-T2â€¦-ï¼ˆå¤šç±»å‹è¿ç®—ç»Ÿä¸€ï¼‰">8. std::common_type_t&lt;T1, T2â€¦&gt;ï¼ˆå¤šç±»å‹è¿ç®—ç»Ÿä¸€ï¼‰</h3>
<p><strong>æ ¸å¿ƒåŠŸèƒ½ï¼šè·å–å¤šç±»å‹çš„å…¬å…±å…¼å®¹ç±»å‹ï¼Œç»Ÿä¸€æ··åˆè¿ç®—çš„ç»“æœç±»å‹ï¼Œé¿å…å¤šæ¬¡éšå¼è½¬æ¢ï¼Œæå‡è¿ç®—æ•ˆç‡ã€‚</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;type_traits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é«˜æ€§èƒ½å¤šç±»å‹æ··åˆè¿ç®—ï¼šç»Ÿä¸€è¿ç®—ç»“æœç±»å‹ï¼Œé¿å…å†—ä½™è½¬æ¢å¼€é”€</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T1, <span class="keyword">typename</span> T2&gt;</span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">high_perf_mixed_calc</span><span class="params">(T1 a, T2 b)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è·å–ä¸¤ä¸ªç±»å‹çš„å…¬å…±ç±»å‹ï¼Œä½œä¸ºè¿ç®—ç»“æœç±»å‹ï¼ˆç¼–è¯‘æœŸç¡®å®šï¼Œæ— è¿è¡Œæ—¶å¼€é”€ï¼‰</span></span><br><span class="line">    <span class="keyword">using</span> CommonType = std::<span class="type">common_type_t</span>&lt;T1, T2&gt;;</span><br><span class="line">    <span class="comment">// è½¬æ¢ä¸ºå…¬å…±ç±»å‹è¿ç®—ï¼Œé¿å…å¤šæ¬¡éšå¼è½¬æ¢ï¼Œæå‡æ•ˆç‡</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">static_cast</span>&lt;CommonType&gt;(a) + <span class="built_in">static_cast</span>&lt;CommonType&gt;(b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰©å±•ï¼šæ”¯æŒ3ä¸ªåŠä»¥ä¸Šç±»å‹çš„å…¬å…±ç±»å‹è·å–</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T1, <span class="keyword">typename</span> T2, <span class="keyword">typename</span> T3, <span class="keyword">typename</span>... Rest&gt;</span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">high_perf_mixed_calc</span><span class="params">(T1 a, T2 b, T3 c, Rest... rest)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">using</span> CommonType = std::<span class="type">common_type_t</span>&lt;T1, T2, T3, Rest...&gt;;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">static_cast</span>&lt;CommonType&gt;(a) + <span class="built_in">high_perf_mixed_calc</span>(b, c, rest...);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨åœºæ™¯ï¼šå¤šç±»å‹æ··åˆè¿ç®—ï¼Œç»Ÿä¸€ç»“æœç±»å‹æå‡æ•ˆç‡</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// intä¸doubleçš„å…¬å…±ç±»å‹ä¸ºdouble</span></span><br><span class="line">    <span class="keyword">auto</span> res1 = <span class="built_in">high_perf_mixed_calc</span>(<span class="number">10</span>, <span class="number">3.14</span>);</span><br><span class="line">    std::cout &lt;&lt; res1 &lt;&lt; <span class="string">&quot; (ç±»å‹ï¼š&quot;</span> &lt;&lt; <span class="built_in">typeid</span>(res1).<span class="built_in">name</span>() &lt;&lt; <span class="string">&quot;)&quot;</span> &lt;&lt; std::endl; <span class="comment">// è¾“å‡º13.14ï¼ˆdoubleï¼‰</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// intã€floatã€longçš„å…¬å…±ç±»å‹ä¸ºdouble</span></span><br><span class="line">    <span class="keyword">auto</span> res2 = <span class="built_in">high_perf_mixed_calc</span>(<span class="number">5</span>, <span class="number">2.5f</span>, <span class="number">8L</span>,<span class="number">3.0</span>);</span><br><span class="line">    std::cout &lt;&lt; res2 &lt;&lt; <span class="string">&quot; (ç±»å‹ï¼š&quot;</span> &lt;&lt; <span class="built_in">typeid</span>(res2).<span class="built_in">name</span>() &lt;&lt; <span class="string">&quot;)&quot;</span> &lt;&lt; std::endl; <span class="comment">// è¾“å‡º18.5ï¼ˆdoubleï¼‰</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h1>3.å¸¸ç”¨API</h1>
<h2 id="1-ç±»å‹åˆ¤æ–­">1.ç±»å‹åˆ¤æ–­</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260108153048510.png" alt=""></p>
<h2 id="2-ç±»å‹ä¿®æ”¹">2.ç±»å‹ä¿®æ”¹</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260108153216236.png" alt=""></p>
<p><strong>è¡¥å……ï¼šâ€œæ•°ç»„é€€åŒ–&quot;ä¸&quot;å‡½æ•°é€€åŒ–â€</strong><br>
1.Tæ˜¯æ•°ç»„ç±»å‹ï¼šstd::decay_t<T> ä¼šå°†å…¶è½¬æ¢ä¸ºå¯¹åº”çš„æŒ‡é’ˆç±»å‹<br>
2.T æ˜¯å‡½æ•°ç±»å‹ï¼šstd::decay_t<T> ä¼šå°†å…¶è½¬æ¢ä¸ºå¯¹åº”çš„å‡½æ•°æŒ‡é’ˆ</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1.æ•°ç»„é€€åŒ–</span></span><br><span class="line"><span class="type">int</span> arr[<span class="number">10</span>];</span><br><span class="line"><span class="keyword">using</span> OriginalType = <span class="keyword">decltype</span>(arr);       <span class="comment">// int[10]</span></span><br><span class="line"><span class="keyword">using</span> DecayedType = std::<span class="type">decay_t</span>&lt;<span class="keyword">decltype</span>(arr)&gt;;  <span class="comment">// int*</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">static_assert</span>(std::is_same_v&lt;DecayedType, <span class="type">int</span>*&gt;); <span class="comment">// é€šè¿‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//2.å‡½æ•°é€€åŒ–</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123; <span class="keyword">return</span> a + b; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> FuncType = <span class="keyword">decltype</span>(add);           <span class="comment">// int(int, int)</span></span><br><span class="line"><span class="keyword">using</span> DecayedFuncType = std::<span class="type">decay_t</span>&lt;FuncType&gt;;  <span class="comment">// int(*)(int, int)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">static_assert</span>(std::is_same_v&lt;DecayedFuncType, <span class="built_in">int</span>(*)(<span class="type">int</span>, <span class="type">int</span>)&gt;); <span class="comment">// é€šè¿‡</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="3-ç±»å‹é€‰æ‹©">3.ç±»å‹é€‰æ‹©</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260108153946662.png" alt=""></p>
<h2 id="4-å…¶ä»–">4.å…¶ä»–</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260108154031540.png" alt=""></p>
<hr>
<h1>4.æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹</h1>
<h2 id="1-æœ€ä½³å®è·µ">1.æœ€ä½³å®è·µ</h2>
<p>1.<strong>ç¼–è¯‘æœŸä¼˜åŒ–</strong>ï¼šä¼˜å…ˆä½¿ç”¨ç±»å‹ç‰¹æ€§åœ¨ç¼–è¯‘æœŸè§£å†³é—®é¢˜ï¼Œé¿å…è¿è¡Œæ—¶å¼€é”€<br>
2.<strong>ä¸if constexprç»“åˆ</strong>ï¼šC++17åï¼Œç»“åˆæ¡ä»¶ç¼–è¯‘å®ç°é›¶å¼€é”€åˆ†æ”¯<br>
3.<strong>æ¨¡æ¿ç‰¹åŒ–æ›¿ä»£æ–¹æ¡ˆ</strong>ï¼šä½¿ç”¨std::enable_if_tä»£æ›¿ç¹ççš„æ¨¡æ¿ç‰¹åŒ–<br>
4.<strong>ç±»å‹å®‰å…¨è½¬æ¢</strong>ï¼šä½¿ç”¨static_cast&lt;std::common_type_t&lt;T1, T2&gt;&gt;ç¡®ä¿ç±»å‹å®‰å…¨</p>
<h2 id="2-æ½œåœ¨é™·é˜±">2.æ½œåœ¨é™·é˜±</h2>
<p>1.<strong>ç§»é™¤constçš„é™åˆ¶</strong>ï¼šstd::remove_cv_tåªåœ¨ç±»å‹ç³»ç»Ÿä¸­å·¥ä½œï¼Œä¸èƒ½ç”¨äºç»•è¿‡consté™åˆ¶<br>
2.<strong>ç±»å‹ä¿®é¥°ç¬¦æ£€æµ‹é¡ºåº</strong>ï¼šstd::is_const_v&lt;int* const&gt; ä¸ºfalseï¼Œå› ä¸ºconstä¿®é¥°æŒ‡é’ˆè€Œéint<br>
3.<strong>å¼•ç”¨ç±»å‹ç‰¹æ€§</strong>ï¼šå¼•ç”¨ç±»å‹éœ€ç‰¹åˆ«æ³¨æ„ï¼Œå¦‚std::is_same_v&lt;T&amp;, T&gt;æ°¸è¿œä¸ºfalse<br>
4.<strong>ç»§æ‰¿å…³ç³»è¯†åˆ«</strong>ï¼šstd::is_same_vä¸è¯†åˆ«ç»§æ‰¿å…³ç³»ï¼Œéœ€ç”¨std::is_base_of_v</p>
<h2 id="3-æ€§èƒ½è€ƒé‡">3.æ€§èƒ½è€ƒé‡</h2>
<p>1.<strong>æ‰€æœ‰ç±»å‹ç‰¹æ€§åœ¨ç¼–è¯‘æœŸè®¡ç®—</strong>ï¼šè¿è¡Œæ—¶é›¶å¼€é”€<br>
2.<strong>æ¨¡æ¿å®ä¾‹åŒ–å¢åŠ ç¼–è¯‘æ—¶é—´å’ŒäºŒè¿›åˆ¶å¤§å°</strong>ï¼šå¤§å‹é¡¹ç›®ä¸­éœ€å¹³è¡¡ä½¿ç”¨<br>
3.<strong>ç±»å‹ç‰¹æ€§ç»„åˆå¯èƒ½å¯¼è‡´å¤æ‚ç¼–è¯‘é”™è¯¯</strong>ï¼šå»ºè®®ä½¿ç”¨æ¦‚å¿µ(Concepts, C++20)ç®€åŒ–<br>
4.<strong>SFINAEæ¨¡å¼å¯èƒ½å¢åŠ ç¼–è¯‘æ—¶é—´</strong>ï¼šå¤§é‡ä½¿ç”¨std::enable_if_tä¼šå½±å“ç¼–è¯‘æ€§èƒ½</p>
]]></content>
      <categories>
        <category>C++</category>
        <category>æ ‡å‡†åº“</category>
        <category>&lt; type_traits &gt; â€œæ ‡å‡†èƒå–åº“â€</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>16.std::variant&lt;&gt;</title>
    <url>/2026/01/08/C++/%E3%80%8AC++17%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97%E3%80%8B/16-std-variant/</url>
    <content><![CDATA[<h1>1.æ¦‚è¿°</h1>
<p>1.std::variant&lt;&gt; å¯ä»¥è®¤ä¸ºæ˜¯c++ä¸­ç±»å‹å®‰å…¨çš„ union<br>
2.variantæ‰€å çš„å†…å­˜å¤§å°ç­‰äºæ‰€æœ‰å¯èƒ½çš„åº•å±‚ç±»å‹ä¸­<strong>æœ€å¤§çš„</strong>å†åŠ ä¸Šä¸€ä¸ªè®°å½•å½“å‰é€‰é¡¹çš„å›ºå®šå†…å­˜å¼€é”€ã€‚ä¸<br>
ä¼šåˆ†é…å †å†…å­˜ã€‚<br>
3.å’Œstd::optional&lt;&gt;ã€std::anyä¸€æ ·ï¼Œvariantå¯¹è±¡æ˜¯å€¼è¯­ä¹‰ â€”â€”&gt; æ‹·è´è¢«å®ç°ä¸º<strong>æ·±æ‹·è´</strong><br>
4.æ‹·è´std::variant&lt;&gt;çš„å¼€é”€è¦æ¯”æ‹·è´å½“å‰é€‰é¡¹çš„<strong>å¼€é”€ç¨å¾®å¤§ä¸€ç‚¹</strong>ï¼Œå› ä¸ºvariantå¿…é¡»æ‰¾å‡ºè¦æ‹·è´å“ªä¸ªå€¼ã€‚<br>
5.variantä¹Ÿæ”¯æŒmoveè¯­ä¹‰ã€‚</p>
<hr>
<h1>2.å¸¸ç”¨API</h1>
<h2 id="0-å¤´æ–‡ä»¶">0.å¤´æ–‡ä»¶</h2>
<p><strong>#include&lt;variant&gt;</strong></p>
<p><strong>æ³¨æ„</strong>ï¼šä¸¤ä¸ªä¸åŒé€‰é¡¹çš„ç±»å‹ä¹Ÿæœ‰å¯èƒ½ç›¸åŒï¼Œè¿™åœ¨å¤šä¸ªç±»å‹ç›¸åŒçš„é€‰é¡¹åˆ†åˆ«ä»£è¡¨ä¸åŒå«ä¹‰çš„æ—¶å€™å¾ˆæœ‰ç”¨</p>
<ul>
<li>ä¾‹å¦‚ï¼šæœ‰ä¸¤ä¸ªé€‰é¡¹ç±»å‹éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œåˆ†åˆ«ä»£è¡¨æ•°æ®åº“ä¸­ä¸åŒåˆ—çš„åç§°ï¼Œä½ å¯ä»¥çŸ¥é“å½“å‰çš„å€¼ä»£è¡¨å“ªä¸€ä¸ªåˆ—ï¼‰</li>
</ul>
<h2 id="1-æ„é€ ä¸èµ‹å€¼">1.æ„é€ ä¸èµ‹å€¼</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260108110315903.png" alt=""></p>
<h2 id="2-å–å€¼è®¿é—®-API">2.å–å€¼è®¿é—® API</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260108110558319.png" alt=""></p>
<h2 id="3-çŠ¶æ€æŸ¥è¯¢-API">3.çŠ¶æ€æŸ¥è¯¢ API</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260108110959759.png" alt=""></p>
<h2 id="4-ä¿®æ”¹ä¸äº¤æ¢-API">4.ä¿®æ”¹ä¸äº¤æ¢ API</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260108111102983.png" alt=""></p>
<h2 id="5-ç¼–è¯‘æœŸè¾…åŠ©-API">5.ç¼–è¯‘æœŸè¾…åŠ© API</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260108111233871.png" alt=""></p>
<hr>
<h1>3.std::variantä¸­çš„ç±»å‹è¦æ±‚</h1>
<p><strong>std::variant å¯ä»¥åŒ…å«å‡ ä¹ä»»ä½•ç±»å‹ï¼ŒåŒ…æ‹¬ std::optionalã€è‡ªå®šä¹‰ç±»ã€å®¹å™¨ç­‰ã€‚</strong></p>
<h2 id="1-åŸºæœ¬è¦æ±‚">1.åŸºæœ¬è¦æ±‚</h2>
<ul>
<li><strong>å¯ææ„</strong>ï¼ˆDestructibleï¼‰</li>
<li><strong>ä¸èƒ½æ˜¯å¼•ç”¨ç±»å‹</strong>ï¼ˆint&amp; âŒï¼‰</li>
<li><strong>ä¸èƒ½æ˜¯æ•°ç»„ç±»å‹</strong>ï¼ˆint[10] âŒï¼‰</li>
<li><strong>ä¸èƒ½æ˜¯</strong> void</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âœ… å…¨éƒ¨åˆæ³•</span></span><br><span class="line">std::variant&lt;<span class="type">int</span>, <span class="type">double</span>, std::string&gt; v1;                    <span class="comment">// åŸºç¡€ç±»å‹ + string</span></span><br><span class="line">std::variant&lt;<span class="type">int</span>, std::optional&lt;<span class="type">int</span>&gt;&gt; v2;                     <span class="comment">// åŒ…å« optional</span></span><br><span class="line">std::variant&lt;std::vector&lt;<span class="type">int</span>&gt;, std::map&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt; v3;        <span class="comment">// åŒ…å«å®¹å™¨</span></span><br><span class="line">std::variant&lt;std::monostate, <span class="type">int</span>, std::string&gt; v4;            <span class="comment">// monostate ç”¨äºè¡¨ç¤º&quot;ç©º&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰ç±»å‹</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    std::string name;</span><br><span class="line">&#125;;</span><br><span class="line">std::variant&lt;<span class="type">int</span>, MyClass, std::optional&lt;MyClass&gt;&gt; v5;        <span class="comment">// âœ… è‡ªå®šä¹‰ç±»å‹ä¹Ÿå¯ä»¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åµŒå¥— variant</span></span><br><span class="line">std::variant&lt;<span class="type">int</span>, std::variant&lt;<span class="type">double</span>, std::string&gt;&gt; v6;      <span class="comment">// âœ… å¥—å¨ƒä¹Ÿè¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ è¿™äº›æ˜¯éæ³•çš„</span></span><br><span class="line">std::variant&lt;<span class="type">int</span>&amp;, <span class="type">double</span>&gt; bad1;           <span class="comment">// å¼•ç”¨ç±»å‹ä¸è¡Œ</span></span><br><span class="line">std::variant&lt;<span class="type">int</span>[10], <span class="type">double</span>&gt; bad2;        <span class="comment">// C æ•°ç»„ä¸è¡Œ</span></span><br><span class="line">std::variant&lt;<span class="type">void</span>, <span class="type">int</span>&gt; bad3;              <span class="comment">// void ä¸è¡Œ</span></span><br></pre></td></tr></table></figure>
<h2 id="2-å¯¹è‡ªå®šä¹‰ç±»å‹çš„è¦æ±‚">2.å¯¹è‡ªå®šä¹‰ç±»å‹çš„è¦æ±‚</h2>
<ul>
<li><strong>æœ€ä½è¦æ±‚ï¼šå¯ææ„</strong></li>
<li><strong>å…¶å®ƒè¦æ±‚</strong><br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260108141739842.png" alt=""></li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;variant&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… å®Œæ•´å®ç”¨çš„ç±»</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Good</span> &#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    <span class="built_in">Good</span>() = <span class="keyword">default</span>;                        <span class="comment">//é»˜è®¤æ„é€ å‡½æ•°		</span></span><br><span class="line">    <span class="built_in">Good</span>(<span class="type">int</span> val) : <span class="built_in">x</span>(val) &#123;&#125;</span><br><span class="line">    <span class="built_in">Good</span>(<span class="type">const</span> Good&amp;) = <span class="keyword">default</span>;             <span class="comment">// æ‹·è´æ„é€ </span></span><br><span class="line">    <span class="built_in">Good</span>(Good&amp;&amp;) = <span class="keyword">default</span>;                  <span class="comment">// ç§»åŠ¨æ„é€ </span></span><br><span class="line">    Good&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Good&amp;) = <span class="keyword">default</span>;</span><br><span class="line">    Good&amp; <span class="keyword">operator</span>=(Good&amp;&amp;) = <span class="keyword">default</span>;</span><br><span class="line">    ~<span class="built_in">Good</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âš ï¸ æ²¡æœ‰é»˜è®¤æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">NoDefault</span> &#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    <span class="built_in">NoDefault</span>(<span class="type">int</span> val) : <span class="built_in">x</span>(val) &#123;&#125;       <span class="comment">// åªæœ‰å¸¦å‚æ„é€ </span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨æ³•</span></span><br><span class="line">std::variant&lt;Good, <span class="type">int</span>&gt; v1;              <span class="comment">// âœ… Good å¯ä»¥é»˜è®¤æ„é€ </span></span><br><span class="line">std::variant&lt;NoDefault, <span class="type">int</span>&gt; v2;         <span class="comment">// âŒ ç¼–è¯‘é”™è¯¯ï¼NoDefault ä¸èƒ½é»˜è®¤æ„é€ </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£å†³æ–¹æ¡ˆï¼šç”¨ monostate æˆ–æŠŠæœ‰é»˜è®¤æ„é€ çš„ç±»å‹æ”¾å‰é¢</span></span><br><span class="line">std::variant&lt;std::monostate, NoDefault&gt; v3;  <span class="comment">// âœ…</span></span><br><span class="line">std::variant&lt;<span class="type">int</span>, NoDefault&gt; v4;             <span class="comment">// âœ… int åœ¨å‰é¢ï¼Œå¯ä»¥é»˜è®¤æ„é€ </span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="3-ç”¨-std-monostate-è¡¨ç¤º-æ— å€¼">3.ç”¨ std::monostate è¡¨ç¤º&quot;æ— å€¼&quot;</h2>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœ variant çš„ç¬¬ä¸€ä¸ªç±»å‹æ²¡æœ‰é»˜è®¤æ„é€ å‡½æ•°ï¼Œéœ€è¦ç”¨ monostate</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">NoDefault</span> &#123;</span><br><span class="line">    <span class="built_in">NoDefault</span>(<span class="type">int</span> x) : <span class="built_in">val</span>(x) &#123;&#125;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// std::variant&lt;NoDefault, int&gt; v;  // âŒ ç¼–è¯‘é”™è¯¯ï¼ŒNoDefault æ²¡æœ‰é»˜è®¤æ„é€ </span></span><br><span class="line">std::variant&lt;std::monostate, NoDefault, <span class="type">int</span>&gt; v;  <span class="comment">// âœ… monostate å¯ä»¥é»˜è®¤æ„é€ </span></span><br></pre></td></tr></table></figure>
<hr>
<h1>4.std::visit å¤šç±»å‹åˆ†æ”¯å¤„ç†è¯¦è§£</h1>
<h2 id="1-æ ¸å¿ƒåŸç†">1.æ ¸å¿ƒåŸç†</h2>
<ul>
<li><strong>è®¿é—®å™¨ï¼ˆvisitorï¼‰</strong>ï¼šå¯æ˜¯ lambda è¡¨è¾¾å¼ã€å‡½æ•°å¯¹è±¡ï¼Œè¦æ±‚èƒ½æ¥æ”¶ variant æ‰€æœ‰å¯èƒ½å­˜å‚¨çš„ç±»å‹ä½œä¸ºå‚æ•°ï¼›</li>
<li><strong>åŒ¹é…è§„åˆ™</strong>ï¼šstd::visit ä¼šåœ¨ç¼–è¯‘æœŸæ£€æŸ¥è®¿é—®å™¨æ˜¯å¦æ”¯æŒ variant çš„æ‰€æœ‰ç±»å‹ï¼Œè¿è¡Œæ—¶è‡ªåŠ¨æ ¹æ® variantå®é™…å­˜å‚¨ç±»å‹è°ƒç”¨å¯¹åº”é‡è½½çš„å‡½æ•°/åˆ†æ”¯ï¼›</li>
<li><strong>ä¼˜åŠ¿</strong>ï¼šç±»å‹å®‰å…¨ï¼ˆç¼–è¯‘æœŸæ ¡éªŒï¼‰ã€æ— åˆ†æ”¯å†—ä½™ï¼ˆ<strong>æ— éœ€æ‰‹åŠ¨åˆ¤æ–­ index()</strong> æˆ– holds_alternativeï¼‰ã€‚</li>
</ul>
<h2 id="2-ä½¿ç”¨ç¤ºä¾‹ï¼ˆæŒ‰åœºæ™¯åˆ†ç±»ï¼‰">2.ä½¿ç”¨ç¤ºä¾‹ï¼ˆæŒ‰åœºæ™¯åˆ†ç±»ï¼‰</h2>
<h3 id="åœºæ™¯1ï¼šå•-variant-å¤šç±»å‹åˆ†æ”¯ï¼ˆåŸºç¡€åœºæ™¯ï¼‰">åœºæ™¯1ï¼šå• variant å¤šç±»å‹åˆ†æ”¯ï¼ˆåŸºç¡€åœºæ™¯ï¼‰</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;variant&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::variant&lt;<span class="type">int</span>, std::string, <span class="type">double</span>&gt; var;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. å®šä¹‰è®¿é—®å™¨ï¼ˆlambda è¡¨è¾¾å¼ï¼Œç”¨ constexpr if å®ç°åˆ†æ”¯ï¼‰</span></span><br><span class="line">    <span class="keyword">auto</span> type_visitor = [](<span class="keyword">auto</span>&amp;&amp; val) &#123;</span><br><span class="line">        <span class="comment">// ç”¨ decay_t è·å–valçš„åŸå§‹ç±»å‹ï¼ˆæ’é™¤å¼•ç”¨ã€å³å€¼å¼•ç”¨ï¼‰</span></span><br><span class="line">        <span class="keyword">using</span> T = std::<span class="type">decay_t</span>&lt;<span class="keyword">decltype</span>(val)&gt;;</span><br><span class="line">        <span class="function"><span class="keyword">if</span> <span class="title">constexpr</span> <span class="params">(std::is_same_v&lt;T, <span class="type">int</span>&gt;)</span> </span>&#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;å½“å‰ç±»å‹ï¼šintï¼Œå€¼ï¼š&quot;</span> &lt;&lt; val &lt;&lt; <span class="string">&quot;ï¼Œæ‰§è¡Œintä¸“å±é€»è¾‘ï¼ˆåŠ 10ï¼‰ï¼š&quot;</span> &lt;&lt; val + <span class="number">10</span> &lt;&lt; std::endl;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="built_in">constexpr</span> (std::is_same_v&lt;T, std::string&gt;) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;å½“å‰ç±»å‹ï¼šstringï¼Œå€¼ï¼š&quot;</span> &lt;&lt; val &lt;&lt; <span class="string">&quot;ï¼Œæ‰§è¡Œstringä¸“å±é€»è¾‘ï¼ˆæ‹¼æ¥åç¼€ï¼‰ï¼š&quot;</span> &lt;&lt; val + <span class="string">&quot;_suffix&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="built_in">constexpr</span> (std::is_same_v&lt;T, <span class="type">double</span>&gt;) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;å½“å‰ç±»å‹ï¼šdoubleï¼Œå€¼ï¼š&quot;</span> &lt;&lt; val &lt;&lt; <span class="string">&quot;ï¼Œæ‰§è¡Œdoubleä¸“å±é€»è¾‘ï¼ˆä¹˜2ï¼‰ï¼š&quot;</span> &lt;&lt; val * <span class="number">2</span> &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. åˆ‡æ¢ variant å­˜å‚¨ç±»å‹ï¼Œæµ‹è¯•è®¿é—®å™¨</span></span><br><span class="line">    var = <span class="number">100</span>;          <span class="comment">// å­˜å‚¨ int</span></span><br><span class="line">    std::<span class="built_in">visit</span>(type_visitor, var); <span class="comment">// è¾“å‡ºï¼šå½“å‰ç±»å‹ï¼šintï¼Œå€¼ï¼š100ï¼Œæ‰§è¡Œintä¸“å±é€»è¾‘ï¼ˆåŠ 10ï¼‰ï¼š110</span></span><br><span class="line"></span><br><span class="line">    var = <span class="string">&quot;hello variant&quot;</span>; <span class="comment">// å­˜å‚¨ string</span></span><br><span class="line">    std::<span class="built_in">visit</span>(type_visitor, var); <span class="comment">// è¾“å‡ºï¼šå½“å‰ç±»å‹ï¼šstringï¼Œå€¼ï¼šhello variantï¼Œæ‰§è¡Œstringä¸“å±é€»è¾‘ï¼ˆæ‹¼æ¥åç¼€ï¼‰ï¼šhello variant_suffix</span></span><br><span class="line"></span><br><span class="line">    var = <span class="number">3.14</span>;         <span class="comment">// å­˜å‚¨ double</span></span><br><span class="line">    std::<span class="built_in">visit</span>(type_visitor, var); <span class="comment">// è¾“å‡ºï¼šå½“å‰ç±»å‹ï¼šdoubleï¼Œå€¼ï¼š3.14ï¼Œæ‰§è¡Œdoubleä¸“å±é€»è¾‘ï¼ˆä¹˜2ï¼‰ï¼š6.28</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ç”¨ <strong>constexpr if</strong>å®ç°ç¼–è¯‘æœŸåˆ†æ”¯åˆ¤æ–­ï¼Œé¿å…è¿è¡Œæ—¶å¼€é”€ï¼›</li>
<li>ç”¨ <strong>std::decay_t</strong> å¤„ç† val çš„å¼•ç”¨å±æ€§ï¼Œç¡®ä¿ç±»å‹åŒ¹é…å‡†ç¡®ï¼›</li>
<li>è‹¥è®¿é—®å™¨é—æ¼ variant æ”¯æŒçš„æŸç±»ç±»å‹ï¼Œç¼–è¯‘æœŸä¼šç›´æ¥æŠ¥é”™ï¼ˆç±»å‹å®‰å…¨ä¿éšœï¼‰ã€‚</li>
</ul>
<h3 id="åœºæ™¯2ï¼šå¤š-variant-ç»„åˆåˆ†æ”¯ï¼ˆè¿›é˜¶åœºæ™¯ï¼‰">åœºæ™¯2ï¼šå¤š variant ç»„åˆåˆ†æ”¯ï¼ˆè¿›é˜¶åœºæ™¯ï¼‰</h3>
<p><strong>é€‚ç”¨äºéœ€è¦åŒæ—¶å¤„ç†å¤šä¸ª variant çš„åœºæ™¯ï¼Œstd::visit ä¼šåŒ¹é…æ‰€æœ‰ variant çš„ç±»å‹ç»„åˆï¼Œæ‰§è¡Œå¯¹åº”é€»è¾‘ã€‚</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;variant&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸¤ä¸ª variantï¼ˆå¯å­˜å‚¨ä¸åŒç±»å‹åˆ—è¡¨ï¼‰</span></span><br><span class="line">    std::variant&lt;<span class="type">int</span>, std::string&gt; var1;</span><br><span class="line">    std::variant&lt;<span class="type">double</span>, std::string&gt; var2;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰è®¿é—®å™¨ï¼ˆå¤„ç† var1 å’Œ var2 çš„æ‰€æœ‰ç±»å‹ç»„åˆï¼‰</span></span><br><span class="line">    <span class="keyword">auto</span> combo_visitor = [](<span class="keyword">auto</span>&amp;&amp; v1, <span class="keyword">auto</span>&amp;&amp; v2) &#123;</span><br><span class="line">        <span class="keyword">using</span> T1 = std::<span class="type">decay_t</span>&lt;<span class="keyword">decltype</span>(v1)&gt;;</span><br><span class="line">        <span class="keyword">using</span> T2 = std::<span class="type">decay_t</span>&lt;<span class="keyword">decltype</span>(v2)&gt;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç»„åˆåˆ†æ”¯1ï¼švar1=intï¼Œvar2=double</span></span><br><span class="line">        <span class="function"><span class="keyword">if</span> <span class="title">constexpr</span> <span class="params">(std::is_same_v&lt;T1, <span class="type">int</span>&gt; &amp;&amp; std::is_same_v&lt;T2, <span class="type">double</span>&gt;)</span> </span>&#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;ç»„åˆç±»å‹ï¼šint + doubleï¼Œæ‰§è¡Œæ±‚å’Œï¼š&quot;</span> &lt;&lt; v1 + v2 &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç»„åˆåˆ†æ”¯2ï¼švar1=intï¼Œvar2=string</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> <span class="built_in">constexpr</span> (std::is_same_v&lt;T1, <span class="type">int</span>&gt; &amp;&amp; std::is_same_v&lt;T2, std::string&gt;) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;ç»„åˆç±»å‹ï¼šint + stringï¼Œæ‰§è¡Œæ‹¼æ¥ï¼š&quot;</span> &lt;&lt; std::<span class="built_in">to_string</span>(v1) + <span class="string">&quot;_&quot;</span> + v2 &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç»„åˆåˆ†æ”¯3ï¼švar1=stringï¼Œvar2=double</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> <span class="built_in">constexpr</span> (std::is_same_v&lt;T1, std::string&gt; &amp;&amp; std::is_same_v&lt;T2, <span class="type">double</span>&gt;) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;ç»„åˆç±»å‹ï¼šstring + doubleï¼Œæ‰§è¡Œæ‹¼æ¥ï¼š&quot;</span> &lt;&lt; v1 + <span class="string">&quot;_&quot;</span> + std::<span class="built_in">to_string</span>(v2) &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç»„åˆåˆ†æ”¯4ï¼švar1=stringï¼Œvar2=string</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> <span class="built_in">constexpr</span> (std::is_same_v&lt;T1, std::string&gt; &amp;&amp; std::is_same_v&lt;T2, std::string&gt;) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;ç»„åˆç±»å‹ï¼šstring + stringï¼Œæ‰§è¡Œæ‹¼æ¥ï¼š&quot;</span> &lt;&lt; v1 + v2 &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æµ‹è¯•ä¸åŒç±»å‹ç»„åˆ</span></span><br><span class="line">    var1 = <span class="number">10</span>; var2 = <span class="number">3.14</span>;</span><br><span class="line">    std::<span class="built_in">visit</span>(combo_visitor, var1, var2); <span class="comment">// è¾“å‡ºï¼šç»„åˆç±»å‹ï¼šint + doubleï¼Œæ‰§è¡Œæ±‚å’Œï¼š13.14</span></span><br><span class="line"></span><br><span class="line">    var1 = <span class="number">20</span>; var2 = <span class="string">&quot;test&quot;</span>;</span><br><span class="line">    std::<span class="built_in">visit</span>(combo_visitor, var1, var2); <span class="comment">// è¾“å‡ºï¼šç»„åˆç±»å‹ï¼šint + stringï¼Œæ‰§è¡Œæ‹¼æ¥ï¼š20_test</span></span><br><span class="line"></span><br><span class="line">    var1 = <span class="string">&quot;hello&quot;</span>; var2 = <span class="number">6.28</span>;</span><br><span class="line">    std::<span class="built_in">visit</span>(combo_visitor, var1, var2); <span class="comment">// è¾“å‡ºï¼šç»„åˆç±»å‹ï¼šstring + doubleï¼Œæ‰§è¡Œæ‹¼æ¥ï¼šhello_6.28xxxxï¼ˆç²¾åº¦å–å†³äºå®ç°ï¼‰</span></span><br><span class="line"></span><br><span class="line">    var1 = <span class="string">&quot;hello&quot;</span>; var2 = <span class="string">&quot;world&quot;</span>;</span><br><span class="line">    std::<span class="built_in">visit</span>(combo_visitor, var1, var2); <span class="comment">// è¾“å‡ºï¼šç»„åˆç±»å‹ï¼šstring + stringï¼Œæ‰§è¡Œæ‹¼æ¥ï¼šhelloworld</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>std::visit æ”¯æŒä¼ å…¥å¤šä¸ª variant å‚æ•°ï¼ˆé€—å·åˆ†éš”ï¼‰ï¼Œè®¿é—®å™¨éœ€æ¥æ”¶å¯¹åº”æ•°é‡çš„å‚æ•°ï¼›</li>
<li>éœ€è¦†ç›–æ‰€æœ‰å¯èƒ½çš„ç±»å‹ç»„åˆï¼Œå¦åˆ™ç¼–è¯‘æŠ¥é”™ï¼›<strong>è‹¥éƒ¨åˆ†ç»„åˆæ— éœ€å¤„ç†ï¼Œå¯æ·»åŠ é»˜è®¤åˆ†æ”¯ï¼ˆelseï¼‰</strong>ã€‚</li>
</ul>
<h2 id="3-std-visit-å…³é”®æ³¨æ„äº‹é¡¹">3.std::visit å…³é”®æ³¨æ„äº‹é¡¹</h2>
<p><strong>1.ç±»å‹å®‰å…¨æ ¡éªŒ</strong>:è®¿é—®å™¨å¿…é¡»æ”¯æŒ variant æ‰€æœ‰æ¨¡æ¿ç±»å‹ï¼Œå¦åˆ™ç¼–è¯‘å¤±è´¥ï¼ˆé¿å…é—æ¼ç±»å‹å¤„ç†ï¼‰ï¼›<br>
<strong>2.é¿å…çª„åŒ–è½¬æ¢</strong>:è‹¥ variant å­˜å‚¨çš„ç±»å‹å¯éšå¼è½¬æ¢ï¼ˆå¦‚ int å’Œ longï¼‰ï¼Œéœ€æ˜ç¡®åŒºåˆ†ï¼Œé¿å…åˆ†æ”¯åŒ¹é…æ­§ä¹‰ï¼›<br>
<strong>3.å³å€¼å¼•ç”¨å¤„ç†</strong>:è‹¥éœ€ä¿®æ”¹ variant ä¸­çš„å€¼ï¼Œè®¿é—®å™¨å‚æ•°å¯å£°æ˜ä¸ºé const å¼•ç”¨ï¼ˆå¦‚ auto&amp; valï¼‰ï¼›è‹¥éœ€è½¬ç§»æ‰€æœ‰æƒï¼Œå¯å£°æ˜ä¸ºå³å€¼å¼•ç”¨ï¼ˆauto&amp;&amp; valï¼‰ï¼›<br>
<strong>4.è¿”å›å€¼æ”¯æŒ</strong>:è®¿é—®å™¨å¯è¿”å›å€¼ï¼Œæ‰€æœ‰åˆ†æ”¯çš„è¿”å›å€¼ç±»å‹éœ€ä¸€è‡´ï¼ˆæˆ–å¯éšå¼è½¬æ¢ä¸ºåŒä¸€ç±»å‹ï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¿é—®å™¨è¿”å›å€¼ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">auto</span> return_visitor = [](<span class="keyword">auto</span>&amp;&amp; val) -&gt; <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">using</span> T = std::<span class="type">decay_t</span>&lt;<span class="keyword">decltype</span>(val)&gt;;</span><br><span class="line">    <span class="function"><span class="keyword">if</span> <span class="title">constexpr</span> <span class="params">(std::is_same_v&lt;T, <span class="type">int</span>&gt;)</span> <span class="keyword">return</span> val</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> <span class="built_in">constexpr</span> (std::is_same_v&lt;T, std::string&gt;) <span class="keyword">return</span> val.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> <span class="built_in">constexpr</span> (std::is_same_v&lt;T, <span class="type">double</span>&gt;) <span class="keyword">return</span> <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(val);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">std::variant&lt;<span class="type">int</span>, std::string, <span class="type">double</span>&gt; var = <span class="string">&quot;return test&quot;</span>;</span><br><span class="line"><span class="type">int</span> result = std::<span class="built_in">visit</span>(return_visitor, var);</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;è®¿é—®å™¨è¿”å›å€¼ï¼š&quot;</span> &lt;&lt; result &lt;&lt; std::endl; <span class="comment">// è¾“å‡ºï¼š10ï¼ˆå­—ç¬¦ä¸²é•¿åº¦ï¼‰</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>C++</category>
        <category>ã€ŠC++17å®Œå…¨æŒ‡å—ã€‹</category>
        <category>ä¸‰ã€æ–°çš„æ ‡å‡†åº“ç»„ä»¶</category>
        <category>16.std::variant&lt;&gt;</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>redis-plus-plusä½¿ç”¨æ•™ç¨‹</title>
    <url>/2026/01/12/C++/C++%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E5%B8%B8%E7%94%A8%E5%BA%93/redis-plus-plus%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<p><a href="#use">é™„å½•1ï¼šRedis++ æ ¸å¿ƒåœºæ™¯</a><br>
<a href="#mechanism">é™„å½•2ï¼šRedis++ é‡è¦æœºåˆ¶</a><br>
<a href="#install">é™„å½•3ï¼šRedis++ å®‰è£…æ•™ç¨‹</a></p>
<h1>ä¸€ã€Redis++æ¦‚è¿°</h1>
<h2 id="1-Redis-é€‚é…æ¨¡å¼ä»‹ç»">1.Redis++ é€‚é…æ¨¡å¼ä»‹ç»</h2>
<p>Redis++ æ”¯æŒå¤šç§éƒ¨ç½²æ¨¡å¼çš„é€‚é…ï¼Œä¸åŒæ¨¡å¼å¯¹åº”ä¸åŒçš„ç”Ÿäº§åœºæ™¯éœ€æ±‚ï¼Œæ ¸å¿ƒæ¨¡å¼å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>å•æœºæ¨¡å¼</strong>ï¼š
<ul>
<li>é€‚é…å°å‹åº”ç”¨ã€å¼€å‘/æµ‹è¯•ç¯å¢ƒï¼Œç›´æ¥è¿æ¥å•ä¸ªRedisèŠ‚ç‚¹ï¼Œéƒ¨ç½²ç®€å•ä½†æ— é«˜å¯ç”¨ä¿éšœã€‚</li>
<li>ç”Ÿäº§ç¯å¢ƒä»…æ¨èç”¨äº<strong>éæ ¸å¿ƒä¸šåŠ¡</strong>ï¼Œéœ€é…åˆæ•°æ®å¤‡ä»½ç­–ç•¥ä½¿ç”¨ã€‚â€‹</li>
</ul>
</li>
<li><strong>ä¸»ä»æ¨¡å¼</strong>ï¼š
<ul>
<li>é€‚é…<strong>è¯»å¤šå†™å°‘</strong>çš„ç”Ÿäº§åœºæ™¯</li>
<li>åŒ…å«ä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼ˆå†™å…¥ï¼‰å’Œå¤šä¸ªä»èŠ‚ç‚¹ï¼ˆè¯»å–ï¼‰</li>
<li>Redis++å¯é€šè¿‡é…ç½®æŒ‡å®šè¯»è¯·æ±‚è·¯ç”±åˆ°ä»èŠ‚ç‚¹ï¼Œæå‡è¯»ååé‡ï¼Œä¸»ä»æ•…éšœåˆ‡æ¢éœ€ä¾èµ–å“¨å…µæˆ–æ‰‹åŠ¨æ“ä½œã€‚â€‹</li>
</ul>
</li>
<li><strong>å“¨å…µæ¨¡å¼</strong>ï¼š
<ul>
<li>åœ¨<strong>ä¸»ä»æ¨¡å¼åŸºç¡€ä¸Š</strong>å¢åŠ å“¨å…µèŠ‚ç‚¹ï¼Œè´Ÿè´£ç›‘æ§ä¸»ä»èŠ‚ç‚¹å¥åº·çŠ¶æ€</li>
<li>å½“ä¸»èŠ‚ç‚¹æ•…éšœæ—¶è‡ªåŠ¨å®Œæˆæ•…éšœåˆ‡æ¢ï¼Œä¿éšœé«˜å¯ç”¨æ€§</li>
<li>Redis++é€šè¿‡è¿æ¥å“¨å…µèŠ‚ç‚¹è·å–ä¸»ä»ä¿¡æ¯ï¼Œæ— éœ€æ‰‹åŠ¨ç»´æŠ¤èŠ‚ç‚¹åœ°å€ã€‚â€‹</li>
</ul>
</li>
<li><strong>é›†ç¾¤æ¨¡å¼ï¼ˆClusterï¼‰</strong>ï¼š
<ul>
<li>é€‚é…<strong>æµ·é‡æ•°æ®ã€é«˜å¹¶å‘</strong>çš„æ ¸å¿ƒç”Ÿäº§åœºæ™¯ï¼Œå°†æ•°æ®åˆ†ç‰‡å­˜å‚¨åœ¨å¤šä¸ªä¸»èŠ‚ç‚¹ï¼Œæ¯ä¸ªä¸»èŠ‚ç‚¹å¯¹åº”å¤šä¸ªä»èŠ‚ç‚¹ã€‚</li>
<li>Redis++æä¾›RedisClusterå®¢æˆ·ç«¯ï¼Œè‡ªåŠ¨é€‚é…æ•°æ®åˆ†ç‰‡ã€èŠ‚ç‚¹å‘ç°å’Œæ•…éšœåˆ‡æ¢ï¼ŒAPIä¸å•æœºæ¨¡å¼å…¼å®¹ï¼Œç”Ÿäº§å¯æ— ç¼åˆ‡æ¢ã€‚</li>
</ul>
</li>
</ul>
<p><strong>æ³¨æ„ï¼ï¼</strong>ï¼š</p>
<ul>
<li>ä¸»ä»å¤åˆ¶ã€å“¨å…µæ¨¡å¼ã€é›†ç¾¤æ¨¡å¼éƒ½æ˜¯<strong>ç”±â€œRedisæœåŠ¡ç«¯â€æ‰‹åŠ¨é…ç½®</strong></li>
<li>Redis++æ˜¯Rediså®¢æˆ·ç«¯åº“
<ul>
<li><strong>ä¸è´Ÿè´£é…ç½®</strong>â€œä¸»ä»å¤åˆ¶â€ã€â€œå“¨å…µæ¨¡å¼â€ã€â€œé›†ç¾¤æ¨¡å¼â€</li>
<li>åªè´Ÿè´£<strong>è¿æ¥åˆ°RedisæœåŠ¡å™¨</strong></li>
</ul>
</li>
<li><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260113171238862.png" alt=""></li>
</ul>
<h2 id="2-Redis-æ ¸å¿ƒé…ç½®ä»‹ç»">2.Redis++æ ¸å¿ƒé…ç½®ä»‹ç»</h2>
<p>Redis++çš„é…ç½®æ ¸å¿ƒå›´ç»•<strong>è¿æ¥å‚æ•°</strong>å’Œ<strong>æ± åŒ–å‚æ•°</strong>ï¼Œä¸åŒæ¨¡å¼çš„é…ç½®ç•¥æœ‰å·®å¼‚</p>
<h3 id="ï¼ˆ1ï¼‰åŸºç¡€è¿æ¥é…ç½®">ï¼ˆ1ï¼‰åŸºç¡€è¿æ¥é…ç½®</h3>
<ul>
<li>
<p><strong>host/port</strong>ï¼š</p>
<ul>
<li>RedisèŠ‚ç‚¹çš„<strong>ipåœ°å€ å’Œ ç«¯å£port</strong>
<ul>
<li>å•æœºæ¨¡å¼ï¼šå¡«å†™å•ä¸ªèŠ‚ç‚¹ä¿¡æ¯</li>
<li>é›†ç¾¤/å“¨å…µæ¨¡å¼ï¼šå¡«å†™ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆå®¢æˆ·ç«¯è‡ªåŠ¨å‘ç°å…¶ä»–èŠ‚ç‚¹ï¼‰</li>
</ul>
</li>
<li>ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨å†…ç½‘IPæˆ–åŸŸåï¼Œé¿å…å…¬ç½‘ä¼ è¾“é£é™©ã€‚</li>
</ul>
</li>
<li>
<p><strong>password</strong>ï¼š</p>
<ul>
<li><strong>Redisè®¿é—®å¯†ç </strong>ï¼Œé˜²æœªæˆæƒè®¿é—®</li>
<li><strong>ç”Ÿäº§ç¯å¢ƒå¿…é¡»å¼ºåˆ¶è®¾ç½®</strong>ï¼š
<ul>
<li>é•¿åº¦å»ºè®®ä¸å°äº8ä½</li>
<li>åŒ…å«å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>db</strong>ï¼š</p>
<ul>
<li><strong>Redisé€»è¾‘æ•°æ®åº“ç¼–å·</strong>ï¼ˆ0-15é»˜è®¤ï¼‰</li>
<li>ç”Ÿäº§ç¯å¢ƒå»ºè®®æŒ‰ä¸šåŠ¡æ¨¡å—éš”ç¦»æ•°æ®åº“
<ul>
<li>ä¾‹å¦‚ç”¨æˆ·æ¨¡å—ç”¨db1ã€è®¢å•æ¨¡å—ç”¨db2ï¼Œé¿å…é”®åå†²çªå’Œæ•°æ®æ··ä¹±ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>socket_timeout</strong>ï¼š</p>
<ul>
<li><strong>å¥—æ¥å­—è¯»å†™è¶…æ—¶æ—¶é—´</strong></li>
<li>ç”Ÿäº§ç¯å¢ƒå»ºè®®è®¾ç½®500ms-1sï¼Œé¿å…å› ç½‘ç»œé˜»å¡å¯¼è‡´åº”ç”¨çº¿ç¨‹æŒ‚èµ·ã€‚</li>
</ul>
</li>
<li>
<p><strong>connect_timeout</strong>ï¼š</p>
<ul>
<li><strong>è¿æ¥å»ºç«‹è¶…æ—¶æ—¶é—´</strong></li>
<li>ç”Ÿäº§ç¯å¢ƒå»ºè®®è®¾ç½®1s-2sï¼Œé˜²æ­¢å› RedisèŠ‚ç‚¹æ•…éšœå¯¼è‡´è¿æ¥ç­‰å¾…è¿‡ä¹…ã€‚</li>
</ul>
</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰è¿æ¥æ± é…ç½®">ï¼ˆ2ï¼‰è¿æ¥æ± é…ç½®</h3>
<ul>
<li>
<p><strong>size</strong>ï¼š</p>
<ul>
<li><strong>è¿æ¥æ± å¤§å°</strong></li>
<li>éœ€æ ¹æ®ä¸šåŠ¡QPSè°ƒæ•´ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®20-50ä¸ªè¿æ¥ï¼ˆé«˜QPSåœºæ™¯å¯å¢è‡³100ï¼‰
<ul>
<li>è¿æ¥è¿‡å¤šï¼šå¯¼è‡´Redisèµ„æºè€—å°½</li>
<li>è¿æ¥è¿‡å°‘ï¼šå¯¼è‡´è¯·æ±‚æ’é˜Ÿã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>wait_timeout</strong>ï¼š</p>
<ul>
<li><strong>è·å–è¿æ¥çš„ç­‰å¾…è¶…æ—¶æ—¶é—´</strong></li>
<li>ç”Ÿäº§ç¯å¢ƒå»ºè®®è®¾ç½®200-500msï¼Œè¶…æ—¶åæŠ›å‡ºå¼‚å¸¸ï¼Œé¿å…åº”ç”¨çº¿ç¨‹æ— é™ç­‰å¾…è¿æ¥ã€‚</li>
</ul>
</li>
<li>
<p><strong>connection_lifetime</strong>ï¼š</p>
<ul>
<li><strong>è¿æ¥æœ€å¤§ç”Ÿå­˜æ—¶é—´</strong></li>
<li>ç”Ÿäº§ç¯å¢ƒå»ºè®®è®¾ç½®5-10åˆ†é’Ÿï¼Œè‡ªåŠ¨å…³é—­é•¿æ—¶é—´ç©ºé—²çš„è¿æ¥ï¼Œé¿å…æ— æ•ˆè¿æ¥å ç”¨èµ„æºã€‚</li>
</ul>
</li>
</ul>
<h2 id="3-æ ¸å¿ƒä¾èµ–ä¸ç¼–è¯‘è§„èŒƒ">3.æ ¸å¿ƒä¾èµ–ä¸ç¼–è¯‘è§„èŒƒ</h2>
<h3 id="ï¼ˆ1ï¼‰æ ¸å¿ƒä¾èµ–ä¸ç¼–è¯‘è§„èŒƒ">ï¼ˆ1ï¼‰æ ¸å¿ƒä¾èµ–ä¸ç¼–è¯‘è§„èŒƒ</h3>
<ul>
<li><strong>ç¼–è¯‘é€‰é¡¹</strong>ï¼š
<ul>
<li>å¿…é¡»æŒ‡å®š -std=c++17</li>
<li>é“¾æ¥ -lredis++ -lhiredis -pthreadï¼ˆçº¿ç¨‹åº“ï¼‰ï¼›</li>
</ul>
</li>
<li><strong>ç¼–è¯‘ä¼˜åŒ–</strong>ï¼š
<ul>
<li>æ·»åŠ  -O2 æå‡æ€§èƒ½</li>
<li>-Wall -Werror ä¸¥æ ¼æ£€æŸ¥ä»£ç ï¼›</li>
</ul>
</li>
<li><strong>å¤´æ–‡ä»¶</strong>ï¼š
<ul>
<li>#include &lt;sw/redis++/redis++.h&gt;ï¼ˆæ ¸å¿ƒï¼‰</li>
<li>#include &lt;sw/redis++/cluster.h&gt;ï¼ˆé›†ç¾¤ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰CMake-é¡¹ç›®é›†æˆ">ï¼ˆ2ï¼‰CMake é¡¹ç›®é›†æˆ</h3>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.10</span>)</span><br><span class="line"><span class="keyword">project</span>(MyRedisProject)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ============ 1. è®¾ç½® C++ æ ‡å‡†ï¼ˆå¿…é¡»ä¸ redis++ ç¼–è¯‘æ—¶ä¸€è‡´ï¼‰ ============</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">17</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD_REQUIRED <span class="keyword">ON</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ============ 2. æŸ¥æ‰¾ hiredis åº“ ============</span></span><br><span class="line"><span class="keyword">find_path</span>(HIREDIS_HEADER hiredis)</span><br><span class="line"><span class="keyword">find_library</span>(HIREDIS_LIB hiredis)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ============ 3. æŸ¥æ‰¾ redis++ åº“ ============</span></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šè¿™é‡Œæ˜¯ swï¼Œä¸æ˜¯ redis++</span></span><br><span class="line"><span class="keyword">find_path</span>(REDIS_PLUS_PLUS_HEADER sw)</span><br><span class="line"><span class="keyword">find_library</span>(REDIS_PLUS_PLUS_LIB redis++)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ============ 4. åˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶ ============</span></span><br><span class="line"><span class="keyword">add_executable</span>(myapp main.cpp)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ============ 5. æ·»åŠ å¤´æ–‡ä»¶è·¯å¾„ ============</span></span><br><span class="line"><span class="keyword">target_include_directories</span>(myapp PRIVATE </span><br><span class="line">    <span class="variable">$&#123;HIREDIS_HEADER&#125;</span></span><br><span class="line">    <span class="variable">$&#123;REDIS_PLUS_PLUS_HEADER&#125;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ============ 6. é“¾æ¥åº“ ============</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(myapp PRIVATE</span><br><span class="line">    <span class="variable">$&#123;REDIS_PLUS_PLUS_LIB&#125;</span></span><br><span class="line">    <span class="variable">$&#123;HIREDIS_LIB&#125;</span></span><br><span class="line">    pthread  <span class="comment"># å¿…é¡»é“¾æ¥çº¿ç¨‹åº“</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰è¿æ¥é…ç½®ç¤ºä¾‹">ï¼ˆ3ï¼‰è¿æ¥é…ç½®ç¤ºä¾‹</h3>
<ul>
<li>ç”Ÿäº§ç¯å¢ƒ<strong>ç¦æ­¢ä½¿ç”¨å•è¿æ¥</strong>ï¼Œå¿…é¡»ç”¨<strong>è¿æ¥æ± </strong></li>
<li>åŒæ—¶æ·»åŠ è¶…æ—¶ã€å¯†ç ç­‰ç”Ÿäº§å¿…å¤‡é…ç½®</li>
<li><strong>æ³¨</strong>ï¼š
<ul>
<li>å¦‚æœä¸šåŠ¡éœ€è¦ï¼Œå¯åœ¨ä¸šåŠ¡å±‚æ·»åŠ â€œ<strong>æ‰‹åŠ¨é‡è¯•å°è£…</strong>â€</li>
</ul>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sw/redis++/redis++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdexcept&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> sw::redis;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span></span><br><span class="line"><span class="comment">// Redis è¿æ¥åˆ›å»ºå‡½æ•°ï¼ˆå¸¦è¿æ¥æ± ï¼‰</span></span><br><span class="line"><span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span></span><br><span class="line"><span class="function">Redis <span class="title">create_prod_redis_conn</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1. åŸºç¡€è¿æ¥é…ç½®</span></span><br><span class="line">    ConnectionOptions opts;</span><br><span class="line">    opts.host = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">    opts.port = <span class="number">6379</span>;</span><br><span class="line">    opts.password = <span class="string">&quot;your_redis_pwd&quot;</span>;  <span class="comment">// æ— å¯†ç åˆ™æ³¨é‡Šæ‰</span></span><br><span class="line">    opts.db = <span class="number">0</span>;</span><br><span class="line">    opts.socket_timeout = chrono::<span class="built_in">milliseconds</span>(<span class="number">500</span>);</span><br><span class="line">    opts.connect_timeout = chrono::<span class="built_in">milliseconds</span>(<span class="number">1000</span>);</span><br><span class="line">    <span class="comment">// æ³¨æ„ï¼šredis++ é»˜è®¤ä¼šè‡ªåŠ¨é‡è¿ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®é‡è¿å‚æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. è¿æ¥æ± é…ç½®</span></span><br><span class="line">    ConnectionPoolOptions pool_opts;</span><br><span class="line">    pool_opts.size = <span class="number">20</span>;</span><br><span class="line">    pool_opts.wait_timeout = chrono::<span class="built_in">milliseconds</span>(<span class="number">200</span>);</span><br><span class="line">    pool_opts.connection_lifetime = chrono::<span class="built_in">minutes</span>(<span class="number">5</span>); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Redis</span>(opts, pool_opts);</span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> Error&amp; e) &#123;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;Redis è¿æ¥å¤±è´¥ï¼š&quot;</span> &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">throw</span> <span class="built_in">runtime_error</span>(<span class="string">&quot;Redis åˆå§‹åŒ–å¤±è´¥&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span></span><br><span class="line"><span class="comment">// å¸¦é‡è¯•çš„æ‰§è¡Œå°è£…ï¼ˆè§£å†³é‡è¿é—®é¢˜ï¼‰</span></span><br><span class="line"><span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Func&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">redis_exec_with_retry</span><span class="params">(Redis&amp; redis, Func&amp;&amp; func, <span class="type">int</span> max_retry = <span class="number">3</span>)</span> </span></span><br><span class="line"><span class="function">    -&gt; <span class="title">decltype</span><span class="params">(func(redis))</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; max_retry; ++i) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">func</span>(redis);</span><br><span class="line">        &#125; <span class="built_in">catch</span> (<span class="type">const</span> TimeoutError&amp; e) &#123;</span><br><span class="line">            cerr &lt;&lt; <span class="string">&quot;Redis è¶…æ—¶ï¼Œé‡è¯• &quot;</span> &lt;&lt; (i + <span class="number">1</span>) &lt;&lt; <span class="string">&quot;/&quot;</span> &lt;&lt; max_retry &lt;&lt; endl;</span><br><span class="line">            <span class="keyword">if</span> (i == max_retry - <span class="number">1</span>) <span class="keyword">throw</span>;</span><br><span class="line">        &#125; <span class="built_in">catch</span> (<span class="type">const</span> IoError&amp; e) &#123;</span><br><span class="line">            cerr &lt;&lt; <span class="string">&quot;Redis IO é”™è¯¯ï¼Œé‡è¯• &quot;</span> &lt;&lt; (i + <span class="number">1</span>) &lt;&lt; <span class="string">&quot;/&quot;</span> &lt;&lt; max_retry &lt;&lt; endl;</span><br><span class="line">            <span class="keyword">if</span> (i == max_retry - <span class="number">1</span>) <span class="keyword">throw</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        this_thread::<span class="built_in">sleep_for</span>(chrono::<span class="built_in">milliseconds</span>(<span class="number">100</span> * (i + <span class="number">1</span>)));  <span class="comment">// é€€é¿</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="built_in">runtime_error</span>(<span class="string">&quot;Redis é‡è¯•è€—å°½&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span></span><br><span class="line"><span class="comment">// ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">example_usage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> redis = <span class="built_in">create_prod_redis_conn</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ™®é€šè°ƒç”¨</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        redis.<span class="built_in">set</span>(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> Error&amp; e) &#123;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;æ“ä½œå¤±è´¥: &quot;</span> &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¸¦é‡è¯•çš„è°ƒç”¨</span></span><br><span class="line">    <span class="keyword">auto</span> result = <span class="built_in">redis_exec_with_retry</span>(redis, [](Redis&amp; r) &#123;</span><br><span class="line">        <span class="keyword">return</span> r.<span class="built_in">get</span>(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1>äºŒã€å®˜æ–¹æ–‡æ¡£æç¤ºäº‹é¡¹</h1>
<p><strong>å»ºè®®å…ˆé˜…è¯»ä¹‹åçš„å°èŠ‚ï¼Œè¿™é‡Œæ”¾åœ¨å‰é¢æ˜¯ä¸ºäº†â€œå¼ºè°ƒå®ƒçš„é‡è¦æ€§â€</strong></p>
<h2 id="1-Connectionè¿æ¥">1.Connectionè¿æ¥</h2>
<h3 id="ï¼ˆ1ï¼‰å°½å¯èƒ½å¤ç”¨-Redis-å¯¹è±¡">ï¼ˆ1ï¼‰å°½å¯èƒ½å¤ç”¨ Redis å¯¹è±¡</h3>
<ul>
<li><strong>ä½ åº”è¯¥å°½å¯èƒ½å¤ç”¨ Redis å¯¹è±¡</strong>
<ul>
<li>å› ä¸º<strong>åˆ›å»º Redis å¯¹è±¡çš„å¼€é”€å¹¶ä¸å°</strong>ï¼Œå› ä¸ºå®ƒä¼šåˆ›å»ºåˆ° Redis æœåŠ¡å™¨çš„æ–°è¿æ¥ã€‚</li>
<li><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114000730301.png" alt=""></li>
</ul>
</li>
<li><strong>Rediså¯¹è±¡æ˜¯å¤šçº¿ç¨‹å®‰å…¨çš„</strong>
<ul>
<li>ä½ å¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å…±äº«åŒä¸€ä¸ª Redis å¯¹è±¡ã€‚</li>
<li><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114000814117.png" alt=""></li>
</ul>
</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰è‡ªåŠ¨é‡è¿æœºåˆ¶">ï¼ˆ2ï¼‰è‡ªåŠ¨é‡è¿æœºåˆ¶</h3>
<ul>
<li>Redis ç±»ç»´æŠ¤ä¸€ä¸ªè¿æ¥åˆ° Redis æœåŠ¡å™¨çš„è¿æ¥æ± ã€‚
<ul>
<li>å¦‚æœè¿æ¥æ–­å¼€ï¼ŒRedis ä¼š<strong>è‡ªåŠ¨é‡æ–°è¿æ¥</strong>åˆ° Redis æœåŠ¡å™¨ã€‚</li>
</ul>
</li>
<li><strong>ä¸éœ€è¦æ‰‹åŠ¨æ£€æŸ¥ Redis å¯¹è±¡æ˜¯å¦æˆåŠŸè¿æ¥åˆ°æœåŠ¡å™¨</strong>
<ul>
<li>å¦‚æœ Redis æ— æ³•åˆ›å»ºåˆ° Redis æœåŠ¡å™¨çš„è¿æ¥ï¼Œæˆ–è€…è¿æ¥åœ¨æŸä¸ªæ—¶åˆ»æ–­å¼€ï¼Œå½“ä½ å°è¯•å‘é€å‘½ä»¤æ—¶ï¼Œå®ƒä¼š<strong>æŠ›å‡º Error ç±»å‹çš„å¼‚å¸¸</strong></li>
<li><strong>å³ä½¿ä½ æ”¶åˆ°å¼‚å¸¸ï¼ˆå³è¿æ¥æ–­å¼€ï¼‰ï¼Œä½ ä¹Ÿä¸éœ€è¦åˆ›å»ºæ–°çš„ Redis å¯¹è±¡ï¼ï¼</strong>
<ul>
<li>ä½ å¯ä»¥å¤ç”¨åŒä¸€ä¸ª Redis å¯¹è±¡ç»§ç»­å‘é€å‘½ä»¤ï¼ŒRedis å¯¹è±¡ä¼šè‡ªåŠ¨å°è¯•é‡è¿æœåŠ¡å™¨ã€‚</li>
<li>å¦‚æœé‡è¿æˆåŠŸï¼Œå®ƒä¼šå‘é€å‘½ä»¤åˆ°æœåŠ¡å™¨ï¼›</li>
<li>å¦åˆ™ï¼Œå®ƒä¼šå†æ¬¡æŠ›å‡ºå¼‚å¸¸ã€‚</li>
</ul>
</li>
<li><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114000348588.png" alt=""></li>
</ul>
</li>
</ul>
<h3 id="ï¼ˆ3ï¼‰â€œé˜»å¡å‘½ä»¤â€çš„ä½¿ç”¨">ï¼ˆ3ï¼‰â€œé˜»å¡å‘½ä»¤â€çš„ä½¿ç”¨</h3>
<ul>
<li>å½“ä½¿ç”¨<strong>é˜»å¡å‘½ä»¤</strong>æ—¶ï¼Œsocket_timeout <strong>å¿…é¡»å¤§äºé˜»å¡å‘½ä»¤çš„è¶…æ—¶æ—¶é—´</strong>ï¼Œå¦åˆ™ä¼šå¯¼è‡´è¯¯æŠ¥è¶…æ—¶å’Œæ•°æ®ä¸¢å¤±ã€‚
<ul>
<li><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260113234947400.png" alt=""></li>
</ul>
</li>
</ul>
<h3 id="ï¼ˆ4ï¼‰è¿æ¥æ± çš„æ‡’åŠ è½½æœºåˆ¶">ï¼ˆ4ï¼‰è¿æ¥æ± çš„æ‡’åŠ è½½æœºåˆ¶</h3>
<ul>
<li>è¿æ¥æ± ä¸­çš„è¿æ¥æ˜¯**æ‡’åŠ è½½ï¼ˆå»¶è¿Ÿåˆ›å»ºï¼‰**çš„
<ul>
<li>å½“è¿æ¥æ± åˆå§‹åŒ–æ—¶ï¼ˆå³ Redis æ„é€ å‡½æ•°æ‰§è¡Œæ—¶ï¼‰ï¼ŒRedis ä¸ä¼šç«‹å³è¿æ¥åˆ°æœåŠ¡å™¨</li>
<li>åªæœ‰åœ¨ä½ å°è¯•<strong>å‘é€å‘½ä»¤æ—¶æ‰ä¼šå»ºç«‹è¿æ¥</strong>
<ul>
<li>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥<strong>é¿å…ä¸å¿…è¦çš„è¿æ¥</strong></li>
</ul>
</li>
<li>å› æ­¤ï¼Œå¦‚æœè¿æ¥æ± å¤§å°è®¾ç½®ä¸º 5ï¼Œä½†å®é™…æœ€å¤§å¹¶å‘è¿æ¥æ•°åªæœ‰ 3ï¼Œé‚£ä¹ˆè¿æ¥æ± ä¸­å®é™…åªä¼šæœ‰ 3 ä¸ªè¿æ¥ã€‚</li>
</ul>
</li>
</ul>
<h3 id="ï¼ˆ5ï¼‰URI-å‚æ•°åŒºåˆ†å¤§å°å†™ï¼ˆè¦æ±‚å…¨å°å†™ï¼‰">ï¼ˆ5ï¼‰URI å‚æ•°åŒºåˆ†å¤§å°å†™ï¼ˆè¦æ±‚å…¨å°å†™ï¼‰</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âœ… æ­£ç¡®ï¼šå…¨å°å†™</span></span><br><span class="line"><span class="keyword">auto</span> redis = <span class="built_in">Redis</span>(<span class="string">&quot;tcp://127.0.0.1:6379?socket_timeout=100ms&amp;keep_alive=true&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ é”™è¯¯ï¼šå¤§å°å†™æ··ç”¨</span></span><br><span class="line"><span class="keyword">auto</span> redis = <span class="built_in">Redis</span>(<span class="string">&quot;tcp://127.0.0.1:6379?Socket_Timeout=100ms&quot;</span>);  <span class="comment">// æ— æ³•è¯†åˆ«</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ6ï¼‰Pipeline-Transaction-æ³¨æ„äº‹é¡¹">ï¼ˆ6ï¼‰Pipeline / Transaction æ³¨æ„äº‹é¡¹</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114084518210.png" alt=""></p>
<h3 id="ï¼ˆ7ï¼‰Subscriber-è®¢é˜…è€…æ³¨æ„äº‹é¡¹">ï¼ˆ7ï¼‰Subscriber è®¢é˜…è€…æ³¨æ„äº‹é¡¹</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114084903240.png" alt=""></p>
<h3 id="ï¼ˆ8ï¼‰Redis-Cluster-é›†ç¾¤æ³¨æ„äº‹é¡¹">ï¼ˆ8ï¼‰Redis Cluster é›†ç¾¤æ³¨æ„äº‹é¡¹</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114084633220.png" alt=""><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114084947303.png" alt=""></p>
<h3 id="ï¼ˆ9ï¼‰å¼‚æ­¥æ¥å£æ³¨æ„äº‹é¡¹">ï¼ˆ9ï¼‰å¼‚æ­¥æ¥å£æ³¨æ„äº‹é¡¹</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114084713792.png" alt=""></p>
<h3 id="ï¼ˆ10ï¼‰å¼‚å¸¸å¤„ç†">ï¼ˆ10ï¼‰å¼‚å¸¸å¤„ç†</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114084746832.png" alt=""><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114085208456.png" alt=""></p>
<h1>ä¸‰ã€é…ç½®ç»“æ„ä½“</h1>
<p><a id="ConnectionOptions"></a></p>
<h2 id="1-ConnectionOptionsç»“æ„ä½“">1.ConnectionOptionsç»“æ„ä½“</h2>
<ul>
<li><strong>æ³¨</strong>ï¼šå†…éƒ¨æˆå‘˜å˜é‡é¡ºåºæˆ‘åšäº†è°ƒæ•´ï¼Œå…¶å®ƒéƒ½æœªæ”¹åŠ¨</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ConnectionOptions</span> &#123;</span><br><span class="line">    <span class="comment">// ============ é»˜è®¤æ„é€ /æ‹·è´/ç§»åŠ¨/ææ„ ============</span></span><br><span class="line">    <span class="built_in">ConnectionOptions</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="built_in">ConnectionOptions</span>(<span class="type">const</span> ConnectionOptions &amp;) = <span class="keyword">default</span>;</span><br><span class="line">    ConnectionOptions&amp; <span class="keyword">operator</span>=(<span class="type">const</span> ConnectionOptions &amp;) = <span class="keyword">default</span>;</span><br><span class="line">    <span class="built_in">ConnectionOptions</span>(ConnectionOptions &amp;&amp;) = <span class="keyword">default</span>;</span><br><span class="line">    ConnectionOptions&amp; <span class="keyword">operator</span>=(ConnectionOptions &amp;&amp;) = <span class="keyword">default</span>;</span><br><span class="line">    ~<span class="built_in">ConnectionOptions</span>() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ============ è¿æ¥ç›®æ ‡ ============</span></span><br><span class="line">    ConnectionType type = ConnectionType::TCP;  <span class="comment">// è¿æ¥ç±»å‹: TCP æˆ– UNIX</span></span><br><span class="line">    std::string host;                           <span class="comment">// Redis æœåŠ¡å™¨ipåœ°å€ (TCPæ¨¡å¼)</span></span><br><span class="line">    <span class="type">int</span> port = <span class="number">6379</span>;                            <span class="comment">// ç«¯å£å· (TCPæ¨¡å¼)</span></span><br><span class="line">    std::string path;                           <span class="comment">// Unix Socket è·¯å¾„ (UNIXæ¨¡å¼)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ============ è®¤è¯ç›¸å…³ ============</span></span><br><span class="line">    std::string user = <span class="string">&quot;default&quot;</span>;               <span class="comment">// ACL ç”¨æˆ·å (Redis 6.0+ æ”¯æŒ)</span></span><br><span class="line">    std::string password;                       <span class="comment">// è®¤è¯å¯†ç </span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ============ æ•°æ®åº“é€‰æ‹© ============</span></span><br><span class="line">    <span class="type">int</span> db = <span class="number">0</span>;                                 <span class="comment">// æ•°æ®åº“ç´¢å¼• (0-15)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ============ è¶…æ—¶è®¾ç½® ============</span></span><br><span class="line">    std::chrono::milliseconds connect_timeout&#123;<span class="number">0</span>&#125;;  <span class="comment">// è¿æ¥è¶…æ—¶ (0=ç³»ç»Ÿé»˜è®¤)</span></span><br><span class="line">    std::chrono::milliseconds socket_timeout&#123;<span class="number">0</span>&#125;;   <span class="comment">// è¯»å†™è¶…æ—¶ (0=æ— é™ç­‰å¾…)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ============ TCP ä¿æ´» ============</span></span><br><span class="line">    <span class="type">bool</span> keep_alive = <span class="literal">false</span>;                    <span class="comment">// æ˜¯å¦å¯ç”¨ TCP KeepAliveï¼ˆå¿ƒè·³æœºåˆ¶ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> REDIS_PLUS_PLUS_HAS_redisEnableKeepAliveWithInterval</span></span><br><span class="line">    std::chrono::seconds keep_alive_s&#123;<span class="number">0</span>&#125;;       <span class="comment">// KeepAlive æ¢æµ‹ï¼ˆå¿ƒè·³ï¼‰é—´éš” (éœ€è¦ hiredis æ”¯æŒ)</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ============ TLS/SSL ============</span></span><br><span class="line">    tls::TlsOptions tls;                        <span class="comment">// TLS åŠ å¯†é…ç½®</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ============ åè®®ç‰ˆæœ¬ ============</span></span><br><span class="line">    <span class="type">int</span> resp = <span class="number">2</span>;                               <span class="comment">// RESP åè®®ç‰ˆæœ¬ (2 æˆ– 3)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ============ è¿æ¥åç§° ============</span></span><br><span class="line">    std::string name;                           <span class="comment">// CLIENT SETNAME è®¾ç½®çš„è¿æ¥å</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ============ é›†ç¾¤ä¸“ç”¨ï¼ˆä¸æˆ‘ä»¬æ— å…³ï¼Œä¸ç”¨çœ‹ï¼‰ ============</span></span><br><span class="line">    <span class="comment">// æ˜¯å¦å…è®¸ä» Redis Cluster çš„ä»èŠ‚ç‚¹ï¼ˆslave/replicaï¼‰è¯»å–æ•°æ®ã€‚</span></span><br><span class="line">    <span class="comment">// å®¢æˆ·ç«¯ä¸åº”æ‰‹åŠ¨è®¾ç½®ï¼ŒRedisCluster ç±»ä¼šè‡ªåŠ¨ç®¡ç†è¿™ä¸ªæ ‡å¿—ï¼ˆæœªæ¥å¯èƒ½ç§»é™¤ï¼‰</span></span><br><span class="line">    <span class="type">bool</span> readonly = <span class="literal">false</span>;    </span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†…éƒ¨ä½¿ç”¨ï¼Œè¿”å›æœåŠ¡å™¨ä¿¡æ¯å­—ç¬¦ä¸²</span></span><br><span class="line">    std::string _server_info() <span class="type">const</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>keep_alive å’Œ keep_alive_s çš„å…³ç³»</strong></p>
<ul>
<li>keep_alive = true ä½† keep_alive_s = 0 æ—¶ï¼Œä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„ KeepAlive é—´éš”ï¼ˆé€šå¸¸æ˜¯ 7200 ç§’ï¼‰</li>
<li>è‹¥è¦è‡ªå®šä¹‰é—´éš”ï¼Œéœ€è¦ hiredis ç‰ˆæœ¬æ”¯æŒ redisEnableKeepAliveWithInterval</li>
</ul>
<p><a id="ConnectionPoolOptions"></a></p>
<h2 id="2-ConnectionPoolOptionsç»“æ„ä½“">2.ConnectionPoolOptionsç»“æ„ä½“</h2>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ConnectionPoolOptions</span> &#123;</span><br><span class="line">    <span class="comment">// è¿æ¥æ± æœ€å¤§è¿æ¥æ•°</span></span><br><span class="line">    std::<span class="type">size_t</span> size = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–è¿æ¥æ—¶çš„æœ€å¤§ç­‰å¾…æ—¶é—´</span></span><br><span class="line">    <span class="comment">// å½“è¿æ¥æ± è€—å°½æ—¶ï¼Œè°ƒç”¨è€…æœ€å¤šé˜»å¡ç­‰å¾…è¿™ä¹ˆä¹…</span></span><br><span class="line">    <span class="comment">// 0 = æ— é™ç­‰å¾…ï¼ˆä¸æ¨èï¼Œå¯èƒ½å¯¼è‡´çº¿ç¨‹æ­»é”ï¼‰</span></span><br><span class="line">    std::chrono::milliseconds wait_timeout&#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿æ¥çš„æœ€å¤§å­˜æ´»æ—¶é—´</span></span><br><span class="line">    <span class="comment">// è¶…è¿‡æ­¤æ—¶é—´çš„è¿æ¥ä¼šè¢«é”€æ¯å¹¶é‡å»º</span></span><br><span class="line">    <span class="comment">// ç”¨äºé˜²æ­¢é•¿è¿æ¥è…åŒ–ã€åº”å¯¹æœåŠ¡ç«¯é‡å¯ç­‰åœºæ™¯</span></span><br><span class="line">    <span class="comment">// 0 = æ°¸ä¸è¿‡æœŸ</span></span><br><span class="line">    std::chrono::milliseconds connection_lifetime&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¿æ¥çš„æœ€å¤§ç©ºé—²æ—¶é—´</span></span><br><span class="line">    <span class="comment">// è¶…è¿‡æ­¤æ—¶é—´æœªè¢«ä½¿ç”¨çš„è¿æ¥ä¼šè¢«å›æ”¶</span></span><br><span class="line">    <span class="comment">// ç”¨äºé‡Šæ”¾é—²ç½®èµ„æºã€é¿å…ç©ºé—²è¿æ¥è¢«é˜²ç«å¢™/ä»£ç†æ–­å¼€</span></span><br><span class="line">    <span class="comment">// 0 = ä¸å›æ”¶ç©ºé—²è¿æ¥</span></span><br><span class="line">    std::chrono::milliseconds connection_idle_time&#123;<span class="number">0</span>&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><a id="SentinelOptions"></a></p>
<h2 id="3-SentinelOptionsç»“æ„ä½“">3.SentinelOptionsç»“æ„ä½“</h2>
<ul>
<li><strong>æ³¨</strong>ï¼šå†…éƒ¨æˆå‘˜å˜é‡é¡ºåºæˆ‘åšäº†è°ƒæ•´ï¼Œå…¶å®ƒéƒ½æœªæ”¹åŠ¨</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SentinelOptions</span> &#123;</span><br><span class="line">    <span class="comment">/// å“¨å…µèŠ‚ç‚¹åˆ—è¡¨ï¼šæ¯ä¸ªå…ƒç´ ä¸º&lt;å“¨å…µèŠ‚ç‚¹IP/åŸŸå, å“¨å…µç«¯å£&gt;</span></span><br><span class="line">    <span class="comment">/// ç¤ºä¾‹ï¼š&#123;&#123;&quot;127.0.0.1&quot;, 26379&#125;, &#123;&quot;127.0.0.1&quot;, 26380&#125;&#125;</span></span><br><span class="line">    std::vector&lt;std::pair&lt;std::string, <span class="type">int</span>&gt;&gt; nodes;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// è¿æ¥å“¨å…µèŠ‚ç‚¹çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤100æ¯«ç§’</span></span><br><span class="line">    <span class="comment">/// è¶…è¿‡è¯¥æ—¶é—´æœªå»ºç«‹è¿æ¥åˆ™è§†ä¸ºè¿æ¥å¤±è´¥</span></span><br><span class="line">    std::chrono::milliseconds connect_timeout&#123;<span class="number">100</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// ä¸å“¨å…µèŠ‚ç‚¹é€šä¿¡çš„Socketè¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤100æ¯«ç§’</span></span><br><span class="line">    <span class="comment">/// è¶…è¿‡è¯¥æ—¶é—´æœªæ”¶åˆ°å“¨å…µå“åº”åˆ™è§†ä¸ºé€šä¿¡å¤±è´¥</span></span><br><span class="line">    std::chrono::milliseconds socket_timeout&#123;<span class="number">100</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// è¿æ¥å“¨å…µå¤±è´¥åçš„é‡è¯•é—´éš”ï¼Œé»˜è®¤100æ¯«ç§’</span></span><br><span class="line">    std::chrono::milliseconds retry_interval&#123;<span class="number">100</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// è¿æ¥å“¨å…µçš„æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤2æ¬¡</span></span><br><span class="line">    <span class="comment">/// è¾¾åˆ°è¯¥æ¬¡æ•°ä»å¤±è´¥åˆ™æ•´ä½“è¿æ¥æµç¨‹ç»ˆæ­¢</span></span><br><span class="line">    std::<span class="type">size_t</span> max_retry = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// å“¨å…µè®¤è¯çš„ç”¨æˆ·åï¼Œé»˜è®¤å€¼ä¸º&quot;default&quot;ï¼ˆRedis 6.0+ æ–°å¢çš„ACLç”¨æˆ·è®¤è¯ï¼‰</span></span><br><span class="line">    std::string user = <span class="string">&quot;default&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// å“¨å…µè®¤è¯çš„å¯†ç ï¼ˆå¦‚æœå“¨å…µèŠ‚ç‚¹é…ç½®äº†å¯†ç éªŒè¯ï¼Œéœ€å¡«å†™æ­¤é¡¹ï¼‰</span></span><br><span class="line">    std::string password;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// æ˜¯å¦å¯ç”¨TCP Keep-Aliveæœºåˆ¶ï¼Œé»˜è®¤true</span></span><br><span class="line">    <span class="comment">/// ä½œç”¨ï¼šæ£€æµ‹æ— æ•ˆçš„è¿æ¥ï¼Œé¿å…é•¿æ—¶é—´ç©ºé—²çš„è¿æ¥è¢«æ–­å¼€</span></span><br><span class="line">    <span class="type">bool</span> keep_alive = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// TLS/SSLè¿æ¥é…ç½®é€‰é¡¹ï¼ˆå¦‚æœå“¨å…µèŠ‚ç‚¹å¯ç”¨äº†TLSåŠ å¯†ï¼Œéœ€é…ç½®æ­¤é¡¹ï¼‰</span></span><br><span class="line">    tls::TlsOptions tls;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// æŒ‡å®šä¸å“¨å…µé€šä¿¡ä½¿ç”¨çš„Redis RESPåè®®ç‰ˆæœ¬ï¼Œé»˜è®¤2ï¼ˆRESP2ï¼‰</span></span><br><span class="line">    <span class="comment">/// å¯é€‰å€¼ï¼š2ï¼ˆRESP2ï¼‰ã€3ï¼ˆRESP3ï¼‰ï¼Œéœ€ä¸å“¨å…µèŠ‚ç‚¹çš„åè®®ç‰ˆæœ¬åŒ¹é…</span></span><br><span class="line">    <span class="type">int</span> resp = <span class="number">2</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h1>å››ã€Redis ç±»ï¼ˆå•æœº/ä¸»ä»/å“¨å…µæ¨¡å¼æ ¸å¿ƒå®¢æˆ·ç«¯ï¼‰</h1>
<ul>
<li>ä½œä¸º Redis++ æœ€åŸºç¡€ä¸”æ ¸å¿ƒçš„â€œ<strong>å®¢æˆ·ç«¯ç±»</strong>â€ï¼Œå°è£…äº†æ‰€æœ‰ Redis åŸç”Ÿå‘½ä»¤çš„è°ƒç”¨æ¥å£</li>
<li>æ”¯æŒ<strong>å•æœºã€ä¸»ä»ã€å“¨å…µ</strong>ä¸‰ç§éƒ¨ç½²æ¨¡å¼çš„è¿æ¥ä¸æ“ä½œï¼Œæ˜¯ç”Ÿäº§ç¯å¢ƒä¸­æœ€å¸¸ç”¨çš„ç±»</li>
</ul>
<p><strong>æ³¨ï¼ï¼</strong>ï¼šå•æœºã€ä¸»ä»ã€å“¨å…µç­‰éƒ¨ç½²æ¨¡å¼éƒ½æ˜¯<strong>ç”±â€œæœåŠ¡ç«¯â€é…ç½®</strong>ï¼ŒRedisç±»åªè´Ÿè´£è¿æ¥åˆ°å·²å­˜åœ¨çš„éƒ¨ç½²æ¨¡å¼</p>
<h2 id="1-Redisç±»ä»‹ç»">1.Redisç±»ä»‹ç»</h2>
<h3 id="ï¼ˆ1ï¼‰Redisç±»çš„å…³é”®å®ç°ç»†èŠ‚">ï¼ˆ1ï¼‰Redisç±»çš„å…³é”®å®ç°ç»†èŠ‚</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Redis</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. åŸºç¡€æ„é€ ï¼šé€šè¿‡è¿æ¥é€‰é¡¹ + è¿æ¥æ± é€‰é¡¹åˆå§‹åŒ–ï¼ˆæœ€å¸¸ç”¨ï¼‰</span></span><br><span class="line">    <span class="comment">/// @param connection_opts è¿æ¥é€‰é¡¹</span></span><br><span class="line">    <span class="comment">/// @param pool_opts è¿æ¥æ± é€‰é¡¹</span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Redis</span><span class="params">(<span class="type">const</span> ConnectionOptions &amp;connection_opts,</span></span></span><br><span class="line"><span class="params"><span class="function">                      <span class="type">const</span> ConnectionPoolOptions &amp;pool_opts = &#123;&#125;)</span></span></span><br><span class="line"><span class="function">                	:_pool(std::make_shared&lt;ConnectionPool&gt;(pool_opts, connection_opts)) </span></span><br><span class="line"><span class="function">                	&#123;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. ç®€åŒ–æ„é€ ï¼šé€šè¿‡ URI å­—ç¬¦ä¸²ç›´æ¥åˆå§‹åŒ–ï¼ˆå¿«é€Ÿé…ç½®åœºæ™¯ï¼‰</span></span><br><span class="line">    <span class="comment">/// @brief ç”¨ URI å­—ç¬¦ä¸²æ„é€  Redis å®ä¾‹ï¼ˆç®€åŒ–é…ç½®ï¼Œæ— éœ€æ‰‹åŠ¨ç»„è£… ConnectionOptionsï¼‰</span></span><br><span class="line">    <span class="comment">/// @param uri URI æ ¼å¼è¯´æ˜ï¼š</span></span><br><span class="line">    <span class="comment">///     - TCP è¿æ¥ï¼štcp://[[username:]password@]host[:port][/db]</span></span><br><span class="line">    <span class="comment">///         - ç¤ºä¾‹ï¼š&quot;tcp://127.0.0.1&quot;ã€&quot;tcp://user:pass@127.0.0.1:6379/0&quot;ï¼ˆè¿æ¥ 0 å·åº“ï¼‰</span></span><br><span class="line">    <span class="comment">///     - Unix å¥—æ¥å­—è¿æ¥ï¼šunix://[[username:]password@]path-to-unix-domain-socket[/db]</span></span><br><span class="line">    <span class="comment">///         - ç¤ºä¾‹ï¼š&quot;unix:///tmp/redis.sock&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Redis</span><span class="params">(<span class="type">const</span> std::string &amp;uri)</span> : Redis(Uri(uri)) &#123;</span>&#125;  <span class="comment">// å†…éƒ¨è½¬å‘ç»™ Uri è§£æåçš„æ„é€ å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. å“¨å…µæ¨¡å¼æ„é€ ï¼šé€šè¿‡ Redis Sentinel è‡ªåŠ¨å‘ç°èŠ‚ç‚¹ï¼ˆé«˜å¯ç”¨åœºæ™¯ï¼‰</span></span><br><span class="line">    <span class="comment">/// @brief åŸºäº Redis å“¨å…µæ¨¡å¼æ„é€  Redis å®ä¾‹ï¼ˆè‡ªåŠ¨è·å–ä¸»ä»èŠ‚ç‚¹ä¿¡æ¯ï¼Œæ”¯æŒæ•…éšœè‡ªåŠ¨åˆ‡æ¢ï¼‰</span></span><br><span class="line">    <span class="comment">/// @param sentinel Sentinel å®ä¾‹çš„æ™ºèƒ½æŒ‡é’ˆï¼ˆç”¨äºä¸å“¨å…µé›†ç¾¤é€šä¿¡ï¼‰</span></span><br><span class="line">    <span class="comment">/// @param master_name ä¸»èŠ‚ç‚¹åç§°ï¼ˆå“¨å…µé›†ç¾¤ç›‘æ§çš„ä¸»èŠ‚ç‚¹æ ‡è¯†ï¼‰</span></span><br><span class="line">    <span class="comment">/// @param role è¿æ¥è§’è‰²ï¼š</span></span><br><span class="line">    <span class="comment">///     - Role::MASTER: è¿æ¥ä¸»èŠ‚ç‚¹ï¼ˆç”¨äºå†™æ“ä½œï¼‰</span></span><br><span class="line">    <span class="comment">///     - Role::SLAVE: è¿æ¥ä»èŠ‚ç‚¹ï¼ˆç”¨äºè¯»æ“ä½œï¼Œå®ç°è¯»å†™åˆ†ç¦»ï¼‰</span></span><br><span class="line">    <span class="comment">/// @param connection_opts è¿æ¥é€‰é¡¹ï¼ˆåŒåŸºç¡€æ„é€ ï¼Œå¯é…ç½® KeepAlive ç­‰ï¼‰</span></span><br><span class="line">    <span class="comment">/// @param pool_opts è¿æ¥æ± é€‰é¡¹ï¼ˆåŒåŸºç¡€æ„é€ ï¼Œé»˜è®¤ä½¿ç”¨é»˜è®¤é…ç½®ï¼‰</span></span><br><span class="line">    <span class="built_in">Redis</span>(<span class="type">const</span> std::shared_ptr&lt;Sentinel&gt; &amp;sentinel,</span><br><span class="line">          <span class="type">const</span> std::string &amp;master_name,</span><br><span class="line">          Role role,</span><br><span class="line">          <span class="type">const</span> ConnectionOptions &amp;connection_opts,</span><br><span class="line">          <span class="type">const</span> ConnectionPoolOptions &amp;pool_opts = &#123;&#125;)</span><br><span class="line">          : _pool(std::<span class="built_in">make_shared</span>&lt;ConnectionPool&gt;(<span class="built_in">SimpleSentinel</span>(sentinel, master_name, role),</span><br><span class="line">                                                   pool_opts,</span><br><span class="line">                                                   connection_opts)) </span><br><span class="line">          &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Redis</span>(<span class="type">const</span> Redis &amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    Redis&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Redis &amp;) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Redis</span>(Redis &amp;&amp;) = <span class="keyword">default</span>;</span><br><span class="line">    Redis&amp; <span class="keyword">operator</span>=(Redis &amp;&amp;) = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::shared_ptr&lt;ConnectionPool&gt; _pool;  <span class="comment">// æ ¸å¿ƒæˆå‘˜ï¼šè¿æ¥æ± æ™ºèƒ½æŒ‡é’ˆï¼ˆç®¡ç† Redis è¿æ¥ï¼‰</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰æ•°æ®ç±»å‹-æ“ä½œå¯¹ç…§è¡¨">ï¼ˆ2ï¼‰æ•°æ®ç±»å‹ &amp; æ“ä½œå¯¹ç…§è¡¨</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260113145948394.png" alt=""></p>
<h3 id="ï¼ˆ3ï¼‰keyã€ç®¡é“ã€äº‹åŠ¡ã€å‘å¸ƒè®¢é˜…ç­‰åŠŸèƒ½">ï¼ˆ3ï¼‰keyã€ç®¡é“ã€äº‹åŠ¡ã€å‘å¸ƒè®¢é˜…ç­‰åŠŸèƒ½</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260113150625783.png" alt=""></p>
<h2 id="2-Redisç±»-é€‚é…â€œå•æœºæ¨¡å¼â€">2.Redisç±» é€‚é…â€œå•æœºæ¨¡å¼â€</h2>
<h3 id="ï¼ˆ1ï¼‰ä»‹ç»">ï¼ˆ1ï¼‰ä»‹ç»</h3>
<ul>
<li>Redisç±»ç›´æ¥è¿æ¥å•ä¸ªRedisèŠ‚ç‚¹ï¼Œéƒ¨ç½²ç®€å•ä½†æ— é«˜å¯ç”¨ä¿éšœ</li>
<li><strong>æœåŠ¡ç«¯éƒ¨ç½²ï¼ï¼</strong>ï¼š
<ul>
<li>Linuxä¸Šå®‰è£…Redisåï¼Œç›´æ¥å¯åŠ¨å³å¯</li>
</ul>
</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰ä»£ç å®ç°">ï¼ˆ2ï¼‰ä»£ç å®ç°</h3>
<p><a href="#ConnectionOptions">ConnectionOptionsç»“æ„ä½“</a><br>
<a href="#ConnectionPoolOptions">ConnectionPoolOptionsç»“æ„ä½“</a></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sw/redis++/redis++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> sw::redis;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">worker</span><span class="params">(Redis &amp;redis, <span class="type">int</span> id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">            std::string key = <span class="string">&quot;key_&quot;</span> + std::<span class="built_in">to_string</span>(id) + <span class="string">&quot;_&quot;</span> + std::<span class="built_in">to_string</span>(i);</span><br><span class="line">            redis.<span class="built_in">set</span>(key, <span class="string">&quot;value_&quot;</span> + std::<span class="built_in">to_string</span>(i));</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">auto</span> val = redis.<span class="built_in">get</span>(key);</span><br><span class="line">            <span class="keyword">if</span> (val) &#123;</span><br><span class="line">                std::cout &lt;&lt; <span class="string">&quot;çº¿ç¨‹ &quot;</span> &lt;&lt; id &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; key &lt;&lt; <span class="string">&quot; = &quot;</span> &lt;&lt; *val &lt;&lt; std::endl;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> Error &amp;e) &#123;</span><br><span class="line">        <span class="comment">// âœ… çº¿ç¨‹å†…éƒ¨æ•è·å¼‚å¸¸</span></span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;âœ— çº¿ç¨‹ &quot;</span> &lt;&lt; id &lt;&lt; <span class="string">&quot; é”™è¯¯: &quot;</span> &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ConnectionOptions conn_opts;</span><br><span class="line">    conn_opts.host = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">    conn_opts.port = <span class="number">6379</span>;</span><br><span class="line">    conn_opts.socket_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">100</span>);</span><br><span class="line">    </span><br><span class="line">    ConnectionPoolOptions pool_opts;</span><br><span class="line">    pool_opts.size = <span class="number">5</span>;</span><br><span class="line">    pool_opts.wait_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">100</span>);</span><br><span class="line">    pool_opts.connection_lifetime = std::chrono::<span class="built_in">minutes</span>(<span class="number">10</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»º Redis å¯¹è±¡ï¼ˆå¯èƒ½å¤±è´¥ï¼‰ </span></span><br><span class="line">    std::unique_ptr&lt;Redis&gt; redis;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        redis = std::<span class="built_in">make_unique</span>&lt;Redis&gt;(conn_opts, pool_opts);</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;âœ“ Redis è¿æ¥æˆåŠŸ&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> Error &amp;e) &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;âœ— Redis è¿æ¥å¤±è´¥: &quot;</span> &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;  <span class="comment">// è¿æ¥å¤±è´¥ï¼Œç›´æ¥é€€å‡º</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    std::vector&lt;std::thread&gt; threads;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">        threads.<span class="built_in">emplace_back</span>(worker, std::<span class="built_in">ref</span>(*redis), i);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;t : threads) &#123;</span><br><span class="line">        t.<span class="built_in">join</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;âœ“ æ‰€æœ‰çº¿ç¨‹å®Œæˆ&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-Redisç±»-é€‚é…â€œä¸»ä»å¤åˆ¶æ¨¡å¼â€">3.Redisç±» é€‚é…â€œä¸»ä»å¤åˆ¶æ¨¡å¼â€</h2>
<h3 id="ï¼ˆ1ï¼‰ä»‹ç»-2">ï¼ˆ1ï¼‰ä»‹ç»</h3>
<ul>
<li>é€‚é…è¯»å¤šå†™å°‘çš„ç”Ÿäº§åœºæ™¯ï¼ŒåŒ…å«ä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼ˆå†™å…¥ï¼‰å’Œå¤šä¸ªä»èŠ‚ç‚¹ï¼ˆè¯»å–ï¼‰</li>
<li>åˆ†åˆ«åˆ›å»ºRedisç±»ï¼ŒæŒ‰â€œå•æœºæ¨¡å¼â€œè¿æ¥æ–¹å¼åˆ†åˆ«è¿æ¥â€œä¸»èŠ‚ç‚¹ã€ä»èŠ‚ç‚¹â€å³å¯ï¼ˆé€šè¿‡<strong>ipï¼šport</strong>ï¼‰</li>
<li><strong>æœåŠ¡ç«¯éƒ¨ç½²ï¼ï¼</strong>ï¼š
<ul>
<li>æœåŠ¡ç«¯éœ€<strong>æ‰‹åŠ¨â€œé…ç½®ä¸»ä»â€</strong></li>
</ul>
</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰ä»£ç å®ç°-2">ï¼ˆ2ï¼‰ä»£ç å®ç°</h3>
<p><a href="#ConnectionOptions">ConnectionOptionsç»“æ„ä½“</a><br>
<a href="#ConnectionPoolOptions">ConnectionPoolOptionsç»“æ„ä½“</a><br>
<strong>å‡è®¾ä¸»ä»å¤åˆ¶æ¨¡å¼é…ç½®å¦‚ä¸‹</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># ä¸»èŠ‚ç‚¹</span><br><span class="line">127.0.0.1ï¼š6370</span><br><span class="line"></span><br><span class="line"># ä»èŠ‚ç‚¹1</span><br><span class="line">127.0.0.1ï¼š6380</span><br><span class="line"></span><br><span class="line"># ä»èŠ‚ç‚¹2</span><br><span class="line">127.0.0.1:6381</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sw/redis++/redis++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;random&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> sw::redis;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ==================== é…ç½®å‚æ•° ====================</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä¸»èŠ‚ç‚¹é…ç½®</span></span><br><span class="line">        std::string master_host = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">        <span class="type">int</span> master_port = <span class="number">6379</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä»èŠ‚ç‚¹é…ç½®</span></span><br><span class="line">        std::vector&lt;std::pair&lt;std::string, <span class="type">int</span>&gt;&gt; slaves = &#123;</span><br><span class="line">            &#123;<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6380</span>&#125;,  <span class="comment">// ä»èŠ‚ç‚¹1</span></span><br><span class="line">            &#123;<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6381</span>&#125;   <span class="comment">// ä»èŠ‚ç‚¹2</span></span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        std::string password = <span class="string">&quot;&quot;</span>;  <span class="comment">// å¦‚æœæœ‰å¯†ç ï¼Œå¡«å†™åœ¨è¿™é‡Œ</span></span><br><span class="line">        <span class="type">size_t</span> pool_size = <span class="number">3</span>;       <span class="comment">// è¿æ¥æ± å¤§å°</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ==================== 1. è¿æ¥ä¸»èŠ‚ç‚¹ ====================</span></span><br><span class="line">        </span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;=== è¿æ¥ä¸»èŠ‚ç‚¹ ===&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        </span><br><span class="line">        ConnectionOptions master_opts;</span><br><span class="line">        master_opts.host = master_host;</span><br><span class="line">        master_opts.port = master_port;</span><br><span class="line">        master_opts.password = password;</span><br><span class="line">        master_opts.connect_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">100</span>);</span><br><span class="line">        master_opts.socket_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">100</span>);</span><br><span class="line">        </span><br><span class="line">        ConnectionPoolOptions pool_opts;</span><br><span class="line">        pool_opts.size = pool_size;</span><br><span class="line">        pool_opts.wait_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">100</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">auto</span> master = <span class="built_in">Redis</span>(master_opts, pool_opts);</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;âœ“ ä¸»èŠ‚ç‚¹è¿æ¥æˆåŠŸï¼š&quot;</span> &lt;&lt; master_host &lt;&lt; <span class="string">&quot;:&quot;</span> &lt;&lt; master_port &lt;&lt; std::endl;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ==================== 2. è¿æ¥ä»èŠ‚ç‚¹ ====================</span></span><br><span class="line">        </span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;\n=== è¿æ¥ä»èŠ‚ç‚¹ ===&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        </span><br><span class="line">        std::vector&lt;Redis&gt; slave_clients;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; [host, port] : slaves) &#123;</span><br><span class="line">            ConnectionOptions slave_opts;</span><br><span class="line">            slave_opts.host = host;</span><br><span class="line">            slave_opts.port = port;</span><br><span class="line">            slave_opts.password = password;</span><br><span class="line">            slave_opts.connect_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">100</span>);</span><br><span class="line">            slave_opts.socket_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">100</span>);</span><br><span class="line">            </span><br><span class="line">            slave_clients.<span class="built_in">emplace_back</span>(<span class="built_in">Redis</span>(slave_opts, pool_opts));</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;âœ“ ä»èŠ‚ç‚¹è¿æ¥æˆåŠŸï¼š&quot;</span> &lt;&lt; host &lt;&lt; <span class="string">&quot;:&quot;</span> &lt;&lt; port &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-Redisç±»-é€‚é…â€œå“¨å…µæ¨¡å¼â€">4.Redisç±» é€‚é…â€œå“¨å…µæ¨¡å¼â€</h2>
<h3 id="ï¼ˆ1ï¼‰ä»‹ç»-3">ï¼ˆ1ï¼‰ä»‹ç»</h3>
<ul>
<li>â€œå“¨å…µæ¨¡å¼â€ä¸ºRedisæä¾›äº†é«˜å¯ç”¨æ€§ï¼Œä½†ç›¸è¾ƒäºå‰ä¸¤ä¸­æ¨¡å¼ï¼Œè¦å¤æ‚ä¸€ç‚¹</li>
<li>â€œå“¨å…µæ¨¡å¼â€éœ€è¦ç”¨åˆ°â€œ<strong>Sentinelç±»</strong>â€ï¼ˆå“¨å…µç±»ï¼‰</li>
<li><strong>æœåŠ¡ç«¯éƒ¨ç½²ï¼ï¼</strong>ï¼š
<ul>
<li>æœåŠ¡ç«¯éœ€æ‰‹åŠ¨**â€œé…ç½®ä¸»ä»â€**ï¼ˆ<strong>å“¨å…µæ¨¡å¼çš„åŸºç¡€</strong>ï¼‰</li>
<li>æœåŠ¡å™¨åºæ‰‹åŠ¨åˆ›å»ºâ€œ<strong>å“¨å…µèŠ‚ç‚¹</strong>â€</li>
</ul>
</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰ä»£ç å®ç°-3">ï¼ˆ2ï¼‰ä»£ç å®ç°</h3>
<p><a href="#ConnectionOptions">ConnectionOptionsç»“æ„ä½“</a><br>
<a href="#ConnectionPoolOptions">ConnectionPoolOptionsç»“æ„ä½“</a><br>
<strong>æ¨èå…ˆçœ‹</strong>ï¼š<a href="#Sentinel">Sentinelç±»</a><br>
<strong>å‡è®¾å“¨å…µæ¨¡å¼é…ç½®å¦‚ä¸‹</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># ä¸»èŠ‚ç‚¹</span><br><span class="line">127.0.0.1ï¼š6370</span><br><span class="line"></span><br><span class="line"># ä»èŠ‚ç‚¹</span><br><span class="line">127.0.0.1ï¼š6380</span><br><span class="line">127.0.0.1ï¼š6381</span><br><span class="line"></span><br><span class="line"># å“¨å…µèŠ‚ç‚¹</span><br><span class="line">127.0.0.1ï¼š9000</span><br><span class="line">127.0.0.1ï¼š9001</span><br><span class="line">127.0.0.1ï¼š9002</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sw/redis++/redis++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> sw::redis;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ============ 1. å“¨å…µé…ç½® ============</span></span><br><span class="line">    SentinelOptions sentinel_opts;</span><br><span class="line">    sentinel_opts.nodes = &#123;</span><br><span class="line">        &#123;<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">9000</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">9001</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">9002</span>&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    sentinel_opts.connect_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">100</span>);</span><br><span class="line">    sentinel_opts.socket_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">100</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">auto</span> sentinel = std::<span class="built_in">make_shared</span>&lt;Sentinel&gt;(sentinel_opts);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ============ 2. è¿æ¥é…ç½® ============</span></span><br><span class="line">    ConnectionOptions conn_opts;</span><br><span class="line">    conn_opts.connect_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">100</span>);</span><br><span class="line">    conn_opts.socket_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">100</span>);</span><br><span class="line">    </span><br><span class="line">    ConnectionPoolOptions pool_opts;</span><br><span class="line">    pool_opts.size = <span class="number">3</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ============ 3. åˆ›å»ºä¸»èŠ‚ç‚¹ ============</span></span><br><span class="line">    <span class="keyword">auto</span> master = <span class="built_in">Redis</span>(sentinel, </span><br><span class="line">                        <span class="string">&quot;mymaster&quot;</span>,  	<span class="comment">// è¿™æ˜¯åœ¨å“¨å…µé…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„ä¸»èŠ‚ç‚¹åç§°</span></span><br><span class="line">                        Role::MASTER,   <span class="comment">// è§’è‰²</span></span><br><span class="line">                        conn_opts, </span><br><span class="line">                        pool_opts);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ============ 4. åˆ›å»ºä»èŠ‚ç‚¹ ============</span></span><br><span class="line">    <span class="keyword">auto</span> slave = <span class="built_in">Redis</span>(sentinel, </span><br><span class="line">                        <span class="string">&quot;mymaster&quot;</span>, 	<span class="comment">// è¿™æ˜¯åœ¨å“¨å…µé…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„ä¸»èŠ‚ç‚¹åç§°</span></span><br><span class="line">                        Role::SLAVE, 	<span class="comment">// è§’è‰²</span></span><br><span class="line">                        conn_opts, </span><br><span class="line">                        pool_opts);</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;âœ… ä»èŠ‚ç‚¹è¿æ¥æˆåŠŸ&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>ä¸éœ€è¦æ‰‹åŠ¨æŒ‡å®šâ€œä¸»èŠ‚ç‚¹â€ã€â€œä»èŠ‚ç‚¹â€çš„ip:port</strong>
<ul>
<li>èŠ‚ç‚¹çš„åˆ†é…éƒ½æœ‰â€œ<strong>Sentinelç±»</strong>â€ï¼ˆå“¨å…µç±»ï¼‰å®Œæˆ</li>
</ul>
</li>
</ul>
<h3 id="ï¼ˆ3ï¼‰ä¸ºä»€ä¹ˆéœ€è¦â€œå“¨å…µæ¨¡å¼â€ï¼Ÿ">ï¼ˆ3ï¼‰ä¸ºä»€ä¹ˆéœ€è¦â€œå“¨å…µæ¨¡å¼â€ï¼Ÿ</h3>
<h4 id="1-æ ¸å¿ƒé—®é¢˜">&lt;1&gt;æ ¸å¿ƒé—®é¢˜</h4>
<p><strong>âŒ ä¸»ä»å¤åˆ¶æ¨¡å¼çš„è‡´å‘½ç¼ºé™·</strong>ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">ä¸»ä»å¤åˆ¶æ¨¡å¼ = æ‰‹åŠ¨ç®¡ç† + å•ç‚¹æ•…éšœ</span><br><span class="line"></span><br><span class="line">å®¢æˆ·ç«¯è¿æ¥ï¼š</span><br><span class="line">master_redis = <span class="built_in">Redis</span>(<span class="string">&quot;127.0.0.1:6379&quot;</span>)</span><br><span class="line">slave_redis  = <span class="built_in">Redis</span>(<span class="string">&quot;127.0.0.1:6380&quot;</span>)</span><br><span class="line"></span><br><span class="line">é—®é¢˜<span class="number">1</span>ï¼šä¸»èŠ‚ç‚¹å®•æœº</span><br><span class="line">â†’ master_redis è¿æ¥å¤±æ•ˆ</span><br><span class="line">â†’ æŠ›å‡ºå¼‚å¸¸ï¼šConnection refused</span><br><span class="line">â†’ å†™æ“ä½œå…¨éƒ¨å¤±è´¥</span><br><span class="line">â†’ éœ€è¦äººå·¥ä»‹å…¥ï¼š</span><br><span class="line">   <span class="number">1.</span> æ‰‹åŠ¨æå‡ä»èŠ‚ç‚¹ï¼ˆSLAVEOF NO ONEï¼‰</span><br><span class="line">   <span class="number">2.</span> ä¿®æ”¹ä»£ç ä¸­çš„ä¸»èŠ‚ç‚¹åœ°å€</span><br><span class="line">   <span class="number">3.</span> é‡å¯åº”ç”¨ç¨‹åº</span><br><span class="line"></span><br><span class="line">é—®é¢˜<span class="number">2</span>ï¼šä»èŠ‚ç‚¹å®•æœº</span><br><span class="line">â†’ slave_redis è¿æ¥å¤±æ•ˆ</span><br><span class="line">â†’ æŠ›å‡ºå¼‚å¸¸ï¼šConnection refused</span><br><span class="line">â†’ è¯»æ“ä½œå¤±è´¥</span><br><span class="line">â†’ éœ€è¦äººå·¥åˆ‡æ¢åˆ°å…¶ä»–ä»èŠ‚ç‚¹</span><br></pre></td></tr></table></figure>
<p><strong>æ ¸å¿ƒçŸ›ç›¾</strong>ï¼š</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">å®¢æˆ·ç«¯ <span class="code">`Redis`</span> å¯¹è±¡ = é™æ€è¿æ¥ï¼ˆå›ºå®š <span class="code">`IP:Port`</span>ï¼‰</span><br><span class="line">æœåŠ¡ç«¯èŠ‚ç‚¹çŠ¶æ€   = åŠ¨æ€å˜åŒ–ï¼ˆå®•æœº/åˆ‡æ¢/æ–°å¢ï¼‰</span><br><span class="line"></span><br><span class="line">â†’ ä¸¤è€…æ— æ³•è‡ªåŠ¨åŒæ­¥</span><br><span class="line">â†’ éœ€è¦äººå·¥å¹²é¢„</span><br><span class="line">â†’ é«˜å¯ç”¨æ€§å·®</span><br></pre></td></tr></table></figure>
<h4 id="2-å“¨å…µæ¨¡å¼çš„è§£å†³æ–¹æ¡ˆ">&lt;2&gt;å“¨å…µæ¨¡å¼çš„è§£å†³æ–¹æ¡ˆ</h4>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¼•å…¥ä¸­é—´å±‚ï¼šSentinel</span><br><span class="line">ä½œç”¨ï¼šåŠ¨æ€æ„ŸçŸ¥èŠ‚ç‚¹å˜åŒ–ï¼Œè‡ªåŠ¨æ›´æ–°å®¢æˆ·ç«¯è¿æ¥</span><br></pre></td></tr></table></figure>
<p><strong>æ¡†æ¶è®¾è®¡</strong>ï¼š</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">ä¼ ç»Ÿæ¨¡å¼ï¼ˆé™æ€è¿æ¥ï¼‰ï¼š</span><br><span class="line">åº”ç”¨ç¨‹åº â†’ Redis å¯¹è±¡ â†’ å›ºå®šèŠ‚ç‚¹ (<span class="code">`127.0.0.1:6379`</span>)</span><br><span class="line"><span class="code">              â†“ èŠ‚ç‚¹å®•æœº</span></span><br><span class="line"><span class="code">         è¿æ¥å¤±æ•ˆï¼ŒæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">å“¨å…µæ¨¡å¼ï¼ˆåŠ¨æ€è¿æ¥ï¼‰ï¼š</span><br><span class="line">åº”ç”¨ç¨‹åº â†’ Sentinel â†’ å“¨å…µé›†ç¾¤ (ç›‘æ§èŠ‚ç‚¹çŠ¶æ€)</span><br><span class="line"><span class="code">              â†“                  â†“</span></span><br><span class="line"><span class="code">         Redis å¯¹è±¡ â†â”€â”€â”€ åŠ¨æ€è·å–å¯ç”¨èŠ‚ç‚¹</span></span><br><span class="line"><span class="code">              â†“</span></span><br><span class="line"><span class="code">         å½“å‰ä¸»èŠ‚ç‚¹ (`127.0.0.1:6379`)</span></span><br><span class="line"><span class="code">              â†“ ä¸»èŠ‚ç‚¹å®•æœº</span></span><br><span class="line"><span class="code">         å“¨å…µæ£€æµ‹ â†’ é€‰ä¸¾æ–°ä¸»èŠ‚ç‚¹ (`127.0.0.1:6380`)</span></span><br><span class="line"><span class="code">              â†“</span></span><br><span class="line"><span class="code">         Sentinel è‡ªåŠ¨é€šçŸ¥ Redis å¯¹è±¡</span></span><br><span class="line"><span class="code">              â†“</span></span><br><span class="line"><span class="code">         Redis å¯¹è±¡è‡ªåŠ¨é‡è¿æ–°ä¸»èŠ‚ç‚¹</span></span><br><span class="line"><span class="code">              â†“</span></span><br><span class="line"><span class="code">         åº”ç”¨ç¨‹åºæ— æ„ŸçŸ¥ï¼Œç»§ç»­æ­£å¸¸å·¥ä½œ</span></span><br></pre></td></tr></table></figure>
<h4 id="3-Redis-çš„å®ç°ç»†èŠ‚ï¼ˆç®€è¦ç‰ˆï¼‰">&lt;3&gt;Redis++ çš„å®ç°ç»†èŠ‚ï¼ˆç®€è¦ç‰ˆï¼‰</h4>
<ol>
<li><strong>ä¼ ç»Ÿæ¨¡å¼</strong></li>
</ol>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âŒ é™æ€è¿æ¥</span></span><br><span class="line"><span class="keyword">auto</span> redis = <span class="built_in">Redis</span>(<span class="string">&quot;127.0.0.1:6379&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸»èŠ‚ç‚¹å®•æœº</span></span><br><span class="line">redis.<span class="built_in">set</span>(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line"><span class="comment">// â†’ æŠ›å‡ºå¼‚å¸¸ï¼šConnection refused</span></span><br><span class="line"><span class="comment">// â†’ æ— æ³•è‡ªåŠ¨æ¢å¤</span></span><br></pre></td></tr></table></figure>
<p><strong>é—®é¢˜</strong>ï¼š</p>
<ul>
<li>Redis å¯¹è±¡åªçŸ¥é“åˆ›å»ºæ—¶çš„å›ºå®šåœ°å€</li>
<li>èŠ‚ç‚¹å˜åŒ–æ—¶ï¼Œæ— æ³•è‡ªåŠ¨æ›´æ–°è¿æ¥</li>
<li>éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ä»£ç å¹¶é‡å¯</li>
</ul>
<ol start="2">
<li><strong>å“¨å…µæ¨¡å¼ï¼ˆSentinel + Redisï¼‰</strong></li>
</ol>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âœ… åŠ¨æ€è¿æ¥</span></span><br><span class="line">SentinelOptions sentinel_opts;</span><br><span class="line">sentinel_opts.nodes = &#123;</span><br><span class="line">    &#123;<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">26379</span>&#125;,  <span class="comment">// å“¨å…µ1</span></span><br><span class="line">    &#123;<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">26380</span>&#125;,  <span class="comment">// å“¨å…µ2</span></span><br><span class="line">    &#123;<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">26381</span>&#125;   <span class="comment">// å“¨å…µ3</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">auto</span> sentinel = std::<span class="built_in">make_shared</span>&lt;Sentinel&gt;(sentinel_opts);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿æ¥é…ç½®</span></span><br><span class="line">ConnectionOptions conn_opts;</span><br><span class="line">conn_opts.connect_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">100</span>);</span><br><span class="line">conn_opts.socket_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">ConnectionPoolOptions pool_opts;</span><br><span class="line">pool_opts.size = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡ Sentinel åˆ›å»º Redis å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">auto</span> master = <span class="built_in">Redis</span>(sentinel, </span><br><span class="line">        <span class="string">&quot;mymaster&quot;</span>,      <span class="comment">// è¿™æ˜¯åœ¨å“¨å…µé…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„ä¸»èŠ‚ç‚¹åç§°</span></span><br><span class="line">        Role::MASTER,   <span class="comment">// è§’è‰²</span></span><br><span class="line">        conn_opts, </span><br><span class="line">        pool_opts);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†…éƒ¨æœºåˆ¶ï¼š</span></span><br><span class="line"><span class="comment">// 1. Redis å¯¹è±¡æŒæœ‰ Sentinel çš„å¼•ç”¨</span></span><br><span class="line"><span class="comment">// 2. å‘ç°è¿æ¥å¤±æ•ˆæ—¶ï¼Œè°ƒç”¨ Sentinel æŸ¥è¯¢æ–°ä¸»èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">// 3. è‡ªåŠ¨é‡è¿æ–°ä¸»èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">// 4. é‡è¯•å¤±è´¥çš„æ“ä½œ</span></span><br></pre></td></tr></table></figure>
<p><strong>å†…éƒ¨æµç¨‹</strong>ï¼ˆä¼ªä»£ç ï¼‰ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Redis</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::shared_ptr&lt;Sentinel&gt; sentinel_;  <span class="comment">// æŒæœ‰ Sentinel å¼•ç”¨</span></span><br><span class="line">    std::string master_name_;</span><br><span class="line">    Connection* conn_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// é€šè¿‡ Sentinel åˆ›å»º</span></span><br><span class="line">    <span class="built_in">Redis</span>(std::shared_ptr&lt;Sentinel&gt; sentinel, </span><br><span class="line">          <span class="type">const</span> std::string&amp; master_name) </span><br><span class="line">        : <span class="built_in">sentinel_</span>(sentinel), <span class="built_in">master_name_</span>(master_name) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆå§‹è¿æ¥</span></span><br><span class="line">        <span class="keyword">auto</span> [host, port] = sentinel_-&gt;<span class="built_in">getMasterAddr</span>(master_name_);</span><br><span class="line">        conn_ = <span class="built_in">connect</span>(host, port);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å†™æ“ä½œ</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">set</span><span class="params">(<span class="type">const</span> std::string&amp; key, <span class="type">const</span> std::string&amp; value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn_-&gt;<span class="built_in">send</span>(<span class="string">&quot;SET&quot;</span>, key, value);</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="built_in">catch</span> (<span class="type">const</span> ConnectionError&amp; e) &#123;</span><br><span class="line">            <span class="comment">// è¿æ¥å¤±æ•ˆï¼Œè‡ªåŠ¨é‡è¿</span></span><br><span class="line">            <span class="built_in">reconnect</span>();</span><br><span class="line">            <span class="comment">// é‡è¯•æ“ä½œ</span></span><br><span class="line">            conn_-&gt;<span class="built_in">send</span>(<span class="string">&quot;SET&quot;</span>, key, value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è‡ªåŠ¨é‡è¿</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">reconnect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ä» Sentinel æŸ¥è¯¢æ–°ä¸»èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">auto</span> [host, port] = sentinel_-&gt;<span class="built_in">getMasterAddr</span>(master_name_);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é”€æ¯æ—§è¿æ¥</span></span><br><span class="line">        <span class="keyword">delete</span> conn_;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é‡è¿æ–°ä¸»èŠ‚ç‚¹</span></span><br><span class="line">        conn_ = <span class="built_in">connect</span>(host, port);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="4-â€œä¸»ä»å¤åˆ¶æ¨¡å¼â€-vs-â€œå“¨å…µæ¨¡å¼â€">&lt;4&gt;â€œä¸»ä»å¤åˆ¶æ¨¡å¼â€ vs â€œå“¨å…µæ¨¡å¼â€</h4>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260113224050272.png" alt=""></p>
<h2 id="5-æ³¨æ„äº‹é¡¹ï¼ï¼">5.æ³¨æ„äº‹é¡¹ï¼ï¼</h2>
<ul>
<li>
<p>Redis ç±»å¯¹è±¡æ˜¯<strong>çº¿ç¨‹å®‰å…¨</strong>çš„ï¼Œç”Ÿäº§ç¯å¢ƒå¯å…¨å±€å…±äº«ä¸€ä¸ªå®ä¾‹ï¼ˆåŸºäºè¿æ¥æ± å®ç°çº¿ç¨‹éš”ç¦»ï¼‰ï¼Œæ— éœ€æ¯ä¸ªçº¿ç¨‹åˆ›å»ºå•ç‹¬å¯¹è±¡ï¼›</p>
</li>
<li>
<p>æ‰€æœ‰Rediså‘½ä»¤è°ƒç”¨å¯èƒ½ä¼šæŠ›å‡ºsw::redis::Errorå¼‚å¸¸ï¼Œåº”å½“æ•è·å¹¶å¦¥å–„å¤„ç†ï¼ˆå¦‚é‡è¿ã€å‘Šè­¦ã€æ—¥å¿—è®°å½•ç­‰ï¼‰ï¼›</p>
</li>
<li>
<p>å“¨å…µæ¨¡å¼ä¸‹ï¼Œåªéœ€åœ¨ conn_opts.host å¡«å†™ä»»æ„ä¸€ä¸ªå“¨å…µèŠ‚ç‚¹åœ°å€ï¼Œå®¢æˆ·ç«¯ä¼šè‡ªåŠ¨å‘ç°ä¸»ä»èŠ‚ç‚¹ï¼›</p>
</li>
<li>
<p>é¿å…é•¿æ—¶é—´æŒæœ‰ Redis å¯¹è±¡çš„å¼•ç”¨ï¼Œä½¿ç”¨å®Œæ¯•ååŠæ—¶é‡Šæ”¾ï¼Œè®©è¿æ¥æ± å›æ”¶è¿æ¥ã€‚</p>
</li>
</ul>
<p><a id="Sentinel"></a></p>
<h1>äº”ã€Sentinel</h1>
<p>Sentinel ç±»æ˜¯ Redis++ ä¸­ä¸“é—¨ç”¨äºä¸ <strong>Redis Sentinel å“¨å…µé›†ç¾¤</strong> é€šä¿¡çš„ç»„ä»¶ï¼ŒåŠŸèƒ½ï¼š</p>
<ul>
<li>æœåŠ¡å‘ç°
<ul>
<li>ä»å“¨å…µé›†ç¾¤è·å–å½“å‰ä¸»åº“/ä»åº“çš„åœ°å€</li>
</ul>
</li>
<li>æ•…éšœé€æ˜
<ul>
<li>æ•…éšœåˆ‡æ¢æ—¶<strong>è‡ªåŠ¨è·å–æ–°ä¸»åº“åœ°å€</strong></li>
</ul>
</li>
<li>è¿æ¥ä¸­ä»‹
<ul>
<li>ä½œä¸º Redis å¯¹è±¡å’Œå®é™… Redis å®ä¾‹ä¹‹é—´çš„æ¡¥æ¢</li>
</ul>
</li>
</ul>
<h2 id="1-Sentinelç±»çš„èŒè´£">1.Sentinelç±»çš„èŒè´£</h2>
<ul>
<li><strong>ä½¿ç”¨ Role::MASTER</strong>ï¼š
<ul>
<li>redis-plus-plus <strong>æ€»æ˜¯è¿æ¥åˆ°å½“å‰çš„master</strong>ï¼ˆå³ä½¿å‘ç”Ÿæ•…éšœåˆ‡æ¢ï¼‰ã€‚</li>
<li>æ¯æ¬¡ redis-plus-plus éœ€è¦â€œä¸ºmasteråˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥â€ï¼Œæˆ–è€…â€œè¿æ¥æ–­å¼€å¹¶ä¸”éœ€è¦é‡æ–°è¿æ¥åˆ°masterâ€æ—¶
<ul>
<li>redis-plus-plus ä¼šå‘ Redis Sentinel è¯¢é—®masteråœ°å€ï¼Œå¹¶è¿æ¥åˆ°å½“å‰çš„masterã€‚</li>
</ul>
</li>
<li><strong>å‘ç”Ÿæ•…éšœåˆ‡æ¢</strong>
<ul>
<li>redis-plus-plus å¯ä»¥è‡ªåŠ¨è·å–æ–°masterçš„åœ°å€ï¼Œå¹¶<strong>åˆ·æ–°åº•å±‚è¿æ¥æ± ä¸­çš„æ‰€æœ‰è¿åœ°å€æ¥ï¼ˆè¿æ¥åˆ°æ–°çš„masterï¼‰</strong>ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><strong>ä½¿ç”¨ Role::SLAVE</strong>
<ul>
<li>redis-plus-plus <strong>æ€»æ˜¯è¿æ¥åˆ°slave</strong>ã€‚</li>
<li>ä¸€ä¸ªä¸»èŠ‚ç‚¹å¯èƒ½æœ‰å¤šä¸ªslaveï¼Œredis-plus-plus ä¼š<strong>éšæœºé€‰ä¸€ä¸ªå¹¶è¿æ¥åˆ°å®ƒ</strong>
<ul>
<li><strong>åº•å±‚è¿æ¥æ± ä¸­çš„æ‰€æœ‰è¿æ¥éƒ½è¿æ¥åˆ°åŒä¸€ä¸ªslave</strong></li>
</ul>
</li>
<li><strong>å¦‚æœè¿æ¥æ–­å¼€ï¼Œä¸”è¯¥slaveä»ä¸ºæ´»ä½“</strong>
<ul>
<li>redis-plus-plus å°†é‡æ–°è¿æ¥è¯¥ä»å±å®ä¾‹</li>
</ul>
</li>
<li><strong>å¦‚æœè¯¥salveå®•æœºï¼Œæˆ–è€…è¢«æå‡ä¸ºmaster</strong>
<ul>
<li>redis-plus-plus ä¼šéšæœºè¿æ¥åˆ°å¦ä¸€ä¸ªslaveã€‚</li>
<li>å¦‚æœæ²¡æœ‰æ´»ç€çš„slaveï¼Œå®ƒä¼šæŠ›å‡ºä¾‹å¤–ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="2-Sentinelç±»çš„å…³é”®å®ç°ç»†èŠ‚">2.Sentinelç±»çš„å…³é”®å®ç°ç»†èŠ‚</h2>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Sentinel</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Sentinel</span><span class="params">(<span class="type">const</span> SentinelOptions &amp;sentinel_opts)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Sentinel</span>(<span class="type">const</span> Sentinel &amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    Sentinel&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Sentinel &amp;) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Sentinel</span>(Sentinel &amp;&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    Sentinel&amp; <span class="keyword">operator</span>=(Sentinel &amp;&amp;) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">Sentinel</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;ï¼›</span><br></pre></td></tr></table></figure>
<h2 id="3-Sentinel-ç±»çš„ä½¿ç”¨æ–¹å¼">3.Sentinel ç±»çš„ä½¿ç”¨æ–¹å¼</h2>
<p><a href="#SentinelOptions">SentinelOptionsç»“æ„ä½“</a></p>
<h3 id="ï¼ˆ1ï¼‰åˆ›å»º-Sentinel-å¯¹è±¡">ï¼ˆ1ï¼‰åˆ›å»º Sentinel å¯¹è±¡</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sw/redis++/redis++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> sw::redis;</span><br><span class="line"><span class="comment">// é…ç½®å“¨å…µé€‰é¡¹</span></span><br><span class="line">SentinelOptions sentinel_opts;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ã€å¿…éœ€ã€‘å“¨å…µèŠ‚ç‚¹åˆ—è¡¨ï¼ˆè‡³å°‘é…ç½®ä¸€ä¸ªï¼Œå»ºè®®ä¸‰ä¸ªä»¥ä¸Šä¿è¯é«˜å¯ç”¨ï¼‰</span></span><br><span class="line">sentinel_opts.nodes = &#123;</span><br><span class="line">    &#123;<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">26379</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">26380</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">26381</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ã€å¯é€‰ã€‘è¿æ¥å“¨å…µçš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ 100ms â€”â€”&gt;æ³¨ï¼šä¸èƒ½ä¸º0</span></span><br><span class="line">sentinel_opts.connect_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">200</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ã€å¯é€‰ã€‘è¯·æ±‚/å“åº”è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ 100ms  â€”â€”&gt;æ³¨ï¼šä¸èƒ½ä¸º0</span></span><br><span class="line">sentinel_opts.socket_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">200</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»º Sentinel å…±äº«æŒ‡é’ˆï¼ˆå¿…é¡»ç”¨ shared_ptrï¼‰</span></span><br><span class="line"><span class="keyword">auto</span> sentinel = std::<span class="built_in">make_shared</span>&lt;Sentinel&gt;(sentinel_opts);</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰é€šè¿‡-Sentinel-åˆ›å»º-Redis-è¿æ¥">ï¼ˆ2ï¼‰é€šè¿‡ Sentinel åˆ›å»º Redis è¿æ¥</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// =============== 1.åˆ›å»ºå“¨å…µ ===============</span></span><br><span class="line"><span class="comment">// é…ç½®å“¨å…µé€‰é¡¹</span></span><br><span class="line">SentinelOptions sentinel_opts;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ã€å¿…éœ€ã€‘å“¨å…µèŠ‚ç‚¹åˆ—è¡¨ï¼ˆè‡³å°‘é…ç½®ä¸€ä¸ªï¼Œå»ºè®®ä¸‰ä¸ªä»¥ä¸Šä¿è¯é«˜å¯ç”¨ï¼‰</span></span><br><span class="line">sentinel_opts.nodes = &#123;</span><br><span class="line">    &#123;<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">26379</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">26380</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">26381</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ã€å¯é€‰ã€‘è¿æ¥å“¨å…µçš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ 100ms â€”â€”&gt;æ³¨ï¼šä¸èƒ½ä¸º0</span></span><br><span class="line">sentinel_opts.connect_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">200</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ã€å¯é€‰ã€‘è¯·æ±‚/å“åº”è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ 100ms  â€”â€”&gt;æ³¨ï¼šä¸èƒ½ä¸º0</span></span><br><span class="line">sentinel_opts.socket_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">200</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»º Sentinel å…±äº«æŒ‡é’ˆï¼ˆå¿…é¡»ç”¨ shared_ptrï¼‰</span></span><br><span class="line"><span class="keyword">auto</span> sentinel = std::<span class="built_in">make_shared</span>&lt;Sentinel&gt;(sentinel_opts);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// =============== 2.åˆ›å»ºRedisè¿æ¥é…ç½® ===============</span></span><br><span class="line"><span class="comment">// è¿æ¥é…ç½®</span></span><br><span class="line">ConnectionOptions conn_opts;</span><br><span class="line">conn_opts.host = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">conn_opts.port = <span class="number">6379</span>;</span><br><span class="line">conn_opts.connect_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">100</span>);   <span class="comment">// å¿…é¡»è®¾ç½®ï¼ä¸èƒ½ä¸º 0</span></span><br><span class="line">conn_opts.socket_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">100</span>);    <span class="comment">// å¿…é¡»è®¾ç½®ï¼ä¸èƒ½ä¸º 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿æ¥æ± é…ç½®</span></span><br><span class="line">ConnectionPoolOptions pool_opts;</span><br><span class="line">pool_opts.size = <span class="number">5</span>;  <span class="comment">// è¿æ¥æ± å¤§å°ï¼š5ä¸ªè¿æ¥</span></span><br><span class="line">pool_opts.wait_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">100</span>);  <span class="comment">// ç­‰å¾…è¿æ¥è¶…æ—¶</span></span><br><span class="line">pool_opts.connection_lifetime = std::chrono::<span class="built_in">minutes</span>(<span class="number">10</span>); <span class="comment">// è¿æ¥ç”Ÿå‘½å‘¨æœŸ</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// =============== 3.åˆ›å»ºRedisä¸»èŠ‚ç‚¹ ===============</span></span><br><span class="line"><span class="comment">// åˆ›å»ºè¿æ¥ä¸»åº“çš„ Redis å¯¹è±¡</span></span><br><span class="line"><span class="keyword">auto</span> master = <span class="built_in">Redis</span>(sentinel,</span><br><span class="line">                    <span class="string">&quot;mymaster&quot;</span>,	 	<span class="comment">// Name of master node</span></span><br><span class="line">                    Role::MASTER, 	<span class="comment">// è§’è‰²</span></span><br><span class="line">                    conn_opts, </span><br><span class="line">                    pool_opts);</span><br><span class="line"></span><br><span class="line"><span class="comment">// =============== 3.åˆ›å»ºRedisä»èŠ‚ç‚¹ ===============</span></span><br><span class="line"><span class="comment">// åˆ›å»ºè¿æ¥ä»åº“çš„ Redis å¯¹è±¡</span></span><br><span class="line"><span class="keyword">auto</span> slave = <span class="built_in">Redis</span>(sentinel, </span><br><span class="line">                   <span class="string">&quot;mymaster&quot;</span>,		<span class="comment">// Name of master node </span></span><br><span class="line">                   Role::SLAVE, 	<span class="comment">// è§’è‰²</span></span><br><span class="line">                   conn_opts, </span><br><span class="line">                   pool_opts);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>ä¸éœ€è¦æ‰‹åŠ¨æŒ‡å®šâ€œä¸»èŠ‚ç‚¹/ä»èŠ‚ç‚¹â€çš„ipï¼šport</strong>ï¼Œç”±Sentinelè‡ªåŠ¨åˆ†é…</li>
</ul>
<h1>å…­ã€RedisClusterï¼ˆé›†ç¾¤æ¨¡å¼å®¢æˆ·ç«¯ï¼‰</h1>
<ul>
<li>RedisClusterç±»æ˜¯é›†ç¾¤æ¨¡å¼ä¸‹â€œå®¢æˆ·ç«¯â€è¿æ¥â€œæœåŠ¡ç«¯â€çš„å¥æŸ„ï¼Œå‘æœåŠ¡ç«¯å‘é€è¯·æ±‚
<ul>
<li>redis-plus-plus å®¢æˆ·ç«¯åº“<strong>ä¸è´Ÿè´£åˆ›å»ºé›†ç¾¤</strong>ï¼Œå®ƒåªè´Ÿè´£<strong>è¿æ¥åˆ°å·²å­˜åœ¨çš„é›†ç¾¤</strong>ã€‚</li>
</ul>
</li>
<li><strong>æ¥å£ä¸ Redis ç±»ç±»ä¼¼ï¼ï¼</strong></li>
</ul>
<h2 id="1-RedisClusterç±»-çš„æ„é€ ">1.RedisClusterç±» çš„æ„é€ </h2>
<h3 id="ï¼ˆ1ï¼‰æ„é€ å‡½æ•°">ï¼ˆ1ï¼‰æ„é€ å‡½æ•°</h3>
<h4 id="1-åŸºæœ¬æ„é€ å‡½æ•°">&lt;1&gt;åŸºæœ¬æ„é€ å‡½æ•°</h4>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="built_in">RedisCluster</span>(<span class="type">const</span> ConnectionOptions &amp;connection_opts,</span><br><span class="line">             <span class="type">const</span> ConnectionPoolOptions &amp;pool_opts = &#123;&#125;,    <span class="comment">//é»˜è®¤ä¸ºæ¯ä¸ªä¸»èŠ‚ç‚¹ç»´æŠ¤å•ä¸€è¿æ¥</span></span><br><span class="line">             Role role = Role::MASTER,</span><br><span class="line">             <span class="type">const</span> ClusterOptions &amp;cluster_opts = &#123;&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260113163903839.png" alt=""></p>
<h4 id="2-URLæ„é€ å‡½æ•°">&lt;2&gt;URLæ„é€ å‡½æ•°</h4>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å¦‚ï¼š &quot;tcp://127.0.0.1&quot; or &quot;tcp://127.0.0.1:6379&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">explicit</span> <span class="title">RedisCluster</span><span class="params">(<span class="type">const</span> std::string &amp;uri)</span></span>;</span><br></pre></td></tr></table></figure>
<p><strong>é™åˆ¶</strong>ï¼š</p>
<ul>
<li>âŒ æ— æ³•æŒ‡å®šå¯†ç </li>
<li>âŒ åªèƒ½ä½¿ç”¨é»˜è®¤è¿æ¥æ± é…ç½®ï¼ˆsize=1ï¼‰</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰é…ç½®é€‰é¡¹">ï¼ˆ2ï¼‰é…ç½®é€‰é¡¹</h3>
<h4 id="1-ConnectionOptionsï¼ˆè¿æ¥é…ç½®ï¼‰">&lt;1&gt;ConnectionOptionsï¼ˆè¿æ¥é…ç½®ï¼‰</h4>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">ConnectionOptions connection_options;</span><br><span class="line">connection_options.host = <span class="string">&quot;127.0.0.1&quot;</span>;  <span class="comment">// å¿…éœ€ï¼šä»»æ„ä¸€ä¸ªä¸»èŠ‚ç‚¹</span></span><br><span class="line">connection_options.port = <span class="number">7000</span>;         <span class="comment">// å¯é€‰ï¼šé»˜è®¤ 6379</span></span><br><span class="line">connection_options.password = <span class="string">&quot;auth&quot;</span>;   <span class="comment">// å¯é€‰ï¼šé›†ç¾¤å¯†ç ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ç›¸åŒï¼‰</span></span><br><span class="line">connection_options.connect_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">100</span>);</span><br><span class="line">connection_options.socket_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">100</span>);</span><br><span class="line">connection_options.keep_alive = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ é›†ç¾¤æ¨¡å¼ä¸‹è¢«å¿½ç•¥</span></span><br><span class="line">connection_options.db = <span class="number">0</span>;  <span class="comment">// Redis Cluster ä¸æ”¯æŒå¤šæ•°æ®åº“</span></span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</p>
<ul>
<li>
<p>âš ï¸ åªèƒ½ä½¿ç”¨ TCP è¿æ¥ï¼Œ<strong>ä¸æ”¯æŒ Unix Domain Socket</strong></p>
</li>
<li>
<p>âš ï¸ æ‰€æœ‰èŠ‚ç‚¹<strong>å¿…é¡»ä½¿ç”¨ç›¸åŒçš„å¯†ç </strong></p>
</li>
<li>
<p>âš ï¸ db å‚æ•°è¢«å¿½ç•¥ï¼ˆé›†ç¾¤ä¸æ”¯æŒå¤šæ•°æ®åº“ï¼‰</p>
</li>
</ul>
<p><strong>è‡ªåŠ¨å‘ç°æœºåˆ¶</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åªéœ€é…ç½®ä¸€ä¸ªä¸»èŠ‚ç‚¹</span><br><span class="line">        â”‚</span><br><span class="line">        â–¼</span><br><span class="line">RedisCluster å‘é€ CLUSTER SLOTS å‘½ä»¤</span><br><span class="line">        â”‚</span><br><span class="line">        â–¼</span><br><span class="line">è‡ªåŠ¨è·å–æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯å¹¶å»ºç«‹è¿æ¥</span><br></pre></td></tr></table></figure>
<h4 id="2-ConnectionPoolOptionsï¼ˆè¿æ¥æ± é…ç½®ï¼‰">&lt;2&gt;ConnectionPoolOptionsï¼ˆè¿æ¥æ± é…ç½®ï¼‰</h4>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">ConnectionPoolOptions pool_options;</span><br><span class="line">pool_options.size = <span class="number">3</span>;  <span class="comment">// æ¯ä¸ªèŠ‚ç‚¹çš„è¿æ¥æ•°</span></span><br><span class="line">pool_options.wait_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">100</span>);</span><br><span class="line">pool_options.connection_lifetime = std::chrono::<span class="built_in">minutes</span>(<span class="number">10</span>);</span><br><span class="line">pool_options.connection_idle_time = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<p><strong>å·¥ä½œåŸç†</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å‡è®¾é›†ç¾¤æœ‰ 3 ä¸ªä¸»èŠ‚ç‚¹ï¼Œä¸”pool_options.size = 3</span><br><span class="line"></span><br><span class="line">èŠ‚ç‚¹1 (127.0.0.1:7000) â†’ è¿æ¥æ±  [conn1, conn2, conn3]</span><br><span class="line">èŠ‚ç‚¹2 (127.0.0.1:7001) â†’ è¿æ¥æ±  [conn1, conn2, conn3]</span><br><span class="line">èŠ‚ç‚¹3 (127.0.0.1:7002) â†’ è¿æ¥æ±  [conn1, conn2, conn3]</span><br><span class="line"></span><br><span class="line">æ€»è¿æ¥æ•° = 3 èŠ‚ç‚¹ Ã— 3 è¿æ¥ = 9 ä¸ªè¿æ¥</span><br></pre></td></tr></table></figure>
<h4 id="3-ClusterOptionsï¼ˆé›†ç¾¤é…ç½®ï¼‰">&lt;3&gt;ClusterOptionsï¼ˆé›†ç¾¤é…ç½®ï¼‰</h4>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ClusterOptions</span> &#123;</span><br><span class="line">    <span class="comment">//åˆ·æ–°â€œæ§½ä½-èŠ‚ç‚¹â€æ˜ å°„çš„æ—¶é—´</span></span><br><span class="line">    std::chrono::milliseconds slot_map_refresh_interval = std::chrono::<span class="built_in">seconds</span>(<span class="number">10</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>ä½œç”¨</strong>ï¼š</p>
<ul>
<li>
<p>ğŸ”„ å®šæœŸåˆ·æ–°æ§½ä½-èŠ‚ç‚¹æ˜ å°„ï¼ˆé»˜è®¤ 10 ç§’ï¼‰</p>
</li>
<li>
<p>ğŸ”„ åŒæ—¶åˆ·æ–°èŠ‚ç‚¹åˆ—è¡¨ï¼ˆè‡ªåŠ¨å‘ç°æ–°èŠ‚ç‚¹/ç§»é™¤ä¸‹çº¿èŠ‚ç‚¹ï¼‰</p>
</li>
</ul>
<p><strong>åˆ·æ–°è§¦å‘æ¡ä»¶</strong>ï¼š</p>
<ol>
<li>
<p>å®šæ—¶åˆ·æ–°ï¼šæ¯ 10 ç§’ï¼ˆå¯é…ç½®ï¼‰</p>
</li>
<li>
<p>é”™è¯¯è§¦å‘ï¼šæ”¶åˆ° MOVED/ASK é‡å®šå‘æ—¶ç«‹å³åˆ·æ–°</p>
</li>
</ol>
<h3 id="ï¼ˆ3ï¼‰åˆ›å»ºå®ä¾‹çš„æ–¹å¼">ï¼ˆ3ï¼‰åˆ›å»ºå®ä¾‹çš„æ–¹å¼</h3>
<h4 id="1-ä½¿ç”¨-URIï¼ˆæœ€ç®€å•ï¼‰">&lt;1&gt;ä½¿ç”¨ URIï¼ˆæœ€ç®€å•ï¼‰</h4>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sw/redis++/redis++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åªæŒ‡å®šä¸€ä¸ªèŠ‚ç‚¹ï¼Œè‡ªåŠ¨å‘ç°å…¶ä»–èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">auto</span> redis = sw::redis::<span class="built_in">RedisCluster</span>(<span class="string">&quot;tcp://127.0.0.1:7000&quot;</span>);</span><br><span class="line"></span><br><span class="line">redis.<span class="built_in">set</span>(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>);</span><br></pre></td></tr></table></figure>
<p><strong>ä¼˜ç‚¹</strong>ï¼šä»£ç ç®€æ´<br>
<strong>ç¼ºç‚¹</strong>ï¼šæ— æ³•é…ç½®å¯†ç ã€è¿æ¥æ± å¤§å°</p>
<h4 id="2-æ ‡å‡†é…ç½®ï¼ˆæ¨èï¼‰">&lt;2&gt;æ ‡å‡†é…ç½®ï¼ˆæ¨èï¼‰</h4>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> sw::redis;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. è¿æ¥é…ç½®ï¼ˆä»»æ„ä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼‰</span></span><br><span class="line">ConnectionOptions conn_opts;</span><br><span class="line">conn_opts.host = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">conn_opts.port = <span class="number">7000</span>;</span><br><span class="line">conn_opts.password = <span class="string">&quot;your_password&quot;</span>;</span><br><span class="line">conn_opts.connect_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">100</span>);</span><br><span class="line">conn_opts.socket_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. è¿æ¥æ± é…ç½®ï¼ˆæ¯ä¸ªèŠ‚ç‚¹ 3 ä¸ªè¿æ¥ï¼‰</span></span><br><span class="line">ConnectionPoolOptions pool_opts;</span><br><span class="line">pool_opts.size = <span class="number">3</span>;</span><br><span class="line">pool_opts.wait_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. åˆ›å»º RedisCluster</span></span><br><span class="line"><span class="keyword">auto</span> redis = <span class="built_in">RedisCluster</span>(conn_opts, pool_opts);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line">redis.<span class="built_in">set</span>(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line"><span class="keyword">auto</span> val = redis.<span class="built_in">get</span>(<span class="string">&quot;key&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="3-å®Œæ•´é…ç½®">&lt;3&gt;å®Œæ•´é…ç½®</h4>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">ConnectionOptions conn_opts;</span><br><span class="line">conn_opts.host = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">conn_opts.port = <span class="number">7000</span>;</span><br><span class="line">conn_opts.password = <span class="string">&quot;your_password&quot;</span>;</span><br><span class="line"></span><br><span class="line">ConnectionPoolOptions pool_opts;</span><br><span class="line">pool_opts.size = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">ClusterOptions cluster_opts;</span><br><span class="line">cluster_opts.slot_map_refresh_interval = std::chrono::<span class="built_in">seconds</span>(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> redis = <span class="built_in">RedisCluster</span>(</span><br><span class="line">    conn_opts, </span><br><span class="line">    pool_opts, </span><br><span class="line">    Role::MASTER,      <span class="comment">// è®¿é—®ä¸»èŠ‚ç‚¹</span></span><br><span class="line">    cluster_opts</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h2 id="2-RedisClusterçš„è¿æ¥æœºåˆ¶">2.RedisClusterçš„è¿æ¥æœºåˆ¶</h2>
<h3 id="ï¼ˆ1ï¼‰Role-MASTER-æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰">ï¼ˆ1ï¼‰Role::MASTER æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> redis = <span class="built_in">RedisCluster</span>(conn_opts, pool_opts, Role::MASTER);</span><br></pre></td></tr></table></figure>
<h4 id="1-è¿æ¥æ‹“æ‰‘ï¼ˆè¿æ¥æ‰€æœ‰ä¸»èŠ‚ç‚¹ï¼‰">&lt;1&gt;è¿æ¥æ‹“æ‰‘ï¼ˆè¿æ¥æ‰€æœ‰ä¸»èŠ‚ç‚¹ï¼‰</h4>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">Redis é›†ç¾¤ï¼š</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚ ä¸»èŠ‚ç‚¹1 â”‚     â”‚ ä¸»èŠ‚ç‚¹2 â”‚     â”‚ ä¸»èŠ‚ç‚¹3 â”‚</span><br><span class="line">â”‚  :7000  â”‚     â”‚  :7001  â”‚     â”‚  :7002  â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜</span><br><span class="line"><span class="code">     â”‚               â”‚               â”‚</span></span><br><span class="line"><span class="code">   ä»èŠ‚ç‚¹         ä»èŠ‚ç‚¹          ä»èŠ‚ç‚¹</span></span><br><span class="line"><span class="code">   :7003          :7004          :7005</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">å®¢æˆ·ç«¯è¿æ¥ï¼š</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚ å®¢æˆ·ç«¯   â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜</span><br><span class="line"><span class="code">     â”œâ”€â”€â”€â”€â”€ç›´è¿â”€â”€â”€â”€â”€â†’ ä¸»èŠ‚ç‚¹1 (:7000) [è¿æ¥æ±  3ä¸ªè¿æ¥]</span></span><br><span class="line"><span class="code">     â”œâ”€â”€â”€â”€â”€ç›´è¿â”€â”€â”€â”€â”€â†’ ä¸»èŠ‚ç‚¹2 (:7001) [è¿æ¥æ±  3ä¸ªè¿æ¥]</span></span><br><span class="line"><span class="code">     â””â”€â”€â”€â”€â”€ç›´è¿â”€â”€â”€â”€â”€â†’ ä¸»èŠ‚ç‚¹3 (:7002) [è¿æ¥æ±  3ä¸ªè¿æ¥]</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>æ³¨æ„</strong>ï¼šRole::MASTER è¿æ¥<strong>æ‰€æœ‰</strong>ä¸»èŠ‚ç‚¹ï¼ï¼</li>
</ul>
<h4 id="2-ä¸ºä»€ä¹ˆ-Role-MASTER-è¦è¿æ¥æ‰€æœ‰ä¸»èŠ‚ç‚¹ï¼Ÿ">&lt;2&gt;ä¸ºä»€ä¹ˆ Role::MASTER è¦è¿æ¥æ‰€æœ‰ä¸»èŠ‚ç‚¹ï¼Ÿ</h4>
<ul>
<li><strong>redisé›†ç¾¤æ˜¯å¯¹redisçš„æ°´å¹³æ‰©å®¹</strong>ï¼š
<ul>
<li>å³å¯åŠ¨Nä¸ªredisèŠ‚ç‚¹ï¼Œå°†æ•´ä¸ªæ•°æ®åˆ†å¸ƒå­˜å‚¨åœ¨è¿™ä¸ª<strong>Nä¸ªèŠ‚ç‚¹</strong>ä¸­ï¼Œæ¯ä¸ªèŠ‚<br>
ç‚¹<strong>å­˜å‚¨æ€»æ•°æ®çš„1/N</strong></li>
</ul>
</li>
</ul>
<h5 id="åŸå› 1ï¼šæ•°æ®åˆ†ç‰‡å­˜å‚¨">åŸå› 1ï¼šæ•°æ®åˆ†ç‰‡å­˜å‚¨</h5>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114091913625.png" alt=""><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114091947050.png" alt=""></p>
<h5 id="åŸå› 2ï¼šå†™æ“ä½œå¿…é¡»åˆ°ä¸»èŠ‚ç‚¹">åŸå› 2ï¼šå†™æ“ä½œå¿…é¡»åˆ°ä¸»èŠ‚ç‚¹</h5>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114092102449.png" alt=""></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å•ä¸»èŠ‚ç‚¹è®¾è®¡ï¼š</span><br><span class="line">è¯·æ±‚ â†’ ä¸»èŠ‚ç‚¹1 â†’ MOVED â†’ é‡å®šå‘ â†’ ä¸»èŠ‚ç‚¹2/3</span><br><span class="line">           â†“ æ¯æ¬¡éƒ½è¦é‡å®šå‘</span><br><span class="line">      æ€§èƒ½æŸå¤±ï¼šé¢å¤–çš„ç½‘ç»œå¾€è¿”</span><br><span class="line"></span><br><span class="line">å¤šä¸»èŠ‚ç‚¹è®¾è®¡ï¼š</span><br><span class="line">è¯·æ±‚ â†’ è®¡ç®—æ§½ä½ â†’ ç›´æ¥æ‰¾åˆ°æ­£ç¡®èŠ‚ç‚¹ â†’ ç«‹å³è¿”å›</span><br><span class="line">           â†“ é›¶é‡å®šå‘</span><br><span class="line">      æ€§èƒ½æœ€ä¼˜ï¼šä¸€æ¬¡ç½‘ç»œå¾€è¿”</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰Role-SLAVE-æ¨¡å¼ï¼ˆè¿æ¥æ¯ä¸ªä¸»èŠ‚ç‚¹çš„ä¸€ä¸ªéšæœºä»èŠ‚ç‚¹ï¼‰">ï¼ˆ2ï¼‰Role::SLAVE æ¨¡å¼ï¼ˆè¿æ¥æ¯ä¸ªä¸»èŠ‚ç‚¹çš„ä¸€ä¸ªéšæœºä»èŠ‚ç‚¹ï¼‰</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> redis = <span class="built_in">RedisCluster</span>(conn_opts, pool_opts, Role::SLAVE);</span><br></pre></td></tr></table></figure>
<h4 id="1-è¿æ¥æ‹“æ‰‘">&lt;1&gt;è¿æ¥æ‹“æ‰‘</h4>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">Redis é›†ç¾¤ï¼š</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚ ä¸»èŠ‚ç‚¹1 â”‚     â”‚ ä¸»èŠ‚ç‚¹2 â”‚     â”‚ ä¸»èŠ‚ç‚¹3 â”‚</span><br><span class="line">â”‚  :7000  â”‚     â”‚  :7001  â”‚     â”‚  :7002  â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜</span><br><span class="line"><span class="code">     â”‚               â”‚               â”‚</span></span><br><span class="line"><span class="code">   ä»èŠ‚ç‚¹1a        ä»èŠ‚ç‚¹2a        ä»èŠ‚ç‚¹3a</span></span><br><span class="line"><span class="code">   :7003          :7004          :7005</span></span><br><span class="line"><span class="code">     â”‚               â”‚</span></span><br><span class="line"><span class="code">   ä»èŠ‚ç‚¹1b        ä»èŠ‚ç‚¹2b</span></span><br><span class="line"><span class="code">   :7006          :7007</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">å®¢æˆ·ç«¯è¿æ¥ï¼ˆRole::SLAVE æ¨¡å¼ï¼‰ï¼š</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚ å®¢æˆ·ç«¯   â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜</span><br><span class="line"><span class="code">     â”œâ”€â”€â”€â”€â”€ç›´è¿â”€â”€â”€â”€â”€â†’ ä»èŠ‚ç‚¹1a (:7003) [è¿æ¥æ±  3ä¸ªè¿æ¥]</span></span><br><span class="line"><span class="code">     â”‚                â†‘ éšæœºé€‰æ‹©ä¸»èŠ‚ç‚¹1çš„ä¸€ä¸ªä»èŠ‚ç‚¹</span></span><br><span class="line"><span class="code">     â”‚</span></span><br><span class="line"><span class="code">     â”œâ”€â”€â”€â”€â”€ç›´è¿â”€â”€â”€â”€â”€â†’ ä»èŠ‚ç‚¹2a (:7004) [è¿æ¥æ±  3ä¸ªè¿æ¥]</span></span><br><span class="line"><span class="code">     â”‚                â†‘ éšæœºé€‰æ‹©ä¸»èŠ‚ç‚¹2çš„ä¸€ä¸ªä»èŠ‚ç‚¹</span></span><br><span class="line"><span class="code">     â”‚</span></span><br><span class="line"><span class="code">     â””â”€â”€â”€â”€â”€ç›´è¿â”€â”€â”€â”€â”€â†’ ä»èŠ‚ç‚¹3a (:7005) [è¿æ¥æ±  3ä¸ªè¿æ¥]</span></span><br><span class="line"><span class="code">                      â†‘ éšæœºé€‰æ‹©ä¸»èŠ‚ç‚¹3çš„ä¸€ä¸ªä»èŠ‚ç‚¹</span></span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„</strong>ï¼šRole::SLAVE è¿æ¥æ¯ä¸ªä¸»èŠ‚ç‚¹çš„ä¸€ä¸ªéšæœºä»èŠ‚ç‚¹</p>
<h4 id="2-ä¸ºä»€ä¹ˆ-Role-SLAVE-è¦è¿æ¥æ¯ä¸ªä¸»èŠ‚ç‚¹çš„ä¸€ä¸ªéšæœºä»èŠ‚ç‚¹ï¼Ÿ">&lt;2&gt;ä¸ºä»€ä¹ˆ Role::SLAVE è¦è¿æ¥æ¯ä¸ªä¸»èŠ‚ç‚¹çš„ä¸€ä¸ªéšæœºä»èŠ‚ç‚¹ï¼Ÿ</h4>
<h5 id="åŸå› 1-ä¿æŒæ§½ä½è¦†ç›–">åŸå› 1:ä¿æŒæ§½ä½è¦†ç›–</h5>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114092349865.png" alt=""></p>
<h5 id="åŸå› 2ï¼šè´Ÿè½½å‡è¡¡">åŸå› 2ï¼šè´Ÿè½½å‡è¡¡</h5>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114092417497.png" alt=""></p>
<h5 id="ä¸ºä»€ä¹ˆä¸æ˜¯æ‰€æœ‰ä»èŠ‚ç‚¹ï¼Ÿ">ä¸ºä»€ä¹ˆä¸æ˜¯æ‰€æœ‰ä»èŠ‚ç‚¹ï¼Ÿ</h5>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114092451027.png" alt=""></p>
<h3 id="ï¼ˆ3ï¼‰â€œRole-MASTER-æ¨¡å¼â€-vs-â€œRole-SLAVE-æ¨¡å¼â€">ï¼ˆ3ï¼‰â€œRole::MASTER æ¨¡å¼â€ vs â€œRole::SLAVE æ¨¡å¼â€</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114091249622.png" alt=""></p>
<h3 id="ï¼ˆ4ï¼‰å¸¸è§è¯¯è§£">ï¼ˆ4ï¼‰å¸¸è§è¯¯è§£</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114091358906.png" alt=""></p>
<h2 id="3-RedisClusterç±»çš„æ³¨æ„äº‹é¡¹">3.RedisClusterç±»çš„æ³¨æ„äº‹é¡¹</h2>
<h3 id="ï¼ˆ1ï¼‰æ— æ³•ç›´æ¥å‘é€â€œæ— keyå‚æ•°çš„å‘½ä»¤â€">ï¼ˆ1ï¼‰æ— æ³•ç›´æ¥å‘é€â€œæ— keyå‚æ•°çš„å‘½ä»¤â€</h3>
<p>RedisCluster å¯¹è±¡ç¡®å®å¯ä»¥å‘é€å¤§å¤šæ•°è¯·æ±‚ï¼Œä½†â€œkeyå‚æ•°å‘½ä»¤â€æ— æ³•ç›´æ¥å‘é€</p>
<h4 id="1-é—®é¢˜">&lt;1&gt;é—®é¢˜</h4>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114093548922.png" alt=""></p>
<h4 id="2-è§£å†³æ–¹æ¡ˆ">&lt;2&gt;è§£å†³æ–¹æ¡ˆ</h4>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114093630371.png" alt=""></p>
<h4 id="3-â€œRedisClusterâ€-vs-â€œRedisCluster-redis-â€">&lt;3&gt;â€œRedisClusterâ€ vs â€œRedisCluster::redis()â€</h4>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114093926722.png" alt=""><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114093942338.png" alt=""></p>
<p><strong>æ³¨æ„</strong>ï¼š</p>
<ul>
<li>RedisCluster::redis() è¿”å›çš„ Redis å¯¹è±¡ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„</li>
<li>ä¸€æ—¦æŠ›å‡ºå¼‚å¸¸ï¼Œå¿…é¡»é”€æ¯å¹¶é‡æ–°åˆ›å»º</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âš ï¸ é‡è¦ï¼šè¿”å›çš„ Redis å¯¹è±¡ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼</span></span><br><span class="line"><span class="keyword">auto</span> r = redis_cluster.<span class="built_in">redis</span>(<span class="string">&quot;hash-tag&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// âš ï¸ å¦‚æœæŠ›å‡ºå¼‚å¸¸ï¼Œå¿…é¡»é”€æ¯å¹¶é‡æ–°åˆ›å»º</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    r.<span class="built_in">command</span>(<span class="string">&quot;client&quot;</span>, <span class="string">&quot;setname&quot;</span>, <span class="string">&quot;name&quot;</span>);</span><br><span class="line">&#125; <span class="built_in">catch</span> (<span class="type">const</span> Error&amp; e) &#123;</span><br><span class="line">    <span class="comment">// r ä¸å†å¯ç”¨ï¼Œå¿…é¡»é‡å»º</span></span><br><span class="line">    r = redis_cluster.<span class="built_in">redis</span>(<span class="string">&quot;hash-tag&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>ä¸ƒã€Redis++ å‘½ä»¤çš„å‘é€</h1>
<h2 id="1-å‘½ä»¤è°ƒç”¨æ–¹å¼">1.å‘½ä»¤è°ƒç”¨æ–¹å¼</h2>
<p>Redis++ ä¸ºæ¯ä¸ª Redis å‘½ä»¤æä¾›åŒåï¼ˆå°å†™ï¼‰æ–¹æ³•ï¼Œæ”¯æŒå¤šç§é‡è½½ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// DEL å‘½ä»¤çš„ 3 ç§é‡è½½</span></span><br><span class="line"><span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">Redis::del</span><span class="params">(<span class="type">const</span> StringView &amp;key)</span></span>;                    <span class="comment">// å•ä¸ª key</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Input&gt;</span><br><span class="line"><span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">Redis::del</span><span class="params">(Input first, Input last)</span></span>;                  <span class="comment">// è¿­ä»£å™¨èŒƒå›´</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">Redis::del</span><span class="params">(std::initializer_list&lt;T&gt; il)</span></span>;              <span class="comment">// åˆå§‹åŒ–åˆ—è¡¨</span></span><br></pre></td></tr></table></figure>
<h2 id="2-å‚æ•°ç±»å‹è¯¦è§£">2.å‚æ•°ç±»å‹è¯¦è§£</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114102612093.png" alt=""></p>
<p><strong>StringView è¯¦è§£</strong>:<br>
- C++17 ä¸‹ StringView å°±æ˜¯ <strong>std::string_view</strong> çš„åˆ«å</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// StringView å…¼å®¹å¤šç§å­—ç¬¦ä¸²ç±»å‹</span></span><br><span class="line">redis.<span class="built_in">set</span>(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>);                          <span class="comment">// C é£æ ¼å­—ç¬¦ä¸²</span></span><br><span class="line"></span><br><span class="line">std::string key = <span class="string">&quot;key&quot;</span>, val = <span class="string">&quot;value&quot;</span>;</span><br><span class="line">redis.<span class="built_in">set</span>(key, val);                                <span class="comment">// std::string</span></span><br><span class="line"></span><br><span class="line">std::vector&lt;<span class="type">char</span>&gt; data = &#123;...&#125;;</span><br><span class="line">redis.<span class="built_in">set</span>(<span class="string">&quot;key&quot;</span>, <span class="built_in">StringView</span>(data.<span class="built_in">data</span>(), data.<span class="built_in">size</span>()));  <span class="comment">// é¿å…æ‹·è´å¤§æ•°æ®</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="3-è¿”å›å€¼è¯¦è§£">3.è¿”å›å€¼è¯¦è§£</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114102827965.png" alt=""></p>
<h2 id="4-bool-è¿”å›å€¼">4.bool è¿”å›å€¼</h2>
<ul>
<li>æŸäº›æ–¹æ³•çš„è¿”å›ç±»å‹ä¸ºboolï¼Œä¾‹å¦‚ EXPIREã€HSET</li>
<li><strong>åƒä¸‡ä¸è¦ç”¨è¿”å›å€¼æ¥æ£€æŸ¥å‘½ä»¤æ˜¯å¦æˆåŠŸå‘é€åˆ° Redis æœåŠ¡å™¨ï¼ï¼</strong>ï¼š
<ul>
<li><strong>å¦‚æœæ–¹æ³•è¿”å› false</strong>ï¼š
<ul>
<li>å¹¶ä¸æ„å‘³ç€ Redis æœªèƒ½å°†å‘½ä»¤å‘é€åˆ°æœåŠ¡å™¨ã€‚ç›¸åï¼Œè¿™æ„å‘³ç€ Redis æœåŠ¡å™¨è¿”å›ä¸€ä¸ªæ•´æ•°å›å¤ ï¼Œä¸”å›å¤å€¼ä¸º 0ã€‚</li>
</ul>
</li>
<li><strong>å¦‚æœæ–¹æ³•è¿”å›ä¸ºçœŸ</strong>ï¼š
<ul>
<li>æ„å‘³ç€ Redis æœåŠ¡å™¨è¿”å›çš„æ˜¯æ•´æ•°å›å¤ ï¼Œä¸”å›å¤å€¼ä¸º 1</li>
</ul>
</li>
</ul>
</li>
<li>å¦‚æœ Redis æœªèƒ½å‘æœåŠ¡å™¨å‘é€å‘½ä»¤ï¼Œå°±<strong>ä¼šæŠ›å‡º Error ç±»å‹çš„å¼‚å¸¸</strong></li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âš ï¸ é‡è¦ï¼šbool è¿”å›å€¼ä¸ä»£è¡¨å‘½ä»¤æ˜¯å¦å‘é€æˆåŠŸï¼</span></span><br><span class="line"><span class="comment">// true  = Redis è¿”å›æ•´æ•° 1</span></span><br><span class="line"><span class="comment">// false = Redis è¿”å›æ•´æ•° 0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (redis.<span class="built_in">expire</span>(<span class="string">&quot;key&quot;</span>, <span class="built_in">seconds</span>(<span class="number">100</span>))) &#123;</span><br><span class="line">    <span class="comment">// è¿”å› 1ï¼šè¶…æ—¶è®¾ç½®æˆåŠŸ</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// è¿”å› 0ï¼škey ä¸å­˜åœ¨ï¼ˆä¸æ˜¯å‘é€å¤±è´¥ï¼ï¼‰</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (redis.<span class="built_in">setnx</span>(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;val&quot;</span>)) &#123;</span><br><span class="line">    <span class="comment">// è¿”å› 1ï¼škey ä¸å­˜åœ¨ï¼Œè®¾ç½®æˆåŠŸ</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// è¿”å› 0ï¼škey å·²å­˜åœ¨ï¼Œè®¾ç½®å¤±è´¥</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ğŸ’¡ å‘½ä»¤å‘é€å¤±è´¥ä¼šæŠ›å¼‚å¸¸ï¼Œä¸ä¼šè¿”å› false</span></span><br></pre></td></tr></table></figure>
<h2 id="5-Optional-å¤„ç†-NULL-å›å¤">5.Optional å¤„ç† NULL å›å¤</h2>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// GET å¯èƒ½è¿”å› NULLï¼ˆkey ä¸å­˜åœ¨ï¼‰</span></span><br><span class="line">OptionalString val = redis.<span class="built_in">get</span>(<span class="string">&quot;key&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (val) &#123;</span><br><span class="line">    std::cout &lt;&lt; *val &lt;&lt; std::endl;       <span class="comment">// è§£å¼•ç”¨è·å–å€¼</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;key ä¸å­˜åœ¨&quot;</span> &lt;&lt; std::endl; <span class="comment">// NULL å›å¤</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MGET è¿”å›å¤šä¸ª Optional</span></span><br><span class="line">std::vector&lt;OptionalString&gt; values;</span><br><span class="line">redis.<span class="built_in">mget</span>(&#123;<span class="string">&quot;k1&quot;</span>, <span class="string">&quot;k2&quot;</span>, <span class="string">&quot;k3&quot;</span>&#125;, std::<span class="built_in">back_inserter</span>(values));</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; v : values) &#123;</span><br><span class="line">    <span class="keyword">if</span> (v) &#123;</span><br><span class="line">        std::cout &lt;&lt; *v &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¸¸ç”¨ Optional ç±»å‹åˆ«å</span></span><br><span class="line"><span class="keyword">using</span> OptionalString = Optional&lt;std::string&gt;;</span><br><span class="line"><span class="keyword">using</span> OptionalLongLong = Optional&lt;<span class="type">long</span> <span class="type">long</span>&gt;;</span><br><span class="line"><span class="keyword">using</span> OptionalDouble = Optional&lt;<span class="type">double</span>&gt;;</span><br><span class="line"><span class="keyword">using</span> OptionalStringPair = Optional&lt;std::pair&lt;std::string, std::string&gt;&gt;;</span><br></pre></td></tr></table></figure>
<h2 id="6-Variant-å¤„ç†å¤šç±»å‹å›å¤ï¼ˆC-17ï¼‰">6. Variant å¤„ç†å¤šç±»å‹å›å¤ï¼ˆC++17ï¼‰</h2>
<ul>
<li>å¦‚æœ<strong>å›å¤ç±»å‹ä¸åŒ</strong>ï¼Œ<strong>std::variant</strong> æ˜¯ä¸ªä¸é”™çš„å›å¤ç±»å‹é€‰æ‹©</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// MEMORY STATS è¿”å›æ··åˆç±»å‹</span></span><br><span class="line"><span class="comment">// å€¼å¯èƒ½æ˜¯ long longã€double æˆ–åµŒå¥— map</span></span><br><span class="line"><span class="keyword">using</span> Var = Variant&lt;<span class="type">double</span>, <span class="type">long</span> <span class="type">long</span>, std::unordered_map&lt;std::string, <span class="type">long</span> <span class="type">long</span>&gt;&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> result = redis.command&lt;std::unordered_map&lt;std::string, Var&gt;&gt;(<span class="string">&quot;memory&quot;</span>, <span class="string">&quot;stats&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¿é—®ç»“æœ</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; [key, value] : result) &#123;</span><br><span class="line">    <span class="keyword">if</span> (std::<span class="built_in">holds_alternative</span>&lt;<span class="type">long</span> <span class="type">long</span>&gt;(value)) &#123;</span><br><span class="line">        std::cout &lt;&lt; key &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; std::<span class="built_in">get</span>&lt;<span class="type">long</span> <span class="type">long</span>&gt;(value) &lt;&lt; std::endl;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (std::<span class="built_in">holds_alternative</span>&lt;<span class="type">double</span>&gt;(value)) &#123;</span><br><span class="line">        std::cout &lt;&lt; key &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; std::<span class="built_in">get</span>&lt;<span class="type">double</span>&gt;(value) &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>âš ï¸ Variant çš„é™åˆ¶</strong>ï¼š</p>
<ul>
<li><strong>Variant çš„ç±»å‹å‚æ•°ä¸èƒ½æœ‰é‡å¤çš„é¡¹</strong>ï¼ˆRedis++ åº“é™åˆ¶ï¼‰
<ul>
<li>ä¾‹å¦‚ Variant&lt;double, long long, double&gt; æ— æ³•å·¥ä½œã€‚</li>
</ul>
</li>
<li><strong>double å¿…é¡»æ”¾åœ¨ std::string ä¹‹å‰</strong>ï¼š
<ul>
<li>å› ä¸º double å›å¤å®é™…æ˜¯å­—ç¬¦ä¸²æ ¼å¼</li>
<li>åœ¨è§£æå˜ä½“æ—¶ï¼Œæˆ‘ä»¬å°è¯•å°†å›å¤è§£æä¸ºç¬¬ä¸€ä¸ªåŒ¹é…çš„ç±»å‹ï¼Œç”±å·¦åˆ°å³çš„ç±»å‹å‚æ•°æŒ‡å®š</li>
<li>å¦‚æœ double æ”¾åœ¨ std::string ä¹‹åï¼Œå›å¤æ€»æ˜¯ä¼šè§£ææˆ std::string</li>
</ul>
</li>
</ul>
<h2 id="7-è¾“å‡ºè¿­ä»£å™¨ä¸-STL-å®¹å™¨">7.è¾“å‡ºè¿­ä»£å™¨ä¸ STL å®¹å™¨</h2>
<ul>
<li>ä½¿ç”¨<strong>commandé€šç”¨å‘½ä»¤æ¥å£</strong>æ—¶ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠå®ƒè§£ææˆ STL å®¹å™¨ï¼Œè€Œä¸æ˜¯è§£æè¾“å‡ºçš„å›å¤ã€‚</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨è¾“å‡ºè¿­ä»£å™¨</span></span><br><span class="line">std::vector&lt;std::string&gt; members;</span><br><span class="line">redis.<span class="built_in">lrange</span>(<span class="string">&quot;list&quot;</span>, <span class="number">0</span>, <span class="number">-1</span>, std::<span class="built_in">back_inserter</span>(members));</span><br><span class="line"></span><br><span class="line">std::unordered_map&lt;std::string, std::string&gt; hash;</span><br><span class="line">redis.<span class="built_in">hgetall</span>(<span class="string">&quot;hash&quot;</span>, std::<span class="built_in">inserter</span>(hash, hash.<span class="built_in">end</span>()));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›´æ¥è¿”å› STL å®¹å™¨ï¼ˆé€šç”¨å‘½ä»¤æ¥å£ï¼‰</span></span><br><span class="line"><span class="keyword">auto</span> config = redis.command&lt;std::unordered_map&lt;std::string, std::string&gt;&gt;(<span class="string">&quot;config&quot;</span>, <span class="string">&quot;get&quot;</span>, <span class="string">&quot;*&quot;</span>);</span><br></pre></td></tr></table></figure>
<h2 id="8-å„ç§å‚æ•°ç±»å‹">8.å„ç§å‚æ•°ç±»å‹</h2>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ***** StringView ç±»å‹çš„å‚æ•° *****</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// éšå¼é€šè¿‡ C é£æ ¼å­—ç¬¦ä¸²æ„é€  StringView</span></span><br><span class="line">redis.<span class="built_in">set</span>(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// éšå¼é€šè¿‡ std::string æ„é€  StringView</span></span><br><span class="line"><span class="function">std::string <span class="title">key</span><span class="params">(<span class="string">&quot;key&quot;</span>)</span></span>;</span><br><span class="line"><span class="function">std::string <span class="title">val</span><span class="params">(<span class="string">&quot;value&quot;</span>)</span></span>;</span><br><span class="line">redis.<span class="built_in">set</span>(key, val);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ˜¾å¼ä¼ é€’ StringView ä½œä¸ºå‚æ•°</span></span><br><span class="line">std::vector&lt;<span class="type">char</span>&gt; large_data;</span><br><span class="line"><span class="comment">// é¿å…æ•°æ®æ‹·è´</span></span><br><span class="line">redis.<span class="built_in">set</span>(<span class="string">&quot;key&quot;</span>, <span class="built_in">StringView</span>(large_data.<span class="built_in">data</span>(), large_data.<span class="built_in">size</span>()));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ***** long long ç±»å‹çš„å‚æ•° *****</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨äºç´¢å¼•å‚æ•°</span></span><br><span class="line">redis.<span class="built_in">bitcount</span>(key, <span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨äºæ•°å€¼å‚æ•°</span></span><br><span class="line">redis.<span class="built_in">incrby</span>(<span class="string">&quot;num&quot;</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ***** double ç±»å‹çš„å‚æ•° *****</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨äºåˆ†æ•°ï¼ˆscoreï¼‰å‚æ•°</span></span><br><span class="line">redis.<span class="built_in">zadd</span>(<span class="string">&quot;zset&quot;</span>, <span class="string">&quot;m1&quot;</span>, <span class="number">2.5</span>);</span><br><span class="line">redis.<span class="built_in">zadd</span>(<span class="string">&quot;zset&quot;</span>, <span class="string">&quot;m2&quot;</span>, <span class="number">3.5</span>);</span><br><span class="line">redis.<span class="built_in">zadd</span>(<span class="string">&quot;zset&quot;</span>, <span class="string">&quot;m3&quot;</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨äºï¼ˆç»åº¦ï¼Œçº¬åº¦ï¼‰åæ ‡å‚æ•°</span></span><br><span class="line">redis.<span class="built_in">geoadd</span>(<span class="string">&quot;geo&quot;</span>, std::<span class="built_in">make_tuple</span>(<span class="string">&quot;member&quot;</span>, <span class="number">13.5</span>, <span class="number">15.6</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ***** æ—¶é—´ç›¸å…³å‚æ•° *****</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std::chrono;</span><br><span class="line"></span><br><span class="line">redis.<span class="built_in">expire</span>(key, <span class="built_in">seconds</span>(<span class="number">1000</span>)); <span class="comment">// è®¾ç½®è¿‡æœŸæ—¶é—´ä¸º 1000 ç§’</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> tp = <span class="built_in">time_point_cast</span>&lt;seconds&gt;(system_clock::<span class="built_in">now</span>() + <span class="built_in">seconds</span>(<span class="number">100</span>));</span><br><span class="line">redis.<span class="built_in">expireat</span>(key, tp); <span class="comment">// è®¾ç½®æŒ‡å®šæ—¶é—´ç‚¹è¿‡æœŸ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ***** å‘½ä»¤çš„ä¸€äº›å¯é€‰å‚æ•° *****</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (redis.<span class="built_in">set</span>(key, <span class="string">&quot;value&quot;</span>, <span class="built_in">milliseconds</span>(<span class="number">100</span>), UpdateType::NOT_EXIST)) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;set æ“ä½œæˆåŠŸ&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">redis.<span class="built_in">linsert</span>(<span class="string">&quot;list&quot;</span>, InsertPosition::BEFORE, <span class="string">&quot;pivot&quot;</span>, <span class="string">&quot;val&quot;</span>); <span class="comment">// åœ¨æŒ‡å®šå…ƒç´ å‰æ’å…¥å€¼</span></span><br><span class="line"></span><br><span class="line">std::vector&lt;std::string&gt; res;</span><br><span class="line"></span><br><span class="line"><span class="comment">// (-æ— ç©·, +æ— ç©·) åŒºé—´</span></span><br><span class="line">redis.<span class="built_in">zrangebyscore</span>(<span class="string">&quot;zset&quot;</span>, UnboundedInterval&lt;<span class="type">double</span>&gt;&#123;&#125;, std::<span class="built_in">back_inserter</span>(res));</span><br><span class="line"></span><br><span class="line"><span class="comment">// [3, 6] é—­åŒºé—´</span></span><br><span class="line">redis.<span class="built_in">zrangebyscore</span>(<span class="string">&quot;zset&quot;</span>,</span><br><span class="line">    <span class="built_in">BoundedInterval</span>&lt;<span class="type">double</span>&gt;(<span class="number">3</span>, <span class="number">6</span>, BoundType::CLOSED),</span><br><span class="line">    std::<span class="built_in">back_inserter</span>(res));</span><br><span class="line"></span><br><span class="line"><span class="comment">// (3, 6] å·¦å¼€å³é—­åŒºé—´</span></span><br><span class="line">redis.<span class="built_in">zrangebyscore</span>(<span class="string">&quot;zset&quot;</span>,</span><br><span class="line">    <span class="built_in">BoundedInterval</span>&lt;<span class="type">double</span>&gt;(<span class="number">3</span>, <span class="number">6</span>, BoundType::LEFT_OPEN),</span><br><span class="line">    std::<span class="built_in">back_inserter</span>(res));</span><br><span class="line"></span><br><span class="line"><span class="comment">// (3, 6) å¼€åŒºé—´</span></span><br><span class="line">redis.<span class="built_in">zrangebyscore</span>(<span class="string">&quot;zset&quot;</span>,</span><br><span class="line">    <span class="built_in">BoundedInterval</span>&lt;<span class="type">double</span>&gt;(<span class="number">3</span>, <span class="number">6</span>, BoundType::OPEN),</span><br><span class="line">    std::<span class="built_in">back_inserter</span>(res));</span><br><span class="line"></span><br><span class="line"><span class="comment">// [3, 6) å·¦é—­å³å¼€åŒºé—´</span></span><br><span class="line">redis.<span class="built_in">zrangebyscore</span>(<span class="string">&quot;zset&quot;</span>,</span><br><span class="line">    <span class="built_in">BoundedInterval</span>&lt;<span class="type">double</span>&gt;(<span class="number">3</span>, <span class="number">6</span>, BoundType::RIGHT_OPEN),</span><br><span class="line">    std::<span class="built_in">back_inserter</span>(res));</span><br><span class="line"></span><br><span class="line"><span class="comment">// [3, +æ— ç©·) å·¦é—­å³æ— ç•ŒåŒºé—´</span></span><br><span class="line">redis.<span class="built_in">zrangebyscore</span>(<span class="string">&quot;zset&quot;</span>,</span><br><span class="line">    <span class="built_in">LeftBoundedInterval</span>&lt;<span class="type">double</span>&gt;(<span class="number">3</span>, BoundType::RIGHT_OPEN),</span><br><span class="line">    std::<span class="built_in">back_inserter</span>(res));</span><br><span class="line"></span><br><span class="line"><span class="comment">// (3, +æ— ç©·) å·¦å¼€å³æ— ç•ŒåŒºé—´</span></span><br><span class="line">redis.<span class="built_in">zrangebyscore</span>(<span class="string">&quot;zset&quot;</span>,</span><br><span class="line">    <span class="built_in">LeftBoundedInterval</span>&lt;<span class="type">double</span>&gt;(<span class="number">3</span>, BoundType::OPEN),</span><br><span class="line">    std::<span class="built_in">back_inserter</span>(res));</span><br><span class="line"></span><br><span class="line"><span class="comment">// (-æ— ç©·, 6] å·¦æ— ç•Œå³é—­åŒºé—´</span></span><br><span class="line">redis.<span class="built_in">zrangebyscore</span>(<span class="string">&quot;zset&quot;</span>,</span><br><span class="line">    <span class="built_in">RightBoundedInterval</span>&lt;<span class="type">double</span>&gt;(<span class="number">6</span>, BoundType::LEFT_OPEN),</span><br><span class="line">    std::<span class="built_in">back_inserter</span>(res));</span><br><span class="line"></span><br><span class="line"><span class="comment">// (-æ— ç©·, 6) å·¦æ— ç•Œå³å¼€åŒºé—´</span></span><br><span class="line">redis.<span class="built_in">zrangebyscore</span>(<span class="string">&quot;zset&quot;</span>,</span><br><span class="line">    <span class="built_in">RightBoundedInterval</span>&lt;<span class="type">double</span>&gt;(<span class="number">6</span>, BoundType::OPEN),</span><br><span class="line">    std::<span class="built_in">back_inserter</span>(res));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ***** è¿­ä»£å™¨å¯¹å‚æ•° *****</span></span><br><span class="line"></span><br><span class="line">std::vector&lt;std::pair&lt;std::string, std::string&gt;&gt; kvs = &#123;&#123;<span class="string">&quot;k1&quot;</span>, <span class="string">&quot;v1&quot;</span>&#125;, &#123;<span class="string">&quot;k2&quot;</span>, <span class="string">&quot;v2&quot;</span>&#125;, &#123;<span class="string">&quot;k3&quot;</span>, <span class="string">&quot;v3&quot;</span>&#125;&#125;;</span><br><span class="line">redis.<span class="built_in">mset</span>(kvs.<span class="built_in">begin</span>(), kvs.<span class="built_in">end</span>()); <span class="comment">// æ‰¹é‡è®¾ç½®é”®å€¼å¯¹</span></span><br><span class="line"></span><br><span class="line">std::unordered_map&lt;std::string, std::string&gt; kv_map = &#123;&#123;<span class="string">&quot;k1&quot;</span>, <span class="string">&quot;v1&quot;</span>&#125;, &#123;<span class="string">&quot;k2&quot;</span>, <span class="string">&quot;v2&quot;</span>&#125;, &#123;<span class="string">&quot;k3&quot;</span>, <span class="string">&quot;v3&quot;</span>&#125;&#125;;</span><br><span class="line">redis.<span class="built_in">mset</span>(kv_map.<span class="built_in">begin</span>(), kv_map.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">std::unordered_map&lt;std::string, std::string&gt; str_map = &#123;&#123;<span class="string">&quot;f1&quot;</span>, <span class="string">&quot;v1&quot;</span>&#125;, &#123;<span class="string">&quot;f2&quot;</span>, <span class="string">&quot;v2&quot;</span>&#125;, &#123;<span class="string">&quot;f3&quot;</span>, <span class="string">&quot;v3&quot;</span>&#125;&#125;;</span><br><span class="line">redis.<span class="built_in">hmset</span>(<span class="string">&quot;hash&quot;</span>, str_map.<span class="built_in">begin</span>(), str_map.<span class="built_in">end</span>()); <span class="comment">// æ‰¹é‡è®¾ç½®å“ˆå¸Œå­—æ®µ</span></span><br><span class="line"></span><br><span class="line">std::unordered_map&lt;std::string, <span class="type">double</span>&gt; score_map = &#123;&#123;<span class="string">&quot;m1&quot;</span>, <span class="number">20</span>&#125;, &#123;<span class="string">&quot;m2&quot;</span>, <span class="number">12.5</span>&#125;, &#123;<span class="string">&quot;m3&quot;</span>, <span class="number">3.14</span>&#125;&#125;;</span><br><span class="line">redis.<span class="built_in">zadd</span>(<span class="string">&quot;zset&quot;</span>, score_map.<span class="built_in">begin</span>(), score_map.<span class="built_in">end</span>()); <span class="comment">// æ‰¹é‡æ·»åŠ æœ‰åºé›†åˆå…ƒç´ </span></span><br><span class="line"></span><br><span class="line">std::vector&lt;std::string&gt; keys = &#123;<span class="string">&quot;k1&quot;</span>, <span class="string">&quot;k2&quot;</span>, <span class="string">&quot;k3&quot;</span>&#125;;</span><br><span class="line">redis.<span class="built_in">del</span>(keys.<span class="built_in">begin</span>(), keys.<span class="built_in">end</span>()); <span class="comment">// æ‰¹é‡åˆ é™¤é”®</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ***** initializer_list ç±»å‹çš„å‚æ•° *****</span></span><br><span class="line"></span><br><span class="line">redis.<span class="built_in">mset</span>(&#123;</span><br><span class="line">    std::<span class="built_in">make_pair</span>(<span class="string">&quot;k1&quot;</span>, <span class="string">&quot;v1&quot;</span>),</span><br><span class="line">    std::<span class="built_in">make_pair</span>(<span class="string">&quot;k2&quot;</span>, <span class="string">&quot;v2&quot;</span>),</span><br><span class="line">    std::<span class="built_in">make_pair</span>(<span class="string">&quot;k3&quot;</span>, <span class="string">&quot;v3&quot;</span>)</span><br><span class="line">&#125;); <span class="comment">// ç”¨åˆå§‹åŒ–åˆ—è¡¨æ‰¹é‡è®¾ç½®é”®å€¼å¯¹</span></span><br><span class="line"></span><br><span class="line">redis.<span class="built_in">hmset</span>(<span class="string">&quot;hash&quot;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">        std::<span class="built_in">make_pair</span>(<span class="string">&quot;f1&quot;</span>, <span class="string">&quot;v1&quot;</span>),</span><br><span class="line">        std::<span class="built_in">make_pair</span>(<span class="string">&quot;f2&quot;</span>, <span class="string">&quot;v2&quot;</span>),</span><br><span class="line">        std::<span class="built_in">make_pair</span>(<span class="string">&quot;f3&quot;</span>, <span class="string">&quot;v3&quot;</span>)</span><br><span class="line">    &#125;); <span class="comment">// ç”¨åˆå§‹åŒ–åˆ—è¡¨æ‰¹é‡è®¾ç½®å“ˆå¸Œå­—æ®µ</span></span><br><span class="line"></span><br><span class="line">redis.<span class="built_in">zadd</span>(<span class="string">&quot;zset&quot;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">        std::<span class="built_in">make_pair</span>(<span class="string">&quot;m1&quot;</span>, <span class="number">20.0</span>),</span><br><span class="line">        std::<span class="built_in">make_pair</span>(<span class="string">&quot;m2&quot;</span>, <span class="number">34.5</span>),</span><br><span class="line">        std::<span class="built_in">make_pair</span>(<span class="string">&quot;m3&quot;</span>, <span class="number">23.4</span>)</span><br><span class="line">    &#125;); <span class="comment">// ç”¨åˆå§‹åŒ–åˆ—è¡¨æ‰¹é‡æ·»åŠ æœ‰åºé›†åˆå…ƒç´ </span></span><br><span class="line"></span><br><span class="line">redis.<span class="built_in">del</span>(&#123;<span class="string">&quot;k1&quot;</span>, <span class="string">&quot;k2&quot;</span>, <span class="string">&quot;k3&quot;</span>&#125;); <span class="comment">// ç”¨åˆå§‹åŒ–åˆ—è¡¨æ‰¹é‡åˆ é™¤é”®</span></span><br></pre></td></tr></table></figure>
<h2 id="9-å„ç§è¿”å›å€¼ç±»å‹">9.å„ç§è¿”å›å€¼ç±»å‹</h2>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ***** è¿”å›å€¼ä¸º void ç±»å‹ *****</span></span><br><span class="line"></span><br><span class="line">redis.<span class="built_in">save</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ***** è¿”å›å€¼ä¸º std::string ç±»å‹ *****</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> info = redis.<span class="built_in">info</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ***** è¿”å›å€¼ä¸º bool ç±»å‹ *****</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!redis.<span class="built_in">expire</span>(<span class="string">&quot;nonexistent&quot;</span>, std::chrono::<span class="built_in">seconds</span>(<span class="number">100</span>))) &#123;</span><br><span class="line">    std::cerr &lt;&lt; <span class="string">&quot;é”®ä¸å­˜åœ¨&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (redis.<span class="built_in">setnx</span>(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;val&quot;</span>)) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;set æ“ä½œæˆåŠŸ&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ***** è¿”å›å€¼ä¸º long long ç±»å‹ *****</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> len = redis.<span class="built_in">strlen</span>(<span class="string">&quot;key&quot;</span>);</span><br><span class="line"><span class="keyword">auto</span> num = redis.<span class="built_in">del</span>(&#123;<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>&#125;);</span><br><span class="line">num = redis.<span class="built_in">incr</span>(<span class="string">&quot;a&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ***** è¿”å›å€¼ä¸º double ç±»å‹ *****</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> real = redis.<span class="built_in">incrbyfloat</span>(<span class="string">&quot;b&quot;</span>, <span class="number">23.4</span>);</span><br><span class="line">real = redis.<span class="built_in">hincrbyfloat</span>(<span class="string">&quot;c&quot;</span>, <span class="string">&quot;f&quot;</span>, <span class="number">34.5</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ***** è¿”å›å€¼ä¸º Optional&lt;std::string&gt;ï¼ˆå³ OptionalStringï¼‰ç±»å‹ *****</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> os = redis.<span class="built_in">get</span>(<span class="string">&quot;kk&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (os) &#123;</span><br><span class="line">    std::cout &lt;&lt; *os &lt;&lt; std::endl;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    std::cerr &lt;&lt; <span class="string">&quot;é”®ä¸å­˜åœ¨&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">os = redis.<span class="built_in">spop</span>(<span class="string">&quot;set&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (os) &#123;</span><br><span class="line">    std::cout &lt;&lt; *os &lt;&lt; std::endl;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    std::cerr &lt;&lt; <span class="string">&quot;é›†åˆä¸ºç©º&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ***** è¿”å›å€¼ä¸º Optional&lt;long long&gt;ï¼ˆå³ OptionalLongLongï¼‰ç±»å‹ *****</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> oll = redis.<span class="built_in">zrank</span>(<span class="string">&quot;zset&quot;</span>, <span class="string">&quot;mem&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (oll) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;æ’åä¸º &quot;</span> &lt;&lt; *oll &lt;&lt; std::endl;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    std::cerr &lt;&lt; <span class="string">&quot;æˆå‘˜ä¸å­˜åœ¨&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ***** è¿”å›å€¼ä¸º Optional&lt;double&gt;ï¼ˆå³ OptionalDoubleï¼‰ç±»å‹ *****</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> ob = redis.<span class="built_in">zscore</span>(<span class="string">&quot;zset&quot;</span>, <span class="string">&quot;m1&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (ob) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;åˆ†æ•°ä¸º &quot;</span> &lt;&lt; *ob &lt;&lt; std::endl;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    std::cerr &lt;&lt; <span class="string">&quot;æˆå‘˜ä¸å­˜åœ¨&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ***** è¿”å›å€¼ä¸º Optional&lt;pair&lt;string, string&gt;&gt; ç±»å‹ *****</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> op = redis.<span class="built_in">blpop</span>(&#123;<span class="string">&quot;list1&quot;</span>, <span class="string">&quot;list2&quot;</span>&#125;, std::chrono::<span class="built_in">seconds</span>(<span class="number">2</span>));</span><br><span class="line"><span class="keyword">if</span> (op) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;é”®ä¸º &quot;</span> &lt;&lt; op-&gt;first &lt;&lt; <span class="string">&quot;ï¼Œå€¼ä¸º &quot;</span> &lt;&lt; op-&gt;second &lt;&lt; std::endl;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    std::cerr &lt;&lt; <span class="string">&quot;è¶…æ—¶&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ***** è¾“å‡ºè¿­ä»£å™¨æ¥æ”¶è¿”å›å€¼ *****</span></span><br><span class="line"></span><br><span class="line">std::vector&lt;OptionalString&gt; os_vec;</span><br><span class="line">redis.<span class="built_in">mget</span>(&#123;<span class="string">&quot;k1&quot;</span>, <span class="string">&quot;k2&quot;</span>, <span class="string">&quot;k3&quot;</span>&#125;, std::<span class="built_in">back_inserter</span>(os_vec));</span><br><span class="line"></span><br><span class="line">std::vector&lt;std::string&gt; s_vec;</span><br><span class="line">redis.<span class="built_in">lrange</span>(<span class="string">&quot;list&quot;</span>, <span class="number">0</span>, <span class="number">-1</span>, std::<span class="built_in">back_inserter</span>(s_vec));</span><br><span class="line"></span><br><span class="line">std::unordered_map&lt;std::string, std::string&gt; hash;</span><br><span class="line">redis.<span class="built_in">hgetall</span>(<span class="string">&quot;hash&quot;</span>, std::<span class="built_in">inserter</span>(hash, hash.<span class="built_in">end</span>()));</span><br><span class="line"><span class="comment">// ä¹Ÿå¯ä»¥å°†ç»“æœä¿å­˜åˆ°å­—ç¬¦ä¸²é”®å€¼å¯¹çš„å‘é‡ä¸­</span></span><br><span class="line">std::vector&lt;std::pair&lt;std::string, std::string&gt;&gt; hash_vec;</span><br><span class="line">redis.<span class="built_in">hgetall</span>(<span class="string">&quot;hash&quot;</span>, std::<span class="built_in">back_inserter</span>(hash_vec));</span><br><span class="line"></span><br><span class="line">std::unordered_set&lt;std::string&gt; str_set;</span><br><span class="line">redis.<span class="built_in">smembers</span>(<span class="string">&quot;s1&quot;</span>, std::<span class="built_in">inserter</span>(str_set, str_set.<span class="built_in">end</span>()));</span><br><span class="line"><span class="comment">// ä¹Ÿå¯ä»¥å°†ç»“æœä¿å­˜åˆ°å­—ç¬¦ä¸²å‘é‡ä¸­</span></span><br><span class="line">s_vec.<span class="built_in">clear</span>();</span><br><span class="line">redis.<span class="built_in">smembers</span>(<span class="string">&quot;s1&quot;</span>, std::<span class="built_in">back_inserter</span>(s_vec));</span><br></pre></td></tr></table></figure>
<h1>å…«ã€Redis++ çš„å¼‚å¸¸å¤„ç†</h1>
<h2 id="1-Redis-çš„Exception">1.Redis++çš„Exception</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">std::exception</span><br><span class="line">    â””â”€â”€ sw::redis::Error              // åŸºç±»ï¼šæ‰€æœ‰ Redis++ å¼‚å¸¸çš„çˆ¶ç±»</span><br><span class="line">            â”œâ”€â”€ IoError               // IO é”™è¯¯ï¼ˆè¿æ¥ç›¸å…³ï¼‰</span><br><span class="line">            â”‚       â””â”€â”€ TimeoutError  // è¶…æ—¶é”™è¯¯ï¼ˆè¯»å†™è¶…æ—¶ï¼‰</span><br><span class="line">            â”œâ”€â”€ ClosedError           // æœåŠ¡å™¨å…³é—­è¿æ¥</span><br><span class="line">            â”œâ”€â”€ ProtoError            // åè®®é”™è¯¯ï¼ˆå‘½ä»¤/å›å¤æ— æ•ˆï¼‰</span><br><span class="line">            â”œâ”€â”€ OomError              // hiredis å†…å­˜ä¸è¶³</span><br><span class="line">            â”œâ”€â”€ ReplyError            // Redis è¿”å›é”™è¯¯å›å¤</span><br><span class="line">            â””â”€â”€ WatchError            // WATCH çš„ key è¢«ä¿®æ”¹</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114095237003.png" alt=""><br>
<strong>æ³¨æ„ï¼ï¼</strong>ï¼š</p>
<ul>
<li><strong>NULL REPLY ä¸æ˜¯å¼‚å¸¸</strong><br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114095332179.png" alt=""></li>
</ul>
<h2 id="2-å¼‚å¸¸åçš„å¯¹è±¡çŠ¶æ€">2.å¼‚å¸¸åçš„å¯¹è±¡çŠ¶æ€</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114095437891.png" alt=""><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114095455051.png" alt=""></p>
<h2 id="3-å¼‚å¸¸å¤„ç†æ¨¡æ¿">3.å¼‚å¸¸å¤„ç†æ¨¡æ¿</h2>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sw/redis++/redis++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> sw::redis;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">safe_redis_operation</span><span class="params">(Redis&amp; redis)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        redis.<span class="built_in">set</span>(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> TimeoutError&amp; e) &#123;</span><br><span class="line">        <span class="comment">// è¶…æ—¶ï¼šå¯é‡è¯•</span></span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;è¶…æ—¶: &quot;</span> &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> ReplyError&amp; e) &#123;</span><br><span class="line">        <span class="comment">// Redis è¿”å›é”™è¯¯ï¼ˆå¦‚ç±»å‹é”™è¯¯ï¼‰ï¼šæ£€æŸ¥ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;Redis é”™è¯¯: &quot;</span> &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> IoError&amp; e) &#123;</span><br><span class="line">        <span class="comment">// IO é”™è¯¯ï¼šè¿æ¥é—®é¢˜ï¼Œè‡ªåŠ¨é‡è¿</span></span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;IO é”™è¯¯: &quot;</span> &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> Error&amp; e) &#123;</span><br><span class="line">        <span class="comment">// å…¶ä»– Redis++ é”™è¯¯</span></span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;é”™è¯¯: &quot;</span> &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// redis å¯¹è±¡ä»ç„¶å¯ç”¨ï¼Œä¸‹æ¬¡è°ƒç”¨ä¼šè‡ªåŠ¨é‡è¿</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>ä¹ã€Redis::commandï¼ˆRedis++ é€šç”¨å‘½ä»¤æ¥å£ï¼‰</h1>
<p>Redis++ æ— æ³•ä¸ºæ‰€æœ‰ Redis å‘½ä»¤æä¾›å†…ç½®æ–¹æ³•ï¼ŒRedis::command å…è®¸ä½ å‘é€<strong>ä»»æ„ Redis å‘½ä»¤</strong></p>
<h2 id="1-åŸºæœ¬ç”¨æ³•">1.åŸºæœ¬ç”¨æ³•</h2>
<h3 id="ï¼ˆ1ï¼‰ç›´æ¥æŒ‡å®šè¿”å›ç±»å‹ï¼ˆæ¨èï¼‰">ï¼ˆ1ï¼‰ç›´æ¥æŒ‡å®šè¿”å›ç±»å‹ï¼ˆæ¨èï¼‰</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> redis = <span class="built_in">Redis</span>(<span class="string">&quot;tcp://127.0.0.1&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ— è¿”å›å€¼çš„å‘½ä»¤</span></span><br><span class="line">redis.<span class="built_in">command</span>&lt;<span class="type">void</span>&gt;(<span class="string">&quot;client&quot;</span>, <span class="string">&quot;setname&quot;</span>, <span class="string">&quot;my-connection&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›å­—ç¬¦ä¸²ï¼ˆå¯èƒ½ä¸ºç©ºï¼‰</span></span><br><span class="line"><span class="keyword">auto</span> val = redis.<span class="built_in">command</span>&lt;OptionalString&gt;(<span class="string">&quot;client&quot;</span>, <span class="string">&quot;getname&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (val) &#123;</span><br><span class="line">    std::cout &lt;&lt; *val &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›æ•´æ•°</span></span><br><span class="line"><span class="keyword">auto</span> num = redis.<span class="built_in">command</span>&lt;<span class="type">long</span> <span class="type">long</span>&gt;(<span class="string">&quot;incrby&quot;</span>, <span class="string">&quot;counter&quot;</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›æµ®ç‚¹æ•°</span></span><br><span class="line"><span class="keyword">auto</span> real = redis.<span class="built_in">command</span>&lt;<span class="type">double</span>&gt;(<span class="string">&quot;incrbyfloat&quot;</span>, <span class="string">&quot;price&quot;</span>, <span class="number">2.5</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›æ•°ç»„ - æ–¹å¼1ï¼šä½¿ç”¨è¾“å‡ºè¿­ä»£å™¨</span></span><br><span class="line">std::vector&lt;OptionalString&gt; result;</span><br><span class="line">redis.<span class="built_in">command</span>(<span class="string">&quot;mget&quot;</span>, <span class="string">&quot;k1&quot;</span>, <span class="string">&quot;k2&quot;</span>, <span class="string">&quot;k3&quot;</span>, std::<span class="built_in">back_inserter</span>(result));</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›æ•°ç»„ - æ–¹å¼2ï¼šç›´æ¥è§£æä¸ºå®¹å™¨</span></span><br><span class="line"><span class="keyword">auto</span> result2 = redis.command&lt;std::vector&lt;OptionalString&gt;&gt;(<span class="string">&quot;mget&quot;</span>, <span class="string">&quot;k1&quot;</span>, <span class="string">&quot;k2&quot;</span>, <span class="string">&quot;k3&quot;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰å‚æ•°ç±»å‹çµæ´»">ï¼ˆ2ï¼‰å‚æ•°ç±»å‹çµæ´»</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> redis = <span class="built_in">Redis</span>(<span class="string">&quot;tcp://127.0.0.1&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Redis ç±»æ²¡æœ‰å†…ç½®çš„ *CLIENT SETNAME* æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment">// ä¸è¿‡ï¼Œä½ å¯ä»¥ä½¿ç”¨ Redis::command æ‰‹åŠ¨å‘é€è¯¥å‘½ä»¤ã€‚</span></span><br><span class="line">redis.<span class="built_in">command</span>&lt;<span class="type">void</span>&gt;(<span class="string">&quot;client&quot;</span>, <span class="string">&quot;setname&quot;</span>, <span class="string">&quot;name&quot;</span>);</span><br><span class="line"><span class="keyword">auto</span> val = redis.<span class="built_in">command</span>&lt;OptionalString&gt;(<span class="string">&quot;client&quot;</span>, <span class="string">&quot;getname&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (val) &#123;</span><br><span class="line">    std::cout &lt;&lt; *val &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨æ„ï¼šä»¥ä¸‹ä»£ç ä»…ä½œç¤ºä¾‹ä½¿ç”¨ã€‚å®é™…ä¸Šï¼ŒRedis å·²ä¸º</span></span><br><span class="line"><span class="comment">// ä¸‹è¿°å‘½ä»¤æä¾›äº†å†…ç½®æ–¹æ³•ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘½ä»¤å‚æ•°å¯ä»¥æ˜¯å­—ç¬¦ä¸²ç±»å‹ã€‚</span></span><br><span class="line"><span class="comment">// æ³¨æ„ï¼šå¯¹äº SET å‘½ä»¤ï¼Œè¿”å›å€¼å¹¶éå§‹ç»ˆä¸º void ç±»å‹ï¼Œåç»­ä¼šè¯¦ç»†è¯´æ˜ã€‚</span></span><br><span class="line">redis.<span class="built_in">command</span>&lt;<span class="type">void</span>&gt;(<span class="string">&quot;set&quot;</span>, <span class="string">&quot;key&quot;</span>, <span class="string">&quot;100&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘½ä»¤å‚æ•°å¯ä»¥æ˜¯å­—ç¬¦ä¸²å’Œæ•´æ•°çš„ç»„åˆã€‚</span></span><br><span class="line"><span class="keyword">auto</span> num = redis.<span class="built_in">command</span>&lt;<span class="type">long</span> <span class="type">long</span>&gt;(<span class="string">&quot;incrby&quot;</span>, <span class="string">&quot;key&quot;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‚æ•°ä¹Ÿå¯ä»¥æ˜¯åŒç²¾åº¦æµ®ç‚¹å‹ï¼ˆdoubleï¼‰ã€‚</span></span><br><span class="line"><span class="keyword">auto</span> real = redis.<span class="built_in">command</span>&lt;<span class="type">double</span>&gt;(<span class="string">&quot;incrbyfloat&quot;</span>, <span class="string">&quot;key&quot;</span>, <span class="number">2.3</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”šè‡³å‘½ä»¤ä¸­çš„é”®ï¼ˆkeyï¼‰ä¹Ÿå¯ä»¥æ˜¯ç®—æœ¯ç±»å‹ã€‚</span></span><br><span class="line">redis.<span class="built_in">command</span>&lt;<span class="type">void</span>&gt;(<span class="string">&quot;set&quot;</span>, <span class="number">100</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line"></span><br><span class="line">val = redis.<span class="built_in">command</span>&lt;OptionalString&gt;(<span class="string">&quot;get&quot;</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœå‘½ä»¤è¿”å›å…ƒç´ æ•°ç»„ã€‚</span></span><br><span class="line">std::vector&lt;OptionalString&gt; result;</span><br><span class="line">redis.<span class="built_in">command</span>(<span class="string">&quot;mget&quot;</span>, <span class="string">&quot;k1&quot;</span>, <span class="string">&quot;k2&quot;</span>, <span class="string">&quot;k3&quot;</span>, std::<span class="built_in">back_inserter</span>(result));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¹Ÿå¯ä»¥ç›´æ¥è§£æä¸º vector å®¹å™¨ã€‚</span></span><br><span class="line">result = redis.command&lt;std::vector&lt;OptionalString&gt;&gt;(<span class="string">&quot;mget&quot;</span>, <span class="string">&quot;k1&quot;</span>, <span class="string">&quot;k2&quot;</span>, <span class="string">&quot;k3&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘½ä»¤å‚æ•°å¯ä»¥æ˜¯å­—ç¬¦ä¸²èŒƒå›´ï¼ˆè¿­ä»£å™¨ï¼‰ã€‚</span></span><br><span class="line"><span class="keyword">auto</span> set_cmd_strs = &#123;<span class="string">&quot;set&quot;</span>, <span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>&#125;;</span><br><span class="line">redis.<span class="built_in">command</span>&lt;<span class="type">void</span>&gt;(set_cmd_strs.<span class="built_in">begin</span>(), set_cmd_strs.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> get_cmd_strs = &#123;<span class="string">&quot;get&quot;</span>, <span class="string">&quot;key&quot;</span>&#125;;</span><br><span class="line">val = redis.<span class="built_in">command</span>&lt;OptionalString&gt;(get_cmd_strs.<span class="built_in">begin</span>(), get_cmd_strs.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœè¿”å›çš„æ˜¯å…ƒç´ æ•°ç»„ã€‚</span></span><br><span class="line">result.<span class="built_in">clear</span>();</span><br><span class="line"><span class="keyword">auto</span> mget_cmd_strs = &#123;<span class="string">&quot;mget&quot;</span>, <span class="string">&quot;key1&quot;</span>, <span class="string">&quot;key2&quot;</span>&#125;;</span><br><span class="line">redis.<span class="built_in">command</span>(mget_cmd_strs.<span class="built_in">begin</span>(), mget_cmd_strs.<span class="built_in">end</span>(), std::<span class="built_in">back_inserter</span>(result));</span><br></pre></td></tr></table></figure>
<h2 id="2-é‡è¦æ³¨æ„äº‹é¡¹">2.é‡è¦æ³¨æ„äº‹é¡¹</h2>
<h3 id="ï¼ˆ1ï¼‰å¤šè¯å‘½ä»¤å¿…é¡»åˆ†å¼€ä¼ é€’">ï¼ˆ1ï¼‰å¤šè¯å‘½ä»¤å¿…é¡»åˆ†å¼€ä¼ é€’</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âœ… æ­£ç¡®ï¼šåˆ†å¼€ä¼ é€’</span></span><br><span class="line">redis.<span class="built_in">command</span>&lt;<span class="type">void</span>&gt;(<span class="string">&quot;client&quot;</span>, <span class="string">&quot;setname&quot;</span>, <span class="string">&quot;name&quot;</span>);</span><br><span class="line">redis.<span class="built_in">command</span>&lt;<span class="type">void</span>&gt;(<span class="string">&quot;cluster&quot;</span>, <span class="string">&quot;info&quot;</span>);</span><br><span class="line">redis.<span class="built_in">command</span>&lt;<span class="type">void</span>&gt;(<span class="string">&quot;config&quot;</span>, <span class="string">&quot;get&quot;</span>, <span class="string">&quot;maxmemory&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ é”™è¯¯ï¼šåˆå¹¶ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">redis.<span class="built_in">command</span>&lt;<span class="type">void</span>&gt;(<span class="string">&quot;client setname&quot;</span>, <span class="string">&quot;name&quot;</span>);  <span class="comment">// å¤±è´¥ï¼</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰è¿”å›ç±»å‹ä¸å›ºå®šæ—¶çš„å¤„ç†">ï¼ˆ2ï¼‰è¿”å›ç±»å‹ä¸å›ºå®šæ—¶çš„å¤„ç†</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> redis = <span class="built_in">Redis</span>(<span class="string">&quot;tcp://127.0.0.1&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼1ï¼šä½¿ç”¨ OptionalString å¤„ç†å¯èƒ½çš„ NULL</span></span><br><span class="line"><span class="keyword">auto</span> r = redis.<span class="built_in">command</span>&lt;OptionalString&gt;(<span class="string">&quot;set&quot;</span>, <span class="string">&quot;key&quot;</span>, <span class="string">&quot;val&quot;</span>, <span class="string">&quot;NX&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (r) &#123;</span><br><span class="line">    <span class="comment">// è¿”å› &quot;OK&quot;ï¼Œè®¾ç½®æˆåŠŸ</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;è®¾ç½®æˆåŠŸ: &quot;</span> &lt;&lt; *r &lt;&lt; std::endl;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// è¿”å› NULLï¼Œkey å·²å­˜åœ¨ï¼Œè®¾ç½®å¤±è´¥</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;key å·²å­˜åœ¨ï¼Œè®¾ç½®å¤±è´¥&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼2ï¼šä½¿ç”¨ ReplyUPtr æ‰‹åŠ¨è§£æ</span></span><br><span class="line"><span class="keyword">auto</span> reply = redis.<span class="built_in">command</span>(<span class="string">&quot;set&quot;</span>, <span class="string">&quot;key&quot;</span>, <span class="string">&quot;val&quot;</span>, <span class="string">&quot;NX&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (reply-&gt;type == REDIS_REPLY_NIL) &#123;</span><br><span class="line">    <span class="comment">// NULL å›å¤ï¼Œè®¾ç½®å¤±è´¥</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;key å·²å­˜åœ¨&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (reply-&gt;type == REDIS_REPLY_STATUS) &#123;</span><br><span class="line">    <span class="comment">// çŠ¶æ€å›å¤ &quot;OK&quot;ï¼Œè®¾ç½®æˆåŠŸ</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;è®¾ç½®æˆåŠŸ: &quot;</span> &lt;&lt; reply-&gt;str &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼3ï¼šå°è£…æˆ boolï¼ˆæ¨¡æ‹Ÿå†…ç½® set() çš„è¡Œä¸ºï¼‰</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">set_if_not_exist</span><span class="params">(Redis&amp; redis, <span class="type">const</span> std::string&amp; key, <span class="type">const</span> std::string&amp; val)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> r = redis.<span class="built_in">command</span>&lt;OptionalString&gt;(<span class="string">&quot;set&quot;</span>, key, val, <span class="string">&quot;NX&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> r.<span class="built_in">has_value</span>();  <span class="comment">// æœ‰å€¼ = æˆåŠŸï¼Œç©º = å¤±è´¥</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨å°è£…å‡½æ•°</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">set_if_not_exist</span>(redis, <span class="string">&quot;mykey&quot;</span>, <span class="string">&quot;myval&quot;</span>)) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;è®¾ç½®æˆåŠŸ&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;key å·²å­˜åœ¨&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>å¸¸è§é™·é˜±</strong>ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âš ï¸ SET å‘½ä»¤çš„è¿”å›ç±»å‹ä¸æ˜¯å›ºå®šçš„ï¼</span></span><br><span class="line"><span class="comment">// æ™®é€š SET â†’ è¿”å› &quot;OK&quot;ï¼ˆStatus Replyï¼‰</span></span><br><span class="line"><span class="comment">// SET ... NX â†’ å¯èƒ½è¿”å› NULLï¼ˆkey å·²å­˜åœ¨æ—¶ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ å¯èƒ½å‡ºé”™</span></span><br><span class="line">redis.<span class="built_in">command</span>&lt;<span class="type">void</span>&gt;(<span class="string">&quot;set&quot;</span>, <span class="string">&quot;key&quot;</span>, <span class="string">&quot;val&quot;</span>, <span class="string">&quot;NX&quot;</span>);  <span class="comment">// NX å¤±è´¥æ—¶æ— æ³•åˆ¤æ–­</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ­£ç¡®å¤„ç†</span></span><br><span class="line"><span class="keyword">auto</span> result = redis.<span class="built_in">command</span>&lt;OptionalString&gt;(<span class="string">&quot;set&quot;</span>, <span class="string">&quot;key&quot;</span>, <span class="string">&quot;val&quot;</span>, <span class="string">&quot;NX&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (result) &#123;</span><br><span class="line">    <span class="comment">// è®¾ç½®æˆåŠŸ</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// key å·²å­˜åœ¨ï¼Œè®¾ç½®å¤±è´¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>åã€Redis++ Pub/Subï¼ˆå‘å¸ƒ/è®¢é˜…ï¼‰</h1>
<h2 id="1-æ¦‚è¿°">1.æ¦‚è¿°</h2>
<ul>
<li>ä½ å¯ä»¥ä½¿ç”¨ <strong>Redis::publishæ–¹æ³•</strong> å‘é¢‘é“ï¼ˆchannelsï¼‰å‘å¸ƒæ¶ˆæ¯
<ul>
<li>Redis ä¼šä»åº•å±‚è¿æ¥æ± ä¸­<strong>éšæœºé€‰æ‹©</strong>ä¸€ä¸ªè¿æ¥ï¼Œå¹¶é€šè¿‡è¯¥è¿æ¥å‘å¸ƒæ¶ˆæ¯</li>
<li>å› æ­¤ï¼Œä½ å‘å¸ƒçš„ä¸¤æ¡æ¶ˆæ¯å¯èƒ½ä¼šä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„è¿æ¥</li>
</ul>
</li>
<li>å½“ä½ é€šè¿‡ä¸€ä¸ªè¿æ¥<strong>è®¢é˜…æŸä¸ªé¢‘é“</strong>æ—¶ï¼Œå‘å¸ƒåˆ°<strong>è¯¥é¢‘é“çš„æ‰€æœ‰æ¶ˆæ¯</strong>éƒ½ä¼šé€šè¿‡è¿™ä¸ªè¿æ¥å›ä¼ ç»™å®¢æˆ·ç«¯
<ul>
<li>Redis ç±»ä¸­å¹¶<strong>æ²¡æœ‰Redis::subscribeæ–¹æ³•</strong>ï¼š
<ul>
<li>ä½ å¯ä»¥è°ƒç”¨ <strong>Redis::subscriberæ–¹æ³•</strong> åˆ›å»ºä¸€ä¸ª Subscriberï¼ˆè®¢é˜…è€…ï¼‰å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¼šå•ç‹¬ç»´æŠ¤ä¸€ä¸ªä¸ Redis æœåŠ¡å™¨çš„è¿æ¥</li>
<li>è¿™ä¸ªåº•å±‚è¿æ¥æ˜¯ <strong>æ–°å»ºçš„è¿æ¥</strong>ï¼Œ<strong>â€œå¹¶éâ€ä»è¿æ¥æ± ä¸­é€‰å–</strong>ï¼Œä¸”è¯¥æ–°è¿æ¥ä¼š <strong>â€œæ²¿ç”¨â€åŸ Redis å¯¹è±¡çš„ ConnectionOptionsï¼ˆè¿æ¥é…ç½®ï¼‰</strong>ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">å‘å¸ƒè€…                          Redis æœåŠ¡å™¨                      è®¢é˜…è€…</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚  Redis  â”‚  â”€â”€<span class="built_in">publish</span>()â”€â”€â–º   â”‚             â”‚  â”€â”€æ¨é€æ¶ˆæ¯â”€â”€â–º  â”‚ Subscriber  â”‚</span><br><span class="line">â”‚ å¯¹è±¡    â”‚                    â”‚   Channel   â”‚                 â”‚ (ç‹¬ç«‹è¿æ¥)  â”‚</span><br><span class="line">â”‚(è¿æ¥æ± ) â”‚                    â”‚             â”‚                 â”‚             â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">   â”‚                                                                  â”‚</span><br><span class="line">   â”‚ éšæœºé€‰æ‹©è¿æ¥å‘å¸ƒ                                          æ–°å»ºç‹¬ç«‹è¿æ¥</span><br><span class="line">   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>
<p>ğŸ“Š é€ŸæŸ¥è¡¨<br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114120517753.png" alt=""></p>
<h2 id="2-Publish-å‘å¸ƒæ¶ˆæ¯">2.Publish å‘å¸ƒæ¶ˆæ¯</h2>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> redis = <span class="built_in">Redis</span>(<span class="string">&quot;tcp://127.0.0.1:6379&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘é¢‘é“å‘å¸ƒæ¶ˆæ¯ï¼ˆä»è¿æ¥æ± éšæœºé€‰æ‹©è¿æ¥ï¼‰</span></span><br><span class="line">redis.<span class="built_in">publish</span>(<span class="string">&quot;channel1&quot;</span>, <span class="string">&quot;hello&quot;</span>);</span><br><span class="line">redis.<span class="built_in">publish</span>(<span class="string">&quot;news&quot;</span>, <span class="string">&quot;breaking news!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›å€¼ï¼šæ”¶åˆ°æ¶ˆæ¯çš„è®¢é˜…è€…æ•°é‡</span></span><br><span class="line"><span class="type">long</span> <span class="type">long</span> receivers = redis.<span class="built_in">publish</span>(<span class="string">&quot;channel1&quot;</span>, <span class="string">&quot;message&quot;</span>);</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;æ”¶åˆ°æ¶ˆæ¯çš„è®¢é˜…è€…: &quot;</span> &lt;&lt; receivers &lt;&lt; std::endl;</span><br></pre></td></tr></table></figure>
<h2 id="3-Subscriber-è®¢é˜…">3.Subscriber è®¢é˜…</h2>
<h3 id="ï¼ˆ1ï¼‰åˆ›å»ºSubscriberå¯¹è±¡">ï¼ˆ1ï¼‰åˆ›å»ºSubscriberå¯¹è±¡</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> redis = <span class="built_in">Redis</span>(<span class="string">&quot;tcp://127.0.0.1:6379&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºè®¢é˜…è€…ï¼ˆæ–°å»ºç‹¬ç«‹è¿æ¥ï¼Œä¸ä½¿ç”¨è¿æ¥æ± ï¼‰</span></span><br><span class="line"><span class="keyword">auto</span> sub = redis.<span class="built_in">subscriber</span>();</span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„ï¼ï¼ï¼š</strong></p>
<ul>
<li>å¦‚æœä½ æƒ³æœ‰<strong>ä¸åŒçš„è¿æ¥é€‰é¡¹</strong>ï¼Œæ¯”å¦‚ä¸åŒé¢‘é“çš„ ConnectionOptions::socket_timeout ï¼Œä½ åº”è¯¥åˆ›å»ºå¸¦æœ‰ä¸åŒè¿æ¥é€‰é¡¹çš„ Redis å¯¹è±¡ï¼Œç„¶åä½ å¯ä»¥ç”¨è¿™äº› Redis å¯¹è±¡åˆ›å»ºè®¢é˜…å¯¹è±¡</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é¢‘é“1ï¼š100ms è¶…æ—¶</span></span><br><span class="line">ConnectionOptions opts1;</span><br><span class="line">opts<span class="number">1.</span>host = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">opts<span class="number">1.</span>port = <span class="number">6379</span>;</span><br><span class="line">opts<span class="number">1.</span>socket_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">auto</span> redis1 = <span class="built_in">Redis</span>(opts1);</span><br><span class="line"><span class="keyword">auto</span> sub1 = redis<span class="number">1.</span><span class="built_in">subscriber</span>();  <span class="comment">// ç»§æ‰¿ 100ms è¶…æ—¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é¢‘é“2ï¼š300ms è¶…æ—¶</span></span><br><span class="line">ConnectionOptions opts2;</span><br><span class="line">opts<span class="number">2.</span>host = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">opts<span class="number">2.</span>port = <span class="number">6379</span>;</span><br><span class="line">opts<span class="number">2.</span>socket_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">300</span>);</span><br><span class="line"><span class="keyword">auto</span> redis2 = <span class="built_in">Redis</span>(opts2);</span><br><span class="line"><span class="keyword">auto</span> sub2 = redis<span class="number">2.</span><span class="built_in">subscriber</span>();  <span class="comment">// ç»§æ‰¿ 300ms è¶…æ—¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨æ„âš ï¸ï¼šè™½ç„¶åˆ›å»ºäº†ä¸¤ä¸ª Redis å¯¹è±¡ï¼Œä½†æ²¡æœ‰æ€§èƒ½æŸå¤±</span></span><br><span class="line"><span class="comment">// å› ä¸º Redis å¯¹è±¡æ˜¯æ‡’åŠ è½½çš„ï¼Œåªæœ‰è°ƒç”¨ subscriber() æ—¶æ‰åˆ›å»ºè¿æ¥</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰Subscriberçš„ä½¿ç”¨">ï¼ˆ2ï¼‰Subscriberçš„ä½¿ç”¨</h3>
<h3 id="1-è®¢é˜…é¢‘é“å’Œæ¨¡å¼">&lt;1&gt;è®¢é˜…é¢‘é“å’Œæ¨¡å¼</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¢é˜…å•ä¸ªé¢‘é“</span></span><br><span class="line">sub.<span class="built_in">subscribe</span>(<span class="string">&quot;channel1&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¢é˜…å¤šä¸ªé¢‘é“</span></span><br><span class="line">sub.<span class="built_in">subscribe</span>(&#123;<span class="string">&quot;channel2&quot;</span>, <span class="string">&quot;channel3&quot;</span>, <span class="string">&quot;channel4&quot;</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¢é˜…æ¨¡å¼ï¼ˆæ”¯æŒé€šé…ç¬¦ï¼‰</span></span><br><span class="line">sub.<span class="built_in">psubscribe</span>(<span class="string">&quot;news:*&quot;</span>);      <span class="comment">// åŒ¹é… news:sports, news:tech ç­‰</span></span><br><span class="line">sub.<span class="built_in">psubscribe</span>(<span class="string">&quot;user:*:msg&quot;</span>);  <span class="comment">// åŒ¹é… user:123:msg, user:456:msg ç­‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å–æ¶ˆè®¢é˜…</span></span><br><span class="line">sub.<span class="built_in">unsubscribe</span>(<span class="string">&quot;channel1&quot;</span>);</span><br><span class="line">sub.<span class="built_in">unsubscribe</span>(&#123;<span class="string">&quot;channel2&quot;</span>, <span class="string">&quot;channel3&quot;</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å–æ¶ˆè®¢é˜…æ¨¡å¼</span></span><br><span class="line">sub.<span class="built_in">punsubscribe</span>(<span class="string">&quot;news:*&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å–æ¶ˆæ‰€æœ‰è®¢é˜…ï¼ˆæ— å‚æ•°ï¼‰</span></span><br><span class="line">sub.<span class="built_in">unsubscribe</span>();   <span class="comment">// å–æ¶ˆæ‰€æœ‰é¢‘é“è®¢é˜…</span></span><br><span class="line">sub.<span class="built_in">punsubscribe</span>();  <span class="comment">// å–æ¶ˆæ‰€æœ‰æ¨¡å¼è®¢é˜…</span></span><br></pre></td></tr></table></figure>
<h4 id="2-Subscriberç±»-æ¥æ”¶çš„6ç§æ¶ˆæ¯ç±»å‹">&lt;2&gt; Subscriberç±» æ¥æ”¶çš„6ç§æ¶ˆæ¯ç±»å‹</h4>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114113148877.png" alt=""><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114113623553.png" alt=""></p>
<ul>
<li>Subscriber ç±»æ˜¯æ‰€æœ‰è®¢é˜…æ¶ˆæ¯ï¼ˆ6 ç§ç±»å‹ï¼‰çš„<strong>å”¯ä¸€æ¥æ”¶ä¸»ä½“</strong></li>
<li>Subscriberç±» é€šè¿‡æ¶ˆè´¹æ–¹æ³•ï¼ˆå¦‚ consume()ï¼‰ä¸»åŠ¨è·å–æ¶ˆæ¯ï¼Œä¸”æ¥æ”¶è¿‡ç¨‹ä¸º<strong>é˜»å¡å¼</strong>
<ul>
<li>è°ƒç”¨ consume() åä¼š<strong>ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°æœ‰æ¶ˆæ¯åˆ°è¾¾æˆ–è¶…æ—¶</strong></li>
<li>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ Subscriber å¯¹è±¡éœ€è¦ç‹¬å ä¸€ä¸ªè¿æ¥ï¼ˆ<strong>ä¸ä»è¿æ¥æ± å–</strong>ï¼‰ã€ä¸”<strong>ä¸å»ºè®®å¤šçº¿ç¨‹</strong>å…±ç”¨çš„åŸå› ã€‚</li>
</ul>
</li>
</ul>
<h4 id="3-è®¾ç½®å›è°ƒå‡½æ•°ï¼ˆå¤„ç†6ç§æ¶ˆæ¯ï¼‰">&lt;3&gt;è®¾ç½®å›è°ƒå‡½æ•°ï¼ˆå¤„ç†6ç§æ¶ˆæ¯ï¼‰</h4>
<p><strong>ä¸ºå¤„ç†Subscriberç±»æ¥æ”¶çš„6ç§æ¶ˆæ¯ï¼Œå¯ä»¥åœ¨ Subscriber ä¸Šè®¾ç½®â€œå›è°ƒå‡½æ•°â€</strong></p>
<ul>
<li>
<p><strong>Subscriber::on_message(MsgCallback)</strong>ï¼š</p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼š
<ul>
<li>ä¸º MESSAGE ç±»å‹æ¶ˆæ¯è®¾ç½®å›è°ƒå‡½æ•°</li>
</ul>
</li>
<li><strong>å›è°ƒæ¥å£å®šä¹‰</strong>ï¼š
<ul>
<li>void (std::string channel, std::string msg)</li>
</ul>
</li>
<li>å‚æ•°è¯´æ˜ï¼š<br>
- channelï¼šæ¶ˆæ¯æ‰€å±é¢‘é“<br>
- msgï¼šå®é™…æ¶ˆæ¯å†…å®¹</li>
</ul>
</li>
<li>
<p><strong>Subscriber::on_pmessage(PatternMsgCallback)</strong>ï¼š</p>
<ul>
<li><strong>åŠŸèƒ½</strong>
<ul>
<li>ä¸º PMESSAGE ç±»å‹æ¶ˆæ¯è®¾ç½®å›è°ƒå‡½æ•°</li>
</ul>
</li>
<li><strong>å›è°ƒæ¥å£å®šä¹‰</strong>ï¼š
<ul>
<li>void (std::string pattern, std::string channel, std::string msg)</li>
</ul>
</li>
<li>å‚æ•°è¯´æ˜ï¼š<br>
- patternï¼š åŒ¹é…çš„é¢‘é“æ¨¡å¼<br>
- channelï¼šæ¶ˆæ¯å®é™…æ‰€å±é¢‘é“<br>
- msgï¼šå®é™…æ¶ˆæ¯å†…å®¹ï¼‰</li>
</ul>
</li>
<li>
<p><strong>Subscriber::on_meta(MetaCallback)</strong>ï¼š</p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼š
<ul>
<li>ä¸ºå…ƒæ¶ˆæ¯ï¼ˆMETA MESSAGEï¼‰ç±»å‹è®¾ç½®å›è°ƒå‡½æ•°</li>
</ul>
</li>
<li><strong>å›è°ƒæ¥å£å®šä¹‰</strong>ï¼š
<ul>
<li>void (Subscriber::MsgType type, OptionalString channel, long long num)</li>
</ul>
</li>
<li>å‚æ•°è¯´æ˜ï¼š<br>
- typeï¼šæ¶ˆæ¯ç±»å‹æšä¸¾<br>
- Subscriber::MsgType::SUBSCRIBE<br>
- Subscriber::MsgType::UNSUBSCRIBE<br>
- Subscriber::MsgType::PSUBSCRIBE<br>
- Subscriber::MsgType::PUNSUBSCRIBE<br>
- Subscriber::MsgType::MESSAGEï¼ˆä¸ä¼šè§¦å‘ï¼‰<br>
- Subscriber::MsgType::PMESSAGEï¼ˆä¸ä¼šè§¦å‘ï¼‰<br>
- channelï¼šé¢‘é“/æ¨¡å¼åç§°ï¼ˆOptionalString ç±»å‹ï¼Œå³å¯é€‰å­—ç¬¦ä¸²ï¼‰<br>
- è‹¥æœªè®¢é˜…ä»»ä½•é¢‘é“/æ¨¡å¼ï¼Œä¸”è°ƒç”¨æ— å‚æ•°çš„ unsubscribe/punsubscribeï¼ˆå³å–æ¶ˆæ‰€æœ‰è®¢é˜…ï¼‰æ—¶ï¼Œè¯¥å‚æ•°ä¸º nullï¼›<br>
- numï¼šå½“å‰ä»å¤„äºè®¢é˜…çŠ¶æ€çš„é¢‘é“/æ¨¡å¼æ€»æ•°ã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> sub = redis.<span class="built_in">subscriber</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1ï¸âƒ£ æ™®é€šæ¶ˆæ¯å›è°ƒï¼ˆMESSAGE ç±»å‹ï¼‰</span></span><br><span class="line">sub.<span class="built_in">on_message</span>([](std::string channel, std::string msg) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;é¢‘é“ [&quot;</span> &lt;&lt; channel &lt;&lt; <span class="string">&quot;]: &quot;</span> &lt;&lt; msg &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… å¯ä»¥å®‰å…¨åœ° move è¿™äº›å‚æ•°</span></span><br><span class="line">    <span class="built_in">process</span>(std::<span class="built_in">move</span>(channel), std::<span class="built_in">move</span>(msg));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2ï¸âƒ£ æ¨¡å¼æ¶ˆæ¯å›è°ƒï¼ˆPMESSAGE ç±»å‹ï¼‰</span></span><br><span class="line">sub.<span class="built_in">on_pmessage</span>([](std::string pattern, std::string channel, std::string msg) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;æ¨¡å¼ [&quot;</span> &lt;&lt; pattern &lt;&lt; <span class="string">&quot;] é¢‘é“ [&quot;</span> &lt;&lt; channel &lt;&lt; <span class="string">&quot;]: &quot;</span> &lt;&lt; msg &lt;&lt; std::endl;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3ï¸âƒ£ å…ƒæ¶ˆæ¯å›è°ƒï¼ˆSUBSCRIBE/UNSUBSCRIBE ç­‰ï¼‰</span></span><br><span class="line">sub.<span class="built_in">on_meta</span>([](Subscriber::MsgType type, OptionalString channel, <span class="type">long</span> <span class="type">long</span> num) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">        <span class="keyword">case</span> Subscriber::MsgType::SUBSCRIBE:</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;å·²è®¢é˜…: &quot;</span> &lt;&lt; *channel &lt;&lt; <span class="string">&quot;, å½“å‰è®¢é˜…æ•°: &quot;</span> &lt;&lt; num &lt;&lt; std::endl;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> Subscriber::MsgType::UNSUBSCRIBE:</span><br><span class="line">            <span class="keyword">if</span> (channel) &#123;</span><br><span class="line">                std::cout &lt;&lt; <span class="string">&quot;å·²å–æ¶ˆè®¢é˜…: &quot;</span> &lt;&lt; *channel &lt;&lt; std::endl;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                std::cout &lt;&lt; <span class="string">&quot;å·²å–æ¶ˆæ‰€æœ‰è®¢é˜…&quot;</span> &lt;&lt; std::endl;  <span class="comment">// channel å¯èƒ½ä¸ºç©º</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> Subscriber::MsgType::PSUBSCRIBE:</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;å·²è®¢é˜…æ¨¡å¼: &quot;</span> &lt;&lt; *channel &lt;&lt; std::endl;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> Subscriber::MsgType::PUNSUBSCRIBE:</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;å·²å–æ¶ˆè®¢é˜…æ¨¡å¼&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="4-consume-æ¶ˆè´¹æ¶ˆæ¯">&lt;4&gt;consume æ¶ˆè´¹æ¶ˆæ¯</h4>
<h5 id="1ï¼‰consumeå‡½æ•°æ‰§è¡Œç‰¹ç‚¹">1ï¼‰consumeå‡½æ•°æ‰§è¡Œç‰¹ç‚¹</h5>
<ul>
<li>å¯ä»¥è°ƒç”¨ <strong>Subscriber::consumeæ–¹æ³•</strong>ï¼Œ<strong>æ¶ˆè´¹</strong>å‘å¸ƒåˆ°è¯¥è®¢é˜…è€…å·²è®¢é˜…çš„é¢‘é“ / æ¨¡å¼çš„æ¶ˆæ¯</li>
<li>Subscriber::consume ä¼š<strong>é˜»å¡ç­‰å¾…</strong>åº•å±‚è¿æ¥ä¼ æ¥æ¶ˆæ¯ï¼š
<ul>
<li>è‹¥è¾¾åˆ° ConnectionOptions::socket_timeout è®¾å®šçš„è¶…æ—¶æ—¶é—´ï¼Œä¸”æ— ä»»ä½•æ¶ˆæ¯ä¼ å…¥è¯¥è¿æ¥
<ul>
<li>Subscriber::consume ä¼š<strong>æŠ›å‡º TimeoutError å¼‚å¸¸</strong>ï¼›</li>
</ul>
</li>
<li>è‹¥ ConnectionOptions::socket_timeout è®¾ä¸º 0 æ¯«ç§’
<ul>
<li>Subscriber::consume ä¼š<strong>ä¸€ç›´é˜»å¡ï¼Œç›´åˆ°æ¥æ”¶åˆ°æ¶ˆæ¯ä¸ºæ­¢</strong>ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>æ¥æ”¶åˆ°æ¶ˆæ¯åï¼ŒSubscriber::consume ä¼š<strong>æ ¹æ®æ¶ˆæ¯ç±»å‹è°ƒç”¨â€œå¯¹åº”çš„å›è°ƒå‡½æ•°â€å¤„ç†æ¶ˆæ¯</strong>
<ul>
<li>å¦‚æœä½ æœªä¸ºæŸç±»æ¶ˆæ¯è®¾ç½®å›è°ƒå‡½æ•°ï¼ŒSubscriber::consume ä¼šæ¶ˆè´¹ï¼ˆè¯»å–ï¼‰è¯¥æ¶ˆæ¯å¹¶<strong>ç›´æ¥ä¸¢å¼ƒ</strong></li>
<li>å³ Subscriber::consume <strong>ä¸ä¼šæ‰§è¡Œå›è°ƒï¼Œç›´æ¥è¿”å›</strong></li>
</ul>
</li>
<li>è°ƒç”¨ consume() åä¼š<strong>ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°æœ‰æ¶ˆæ¯åˆ°è¾¾æˆ–è¶…æ—¶</strong>ï¼š
<ul>
<li>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ Subscriber å¯¹è±¡éœ€è¦ç‹¬å ä¸€ä¸ªè¿æ¥ï¼ˆä¸ä»è¿æ¥æ± é€‰å–ï¼‰ã€ä¸”ä¸å»ºè®®å¤šçº¿ç¨‹å…±ç”¨çš„åŸå› ã€‚<br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114171934666.png" alt=""></li>
</ul>
</li>
</ul>
<h5 id="2ï¼‰ä¸å¸¦è¶…æ—¶çš„æ¨¡å¼ï¼ˆè®¾ä¸º0æ¯«ç§’ï¼‰">2ï¼‰ä¸å¸¦è¶…æ—¶çš„æ¨¡å¼ï¼ˆè®¾ä¸º0æ¯«ç§’ï¼‰</h5>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> sub = redis.<span class="built_in">subscriber</span>();</span><br><span class="line"></span><br><span class="line">sub.<span class="built_in">on_message</span>([](std::string channel, std::string msg) &#123;</span><br><span class="line">    std::cout &lt;&lt; channel &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; msg &lt;&lt; std::endl;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">sub.<span class="built_in">subscribe</span>(<span class="string">&quot;channel1&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¶ˆè´¹æ¶ˆæ¯ï¼ˆé˜»å¡ç­‰å¾…ï¼‰</span></span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sub.<span class="built_in">consume</span>();  <span class="comment">// é˜»å¡ç›´åˆ°æ”¶åˆ°æ¶ˆæ¯</span></span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> Error&amp; err) &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;é”™è¯¯: &quot;</span> &lt;&lt; err.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="3ï¼‰å¸¦è¶…æ—¶çš„æ¨¡å¼">3ï¼‰å¸¦è¶…æ—¶çš„æ¨¡å¼</h5>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®è¶…æ—¶</span></span><br><span class="line">ConnectionOptions opts;</span><br><span class="line">opts.host = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">opts.port = <span class="number">6379</span>;</span><br><span class="line">opts.socket_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">1000</span>);  <span class="comment">// 1ç§’è¶…æ—¶</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> redis = <span class="built_in">Redis</span>(opts);</span><br><span class="line"><span class="keyword">auto</span> sub = redis.<span class="built_in">subscriber</span>();</span><br><span class="line"></span><br><span class="line">sub.<span class="built_in">on_message</span>([](std::string channel, std::string msg) &#123;</span><br><span class="line">    std::cout &lt;&lt; channel &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; msg &lt;&lt; std::endl;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">sub.<span class="built_in">subscribe</span>(<span class="string">&quot;channel1&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sub.<span class="built_in">consume</span>();</span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> TimeoutError&amp; e) &#123;</span><br><span class="line">        <span class="comment">// è¶…æ—¶ä¸æ˜¯é”™è¯¯ï¼Œç»§ç»­ç­‰å¾…</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;ç­‰å¾…æ¶ˆæ¯ä¸­...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> ReplyError&amp; e) &#123;</span><br><span class="line">        <span class="comment">// Redis è¿”å›é”™è¯¯ï¼Œå¯ä»¥ç»§ç»­ä½¿ç”¨ sub</span></span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;Redis é”™è¯¯: &quot;</span> &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> Error&amp; e) &#123;</span><br><span class="line">        <span class="comment">// âš ï¸ å…¶ä»–é”™è¯¯ï¼šå¿…é¡»é”€æ¯å¹¶é‡å»º Subscriber</span></span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;ä¸¥é‡é”™è¯¯: &quot;</span> &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="4ï¼‰æ¶ˆæ¯æµå‘å®Œæ•´å›¾ç¤º">4ï¼‰æ¶ˆæ¯æµå‘å®Œæ•´å›¾ç¤º</h5>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114143816994.png" alt=""><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114143840833.png" alt=""></p>
<h4 id="5-å®Œæ•´ç¤ºä¾‹">&lt;5&gt;å®Œæ•´ç¤ºä¾‹</h4>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sw/redis++/redis++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> sw::redis;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        ConnectionOptions opts;</span><br><span class="line">        opts.host = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">        opts.port = <span class="number">6379</span>;</span><br><span class="line">        opts.socket_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">auto</span> redis = <span class="built_in">Redis</span>(opts);</span><br><span class="line">        <span class="keyword">auto</span> sub = redis.<span class="built_in">subscriber</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½®æ‰€æœ‰å›è°ƒ</span></span><br><span class="line">        sub.<span class="built_in">on_message</span>([](std::string channel, std::string msg) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;[MESSAGE] &quot;</span> &lt;&lt; channel &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; msg &lt;&lt; std::endl;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        sub.<span class="built_in">on_pmessage</span>([](std::string pattern, std::string channel, std::string msg) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;[PMESSAGE] &quot;</span> &lt;&lt; pattern &lt;&lt; <span class="string">&quot; -&gt; &quot;</span> &lt;&lt; channel &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; msg &lt;&lt; std::endl;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        sub.<span class="built_in">on_meta</span>([](Subscriber::MsgType type, OptionalString channel, <span class="type">long</span> <span class="type">long</span> num) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;[META] ç±»å‹=&quot;</span> &lt;&lt; <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(type) </span><br><span class="line">                      &lt;&lt; <span class="string">&quot;, é¢‘é“=&quot;</span> &lt;&lt; (channel ? *channel : <span class="string">&quot;null&quot;</span>)</span><br><span class="line">                      &lt;&lt; <span class="string">&quot;, æ•°é‡=&quot;</span> &lt;&lt; num &lt;&lt; std::endl;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¢é˜…</span></span><br><span class="line">        sub.<span class="built_in">subscribe</span>(<span class="string">&quot;chat&quot;</span>);</span><br><span class="line">        sub.<span class="built_in">psubscribe</span>(<span class="string">&quot;news:*&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¶ˆè´¹å¾ªç¯</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;å¼€å§‹ç›‘å¬æ¶ˆæ¯...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                sub.<span class="built_in">consume</span>();</span><br><span class="line">            &#125; <span class="built_in">catch</span> (<span class="type">const</span> TimeoutError&amp;) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> Error&amp; e) &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;é”™è¯¯: &quot;</span> &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰Subscriber-ä½¿ç”¨æ³¨æ„äº‹é¡¹">ï¼ˆ3ï¼‰Subscriber ä½¿ç”¨æ³¨æ„äº‹é¡¹</h3>
<h4 id="1-éçº¿ç¨‹å®‰å…¨">&lt;1&gt;éçº¿ç¨‹å®‰å…¨</h4>
<ul>
<li><strong>Subscriber</strong>ï¼ˆè®¢é˜…è€…ï¼‰å¯¹è±¡æ˜¯ <strong>éçº¿ç¨‹å®‰å…¨</strong>çš„ã€‚å¦‚æœä½ å¸Œæœ›åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­è°ƒç”¨å…¶æˆå‘˜å‡½æ•°ï¼Œéœ€è¦<strong>æ‰‹åŠ¨å®ç°çº¿ç¨‹é—´çš„åŒæ­¥</strong></li>
</ul>
<h4 id="2-ç‰¹å®šExceptionåä¸å¯å¤ç”¨">&lt;2&gt;ç‰¹å®šExceptionåä¸å¯å¤ç”¨</h4>
<ul>
<li>å¦‚æœ <strong>Subscriberï¼ˆè®¢é˜…è€…ï¼‰å¯¹è±¡</strong>çš„ä»»æ„æ–¹æ³•æŠ›å‡ºäº†**â€œéâ€** ReplyErrorï¼ˆå›å¤é”™è¯¯ï¼‰æˆ– TimeoutErrorï¼ˆè¶…æ—¶é”™è¯¯ï¼‰ç±»å‹çš„å¼‚å¸¸ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡<strong>å°†æ— æ³•å†ç»§ç»­ä½¿ç”¨</strong>ã€‚æ­¤æ—¶ä½ <strong>å¿…é¡»é”€æ¯</strong>è¿™ä¸ª Subscriber å¯¹è±¡ï¼Œå¹¶<strong>é‡æ–°åˆ›å»º</strong>ä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    sub.<span class="built_in">consume</span>();</span><br><span class="line">&#125; <span class="built_in">catch</span> (<span class="type">const</span> TimeoutError&amp; e) &#123;</span><br><span class="line">    <span class="comment">// âœ… å¯ä»¥ç»§ç»­ä½¿ç”¨ sub</span></span><br><span class="line">&#125; <span class="built_in">catch</span> (<span class="type">const</span> ReplyError&amp; e) &#123;</span><br><span class="line">    <span class="comment">// âœ… å¯ä»¥ç»§ç»­ä½¿ç”¨ sub</span></span><br><span class="line">&#125; <span class="built_in">catch</span> (<span class="type">const</span> Error&amp; e) &#123;</span><br><span class="line">    <span class="comment">// âŒ å¿…é¡»é”€æ¯å¹¶é‡å»º sub</span></span><br><span class="line">    sub = redis.<span class="built_in">subscriber</span>();</span><br><span class="line">    sub.<span class="built_in">on_message</span>(...);  <span class="comment">// é‡æ–°è®¾ç½®å›è°ƒ</span></span><br><span class="line">    sub.<span class="built_in">subscribe</span>(<span class="string">&quot;channel1&quot;</span>);  <span class="comment">// é‡æ–°è®¢é˜…</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114143913218.png" alt=""></p>
<h4 id="3-consumeæ¶ˆè´¹æ˜¯â€œé˜»å¡çš„â€">&lt;3&gt;consumeæ¶ˆè´¹æ˜¯â€œé˜»å¡çš„â€</h4>
<ul>
<li>è°ƒç”¨ consume() åä¼š<strong>ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°æœ‰æ¶ˆæ¯åˆ°è¾¾æˆ–è¶…æ—¶</strong></li>
<li>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ Subscriber å¯¹è±¡éœ€è¦ç‹¬å ä¸€ä¸ªè¿æ¥ï¼ˆ<strong>ä¸ä»è¿æ¥æ± å–</strong>ï¼‰ã€ä¸”<strong>ä¸å»ºè®®å¤šçº¿ç¨‹</strong>å…±ç”¨çš„åŸå› ã€‚</li>
</ul>
<h1>åä¸€ã€Redis++ Pipelineï¼ˆç®¡é“ï¼‰</h1>
<h2 id="1-æ¦‚è¿°-2">1.æ¦‚è¿°</h2>
<ul>
<li>Pipeline ç”¨äºå‡å°‘ RTTï¼ˆå¾€è¿”æ—¶é—´ï¼‰ï¼Œ<strong>åŠ é€Ÿ Redis æŸ¥è¯¢</strong>ã€‚</li>
<li>é€šè¿‡å°†å¤šä¸ªå‘½ä»¤<strong>æ‰¹é‡å‘é€</strong>ï¼Œä¸€æ¬¡æ€§è·å–æ‰€æœ‰å›å¤ï¼Œé¿å…æ¯ä¸ªå‘½ä»¤éƒ½ç­‰å¾…ç½‘ç»œå¾€è¿”ã€‚</li>
</ul>
<h2 id="2-åˆ›å»ºPipeline">2.åˆ›å»ºPipeline</h2>
<ul>
<li>å¯ä»¥é€šè¿‡ <code>Redis::pipeline</code> æ–¹æ³•åˆ›å»ºä¸€ä¸ªpipelineï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ª<strong>pipelineå¯¹è±¡</strong></li>
<li>é€šè¿‡ <code>Redis::pipeline</code> æ–¹æ³•ä¼šåˆ›å»ºçš„pipelineï¼Œæ˜¯ä¸€ä¸ª<strong>æ–°çš„RedisæœåŠ¡è¿æ¥</strong>ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨è¿æ¥æ± ä¸­çš„è¿æ¥
<ul>
<li>è¯¥è¿æ¥ä¸è¿æ¥æ± ä¸­å…¶å®ƒè¿æ¥æ‹¥æœ‰ç›¸åŒçš„<code>ConnectionOptions</code></li>
</ul>
</li>
<li><strong>æœ€å¥½å°½å¯èƒ½å¤ç”¨åŒä¸€ä¸ªâ€œpipelineå¯¹è±¡â€ï¼ï¼</strong>
<ul>
<li>å› ä¸ºåˆ›å»ºä¸€ä¸ªç®¡é“å¯¹è±¡å¹¶ä¸ä¾¿å®œï¼Œå› ä¸ºå®ƒä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥</li>
</ul>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">ConnectionOptions connection_options;</span><br><span class="line">ConnectionPoolOptions pool_options;</span><br><span class="line"></span><br><span class="line"><span class="function">Redis <span class="title">redis</span><span class="params">(connection_options, pool_options)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> pipe = redis.<span class="built_in">pipeline</span>();</span><br></pre></td></tr></table></figure>
<p><strong>è¡¥å……ï¼š</strong></p>
<ul>
<li>åˆ›å»ºpipelineæ˜¯ï¼Œå¯ä»¥ç›´æ¥ä»è¿æ¥æ± è·å–è¿æ¥è€Œä¸åˆ›å»ºæ–°è¿æ¥</li>
<li><a href="#pipeline_from_pool">ç”¨è¿æ¥æ± ä¸­è¿æ¥åˆ›å»ºpipeline</a>
<ul>
<li>âš ï¸ æ­¤æ–¹å¼æœ‰æ­»é”é£é™©</li>
</ul>
</li>
</ul>
<h2 id="3-é€šè¿‡pipelineå‘é€å‘½ä»¤">3.é€šè¿‡pipelineå‘é€å‘½ä»¤</h2>
<ul>
<li>é€šè¿‡ Pipeline å¯¹è±¡å‘é€ Redis å‘½ä»¤ å’Œ Redis ç±»ä¸€æ ·ã€‚</li>
<li><strong>Pipeline çš„è®¾è®¡</strong>:
<ul>
<li>å…ˆæ‰¹é‡æ·»åŠ å‘½ä»¤ï¼Œå†ä¸€æ¬¡æ€§æ‰§è¡Œå¹¶è·å–ç»“æœ</li>
</ul>
</li>
<li><strong>é“¾å¼è°ƒç”¨</strong>ï¼š
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼š
<ul>
<li><strong>å°†å‘½ä»¤æ‰¹é‡æ·»åŠ åˆ°pipelineä¸­</strong>ï¼ˆæœªå‘é€ï¼ï¼‰</li>
</ul>
</li>
<li>é€šè¿‡â€œPipelineå¯¹è±¡â€è°ƒç”¨æ–¹æ³•ï¼Œä¸ä¼šç›´æ¥è¿”å›å“åº”ï¼Œè€Œæ˜¯<strong>è¿”å› Pipeline å¯¹è±¡æœ¬èº«</strong>ï¼Œè¿™æ ·ä½ å°±å¯ä»¥<strong>é“¾å¼è°ƒç”¨</strong>è¿™äº›æ–¹æ³•</li>
</ul>
</li>
<li><strong><code>Pipeline::exec</code>æ–¹æ³•</strong>ï¼š
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼š
<ul>
<li><strong>å°†pipelineä¸­æ‰€æœ‰å·²ç¼“å­˜çš„å‘½ä»¤å‘é€åˆ°Redisï¼Œå¹¶è¿”å›æ‰¹é‡æ‰§è¡Œçš„ç»“æœ</strong></li>
</ul>
</li>
</ul>
</li>
<li><strong><code>Pipeline::discard</code>æ–¹æ³•</strong>ï¼š
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼š
<ul>
<li><strong>ä¸¢å¼ƒpipelineä¸­æ‰€æœ‰ç¼“å­˜çš„å‘½ä»¤</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">ConnectionOptions connection_options;</span><br><span class="line">ConnectionPoolOptions pool_options;</span><br><span class="line"></span><br><span class="line"><span class="function">Redis <span class="title">redis</span><span class="params">(connection_options, pool_options)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> pipe = redis.<span class="built_in">pipeline</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ================= æ–¹å¼1ï¼šæ·»åŠ ä¸æ‰§è¡Œé“¾å¼è°ƒç”¨ ===================</span></span><br><span class="line"><span class="keyword">auto</span> replies = pipe.<span class="built_in">set</span>(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;val&quot;</span>)</span><br><span class="line">    .<span class="built_in">incr</span>(<span class="string">&quot;counter&quot;</span>)</span><br><span class="line">    .<span class="built_in">rpush</span>(<span class="string">&quot;list&quot;</span>, &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;)</span><br><span class="line">    .<span class="built_in">hset</span>(<span class="string">&quot;hash&quot;</span>, <span class="string">&quot;field&quot;</span>, <span class="string">&quot;value&quot;</span>)</span><br><span class="line">    .<span class="built_in">command</span>(<span class="string">&quot;client&quot;</span>, <span class="string">&quot;setname&quot;</span>, <span class="string">&quot;app&quot;</span>)</span><br><span class="line">    .<span class="built_in">exec</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ================= æ–¹å¼2ï¼š æ·»åŠ ä¸æ‰§è¡Œåˆ†å¼€è°ƒç”¨ ===================</span></span><br><span class="line"><span class="comment">// é“¾å¼è°ƒç”¨ï¼šæ·»åŠ å¤šä¸ªå‘½ä»¤ï¼ˆè¿˜æœªæ‰§è¡Œï¼‰</span></span><br><span class="line">pipe.<span class="built_in">set</span>(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;val&quot;</span>)</span><br><span class="line">    .<span class="built_in">incr</span>(<span class="string">&quot;counter&quot;</span>)</span><br><span class="line">    .<span class="built_in">rpush</span>(<span class="string">&quot;list&quot;</span>, &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;)</span><br><span class="line">    .<span class="built_in">hset</span>(<span class="string">&quot;hash&quot;</span>, <span class="string">&quot;field&quot;</span>, <span class="string">&quot;value&quot;</span>)</span><br><span class="line">    .<span class="built_in">command</span>(<span class="string">&quot;client&quot;</span>, <span class="string">&quot;setname&quot;</span>, <span class="string">&quot;app&quot;</span>);  <span class="comment">// é€šç”¨å‘½ä»¤æ¥å£</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨ exec() å‘é€å‘½ä»¤å¹¶è·å–å›å¤</span></span><br><span class="line"><span class="keyword">auto</span> replies = pipe.<span class="built_in">exec</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ================= ä¸¢å¼ƒç®¡é“ä¸­çš„å‘½ä»¤ ===================</span></span><br><span class="line">pipe.<span class="built_in">set</span>(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;val&quot;</span>).<span class="built_in">incr</span>(<span class="string">&quot;num&quot;</span>);</span><br><span class="line"></span><br><span class="line">pipe.<span class="built_in">discard</span>();</span><br></pre></td></tr></table></figure>
<p><strong>exec() æ‰§è¡Œæµç¨‹</strong></p>
<ul>
<li>å‘é€æ‰€æœ‰å·²ç¼“å­˜çš„å‘½ä»¤åˆ° Redis</li>
<li>æ¥æ”¶æ‰€æœ‰å‘½ä»¤çš„å›å¤</li>
<li>è¿”å› <code>QueuedReplies</code>å¯¹è±¡</li>
</ul>
<p><a id="parse_pipeline_result"></a></p>
<h2 id="4-è§£æpipelineæ‰§è¡Œç»“æœ">4.è§£æpipelineæ‰§è¡Œç»“æœ</h2>
<ul>
<li>Pipeline::exec è¿”å›ä¸€ä¸ª <code>QueuedReplylies</code>å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«æ‰€æœ‰å‘é€åˆ° Redis å‘½ä»¤çš„å›å¤</li>
<li>é€šè¿‡ <code>QueuedReplies::get</code> æ–¹æ³•æ¥è·å–å¹¶è§£æå›å¤</li>
<li><code>ueuedReplies</code> æä¾› 3 ç§ get() æ–¹æ³•ï¼š<br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114151808620.png" alt=""><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114152209995.png" alt=""></li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">ConnectionOptions connection_options;</span><br><span class="line">ConnectionPoolOptions pool_options;</span><br><span class="line"></span><br><span class="line"><span class="function">Redis <span class="title">redis</span><span class="params">(connection_options, pool_options)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> pipe = redis.<span class="built_in">pipeline</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> replies = pipe.<span class="built_in">set</span>(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;val&quot;</span>)      <span class="comment">// 0: SET â†’ bool</span></span><br><span class="line">                   .<span class="built_in">incr</span>(<span class="string">&quot;counter&quot;</span>)        <span class="comment">// 1: INCR â†’ long long</span></span><br><span class="line">                   .<span class="built_in">lrange</span>(<span class="string">&quot;list&quot;</span>, <span class="number">0</span>, <span class="number">-1</span>)  <span class="comment">// 2: LRANGE â†’ vector</span></span><br><span class="line">                   .<span class="built_in">get</span>(<span class="string">&quot;key&quot;</span>)             <span class="comment">// 3: GET â†’ OptionalString</span></span><br><span class="line">                   .<span class="built_in">exec</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£æå„ä¸ªå›å¤</span></span><br><span class="line"><span class="type">bool</span> set_ok = replies.<span class="built_in">get</span>&lt;<span class="type">bool</span>&gt;(<span class="number">0</span>);</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> counter = replies.<span class="built_in">get</span>&lt;<span class="type">long</span> <span class="type">long</span>&gt;(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">std::vector&lt;std::string&gt; list_items;</span><br><span class="line">replies.<span class="built_in">get</span>(<span class="number">2</span>, std::<span class="built_in">back_inserter</span>(list_items));</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> val = replies.<span class="built_in">get</span>&lt;OptionalString&gt;(<span class="number">3</span>);</span><br><span class="line"><span class="keyword">if</span> (val) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;key = &quot;</span> &lt;&lt; *val &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a id="return_mechanism"></a></p>
<h2 id="5-è¿æ¥å½’è¿˜æœºåˆ¶">5.è¿æ¥å½’è¿˜æœºåˆ¶</h2>
<ul>
<li>å½“pipelineæ‰§è¡Œexecã€discardã€å¯¹è±¡ææ„ã€æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œä¼šå½’è¿˜è¿æ¥ï¼ˆä¸»è¦é’ˆå¯¹â€œè¿æ¥æ± â€æ¨¡å¼ï¼‰<br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114170235009.png" alt=""></li>
</ul>
<h3 id="ï¼ˆ1ï¼‰ä¸¤ç§åˆ›å»ºæ–¹å¼çš„åŒºåˆ«">ï¼ˆ1ï¼‰ä¸¤ç§åˆ›å»ºæ–¹å¼çš„åŒºåˆ«</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ–¹å¼1ï¼šé»˜è®¤åˆ›å»ºï¼ˆæ–°å»ºè¿æ¥ï¼‰</span></span><br><span class="line"><span class="keyword">auto</span> pipe = redis.<span class="built_in">pipeline</span>();        <span class="comment">// åˆ›å»ºæ–°è¿æ¥ï¼Œä¸ä»è¿æ¥æ± å–</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼2ï¼šä½¿ç”¨è¿æ¥æ± </span></span><br><span class="line"><span class="keyword">auto</span> pipe = redis.<span class="built_in">pipeline</span>(<span class="literal">false</span>);   <span class="comment">// ä»è¿æ¥æ± å€Ÿç”¨è¿æ¥</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰-å½’è¿˜è¿æ¥-åªå¯¹è¿æ¥æ± æ¨¡å¼æœ‰æ„ä¹‰">ï¼ˆ2ï¼‰&quot;å½’è¿˜è¿æ¥&quot;åªå¯¹è¿æ¥æ± æ¨¡å¼æœ‰æ„ä¹‰</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114170102888.png" alt=""></p>
<h3 id="ï¼ˆ3ï¼‰-å½’è¿˜-çš„å…·ä½“å«ä¹‰">ï¼ˆ3ï¼‰&quot;å½’è¿˜&quot;çš„å…·ä½“å«ä¹‰</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">ConnectionPoolOptions pool_opts;</span><br><span class="line">pool_opts.size = <span class="number">3</span>;  <span class="comment">// è¿æ¥æ± æœ‰ 3 ä¸ªè¿æ¥</span></span><br><span class="line"></span><br><span class="line"><span class="function">Redis <span class="title">redis</span><span class="params">(opts, pool_opts)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨è¿æ¥æ± æ¨¡å¼åˆ›å»º Pipeline</span></span><br><span class="line"><span class="keyword">auto</span> pipe = redis.<span class="built_in">pipeline</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­¤æ—¶ï¼šPipeline ä»è¿æ¥æ± &quot;å€Ÿèµ°&quot;äº†ä¸€ä¸ªè¿æ¥</span></span><br><span class="line"><span class="comment">// è¿æ¥æ± çŠ¶æ€ï¼š[è¿æ¥1][è¿æ¥2][ ç©º ]  â† åªå‰© 2 ä¸ªå¯ç”¨</span></span><br><span class="line"></span><br><span class="line">pipe.<span class="built_in">set</span>(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;val&quot;</span>).<span class="built_in">incr</span>(<span class="string">&quot;num&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œ exec()</span></span><br><span class="line"><span class="keyword">auto</span> replies = pipe.<span class="built_in">exec</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// exec() å®Œæˆåï¼šè¿æ¥&quot;å½’è¿˜&quot;åˆ°è¿æ¥æ± </span></span><br><span class="line"><span class="comment">// è¿æ¥æ± çŠ¶æ€ï¼š[è¿æ¥1][è¿æ¥2][è¿æ¥3]  â† æ¢å¤ 3 ä¸ªå¯ç”¨</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ4ï¼‰-ä¸ºä»€ä¹ˆ-å½’è¿˜-å¾ˆé‡è¦ï¼Ÿ">ï¼ˆ4ï¼‰ ä¸ºä»€ä¹ˆ&quot;å½’è¿˜&quot;å¾ˆé‡è¦ï¼Ÿ</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¿æ¥æ± åªæœ‰ 3 ä¸ªè¿æ¥</span></span><br><span class="line"><span class="function">Redis <span class="title">redis</span><span class="params">(opts, pool_opts)</span></span>;  <span class="comment">// pool_opts.size = 3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> pipe1 = redis.<span class="built_in">pipeline</span>(<span class="literal">false</span>);  <span class="comment">// å€Ÿèµ°è¿æ¥ #1</span></span><br><span class="line"><span class="keyword">auto</span> pipe2 = redis.<span class="built_in">pipeline</span>(<span class="literal">false</span>);  <span class="comment">// å€Ÿèµ°è¿æ¥ #2</span></span><br><span class="line"><span class="keyword">auto</span> pipe3 = redis.<span class="built_in">pipeline</span>(<span class="literal">false</span>);  <span class="comment">// å€Ÿèµ°è¿æ¥ #3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿æ¥æ± å·²ç©ºï¼</span></span><br><span class="line"></span><br><span class="line">pipe<span class="number">1.</span><span class="built_in">set</span>(<span class="string">&quot;k1&quot;</span>, <span class="string">&quot;v1&quot;</span>);</span><br><span class="line">pipe<span class="number">2.</span><span class="built_in">set</span>(<span class="string">&quot;k2&quot;</span>, <span class="string">&quot;v2&quot;</span>);</span><br><span class="line">pipe<span class="number">3.</span><span class="built_in">set</span>(<span class="string">&quot;k3&quot;</span>, <span class="string">&quot;v3&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ è¿™é‡Œä¼šé˜»å¡æˆ–è¶…æ—¶ï¼å› ä¸ºè¿æ¥æ± æ²¡æœ‰å¯ç”¨è¿æ¥</span></span><br><span class="line">redis.<span class="built_in">get</span>(<span class="string">&quot;key&quot;</span>);  <span class="comment">// ç­‰å¾…è¿æ¥...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¿…é¡»å…ˆæ‰§è¡Œ exec() å½’è¿˜è¿æ¥</span></span><br><span class="line">pipe<span class="number">1.</span><span class="built_in">exec</span>();  <span class="comment">// å½’è¿˜è¿æ¥ #1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… ç°åœ¨å¯ä»¥äº†</span></span><br><span class="line">redis.<span class="built_in">get</span>(<span class="string">&quot;key&quot;</span>);  <span class="comment">// è·å–åˆ°è¿æ¥ #1</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ5ï¼‰å½’è¿˜ä¹‹åå†æ¬¡è§¦å‘å‘¢ï¼Ÿ">ï¼ˆ5ï¼‰å½’è¿˜ä¹‹åå†æ¬¡è§¦å‘å‘¢ï¼Ÿ</h3>
<ul>
<li>å½’è¿˜è¿æ¥åï¼ŒPipelineå¯¹è±¡ä»ç„¶å­˜åœ¨ï¼Œå¯ä»¥ç»§ç»­ä½¿ç”¨ï¼</li>
<li>è°ƒç”¨ exec() æˆ– discard() åï¼š
<ul>
<li>è¿æ¥è¢«å½’è¿˜åˆ°è¿æ¥æ± </li>
<li>ä¸‹æ¬¡è°ƒç”¨å‘½ä»¤æ—¶ï¼Œä¼šé‡æ–°ä»è¿æ¥æ± å€Ÿç”¨è¿æ¥</li>
</ul>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">Redis <span class="title">redis</span><span class="params">(opts, pool_opts)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> pipe = redis.<span class="built_in">pipeline</span>(<span class="literal">false</span>);  <span class="comment">// ä»è¿æ¥æ± å€Ÿç”¨è¿æ¥ #1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬ä¸€æ‰¹å‘½ä»¤</span></span><br><span class="line">pipe.<span class="built_in">set</span>(<span class="string">&quot;k1&quot;</span>, <span class="string">&quot;v1&quot;</span>).<span class="built_in">set</span>(<span class="string">&quot;k2&quot;</span>, <span class="string">&quot;v2&quot;</span>);</span><br><span class="line"><span class="keyword">auto</span> replies1 = pipe.<span class="built_in">exec</span>();  <span class="comment">// æ‰§è¡Œåï¼Œè¿æ¥ #1 å½’è¿˜åˆ°æ± </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… Pipeline å¯¹è±¡ä»å¯ä½¿ç”¨ï¼</span></span><br><span class="line"><span class="comment">// ç¬¬äºŒæ‰¹å‘½ä»¤ï¼ˆä¼šé‡æ–°ä»è¿æ¥æ± å€Ÿç”¨è¿æ¥ï¼Œå¯èƒ½æ˜¯ #1ï¼Œä¹Ÿå¯èƒ½æ˜¯ #2ã€#3ï¼‰</span></span><br><span class="line">pipe.<span class="built_in">set</span>(<span class="string">&quot;k3&quot;</span>, <span class="string">&quot;v3&quot;</span>).<span class="built_in">incr</span>(<span class="string">&quot;counter&quot;</span>);</span><br><span class="line"><span class="keyword">auto</span> replies2 = pipe.<span class="built_in">exec</span>();  <span class="comment">// æ‰§è¡Œåï¼Œè¿æ¥å†æ¬¡å½’è¿˜</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… å¯ä»¥ä¸€ç›´è¿™æ ·å¤ç”¨</span></span><br><span class="line">pipe.<span class="built_in">get</span>(<span class="string">&quot;k1&quot;</span>).<span class="built_in">get</span>(<span class="string">&quot;k2&quot;</span>);</span><br><span class="line"><span class="keyword">auto</span> replies3 = pipe.<span class="built_in">exec</span>();</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114170533657.png" alt=""></p>
<h2 id="6-pipeline-ä½¿ç”¨æ³¨æ„äº‹é¡¹">6.pipeline ä½¿ç”¨æ³¨æ„äº‹é¡¹</h2>
<h3 id="ï¼ˆ1ï¼‰ç‰¹å®šExceptionåä¸å¯å¤ç”¨">ï¼ˆ1ï¼‰ç‰¹å®šExceptionåä¸å¯å¤ç”¨</h3>
<ul>
<li>å¦‚æœpipelineçš„ä»»ä½•æ–¹æ³•æŠ›å‡ºé™¤ ReplyError ä»¥å¤–çš„å¼‚å¸¸ï¼Œ ç®¡é“å¯¹è±¡å°†è¿›å…¥æ— æ•ˆçŠ¶æ€
<ul>
<li>ä¸èƒ½å†ä½¿ç”¨å®ƒäº†ï¼Œåªèƒ½æ‘§æ¯è¯¥ç‰©ä½“ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„</li>
</ul>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">auto</span> replies = pipe.<span class="built_in">set</span>(<span class="string">&quot;k&quot;</span>, <span class="string">&quot;v&quot;</span>).<span class="built_in">incr</span>(<span class="string">&quot;n&quot;</span>).<span class="built_in">exec</span>();</span><br><span class="line">&#125; <span class="built_in">catch</span> (<span class="type">const</span> ReplyError&amp; e) &#123;</span><br><span class="line">    <span class="comment">// âœ… ReplyErrorï¼šPipeline ä»å¯ä½¿ç”¨</span></span><br><span class="line">    std::cerr &lt;&lt; <span class="string">&quot;Redis è¿”å›é”™è¯¯: &quot;</span> &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">&#125; <span class="built_in">catch</span> (<span class="type">const</span> Error&amp; e) &#123;</span><br><span class="line">    <span class="comment">// âŒ å…¶ä»–å¼‚å¸¸ï¼šPipeline è¿›å…¥æ— æ•ˆçŠ¶æ€ï¼Œå¿…é¡»é”€æ¯é‡å»º</span></span><br><span class="line">    std::cerr &lt;&lt; <span class="string">&quot;ä¸¥é‡é”™è¯¯: &quot;</span> &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">    pipe = redis.<span class="built_in">pipeline</span>();  <span class="comment">// é‡æ–°åˆ›å»º</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114153043892.png" alt=""></p>
<h3 id="ï¼ˆ2ï¼‰éçº¿ç¨‹å®‰å…¨">ï¼ˆ2ï¼‰éçº¿ç¨‹å®‰å…¨</h3>
<ul>
<li>Pipeline <strong>ä¸æ˜¯çº¿ç¨‹å®‰å…¨</strong>çš„</li>
<li>å¦‚æœä½ æƒ³åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­è°ƒç”¨å…¶æˆå‘˜å‡½æ•°ï¼Œå°±éœ€è¦åœ¨çº¿ç¨‹é—´æ‰‹åŠ¨åŒæ­¥</li>
</ul>
<p><a id="pipeline_from_pool"></a></p>
<h2 id="5-åˆ›å»ºç®¡é“è€Œä¸åˆ›å»ºæ–°è¿æ¥">5.åˆ›å»ºç®¡é“è€Œä¸åˆ›å»ºæ–°è¿æ¥</h2>
<h3 id="ï¼ˆ1ï¼‰ç”¨è¿æ¥æ± ä¸­çš„è¿æ¥åˆ›å»ºpipelineå¯¹è±¡ï¼ˆæœ‰æ­»é”é£é™©ï¼‰">ï¼ˆ1ï¼‰ç”¨è¿æ¥æ± ä¸­çš„è¿æ¥åˆ›å»ºpipelineå¯¹è±¡ï¼ˆæœ‰æ­»é”é£é™©ï¼‰</h3>
<ul>
<li>å¯ä»¥åˆ›å»ºä¸€ä¸ªå¸¦æœ‰åº•å±‚è¿æ¥æ± è¿æ¥çš„ç®¡é“å¯¹è±¡ï¼Œè¿™æ ·è°ƒç”¨ Redis::pipeline æ–¹æ³•å¯ä»¥ä¾¿å®œå¾—å¤šï¼ˆå› ä¸ºå®ƒä¸éœ€è¦æ–°å»ºè¿æ¥ï¼‰</li>
<li><strong>Pipeline pipeline(bool new_connection = true)</strong>
<ul>
<li>å¦‚æœ new_connection ä¸ºå‡ï¼Œ ç®¡é“å¯¹è±¡å°†ä¸åº•å±‚æ± çš„è¿æ¥åˆ›å»ºã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">ConnectionOptions connection_options;</span><br><span class="line">ConnectionPoolOptions pool_options;</span><br><span class="line"></span><br><span class="line"><span class="function">Redis <span class="title">redis</span><span class="params">(connection_options, pool_options)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼ å…¥ falseï¼Œä»è¿æ¥æ± è·å–è¿æ¥</span></span><br><span class="line"><span class="comment">//âš ï¸åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¿…é¡»éå¸¸å°å¿ƒï¼Œå¦åˆ™å¯èƒ½ä¼šè¡¨ç°ä¸ä½³ç”šè‡³æ­»é”</span></span><br><span class="line"><span class="keyword">auto</span> pipe = redis.<span class="built_in">pipeline</span>(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<p><a id="dead_lock"></a></p>
<h3 id="ï¼ˆ2ï¼‰æ­»é”é£é™©">ï¼ˆ2ï¼‰æ­»é”é£é™©</h3>
<ul>
<li>å½“ä½ ç”¨ Pipeline å¯¹è±¡æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œå®ƒä¼šä¿ç•™è¿æ¥ï¼Œç›´åˆ°è°ƒç”¨ Pipeline::execã€Pipeline::discard æˆ– Pipeline çš„ destructor
<ul>
<li>å¦‚æœ Pipeline çš„ä»»ä½•æ–¹æ³•æŠ›å‡ºå¼‚å¸¸ ï¼Œè¿æ¥ä¹Ÿä¼šè¢«é‡Šæ”¾</li>
</ul>
</li>
<li>å¦‚æœç®¡é“å¯¹è±¡é•¿æ—¶é—´ä¿æŒè¿æ¥ï¼Œå…¶ä»– Redis æ–¹æ³•å¯èƒ½æ— æ³•ä»åº•å±‚æ± è·å–è¿æ¥ã€‚</li>
</ul>
<p><strong>æ­»é”ç¤ºä¾‹ï¼ˆâŒ é”™è¯¯ç”¨æ³•ï¼‰</strong>ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é»˜è®¤åªæœ‰ 1 ä¸ªè¿æ¥ï¼Œwait_timeout = 0ï¼ˆæ°¸ä¹…ç­‰å¾…ï¼‰</span></span><br><span class="line"><span class="function">Redis <span class="title">redis</span><span class="params">(<span class="string">&quot;tcp://127.0.0.1&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> pipe = redis.<span class="built_in">pipeline</span>(<span class="literal">false</span>);  <span class="comment">// ä»è¿æ¥æ± å–è¿æ¥</span></span><br><span class="line"></span><br><span class="line">pipe.<span class="built_in">set</span>(<span class="string">&quot;key1&quot;</span>, <span class="string">&quot;val&quot;</span>);  <span class="comment">// å ç”¨è¿æ¥</span></span><br><span class="line">pipe.<span class="built_in">set</span>(<span class="string">&quot;key2&quot;</span>, <span class="string">&quot;val&quot;</span>);  <span class="comment">// ç»§ç»­å ç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ æ­»é”ï¼è¿æ¥æ± ä¸ºç©ºï¼ŒRedis::get æ°¸ä¹…é˜»å¡</span></span><br><span class="line">redis.<span class="built_in">get</span>(<span class="string">&quot;key&quot;</span>);  <span class="comment">// ç­‰å¾…è¿æ¥æ± ï¼Œä½† pipe è¿˜æ²¡é‡Šæ”¾</span></span><br><span class="line"></span><br><span class="line">pipe.<span class="built_in">exec</span>();  <span class="comment">// æ°¸è¿œæ‰§è¡Œä¸åˆ°</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰æœ€ä½³å®è·µ">ï¼ˆ3ï¼‰æœ€ä½³å®è·µ</h3>
<ul>
<li>å§‹ç»ˆå°† ConnectionPoolOptions::wait_timeout è®¾ç½®ä¸ºå¤§äº 0 æ¯«ç§’
<ul>
<li>å³å½“è¿æ¥æ± ä¸ºç©ºæ—¶ï¼Œé¿å…è°ƒç”¨è€…æ°¸ä¹…é˜»å¡</li>
</ul>
</li>
<li>æœ€å¥½å°† Pipeline ç›¸å…³ä»£ç æ”¾åœ¨ä»£ç å—ä½œç”¨åŸŸå†…</li>
<li>é¿å…åœ¨ Pipeline æ–¹æ³•è°ƒç”¨ä¹‹é—´æ‰§è¡Œè€—æ—¶æ“ä½œ</li>
<li>å°½é‡å°† Pipeline æ–¹æ³•ä¸ Pipeline::exec é“¾å¼è°ƒç”¨åœ¨åŒä¸€æ¡è¯­å¥ä¸­</li>
</ul>
<p>âœ… æ­£ç¡®ç”¨æ³•</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">ConnectionOptions opts;</span><br><span class="line">opts.host = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">opts.port = <span class="number">6379</span>;</span><br><span class="line">opts.socket_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">50</span>);</span><br><span class="line"></span><br><span class="line">ConnectionPoolOptions pool_opts;</span><br><span class="line">pool_opts.size = <span class="number">3</span>;</span><br><span class="line"><span class="comment">// âœ… æœ€ä½³å®è·µ1ï¼š ConnectionPoolOptions::wait_timeout &gt; 0ms</span></span><br><span class="line">pool_opts.wait_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">50</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> redis = <span class="built_in">Redis</span>(opts, pool_opts);</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æœ€ä½³å®è·µ2ï¼šä½¿ç”¨å—ä½œç”¨åŸŸ</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">auto</span> pipe = redis.<span class="built_in">pipeline</span>(<span class="literal">false</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//âœ… æœ€ä½³å®è·µ3ï¼šé¿å…åœ¨ Pipeline æ–¹æ³•è°ƒç”¨ä¹‹é—´æ‰§è¡Œè€—æ—¶æ“ä½œ</span></span><br><span class="line">    <span class="comment">// âŒ ä¸è¦åœ¨è¿™é‡Œåšè€—æ—¶æ“ä½œï¼</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">auto</span> replies = pipe.<span class="built_in">set</span>(<span class="string">&quot;k1&quot;</span>, <span class="string">&quot;v1&quot;</span>).<span class="built_in">set</span>(<span class="string">&quot;k2&quot;</span>, <span class="string">&quot;v2&quot;</span>).<span class="built_in">exec</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// exec() å®Œæˆåï¼Œè¿æ¥è‡ªåŠ¨å½’è¿˜</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æœ€ä½³å®è·µ4ï¼šé“¾å¼è°ƒç”¨ä¸€æ°”å‘µæˆ</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">auto</span> pipe = redis.<span class="built_in">pipeline</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">auto</span> replies = pipe.<span class="built_in">set</span>(<span class="string">&quot;k1&quot;</span>, <span class="string">&quot;v1&quot;</span>)</span><br><span class="line">                       .<span class="built_in">set</span>(<span class="string">&quot;k2&quot;</span>, <span class="string">&quot;v2&quot;</span>)</span><br><span class="line">                       .<span class="built_in">incr</span>(<span class="string">&quot;counter&quot;</span>)</span><br><span class="line">                       .<span class="built_in">exec</span>();  <span class="comment">// ç«‹å³å‘é€å¹¶é‡Šæ”¾è¿æ¥</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">    <span class="comment">// è¿™ç§æ“ä½œï¼ˆå¤ç”¨è¿æ¥æ± è¿æ¥åˆ›å»º Pipelineï¼‰å¼€é”€æä½</span></span><br><span class="line">    <span class="keyword">auto</span> pipe = redis.<span class="built_in">pipeline</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»åº•å±‚è¿æ¥æ± è·å–è¿æ¥å¹¶æŒæœ‰</span></span><br><span class="line">    pipe.<span class="built_in">set</span>(<span class="string">&quot;key1&quot;</span>, <span class="string">&quot;val&quot;</span>).<span class="built_in">set</span>(<span class="string">&quot;key2&quot;</span>, <span class="string">&quot;val&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å³ä½¿æœªè°ƒç”¨ Pipeline::exec æˆ– Pipeline::discardï¼ˆå³pipelineè¿˜ç¼“å­˜æœ‰å‘½ä»¤ï¼‰</span></span><br><span class="line">    <span class="comment">// å½“ Pipeline å¯¹è±¡ææ„æ—¶ï¼Œè¿æ¥ä¹Ÿä¼šè¢«è‡ªåŠ¨å½’è¿˜åˆ°è¿æ¥æ± </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>åäºŒã€Redis++ Transactionï¼ˆäº‹åŠ¡ï¼‰</h1>
<h2 id="1-æ¦‚è¿°-3">1.æ¦‚è¿°</h2>
<p>Transaction ç”¨äºç¡®ä¿å¤šä¸ªå‘½ä»¤<strong>åŸå­æ€§æ‰§è¡Œ</strong>â€”â€”è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œã€‚<br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114155752421.png" alt=""></p>
<ul>
<li>å‰é¢æè¿‡ï¼ŒRedisæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸ºå‡å°å¼€é”€ï¼Œå°½é‡å¤ç”¨åŒä¸€ä¸ªRedis â€”â€”&gt; è¿™ä¹Ÿå°±å¯èƒ½å¯¼è‡´ä¸€ä¸ªçº¿ç¨‹é€šè¿‡Redisæ‰§è¡Œå¤šä¸ªå‘½ä»¤æ—¶ï¼Œå…¶å®ƒçº¿ç¨‹ä¹Ÿé€šè¿‡åŒä¸€ä¸ªRedisæ‰§è¡Œå‘½ä»¤ï¼Œä»è€Œå¯¼è‡´è¢«æ‰“æ–­</li>
</ul>
<h2 id="2-åˆ›å»ºTransaction">2.åˆ›å»ºTransaction</h2>
<h3 id="ï¼ˆ1ï¼‰é»˜è®¤æ–¹å¼ï¼ˆåˆ›å»ºæ–°è¿æ¥ï¼‰">ï¼ˆ1ï¼‰é»˜è®¤æ–¹å¼ï¼ˆåˆ›å»ºæ–°è¿æ¥ï¼‰</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">Redis <span class="title">redis</span><span class="params">(<span class="string">&quot;tcp://127.0.0.1:6379&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºäº‹åŠ¡ï¼ˆé»˜è®¤åˆ›å»ºæ–°è¿æ¥ï¼Œä¸ä»è¿æ¥æ± å–ï¼‰</span></span><br><span class="line"><span class="keyword">auto</span> tx = redis.<span class="built_in">transaction</span>();</span><br></pre></td></tr></table></figure>
<p>âš ï¸ æ³¨æ„ï¼šé»˜è®¤åˆ›å»º Transaction å¼€é”€è¾ƒå¤§ï¼ˆéœ€è¦æ–°å»ºè¿æ¥ï¼‰ï¼Œåº”å°½é‡å¤ç”¨ã€‚</p>
<h3 id="ï¼ˆ2ï¼‰ä½¿ç”¨è¿æ¥æ± è¿æ¥åˆ›å»ºï¼ˆæœ‰æ­»é”é£é™©ï¼‰">ï¼ˆ2ï¼‰ä½¿ç”¨è¿æ¥æ± è¿æ¥åˆ›å»ºï¼ˆæœ‰æ­»é”é£é™©ï¼‰</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å‚æ•°è¯´æ˜ï¼štransaction(piped, new_connection)</span></span><br><span class="line"><span class="comment">// piped = falseï¼ˆéç®¡é“æ¨¡å¼ï¼‰ï¼Œnew_connection = falseï¼ˆä»è¿æ¥æ± å–ï¼‰</span></span><br><span class="line"><span class="keyword">auto</span> tx = redis.<span class="built_in">transaction</span>(<span class="literal">false</span>, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰åˆ›å»ºç®¡é“åŒ–äº‹åŠ¡ï¼ˆæ€§èƒ½æ›´å¥½ï¼‰">ï¼ˆ3ï¼‰åˆ›å»ºç®¡é“åŒ–äº‹åŠ¡ï¼ˆæ€§èƒ½æ›´å¥½ï¼‰</h3>
<p><a href="#pipeline_transaction">ç®¡å¸¦äº‹åŠ¡</a></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// piped = trueï¼Œå‘½ä»¤é€šè¿‡ Pipeline å‘é€ï¼Œå‡å°‘ RTT</span></span><br><span class="line"><span class="keyword">auto</span> tx = redis.<span class="built_in">transaction</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–ä½¿ç”¨è¿æ¥æ±  + ç®¡é“ () ï¼ˆæœ‰æ­»é”é£é™©ï¼‰</span></span><br><span class="line"><span class="keyword">auto</span> tx = redis.<span class="built_in">transaction</span>(<span class="literal">true</span>, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<h2 id="3-Transactionçš„ä½¿ç”¨">3.Transactionçš„ä½¿ç”¨</h2>
<h3 id="ï¼ˆ1ï¼‰å‘é€å‘½ä»¤">ï¼ˆ1ï¼‰å‘é€å‘½ä»¤</h3>
<p>Transaction ä¸ Pipeline æ¥å£å®Œå…¨ç›¸åŒï¼Œæ”¯æŒé“¾å¼è°ƒç”¨ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">tx.<span class="built_in">set</span>(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;val&quot;</span>)</span><br><span class="line">  .<span class="built_in">incr</span>(<span class="string">&quot;counter&quot;</span>)</span><br><span class="line">  .<span class="built_in">lpush</span>(<span class="string">&quot;list&quot;</span>, &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;)</span><br><span class="line">  .<span class="built_in">hset</span>(<span class="string">&quot;hash&quot;</span>, <span class="string">&quot;field&quot;</span>, <span class="string">&quot;value&quot;</span>)</span><br><span class="line">  .<span class="built_in">command</span>(<span class="string">&quot;client&quot;</span>, <span class="string">&quot;setname&quot;</span>, <span class="string">&quot;app&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>ğŸ“Œ ä½ ä¸éœ€è¦å‘ Redis å‘é€å¤šé‡å‘½ä»¤ã€‚ äº¤æ˜“ä¼šè‡ªåŠ¨å¸®ä½ å®Œæˆè¿™ä»¶äº‹ã€‚</p>
<h3 id="ï¼ˆ2ï¼‰æ‰§è¡Œäº‹åŠ¡">ï¼ˆ2ï¼‰æ‰§è¡Œäº‹åŠ¡</h3>
<ul>
<li>å½“ä½ è°ƒç”¨ Transaction::exec æ—¶ï¼Œä½ ä¼šæ˜ç¡®è¦æ±‚ Redis æ‰§è¡Œé‚£äº›æ’é˜Ÿå‘½ä»¤ï¼Œå¹¶è¿”å›å›å¤
<ul>
<li>å¦åˆ™ï¼Œè¿™äº›å‘½ä»¤ä¸ä¼šè¢«æ‰§è¡Œ</li>
</ul>
</li>
<li>ä½ å¯ä»¥è°ƒç”¨ Transaction::discard æ¥ä¸¢å¼ƒæ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ä¼šæ‰§è¡Œä»»ä½•å‘½ä»¤ã€‚</li>
</ul>
<p><strong>è°ƒç”¨ exec() æ‰§è¡Œ</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ–¹å¼1ï¼šå…ˆå‘é€ï¼Œå†æ‰§è¡Œ</span></span><br><span class="line">tx.<span class="built_in">set</span>(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;val&quot;</span>).<span class="built_in">incr</span>(<span class="string">&quot;num&quot;</span>);</span><br><span class="line"><span class="keyword">auto</span> replies = tx.<span class="built_in">exec</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼2ï¼šé“¾å¼è°ƒç”¨ï¼ˆæ¨èï¼‰</span></span><br><span class="line"><span class="keyword">auto</span> replies = tx.<span class="built_in">set</span>(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;val&quot;</span>).<span class="built_in">incr</span>(<span class="string">&quot;num&quot;</span>).<span class="built_in">exec</span>();</span><br></pre></td></tr></table></figure>
<p><strong>æ”¾å¼ƒäº‹åŠ¡</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">tx.<span class="built_in">set</span>(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;val&quot;</span>).<span class="built_in">incr</span>(<span class="string">&quot;num&quot;</span>);</span><br><span class="line">tx.<span class="built_in">discard</span>();  <span class="comment">// æ”¾å¼ƒæ‰§è¡Œï¼Œæ‰€æœ‰å‘½ä»¤éƒ½ä¸ä¼šæ‰§è¡Œ</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰è§£æäº‹åŠ¡æ‰§è¡Œç»“æœ">ï¼ˆ3ï¼‰è§£æäº‹åŠ¡æ‰§è¡Œç»“æœ</h3>
<p>ä¸ Pipeline å®Œå…¨ç›¸åŒï¼š<a href="#parse_pipeline_result">è§£æå›å¤</a></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> replies = tx.<span class="built_in">set</span>(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;val&quot;</span>)      <span class="comment">// 0: SET â†’ bool</span></span><br><span class="line">                 .<span class="built_in">incr</span>(<span class="string">&quot;counter&quot;</span>)        <span class="comment">// 1: INCR â†’ long long</span></span><br><span class="line">                 .<span class="built_in">lrange</span>(<span class="string">&quot;list&quot;</span>, <span class="number">0</span>, <span class="number">-1</span>)  <span class="comment">// 2: LRANGE â†’ vector</span></span><br><span class="line">                 .<span class="built_in">exec</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£æ</span></span><br><span class="line"><span class="type">bool</span> set_ok = replies.<span class="built_in">get</span>&lt;<span class="type">bool</span>&gt;(<span class="number">0</span>);</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> counter = replies.<span class="built_in">get</span>&lt;<span class="type">long</span> <span class="type">long</span>&gt;(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">std::vector&lt;std::string&gt; items;</span><br><span class="line">replies.<span class="built_in">get</span>(<span class="number">2</span>, std::<span class="built_in">back_inserter</span>(items));</span><br></pre></td></tr></table></figure>
<p><a id="pipeline_transaction"></a></p>
<h3 id="ï¼ˆ4ï¼‰ç®¡é“äº‹åŠ¡ï¼ˆPiped-Transactionï¼‰">ï¼ˆ4ï¼‰ç®¡é“äº‹åŠ¡ï¼ˆPiped Transactionï¼‰</h3>
<p>é€šå¸¸ï¼Œä¸€ä¸ªäº‹åŠ¡ä¼šå‘é€å¤šæ¡æŒ‡ä»¤ï¼Œä¸ºäº†æå‡æ€§èƒ½ï¼Œå¯ä»¥åœ¨pipelineä¸­å‘é€è¿™äº›å‘½ä»¤</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Create a piped transaction</span></span><br><span class="line"><span class="keyword">auto</span> tx = redis.<span class="built_in">transaction</span>(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>é€šè¿‡è¿™ç§piped transactionï¼Œæ‰€æœ‰å‘½ä»¤éƒ½ä¼šé€šè¿‡pipelineå‘é€åˆ° Redisã€‚</li>
</ul>
<h2 id="4-WATCH-ä¹è§‚é”ï¼ˆCAS-æœºåˆ¶ï¼‰">4. WATCH ä¹è§‚é”ï¼ˆCAS æœºåˆ¶ï¼‰</h2>
<h3 id="ï¼ˆ1ï¼‰ä¸ºä»€ä¹ˆéœ€è¦-WATCHï¼Ÿ">ï¼ˆ1ï¼‰ä¸ºä»€ä¹ˆéœ€è¦ WATCHï¼Ÿ</h3>
<p><strong>Transacation å¹¶ä¸å®‰å…¨äºçº¿ç¨‹</strong></p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">åœºæ™¯ï¼šä¸¤ä¸ªå®¢æˆ·ç«¯åŒæ—¶å¯¹ counter åŠ  1</span><br><span class="line"></span><br><span class="line">å®¢æˆ·ç«¯Aï¼ˆäº‹åŠ¡1ï¼‰              å®¢æˆ·ç«¯B ï¼ˆäº‹åŠ¡2ï¼‰</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">GET counter â†’ 10            GET counter â†’ 10</span><br><span class="line">new<span class="emphasis">_counter = 10 + 1        new_</span>counter = 10 + 1</span><br><span class="line">SET counter new<span class="emphasis">_counter     SET counter new_</span>counter</span><br><span class="line"></span><br><span class="line">ç»“æœï¼šcounter = 11ï¼ˆé”™è¯¯ï¼åº”è¯¥æ˜¯ 12ï¼‰</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰WATCH-çš„ä½œç”¨">ï¼ˆ2ï¼‰WATCH çš„ä½œç”¨</h3>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">å®¢æˆ·ç«¯Aï¼ˆäº‹åŠ¡1ï¼‰              å®¢æˆ·ç«¯Bï¼ˆäº‹åŠ¡2ï¼‰</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">WATCH counter  //ç›‘è§† counter æ˜¯å¦è¢«ä¿®æ”¹</span><br><span class="line">GET counter â†’ 10</span><br><span class="line"><span class="code">                            SET counter 20ï¼ˆä¿®æ”¹äº† counterï¼‰</span></span><br><span class="line"><span class="code">MULTI    //å¼€å¯äº‹åŠ¡</span></span><br><span class="line"><span class="code">SET counter </span></span><br><span class="line"><span class="code">EXEC â†’ å¤±è´¥ï¼ï¼ˆå› ä¸º counter è¢«ä¿®æ”¹ï¼‰</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">â†’ å®¢æˆ·ç«¯A é‡è¯•æ•´ä¸ªæµç¨‹</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰Watchçš„ä½¿ç”¨">ï¼ˆ3ï¼‰Watchçš„ä½¿ç”¨</h3>
<h4 id="1-æ¦‚è¿°-4">&lt;1&gt;æ¦‚è¿°</h4>
<ul>
<li><strong>WATCH å‘½ä»¤å¿…é¡»ä¸è¯¥äº¤æ˜“åœ¨åŒä¸€è¿æ¥ä¸­å‘é€</strong></li>
<li>é€šå¸¸åœ¨ WATCH å‘½ä»¤ä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦å‘é€å…¶ä»–å‘½ä»¤
<ul>
<li>å¦‚ï¼š<strong>æ‰§è¡Œäº‹åŠ¡å‰ä» Redis è·å–æ•°æ®</strong></li>
</ul>
</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">WATCH key           // ç›‘å¬æŒ‡å®šçš„ key</span><br><span class="line">val = GET key       // è·å–è¯¥ key å¯¹åº”çš„ value</span><br><span class="line">new<span class="emphasis">_val = val + 1   // å¯¹ value æ‰§è¡Œè‡ªå¢æ“ä½œ</span></span><br><span class="line"><span class="emphasis">MULTI               // å¼€å¯äº‹åŠ¡</span></span><br><span class="line"><span class="emphasis">SET key new_</span>val     // ä»…å½“è¯¥ key çš„å€¼æœªè¢«å…¶ä»–å®¢æˆ·ç«¯ä¿®æ”¹æ—¶ï¼Œæ‰æ‰§è¡Œæ­¤èµ‹å€¼æ“ä½œ</span><br><span class="line">EXEC                // å°è¯•æ‰§è¡Œäº‹åŠ¡</span><br><span class="line"><span class="code">                    // è‹¥ç›‘å¬æœŸé—´ val å·²è¢«ä¿®æ”¹ï¼Œæ•´ä¸ªäº‹åŠ¡ä¸ä¼šæ‰§è¡Œ</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114163237592.png" alt=""></p>
<h4 id="2-ä½¿ç”¨-WATCH-çš„å…³é”®">&lt;2&gt;ä½¿ç”¨ WATCH çš„å…³é”®</h4>
<ul>
<li>ä½¿ç”¨ Transaction å¯¹è±¡æ—¶ï¼Œä½ æ— æ³•è·å¾—å‘½ä»¤çš„ç»“æœï¼Œç›´åˆ°æ•´ä¸ªäº‹åŠ¡å®Œæˆã€‚</li>
<li>ç›¸åï¼Œä½ éœ€è¦ä»äº‹åŠ¡å¯¹è±¡åˆ›å»ºä¸€ä¸ª Redis å¯¹è±¡ã€‚åˆ›å»ºçš„ Redis å¯¹è±¡ä¸äº‹åŠ¡å¯¹è±¡<strong>å…±äº«è¿æ¥</strong></li>
<li>æœ‰äº†è¿™ä¸ªåˆ›å»ºçš„ Redis å¯¹è±¡ï¼Œä½ å¯ä»¥å‘ Redis æœåŠ¡å™¨å‘é€ WATCH å‘½ä»¤å’Œå…¶ä»– Redis å‘½ä»¤ï¼Œå¹¶ç«‹å³è·å¾—ç»“æœã€‚</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> tx = redis.<span class="built_in">transaction</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºå…±äº«è¿æ¥çš„ Redis å¯¹è±¡</span></span><br><span class="line"><span class="keyword">auto</span> r = tx.<span class="built_in">redis</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// r å’Œ tx ä½¿ç”¨åŒä¸€ä¸ªè¿æ¥</span></span><br><span class="line">r.<span class="built_in">watch</span>(<span class="string">&quot;key&quot;</span>);           <span class="comment">// åœ¨å…±äº«è¿æ¥ä¸Šæ‰§è¡Œ WATCH</span></span><br><span class="line"><span class="keyword">auto</span> val = r.<span class="built_in">get</span>(<span class="string">&quot;key&quot;</span>);  <span class="comment">// å¯ä»¥ç«‹å³è·å–ç»“æœ</span></span><br><span class="line">tx.<span class="built_in">set</span>(<span class="string">&quot;key&quot;</span>, new_val).<span class="built_in">exec</span>();  <span class="comment">// åœ¨åŒä¸€è¿æ¥ä¸Šæ‰§è¡Œäº‹åŠ¡</span></span><br></pre></td></tr></table></figure>
<h4 id="3-WATCH-å®Œæ•´ç¤ºä¾‹ï¼ˆCAS-å®ç°ï¼‰">&lt;3&gt;WATCH å®Œæ•´ç¤ºä¾‹ï¼ˆCAS å®ç°ï¼‰</h4>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> redis = <span class="built_in">Redis</span>(<span class="string">&quot;tcp://127.0.0.1&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨å¾ªç¯å¤–åˆ›å»º Transactionï¼ˆé¿å…é‡å¤åˆ›å»ºè¿æ¥ï¼‰</span></span><br><span class="line"><span class="keyword">auto</span> tx = redis.<span class="built_in">transaction</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¢« WATCH çš„ key å¯èƒ½è¢«å…¶ä»–å®¢æˆ·ç«¯ä¿®æ”¹ï¼Œéœ€è¦é‡è¯•</span></span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºå…±äº«è¿æ¥çš„ Redis å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">auto</span> r = tx.<span class="built_in">redis</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç›‘è§† key</span></span><br><span class="line">        r.<span class="built_in">watch</span>(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è·å–å½“å‰å€¼</span></span><br><span class="line">        <span class="keyword">auto</span> val = r.<span class="built_in">get</span>(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">        <span class="type">int</span> num = val ? std::<span class="built_in">stoi</span>(*val) : <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®¡ç®—æ–°å€¼</span></span><br><span class="line">        ++num;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ‰§è¡Œäº‹åŠ¡</span></span><br><span class="line">        <span class="keyword">auto</span> replies = tx.<span class="built_in">set</span>(<span class="string">&quot;key&quot;</span>, std::<span class="built_in">to_string</span>(num)).<span class="built_in">exec</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æˆåŠŸï¼éªŒè¯å¹¶é€€å‡ºå¾ªç¯</span></span><br><span class="line">        <span class="built_in">assert</span>(replies.<span class="built_in">size</span>() == <span class="number">1</span> &amp;&amp; replies.<span class="built_in">get</span>&lt;<span class="type">bool</span>&gt;(<span class="number">0</span>) == <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> WatchError&amp; e) &#123;</span><br><span class="line">        <span class="comment">// key è¢«å…¶ä»–å®¢æˆ·ç«¯ä¿®æ”¹ï¼Œé‡è¯•</span></span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> Error&amp; e) &#123;</span><br><span class="line">        <span class="comment">// å…¶ä»–é”™è¯¯ï¼ŒTransaction å·²å¤±æ•ˆ</span></span><br><span class="line">        <span class="keyword">throw</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="5-åˆ›å»ºäº‹åŠ¡ä½†ä¸åˆ›å»ºæ–°è¿æ¥">5.åˆ›å»ºäº‹åŠ¡ä½†ä¸åˆ›å»ºæ–°è¿æ¥</h2>
<h3 id="ï¼ˆ1ï¼‰ä½¿ç”¨è¿æ¥æ± å†…è¿æ¥åˆ›å»ºTransaction">ï¼ˆ1ï¼‰ä½¿ç”¨è¿æ¥æ± å†…è¿æ¥åˆ›å»ºTransaction</h3>
<ul>
<li>äº‹å®ä¸Šï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªå¸¦æœ‰åº•å±‚è¿æ¥æ± è¿æ¥çš„äº‹åŠ¡å¯¹è±¡ï¼Œè¿™æ ·è°ƒç”¨ Redis::transaction æ–¹æ³•ä¼šä¾¿å®œå¾—å¤šï¼ˆå› ä¸ºä¸éœ€è¦æ–°å»ºè¿æ¥ï¼‰ã€‚</li>
<li>Redis::transaction çš„åŸå‹:
<ul>
<li><code>Transaction transaction(bool piped = false, bool new_connection = true);</code>
<ul>
<li>å¦‚æœ new_connection ä¸ºå‡ï¼Œ äº¤æ˜“å¯¹è±¡å°†é€šè¿‡åº•å±‚æ± çš„è¿æ¥åˆ›å»º</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">ConnectionOptions connection_options;</span><br><span class="line">ConnectionPoolOptions pool_options;</span><br><span class="line"></span><br><span class="line"><span class="function">Redis <span class="title">redis</span><span class="params">(connection_options, pool_options)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªäº‹åŠ¡ï¼ˆTransactionï¼‰ï¼Œä½†ä¸æ–°å»ºè¿æ¥ã€‚</span></span><br><span class="line"><span class="keyword">auto</span> tx = redis.<span class="built_in">transaction</span>(<span class="literal">false</span>, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>ä¸è¿‡ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¿…é¡»éå¸¸å°å¿ƒ
<ul>
<li>å¦åˆ™ï¼š<strong>å¯èƒ½ä¼šè¡¨ç°ä¸ä½³ç”šè‡³æ­»é”!!</strong></li>
</ul>
</li>
</ul>
<p><strong>å‚è€ƒ</strong>ï¼š<a href="#dead_lock">pipelineçš„æ­»é”é£é™©</a></p>
<h3 id="ï¼ˆ2ï¼‰ä½¿ç”¨è¿æ¥æ± è¿æ¥çš„æœ€ä½³å®è·µ">ï¼ˆ2ï¼‰ä½¿ç”¨è¿æ¥æ± è¿æ¥çš„æœ€ä½³å®è·µ</h3>
<ul>
<li>é™åˆ¶ ç”±Transaction::Redisåˆ›å»ºçš„Rediså¯¹è±¡çš„ ä½œç”¨åŸŸï¼ˆç”Ÿå‘½å‘¨æœŸï¼‰
<ul>
<li>å³å°½å¿«é”€æ¯Rediså¯¹è±¡ã€‚</li>
</ul>
</li>
</ul>
<p><strong>âš ï¸ ç‰¹åˆ«æ³¨æ„</strong>ï¼štx.redis() åˆ›å»ºçš„å¯¹è±¡ä¼šæŒæœ‰è¿æ¥</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> redis = <span class="built_in">Redis</span>(opts, pool_opts);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ª Transaction å¯¹è±¡ï¼Œä¸”ä¸æ–°å»ºè¿æ¥ï¼ˆå¤ç”¨è¿æ¥æ± ä¸­çš„ç°æœ‰è¿æ¥ï¼‰</span></span><br><span class="line"><span class="keyword">auto</span> tx = redis.<span class="built_in">transaction</span>(<span class="literal">false</span>, <span class="literal">false</span>);</span><br><span class="line"><span class="comment">// æ³¨ï¼šç¬¬ä¸€ä¸ª false = ä¸ä½¿ç”¨ Pipeline æ¨¡å¼æ‰§è¡Œäº‹åŠ¡ï¼›ç¬¬äºŒä¸ª false = ä¸æ–°å»ºè¿æ¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ª Redis å¯¹è±¡ï¼Œå…±äº«åŒä¸€ä¸ªè¿æ¥</span></span><br><span class="line"><span class="keyword">auto</span> r = tx.<span class="built_in">redis</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¶ä»–ä¸šåŠ¡ä»£ç ï¼ˆâš ï¸ è‹¥æ­¤å¤„æœ‰è€—æ—¶æ“ä½œï¼Œä¼šé•¿æœŸå ç”¨è¿æ¥ï¼Œå¯¼è‡´è¿æ¥æ± è€—å°½ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Execute the transaction.</span></span><br><span class="line"><span class="comment">// æ‰§è¡Œäº‹åŠ¡ï¼ˆæäº¤äº‹åŠ¡é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å‘½ä»¤ï¼‰</span></span><br><span class="line"><span class="keyword">auto</span> replies = tx.<span class="built_in">set</span>(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;val&quot;</span>).<span class="built_in">exec</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°½ç®¡å·²è°ƒç”¨ Transaction::exec æ‰§è¡Œäº‹åŠ¡ï¼Œä½†è¿æ¥å¹¶æœªå½’è¿˜åˆ°è¿æ¥æ± </span></span><br><span class="line"><span class="comment">// åŸå› ï¼šç”± tx.redis() åˆ›å»ºçš„ Redis å¯¹è±¡ï¼ˆå³å˜é‡ rï¼‰ä»æŒæœ‰è¯¥è¿æ¥</span></span><br></pre></td></tr></table></figure>
<p><strong>âœ… æ­£ç¡®ç”¨æ³•</strong>ï¼šç¡®ä¿ r å’Œ tx éƒ½å°½å¿«é”€æ¯</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">ConnectionOptions opts;</span><br><span class="line">opts.host = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">opts.port = <span class="number">6379</span>;</span><br><span class="line"></span><br><span class="line">ConnectionPoolOptions pool_opts;</span><br><span class="line">pool_opts.size = <span class="number">3</span>;</span><br><span class="line">pool_opts.wait_timeout = std::chrono::<span class="built_in">milliseconds</span>(<span class="number">100</span>);  <span class="comment">// âš ï¸ å¿…é¡» &gt; 0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> redis = <span class="built_in">Redis</span>(opts, pool_opts);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// âœ… åœ¨å¾ªç¯å†…åˆ›å»º Transactionï¼ˆä½¿ç”¨è¿æ¥æ± ï¼Œå¼€é”€å¾ˆå°ï¼‰</span></span><br><span class="line">        <span class="keyword">auto</span> tx = redis.<span class="built_in">transaction</span>(<span class="literal">false</span>, <span class="literal">false</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// âœ… r å’Œ tx åœ¨åŒä¸€ä½œç”¨åŸŸï¼ŒåŒæ—¶é”€æ¯</span></span><br><span class="line">        <span class="keyword">auto</span> r = tx.<span class="built_in">redis</span>();</span><br><span class="line">        </span><br><span class="line">        r.<span class="built_in">watch</span>(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">        <span class="keyword">auto</span> val = r.<span class="built_in">get</span>(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">        <span class="type">int</span> num = val ? std::<span class="built_in">stoi</span>(*val) : <span class="number">0</span>;</span><br><span class="line">        ++num;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">auto</span> replies = tx.<span class="built_in">set</span>(<span class="string">&quot;key&quot;</span>, std::<span class="built_in">to_string</span>(num)).<span class="built_in">exec</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">assert</span>(replies.<span class="built_in">size</span>() == <span class="number">1</span> &amp;&amp; replies.<span class="built_in">get</span>&lt;<span class="type">bool</span>&gt;(<span class="number">0</span>));</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// âœ… ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œr å’Œ tx éƒ½é”€æ¯ï¼Œè¿æ¥å½’è¿˜</span></span><br><span class="line">        </span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> WatchError&amp;) &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> Error&amp;) &#123;</span><br><span class="line">        <span class="keyword">throw</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="6-è¿æ¥å½’è¿˜æœºåˆ¶">6.è¿æ¥å½’è¿˜æœºåˆ¶</h2>
<p><strong>å‚è€ƒ</strong>ï¼š<a href="#return_mechanism">pipelineçš„è¿æ¥å½’è¿˜æœºåˆ¶</a></p>
<h2 id="7-Transaction-ä½¿ç”¨æ³¨æ„äº‹é¡¹">7.Transaction ä½¿ç”¨æ³¨æ„äº‹é¡¹</h2>
<h3 id="ï¼ˆ1ï¼‰ç‰¹å®šExceptionåä¸å¯å¤ç”¨-2">ï¼ˆ1ï¼‰ç‰¹å®šExceptionåä¸å¯å¤ç”¨</h3>
<ul>
<li>å¦‚æœäº‹åŠ¡çš„ä»»ä½•æ–¹æ³•æŠ›å‡ºé™¤ WatchError æˆ– ReplyError ä»¥å¤–çš„å¼‚å¸¸ï¼Œ äº‹åŠ¡å¯¹è±¡å°†è¿›å…¥æ— æ•ˆçŠ¶æ€
<ul>
<li>ä½ ä¸èƒ½å†ä½¿ç”¨å®ƒï¼Œåªèƒ½æ‘§æ¯è¯¥ç‰©ä½“å¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„<br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260114161718422.png" alt=""></li>
</ul>
</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰éçº¿ç¨‹å®‰å…¨-2">ï¼ˆ2ï¼‰éçº¿ç¨‹å®‰å…¨</h3>
<ul>
<li>Transacation å¹¶ä¸å®‰å…¨äºçº¿ç¨‹ã€‚</li>
<li>å¦‚æœä½ æƒ³åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­è°ƒç”¨å…¶æˆå‘˜å‡½æ•°ï¼Œå°±éœ€è¦åœ¨çº¿ç¨‹é—´æ‰‹åŠ¨åŒæ­¥ã€‚</li>
</ul>
<p><a id="use"></a></p>
<h1>é™„å½•1ï¼šRedis++ æ ¸å¿ƒåœºæ™¯</h1>
<h2 id="1-ç¼“å­˜åœºæ™¯ï¼ˆæœ€æ ¸å¿ƒåœºæ™¯ï¼‰">1.ç¼“å­˜åœºæ™¯ï¼ˆæœ€æ ¸å¿ƒåœºæ™¯ï¼‰</h2>
<h3 id="ï¼ˆ1ï¼‰é€‚ç”¨åœºæ™¯">ï¼ˆ1ï¼‰é€‚ç”¨åœºæ™¯</h3>
<p>ç”¨æˆ·ä¿¡æ¯ç¼“å­˜ã€å•†å“è¯¦æƒ…ç¼“å­˜ã€æ¥å£ç»“æœç¼“å­˜ã€çƒ­ç‚¹æ•°æ®åŠ é€Ÿè®¿é—®ç­‰ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯å‡è½»æ•°æ®åº“å‹åŠ›ï¼Œæå‡æ¥å£å“åº”é€Ÿåº¦ã€‚</p>
<h3 id="ï¼ˆ2ï¼‰æ ¸å¿ƒä¼˜åŠ¿">ï¼ˆ2ï¼‰æ ¸å¿ƒä¼˜åŠ¿</h3>
<ul>
<li>Redis åŸºäºå†…å­˜æ“ä½œï¼Œå“åº”é€Ÿåº¦å¿«ï¼ˆæ¯«ç§’çº§ï¼‰ï¼›</li>
<li>Redis++ æä¾›ä¸°å¯Œçš„ç¼“å­˜æ“ä½œ APIï¼Œæ”¯æŒè¿‡æœŸæ—¶é—´è®¾ç½®ã€æ‰¹é‡æ“ä½œï¼Œé…åˆ<strong>è¿æ¥æ± </strong>å¯é«˜æ•ˆæ”¯æ’‘é«˜å¹¶å‘ç¼“å­˜è®¿é—®ã€‚</li>
</ul>
<h3 id="ï¼ˆ3ï¼‰ç”Ÿäº§å®ç°è¦ç‚¹ï¼ˆé‡ç‚¹ï¼ï¼‰">ï¼ˆ3ï¼‰ç”Ÿäº§å®ç°è¦ç‚¹ï¼ˆé‡ç‚¹ï¼ï¼‰</h3>
<ul>
<li><strong>ç¼“å­˜keyå‘½åè§„èŒƒ</strong>ï¼š
<ul>
<li>é‡‡ç”¨â€œ <strong>ä¸šåŠ¡æ¨¡å—:æ•°æ®ç±»å‹:å”¯ä¸€æ ‡è¯†</strong> â€æ ¼å¼
<ul>
<li>å¦‚ï¼š goods:detail:10086ï¼Œé¿å…é”®åå†²çª</li>
</ul>
</li>
</ul>
</li>
<li><strong>è¿‡æœŸç­–ç•¥</strong>ï¼š
<ul>
<li>å¿…é¡»è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´
<ul>
<li>å¦‚ï¼šçƒ­ç‚¹å•†å“30åˆ†é’Ÿã€ç”¨æˆ·token24å°æ—¶</li>
<li>é¿å…å†…å­˜æ³„æ¼ï¼šRedis å†…å­˜æŒç»­å¢é•¿ä¸”æ— æ³•è¢«æœ‰æ•ˆå›æ”¶ï¼Œæœ€ç»ˆå¯¼è‡´å†…å­˜è€—å°½</li>
<li>å¯é€šè¿‡ <strong>set(key, val, expire)</strong> å®ç°</li>
</ul>
</li>
</ul>
</li>
<li><strong>ç¼“å­˜æ›´æ–°</strong>ï¼š
<ul>
<li>é‡‡ç”¨â€œæ›´æ–°æ•°æ®åº“+æ›´æ–°ç¼“å­˜â€æˆ–â€œå…ˆåˆ ç¼“å­˜+åæ›´æ•°æ®åº“â€ç­–ç•¥ï¼Œé¿å…ç¼“å­˜ä¸æ•°æ®åº“æ•°æ®ä¸ä¸€è‡´ï¼›</li>
<li>é«˜å¹¶å‘åœºæ™¯æ¨èâ€œå…ˆåˆ ç¼“å­˜+å»¶è¿ŸåŒåˆ â€ï¼›</li>
</ul>
</li>
<li><strong>ç¼“å­˜å¼‚å¸¸é˜²æŠ¤</strong>ï¼š
<ul>
<li><strong>ç¼“å­˜ç©¿é€</strong>ï¼ˆç¼“å­˜å’Œæ•°æ®åº“å‡æ— æ•°æ®ï¼‰
<ul>
<li>å¯<strong>è®¾ç½®ç©ºå€¼ç¼“å­˜</strong>ï¼ˆçŸ­æœŸè¿‡æœŸï¼‰</li>
</ul>
</li>
<li><strong>ç¼“å­˜å‡»ç©¿</strong>ï¼ˆçƒ­ç‚¹keyè¿‡æœŸç¬é—´é«˜å¹¶å‘ï¼‰
<ul>
<li>å¯ä½¿ç”¨<strong>äº’æ–¥é”</strong>æˆ–<strong>çƒ­ç‚¹keyæ°¸ä¸è¿‡æœŸ</strong></li>
</ul>
</li>
<li><strong>ç¼“å­˜é›ªå´©</strong>ï¼ˆå¤§é‡keyåŒæ—¶è¿‡æœŸï¼‰
<ul>
<li>å¯è®¾ç½®<strong>è¿‡æœŸæ—¶é—´éšæœºåç§»</strong>ï¼ˆå¦‚åŸºç¡€è¿‡æœŸ30åˆ†é’Ÿ+éšæœº0-5åˆ†é’Ÿï¼‰ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sw/redis++/redis++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;random&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”Ÿæˆ UUID</span></span><br><span class="line"><span class="function">std::string <span class="title">generate_uuid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> std::random_device rd;</span><br><span class="line">    <span class="function"><span class="type">static</span> std::mt19937 <span class="title">gen</span><span class="params">(rd())</span></span>;</span><br><span class="line">    <span class="type">static</span> std::uniform_int_distribution&lt;&gt; <span class="built_in">dis</span>(<span class="number">0</span>, <span class="number">15</span>);</span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">char</span>* hex = <span class="string">&quot;0123456789abcdef&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    std::string uuid;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; ++i) &#123;</span><br><span class="line">        uuid += hex[<span class="built_in">dis</span>(gen)];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> uuid;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::optional&lt;std::string&gt; <span class="title">get_goods_detail_cache_safe</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    Redis&amp; redis, </span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> std::string&amp; goods_id,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">int</span> max_retries = <span class="number">5</span>  <span class="comment">// âœ… æ·»åŠ é‡è¯•æ¬¡æ•°é™åˆ¶</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span> </span>&#123;</span><br><span class="line">    <span class="type">const</span> std::string cache_key = <span class="string">&quot;goods:detail:&quot;</span> + goods_id;</span><br><span class="line">    <span class="type">const</span> std::string lock_key = <span class="string">&quot;lock:goods:&quot;</span> + goods_id;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1. æŸ¥ç¼“å­˜</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">auto</span> val = redis.<span class="built_in">get</span>(cache_key)) &#123;</span><br><span class="line">        <span class="keyword">return</span> (*val == <span class="string">&quot;__EMPTY__&quot;</span>) ? std::<span class="literal">nullopt</span> : val;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="comment">// 2. å°è¯•è·å–é”</span></span><br><span class="line">    std::string lock_value = <span class="built_in">generate_uuid</span>();  <span class="comment">// âœ… å”¯ä¸€æ ‡è¯†</span></span><br><span class="line">    </span><br><span class="line">    <span class="type">bool</span> got_lock = redis.<span class="built_in">set</span>(</span><br><span class="line">        lock_key, </span><br><span class="line">        lock_value,  <span class="comment">// âœ… ç”¨ UUID é˜²æ­¢è¯¯åˆ </span></span><br><span class="line">        std::chrono::<span class="built_in">seconds</span>(<span class="number">10</span>), </span><br><span class="line">        sw::redis::UpdateType::NOT_EXIST</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (got_lock) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åŒé‡æ£€æŸ¥ï¼ˆå¯èƒ½å…¶ä»–çº¿ç¨‹å·²å†™å…¥ï¼‰</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">auto</span> val = redis.<span class="built_in">get</span>(cache_key)) &#123;</span><br><span class="line">                redis.<span class="built_in">del</span>(lock_key);  <span class="comment">// âœ… é‡Šæ”¾é”</span></span><br><span class="line">                <span class="keyword">return</span> (*val == <span class="string">&quot;__EMPTY__&quot;</span>) ? std::<span class="literal">nullopt</span> : val;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æŸ¥æ•°æ®åº“</span></span><br><span class="line">            std::string db_val = <span class="built_in">query_goods_detail_from_db</span>(goods_id);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (db_val.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">                redis.<span class="built_in">set</span>(cache_key, <span class="string">&quot;__EMPTY__&quot;</span>, std::chrono::<span class="built_in">minutes</span>(<span class="number">5</span>));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                redis.<span class="built_in">set</span>(cache_key, db_val, std::chrono::<span class="built_in">minutes</span>(<span class="number">30</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// âœ… å®‰å…¨é‡Šæ”¾é”ï¼ˆLua è„šæœ¬ï¼ŒåŸå­æ“ä½œï¼‰</span></span><br><span class="line">            <span class="type">const</span> <span class="type">char</span>* lua_script = <span class="string">R&quot;(</span></span><br><span class="line"><span class="string">                if redis.call(&quot;get&quot;, KEYS[1]) == ARGV[1] then</span></span><br><span class="line"><span class="string">                    return redis.call(&quot;del&quot;, KEYS[1])</span></span><br><span class="line"><span class="string">                else</span></span><br><span class="line"><span class="string">                    return 0</span></span><br><span class="line"><span class="string">                end</span></span><br><span class="line"><span class="string">            )&quot;</span>;</span><br><span class="line">            redis.<span class="built_in">eval</span>&lt;<span class="type">long</span> <span class="type">long</span>&gt;(lua_script, &#123;lock_key&#125;, &#123;lock_value&#125;);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> db_val.<span class="built_in">empty</span>() ? std::<span class="literal">nullopt</span> : std::optional&#123;db_val&#125;;</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="built_in">catch</span> (...) &#123;</span><br><span class="line">            <span class="comment">// âœ… å¼‚å¸¸æ—¶ä¹Ÿè¦é‡Šæ”¾é”</span></span><br><span class="line">            redis.<span class="built_in">eval</span>&lt;<span class="type">long</span> <span class="type">long</span>&gt;(</span><br><span class="line">                <span class="string">R&quot;(if redis.call(&quot;get&quot;, KEYS[1]) == ARGV[1] then </span></span><br><span class="line"><span class="string">                     return redis.call(&quot;del&quot;, KEYS[1]) </span></span><br><span class="line"><span class="string">                   else </span></span><br><span class="line"><span class="string">                     return 0 </span></span><br><span class="line"><span class="string">                   end)&quot;</span>,</span><br><span class="line">                &#123;lock_key&#125;, &#123;lock_value&#125;</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">throw</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// âœ… æ”¹ç”¨å¾ªç¯ä»£æ›¿é€’å½’</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; max_retries; ++i) &#123;</span><br><span class="line">            std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">milliseconds</span>(<span class="number">50</span>));</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å†æ¬¡æŸ¥ç¼“å­˜ï¼ˆå¯èƒ½å·²è¢«å…¶ä»–çº¿ç¨‹å†™å…¥ï¼‰</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">auto</span> val = redis.<span class="built_in">get</span>(cache_key)) &#123;</span><br><span class="line">                <span class="keyword">return</span> (*val == <span class="string">&quot;__EMPTY__&quot;</span>) ? std::<span class="literal">nullopt</span> : val;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// âœ… è¶…è¿‡é‡è¯•æ¬¡æ•°ï¼Œç›´æ¥æŸ¥æ•°æ®åº“ï¼ˆé™çº§ï¼‰</span></span><br><span class="line">        std::string db_val = <span class="built_in">query_goods_detail_from_db</span>(goods_id);</span><br><span class="line">        <span class="keyword">return</span> db_val.<span class="built_in">empty</span>() ? std::<span class="literal">nullopt</span> : std::optional&#123;db_val&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="2-åˆ†å¸ƒå¼é”åœºæ™¯">2.åˆ†å¸ƒå¼é”åœºæ™¯</h2>
<h3 id="ï¼ˆ1ï¼‰é€‚ç”¨åœºæ™¯-2">ï¼ˆ1ï¼‰é€‚ç”¨åœºæ™¯</h3>
<p>ç§’æ€æ´»åŠ¨ã€åˆ†å¸ƒå¼äº‹åŠ¡ã€è·¨æœåŠ¡èµ„æºç«äº‰ã€é¿å…é‡å¤æäº¤ç­‰ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯ä¿è¯åˆ†å¸ƒå¼ç¯å¢ƒä¸‹èµ„æºè®¿é—®çš„åŸå­æ€§ã€‚</p>
<h3 id="ï¼ˆ2ï¼‰æ ¸å¿ƒä¼˜åŠ¿-2">ï¼ˆ2ï¼‰æ ¸å¿ƒä¼˜åŠ¿</h3>
<ul>
<li>Redis å•çº¿ç¨‹ç‰¹æ€§ä¿è¯é”æ“ä½œçš„åŸå­æ€§ï¼›</li>
<li>Redis++ æ”¯æŒ Lua è„šæœ¬ï¼Œå¯å°†â€œåŠ é”+è¿‡æœŸâ€ã€â€œè§£é”+éªŒè¯æŒæœ‰è€…â€ç­‰é€»è¾‘å°è£…ä¸ºåŸå­æ“ä½œï¼Œé¿å…é”æ¼æ´ã€‚</li>
</ul>
<h3 id="ï¼ˆ3ï¼‰ç”Ÿäº§å®ç°è¦ç‚¹">ï¼ˆ3ï¼‰ç”Ÿäº§å®ç°è¦ç‚¹</h3>
<ul>
<li>
<p><strong>é”æ ‡è¯†å”¯ä¸€æ€§</strong>ï¼š</p>
<ul>
<li>æ¯ä¸ªé”æŒæœ‰è€…éœ€æºå¸¦å”¯ä¸€æ ‡è¯†ï¼ˆå¦‚ UUID+çº¿ç¨‹IDï¼‰ï¼Œé¿å…è¯¯è§£é”å…¶ä»–çº¿ç¨‹çš„é”ï¼›</li>
</ul>
</li>
<li>
<p><strong>é”è¿‡æœŸæœºåˆ¶</strong>ï¼š</p>
<ul>
<li>å¿…é¡»è®¾ç½®é”è¿‡æœŸæ—¶é—´ï¼Œ<strong>é˜²æ­¢æŒæœ‰è€…å´©æºƒå¯¼è‡´é”æ°¸ä¹…å ç”¨</strong>
<ul>
<li>å¯é€šè¿‡ <strong>Lua è„šæœ¬</strong>åŸå­è®¾ç½®â€œNX+EXâ€ï¼›</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>é”ç»­çº¦</strong>ï¼š</p>
<ul>
<li>å¦‚æœä¸šåŠ¡é€»è¾‘æ‰§è¡Œæ—¶é—´å¯èƒ½è¶…è¿‡é”è¿‡æœŸæ—¶é—´ï¼Œéœ€å¯åŠ¨åå°çº¿ç¨‹å®šæœŸç»­çº¦ï¼ˆå¦‚æ¯10ç§’ç»­æœŸ20ç§’ï¼‰ï¼›</li>
</ul>
</li>
<li>
<p><strong>è§£é”åŸå­æ€§</strong>ï¼š</p>
<ul>
<li>é€šè¿‡ Lua è„šæœ¬å…ˆéªŒè¯é”æŒæœ‰è€…ï¼Œå†åˆ é™¤é”ï¼Œé¿å…é”è¿‡æœŸåè¯¯åˆ å…¶ä»–çº¿ç¨‹çš„é”ã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;atomic&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DistributedLock</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Redis&amp; redis_;</span><br><span class="line">    string lock_key_;      <span class="comment">// é”çš„ keyï¼Œå¦‚ &quot;lock:order:12345&quot;</span></span><br><span class="line">    string lock_val_;      <span class="comment">// é”çš„å”¯ä¸€æ ‡è¯†ï¼Œç”¨äºéªŒè¯æŒæœ‰è€…èº«ä»½</span></span><br><span class="line">    <span class="type">int</span> expire_seconds_;   <span class="comment">// é”è¿‡æœŸæ—¶é—´ï¼ˆé˜²æ­¢æŒæœ‰è€…å´©æºƒå¯¼è‡´æ­»é”ï¼‰</span></span><br><span class="line">    </span><br><span class="line">    atomic&lt;<span class="type">bool</span>&gt; holding_&#123;<span class="literal">false</span>&#125;;  <span class="comment">// åŸå­æ ‡å¿—ï¼šå½“å‰æ˜¯å¦æŒæœ‰é”ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰</span></span><br><span class="line">    thread renew_thread_;          <span class="comment">// åå°ç»­çº¦çº¿ç¨‹</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span></span><br><span class="line">    <span class="comment">// ç»­çº¦å¾ªç¯ï¼šé˜²æ­¢ä¸šåŠ¡æ‰§è¡Œæ—¶é—´è¶…è¿‡é”è¿‡æœŸæ—¶é—´å¯¼è‡´é”è¢«æŠ¢</span></span><br><span class="line">    <span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">renew_loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Lua è„šæœ¬ï¼šåŸå­æ“ä½œ - å…ˆéªŒè¯æ˜¯è‡ªå·±çš„é”ï¼Œå†ç»­æœŸ</span></span><br><span class="line">        <span class="comment">// é¿å…ç»­æœŸäº†åˆ«äººçš„é”ï¼ˆé”å·²è¿‡æœŸè¢«å…¶ä»–è¿›ç¨‹æŠ¢èµ°çš„æƒ…å†µï¼‰</span></span><br><span class="line">        <span class="type">const</span> string renew_script = <span class="string">R&quot;(</span></span><br><span class="line"><span class="string">            if redis.call(&#x27;get&#x27;, KEYS[1]) == ARGV[1] then</span></span><br><span class="line"><span class="string">                return redis.call(&#x27;expire&#x27;, KEYS[1], ARGV[2])</span></span><br><span class="line"><span class="string">            end</span></span><br><span class="line"><span class="string">            return 0</span></span><br><span class="line"><span class="string">        )&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç»­çº¦é¢‘ç‡ï¼šè¿‡æœŸæ—¶é—´çš„ 1/3ï¼ˆå¦‚30ç§’è¿‡æœŸï¼Œæ¯10ç§’ç»­çº¦ä¸€æ¬¡ï¼‰</span></span><br><span class="line">        <span class="comment">// ç•™è¶³å®‰å…¨è¾¹é™…ï¼Œé¿å…ç½‘ç»œå»¶è¿Ÿå¯¼è‡´é”æ„å¤–è¿‡æœŸ</span></span><br><span class="line">        <span class="type">int</span> sleep_ms = (expire_seconds_ * <span class="number">1000</span>) / <span class="number">3</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (holding_.<span class="built_in">load</span>()) &#123;</span><br><span class="line">            this_thread::<span class="built_in">sleep_for</span>(chrono::<span class="built_in">milliseconds</span>(sleep_ms));</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// åŒé‡æ£€æŸ¥ï¼šsleep æœŸé—´å¯èƒ½å·²ç» unlock äº†</span></span><br><span class="line">            <span class="keyword">if</span> (!holding_.<span class="built_in">load</span>()) <span class="keyword">break</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">auto</span> result = redis_.<span class="built_in">eval</span>&lt;<span class="type">long</span> <span class="type">long</span>&gt;(</span><br><span class="line">                    renew_script,</span><br><span class="line">                    &#123;lock_key_&#125;,</span><br><span class="line">                    &#123;lock_val_, <span class="built_in">to_string</span>(expire_seconds_)&#125;</span><br><span class="line">                );</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// result == 0 è¯´æ˜é”å·²ä¸å±äºè‡ªå·±ï¼ˆè¢«æŠ¢æˆ–è¿‡æœŸï¼‰</span></span><br><span class="line">                <span class="keyword">if</span> (result == <span class="number">0</span>) &#123;</span><br><span class="line">                    holding_.<span class="built_in">store</span>(<span class="literal">false</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="built_in">catch</span> (<span class="type">const</span> sw::redis::Error&amp; e) &#123;</span><br><span class="line">                <span class="comment">// ç½‘ç»œå¼‚å¸¸ â†’ ä¿å®ˆå¤„ç†ï¼šè®¤ä¸ºé”å·²ä¸¢å¤±</span></span><br><span class="line">                <span class="comment">// é˜²æ­¢è„‘è£‚ï¼šå®å¯æ”¾å¼ƒé”ï¼Œä¹Ÿä¸èƒ½ä¸¤ä¸ªè¿›ç¨‹åŒæ—¶è®¤ä¸ºè‡ªå·±æŒæœ‰é”</span></span><br><span class="line">                holding_.<span class="built_in">store</span>(<span class="literal">false</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">DistributedLock</span>(Redis&amp; redis, <span class="type">const</span> string&amp; key, <span class="type">int</span> expire_sec = <span class="number">30</span>)</span><br><span class="line">        : <span class="built_in">redis_</span>(redis), <span class="built_in">lock_key_</span>(key), <span class="built_in">expire_seconds_</span>(expire_sec) &#123;</span><br><span class="line">        <span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span></span><br><span class="line">        <span class="comment">// é”æ ‡è¯†å¿…é¡»å…¨å±€å”¯ä¸€ï¼šUUID + çº¿ç¨‹ID</span></span><br><span class="line">        <span class="comment">// ä½œç”¨ï¼šè§£é”æ—¶éªŒè¯èº«ä»½ï¼Œé˜²æ­¢ A è¯¯åˆ  B çš„é”</span></span><br><span class="line">        <span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span></span><br><span class="line">        lock_val_ = <span class="built_in">generate_uuid</span>() + <span class="string">&quot;:&quot;</span> + <span class="built_in">to_string</span>(this_thread::<span class="built_in">get_id</span>());</span><br><span class="line">        <span class="comment">// æ³¨æ„ï¼šgenerate_uuid() éœ€è¦è‡ªè¡Œå®ç°ï¼Œå¯ä½¿ç”¨ boost::uuid æˆ–å…¶ä»– UUID åº“</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// RAIIï¼šææ„æ—¶è‡ªåŠ¨é‡Šæ”¾é”</span></span><br><span class="line">    ~<span class="built_in">DistributedLock</span>() &#123;</span><br><span class="line">        <span class="built_in">unlock</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">try_lock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span></span><br><span class="line">        <span class="comment">// SET key value EX seconds NXï¼ˆåŸå­æ“ä½œï¼‰</span></span><br><span class="line">        <span class="comment">// NX = ä»…å½“ key ä¸å­˜åœ¨æ—¶æ‰è®¾ç½®ï¼ˆäº’æ–¥ä¿è¯ï¼‰</span></span><br><span class="line">        <span class="comment">// EX = è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆé˜²æ­»é”ä¿è¯ï¼‰</span></span><br><span class="line">        <span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span></span><br><span class="line">        <span class="type">bool</span> acquired = redis_.<span class="built_in">set</span>(</span><br><span class="line">            lock_key_, </span><br><span class="line">            lock_val_,</span><br><span class="line">            chrono::<span class="built_in">seconds</span>(expire_seconds_),</span><br><span class="line">            sw::redis::UpdateType::NOT_EXIST  <span class="comment">// NX è¯­ä¹‰</span></span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (acquired) &#123;</span><br><span class="line">            holding_.<span class="built_in">store</span>(<span class="literal">true</span>);</span><br><span class="line">            <span class="comment">// å¯åŠ¨åå°ç»­çº¦çº¿ç¨‹ï¼Œä¿è¯é•¿ä»»åŠ¡ä¸ä¸¢é”</span></span><br><span class="line">            renew_thread_ = <span class="built_in">thread</span>(&amp;DistributedLock::renew_loop, <span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> acquired;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">unlock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span></span><br><span class="line">        <span class="comment">// exchange(false) åŸå­åœ°ï¼šè¯»å–æ—§å€¼ + è®¾ç½®æ–°å€¼</span></span><br><span class="line">        <span class="comment">// è¿”å› false è¯´æ˜ä¹‹å‰å°±æ˜¯ falseï¼Œå·²ç»é‡Šæ”¾è¿‡äº†ï¼ˆå¹‚ç­‰ï¼‰</span></span><br><span class="line">        <span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span></span><br><span class="line">        <span class="keyword">if</span> (!holding_.<span class="built_in">exchange</span>(<span class="literal">false</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¿…é¡»ç­‰ç»­çº¦çº¿ç¨‹é€€å‡ºï¼Œå¦åˆ™å¯èƒ½ï¼š</span></span><br><span class="line">        <span class="comment">// 1. ç»­çº¦çº¿ç¨‹è¿˜åœ¨è·‘ï¼Œè®¿é—®å·²ææ„çš„å¯¹è±¡ â†’ å´©æºƒ</span></span><br><span class="line">        <span class="comment">// 2. åˆšè§£é”åˆè¢«ç»­çº¦ â†’ é€»è¾‘é”™è¯¯</span></span><br><span class="line">        <span class="keyword">if</span> (renew_thread_.<span class="built_in">joinable</span>()) &#123;</span><br><span class="line">            renew_thread_.<span class="built_in">join</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span></span><br><span class="line">        <span class="comment">// Lua è„šæœ¬åŸå­è§£é”ï¼šéªŒè¯ + åˆ é™¤</span></span><br><span class="line">        <span class="comment">// å¿…é¡»éªŒè¯ï¼åœºæ™¯ï¼š</span></span><br><span class="line">        <span class="comment">//   1. A åŠ é”æˆåŠŸï¼Œé”è¿‡æœŸæ—¶é—´ 30s</span></span><br><span class="line">        <span class="comment">//   2. A ä¸šåŠ¡å¡äº† 35sï¼Œé”å·²è‡ªåŠ¨è¿‡æœŸ</span></span><br><span class="line">        <span class="comment">//   3. B æŠ¢åˆ°é”ï¼Œå¼€å§‹æ‰§è¡Œä¸šåŠ¡</span></span><br><span class="line">        <span class="comment">//   4. A ç»ˆäºæ‰§è¡Œå®Œï¼Œè°ƒç”¨ DEL åˆ é” â†’ åˆ æ‰äº† B çš„é”ï¼</span></span><br><span class="line">        <span class="comment">// ç”¨ Lua è„šæœ¬ä¿è¯&quot;éªŒè¯+åˆ é™¤&quot;åŸå­æ€§</span></span><br><span class="line">        <span class="comment">// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span></span><br><span class="line">        <span class="type">const</span> string unlock_script = <span class="string">R&quot;(</span></span><br><span class="line"><span class="string">            if redis.call(&#x27;get&#x27;, KEYS[1]) == ARGV[1] then</span></span><br><span class="line"><span class="string">                return redis.call(&#x27;del&#x27;, KEYS[1])</span></span><br><span class="line"><span class="string">            end</span></span><br><span class="line"><span class="string">            return 0</span></span><br><span class="line"><span class="string">        )&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redis_.<span class="built_in">eval</span>&lt;<span class="type">long</span> <span class="type">long</span>&gt;(unlock_script, &#123;lock_key_&#125;, &#123;lock_val_&#125;);</span><br><span class="line">        &#125; <span class="built_in">catch</span> (...) &#123;</span><br><span class="line">            <span class="comment">// è§£é”å¤±è´¥ä¹Ÿæ²¡å…³ç³»ï¼Œé”ä¼šè‡ªåŠ¨è¿‡æœŸ</span></span><br><span class="line">            <span class="comment">// è¿™æ˜¯åˆ†å¸ƒå¼é”çš„&quot;æœ€ç»ˆå®‰å…¨æ€§&quot;ä¿è¯</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">is_holding</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> holding_.<span class="built_in">load</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sw/redis++/redis++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;distributed_lock.hpp&quot;</span> <span class="comment">// åŒ…å«ä¸Šè¿°DistributedLockç±»çš„å¤´æ–‡ä»¶</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">std::string <span class="title">generate_uuid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ç®€å•å®ç°ï¼Œå®é™…åº”ä½¿ç”¨æ ‡å‡†UUIDåº“</span></span><br><span class="line">    <span class="type">static</span> std::atomic&lt;<span class="type">int</span>&gt; counter&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;uuid-&quot;</span> + std::<span class="built_in">to_string</span>(counter++);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è¿æ¥Redis</span></span><br><span class="line">    sw::<span class="function">redis::Redis <span class="title">redis</span><span class="params">(<span class="string">&quot;tcp://127.0.0.1:6379&quot;</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»ºåˆ†å¸ƒå¼é”</span></span><br><span class="line">    <span class="type">const</span> std::string lockKey = <span class="string">&quot;lock:order:12345&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å°è¯•è·å–é”</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">DistributedLock <span class="title">lock</span><span class="params">(redis, lockKey, <span class="number">30</span>)</span></span>; <span class="comment">// 30ç§’è¿‡æœŸæ—¶é—´</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (lock.<span class="built_in">try_lock</span>()) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;è·å–é”æˆåŠŸï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">            std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">seconds</span>(<span class="number">15</span>));</span><br><span class="line">            </span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;ä¸šåŠ¡é€»è¾‘æ‰§è¡Œå®Œæ¯•&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">            <span class="comment">// é”ä¼šåœ¨ä½œç”¨åŸŸç»“æŸæ—¶è‡ªåŠ¨é‡Šæ”¾</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;è·å–é”å¤±è´¥ï¼Œèµ„æºè¢«å ç”¨&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="comment">// ç¦»å¼€ä½œç”¨åŸŸï¼Œé”è‡ªåŠ¨é‡Šæ”¾</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a id="mechanism"></a></p>
<h1>é™„å½•2ï¼šRedis++ é‡è¦æœºåˆ¶</h1>
<h2 id="1-Redis-çš„å¿ƒè·³æœºåˆ¶ï¼ˆéè‡ªå·±å®ç°ï¼‰">1.Redis++ çš„å¿ƒè·³æœºåˆ¶ï¼ˆéè‡ªå·±å®ç°ï¼‰</h2>
<h3 id="ï¼ˆ1ï¼‰ä»‹ç»-4">ï¼ˆ1ï¼‰ä»‹ç»</h3>
<ul>
<li><strong>å¿ƒè·³æœºåˆ¶</strong>:
<ul>
<li>æ˜¯ä¸€ç§å®šæœŸå‘é€æ¢æµ‹ä¿¡å·æ¥ç¡®è®¤é€šä¿¡åŒæ–¹æ˜¯å¦å­˜æ´»çš„æŠ€æœ¯ã€‚</li>
</ul>
</li>
<li><strong>Redis++ çš„å¿ƒè·³æœºåˆ¶</strong>ï¼š
<ul>
<li><strong>æœ¬è´¨</strong>ï¼š
<ul>
<li>ç›´æ¥å¯ç”¨äº† <strong>Linux å†…æ ¸çš„ TCP KeepAlive æœºåˆ¶</strong>ã€‚</li>
<li><strong>Redis++ æ²¡æœ‰è‡ªå·±å®ç°å¿ƒè·³é€»è¾‘</strong>ï¼Œå®Œå…¨ä¾èµ–æ“ä½œç³»ç»Ÿå†…æ ¸çš„ TCP KeepAliveï¼Œè¿™ä¹Ÿæ˜¯æœ€é«˜æ•ˆçš„æ–¹å¼ï¼ˆé›¶åº”ç”¨å±‚å¼€é”€ï¼‰</li>
</ul>
</li>
<li>
<a href="/2026/01/13/Linux/TCP_IP%E7%9B%B8%E5%85%B3/TCP%20KeepAlive%20%E5%BF%83%E8%B7%B3%E6%9C%BA%E5%88%B6/" title="TCP KeepAlive å¿ƒè·³æœºåˆ¶">TCPçš„å¿ƒè·³æœºåˆ¶</a>
</li>
</ul>
</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰æ—¶é—´æµç¨‹å›¾">ï¼ˆ2ï¼‰æ—¶é—´æµç¨‹å›¾</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ—¶é—´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶</span><br><span class="line"></span><br><span class="line">[æœ€åæ•°æ®äº¤äº’]</span><br><span class="line">      â”‚</span><br><span class="line">      â”‚â—€â”€â”€â”€â”€â”€â”€â”€ ç¬¬1é˜¶æ®µï¼šé•¿ç­‰å¾… â”€â”€â”€â”€â”€â”€â”€â–¶â”‚â—€â”€â”€â”€â”€â”€ ç¬¬2é˜¶æ®µï¼šçŸ­é—´éš”æ¢æµ‹ â”€â”€â”€â”€â”€â–¶ â”‚</span><br><span class="line">      â”‚     tcp_keepalive_time          â”‚     tcp_keepalive_intvl         â”‚</span><br><span class="line">      â”‚         = 7200s (2å°æ—¶)         â”‚         = 75s Ã— 9æ¬¡              |</span><br><span class="line">      â”‚                                 â”‚                                  â”‚</span><br><span class="line">      â”‚         ï¼ˆç©ºé—²ï¼Œä¸æ¢æµ‹ï¼‰          â”‚  ğŸ’“â”€â”€75sâ”€â”€ğŸ’“â”€â”€75sâ”€â”€...â”€â”€ğŸ’“     â”‚</span><br><span class="line">      â”‚                                 â”‚  #1      #2          #9          â”‚</span><br><span class="line">      â”‚                                 â”‚                                  â”‚</span><br><span class="line">      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">                                        â”‚</span><br><span class="line">                                        â–¼</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚                              æœ€ç»ˆåˆ¤å®šé€»è¾‘                                    â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚  âœ… ä»»æ„æ¢æµ‹æ”¶åˆ° ACK â†’ é‡ç½®è®¡æ—¶å™¨ï¼Œå›åˆ°ç¬¬1é˜¶æ®µ                                â”‚</span><br><span class="line">â”‚  âŒ è¿ç»­9æ¬¡æ— å“åº”    â†’ åˆ¤å®šè¿æ¥æ­»äº¡ï¼Œå…³é—­è¿æ¥                                 â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line"></span><br><span class="line">æ€»æ£€æµ‹æ—¶é—´ = 7200s + 75s Ã— 9 = 7875s â‰ˆ 2å°æ—¶11åˆ†é’Ÿ</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰å®¢æˆ·ç«¯-â†”-Redis-äº¤äº’ç¤ºæ„å›¾">ï¼ˆ3ï¼‰å®¢æˆ·ç«¯ â†” Redis äº¤äº’ç¤ºæ„å›¾</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚  Redis++    â”‚                                                         â”‚   Redis     â”‚</span><br><span class="line">â”‚  Client     â”‚                                                         â”‚  Server     â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">       â”‚                                                                       â”‚</span><br><span class="line">       â”‚ [ä¸šåŠ¡æ•°æ®äº¤äº’] â†’ æœ€åä¸€æ¬¡æ•°æ®æ”¶å‘å®Œæˆ â†’ è¿æ¥è¿›å…¥ç©ºé—²çŠ¶æ€                  â”‚</span><br><span class="line">       â”‚                                                                       â”‚</span><br><span class="line">       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ç­‰å¾… 7200s â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚</span><br><span class="line">       â”‚                                                                       â”‚</span><br><span class="line">       â”‚  ğŸ’“ å‘é€ç¬¬1ä¸ª Keepalive æ¢æµ‹åŒ…                                       â”‚</span><br><span class="line">       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚</span><br><span class="line">       â”‚                                                                       â”‚</span><br><span class="line">       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚</span><br><span class="line">       â”‚       âœ… æ”¶åˆ° ACK â†’ é‡ç½®è®¡æ—¶å™¨ â†’ å›åˆ°ç©ºé—²ç­‰å¾…ï¼ˆæœ€ä¼˜è·¯å¾„ï¼‰                â”‚</span><br><span class="line">       â”‚                                                                       â”‚</span><br><span class="line">       â”‚                                                                       â”‚</span><br><span class="line">       â”‚  âŒ æœªæ”¶åˆ° ACK â†’ ç­‰å¾… 75s                                              â”‚</span><br><span class="line">       â”‚                                                                       â”‚</span><br><span class="line">       â”‚  ğŸ’“ å‘é€ç¬¬2ä¸ª Keepalive æ¢æµ‹åŒ…                                       â”‚</span><br><span class="line">       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚</span><br><span class="line">       â”‚                                                                       â”‚</span><br><span class="line">       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚</span><br><span class="line">       â”‚       âœ… æ”¶åˆ° ACK â†’ é‡ç½®è®¡æ—¶å™¨ â†’ å›åˆ°ç©ºé—²ç­‰å¾…                          â”‚</span><br><span class="line">       â”‚                                                                       â”‚</span><br><span class="line">       â”‚                                                                       â”‚</span><br><span class="line">       â”‚  ... é‡å¤æ¢æµ‹é€»è¾‘ï¼Œæœ€å¤šå‘é€ 9 æ¬¡æ¢æµ‹åŒ… ...                              â”‚</span><br><span class="line">       â”‚                                                                       â”‚</span><br><span class="line">       â”‚  ğŸ’“ å‘é€ç¬¬9ä¸ª Keepalive æ¢æµ‹åŒ…ï¼ˆæœ€åä¸€æ¬¡ï¼‰                              â”‚</span><br><span class="line">       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚</span><br><span class="line">       â”‚                                                                       â”‚</span><br><span class="line">       â”‚  âŒ ä»æœªæ”¶åˆ° ACK â†’ åˆ¤å®šè¿æ¥å¤±æ•ˆ â†’ å…³é—­å½“å‰è¿æ¥ â†’ è§¦å‘åº”ç”¨å±‚é‡è¿é€»è¾‘        â”‚</span><br><span class="line">       â”‚                                                                       â”‚</span><br><span class="line">       â–¼                                                                       â–¼</span><br></pre></td></tr></table></figure>
<p><a id="install"></a></p>
<h1>é™„å½•3ï¼šRedis++ å®‰è£…æ•™ç¨‹</h1>
<h2 id="1-ä¾¿æ·å®‰è£…">1.ä¾¿æ·å®‰è£…</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…ˆå®‰è£… hiredisï¼ˆåº•å±‚ä¾èµ–ï¼‰</span></span><br><span class="line"><span class="built_in">sudo</span> apt install libhiredis-dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… redis-plus-plus</span></span><br><span class="line"><span class="built_in">cd</span> ~/thirdparty    <span class="comment"># åˆ‡æ¢åˆ°ä½ è‡ªå·±çš„å®‰è£…ç›®å½•</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/sewenew/redis-plus-plus.git</span><br><span class="line"><span class="built_in">cd</span> redis-plus-plus</span><br><span class="line"><span class="built_in">mkdir</span> build &amp;&amp; <span class="built_in">cd</span> build</span><br><span class="line"></span><br><span class="line">cmake .. -DCMAKE_BUILD_TYPE=Release \</span><br><span class="line">         -DCMAKE_CXX_STANDARD=17 \</span><br><span class="line">         -DHIREDIS_LIB=/usr/local/lib/libhiredis.so</span><br><span class="line"></span><br><span class="line">make -j$(<span class="built_in">nproc</span>)</span><br><span class="line"><span class="built_in">sudo</span> make install</span><br></pre></td></tr></table></figure>
<p><strong>å¦‚æœå®‰è£…å¤±è´¥ï¼Œå¯å°è¯•ä¸‹é¢çš„æ–¹æ³•</strong></p>
<h2 id="2-æ™®é€šå®‰è£…">2.æ™®é€šå®‰è£…</h2>
<p><strong>å®‰è£… hiredis</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…ä¾èµ–</span></span><br><span class="line"><span class="built_in">sudo</span> apt update &amp;&amp; <span class="built_in">sudo</span> apt install -y build-essential git</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…‹éš†å¹¶ç¼–è¯‘ hiredis</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/redis/hiredis.git</span><br><span class="line"><span class="built_in">cd</span> hiredis</span><br><span class="line">make &amp;&amp; <span class="built_in">sudo</span> make install</span><br><span class="line"><span class="built_in">sudo</span> ldconfig  <span class="comment"># æ›´æ–°åŠ¨æ€åº“ç¼“å­˜</span></span><br></pre></td></tr></table></figure>
<p><strong>å®‰è£…Redis++</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…‹éš† Redis++ æºç </span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/sewenew/redis-plus-plus.git</span><br><span class="line"><span class="built_in">cd</span> redis-plus-plus</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰å¯ç”¨ç‰ˆæœ¬</span></span><br><span class="line">git tag</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ¢åˆ°ä½ æƒ³è¦çš„ç‰ˆæœ¬ï¼ˆä»¥1.3.15ä¸ºä¾‹ï¼‰ï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line"><span class="comment"># git checkout version</span></span><br><span class="line">git checkout 1.3.15</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ„å»ºç›®å½•</span></span><br><span class="line"><span class="built_in">mkdir</span> build &amp;&amp; <span class="built_in">cd</span> build</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®ç¼–è¯‘é€‰é¡¹</span></span><br><span class="line">cmake -DCMAKE_BUILD_TYPE=Release \</span><br><span class="line">      -DCMAKE_INSTALL_PREFIX=/usr/local \</span><br><span class="line">      -DREDIS_PLUS_PLUS_BUILD_TEST=OFF \</span><br><span class="line">      -DREDIS_PLUS_PLUS_BUILD_STATIC=OFF \</span><br><span class="line">      -DREDIS_PLUS_PLUS_BUILD_SHARED=ON \</span><br><span class="line">      -DREDIS_PLUS_PLUS_CXX_STANDARD=17 \</span><br><span class="line">      ..</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘ï¼ˆä½¿ç”¨å¤šæ ¸åŠ é€Ÿï¼‰</span></span><br><span class="line">make -j$(<span class="built_in">nproc</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…</span></span><br><span class="line"><span class="built_in">sudo</span> make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°åŠ¨æ€é“¾æ¥åº“ç¼“å­˜</span></span><br><span class="line"><span class="built_in">sudo</span> ldconfig</span><br></pre></td></tr></table></figure>
<h2 id="3-éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ">3.éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ</h2>
<h3 id="ï¼ˆ1ï¼‰éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ">ï¼ˆ1ï¼‰éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ</h3>
<ol>
<li>æ£€æŸ¥åº“æ–‡ä»¶æ˜¯å¦å­˜åœ¨</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ£€æŸ¥ redis-plus-plus åº“</span></span><br><span class="line"><span class="built_in">ls</span> /usr/local/lib/libredis++.so</span><br><span class="line"><span class="comment"># æ£€æŸ¥ hiredis åº“</span></span><br><span class="line"><span class="built_in">ls</span> /usr/local/lib/libhiredis.so</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>å¼€å¯RedisæœåŠ¡</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Ubuntu/Debian</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl start redis-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å¼€æœºè‡ªå¯</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> redis-server</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>ç¼–å†™ç®€å•æµ‹è¯•ä»£ç ï¼ˆå¦‚ test_redis.cppï¼‰:</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sw/redis++/redis++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    sw::redis::ConnectionOptions opts;</span><br><span class="line">    opts.host = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">    sw::<span class="function">redis::Redis <span class="title">redis</span><span class="params">(opts)</span></span>;</span><br><span class="line">    </span><br><span class="line">    redis.<span class="built_in">set</span>(<span class="string">&quot;test&quot;</span>, <span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    <span class="keyword">auto</span> it = redis.<span class="built_in">get</span>(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (it) &#123;</span><br><span class="line">        std::cout &lt;&lt; *it &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;  <span class="comment">// æ³¨æ„ *it</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;(nil)&quot;</span> &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>ç¼–è¯‘å¹¶è¿è¡Œæµ‹è¯•ä»£ç </li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">g++ test_redis.cpp -o test_redis -lredis++ -lhiredis -std=c++17</span><br><span class="line"></span><br><span class="line">./test_redis</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰æŸ¥çœ‹å½“å‰å®‰è£…çš„ç‰ˆæœ¬">ï¼ˆ2ï¼‰æŸ¥çœ‹å½“å‰å®‰è£…çš„ç‰ˆæœ¬</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> /usr/local/include/sw/redis++/version.h</span><br></pre></td></tr></table></figure>
<p><strong>å¯ä»¥çœ‹åˆ°</strong>ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> VERSION_MAJOR = <span class="number">1</span>;   <span class="comment">// ä¸»ç‰ˆæœ¬</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> VERSION_MINOR = <span class="number">3</span>;   <span class="comment">// æ¬¡ç‰ˆæœ¬</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> VERSION_PATCH = <span class="number">15</span>;  <span class="comment">// è¡¥ä¸ç‰ˆæœ¬</span></span><br><span class="line"><span class="comment">// å½“å‰ç‰ˆæœ¬ï¼š1.3.15 </span></span><br></pre></td></tr></table></figure>
<h3 id="4-Redis-ç‰ˆæœ¬å‡çº§ï¼ˆåˆ‡æ¢ï¼‰">4.Redis++ç‰ˆæœ¬å‡çº§ï¼ˆåˆ‡æ¢ï¼‰</h3>
<p>ä»¥æˆ‘çš„å®‰è£…ç›®å½•â€œ~/thirdparty/redis-plus-plusâ€ä¸ºä¾‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/thirdparty/redis-plus-plus</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸…ç†æ—§çš„æ„å»º</span></span><br><span class="line"><span class="built_in">rm</span> -rf build</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ¢åˆ°æœ€æ–°ç¨³å®šç‰ˆ</span></span><br><span class="line">git checkout 1.3.15</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘å®‰è£…</span></span><br><span class="line"><span class="built_in">mkdir</span> build &amp;&amp; <span class="built_in">cd</span> build</span><br><span class="line">cmake -DCMAKE_BUILD_TYPE=Release \</span><br><span class="line">      -DCMAKE_INSTALL_PREFIX=/usr/local \</span><br><span class="line">      -DREDIS_PLUS_PLUS_CXX_STANDARD=17 \</span><br><span class="line">      ..</span><br><span class="line">make -j$(<span class="built_in">nproc</span>)</span><br><span class="line"><span class="built_in">sudo</span> make install</span><br><span class="line"><span class="built_in">sudo</span> ldconfig</span><br></pre></td></tr></table></figure>
<h3 id="5-åˆ é™¤Redis">5.åˆ é™¤Redis++</h3>
<p>å¦‚æœå®‰è£…å¤±è´¥ï¼Œå¯é€šè¿‡ä¸‹è¿°æ–¹å¼æ¸…ç†Redis++æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ========== 1. æ¸…ç† Redis++ åº“æ–‡ä»¶ ==========</span></span><br><span class="line"><span class="comment"># åˆ é™¤åŠ¨æ€åº“æ–‡ä»¶ï¼ˆåŒ…æ‹¬è½¯é“¾æ¥ï¼‰</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -f /usr/local/lib/libredis++.so</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -f /usr/local/lib/libredis++.so.*</span><br><span class="line"><span class="comment"># åˆ é™¤é™æ€åº“æ–‡ä»¶ï¼ˆè‹¥æœ‰ï¼‰</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -f /usr/local/lib/libredis++.a</span><br><span class="line"></span><br><span class="line"><span class="comment"># ========== 2. æ¸…ç† Redis++ CMake é…ç½®æ–‡ä»¶ ==========</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /usr/local/lib/cmake/redis++</span><br><span class="line"><span class="comment"># åˆ é™¤ pkg-config é…ç½®ï¼ˆè‹¥æœ‰ï¼‰</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -f /usr/local/lib/pkgconfig/redis++.pc</span><br><span class="line"></span><br><span class="line"><span class="comment"># ========== 3. æ¸…ç† Redis++ å¤´æ–‡ä»¶ ==========</span></span><br><span class="line"><span class="comment"># æ ¸å¿ƒå¤´æ–‡ä»¶ç›®å½•ï¼ˆåŒ…å« StringView å®šä¹‰ï¼‰</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /usr/local/include/sw/redis++</span><br><span class="line"><span class="comment"># è‹¥å­˜åœ¨ sw ç©ºç›®å½•ï¼Œå¯ä¸€å¹¶åˆ é™¤ï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rmdir</span> /usr/local/include/sw 2&gt;/dev/null || <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ========== 4. åˆ·æ–°ç³»ç»ŸåŠ¨æ€åº“ç¼“å­˜ ==========</span></span><br><span class="line"><span class="built_in">sudo</span> ldconfig</span><br><span class="line"></span><br><span class="line"><span class="comment"># ========== 5. éªŒè¯æ¸…ç†ç»“æœï¼ˆå¯é€‰ï¼‰ ==========</span></span><br><span class="line"><span class="comment"># è‹¥ä»¥ä¸‹å‘½ä»¤å‡æ— è¾“å‡ºï¼Œè¯´æ˜æ¸…ç†å®Œæˆ</span></span><br><span class="line">find /usr/local/lib -name <span class="string">&quot;libredis++*&quot;</span></span><br><span class="line">find /usr/local/include -name <span class="string">&quot;redis++&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ========== 6. åˆ é™¤Redis++ç›®å½• ==============</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf redis-plus-plus/</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>C++</category>
        <category>C++åç«¯å¼€å‘åº“</category>
        <category>redis-plus-plus</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>1.mysqlåœ¨cppä¸­çš„åŸºæœ¬ç”¨æ³•</title>
    <url>/2026/01/07/C++/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/mysql%E5%9C%A8cpp%E4%B8%AD%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95/</url>
    <content><![CDATA[<h1>1.MySQL C å¸¸ç”¨API</h1>
<p><strong>æ³¨ï¼šå¦‚æœè¦è¯¦ç»†äº†è§£ç›¸å…³ç»“æ„ä½“æˆ–ç»†èŠ‚ï¼Œå¯ä»¥å‚è€ƒ&quot;MySQL 8.4 C API å¼€å‘è€…æŒ‡å—&quot;</strong><br>
<a href="https://dev.mysqlserver.cn/doc/c-api/8.4/en/c-api-introduction.html">MySQL 8.4 C API å¼€å‘è€…æŒ‡å—</a></p>
<h2 id="1-åˆ›å»ºå¹¶åˆå§‹åŒ–MYSQLå¥æŸ„">1.åˆ›å»ºå¹¶åˆå§‹åŒ–MYSQLå¥æŸ„</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260107202349321.png" alt=""></p>
<h2 id="2-è®¾ç½®è¿æ¥é…ç½®å‚æ•°ï¼ˆå¯é€‰ï¼‰">2.è®¾ç½®è¿æ¥é…ç½®å‚æ•°ï¼ˆå¯é€‰ï¼‰</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260107202427224.png" alt=""></p>
<h2 id="3-å°è¯•è¿æ¥æ•°æ®åº“">3.å°è¯•è¿æ¥æ•°æ®åº“</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260107202454744.png" alt=""></p>
<h2 id="4-æ‰§è¡ŒSQLæ“ä½œ">4.æ‰§è¡ŒSQLæ“ä½œ</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260108081201418.png" alt=""></p>
<h2 id="5-é‡Šæ”¾èµ„æº">5.é‡Šæ”¾èµ„æº</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260107202723688.png" alt=""></p>
<p><strong>1.å¿…é¡»æ‰‹åŠ¨é‡Šæ”¾çš„èµ„æº</strong><br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260107215343290.png" alt=""></p>
<p><strong>2.ä¸éœ€è¦æ‰‹åŠ¨é‡Šæ”¾çš„èµ„æº</strong><br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260107215419114.png" alt=""></p>
<h2 id="6-å…¶å®ƒ">6.å…¶å®ƒ</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260107230322030.png" alt=""></p>
<h2 id="7-æ¸¸æ ‡ç›¸å…³">7.æ¸¸æ ‡ç›¸å…³</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260107233502220.png" alt=""></p>
<h2 id="8-äº‹åŠ¡æ“ä½œ">8.äº‹åŠ¡æ“ä½œ</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260107213938986.png" alt=""></p>
<h2 id="9-é˜²SQLæ³¨å…¥">9.é˜²SQLæ³¨å…¥</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260108085257356.png" alt=""></p>
<p><strong>(1)ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>1.APIç¹ç</li>
<li>2.ç»“æœè·å–æ›´éº»çƒ¦ï¼šé¢„å¤„ç†è¯­å¥è·å–ç»“æœéœ€è¦é¢„å…ˆç»‘å®šè¾“å‡ºç¼“å†²åŒºï¼Œä»£ç é‡æ˜¯æ™®é€šæŸ¥è¯¢çš„ 2-3 å€ã€‚</li>
<li>3.å¤§å¤šæ•°åœºæ™¯æ€§èƒ½å·®å¼‚ä¸å¤§ï¼šé¢„å¤„ç†çš„æ€§èƒ½ä¼˜åŠ¿ä¸»è¦åœ¨é‡å¤æ‰§è¡ŒåŒä¸€ SQL æ—¶ï¼Œå•æ¬¡æŸ¥è¯¢å·®åˆ«å¾ˆå°ã€‚</li>
</ul>
<p><strong>(2)ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>1.â€œæ‰¹é‡æ’å…¥åŒç»“æ„æ•°æ®â€æ€§èƒ½æ˜æ˜¾æå‡</li>
<li>2.é«˜é¢‘é‡å¤æŸ¥è¯¢ï¼ŒSQLè§£æåªåšä¸€æ¬¡</li>
<li>3.äºŒè¿›åˆ¶æ•°æ®(BLOB),é¿å…è½¬ä¹‰é—®é¢˜</li>
</ul>
<p><strong>(3)ä½¿ç”¨åœºæ™¯</strong></p>
<ul>
<li>1.å®é™…å¼€å‘ä¸­ï¼Œä½¿ç”¨ â€œORMæ¡†æ¶â€ã€â€œæ•°æ®åº“æŠ½è±¡å±‚â€ã€â€œå‚æ•°åŒ–æ‹¼æ¥+è½¬ä¹‰â€è¾ƒå¤šï¼ŒåŸç”Ÿ mysql_stmt_*	ä½¿ç”¨è¾ƒå°‘</li>
<li>2.é€‚ç”¨ï¼šæ‰¹é‡æ’å…¥ã€é«˜é¢‘æŸ¥è¯¢ã€BLOB æ—¶å†è€ƒè™‘</li>
</ul>
<hr>
<h1>2.mysqlåœ¨cppä¸­ä½¿ç”¨çš„åŸºæœ¬æµç¨‹</h1>
<p><strong>1.åˆ›å»ºå¹¶åˆå§‹åŒ–MYSQLå¥æŸ„</strong></p>
<ul>
<li>mysql_init(conn_)</li>
<li>éœ€æ£€æŸ¥åˆå§‹åŒ–æ˜¯å¦æˆåŠŸ</li>
<li>æ³¨æ„ï¼šåˆå§‹åŒ–æˆåŠŸåå°±åˆ†é…èµ„æºäº†ï¼Œåç»­ä»»æ„ä¸€æ­¥å‡ºé—®é¢˜ï¼Œéƒ½éœ€è¦é€šè¿‡ mysql_closeé‡Šæ”¾èµ„æº</li>
</ul>
<p><strong>2.è®¾ç½®é…ç½®å‚æ•°(å¯é€‰)</strong></p>
<ul>
<li>è®¾ç½®è¿æ¥è¶…æ—¶ï¼š mysql_options(conn_, MYSQL_OPT_CONNECT_TIMEOUT, &amp;seconds)</li>
<li>è®¾ç½®å­—ç¬¦é›†ï¼šmysql_options(conn_, MYSQL_SET_CHARSET_NAME, â€œutf8mb4â€)</li>
<li>è®¾ç½®è¯»è¶…æ—¶ï¼š mysql_options(conn_, MYSQL_OPT_READ_TIMEOUT, &amp;seconds)</li>
<li>è®¾ç½®å†™è¶…æ—¶ï¼š mysql_options(conn_, MYSQL_OPT_WRITE_TIMEOUT, &amp;seconds)</li>
<li>è®¾ç½®è‡ªåŠ¨é‡è¿ï¼šmysql_options(conn_, MYSQL_OPT_RECONNECT, &amp;reconnect)</li>
</ul>
<p>mysql_optionsä¸€èˆ¬å¾ˆå°‘å‡ºé”™ï¼Œè¿™é‡Œå°±ä¸è€ƒè™‘å‡ºé”™</p>
<p><strong>3.å°è¯•è¿æ¥æ•°æ®åº“</strong></p>
<ul>
<li>mysql_real_connect</li>
<li>éœ€æ£€æŸ¥æ˜¯å¦è¿æ¥æˆåŠŸ,å¤±è´¥åˆ™mysql_close(conn_)</li>
</ul>
<p><strong>4.æ‰§è¡ŒSQLæ“ä½œ</strong></p>
<ul>
<li>mysql_query</li>
<li>mysql_affected_rows</li>
<li>mysql_store_result</li>
<li>mysql_fetch_row</li>
<li>â€¦</li>
</ul>
<p><strong>5.å…³é—­è¿æ¥ + é”€æ¯å¥æŸ„ï¼ˆé‡Šæ”¾èµ„æºï¼‰</strong></p>
<ul>
<li>mysql_free_result</li>
<li>mysql_close</li>
</ul>
<h1>3.å°è£…ç¤ºä¾‹</h1>
<p><strong>ç”±äºæœ¬äººç›®å‰èƒ½åŠ›æœ‰é™ï¼Œå¯èƒ½å®ç°å¹¶ä¸æ˜¯å¾ˆå¥½ï¼Œä»…ä½œAPIä½¿ç”¨æ¼”ç¤º</strong></p>
<h2 id="1-è¿æ¥å°è£…">1.è¿æ¥å°è£…</h2>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//mysql_connection.h</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;config/config.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mysql_result.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mysql/mysql.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;variant&gt;</span></span></span><br><span class="line"><span class="keyword">namespace</span> user&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MySQLConnection</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">using</span> Param=std::variant&lt;<span class="type">nullptr_t</span>,<span class="type">int64_t</span>,<span class="type">uint64_t</span>,<span class="type">double</span>,std::string&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">MySQLConnection</span><span class="params">(<span class="type">const</span> MySQLConfig&amp; config)</span></span>;</span><br><span class="line">    ~<span class="built_in">MySQLConnection</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç¦æ­¢æ‹·è´ï¼Œå…è®¸ç§»åŠ¨</span></span><br><span class="line">    <span class="built_in">MySQLConnection</span>(<span class="type">const</span> MySQLConnection&amp;)=<span class="keyword">delete</span>;</span><br><span class="line">    MySQLConnection&amp; <span class="keyword">operator</span>=(<span class="type">const</span> MySQLConnection&amp;)=<span class="keyword">delete</span>;</span><br><span class="line">    <span class="built_in">MySQLConnection</span>(MySQLConnection&amp;&amp; other)=<span class="keyword">delete</span>;</span><br><span class="line">    MySQLConnection&amp; <span class="keyword">operator</span>=(MySQLConnection&amp;&amp; other)=<span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æœ‰æ•ˆæ€§æ£€æŸ¥</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">Valid</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> mysql_ &amp;&amp; <span class="built_in">mysql_ping</span>(mysql_)==<span class="number">0</span>;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">MYSQL* <span class="title">Get</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> mysql_;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Selectæ“ä½œ</span></span><br><span class="line">    <span class="comment">//å­˜åœ¨é™åˆ¶ï¼šâ€œsqlä¸­ä¸å¯ä»¥åŒ…å«éå ä½ç¬¦&#x27;?&#x27;â€</span></span><br><span class="line">    <span class="function">MySQLResult <span class="title">Query</span><span class="params">(<span class="type">const</span> std::string&amp; sql,std::initializer_list&lt;Param&gt; param=&#123;&#125;)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Insert/Update/Deleteæ“ä½œ</span></span><br><span class="line">    <span class="comment">//å­˜åœ¨é™åˆ¶ï¼šâ€œsqlä¸­ä¸å¯ä»¥åŒ…å«éå ä½ç¬¦&#x27;?&#x27;â€</span></span><br><span class="line">    <span class="function"><span class="type">uint64_t</span> <span class="title">Execute</span><span class="params">(<span class="type">const</span> std::string&amp; sql,std::initializer_list&lt;Param&gt; params=&#123;&#125;)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æµå¼æŸ¥è¯¢ï¼ˆé€è¡Œè·å–ï¼Œé€‚åˆå¤§ç»“æœé›†ï¼‰</span></span><br><span class="line">    <span class="comment">// æ³¨æ„ï¼šéå†æœŸé—´ä¸èƒ½æ‰§è¡Œå…¶ä»–æŸ¥è¯¢ï¼</span></span><br><span class="line">    <span class="comment">// MySQLResult QueryUnbuffered(const std::string&amp; sql);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//è·å–Insertåçš„id</span></span><br><span class="line">    <span class="function"><span class="type">uint64_t</span> <span class="title">LastInsertId</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–å¹¶è®¾ç½®é€‰é¡¹</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">InitAndSetOptions</span><span class="params">(<span class="type">const</span> MySQLConfig&amp; config)</span></span>;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// åˆ¤æ–­é”™è¯¯æ˜¯å¦å€¼å¾—é‡è¯•</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">IsRetryableError</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> err_code)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é‡è¯•è¿æ¥</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">ConnectWithRetry</span><span class="params">(<span class="type">const</span> MySQLConfig&amp; config)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è½¬ä¹‰æ–¹æ³•ï¼ˆåªèƒ½ç”¨äºè½¬ä¹‰â€œå‚æ•°å€¼â€ï¼‰ï¼ˆé˜²SQLæ³¨å…¥çš„ç®€å•å¤„ç†ï¼‰</span></span><br><span class="line">    <span class="function">std::string <span class="title">Escape</span><span class="params">(<span class="type">const</span> std::string&amp; str)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//SQLè¯­å¥åŒ…è£…å™¨ï¼š â€œï¼Ÿä¸ºå ä½ç¬¦ â€”â€”&gt;sqlè¯­å¥ä¸­ä¸å¯ä»¥åŒ…å«éå ä½ç¬¦ ï¼Ÿâ€</span></span><br><span class="line">    <span class="function">std::string <span class="title">BuildSQL</span><span class="params">(<span class="type">const</span> std::string&amp; sql, std::initializer_list&lt;Param&gt; params)</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    MYSQL* mysql_=<span class="literal">nullptr</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//mysql_connection.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mysql_connection.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;common/logger.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;server/exception.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">namespace</span> user&#123;</span><br><span class="line"></span><br><span class="line">MySQLConnection::<span class="built_in">MySQLConnection</span>(<span class="type">const</span> MySQLConfig&amp; config)&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–å¹¶è®¾ç½®é€‰é¡¹</span></span><br><span class="line">        <span class="built_in">InitAndSetOptions</span>(config);</span><br><span class="line">    &#125;<span class="built_in">catch</span>(...)&#123;</span><br><span class="line">        <span class="keyword">if</span>(mysql_)&#123;</span><br><span class="line">            <span class="built_in">mysql_close</span>(mysql_);</span><br><span class="line">            mysql_=<span class="literal">nullptr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">mysql_real_connect</span>(mysql_,</span><br><span class="line">                            config.host.<span class="built_in">c_str</span>(),</span><br><span class="line">                            config.username.<span class="built_in">c_str</span>(),</span><br><span class="line">                            config.password.<span class="built_in">c_str</span>(),</span><br><span class="line">                            config.database.<span class="built_in">c_str</span>(),</span><br><span class="line">                            config.port,</span><br><span class="line">                            <span class="literal">nullptr</span>,</span><br><span class="line">                            <span class="number">0</span>))&#123;</span><br><span class="line">        <span class="comment">//ä¸€å®šè¦å…ˆä¿å­˜é”™è¯¯ä¿¡æ¯ï¼Œå¦åˆ™é‡Šæ”¾mysql_åå°±æ— æ³•è·å–äº†</span></span><br><span class="line">        <span class="type">unsigned</span> <span class="type">int</span> err_code = <span class="built_in">mysql_errno</span>(mysql_);</span><br><span class="line">        std::string err_msg = <span class="built_in">mysql_error</span>(mysql_);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¿æ¥å¤±è´¥</span></span><br><span class="line">        <span class="built_in">mysql_close</span>(mysql_);</span><br><span class="line">        mysql_=<span class="literal">nullptr</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="type">bool</span> should_retry = config.auto_reconnect.<span class="built_in">value_or</span>(<span class="literal">false</span>) &amp;&amp; </span><br><span class="line">                    config.max_retries &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">                    <span class="built_in">IsRetryableError</span>(err_code);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!should_retry) &#123;</span><br><span class="line">            <span class="built_in">LOG_ERROR</span>(<span class="string">&quot;mysql_real_connect failed [&#123;&#125;]: &#123;&#125;&quot;</span>, err_code, err_msg);</span><br><span class="line">            <span class="keyword">throw</span> <span class="built_in">MySQLException</span>(err_code, err_msg);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//é‡è¿</span></span><br><span class="line">        <span class="built_in">ConnectWithRetry</span>(config);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MySQLConnection::~<span class="built_in">MySQLConnection</span>()&#123;</span><br><span class="line">    <span class="keyword">if</span>(mysql_)&#123;</span><br><span class="line">        <span class="built_in">mysql_close</span>(mysql_);</span><br><span class="line">        mysql_=<span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">MySQLResult <span class="title">MySQLConnection::Query</span><span class="params">(<span class="type">const</span> std::string&amp; sql,std::initializer_list&lt;Param&gt; params)</span></span>&#123;</span><br><span class="line">    std::string new_sql=<span class="built_in">BuildSQL</span>(sql,params);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//æ‰§è¡ŒæŸ¥è¯¢</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">mysql_query</span>(mysql_, new_sql.<span class="built_in">c_str</span>()) != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">int</span> err_code = <span class="built_in">mysql_errno</span>(mysql_);</span><br><span class="line">        std::string err_msg = <span class="built_in">mysql_error</span>(mysql_);</span><br><span class="line">        <span class="built_in">LOG_ERROR</span>(<span class="string">&quot;Query failed [&#123;&#125;]: &#123;&#125; | SQL: &#123;&#125;&quot;</span>, err_code, err_msg, new_sql);</span><br><span class="line">        <span class="keyword">throw</span> <span class="built_in">MySQLException</span>(err_code, err_msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è·å–ç»“æœé›†</span></span><br><span class="line">    MYSQL_RES* res=<span class="built_in">mysql_store_result</span>(mysql_);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ³¨æ„ï¼šSELECT è¯­å¥æ‰§è¡Œå‡ºé”™æ—¶ï¼Œ resä¸ºnullptrï¼ˆç©ºé›†æ—¶ä¸ä¼šä¸ºnullptrï¼‰</span></span><br><span class="line">    <span class="comment">// ä½†å¦‚æœæ˜¯é SELECT è¯­å¥è°ƒç”¨äº† Queryï¼Œres ä¹Ÿä¼šæ˜¯ nullptr</span></span><br><span class="line">    <span class="keyword">if</span> (res == <span class="literal">nullptr</span> &amp;&amp; <span class="built_in">mysql_field_count</span>(mysql_) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// åº”è¯¥æœ‰ç»“æœä½†æ²¡æ‹¿åˆ°ï¼Œè¯´æ˜å‡ºé”™äº†</span></span><br><span class="line">        <span class="type">unsigned</span> <span class="type">int</span> err_code = <span class="built_in">mysql_errno</span>(mysql_);</span><br><span class="line">        std::string err_msg = <span class="built_in">mysql_error</span>(mysql_);</span><br><span class="line">        <span class="built_in">LOG_ERROR</span>(<span class="string">&quot;mysql_store_result failed [&#123;&#125;]: &#123;&#125;&quot;</span>, err_code, err_msg);</span><br><span class="line">        <span class="keyword">throw</span> <span class="built_in">MySQLException</span>(err_code, err_msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">MySQLResult</span>(res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">uint64_t</span> <span class="title">MySQLConnection::Execute</span><span class="params">(<span class="type">const</span> std::string&amp; sql,std::initializer_list&lt;Param&gt; params)</span></span>&#123;</span><br><span class="line">    std::string new_sql=<span class="built_in">BuildSQL</span>(sql,params);</span><br><span class="line">    <span class="comment">//æ‰§è¡ŒæŸ¥è¯¢</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">mysql_query</span>(mysql_, new_sql.<span class="built_in">c_str</span>()) != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">int</span> err_code = <span class="built_in">mysql_errno</span>(mysql_);</span><br><span class="line">        std::string err_msg = <span class="built_in">mysql_error</span>(mysql_);</span><br><span class="line">        <span class="built_in">LOG_ERROR</span>(<span class="string">&quot;Query failed [&#123;&#125;]: &#123;&#125; | SQL: &#123;&#125;&quot;</span>, err_code, err_msg, new_sql);</span><br><span class="line">        <span class="keyword">throw</span> <span class="built_in">MySQLException</span>(err_code, err_msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">mysql_affected_rows</span>(mysql_);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è·å–Insertåçš„id</span></span><br><span class="line"><span class="function"><span class="type">uint64_t</span> <span class="title">MySQLConnection::LastInsertId</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">mysql_insert_id</span>(mysql_);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MySQLConnection::InitAndSetOptions</span><span class="params">(<span class="type">const</span> MySQLConfig&amp; config)</span></span>&#123;</span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–è¿æ¥å¥æŸ„</span></span><br><span class="line">    mysql_=<span class="built_in">mysql_init</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">if</span>(!mysql_)&#123;</span><br><span class="line">        <span class="built_in">LOG_ERROR</span>(<span class="string">&quot;mysql_init failed&quot;</span>);</span><br><span class="line">        <span class="comment">//æ³¨æ„ï¼šä¸å¯ä»¥throw MySQLException(mysql_errno(mysql_),mysql_error(mysql_));</span></span><br><span class="line">        <span class="comment">//å› ä¸ºmysql_ æ˜¯ nullptrï¼Œmysql_errno(nullptr) è¡Œä¸ºæœªå®šä¹‰</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="built_in">MySQLException</span>(<span class="number">0</span>, <span class="string">&quot;mysql_init failed: out of memory&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è®¾ç½®å‚æ•°</span></span><br><span class="line">    <span class="keyword">if</span>(config.connection_timeout_ms.<span class="built_in">has_value</span>())&#123;</span><br><span class="line">        <span class="type">int</span> connection_timeout=config.connection_timeout_ms.<span class="built_in">value</span>()/<span class="number">1000</span>; <span class="comment">//msâ€”&gt;s</span></span><br><span class="line">        <span class="built_in">mysql_options</span>(mysql_,MYSQL_OPT_CONNECT_TIMEOUT,&amp;connection_timeout);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(config.read_timeout_ms.<span class="built_in">has_value</span>())&#123;</span><br><span class="line">        <span class="type">int</span> read_timeout=config.read_timeout_ms.<span class="built_in">value</span>()/<span class="number">1000</span>;</span><br><span class="line">        <span class="built_in">mysql_options</span>(mysql_,MYSQL_OPT_READ_TIMEOUT,&amp;read_timeout);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(config.write_timeout_ms.<span class="built_in">has_value</span>())&#123;</span><br><span class="line">        <span class="type">int</span> write_timeout=config.write_timeout_ms.<span class="built_in">value</span>()/<span class="number">1000</span>;</span><br><span class="line">        <span class="built_in">mysql_options</span>(mysql_,MYSQL_OPT_WRITE_TIMEOUT,&amp;write_timeout);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(config.auto_reconnect.<span class="built_in">has_value</span>())&#123;</span><br><span class="line">        <span class="comment">/*MySQL C API åº•å±‚ä¸ç›´æ¥æ”¯æŒ bool ç±»å‹ï¼Œè€Œæ˜¯ç”¨ unsigned intï¼ˆæ— ç¬¦å·æ•´æ•°ï¼‰æ¥è¡¨ç¤ºå¸ƒå°”å€¼ï¼Œ</span></span><br><span class="line"><span class="comment">          0 ä»£è¡¨ falseï¼Œé 0 ä»£è¡¨ trueã€‚*/</span></span><br><span class="line">        <span class="type">unsigned</span> <span class="type">int</span> mybool=config.auto_reconnect.<span class="built_in">value</span>()?<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">mysql_options</span>(mysql_,MYSQL_OPT_RECONNECT,&amp;mybool);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">mysql_options</span>(mysql_,MYSQL_SET_CHARSET_NAME,config.charset.<span class="built_in">c_str</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­é”™è¯¯æ˜¯å¦å€¼å¾—é‡è¯•</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">MySQLConnection::IsRetryableError</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> err_code)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (err_code) &#123;</span><br><span class="line">        <span class="comment">// å¯é‡è¯•çš„é”™è¯¯ï¼ˆç½‘ç»œ/ä¸´æ—¶æ€§é—®é¢˜ï¼‰</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">2002</span>:  <span class="comment">// CR_CONNECTION_ERROR - socket é”™è¯¯</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">2003</span>:  <span class="comment">// CR_CONN_HOST_ERROR - æ— æ³•è¿æ¥ä¸»æœº</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">2006</span>:  <span class="comment">// CR_SERVER_GONE_ERROR - æœåŠ¡å™¨æ–­å¼€</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">2013</span>:  <span class="comment">// CR_SERVER_LOST - è¿æ¥ä¸¢å¤±</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä¸å¯é‡è¯•çš„é”™è¯¯ï¼ˆé…ç½®/è®¤è¯é—®é¢˜ï¼‰</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">1045</span>:  <span class="comment">// ER_ACCESS_DENIED_ERROR - è®¤è¯å¤±è´¥</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">1044</span>:  <span class="comment">// ER_DBACCESS_DENIED_ERROR - æ— æƒé™</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">1049</span>:  <span class="comment">// ER_BAD_DB_ERROR - æ•°æ®åº“ä¸å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">2005</span>:  <span class="comment">// CR_UNKNOWN_HOST - æœªçŸ¥ä¸»æœº</span></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MySQLConnection::ConnectWithRetry</span><span class="params">(<span class="type">const</span> MySQLConfig&amp; config)</span></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> err_code=<span class="number">0</span>;</span><br><span class="line">    std::string err_msg;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">unsigned</span> <span class="type">int</span> attempt=<span class="number">1</span>;attempt&lt;=config.max_retries;++attempt)&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="built_in">InitAndSetOptions</span>(config);</span><br><span class="line">            <span class="comment">//å°è¯•è¿æ¥</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">mysql_real_connect</span>(mysql_,</span><br><span class="line">                                  config.host.<span class="built_in">c_str</span>(),</span><br><span class="line">                                  config.username.<span class="built_in">c_str</span>(),</span><br><span class="line">                                  config.password.<span class="built_in">c_str</span>(),</span><br><span class="line">                                  config.database.<span class="built_in">c_str</span>(),</span><br><span class="line">                                  config.port,</span><br><span class="line">                                  <span class="literal">nullptr</span>,</span><br><span class="line">                                  <span class="number">0</span>))&#123;</span><br><span class="line">                <span class="comment">// è¿æ¥æˆåŠŸ</span></span><br><span class="line">                <span class="built_in">LOG_INFO</span>(<span class="string">&quot;MySQL connected to &#123;&#125;:&#123;&#125;/&#123;&#125; (attempt &#123;&#125;/&#123;&#125;)&quot;</span>,</span><br><span class="line">                        config.host, config.port, config.database,</span><br><span class="line">                        attempt,config.max_retries);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">            <span class="comment">//è¿æ¥å¤±è´¥</span></span><br><span class="line">            err_code=<span class="built_in">mysql_errno</span>(mysql_);</span><br><span class="line">            err_msg=<span class="built_in">mysql_error</span>(mysql_);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//é‡Šæ”¾å½“å‰å¥æŸ„</span></span><br><span class="line">            <span class="built_in">mysql_close</span>(mysql_);</span><br><span class="line">            mysql_=<span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">LOG_WARN</span>(<span class="string">&quot;MySQL connect attempt &#123;&#125;/&#123;&#125; failed [&#123;&#125;]: &#123;&#125;&quot;</span>,</span><br><span class="line">                attempt, config.max_retries, err_code, err_msg);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(!<span class="built_in">IsRetryableError</span>(err_code))&#123;</span><br><span class="line">                <span class="built_in">LOG_ERROR</span>(<span class="string">&quot;Non-retryable error, giving up&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//å°è¯•é‡è¿ï¼ˆç­‰å¾…ä¸€æ®µæ—¶é—´ï¼‰</span></span><br><span class="line">            <span class="built_in">LOG_INFO</span>(<span class="string">&quot;Retrying in &#123;&#125; ms...&quot;</span>, config.retry_interval_ms);</span><br><span class="line">            std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">milliseconds</span>(config.retry_interval_ms));</span><br><span class="line">        &#125;<span class="built_in">catch</span>(...)&#123;</span><br><span class="line">            <span class="comment">//æ•æ‰InitAndSetOptionsç­‰æŠ›å‡ºçš„å¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">if</span>(mysql_)&#123;</span><br><span class="line">                <span class="built_in">mysql_close</span>(mysql_);</span><br><span class="line">                mysql_=<span class="literal">nullptr</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">throw</span>; <span class="comment">//ç»§ç»­å‘ä¸Šä¼ é€’</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰€æœ‰é‡è¯•éƒ½å¤±è´¥</span></span><br><span class="line">    <span class="built_in">LOG_ERROR</span>(<span class="string">&quot;all Retry are failed. mysql connect failed&quot;</span>);</span><br><span class="line">    <span class="keyword">throw</span> <span class="built_in">MySQLException</span>(err_code, </span><br><span class="line">        <span class="string">&quot;Failed to connect after &quot;</span> + std::<span class="built_in">to_string</span>(config.max_retries) + </span><br><span class="line">        <span class="string">&quot; attempts: &quot;</span> + err_msg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è½¬ä¹‰æ–¹æ³•ï¼ˆé˜²SQLæ³¨å…¥çš„ç®€å•å¤„ç†ï¼‰</span></span><br><span class="line"><span class="function">std::string <span class="title">MySQLConnection::Escape</span><span class="params">(<span class="type">const</span> std::string&amp; str)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!mysql_)&#123;</span><br><span class="line">        <span class="built_in">LOG_ERROR</span>(<span class="string">&quot;Connection not established&quot;</span>);</span><br><span class="line">        <span class="keyword">throw</span> <span class="built_in">MySQLException</span>(<span class="number">0</span>, <span class="string">&quot;Connection not established&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æœ€åæƒ…å†µâ€œéƒ½éœ€è¦è½¬ç§»â€ï¼šæ‰€ä»¥å°†ç©ºé—´è®¾ç½®ä¸º 2*str.size()+1ï¼ˆå®˜æ–¹æ¨èé•¿åº¦ï¼‰</span></span><br><span class="line">    <span class="comment">//ä½¿ç”¨vectoræ›´å®‰å…¨ï¼Œä¹Ÿé¿å…æ‰‹åŠ¨ç®¡ç†ç©ºé—´</span></span><br><span class="line">    <span class="function">std::vector&lt;<span class="type">char</span>&gt; <span class="title">buffer</span><span class="params">(str.size()*<span class="number">2</span><span class="number">+1</span>)</span></span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> len=<span class="built_in">mysql_real_escape_string</span>(mysql_,buffer.<span class="built_in">data</span>(),str.<span class="built_in">c_str</span>(),</span><br><span class="line">                                                <span class="built_in">static_cast</span>&lt;<span class="type">unsigned</span> <span class="type">long</span>&gt;(str.<span class="built_in">size</span>()));</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">string</span>(buffer.<span class="built_in">data</span>(),len);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//SQLè¯­å¥åŒ…è£…å™¨</span></span><br><span class="line"><span class="function">std::string <span class="title">MySQLConnection::BuildSQL</span><span class="params">(<span class="type">const</span> std::string&amp; sql, std::initializer_list&lt;Param&gt; params)</span></span>&#123;</span><br><span class="line">    <span class="comment">// é¢„åˆ†é…å†…å­˜ï¼šåˆå§‹å®¹é‡ä¸ºSQLé•¿åº¦ + å‚æ•°å¹³å‡é•¿åº¦*å‚æ•°æ•°é‡ï¼ˆå‡å°‘å†…å­˜é‡åˆ†é…ï¼‰</span></span><br><span class="line">    std::string result;</span><br><span class="line">    result.<span class="built_in">reserve</span>(sql.<span class="built_in">size</span>() + params.<span class="built_in">size</span>() * <span class="number">32</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> param=params.<span class="built_in">begin</span>();</span><br><span class="line">    <span class="comment">//è§£æsqlä¸­çš„&#x27;?&#x27;å ä½ç¬¦ï¼Œå¹¶ç”¨paramsä¸­çš„å‚æ•°å¡«å…¥</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; c:sql)&#123;</span><br><span class="line">        <span class="keyword">if</span>(c==<span class="string">&#x27;?&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(param==params.<span class="built_in">end</span>())&#123;</span><br><span class="line">                <span class="comment">//å‚æ•°ä¸è¶³</span></span><br><span class="line">                <span class="built_in">LOG_ERROR</span>(<span class="string">&quot;å‚æ•°ä¸è¶³&quot;</span>);</span><br><span class="line">                <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;param is not enough&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            std::<span class="built_in">visit</span>([&amp;](<span class="keyword">auto</span>&amp;&amp; val)&#123;</span><br><span class="line">                <span class="keyword">using</span> T=std::<span class="type">decay_t</span>&lt;<span class="keyword">decltype</span>(val)&gt;;</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">constexpr</span>(std::is_same_v&lt;T,<span class="type">nullptr_t</span>&gt;)&#123;</span><br><span class="line">                    result+=<span class="string">&quot;NULL&quot;</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span> <span class="built_in">constexpr</span>(std::is_same_v&lt;T,std::string&gt;)&#123;</span><br><span class="line">                    <span class="comment">//å­—ç¬¦ä¸²è¦åŠ â€œè½¬ä¹‰å•å¼•å·â€</span></span><br><span class="line">                    result+=<span class="string">&quot;\&#x27;&quot;</span>;</span><br><span class="line">                    result+=<span class="built_in">Escape</span>(val);  <span class="comment">//è¿›è¡Œè½¬ä¹‰ï¼šæ–¹sqlæ³¨å…¥</span></span><br><span class="line">                    result+=<span class="string">&quot;\&#x27;&quot;</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    result+=std::<span class="built_in">to_string</span>(val);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,*param);</span><br><span class="line"></span><br><span class="line">            param++;  <span class="comment">//å‚æ•°åç§»</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//æ™®é€šå­—ç¬¦</span></span><br><span class="line">            result.<span class="built_in">push_back</span>(c);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(param!=params.<span class="built_in">end</span>())&#123;</span><br><span class="line">        <span class="built_in">LOG_ERROR</span>(<span class="string">&quot;å‚æ•°è¿‡å¤š&quot;</span>);</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;too many param&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="2-ç»“æœé›†å°è£…">2.ç»“æœé›†å°è£…</h2>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//mysql_result.h</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mysql/mysql.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdint&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdexcept&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;optional&gt;</span></span></span><br><span class="line"><span class="keyword">namespace</span> user&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç®¡ç†ç»“æœé›†</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MySQLResult</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">MySQLResult</span><span class="params">(MYSQL_RES* res)</span></span>;</span><br><span class="line">    ~<span class="built_in">MySQLResult</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¦ç”¨æ‹·è´ï¼Œå…è®¸ç§»åŠ¨</span></span><br><span class="line">    <span class="built_in">MySQLResult</span>(<span class="type">const</span> MySQLResult&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    MySQLResult&amp; <span class="keyword">operator</span>=(<span class="type">const</span> MySQLResult&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    <span class="comment">//ç§»åŠ¨æ“ä½œåŠ  noexcept å¯ä»¥è®© STL å®¹å™¨æ›´å¥½åœ°ä¼˜åŒ–ã€‚</span></span><br><span class="line">    <span class="built_in">MySQLResult</span>(MySQLResult&amp;&amp; other) <span class="keyword">noexcept</span>;</span><br><span class="line">    MySQLResult&amp; <span class="keyword">operator</span>=(MySQLResult&amp;&amp; other) <span class="keyword">noexcept</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éå†ï¼šè·å–ä¸‹ä¸€è¡Œå­˜å‚¨åœ¨current_row_ä¸­ï¼Œæ— æ•°æ®åˆ™è¿”å›false</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">Next</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å…ƒä¿¡æ¯</span></span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">RowCount</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">FieldCount</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å–å€¼ï¼ˆåˆ—ç´¢å¼•ä» 0 å¼€å§‹ï¼‰</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">IsNull</span><span class="params">(<span class="type">size_t</span> col)</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function">std::optional&lt;std::string&gt; <span class="title">GetString</span><span class="params">(<span class="type">size_t</span> col)</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function">std::optional&lt;<span class="type">int64_t</span>&gt; <span class="title">GetInt</span><span class="params">(<span class="type">size_t</span> col)</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function">std::optional&lt;<span class="type">double</span>&gt; <span class="title">GetDouble</span><span class="params">(<span class="type">size_t</span> col)</span> <span class="type">const</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç©ºç»“æœé›†åˆ¤æ–­</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">Empty</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> result_ == <span class="literal">nullptr</span> || <span class="built_in">RowCount</span>() == <span class="number">0</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">//æ£€æŸ¥è®¿é—®çš„åˆ—æ˜¯å¦åˆæ³•ï¼Œä¸åˆæ³•æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">CheckColumn</span><span class="params">(<span class="type">size_t</span> col)</span> <span class="type">const</span></span>;</span><br><span class="line"></span><br><span class="line">    MYSQL_RES* result_ = <span class="literal">nullptr</span>;       <span class="comment">//ç»“æœé›†</span></span><br><span class="line">    MYSQL_ROW current_row_ = <span class="literal">nullptr</span>;   <span class="comment">//å½“å‰è¡Œ</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span>* lengths_ = <span class="literal">nullptr</span>;  <span class="comment">//å½“å‰è¡Œå„åˆ—å­—æ®µå€¼çš„å®é™…é•¿åº¦æ•°ç»„</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> field_count_ = <span class="number">0</span>;      <span class="comment">//ç»“æœé›†çš„åˆ—æ•°</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//mysql_result.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mysql_result.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;server/exception.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdexcept&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="keyword">namespace</span> user&#123;</span><br><span class="line">    </span><br><span class="line">MySQLResult::<span class="built_in">MySQLResult</span>(MYSQL_RES* res)</span><br><span class="line">:<span class="built_in">result_</span>(res),</span><br><span class="line">    <span class="built_in">field_count_</span>(res?<span class="built_in">mysql_num_fields</span>(res):<span class="number">0</span>)</span><br><span class="line">&#123;&#125;</span><br><span class="line"></span><br><span class="line">MySQLResult::~<span class="built_in">MySQLResult</span>()&#123;</span><br><span class="line">    <span class="keyword">if</span>(result_)&#123;</span><br><span class="line">        <span class="built_in">mysql_free_result</span>(result_);</span><br><span class="line">        result_=<span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MySQLResult::<span class="built_in">MySQLResult</span>(MySQLResult&amp;&amp; other) <span class="keyword">noexcept</span></span><br><span class="line">    : <span class="built_in">result_</span>(other.result_),</span><br><span class="line">        <span class="built_in">current_row_</span>(other.current_row_),</span><br><span class="line">        <span class="built_in">lengths_</span>(other.lengths_),</span><br><span class="line">        <span class="built_in">field_count_</span>(other.field_count_)&#123;</span><br><span class="line">    other.result_=<span class="literal">nullptr</span>;</span><br><span class="line">    other.current_row_=<span class="literal">nullptr</span>;</span><br><span class="line">    other.lengths_=<span class="literal">nullptr</span>;</span><br><span class="line">    other.field_count_=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MySQLResult&amp; MySQLResult::<span class="keyword">operator</span>=(MySQLResult&amp;&amp; other) <span class="keyword">noexcept</span>&#123;</span><br><span class="line">    <span class="comment">//æ³¨æ„æ£€æŸ¥&amp;other!=this</span></span><br><span class="line">    <span class="keyword">if</span>(&amp;other!=<span class="keyword">this</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(result_)&#123;</span><br><span class="line">            <span class="comment">//é‡Šæ”¾è‡ªå·±çš„èµ„æº</span></span><br><span class="line">            <span class="built_in">mysql_free_result</span>(result_);</span><br><span class="line">        &#125;</span><br><span class="line">        result_=other.result_;</span><br><span class="line">        current_row_=other.current_row_;</span><br><span class="line">        lengths_=other.lengths_;</span><br><span class="line">        field_count_=other.field_count_;</span><br><span class="line"></span><br><span class="line">        other.result_=<span class="literal">nullptr</span>;</span><br><span class="line">        other.current_row_=<span class="literal">nullptr</span>;</span><br><span class="line">        other.lengths_=<span class="literal">nullptr</span>;</span><br><span class="line">        other.field_count_=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">MySQLResult::Next</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!result_) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">//è·å–ä¸€è¡Œæ•°æ®ï¼ˆæ¸¸æ ‡è‡ªåŠ¨åç§»ï¼‰</span></span><br><span class="line">    current_row_=<span class="built_in">mysql_fetch_row</span>(result_);</span><br><span class="line">    <span class="keyword">if</span>(current_row_)&#123;</span><br><span class="line">        <span class="comment">//è·å–å„å­—æ®µé•¿åº¦</span></span><br><span class="line">        lengths_=<span class="built_in">mysql_fetch_lengths</span>(result_);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">size_t</span> <span class="title">MySQLResult::RowCount</span><span class="params">()</span> <span class="type">const</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> result_?<span class="built_in">static_cast</span>&lt;<span class="type">size_t</span>&gt;(<span class="built_in">mysql_num_rows</span>(result_)):<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">size_t</span> <span class="title">MySQLResult::FieldCount</span><span class="params">()</span> <span class="type">const</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> field_count_;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MySQLResult::CheckColumn</span><span class="params">(<span class="type">size_t</span> col)</span> <span class="type">const</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!current_row_)&#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;No current row, call Next() first&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(col&gt;=field_count_)&#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">out_of_range</span>(<span class="string">&quot;Column index &quot;</span> + std::<span class="built_in">to_string</span>(col) + </span><br><span class="line">                            <span class="string">&quot; out of range, max is &quot;</span> + std::<span class="built_in">to_string</span>(field_count_ - <span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">MySQLResult::IsNull</span><span class="params">(<span class="type">size_t</span> col)</span> <span class="type">const</span></span>&#123;</span><br><span class="line">    <span class="built_in">CheckColumn</span>(col);</span><br><span class="line">    <span class="keyword">return</span> current_row_[col]==<span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::optional&lt;std::string&gt; <span class="title">MySQLResult::GetString</span><span class="params">(<span class="type">size_t</span> col)</span> <span class="type">const</span></span>&#123;</span><br><span class="line">    <span class="built_in">CheckColumn</span>(col);</span><br><span class="line">    <span class="comment">//mysqlä¸­ï¼Œå¯èƒ½å­˜çš„æ˜¯NULL</span></span><br><span class="line">    <span class="keyword">if</span>(current_row_[col]==<span class="literal">nullptr</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="literal">nullopt</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//current_row_å¯èƒ½åŒ…å«çš„æ˜¯äºŒè¿›åˆ¶ï¼Œä¸å¯ä»¥ç›´æ¥è¿”å›ï¼Œé¿å…è¢«â€œæˆªæ–­â€</span></span><br><span class="line">    <span class="keyword">if</span>(lengths_)&#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">string</span>(current_row_[col],lengths_[col]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> current_row_[col];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::optional&lt;<span class="type">int64_t</span>&gt; <span class="title">MySQLResult::GetInt</span><span class="params">(<span class="type">size_t</span> col)</span> <span class="type">const</span></span>&#123;</span><br><span class="line">    <span class="built_in">CheckColumn</span>(col);</span><br><span class="line">    <span class="comment">//mysqlä¸­ï¼Œå¯èƒ½å­˜çš„æ˜¯NULL</span></span><br><span class="line">    <span class="keyword">if</span>(current_row_[col]==<span class="literal">nullptr</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="literal">nullopt</span>;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">strtoll</span>(current_row_[col],<span class="literal">nullptr</span>,<span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::optional&lt;<span class="type">double</span>&gt; <span class="title">MySQLResult::GetDouble</span><span class="params">(<span class="type">size_t</span> col)</span> <span class="type">const</span></span>&#123;</span><br><span class="line">    <span class="built_in">CheckColumn</span>(col);</span><br><span class="line">    <span class="comment">//mysqlä¸­ï¼Œå¯èƒ½å­˜çš„æ˜¯NULL</span></span><br><span class="line">    <span class="keyword">if</span>(current_row_[col]==<span class="literal">nullptr</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="literal">nullopt</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">strtod</span>(current_row_[col],<span class="literal">nullptr</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>C++</category>
        <category>å¼€å‘ç¬”è®°</category>
        <category>mysql</category>
        <category>1.mysqlåœ¨cppä¸­çš„åŸºæœ¬ç”¨æ³•</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>â€˜å˜é•¿å‚æ•°åˆ—è¡¨â€™çš„å¤šç§å®ç°æ–¹å¼</title>
    <url>/2026/01/08/C++/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/%E2%80%98%E5%8F%98%E9%95%BF%E5%8F%82%E6%95%B0%E5%88%97%E8%A1%A8%E2%80%99%E7%9A%84%E5%A4%9A%E7%A7%8D%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F/</url>
    <content><![CDATA[<h1>1.å®ç°æ–¹å¼</h1>
<ul>
<li><strong>å‚æ•°ç±»å‹æœ‰é™ / ä¸ä¿®æ”¹å‚æ•° / æƒ³å®ç°ç®€å•</strong> â†’ std::initializer_list + std::variantï¼›</li>
<li><strong>å‚æ•°ç±»å‹å¤šæ ·</strong> â†’ å˜å‚æ¨¡æ¿ typenameâ€¦ Argsï¼ˆå¦‚æ—¥å¿—ç³»ç»Ÿã€çº¿ç¨‹æ± ï¼‰ï¼›</li>
<li><strong>éœ€å­˜å‚¨ / ä¿®æ”¹å‚æ•°</strong> â†’ std::vector + std::variantï¼›</li>
</ul>
<h2 id="1-std-initializer-list-std-variant">1.std::initializer_list + std::variant</h2>
<h3 id="1-std-initializer-listä»‹ç»">(1)std::initializer_listä»‹ç»</h3>
<h4 id="1-æ¦‚è¿°">&lt;1&gt;æ¦‚è¿°</h4>
<ul>
<li>std::initializer_list æ˜¯ C++11 å¼•å…¥çš„è½»é‡çº§æ¨¡æ¿ç±»ï¼ˆå¤´æ–‡ä»¶ &lt;initializer_list&gt;ï¼‰</li>
<li><strong>æ ¸å¿ƒç›®æ ‡</strong>ï¼šå®ç°ç»Ÿä¸€ã€ç®€æ´çš„ èŠ±æ‹¬å· {} åˆå§‹åŒ–è¯­æ³•</li>
</ul>
<h4 id="2-æ ¸å¿ƒæœ¬è´¨ä¸ç‰¹è´¨">&lt;2&gt;æ ¸å¿ƒæœ¬è´¨ä¸ç‰¹è´¨</h4>
<ul>
<li><strong>åªè¯»çš„è½»é‡çº§è§†å›¾</strong>ï¼šå†…éƒ¨ä»…å­˜å‚¨ã€ŒæŒ‡å‘åº•å±‚æ•°ç»„çš„æŒ‡é’ˆ + å…ƒç´ ä¸ªæ•°ã€ï¼Œæ— å†…å­˜æ‹·è´ï¼Œåº•å±‚æ•°ç»„ç”±ç¼–è¯‘å™¨ç®¡ç†ï¼ˆåªè¯»ï¼Œæ— æ³•ä¿®æ”¹å…ƒç´ ï¼‰ï¼›</li>
<li><strong>æ¨¡æ¿ç±»ç‰¹æ€§</strong>ï¼šéœ€æŒ‡å®šå…ƒç´ ç±»å‹ï¼ˆå¦‚ std::initializer_list<int>ï¼‰ï¼Œæ”¯æŒèŒƒå›´ forã€begin()/end() éå†ï¼›</li>
<li><strong>å¯æ‹·è´ä½†æ— å¼€é”€</strong>ï¼šæ‹·è´ä»…å¤åˆ¶æŒ‡é’ˆå’Œé•¿åº¦ï¼Œä¸å¤åˆ¶åº•å±‚æ•°ç»„ï¼Œç”Ÿå‘½å‘¨æœŸä¸å¯¹è±¡ç»‘å®šï¼ˆä¸´æ—¶å¯¹è±¡åœ¨è¯­å¥ç»“æŸåé”€æ¯ï¼‰ã€‚</li>
</ul>
<h4 id="3-std-initializer-listçš„ä½¿ç”¨ï¼ˆè¿™é‡Œä¸»è¦ä»‹ç»ä¸â€™å˜é•¿å‚æ•°ç›¸å…³çš„â€™ï¼‰">&lt;3&gt;std::initializer_listçš„ä½¿ç”¨ï¼ˆè¿™é‡Œä¸»è¦ä»‹ç»ä¸â€™å˜é•¿å‚æ•°ç›¸å…³çš„â€™ï¼‰</h4>
<p>1.é€šè¿‡ èŠ±æ‹¬å·{} ä¼ å…¥å‚æ•°<br>
2.é€šè¿‡forå¾ªç¯éå†è¯»å–å€¼</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">sum</span><span class="params">(std::initializer_list&lt;<span class="type">int</span>&gt; nums)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> total = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// éå†å˜é•¿å‚æ•°åˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> n : nums) &#123;</span><br><span class="line">        total += n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> total;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¼ é€’ä¸åŒæ•°é‡çš„å˜é•¿å‚æ•°</span></span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;sum(1,2,3) = &quot;</span> &lt;&lt; <span class="built_in">sum</span>(&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;) &lt;&lt; std::endl;          <span class="comment">// 3ä¸ªå‚æ•°ï¼Œè¾“å‡ºï¼š6</span></span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;sum(10,20,30,40) = &quot;</span> &lt;&lt; <span class="built_in">sum</span>(&#123;<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span>&#125;) &lt;&lt; std::endl; <span class="comment">// 4ä¸ªå‚æ•°ï¼Œè¾“å‡ºï¼š100</span></span><br></pre></td></tr></table></figure>
<h4 id="4-å…³é”®é¿å‘ç‚¹">&lt;4&gt;å…³é”®é¿å‘ç‚¹</h4>
<ul>
<li><strong>å…ƒç´ åªè¯»</strong>ï¼šæ— æ³•ä¿®æ”¹ initializer_list å†…çš„å…ƒç´ ï¼ˆå¦‚ il[0] = 10 ç¼–è¯‘æŠ¥é”™ï¼‰ï¼›</li>
<li><strong>ç”Ÿå‘½å‘¨æœŸé™·é˜±</strong>ï¼šä¸è¦ä¿å­˜å…¶è¿­ä»£å™¨ / æŒ‡é’ˆåˆ°å‡½æ•°å¤–éƒ¨ï¼Œå¦åˆ™ä¼šå› åº•å±‚æ•°ç»„é”€æ¯å¯¼è‡´æ‚¬ç©ºæŒ‡é’ˆï¼›</li>
<li><strong>ç©ºåˆ—è¡¨æ”¯æŒ</strong>ï¼šç©ºåˆ—è¡¨ {} åˆæ³•ï¼Œsize() è¿”å› 0ï¼Œbegin() == end()ï¼›</li>
</ul>
<h4 id="5-ä¸vectorçš„å¯¹æ¯”å›¾">&lt;5&gt; ä¸vectorçš„å¯¹æ¯”å›¾</h4>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260108101908382.png" alt=""></p>
<h3 id="2-std-variantä»‹ç»">(2)std::variantä»‹ç»</h3>
<p><strong>å‚è€ƒï¼š</strong><a href="https://xianyubuxian-txy.github.io/2026/01/08/16-std-variant/">16.std::variant</a></p>
<h3 id="3-std-initializer-list-std-variant-å®ç°â€˜å˜é•¿å‚æ•°åˆ—è¡¨â€™-å®ä¾‹">(3)std::initializer_list + std::variant å®ç°â€˜å˜é•¿å‚æ•°åˆ—è¡¨â€™ å®ä¾‹</h3>
<p><strong>ç›®æ ‡ï¼šå°è£…sqlè¯­å¥ï¼Œå…è®¸å…¶ä»¥ï¼ˆâ€œINSERT INTO user (name, age, score) VALUES (?, ?, ?)â€,{â€œå¼ ä¸‰â€, 25, 95.5}ï¼‰å½¢å¼ä½œä¸ºâ€œå‚æ•°â€ä¼ é€’</strong></p>
<ul>
<li>'?â€˜ä¸ºâ€œå ä½ç¬¦â€ï¼Œä¹Ÿå°±è¦æ±‚åŸsqlä¸­ï¼Œä¸å¯ä»¥æœ‰å†—ä½™çš„â€™?'é€ æˆå¹²æ‰°ï¼ˆè¿™å­˜åœ¨ä¸€å®šçš„å±€é™æ€§ï¼‰</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸‡èƒ½ç›’å­ï¼šèƒ½ NULL/int64/uint64/double/string äº”ç§ç±»å‹(å¯è‡ªè¡Œå¢åŠ )</span></span><br><span class="line"><span class="keyword">using</span> Param = std::variant&lt;std::<span class="type">nullptr_t</span>, <span class="type">int64_t</span>, <span class="type">uint64_t</span>, <span class="type">double</span>, std::string&gt;;</span><br><span class="line"></span><br><span class="line"><span class="function">std::string <span class="title">BuildSQL</span><span class="params">(<span class="type">const</span> std::string&amp; sql, std::initializer_list&lt;Param&gt; params)</span></span>&#123;</span><br><span class="line">    std::string result;</span><br><span class="line">    result.<span class="built_in">reserve</span>(sql.<span class="built_in">size</span>()*<span class="number">2</span>);  <span class="comment">//é¢„åˆ†é…ç©ºé—´</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">auto</span> it = params.<span class="built_in">begin</span>();  <span class="comment">// ä¿®æ­£ï¼šparmas â†’ params</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; sql.<span class="built_in">size</span>(); ++i)&#123;</span><br><span class="line">        <span class="keyword">if</span>(sql[i] == <span class="string">&#x27;?&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(it == params.<span class="built_in">end</span>())&#123;</span><br><span class="line">                <span class="keyword">throw</span> std::<span class="built_in">invalid_argument</span>(<span class="string">&quot;Not enough parameters&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//ç”¨ std::visit è§£æ variant çš„å®é™…ç±»å‹</span></span><br><span class="line">            std::<span class="built_in">visit</span>([&amp;](<span class="keyword">auto</span>&amp;&amp; arg)&#123;</span><br><span class="line">                <span class="keyword">using</span> T = std::<span class="type">decay_t</span>&lt;<span class="keyword">decltype</span>(arg)&gt;;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// ç¼–è¯‘æœŸç±»å‹åˆ¤æ–­ï¼ˆconstexpr ifï¼ŒC++17ï¼‰</span></span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">constexpr</span>(std::is_same_v&lt;T, std::<span class="type">nullptr_t</span>&gt;)&#123;</span><br><span class="line">                    result += <span class="string">&quot;NULL&quot;</span>;  <span class="comment">// NULL ç±»å‹ç›´æ¥æ‹¼ &quot;NULL&quot;</span></span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="built_in">constexpr</span>(std::is_same_v&lt;T, std::<span class="type">int64_t</span>&gt;)&#123;</span><br><span class="line">                    result += std::<span class="built_in">to_string</span>(arg);  <span class="comment">// ä¿®æ­£ï¼šåŠ ä¸Šstd::</span></span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="built_in">constexpr</span>(std::is_same_v&lt;T, std::<span class="type">uint64_t</span>&gt;)&#123;  <span class="comment">// ä¿®æ­£ï¼šuint64 â†’ uint64_t</span></span><br><span class="line">                    result += std::<span class="built_in">to_string</span>(arg);  <span class="comment">// ä¿®æ­£ï¼šåŠ ä¸Šstd::</span></span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="built_in">constexpr</span>(std::is_same_v&lt;T, <span class="type">double</span>&gt;)&#123;  <span class="comment">// ä¿®æ­£ï¼šstd::double â†’ double</span></span><br><span class="line">                    result += std::<span class="built_in">to_string</span>(arg);  <span class="comment">// ä¿®æ­£ï¼šå‚æ•°åº”ä¸ºargè€Œédouble</span></span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="built_in">constexpr</span>(std::is_same_v&lt;T, std::string&gt;)&#123;</span><br><span class="line">                    result += <span class="string">&#x27;\&#x27;&#x27;</span>;  <span class="comment">// ä¿®æ­£ï¼šç¼ºå°‘åˆ†å·</span></span><br><span class="line">                    result += arg;</span><br><span class="line">                    result += <span class="string">&#x27;\&#x27;&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, *it);</span><br><span class="line">            </span><br><span class="line">            ++it;  <span class="comment">// å‚æ•°è¿­ä»£å™¨åç§»</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            result += sql[i];  <span class="comment">// éå ä½ç¬¦ï¼Œç›´æ¥æ‹¼æ¥å­—ç¬¦</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (it != params.<span class="built_in">end</span>()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">invalid_argument</span>(<span class="string">&quot;Too many parameters&quot;</span>);  <span class="comment">// å‚æ•°è¿‡å¤š</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°å£°æ˜ï¼ˆæ¥æ”¶å˜é•¿å‚æ•°åˆ—è¡¨ï¼‰</span></span><br><span class="line"><span class="function">MySQLResult <span class="title">Query</span><span class="params">(<span class="type">const</span> std::string&amp; sql, std::initializer_list&lt;Param&gt; params)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨è€…ä»£ç ï¼ˆæè‡´ç®€æ´ï¼‰</span></span><br><span class="line">conn.<span class="built_in">Query</span>(<span class="string">&quot;SELECT * FROM user WHERE name=? AND age=? AND height=?&quot;</span>, &#123;<span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="number">25</span>, <span class="number">175</span>&#125;);</span><br><span class="line">conn.<span class="built_in">Execute</span>(<span class="string">&quot;INSERT INTO user (name, age) VALUES (?, ?)&quot;</span>, &#123;<span class="string">&quot;æå››&quot;</span>, <span class="number">30</span>&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="4-ä¼˜ç¼ºç‚¹-é€‚ç”¨åœºæ™¯">(4)ä¼˜ç¼ºç‚¹ &amp; é€‚ç”¨åœºæ™¯</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260108103335014.png" alt=""></p>
<h2 id="2-å˜å‚æ¨¡æ¿-template-typenameâ€¦-Args">2.å˜å‚æ¨¡æ¿ template&lt;typenameâ€¦ Args&gt;</h2>
<p><strong>ä¹‹åå†è¡¥å……</strong></p>
]]></content>
      <categories>
        <category>C++</category>
        <category>å¼€å‘ç¬”è®°</category>
        <category>åŠŸèƒ½ç‚¹</category>
        <category>â€˜å˜é•¿å‚æ•°åˆ—è¡¨â€™çš„å¤šç§å®ç°æ–¹å¼</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¨¡æ¿ç¼–ç¨‹å¸¸ç”¨æŠ€å·§</title>
    <url>/2026/01/07/C++/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/%E6%A8%A1%E6%9D%BF%E7%BC%96%E7%A8%8B/</url>
    <content><![CDATA[<h1>1.ç¼–è¯‘æœŸifè¯­å¥</h1>
<p>é€šè¿‡ä½¿ç”¨è¯­æ³•<strong>if constexpr(â€¦)</strong>ï¼Œç¼–è¯‘å™¨å¯ä»¥è®¡ç®—ç¼–è¯‘æœŸçš„æ¡ä»¶è¡¨è¾¾å¼æ¥<strong>åœ¨ç¼–è¯‘æœŸå†³å®š</strong>ä½¿ç”¨ä¸€ä¸ªifè¯­å¥<br>
çš„thençš„éƒ¨åˆ†è¿˜æ˜¯elseçš„éƒ¨åˆ†ã€‚<br>
<strong>å¯å‚è€ƒ</strong>ï¼š<a href="https://xianyubuxian-txy.github.io/2026/01/07/10-%E7%BC%96%E8%AF%91%E6%9C%9Fif%E8%AF%AD%E5%8F%A5/">10 ç¼–è¯‘æœŸifè¯­å¥</a></p>
<hr>
<h1>2.ç±»å‹èƒå–ï¼ˆType Traitsï¼‰ å·¥å…·</h1>
<h2 id="1-æ¦‚è¿°">1.æ¦‚è¿°</h2>
<p><strong>(1)å¤´æ–‡ä»¶ï¼š #include&lt;type_traits&gt;</strong><br>
<strong>(2)åŠŸèƒ½ï¼šæä¾›çš„ç¼–è¯‘æœŸç±»å‹åˆ¤æ–­ / è½¬æ¢å·¥å…·ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯åœ¨æ¨¡æ¿ç¼–ç¨‹ä¸­è·å–æˆ–ä¿®æ”¹ç±»å‹çš„å±æ€§ï¼Œå®ç°ç¼–è¯‘æœŸå†³ç­–ã€‚</strong></p>
<h2 id="2-ç±»å‹åˆ¤æ–­ç±»ï¼ˆåˆ¤æ–­ç±»å‹å±æ€§ï¼‰">2.ç±»å‹åˆ¤æ–­ç±»ï¼ˆåˆ¤æ–­ç±»å‹å±æ€§ï¼‰</h2>
<ul>
<li>è¿™ç±»èƒå–å·¥å…·ä»¥ is_xxx å‘½åï¼ŒC++17 åæä¾› is_xxx_v ä¾¿æ·åˆ«åï¼ˆç­‰ä»·äº is_xxx<T>::valueï¼‰ï¼Œè¿”å›ç¼–è¯‘æœŸå¸ƒå°”å¸¸é‡ã€‚<br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260107100035470.png" alt=""></li>
</ul>
<h2 id="3-std-conditional-t-Condition-T-F-ï¼šç¼–è¯‘æœŸæ¡ä»¶ç±»å‹é€‰æ‹©å·¥å…·">3.std::conditional_t&lt;Condition, T, F&gt; ï¼šç¼–è¯‘æœŸæ¡ä»¶ç±»å‹é€‰æ‹©å·¥å…·</h2>
<h3 id="1-æ ¸å¿ƒä½œç”¨">1.æ ¸å¿ƒä½œç”¨</h3>
<ul>
<li>æ ¹æ®ä¸€ä¸ª<strong>ç¼–è¯‘æœŸå¸ƒå°”å¸¸é‡</strong>ï¼Œåœ¨ä¸¤ç§ç±»å‹ï¼ˆT å’Œ Fï¼‰ä¸­é€‰æ‹©å…¶ä¸€</li>
<li>æ•´ä¸ªé€‰æ‹©è¿‡ç¨‹å®Œå…¨å‘ç”Ÿåœ¨ç¼–è¯‘é˜¶æ®µï¼Œä¸ä¼šäº§ç”Ÿä»»ä½•è¿è¡Œæ—¶å¼€é”€ã€‚</li>
<li>å¦‚æœ Condition ä¸º true â†’ æœ€ç»ˆç±»å‹æ˜¯ T</li>
<li>å¦‚æœ Condition ä¸º false â†’ æœ€ç»ˆç±»å‹æ˜¯ F</li>
</ul>
<h3 id="2-æ ¸å¿ƒè¦æ±‚">2.æ ¸å¿ƒè¦æ±‚</h3>
<ul>
<li>Condition å¿…é¡»æ˜¯ç¼–è¯‘æœŸå¯ç¡®å®šçš„å¸ƒå°”å€¼
<ul>
<li>true/false å­—é¢é‡</li>
<li>constexpr å¸¸é‡</li>
<li>static_assert</li>
<li>is_same_vã€is_integral_vâ€¦</li>
<li>ç­‰ç±»å‹èƒå–çš„ç»“æœï¼Œä¸èƒ½æ˜¯è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šçš„å˜é‡ã€‚</li>
</ul>
</li>
</ul>
<h2 id="4-å¯è°ƒç”¨å¯¹è±¡ç›¸å…³ç±»">4.å¯è°ƒç”¨å¯¹è±¡ç›¸å…³ç±»</h2>
<p><strong>ç”¨äºæ¨å¯¼å¯è°ƒç”¨å¯¹è±¡ï¼ˆå‡½æ•°ã€Lambdaã€ä»¿å‡½æ•°ï¼‰çš„å±æ€§ï¼Œæ˜¯æ³›å‹å›è°ƒã€å‡½æ•°åŒ…è£…çš„æ ¸å¿ƒå·¥å…·ã€‚</strong><br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260107120513290.png" alt=""></p>
<hr>
<h2 id="5-ä½¿ç”¨ç¤ºä¾‹">5.ä½¿ç”¨ç¤ºä¾‹</h2>
<h3 id="è¿æ¥æ± æ¨¡æ¿ç¤ºä¾‹ï¼ˆéƒ¨åˆ†ä»£ç ï¼‰">è¿æ¥æ± æ¨¡æ¿ç¤ºä¾‹ï¼ˆéƒ¨åˆ†ä»£ç ï¼‰</h3>
<p><strong>1.çŸ¥è¯†ç‚¹ï¼š</strong></p>
<ul>
<li>if constexpr</li>
<li>std::is_same_v</li>
<li>std::conditional_t</li>
</ul>
<p><strong>2.åŠŸèƒ½æ¦‚è¿°</strong></p>
<ul>
<li>å®ç°ä¸€ä¸ªâ€œè¿æ¥æ± æ¨¡æ¿â€ï¼Œç”¨äºåˆ›å»ºmysqlã€redisè¿æ¥æ± </li>
<li>mysqlå’Œrediséƒ½æœ‰å„è‡ªçš„â€œé…ç½®â€(é€šè¿‡æ–‡ä»¶åŠ è½½)ï¼Œè¿æ¥æ± éœ€è¦è·å–å¯¹åº”çš„é…ç½®æ¥è¿›è¡Œåˆå§‹åŒ–</li>
<li>ä¸ºè·å–å¯¹åº”çš„é…ç½® â€”â€”&gt;â€œè¿æ¥æ± æ¨¡æ¿â€éœ€åœ¨ç¼–è¯‘æœŸæ ¹æ®Tçš„å®é™…ç±»å‹(MySQLConnection / RedisConnection)ï¼Œè·å–å¯¹åº”â€œé…ç½®â€(MySQLConfig / RedisConfig)</li>
<li>è·å–å¯¹åº”é…ç½®åï¼Œå°±å¯ä»¥è·å–å¯¹åº”çš„pool_sizeç¡®å®šè¿æ¥æ± å¤§å°ï¼Œå¹¶å°†â€œé…ç½®â€ä¼ ç»™â€œåˆ›å»ºè¿æ¥å›è°ƒå‡½æ•°â€è¿›è¡Œè¿æ¥çš„åˆ›å»º<br>
<strong>æ³¨ï¼šä¸ªäººèƒ½åŠ›æœ‰é™ï¼Œç¤ºä¾‹ä»£ç å¯èƒ½å¹¶ä¸æ˜¯å¾ˆå®Œç¾å®ç”¨ï¼Œä»…ä½œæ¼”ç¤º</strong></li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;type_traits&gt;</span></span></span><br><span class="line"><span class="comment">//mysqlé…ç½®ç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MySQLConfig</span>&#123;</span><br><span class="line">    <span class="type">int</span> pool_size=<span class="number">10</span>;</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">GetPoolSize</span><span class="params">()</span> <span class="type">const</span></span>&#123; <span class="keyword">return</span> pool_size;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//redisé…ç½®ç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">RedisConfig</span>&#123;</span><br><span class="line">    <span class="type">int</span> pool_size=<span class="number">5</span>;</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">GetPoolSize</span><span class="params">()</span> <span class="type">const</span></span>&#123; <span class="keyword">return</span> pool_size;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//å…¨å±€é…ç½®ç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">GlobalConfig</span>&#123;</span><br><span class="line">    MySQLConfig mysql;</span><br><span class="line">    RedisConfig redis;</span><br><span class="line">    ...</span><br><span class="line">&#125;; </span><br><span class="line"></span><br><span class="line"><span class="comment">/*-----------------------æ³›å‹è¿æ¥æ± æ¨¡æ¿ç±»éƒ¨åˆ†ä»£ç -----------------*/</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MySQLConnection</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RedisConnection</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TemplateConnectionPool</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">using</span> ConnectionPtr=std::unique_ptr&lt;T&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é€šè¿‡åµŒå¥—std::conditional_tåœ¨ç¼–è¯‘æœŸç¡®å®šâ€œé…ç½®ç±»å‹â€</span></span><br><span class="line">    <span class="keyword">using</span> Config =  std::<span class="type">conditional_t</span>&lt;std::is_same_v&lt;T, MySQLConnection&gt;,MySQLConfig,</span><br><span class="line">                    std::<span class="type">conditional_t</span>&lt;std::is_same_v&lt;T, RedisConnection&gt;,RedisConfig,</span><br><span class="line">                    <span class="type">void</span>&gt;&gt;;</span><br><span class="line">    <span class="keyword">using</span> ConfigPtr=std::shared_ptr&lt;<span class="type">const</span> Config&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">TemplateConnectionPool</span>(std::shared_ptr&lt;GlobalConfig&gt; global_config,std::function&lt;<span class="built_in">ConnectionPtr</span>(<span class="type">const</span> Config&amp;)&gt;func)</span><br><span class="line">    :<span class="built_in">createConnFunc_</span>(std::<span class="built_in">move</span>(func))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!global_config)&#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">invalid_argument</span>(<span class="string">&quot;config is nullptr&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">ExtractSubConfig</span>(global_config); <span class="comment">// æå–å­é…ç½®</span></span><br><span class="line">        <span class="built_in">InitPool</span>();    <span class="comment">//åˆå§‹åŒ–è¿æ¥æ± </span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// æå–å­é…ç½®ï¼ˆå°è£…åˆ†æ”¯é€»è¾‘ï¼Œä¾¿äºåç»­æ‰©å±•ï¼‰</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">ExtractSubConfig</span><span class="params">(<span class="type">const</span> std::shared_ptr&lt;GlobalConfig&gt;global_config)</span></span>&#123;</span><br><span class="line">        <span class="comment">// ç¼–è¯‘æœŸåˆ¤æ–­ï¼šå¦‚æœæ˜¯MySQLè¿æ¥ç±»å‹ï¼Œæå–mysqlå­é…ç½®</span></span><br><span class="line">        <span class="function"><span class="keyword">if</span> <span class="title">constexpr</span><span class="params">(std::is_same_v&lt;T,MySQLConnection&gt;)</span></span>&#123;</span><br><span class="line">            config_=std::<span class="built_in">make_shared</span>&lt;<span class="type">const</span> Config&gt;(global_config-&gt;mysql);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç¼–è¯‘æœŸåˆ¤æ–­ï¼šå¦‚æœæ˜¯Redisè¿æ¥ç±»å‹ï¼Œæå–rediså­é…ç½®</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> <span class="built_in">constexpr</span>(std::is_same_v&lt;T,RedisConnection&gt;)&#123;</span><br><span class="line">            config_=std::<span class="built_in">make_shared</span>&lt;<span class="type">const</span> Config&gt;(global_config-&gt;redis);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç¼–è¯‘æœŸå…œåº•ï¼šéæ”¯æŒç±»å‹ç›´æ¥è§¦å‘ç¼–è¯‘é”™è¯¯</span></span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// static_assert(false)ä¼šå¼ºåˆ¶ç¼–è¯‘å¤±è´¥ï¼Œæç¤ºä¸æ”¯æŒçš„è¿æ¥ç±»å‹</span></span><br><span class="line">            <span class="comment">// æ³¨ï¼šstd::is_void_v&lt;T&gt;ä»…ä½œä¸ºå ä½ï¼Œæ ¸å¿ƒæ˜¯è§¦å‘ç¼–è¯‘æŠ¥é”™</span></span><br><span class="line">            <span class="built_in">static_assert</span>(std::is_void_v&lt;T&gt;, <span class="string">&quot;Unsupported connection type, no matching sub-config&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">InitPool</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//è·å–æ± å¤§å°</span></span><br><span class="line">        <span class="type">int</span> poolSize=config_-&gt;<span class="built_in">GetPoolSize</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;poolSize;++i)&#123;</span><br><span class="line">            <span class="comment">//å°†config_ä¼ å…¥â€œå›è°ƒå‡½æ•°â€åˆ›å»ºè¿æ¥</span></span><br><span class="line">            <span class="keyword">auto</span> conn=std::<span class="built_in">move</span>(<span class="built_in">createConnFunc_</span>(*config_));</span><br><span class="line">            <span class="keyword">if</span>(!conn)&#123;</span><br><span class="line">                <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to create connection&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            pool_.<span class="built_in">push_back</span>(std::<span class="built_in">move</span>(conn));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::deque&lt;ConnectionPtr&gt; pool_;	<span class="comment">//è¿æ¥æ± </span></span><br><span class="line">    ConfigPtr config_;					<span class="comment">//é…ç½®</span></span><br><span class="line">    <span class="comment">//åˆ›å»ºè¿æ¥å›è°ƒå‡½æ•°</span></span><br><span class="line">    std::function&lt;ConnectionPtr(<span class="type">const</span> Config&amp;)&gt; createConnFunc_;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h1>3.å¯å˜å‚æ•°æ¨¡æ¿ï¼ˆvariadic templatesï¼‰</h1>
<h2 id="1-å‚æ•°åŒ…ï¼ˆtypenameâ€¦-Argsï¼‰">1.å‚æ•°åŒ…ï¼ˆtypenameâ€¦ Argsï¼‰</h2>
<h3 id="1-æ¦‚è¿°-2">(1)æ¦‚è¿°</h3>
<ul>
<li><strong>Argsï¼šä¸€ä¸ªå ä½ç¬¦åå­—ï¼Œå¯ä»¥ä»»æ„å–ï¼ˆå¸¸è§ Argsã€Tsã€Types ç­‰ï¼‰ã€‚</strong></li>
<li><strong>typenameâ€¦ Argsï¼šå‘Šè¯‰ç¼–è¯‘å™¨ â€œè¿™é‡Œæœ‰é›¶ä¸ªæˆ–å¤šä¸ªç±»å‹å‚æ•°ï¼Œå®ƒä»¬é›†åˆåœ¨ä¸€èµ·å«åš Argsâ€</strong></li>
<li><strong>å½“ä½ å®ä¾‹åŒ–æ¨¡æ¿æ—¶ï¼Œå¯ä»¥ç»™ Args ä¼ å…¥ä»»æ„ä¸ªç±»å‹ï¼š</strong></li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span>... Args&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Tuple</span> &#123;&#125;;</span><br><span class="line"><span class="comment">// å®ä¾‹åŒ–ï¼š</span></span><br><span class="line">Tuple&lt;&gt;                t0;    <span class="comment">// Args ä¸ºç©ºåŒ…</span></span><br><span class="line">Tuple&lt;<span class="type">int</span>&gt;             t1;    <span class="comment">// Args = &#123;int&#125;</span></span><br><span class="line">Tuple&lt;<span class="type">int</span>, <span class="type">double</span>, <span class="type">char</span>&gt; t3;  <span class="comment">// Args = &#123;int, double, char&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="2-å‡½æ•°æ¨¡æ¿ä¸­çš„å¯å˜å‚æ•°">2.å‡½æ•°æ¨¡æ¿ä¸­çš„å¯å˜å‚æ•°</h2>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªå¯æ¥æ”¶ä»»æ„ç±»å‹ã€ä»»æ„ä¸ªå‚æ•°çš„å‡½æ•°æ¨¡æ¿</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span>... Args&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">logAll</span><span class="params">(Args&amp;&amp;... args)</span> </span>&#123;</span><br><span class="line">     (std::cout &lt;&lt; ... &lt;&lt; args) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>; <span class="comment">// C++17 æŠ˜å è¡¨è¾¾å¼</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="built_in">logAll</span>(<span class="number">1</span>, <span class="string">&quot; + &quot;</span>, <span class="number">2.5</span>, <span class="string">&quot; = &quot;</span>, <span class="number">3.5</span>);</span><br></pre></td></tr></table></figure>
<p><strong>Argså¸¸é…åˆå…¶å®ƒåº“å‡½æ•°ä½¿ç”¨ï¼Œè¿™é‡Œå°±ä¸æ¼”ç¤ºâ€œè§£åŒ…â€äº†</strong></p>
<h2 id="3-ä½¿ç”¨ç¤ºä¾‹">3.ä½¿ç”¨ç¤ºä¾‹</h2>
<h3 id="çº¿ç¨‹æ± â€œä»»åŠ¡æäº¤å‡½æ•°â€">çº¿ç¨‹æ± â€œä»»åŠ¡æäº¤å‡½æ•°â€</h3>
<p><strong>1.æœ¬èŠ‚ç›¸å…³çŸ¥è¯†ç‚¹ï¼š</strong></p>
<ul>
<li>typenameâ€¦ Argsï¼šåšå¯å˜å‚æ•°</li>
<li>std::invoke_result_tï¼šæ¨å¯¼è¿”å›å€¼ç±»å‹</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// submitTaskï¼šæŠŠ func å’Œ args ç»‘å®šæˆä¸€ä¸ªæ— å‚çš„å¯è°ƒç”¨å¯¹è±¡ï¼Œç›´æ¥æ‰“åŒ…è¿› packaged_task</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Func, <span class="keyword">typename</span>... Args&gt;</span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">submitTask</span><span class="params">(Func&amp;&amp; func, Args&amp;&amp;... args)</span></span></span><br><span class="line"><span class="function">    -&gt; std::future&lt;std::<span class="type">invoke_result_t</span>&lt;std::<span class="type">decay_t</span>&lt;Func&gt;,</span></span><br><span class="line"><span class="function">                                       std::<span class="type">decay_t</span>&lt;Args&gt;...&gt;&gt;</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">using</span> DecayF    = std::<span class="type">decay_t</span>&lt;Func&gt;;</span><br><span class="line">    <span class="keyword">using</span> RType     = std::<span class="type">invoke_result_t</span>&lt;DecayF, std::<span class="type">decay_t</span>&lt;Args&gt;...&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1) æŠŠ func å’Œ args å…¨éƒ¨ decay åï¼Œbind_front ç»‘å®šæˆä¸€ä¸ª RType() å¯è°ƒç”¨å¯¹è±¡ ï¼ˆstd::bind_front æ˜¯ C++20 çš„ç‰¹æ€§ï¼‰</span></span><br><span class="line">    <span class="keyword">auto</span> bound = std::<span class="built_in">bind_front</span>( <span class="built_in">DecayF</span>(std::forward&lt;Func&gt;(func)),</span><br><span class="line">                                  std::forward&lt;Args&gt;(args)... );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2) ç”¨è¿™ä¸ª â€œæ— å‚å¯è°ƒç”¨å¯¹è±¡â€ æ„é€  packaged_task</span></span><br><span class="line">    <span class="keyword">auto</span> taskPtr = std::make_shared&lt;std::packaged_task&lt;<span class="built_in">RType</span>()&gt;&gt;(std::<span class="built_in">move</span>(bound));</span><br><span class="line">    <span class="keyword">auto</span> result  = taskPtr-&gt;<span class="built_in">get_future</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3) ç›´æ¥åœ¨æ–°çº¿ç¨‹é‡Œæ‰§è¡Œå®ƒ</span></span><br><span class="line">    std::<span class="built_in">thread</span>([taskPtr]() <span class="keyword">mutable</span> &#123;</span><br><span class="line">        <span class="comment">// packaged_task åœ¨è°ƒç”¨ operator() æ—¶ï¼Œ</span></span><br><span class="line">        <span class="comment">// å†…éƒ¨ä¼šç”¨ std::invoke ç‰¹æ®Šå¤„ç†å„ç§å¯è°ƒç”¨å¯¹è±¡</span></span><br><span class="line">        (*taskPtr)();</span><br><span class="line">    &#125;).<span class="built_in">detach</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>è¿™é‡Œä¸»è¦æƒ³æ¼”ç¤ºä¸€ä¸‹&quot;typenameâ€¦ Args&quot;ã€&quot;std::invoke_result_t&quot;çš„ä½¿ç”¨åœºæ™¯</strong></p>
<h1>4.â€œç±»å‹traitsæ˜ å°„â€ æŠ€å·§</h1>
<h2 id="1-æ ¸å¿ƒæ€è·¯">1.æ ¸å¿ƒæ€è·¯</h2>
<h3 id="1-å£°æ˜ä¸€ä¸ªâ€œç©ºâ€ä¸»æ¨¡æ¿ï¼ˆprimary-templateï¼‰">(1)å£°æ˜ä¸€ä¸ªâ€œç©ºâ€ä¸»æ¨¡æ¿ï¼ˆprimary templateï¼‰</h3>
<p><strong>ä¸ç»™å®ƒä»»ä½•å®šä¹‰</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span>&gt; </span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">connection_config</span>;  <span class="comment">// åªæ˜¯å£°æ˜ï¼Œä¸å®šä¹‰</span></span><br></pre></td></tr></table></figure>
<ul>
<li>å¦‚æœæœ‰äººå†™ connection_config<SomeType>ï¼Œè€Œä½ åˆæ²¡æœ‰ç»™å‡ºå¯¹ SomeType çš„ç‰¹åŒ–ï¼Œç¼–è¯‘å™¨å°±ä¼šç«‹åˆ»æŠ¥â€œæ‰¾ä¸åˆ° connection_config<SomeType>::typeâ€çš„é”™è¯¯ï¼Œæç¤ºâ€œè¿™ä¸ªç±»å‹ä¸å—æ”¯æŒâ€ã€‚</li>
</ul>
<h3 id="2-å¯¹å—æ”¯æŒçš„ç±»å‹åšæ˜¾å¼ç‰¹åŒ–ï¼ˆexplicit-specializationï¼‰">(2)å¯¹å—æ”¯æŒçš„ç±»å‹åšæ˜¾å¼ç‰¹åŒ–ï¼ˆexplicit specializationï¼‰</h3>
<p><strong>åœ¨ç‰¹åŒ–é‡Œå®šä¹‰ä¸€ä¸ª using type = â€¦;</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åªä¸º MySQLConnection æä¾›æ˜ å°„</span></span><br><span class="line"><span class="keyword">template</span>&lt;&gt; </span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">connection_config</span>&lt;MySQLConnection&gt; &#123; </span><br><span class="line">  <span class="keyword">using</span> type = MySQLConfig; </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åªä¸º RedisConnection æä¾›æ˜ å°„</span></span><br><span class="line"><span class="keyword">template</span>&lt;&gt; </span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">connection_config</span>&lt;RedisConnection&gt; &#123; </span><br><span class="line">  <span class="keyword">using</span> type = RedisConfig; </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>è¿™æ ·ï¼Œconnection_config<MySQLConnection>::type å°±æ˜¯ MySQLConfigï¼Œè€Œ connection_config<RedisConnection>::type å°±æ˜¯ RedisConfigã€‚</li>
</ul>
<h3 id="3-å†ç”¨ä¸€ä¸ª-alias-templateï¼ˆåˆ«åæ¨¡æ¿ï¼‰ç®€åŒ–å†™æ³•ï¼š">(3)å†ç”¨ä¸€ä¸ª alias templateï¼ˆåˆ«åæ¨¡æ¿ï¼‰ç®€åŒ–å†™æ³•ï¼š</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">using</span> Config_t = <span class="keyword">typename</span> connection_config&lt;T&gt;::type;</span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„ï¼šå¿…é¡»ä½¿ç”¨ typename å‘Šè¯‰ç¼–è¯‘å™¨connection_config<T>::typeæ˜¯â€œç±»å‹â€ï¼Œå¦åˆ™ç¼–è¯‘å™¨æ— æ³•çŸ¥é“å®ƒæ˜¯â€œç±»å‹â€è¿˜æ˜¯â€œå˜é‡â€</strong></p>
<ul>
<li>ä»¥ååœ¨ä»£ç é‡Œç›´æ¥å†™ Config_t<T>ï¼Œå°±ç­‰åŒäº connection_config<T>::typeï¼Œæ›´ç®€æ´ã€‚</li>
</ul>
<h3 id="4-ä¸ºä»€ä¹ˆè¿™ä¹ˆåšï¼Ÿ">(4)ä¸ºä»€ä¹ˆè¿™ä¹ˆåšï¼Ÿ</h3>
<p><strong>1.é›†ä¸­ç®¡ç†æ”¯æŒåˆ—è¡¨</strong>ï¼šæ‰€æœ‰æ”¯æŒçš„è¿æ¥ç±»å‹æ˜ å°„éƒ½é›†ä¸­åœ¨ connection_config&lt;â€¦&gt; çš„ç‰¹åŒ–é‡Œï¼Œæ–°åŠ ä¸€ç§è¿æ¥åªè¦åŠ ä¸€ä¸ªç‰¹åŒ–å³å¯ï¼Œå…¶ä»–é€»è¾‘ä¸ç”¨æ”¹ã€‚<br>
<strong>2.è¿™ç§æ¨¡å¼åœ¨ C++ æ ‡å‡†åº“é‡Œä¹Ÿå¾ˆå¸¸è§</strong>ï¼šæ¯”å¦‚ std::iterator_traits<Iter>ã€std::char_traits<Char>ã€std::common_type&lt;T,U&gt;ã€std::hash<T> ç­‰ï¼Œéƒ½æ˜¯â€œç©ºä¸»æ¨¡æ¿ + é’ˆå¯¹å—æ”¯æŒç±»å‹çš„ç‰¹åŒ– + alias templateâ€ ç»„åˆçš„å˜ä½“ã€‚</p>
<h3 id="5-å®ä¾‹ï¼š-å¯¹æ³›å‹è¿æ¥æ± æ¨¡æ¿è¿›è¡Œä¸€å®šçš„ä¼˜åŒ–">(5)å®ä¾‹ï¼š å¯¹æ³›å‹è¿æ¥æ± æ¨¡æ¿è¿›è¡Œä¸€å®šçš„ä¼˜åŒ–</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;type_traits&gt;</span></span></span><br><span class="line"><span class="comment">//mysqlé…ç½®ç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MySQLConfig</span>&#123;</span><br><span class="line">    <span class="type">int</span> pool_size=<span class="number">10</span>;</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">GetPoolSize</span><span class="params">()</span> <span class="type">const</span></span>&#123; <span class="keyword">return</span> pool_size;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//redisé…ç½®ç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">RedisConfig</span>&#123;</span><br><span class="line">    <span class="type">int</span> pool_size=<span class="number">5</span>;</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">GetPoolSize</span><span class="params">()</span> <span class="type">const</span></span>&#123; <span class="keyword">return</span> pool_size;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//å…¨å±€é…ç½®ç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">GlobalConfig</span>&#123;</span><br><span class="line">    MySQLConfig mysql;</span><br><span class="line">    RedisConfig redis;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*-----------------------ç±»å‹traitsæ˜ å°„-------------------------*/</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MySQLConnection</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RedisConnection</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ConnectionConfig</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ConnectionConfig</span>&lt;MySQLConnection&gt;&#123;<span class="keyword">using</span> type=MySQLConfig;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ConnectionConfig</span>&lt;RedisConnection&gt;&#123;<span class="keyword">using</span> type=RedisConfig;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//typenameï¼š å‘Šè¯‰ç¼–è¯‘å™¨ConnectionConfig&lt;T&gt;::typeä¸ºç±»å‹</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">using</span> Config_t= <span class="keyword">typename</span> ConnectionConfig&lt;T&gt;::type;  </span><br><span class="line"></span><br><span class="line"><span class="comment">/*-----------------------æ³›å‹è¿æ¥æ± æ¨¡æ¿ç±»éƒ¨åˆ†ä»£ç -----------------*/</span></span><br><span class="line"><span class="comment">// always_false æ¨¡æ¿ï¼Œç”¨äºä¾èµ–å¼ static_assert</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> U&gt;</span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">constexpr</span> <span class="type">bool</span> always_false = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TemplateConnectionPool</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">using</span> ConnectionPtr=std::unique_ptr&lt;T&gt;;</span><br><span class="line">    <span class="keyword">using</span> Config=Config_t&lt;T&gt;;</span><br><span class="line">    <span class="keyword">using</span> ConfigPtr=std::shared_ptr&lt;<span class="type">const</span> Config&gt;;    </span><br><span class="line">    <span class="keyword">using</span> CreateFunc=std::function&lt;<span class="built_in">ConnectionPtr</span>(<span class="type">const</span> Config&amp;)&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">TemplateConnectionPool</span>(std::shared_ptr&lt;GlobalConfig&gt; global_config,CreateFunc func)</span><br><span class="line">    :<span class="built_in">createConnFunc_</span>(std::<span class="built_in">move</span>(func))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!global_config)&#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">invalid_argument</span>(<span class="string">&quot;config is nullptr&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">ExtractSubConfig</span>(global_config); <span class="comment">// æå–å­é…ç½®</span></span><br><span class="line">        <span class="built_in">InitPool</span>();    <span class="comment">//åˆå§‹åŒ–è¿æ¥æ± </span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// æå–å­é…ç½®ï¼ˆå°è£…åˆ†æ”¯é€»è¾‘ï¼Œä¾¿äºåç»­æ‰©å±•ï¼‰</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">ExtractSubConfig</span><span class="params">(<span class="type">const</span> std::shared_ptr&lt;GlobalConfig&gt;global_config)</span></span>&#123;</span><br><span class="line">        <span class="comment">// ç¼–è¯‘æœŸåˆ¤æ–­ï¼šå¦‚æœæ˜¯MySQLè¿æ¥ç±»å‹ï¼Œæå–mysqlå­é…ç½®</span></span><br><span class="line">        <span class="function"><span class="keyword">if</span> <span class="title">constexpr</span><span class="params">(std::is_same_v&lt;T,MySQLConnection&gt;)</span></span>&#123;</span><br><span class="line">            config_=std::<span class="built_in">make_shared</span>&lt;<span class="type">const</span> Config&gt;(global_config-&gt;mysql);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç¼–è¯‘æœŸåˆ¤æ–­ï¼šå¦‚æœæ˜¯Redisè¿æ¥ç±»å‹ï¼Œæå–rediså­é…ç½®</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> <span class="built_in">constexpr</span>(std::is_same_v&lt;T,RedisConnection&gt;)&#123;</span><br><span class="line">            config_=std::<span class="built_in">make_shared</span>&lt;<span class="type">const</span> Config&gt;(global_config-&gt;redis);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç¼–è¯‘æœŸå…œåº•ï¼šéæ”¯æŒç±»å‹ç›´æ¥è§¦å‘ç¼–è¯‘é”™è¯¯</span></span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// ä¸åº”è¯¥åˆ°è¿™é‡Œï¼šè‹¥æ²¡æœ‰å¯¹åº”çš„ connection_config ç‰¹åŒ–ï¼Œä¸Šé¢çš„ using Config å·²ç»æŠ¥é”™äº†</span></span><br><span class="line">            <span class="built_in">static_assert</span>(always_false&lt;T&gt;, <span class="string">&quot;Unsupported connection type, no matching sub-config&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">InitPool</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//è·å–æ± å¤§å°</span></span><br><span class="line">        <span class="type">int</span> poolSize=config_-&gt;<span class="built_in">GetPoolSize</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;poolSize;++i)&#123;</span><br><span class="line">            <span class="comment">//å°†config_ä¼ å…¥â€œå›è°ƒå‡½æ•°â€åˆ›å»ºè¿æ¥</span></span><br><span class="line">            <span class="keyword">auto</span> conn=std::<span class="built_in">move</span>(<span class="built_in">createConnFunc_</span>(*config_));</span><br><span class="line">            <span class="keyword">if</span>(!conn)&#123;</span><br><span class="line">                <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to create connection&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            pool_.<span class="built_in">push_back</span>(std::<span class="built_in">move</span>(conn));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::deque&lt;ConnectionPtr&gt; pool_;	<span class="comment">//è¿æ¥æ± </span></span><br><span class="line">    ConfigPtr config_;					<span class="comment">//é…ç½®</span></span><br><span class="line">    <span class="comment">//åˆ›å»ºè¿æ¥å›è°ƒå‡½æ•°</span></span><br><span class="line">    CreateFunc createConnFunc_;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="2-è¡¥å……ï¼šâ€œåªå£°æ˜ä¸»æ¨¡æ¿-ä¸ç»™å‡ºå®šä¹‰-ç‰¹åŒ–â€">2.è¡¥å……ï¼šâ€œåªå£°æ˜ä¸»æ¨¡æ¿,ä¸ç»™å‡ºå®šä¹‰ + ç‰¹åŒ–â€</h2>
<h3 id="1-å£°æ˜è€Œä¸å®šä¹‰ï¼šä¸å®Œæ•´ç±»å‹ï¼ˆincomplete-typeï¼‰">(1)å£°æ˜è€Œä¸å®šä¹‰ï¼šä¸å®Œæ•´ç±»å‹ï¼ˆincomplete typeï¼‰</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span>&gt; </span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ConnectionConfig</span>;  <span class="comment">// è¿™é‡Œåªæœ‰å£°æ˜ï¼Œæ²¡æœ‰å®šä¹‰</span></span><br></pre></td></tr></table></figure>
<p>1.è¿™è¡Œä»£ç å‘Šè¯‰ç¼–è¯‘å™¨ â€œå­˜åœ¨ä¸€ä¸ªæ¨¡ç‰ˆ ConnectionConfig<T>â€ï¼Œä½†ä½ æ²¡æœ‰ç»™å®ƒä»»ä½•æˆå‘˜æˆ–å®šä¹‰ã€‚<br>
2.å› æ­¤ï¼Œå¯¹äºä»»æ„ Tï¼ŒConnectionConfig<T> éƒ½æ˜¯ä¸€ä¸ª ä¸å®Œæ•´ç±»å‹ï¼Œé™¤éåé¢æœ‰ç‰¹åŒ–ï¼ˆtemplate&lt;&gt; struct ConnectionConfig<Foo> { â€¦ };ï¼‰ç»™å‡ºå®Œæ•´å®šä¹‰ã€‚<br>
3.å¦‚æœç”¨ä¸ºæä¾›â€œç‰¹åŒ–â€çš„ç±»å‹è¿›è¡Œâ€œå®ä¾‹åŒ–â€â€”â€”&gt;â€œæŠ¥é”™â€</p>
<h3 id="2-å®Œå…¨ç‰¹åŒ–">(2)å®Œå…¨ç‰¹åŒ–</h3>
<p><strong>æ³¨ï¼šä¹Ÿå¯ä»¥é…åˆâ€œéƒ¨åˆ†ç‰¹åŒ–â€ï¼Œä½†æˆ‘æš‚æ—¶æœªé‡åˆ°&quot;éƒ¨åˆ†ç‰¹åŒ–&quot;ï¼Œè¿™é‡Œå°±ä¸æè¿°äº†</strong></p>
<h4 id="1-è¯­æ³•ï¼š">&lt;1&gt;è¯­æ³•ï¼š</h4>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸»æ¨¡æ¿ï¼ˆéœ€å…ˆå£°æ˜æˆ–å®šä¹‰ï¼‰</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="comment">//struct Foo &#123; /* primary template */ &#125;;    //å®šä¹‰</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Foo</span>;    <span class="comment">//å£°æ˜</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®Œå…¨ç‰¹åŒ–ï¼šç”¨ template&lt;&gt;ï¼Œå¹¶æŠŠæ‰€æœ‰å‚æ•°å…·ä½“åŒ–</span></span><br><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Foo</span>&lt;<span class="type">int</span>&gt; &#123; <span class="comment">/* specialization for int */</span> &#125;;</span><br></pre></td></tr></table></figure>
<h4 id="2-è¯­æ³•è¦ç‚¹">&lt;2&gt;è¯­æ³•è¦ç‚¹</h4>
<ul>
<li><strong>å¿…é¡»å†™template&lt;&gt;ï¼ˆç©ºæ¨¡æ¿å‚æ•°è¡¨ï¼‰ï¼Œç„¶åç»™å‡ºå…·ä½“å‚æ•°ã€‚</strong></li>
<li><strong>ç‰¹åŒ–ä½“å¯ä»¥ä¸ä¸»æ¨¡æ¿å®Œå…¨ä¸åŒï¼ˆæˆå‘˜å/è¡Œä¸ºå¯ä¸åŒï¼‰ã€‚</strong></li>
<li>å®Œå…¨ç‰¹åŒ–æ˜¯å¯¹æŸä¸€å…·ä½“ç±»å‹çš„æ›¿ä»£å®šä¹‰ï¼ˆä¸æ˜¯é‡è½½ï¼‰ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>C++</category>
        <category>å¼€å‘ç¬”è®°</category>
        <category>æ³›å‹æ¨¡æ¿ç¼–ç¨‹</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>sysctl ä¸ systemctl</title>
    <url>/2026/01/13/Linux/Linux%E7%B3%BB%E7%BB%9F%E5%B7%A5%E5%85%B7/sysctl%E4%B8%8Esystemctl/</url>
    <content><![CDATA[<h1>1.sysctl ä¸ systemctl</h1>
<p>sysctl å’Œ systemctl æ˜¯ Linux ç³»ç»Ÿä¸­åŠŸèƒ½å®Œå…¨ä¸åŒçš„ä¸¤ä¸ªå·¥å…·ï¼Œæ ¸å¿ƒåŒºåˆ«åœ¨äº<strong>ç®¡ç†å¯¹è±¡</strong>å’Œ<strong>ä½œç”¨åœºæ™¯</strong><br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260113105938893.png" alt=""></p>
<p><strong>ä½œç”¨å±‚é¢</strong>ï¼š</p>
<ul>
<li>sysctl ä½œç”¨äº <strong>å†…æ ¸å±‚</strong>ï¼š
<ul>
<li>ä¿®æ”¹çš„æ˜¯å†…æ ¸è¿è¡Œæ—¶çš„å‚æ•°ï¼Œå½±å“æ•´ä¸ªç³»ç»Ÿçš„åº•å±‚è¡Œä¸ºï¼ˆæ¯”å¦‚ç½‘ç»œåè®®æ ˆã€å†…å­˜ç®¡ç†ï¼‰ã€‚</li>
</ul>
</li>
<li>systemctl ä½œç”¨äº <strong>ç”¨æˆ·å±‚/æœåŠ¡å±‚</strong>ï¼š
<ul>
<li>ç®¡ç†çš„æ˜¯ç”¨æˆ·æ€çš„æœåŠ¡è¿›ç¨‹ï¼Œä¸æ¶‰åŠå†…æ ¸å‚æ•°çš„è°ƒæ•´ã€‚</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Linuxç³»ç»Ÿå·¥å…·</category>
        <category>sysctl ä¸ systemctl</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>sqlpp11çš„å®‰è£…</title>
    <url>/2026/01/12/C++/C++%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E5%B8%B8%E7%94%A8%E5%BA%93/sqlpp11-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h1>æè¦ï¼ˆè¯·çœ‹å®Œå†å†³å®šæ˜¯å¦ç»§ç»­çœ‹ï¼‰</h1>
<ol>
<li>å®‰è£…æ—¶é—´ï¼š 2026å¹´1æœˆ12æ—¥ ï¼ˆæ³¨æ„ï¼šå¦‚æœä½ å®‰è£…æ—¶é—´è¾ƒæ™šï¼Œä¸‹è¿°æ–¹æ³•å¯èƒ½å·²ä¸å†é€‚ç”¨ï¼‰</li>
<li>å®‰è£…åç‰ˆæœ¬ï¼š 0.65 + 11 commitsï¼ˆç›¸è¾ƒäº0.65 æœ‰11 ä¸ªé¢å¤–çš„ commit ï¼‰â€”â€”&gt;ï¼ˆå¯åˆ‡æ¢ä¸º0.65ï¼‰</li>
</ol>
<ul>
<li><strong>æ³¨</strong>ï¼šä¹Ÿè®¸ä½ å®‰è£…åå¹¶ä¸æ˜¯è¿™ä¸ªç‰ˆæœ¬ï¼Œå·²ç»å‡çº§</li>
</ul>
<ol start="3">
<li><strong>æ³¨æ„</strong>ï¼šä¹Ÿè®¸ç”±äºç‰ˆæœ¬ä¸åŒç­‰é—®é¢˜ï¼Œå®‰è£…åè¿›è¡Œçš„â€œæµ‹è¯•ä»£ç â€ä¸å†é€‚ç”¨ï¼Œè¯­æ³•å¯èƒ½ä¹Ÿä¸å†é€‚ç”¨ï¼Œè¯·è‡ªå·±æ–Ÿé…Œï¼</li>
</ol>
<h2 id="ä¸ªäººæŠ±æ€¨">ä¸ªäººæŠ±æ€¨</h2>
<h5 id="1-åœ¨ç½‘ä¸Šæ²¡æ‰¾åˆ°å¾ˆå®Œæ•´çš„æ•™ç¨‹ï¼Œä¸­é—´å°è¯•äº†ä¸åŒçš„å®‰è£…æ–¹å¼ï¼ˆvcpkgç­‰ï¼‰ï¼Œä¸åŒå®‰è£…ç‰ˆæœ¬ï¼Œæ€»æ˜¯å‡ºé—®é¢˜ï¼Œå®‰è£…éƒ½èŠ±äº†ä¸€å¤©ï¼ˆä¹Ÿè®¸æ˜¯æˆ‘ä¸ªäººèƒ½åŠ›å¤ªä½ğŸ˜ï¼‰ï¼ŒçœŸçš„å¾ˆæ— å¥ˆã€‚">1.åœ¨ç½‘ä¸Šæ²¡æ‰¾åˆ°å¾ˆå®Œæ•´çš„æ•™ç¨‹ï¼Œä¸­é—´å°è¯•äº†ä¸åŒçš„å®‰è£…æ–¹å¼ï¼ˆvcpkgç­‰ï¼‰ï¼Œä¸åŒå®‰è£…ç‰ˆæœ¬ï¼Œæ€»æ˜¯å‡ºé—®é¢˜ï¼Œå®‰è£…éƒ½èŠ±äº†ä¸€å¤©ï¼ˆä¹Ÿè®¸æ˜¯æˆ‘ä¸ªäººèƒ½åŠ›å¤ªä½ğŸ˜ï¼‰ï¼ŒçœŸçš„å¾ˆæ— å¥ˆã€‚</h5>
<h5 id="2-å¦‚æœåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä½ é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·å¯»æ‰¾å…¶å®ƒå‚è€ƒæ•™ç¨‹ä»¥åŠAIçš„å¸®åŠ©">2.å¦‚æœåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä½ é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·å¯»æ‰¾å…¶å®ƒå‚è€ƒæ•™ç¨‹ä»¥åŠAIçš„å¸®åŠ©</h5>
<h1>ä¸€ã€sqlpp11ä»‹ç»ä¸ç¯å¢ƒæ­å»º</h1>
<h2 id="1-sqlpp11ä»‹ç»">1.sqlpp11ä»‹ç»</h2>
<ul>
<li>SQLPP11æ˜¯ä¸€æ¬¾åŸºäºC++11åŠä»¥ä¸Šæ ‡å‡†çš„ç±»å‹å®‰å…¨åµŒå…¥å¼SQLåº“ï¼Œæ ¸å¿ƒä»·å€¼åœ¨äºè®©å¼€å‘è€…ç”¨åŸç”ŸC++è¯­æ³•ç¼–å†™SQLè¯­å¥ï¼Œé€šè¿‡ç¼–è¯‘æœŸæ£€æŸ¥è§„é¿è¯­æ³•é”™è¯¯ã€ç±»å‹ä¸åŒ¹é…åŠSQLæ³¨å…¥é£é™©</li>
<li>å…¼å®¹MySQLã€SQLiteã€PostgreSQLç­‰ä¸»æµæ•°æ®åº“ï¼Œé›¶è¿è¡Œæ—¶å¼€é”€ä¸”ç¬¦åˆC++å¼€å‘ä¹ æƒ¯</li>
</ul>
<p><strong>æ ¸å¿ƒä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šç¼–è¯‘æœŸæ ¡éªŒSQLè¯­æ³•ã€å­—æ®µç±»å‹åŒ¹é…æ€§ï¼ˆå¦‚intå­—æ®µèµ‹å€¼å­—ç¬¦ä¸²ç›´æ¥ç¼–è¯‘å¤±è´¥ï¼‰ï¼›</li>
<li><strong>åŸç”ŸC++é›†æˆ</strong>ï¼šæ”¯æŒç§»åŠ¨è¯­ä¹‰ã€lambdaã€ç±»å‹æ¨å¯¼ç­‰C++11+ç‰¹æ€§ï¼Œæ— éœ€æ‰‹å†™SQLå­—ç¬¦ä¸²ï¼›</li>
<li><strong>å¤šåº“å…¼å®¹</strong>ï¼šé€šè¿‡é€‚é…å±‚å¯¹æ¥ä¸»æµæ•°æ®åº“ï¼Œæ ¸å¿ƒä»£ç æ— éœ€ä¿®æ”¹å³å¯åˆ‡æ¢æ•°æ®åº“ï¼›</li>
<li><strong>è½»é‡é«˜æ•ˆ</strong>ï¼šæ¨¡æ¿å…ƒç¼–ç¨‹å®ç°æ ¸å¿ƒé€»è¾‘ï¼Œç¼–è¯‘æœŸå®Œæˆå¤§éƒ¨åˆ†è®¡ç®—ï¼Œæ— é¢å¤–è¿è¡Œæ—¶å¼€é”€ã€‚</li>
</ul>
<h2 id="2-å®‰è£…æ•™ç¨‹ï¼ˆLinuxï¼Œsqlpp11-mysqlä¸ºä¾‹ï¼‰">2.å®‰è£…æ•™ç¨‹ï¼ˆLinuxï¼Œsqlpp11+mysqlä¸ºä¾‹ï¼‰</h2>
<p><strong>æ³¨</strong>ï¼šå¦‚æœä½ åœ¨ä¸‹é¢ä»»ä½•æ­¥éª¤å‡ºç°é—®é¢˜æ— æ³•è§£å†³ä¸”ä¸æƒ³ç»§ç»­ï¼Œå¯ä»¥æŸ¥çœ‹<a href="#clean">å¸è½½/æ¸…ç†æ•™ç¨‹</a>è¿›è¡Œæ¸…é™¤</p>
<p><strong>ä»¥ä¸‹åº“éƒ½æ”¾ç½®åœ¨ â€œ~/thirdpartyâ€ ç›®å½•ä¸‹</strong></p>
<h3 id="ï¼ˆ1ï¼‰ç³»ç»Ÿä¾èµ–">ï¼ˆ1ï¼‰ç³»ç»Ÿä¾èµ–</h3>
<p>ç¡®ä¿ä½ å·²ç»å®‰è£…äº†ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">g++ (&gt;= 5.0) æˆ– clang++</span><br><span class="line">cmake (&gt;= 3.10)</span><br><span class="line">git</span><br><span class="line">make</span><br><span class="line">libmysqlclient-dev   # MySQL C API åº“å¤´æ–‡ä»¶å’Œé“¾æ¥åº“</span><br></pre></td></tr></table></figure>
<p>ä»¥Ubuntuä¸ºä¾‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install g++ cmake git make libmysqlclient-dev</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰å®‰è£…sqlpp11">ï¼ˆ2ï¼‰å®‰è£…sqlpp11</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/thirdparty</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…‹éš† sqlpp11</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/rbock/sqlpp11.git</span><br><span class="line"><span class="built_in">cd</span> sqlpp11</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ„å»ºç›®å½•</span></span><br><span class="line"><span class="built_in">mkdir</span> build &amp;&amp; <span class="built_in">cd</span> build</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„ CMake é€‰é¡¹ï¼ˆ-L åˆ—å‡ºç¼“å­˜å˜é‡ï¼‰</span></span><br><span class="line"><span class="comment"># grep -i mysql è¿‡æ»¤å‡ºä¸ MySQL ç›¸å…³çš„é€‰é¡¹</span></span><br><span class="line"><span class="comment"># ç›®çš„ï¼šç¡®è®¤å¯ç”¨ MySQL connector çš„é€‰é¡¹åç§°ï¼ˆä¸åŒç‰ˆæœ¬å¯èƒ½ä¸åŒï¼‰</span></span><br><span class="line">cmake .. -L | grep -i mysql </span><br><span class="line"><span class="comment"># é¢„æœŸè¾“å‡ºç±»ä¼¼ï¼šBUILD_MYSQL_CONNECTOR:BOOL=OFF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸…ç©ºæ„å»ºç›®å½•ï¼Œå‡†å¤‡æ­£å¼ç¼–è¯‘</span></span><br><span class="line"><span class="built_in">rm</span> -rf *</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­£å¼ç¼–è¯‘</span></span><br><span class="line"><span class="comment"># -DBUILD_MYSQL_CONNECTOR=ON  : å¯ç”¨ MySQL connectorï¼ˆä¸Šä¸€æ­¥æŸ¥åˆ°çš„é€‰é¡¹ï¼‰</span></span><br><span class="line"><span class="comment"># -DCMAKE_INSTALL_PREFIX=/usr/local : æŒ‡å®šå®‰è£…è·¯å¾„</span></span><br><span class="line">cmake .. \</span><br><span class="line">  -DBUILD_MYSQL_CONNECTOR=ON \</span><br><span class="line">  -DCMAKE_INSTALL_PREFIX=/usr/local</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¹¶è¡Œç¼–è¯‘ï¼ˆ-j$(nproc) ä½¿ç”¨æ‰€æœ‰ CPU æ ¸å¿ƒåŠ é€Ÿï¼‰</span></span><br><span class="line">make -j$(<span class="built_in">nproc</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…åˆ°ç³»ç»Ÿç›®å½•ï¼ˆéœ€è¦ sudo æƒé™ï¼‰</span></span><br><span class="line"><span class="built_in">sudo</span> make install</span><br></pre></td></tr></table></figure>
<p><strong>å¦‚æœè¿æ¥githubå¤±è´¥ï¼Œä¸”ä½ çš„å®¿ä¸»æœºä¸Šæœ‰VPNï¼Œå¯ä»¥çœ‹æˆ‘å¦ä¸€ç¯‡ç¬”è®°<a href="/categories/Linux/Linux%E7%9A%84%E4%BD%BF%E7%94%A8/Linux%E8%AE%BE%E7%BD%AEVPN%E4%BB%A3%E7%90%86%EF%BC%88%E8%A7%A3%E5%86%B3github%E8%BF%9E%E6%8E%A5%E9%97%AE%E9%A2%98%EF%BC%89/">Linuxè®¾ç½®VPNä»£ç†ï¼ˆè§£å†³githubè¿æ¥é—®é¢˜ï¼‰</a></strong></p>
<h3 id="ï¼ˆ3ï¼‰æµ‹è¯•-sqlpp11-MySQL-è¿æ¥">ï¼ˆ3ï¼‰æµ‹è¯• sqlpp11 MySQL è¿æ¥</h3>
<p><strong>ä¸ªäººè®¤ä¸ºè¿˜æ˜¯é€šè¿‡â€œä»£ç æµ‹è¯•â€æ¯”è¾ƒé è°±ï¼Œæ¯•ç«Ÿèƒ½ç”¨æ‰æ˜¯â€œç›®æ ‡â€</strong></p>
<h4 id="1-åˆ›å»ºæµ‹è¯•é¡¹ç›®">&lt;1&gt;åˆ›å»ºæµ‹è¯•é¡¹ç›®</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p ~/test_sqlpp11</span><br><span class="line"><span class="built_in">cd</span> ~/test_sqlpp11</span><br></pre></td></tr></table></figure>
<p><strong>main.cpp</strong>ï¼š</p>
<ul>
<li><strong>æ³¨æ„</strong>ï¼š
<ul>
<li>mysqlè¿æ¥é…ç½®æ¢æˆä½ è‡ªå·±çš„ï¼ï¼</li>
<li>testæ•°æ®åº“éœ€è¦å…ˆåˆ›å»ºï¼Œæˆ–æ¢ä¸ºä½ å·²æœ‰çš„æ•°æ®åº“</li>
</ul>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sqlpp11/mysql/mysql.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        sqlpp::mysql::<span class="built_in">global_library_init</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨ shared_ptr</span></span><br><span class="line">        <span class="keyword">auto</span> config = std::<span class="built_in">make_shared</span>&lt;sqlpp::mysql::connection_config&gt;();</span><br><span class="line">        config-&gt;host = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">        config-&gt;port = <span class="number">3306</span>;</span><br><span class="line">        config-&gt;user = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">        config-&gt;password = <span class="string">&quot;password&quot;</span>;</span><br><span class="line">        config-&gt;database = <span class="string">&quot;test&quot;</span>;</span><br><span class="line">        config-&gt;debug = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç›´æ¥ä¼  shared_ptr</span></span><br><span class="line">        sqlpp::mysql::connection db&#123;config&#125;;</span><br><span class="line"></span><br><span class="line">        db.<span class="built_in">execute</span>(<span class="string">&quot;SELECT 1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;âœ… è¿æ¥æˆåŠŸï¼&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">catch</span> (<span class="type">const</span> std::exception&amp; e)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;âŒ å¤±è´¥: &quot;</span> &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>CMakeLists.txt</strong></p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.14</span>)</span><br><span class="line"><span class="keyword">project</span>(test_sqlpp11)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">17</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨ pkg-config æ‰¾ MySQL</span></span><br><span class="line"><span class="keyword">find_package</span>(PkgConfig REQUIRED)</span><br><span class="line">pkg_check_modules(MYSQL REQUIRED IMPORTED_TARGET mysqlclient)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»º MySQL::MySQL aliasï¼ˆsqlpp11 éœ€è¦è¿™ä¸ªåå­—ï¼‰</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">NOT</span> <span class="keyword">TARGET</span> MySQL::MySQL)</span><br><span class="line">    <span class="keyword">add_library</span>(MySQL::MySQL ALIAS PkgConfig::MYSQL)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">find_package</span>(Sqlpp11 REQUIRED)</span><br><span class="line"><span class="keyword">find_package</span>(Threads REQUIRED)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span>(test_mysql main.cpp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_link_libraries</span>(test_mysql </span><br><span class="line">    PRIVATE </span><br><span class="line">    sqlpp11::sqlpp11</span><br><span class="line">    sqlpp11::mysql</span><br><span class="line">    Threads::Threads</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="2-ç¼–è¯‘è¿è¡Œï¼š">&lt;2&gt;ç¼–è¯‘è¿è¡Œï¼š</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/test_sqlpp11</span><br><span class="line"><span class="built_in">mkdir</span> build &amp;&amp; <span class="built_in">cd</span> build</span><br><span class="line"></span><br><span class="line">cmake .. -DCMAKE_PREFIX_PATH=/usr/local</span><br><span class="line">make</span><br><span class="line"></span><br><span class="line">./test_mysql</span><br></pre></td></tr></table></figure>
<h4 id="3-æŸ¥çœ‹å®‰è£…ç‰ˆæœ¬çš„æ–¹æ³•">&lt;3&gt;æŸ¥çœ‹å®‰è£…ç‰ˆæœ¬çš„æ–¹æ³•</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/thirdparty/sqlpp11</span><br><span class="line">git describe --tags --always</span><br><span class="line"><span class="comment"># è¾“å‡ºç±»ä¼¼: 0.65-11-gabcdef ï¼ˆ0.65 ç‰ˆæœ¬ + 11 ä¸ª commitï¼‰</span></span><br></pre></td></tr></table></figure>
<h2 id="3-å¸è½½-æ¸…ç†æ•™ç¨‹-a-id-clean-a">3.å¸è½½/æ¸…ç†æ•™ç¨‹ <a id="clean"></a></h2>
<h5 id="å¦‚æœä½ åœ¨ä¸Šé¢æ­¥éª¤ä¸­å‡ºç°ä»»ä½•é—®é¢˜ï¼Œä¸æƒ³ç»§ç»­ï¼Œå¯æŒ‰ä¸‹é¢æ–¹å¼è¿›è¡Œæ¸…é™¤">å¦‚æœä½ åœ¨ä¸Šé¢æ­¥éª¤ä¸­å‡ºç°ä»»ä½•é—®é¢˜ï¼Œä¸æƒ³ç»§ç»­ï¼Œå¯æŒ‰ä¸‹é¢æ–¹å¼è¿›è¡Œæ¸…é™¤</h5>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ==========================================</span></span><br><span class="line"><span class="comment"># sqlpp11 å®Œæ•´å¸è½½è„šæœ¬</span></span><br><span class="line"><span class="comment"># ==========================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. å°è¯•å®˜æ–¹å¸è½½ï¼ˆå¦‚æœ build ç›®å½•è¿˜åœ¨ï¼‰</span></span><br><span class="line"><span class="built_in">cd</span> ~/thirdparty/sqlpp11/build 2&gt;/dev/null &amp;&amp; <span class="built_in">sudo</span> make uninstall</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. åˆ é™¤å¤´æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /usr/local/include/sqlpp11</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. åˆ é™¤ cmake é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /usr/local/lib/cmake/Sqlpp11</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /usr/local/lib/cmake/sqlpp11</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /usr/local/share/sqlpp11</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. åˆ é™¤åº“æ–‡ä»¶ï¼ˆå¦‚æœæœ‰ç¼–è¯‘å‡º .a æˆ– .soï¼‰</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -f /usr/local/lib/libsqlpp11*</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -f /usr/local/lib/libsqlpp-mysql*</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. åˆ é™¤ pkg-config æ–‡ä»¶ï¼ˆå¦‚æœæœ‰ï¼‰</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -f /usr/local/lib/pkgconfig/sqlpp11*.pc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. åˆ é™¤å¯èƒ½å®‰è£…åˆ° /usr çš„æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /usr/include/sqlpp11</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /usr/lib/cmake/Sqlpp11</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /usr/lib/cmake/sqlpp11</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7. åˆ é™¤æºç ç›®å½•</span></span><br><span class="line"><span class="built_in">rm</span> -rf ~/thirdparty/sqlpp11</span><br><span class="line"></span><br><span class="line"><span class="comment"># 8. æ›´æ–°é“¾æ¥å™¨ç¼“å­˜</span></span><br><span class="line"><span class="built_in">sudo</span> ldconfig</span><br><span class="line"></span><br><span class="line"><span class="comment"># 9. éªŒè¯æ˜¯å¦æ¸…ç†å¹²å‡€</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== æ£€æŸ¥æ®‹ç•™æ–‡ä»¶ ===&quot;</span></span><br><span class="line">find /usr/local -name <span class="string">&quot;*sqlpp*&quot;</span> 2&gt;/dev/null</span><br><span class="line">find /usr -name <span class="string">&quot;*sqlpp*&quot;</span> 2&gt;/dev/null</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>C++</category>
        <category>C++åç«¯å¼€å‘åº“</category>
        <category>sqlpp11ï¼ˆå·²ä¸å‡†å¤‡ä½¿ç”¨ï¼‰</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxè®¾ç½®VPNä»£ç†ï¼ˆè§£å†³githubè¿æ¥é—®é¢˜ï¼‰</title>
    <url>/2026/01/12/Linux/Linux%E7%9A%84%E4%BD%BF%E7%94%A8/Linux%E8%AE%BE%E7%BD%AEVPN%E4%BB%A3%E7%90%86%EF%BC%88%E8%A7%A3%E5%86%B3github%E8%BF%9E%E6%8E%A5%E9%97%AE%E9%A2%98%EF%BC%89/</url>
    <content><![CDATA[<h2 id="1-å‰æè¦æ±‚ï¼šå®¿ä¸»æœºä¸Šéœ€è¦æœ‰VPN">1.å‰æè¦æ±‚ï¼šå®¿ä¸»æœºä¸Šéœ€è¦æœ‰VPN</h2>
<h2 id="2-è®¾ç½®ä¸´æ—¶ä»£ç†æ­¥éª¤">2.è®¾ç½®ä¸´æ—¶ä»£ç†æ­¥éª¤</h2>
<h4 id="ï¼ˆ1ï¼‰ï¼ˆè™šæ‹Ÿæœºï¼‰é€šè¿‡-ifconfig-å‘½ä»¤æŸ¥çœ‹è™šæ‹Ÿæœºçš„IPï¼Œç¡®å®šå±€åŸŸç½‘ç½‘å…³ï¼Œå¦‚ä¸‹ï¼š">ï¼ˆ1ï¼‰ï¼ˆè™šæ‹Ÿæœºï¼‰é€šè¿‡ ifconfig å‘½ä»¤æŸ¥çœ‹è™šæ‹Ÿæœºçš„IPï¼Œç¡®å®šå±€åŸŸç½‘ç½‘å…³ï¼Œå¦‚ä¸‹ï¼š</h4>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260112165452726.png" alt=""></p>
<ul>
<li><strong>ç½‘å…³ä¸ºï¼š192.168.36.1 ï¼ˆå³â€œæœ€åä¸€ä½â€ä¸º 1ï¼‰</strong></li>
</ul>
<h4 id="ï¼ˆ2ï¼‰ï¼ˆå®¿ä¸»æœºï¼‰æ‰“å¼€VPNè¿æ¥ï¼Œå¹¶å¼€å¯â€œå…è®¸å±€åŸŸç½‘è¿æ¥â€ï¼Œå¦‚ä¸‹ï¼š">ï¼ˆ2ï¼‰ï¼ˆå®¿ä¸»æœºï¼‰æ‰“å¼€VPNè¿æ¥ï¼Œå¹¶å¼€å¯â€œå…è®¸å±€åŸŸç½‘è¿æ¥â€ï¼Œå¦‚ä¸‹ï¼š</h4>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260112165739343.png" alt=""></p>
<h4 id="ï¼ˆ3ï¼‰ï¼ˆè™šæ‹Ÿæœºï¼‰è®¾ç½®â€œä¸´æ—¶ä»£ç†â€ï¼Œå¹¶è¿›è¡Œæµ‹è¯•ï¼Œå¦‚ä¸‹ï¼š">ï¼ˆ3ï¼‰ï¼ˆè™šæ‹Ÿæœºï¼‰è®¾ç½®â€œä¸´æ—¶ä»£ç†â€ï¼Œå¹¶è¿›è¡Œæµ‹è¯•ï¼Œå¦‚ä¸‹ï¼š</h4>
<ul>
<li>ä»¥ä¸Šé¢æˆ‘çš„ç½‘å…³ 192.168.36.1ä¸ºä¾‹</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å‡è®¾ä»£ç†ç«¯å£æ˜¯ 7890ï¼ˆé€šå¸¸éƒ½æ˜¯ï¼‰</span></span><br><span class="line"><span class="built_in">export</span> http_proxy=http://192.168.36.1:7890</span><br><span class="line"><span class="built_in">export</span> https_proxy=http://192.168.36.1:7890</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•</span></span><br><span class="line">curl -I https://github.com</span><br></pre></td></tr></table></figure>
<p><strong>è¡¥å……</strong>ï¼šClash for Windows æŸ¥çœ‹ä»£ç†ç«¯å£<br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260112170039920.png" alt=""></p>
<h3 id="3-å¤‡é€‰æ–¹æ¡ˆ">3.å¤‡é€‰æ–¹æ¡ˆ</h3>
<p>å¦‚æœé…ç½®åè¿˜æ˜¯ä¸è¡Œï¼Œå¯ä»¥ï¼š<strong>ä½¿ç”¨SSH å…‹éš†ï¼ˆç»•è¿‡ HTTPSï¼‰</strong></p>
<ul>
<li>éœ€è¦å…ˆé…ç½® SSH key</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/HowardHinnant/date.git <span class="comment"># å¤±è´¥</span></span><br><span class="line"></span><br><span class="line">git <span class="built_in">clone</span> git@github.com:HowardHinnant/date.git <span class="comment"># æˆåŠŸ</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Linux</category>
        <category>Linuxçš„ä½¿ç”¨</category>
        <category>Linuxè®¾ç½®VPNä»£ç†ï¼ˆè§£å†³githubè¿æ¥é—®é¢˜ï¼‰</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>TCP KeepAlive å¿ƒè·³æœºåˆ¶</title>
    <url>/2026/01/13/Linux/TCP_IP%E7%9B%B8%E5%85%B3/TCP%20KeepAlive%20%E5%BF%83%E8%B7%B3%E6%9C%BA%E5%88%B6/</url>
    <content><![CDATA[<h2 id="1-æœºåˆ¶åŸç†">1.æœºåˆ¶åŸç†</h2>
<p>TCP KeepAlive æ˜¯ <strong>æ“ä½œç³»ç»Ÿå†…æ ¸å±‚é¢</strong> çš„è¿æ¥ä¿æ´»æœºåˆ¶ï¼Œç”¨äºæ£€æµ‹é•¿æ—¶é—´ç©ºé—²çš„ TCP è¿æ¥æ˜¯å¦ä»ç„¶æœ‰æ•ˆã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚                    TCP KeepAlive å·¥ä½œåŸç†                        â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚                                                                 â”‚</span><br><span class="line">â”‚   è¿æ¥ç©ºé—²                 å¼€å§‹æ¢æµ‹                 åˆ¤å®šç»“æœ      â”‚</span><br><span class="line">â”‚      â”‚                       â”‚                       â”‚          â”‚</span><br><span class="line">â”‚      â–¼                       â–¼                       â–¼          â”‚</span><br><span class="line">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”    è¶…æ—¶å    â”Œâ”€â”€â”€â”€â”€â”€â”€â”   è¿ç»­å¤±è´¥    â”Œâ”€â”€â”€â”€â”€â”€â”€â”       â”‚</span><br><span class="line">â”‚  â”‚ IDLE  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ PROBE â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ DEAD  â”‚       â”‚</span><br><span class="line">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚</span><br><span class="line">â”‚      â”‚                     â”‚                                   â”‚</span><br><span class="line">â”‚      â”‚                     â”‚ æ”¶åˆ° ACK                          â”‚</span><br><span class="line">â”‚      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚</span><br><span class="line">â”‚   é‡ç½®è®¡æ—¶å™¨                                                    â”‚</span><br><span class="line">â”‚                                                                 â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>æ—¶é—´çº¿è¯¦è§£</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ—¶é—´è½´ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–¶</span><br><span class="line"></span><br><span class="line">[æœ€åä¸€æ¬¡æ•°æ®äº¤äº’]</span><br><span class="line">        â”‚</span><br><span class="line">        â”‚â—€â•â•â•â•â•â•â•â•â•â• tcp_keepalive_time â•â•â•â•â•â•â•â•â•â•â–¶â”‚</span><br><span class="line">        â”‚                 7200 ç§’                   â”‚</span><br><span class="line">        â”‚              (è¿æ¥ç©ºé—²)                   â”‚</span><br><span class="line">        â”‚                                          â”‚</span><br><span class="line">        â”‚                                          â–¼</span><br><span class="line">        â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">        â”‚                                    â”‚ å‘é€æ¢æµ‹ â”‚</span><br><span class="line">        â”‚                                    â”‚  åŒ… #1   â”‚</span><br><span class="line">        â”‚                                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜</span><br><span class="line">        â”‚                                         â”‚</span><br><span class="line">        â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">        â”‚                         â–¼                               â–¼</span><br><span class="line">        â”‚                    æ”¶åˆ° ACK                         æ— å“åº”</span><br><span class="line">        â”‚                        â”‚                               â”‚</span><br><span class="line">        â”‚                        â–¼                               â–¼</span><br><span class="line">        â”‚               é‡ç½®è®¡æ—¶å™¨ï¼Œå›åˆ°                  ç­‰å¾… 75 ç§’</span><br><span class="line">        â”‚               ç©ºé—²ç­‰å¾…çŠ¶æ€                    (tcp_keepalive_intvl)</span><br><span class="line">        â”‚                                                        â”‚</span><br><span class="line">        â”‚                                                        â–¼</span><br><span class="line">        â”‚                                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">        â”‚                                                  â”‚ å‘é€æ¢æµ‹ â”‚</span><br><span class="line">        â”‚                                                  â”‚  åŒ… #2   â”‚</span><br><span class="line">        â”‚                                                  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜</span><br><span class="line">        â”‚                                                       â”‚</span><br><span class="line">        â”‚                                          ... é‡å¤æœ€å¤š 9 æ¬¡ ...</span><br><span class="line">        â”‚                                                       â”‚</span><br><span class="line">        â”‚                                                       â–¼</span><br><span class="line">        â”‚                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">        â”‚                                              â”‚ è¿ç»­ 9 æ¬¡æ— å“åº”  â”‚</span><br><span class="line">        â”‚                                              â”‚ åˆ¤å®šè¿æ¥æ­»äº¡     â”‚</span><br><span class="line">        â”‚                                              â”‚ å†…æ ¸å…³é—­ socket  â”‚</span><br><span class="line">        â”‚                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line"></span><br><span class="line">æ€»æ£€æµ‹æ—¶é—´ = 7200 + (75 Ã— 9) = 7875 ç§’ â‰ˆ 2å°æ—¶11åˆ†é’Ÿ</span><br></pre></td></tr></table></figure>
<h2 id="2-æ ¸å¿ƒå‚æ•°-ä¸-ç›¸å…³é…ç½®">2.æ ¸å¿ƒå‚æ•° ä¸ ç›¸å…³é…ç½®</h2>
<h3 id="ï¼ˆ1ï¼‰ä¸‰ä¸ªæ ¸å¿ƒå‚æ•°">ï¼ˆ1ï¼‰ä¸‰ä¸ªæ ¸å¿ƒå‚æ•°</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260113104040724.png" alt=""></p>
<h3 id="ï¼ˆ2ï¼‰æŸ¥çœ‹å½“å‰ç³»ç»Ÿå‚æ•°">ï¼ˆ2ï¼‰æŸ¥çœ‹å½“å‰ç³»ç»Ÿå‚æ•°</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰ç³»ç»Ÿå‚æ•°</span></span><br><span class="line">sysctl net.ipv4.tcp_keepalive_time</span><br><span class="line">sysctl net.ipv4.tcp_keepalive_intvl</span><br><span class="line">sysctl net.ipv4.tcp_keepalive_probes</span><br></pre></td></tr></table></figure>
<a href="/2026/01/13/Linux/Linux%E7%B3%BB%E7%BB%9F%E5%B7%A5%E5%85%B7/sysctl%E4%B8%8Esystemctl/" title="sysctl ä¸ systemctl">sysctlä»‹ç»</a>
<h3 id="ï¼ˆ3ï¼‰å‚æ•°é…ç½®ï¼ˆç³»ç»Ÿçº§ï¼‰">ï¼ˆ3ï¼‰å‚æ•°é…ç½®ï¼ˆç³»ç»Ÿçº§ï¼‰</h3>
<h4 id="1-ä¸´æ—¶ä¿®æ”¹ï¼ˆé‡å¯å¤±æ•ˆï¼‰">&lt;1&gt;ä¸´æ—¶ä¿®æ”¹ï¼ˆé‡å¯å¤±æ•ˆï¼‰</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 30ç§’ç©ºé—²åå¼€å§‹æ¢æµ‹</span></span><br><span class="line"><span class="built_in">sudo</span> sysctl -w net.ipv4.tcp_keepalive_time=30</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¯10ç§’æ¢æµ‹ä¸€æ¬¡</span></span><br><span class="line"><span class="built_in">sudo</span> sysctl -w net.ipv4.tcp_keepalive_intvl=10</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€å¤šæ¢æµ‹3æ¬¡</span></span><br><span class="line"><span class="built_in">sudo</span> sysctl -w net.ipv4.tcp_keepalive_probes=3</span><br><span class="line"></span><br><span class="line"><span class="comment"># éªŒè¯ä¿®æ”¹</span></span><br><span class="line">sysctl net.ipv4.tcp_keepalive_time</span><br><span class="line">sysctl net.ipv4.tcp_keepalive_intvl</span><br><span class="line">sysctl net.ipv4.tcp_keepalive_probes</span><br></pre></td></tr></table></figure>
<h4 id="2-æ°¸ä¹…ä¿®æ”¹">&lt;2&gt;æ°¸ä¹…ä¿®æ”¹</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¼–è¾‘é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">sudo</span> vim /etc/sysctl.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ ä»¥ä¸‹å†…å®¹</span></span><br><span class="line">net.ipv4.tcp_keepalive_time = 30</span><br><span class="line">net.ipv4.tcp_keepalive_intvl = 10</span><br><span class="line">net.ipv4.tcp_keepalive_probes = 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿é…ç½®ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="built_in">sudo</span> sysctl -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…ä½¿ç”¨å•è¡Œå‘½ä»¤</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;net.ipv4.tcp_keepalive_time = 30&quot;</span> | <span class="built_in">sudo</span> <span class="built_in">tee</span> -a /etc/sysctl.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;net.ipv4.tcp_keepalive_intvl = 10&quot;</span> | <span class="built_in">sudo</span> <span class="built_in">tee</span> -a /etc/sysctl.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;net.ipv4.tcp_keepalive_probes = 3&quot;</span> | <span class="built_in">sudo</span> <span class="built_in">tee</span> -a /etc/sysctl.conf</span><br><span class="line"><span class="built_in">sudo</span> sysctl -p</span><br></pre></td></tr></table></figure>
<h4 id="3-ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®">&lt;3&gt;ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># /etc/sysctl.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span></span><br><span class="line"><span class="comment"># TCP KeepAlive é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰</span></span><br><span class="line"><span class="comment"># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å†…ç½‘ç¨³å®šç¯å¢ƒ</span></span><br><span class="line">net.ipv4.tcp_keepalive_time = 60</span><br><span class="line">net.ipv4.tcp_keepalive_intvl = 10</span><br><span class="line">net.ipv4.tcp_keepalive_probes = 6</span><br><span class="line"><span class="comment"># æ€»æ£€æµ‹æ—¶é—´ = 60 + 10Ã—6 = 120ç§’</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·¨æœºæˆ¿/äº‘ç¯å¢ƒï¼ˆæ›´æ¿€è¿›ï¼‰</span></span><br><span class="line"><span class="comment"># net.ipv4.tcp_keepalive_time = 30</span></span><br><span class="line"><span class="comment"># net.ipv4.tcp_keepalive_intvl = 5</span></span><br><span class="line"><span class="comment"># net.ipv4.tcp_keepalive_probes = 3</span></span><br><span class="line"><span class="comment"># æ€»æ£€æµ‹æ—¶é—´ = 30 + 5Ã—3 = 45ç§’</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ4ï¼‰åº”ç”¨å±‚é…ç½®ï¼ˆSocket-ç¼–ç¨‹ï¼‰">ï¼ˆ4ï¼‰åº”ç”¨å±‚é…ç½®ï¼ˆSocket ç¼–ç¨‹ï¼‰</h3>
<p><strong>å°è£…ä¸ºå·¥å…·ç±»</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/tcp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdexcept&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TcpKeepAlive</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Config</span> &#123;</span><br><span class="line">        <span class="type">int</span> idle_seconds = <span class="number">30</span>;      <span class="comment">// ç©ºé—²å¤šä¹…åå¼€å§‹æ¢æµ‹</span></span><br><span class="line">        <span class="type">int</span> interval_seconds = <span class="number">10</span>;  <span class="comment">// æ¢æµ‹é—´éš”</span></span><br><span class="line">        <span class="type">int</span> max_probes = <span class="number">3</span>;         <span class="comment">// æœ€å¤§æ¢æµ‹æ¬¡æ•°</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">enable</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">const</span> Config&amp; cfg = &#123;&#125;)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">set_option</span>(sockfd, SOL_SOCKET, SO_KEEPALIVE, <span class="number">1</span>, <span class="string">&quot;SO_KEEPALIVE&quot;</span>);</span><br><span class="line">        <span class="built_in">set_option</span>(sockfd, IPPROTO_TCP, TCP_KEEPIDLE, cfg.idle_seconds, <span class="string">&quot;TCP_KEEPIDLE&quot;</span>);</span><br><span class="line">        <span class="built_in">set_option</span>(sockfd, IPPROTO_TCP, TCP_KEEPINTVL, cfg.interval_seconds, <span class="string">&quot;TCP_KEEPINTVL&quot;</span>);</span><br><span class="line">        <span class="built_in">set_option</span>(sockfd, IPPROTO_TCP, TCP_KEEPCNT, cfg.max_probes, <span class="string">&quot;TCP_KEEPCNT&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">disable</span><span class="params">(<span class="type">int</span> sockfd)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">set_option</span>(sockfd, SOL_SOCKET, SO_KEEPALIVE, <span class="number">0</span>, <span class="string">&quot;SO_KEEPALIVE&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> Config <span class="title">get_config</span><span class="params">(<span class="type">int</span> sockfd)</span> </span>&#123;</span><br><span class="line">        Config cfg;</span><br><span class="line">        cfg.idle_seconds = <span class="built_in">get_option</span>(sockfd, IPPROTO_TCP, TCP_KEEPIDLE);</span><br><span class="line">        cfg.interval_seconds = <span class="built_in">get_option</span>(sockfd, IPPROTO_TCP, TCP_KEEPINTVL);</span><br><span class="line">        cfg.max_probes = <span class="built_in">get_option</span>(sockfd, IPPROTO_TCP, TCP_KEEPCNT);</span><br><span class="line">        <span class="keyword">return</span> cfg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">bool</span> <span class="title">is_enabled</span><span class="params">(<span class="type">int</span> sockfd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">get_option</span>(sockfd, SOL_SOCKET, SO_KEEPALIVE) != <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">set_option</span><span class="params">(<span class="type">int</span> fd, <span class="type">int</span> level, <span class="type">int</span> optname, <span class="type">int</span> value, <span class="type">const</span> <span class="type">char</span>* name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">setsockopt</span>(fd, level, optname, &amp;value, <span class="built_in">sizeof</span>(value)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(std::<span class="built_in">string</span>(<span class="string">&quot;setsockopt &quot;</span>) + name + <span class="string">&quot; failed&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">get_option</span><span class="params">(<span class="type">int</span> fd, <span class="type">int</span> level, <span class="type">int</span> optname)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> value;</span><br><span class="line">        <span class="type">socklen_t</span> len = <span class="built_in">sizeof</span>(value);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">getsockopt</span>(fd, level, optname, &amp;value, &amp;len) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;getsockopt failed&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ5ï¼‰å¿«é€ŸéªŒè¯-KeepAlive-æ˜¯å¦ç”Ÿæ•ˆ">ï¼ˆ5ï¼‰å¿«é€ŸéªŒè¯ KeepAlive æ˜¯å¦ç”Ÿæ•ˆ</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æŸä¸ªè¿æ¥çš„ KeepAlive çŠ¶æ€</span></span><br><span class="line">ss -tno state established | grep &lt;ç›®æ ‡IP&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºä¸­ timer:(keepalive,...) è¡¨ç¤ºå·²å¯ç”¨</span></span><br></pre></td></tr></table></figure>
<h2 id="3-æ ¸å¿ƒä½œç”¨">3.æ ¸å¿ƒä½œç”¨</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260113102020940.png" alt=""></p>
<h3 id="ï¼ˆ1ï¼‰å„ä½œç”¨è§£æ">ï¼ˆ1ï¼‰å„ä½œç”¨è§£æ</h3>
<ul>
<li>â€œ<strong>Redis++çš„å¿ƒè·³æœºåˆ¶</strong>â€å°±æ˜¯ç›´æ¥ä½¿ç”¨â€œ<strong>Linux TCPçš„å¿ƒè·³æœºåˆ¶</strong>â€ï¼Œä¸‹é¢æˆ‘ä»¬ä»¥Redis++ä¸ºä½¿ç”¨åœºæ™¯è¿›è¡Œè®²è§£</li>
</ul>
<h4 id="1-æ£€æµ‹-åŠæ­»è¿æ¥-ï¼ˆæœ€æ ¸å¿ƒï¼‰">&lt;1&gt;æ£€æµ‹&quot;åŠæ­»è¿æ¥&quot;ï¼ˆæœ€æ ¸å¿ƒï¼‰</h4>
<p><strong>é—®é¢˜åœºæ™¯</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Redis æœåŠ¡å™¨å¼‚å¸¸ï¼ˆæ–­ç”µ/è¿›ç¨‹è¢«æ€/ç½‘çº¿æ–­å¼€ï¼‰</span><br><span class="line">         â†“</span><br><span class="line">å®¢æˆ·ç«¯æœªæ”¶åˆ° FIN/RST åŒ…ï¼Œè¯¯è®¤ä¸ºè¿æ¥å­˜æ´»</span><br><span class="line">         â†“</span><br><span class="line">å‘é€è¯·æ±‚ â†’ æ°¸ä¹…é˜»å¡/è¶…æ—¶ï¼Œä¸šåŠ¡å¼‚å¸¸</span><br></pre></td></tr></table></figure>
<p><strong>å¿ƒè·³è§£å†³é€»è¾‘</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å®šæœŸå‘æ¢æµ‹åŒ… â†’ å¯¹ç«¯æ— å“åº” â†’ åˆ¤å®šè¿æ¥æ­»äº¡ â†’ å…³é—­è¿æ¥ â†’ è§¦å‘é‡è¿</span><br></pre></td></tr></table></figure>
<h4 id="2-é˜²æ­¢ä¸­é—´è®¾å¤‡å…³é—­ç©ºé—²è¿æ¥">&lt;2&gt;é˜²æ­¢ä¸­é—´è®¾å¤‡å…³é—­ç©ºé—²è¿æ¥</h4>
<ul>
<li>ä¸­é—´è®¾å¤‡ï¼ˆå¦‚é˜²ç«å¢™ã€è´Ÿè½½å‡è¡¡å™¨ï¼‰çš„æ ¸å¿ƒèµ„æºæ˜¯**ã€Œè¿æ¥è¡¨é¡¹ã€**
<ul>
<li>æ¯ç»´æŠ¤ä¸€ä¸ª TCP è¿æ¥ï¼Œéƒ½éœ€è¦å ç”¨å†…å­˜å­˜å‚¨è¿æ¥å››å…ƒç»„ï¼ˆæº IPã€æºç«¯å£ã€ç›®çš„ IPã€ç›®çš„ç«¯å£ï¼‰ã€è¿æ¥çŠ¶æ€ï¼ˆESTABLISHED/CLOSED ç­‰ï¼‰ã€è¶…æ—¶è®¡æ—¶å™¨ç­‰ä¿¡æ¯ã€‚</li>
</ul>
</li>
<li>ä½†è®¾å¤‡çš„å†…å­˜ã€è¿æ¥è¡¨å®¹é‡æ˜¯<strong>æœ‰é™çš„</strong>ï¼ˆæ¯”å¦‚ä¸€å°æ™®é€šé˜²ç«å¢™å¯èƒ½ä»…æ”¯æŒæ•°ä¸‡åˆ°æ•°åä¸‡å¹¶å‘è¿æ¥ï¼‰
<ul>
<li>å¦‚æœé•¿æœŸä¿ç•™å¤§é‡ç©ºé—²è¿æ¥ï¼Œä¼šè€—å°½è¿æ¥è¡¨èµ„æºï¼Œå¯¼è‡´æ— æ³•æ¥æ”¶æ–°çš„æ­£å¸¸è¿æ¥ï¼Œç›´æ¥å½±å“ç½‘ç»œæœåŠ¡å¯ç”¨æ€§ã€‚</li>
</ul>
</li>
<li>å¯¹ä¸­é—´è®¾å¤‡è€Œè¨€ï¼Œã€Œç©ºé—²è¿æ¥ã€æ„å‘³ç€é•¿æ—¶é—´æ²¡æœ‰æ•°æ®äº¤äº’ï¼Œå±äº â€œä½ä»·å€¼â€ è¿æ¥ï¼Œä¿ç•™è¿™ç±»è¿æ¥çš„æ”¶ç›Šæä½ï¼›</li>
</ul>
<p><strong>é—®é¢˜åœºæ™¯</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å®¢æˆ·ç«¯ â†â”€â”€â†’ [é˜²ç«å¢™/NAT/äº‘è´Ÿè½½å‡è¡¡] â†â”€â”€â†’ Redis æœåŠ¡å™¨</span><br><span class="line">                    â”‚</span><br><span class="line">                    â”‚ ç©ºé—²è¶…é˜ˆå€¼ â†’ ç›´æ¥æ–­å¼€ï¼ˆä¸é€šçŸ¥ä¸¤ç«¯ï¼‰</span><br><span class="line">                    â†“</span><br><span class="line">å®¢æˆ·ç«¯ä¸‹æ¬¡è¯·æ±‚ â†’ è¿æ¥å¤±æ•ˆ â†’ æŠ¥é”™</span><br></pre></td></tr></table></figure>
<ul>
<li>å¸¸è§è®¾å¤‡ç©ºé—²è¶…æ—¶é˜ˆå€¼:
<ul>
<li><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260113102652571.png" alt=""></li>
</ul>
</li>
</ul>
<p><strong>å¿ƒè·³è§£å†³é€»è¾‘</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æŒ‰å°äºè¶…æ—¶é˜ˆå€¼çš„é¢‘ç‡å‘æ¢æµ‹åŒ…ï¼ˆå¦‚æ¯30ç§’ï¼‰â†’ ä¸­é—´è®¾å¤‡åˆ¤å®šè¿æ¥æ´»è·ƒ â†’ ä¸è¢«æ–­å¼€</span><br></pre></td></tr></table></figure>
<h4 id="3-åŠæ—¶å›æ”¶è¿æ¥æ± èµ„æº">&lt;3&gt;åŠæ—¶å›æ”¶è¿æ¥æ± èµ„æº</h4>
<p><strong>é—®é¢˜åœºæ™¯</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¿æ¥æ± å«æ— æ•ˆè¿æ¥ â†’ é«˜å¹¶å‘æ—¶æ‹¿åˆ°æ­»è¿æ¥ â†’ è¯·æ±‚å¤±è´¥â†’é‡è¯• â†’ æ€§èƒ½ä¸‹é™</span><br></pre></td></tr></table></figure>
<p><strong>å¿ƒè·³è§£å†³é€»è¾‘</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ£€æµ‹åˆ°æ­»è¿æ¥ â†’ ä»æ± ç§»é™¤ â†’ åˆ›å»ºæ–°è¿æ¥è¡¥å…… â†’ è¿æ¥æ± å…¨ä¸ºæœ‰æ•ˆè¿æ¥</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰å®Œæ•´äº¤äº’æµç¨‹å›¾ï¼ˆç®€åŒ–ç‰ˆï¼‰">ï¼ˆ2ï¼‰å®Œæ•´äº¤äº’æµç¨‹å›¾ï¼ˆç®€åŒ–ç‰ˆï¼‰</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚  Redis++    â”‚                              â”‚   Redis     â”‚</span><br><span class="line">â”‚  Client     â”‚                              â”‚  Server     â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">       â”‚                                            â”‚</span><br><span class="line">       â”‚ â•â•â•â•â•â• æ­£å¸¸ä¸šåŠ¡äº¤äº’ â•â•â•â•â•â•                  â”‚</span><br><span class="line">       â”‚ â”€ â”€ â”€ è¿æ¥ç©ºé—²ï¼ˆå¦‚30ç§’ï¼‰ â”€ â”€ â”€              â”‚</span><br><span class="line">       â”‚  ğŸ’“ å‘é€KeepAliveæ¢æµ‹åŒ…                     â”‚</span><br><span class="line">       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚</span><br><span class="line">       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚</span><br><span class="line">       â”‚         âœ… ACKå“åº”ï¼ˆæœåŠ¡å™¨æ­£å¸¸ï¼‰             â”‚</span><br><span class="line">       â”‚ â”€ â”€ â”€ è¿æ¥ç»§ç»­ä¿æŒï¼Œé‡ç½®ç©ºé—²è®¡æ—¶ â”€ â”€ â”€       â”‚</span><br><span class="line">       â”‚                                            â”‚</span><br><span class="line">       â”‚ â•â•â•â•â•â•â•â•â• å¼‚å¸¸åœºæ™¯ï¼šæœåŠ¡å™¨å´©æºƒ â•â•â•â•â•â•â•â•â•     â”‚</span><br><span class="line">       â”‚  ğŸ’“ å‘é€KeepAliveæ¢æµ‹åŒ…                     â”‚</span><br><span class="line">       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ (æ— å“åº”)</span><br><span class="line">       â”‚  ğŸ’“ é‡è¯•æ¢æµ‹ Ã— 9æ¬¡                          â”‚</span><br><span class="line">       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ (ä»æ— å“åº”)</span><br><span class="line">       â”‚  âŒ åˆ¤å®šè¿æ¥æ­»äº¡                            â”‚</span><br><span class="line">       â”‚  â†’ å…³é—­socket â†’ ä»è¿æ¥æ± ç§»é™¤ â†’ è‡ªåŠ¨é‡è¿      â”‚</span><br><span class="line">       â–¼                                            â–¼</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰â€œå¼€å¯å¿ƒè·³æœºåˆ¶â€-vs-â€œä¸å¼€å¿ƒè·³æœºåˆ¶â€">ï¼ˆ3ï¼‰â€œå¼€å¯å¿ƒè·³æœºåˆ¶â€ vs â€œä¸å¼€å¿ƒè·³æœºåˆ¶â€</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260113103013458.png" alt=""></p>
<h2 id="4-æ³¨æ„äº‹é¡¹ä¸å»ºè®®">4.æ³¨æ„äº‹é¡¹ä¸å»ºè®®</h2>
<h3 id="ï¼ˆ1ï¼‰ç³»ç»Ÿçº§-vs-åº”ç”¨çº§é…ç½®ä¼˜å…ˆçº§">ï¼ˆ1ï¼‰ç³»ç»Ÿçº§ vs åº”ç”¨çº§é…ç½®ä¼˜å…ˆçº§</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚              é…ç½®ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰                     â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚  1. setsockopt() åº”ç”¨çº§é…ç½®     â† æœ€é«˜ä¼˜å…ˆçº§          â”‚</span><br><span class="line">â”‚  2. /etc/sysctl.conf æ°¸ä¹…é…ç½®                         â”‚</span><br><span class="line">â”‚  3. å†…æ ¸é»˜è®¤å€¼                  â† æœ€ä½ä¼˜å…ˆçº§          â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„!!</strong>ï¼šåº”ç”¨çº§é…ç½®ä»…å½±å“å½“å‰ socketï¼Œä¸å½±å“å…¶ä»–è¿æ¥</p>
<h3 id="ï¼ˆ2ï¼‰ç”Ÿäº§ç¯å¢ƒé…ç½®å»ºè®®">ï¼ˆ2ï¼‰ç”Ÿäº§ç¯å¢ƒé…ç½®å»ºè®®</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260113111046526.png" alt=""></p>
<h3 id="ï¼ˆ3ï¼‰å¸¸è§é—®é¢˜">ï¼ˆ3ï¼‰å¸¸è§é—®é¢˜</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âŒ é”™è¯¯ï¼šåªå¼€å¯ KeepAliveï¼Œä¸è®¾ç½®å‚æ•°</span></span><br><span class="line"><span class="built_in">setsockopt</span>(fd, SOL_SOCKET, SO_KEEPALIVE, &amp;flag, <span class="built_in">sizeof</span>(flag));</span><br><span class="line"><span class="comment">// ç»“æœï¼šä½¿ç”¨ç³»ç»Ÿé»˜è®¤å€¼ï¼ˆ7200ç§’ï¼‰ï¼Œ2å°æ—¶åæ‰å¼€å§‹æ£€æµ‹ï¼Œç”Ÿäº§ç¯å¢ƒå¤ªæ…¢ï¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ­£ç¡®ï¼šå¼€å¯åå¿…é¡»è®¾ç½®å‚æ•°</span></span><br><span class="line"><span class="built_in">setsockopt</span>(fd, SOL_SOCKET, SO_KEEPALIVE, &amp;flag, <span class="built_in">sizeof</span>(flag));</span><br><span class="line"><span class="built_in">setsockopt</span>(fd, IPPROTO_TCP, TCP_KEEPIDLE, &amp;idle, <span class="built_in">sizeof</span>(idle));</span><br><span class="line"><span class="built_in">setsockopt</span>(fd, IPPROTO_TCP, TCP_KEEPINTVL, &amp;interval, <span class="built_in">sizeof</span>(interval));</span><br><span class="line"><span class="built_in">setsockopt</span>(fd, IPPROTO_TCP, TCP_KEEPCNT, &amp;count, <span class="built_in">sizeof</span>(count));</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="5-è¡¥å……">5.è¡¥å……</h2>
<h3 id="ï¼ˆ1ï¼‰æ¢æµ‹åŒ…">ï¼ˆ1ï¼‰æ¢æµ‹åŒ…</h3>
<h4 id="1-KeepAlive-æ¢æµ‹åŒ…çš„ç»“æ„ç‰¹å¾">&lt;1&gt;KeepAlive æ¢æµ‹åŒ…çš„ç»“æ„ç‰¹å¾</h4>
<p><strong>KeepAlive æ¢æµ‹åŒ…</strong>æ˜¯ä¸€ä¸ª<strong>ç‰¹æ®Šçš„ TCP åŒ…</strong>ï¼š</p>
<ul>
<li><strong>åºåˆ—å·</strong> = ä¸Šä¸€æ¬¡å‘é€çš„æœ€åå­—èŠ‚åºå· - 1ï¼ˆæ•…æ„&quot;å€’é€€&quot;ï¼‰</li>
<li><strong>æ•°æ®é•¿åº¦</strong> = 0 å­—èŠ‚</li>
<li><strong>ACK æ ‡å¿—</strong> = 1</li>
<li><strong>ç›®çš„</strong>ï¼šè§¦å‘å¯¹ç«¯å›å¤ä¸€ä¸ª ACKï¼Œä»¥æ­¤ç¡®è®¤è¿æ¥å­˜æ´»</li>
</ul>
<h4 id="2-æŠ“åŒ…å‘½ä»¤">&lt;2&gt;æŠ“åŒ…å‘½ä»¤</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨ tcpdump æŠ“å–</span></span><br><span class="line"><span class="built_in">sudo</span> tcpdump -i eth0 <span class="string">&#x27;tcp[tcpflags] &amp; tcp-ack != 0&#x27;</span> -nn</span><br><span class="line"></span><br><span class="line"><span class="comment"># Wireshark è¿‡æ»¤å™¨</span></span><br><span class="line">tcp.analysis.keep_alive</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰KeepAlive-çš„å±€é™æ€§">ï¼ˆ2ï¼‰KeepAlive çš„å±€é™æ€§</h3>
<p><strong>å±€é™æ€§</strong>ï¼š</p>
<ul>
<li><strong>æ£€æµ‹å»¶è¿Ÿé«˜</strong>ï¼šå³ä½¿ä¼˜åŒ–å‚æ•°ï¼Œæœ€å¿«ä¹Ÿè¦å‡ åç§’æ‰èƒ½å‘ç°æ­»è¿æ¥</li>
<li><strong>æ— æ³•æ£€æµ‹åº”ç”¨å±‚æ•…éšœ</strong>ï¼šå¯¹ç«¯è¿›ç¨‹æ­»é”ä½† TCP æ ˆæ­£å¸¸æ—¶ï¼ŒKeepAlive ä»ä¼šæˆåŠŸ</li>
<li><strong>è·¨ NAT åœºæ™¯</strong>ï¼šæŸäº› NAT è®¾å¤‡ä¼š&quot;ä»£ç­”&quot; KeepAliveï¼Œå¯¼è‡´æ£€æµ‹å¤±æ•ˆ</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li>å…³é”®ä¸šåŠ¡å¯å¢åŠ <strong>åº”ç”¨å±‚å¿ƒè·³</strong>ï¼ˆå¦‚ Redis çš„ PING å‘½ä»¤ï¼‰</li>
<li>ç»“åˆ <code>socket_timeout</code> è®¾ç½®è¯»å†™è¶…æ—¶</li>
</ul>
<h3 id="ï¼ˆ3ï¼‰â€œTCP-KeepAliveâ€-vs-â€œåº”ç”¨å±‚å¿ƒè·³â€">ï¼ˆ3ï¼‰â€œTCP KeepAliveâ€ vs â€œåº”ç”¨å±‚å¿ƒè·³â€</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260113112324791.png" alt=""></p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>TCP_IPç›¸å…³</category>
        <category>TCP KeepAlive å¿ƒè·³æœºåˆ¶</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonå…¥é—¨çŸ¥è¯†</title>
    <url>/2026/01/09/Python/Python%E5%85%A5%E9%97%A8%E7%9F%A5%E8%AF%86/</url>
    <content><![CDATA[<p><strong>é˜…è¯»å»ºè®®</strong>ï¼šæ¨èå…ˆé˜…è¯»ã€ŠPythonç¼–ç¨‹ï¼šä»å…¥é—¨åˆ°å®è·µã€‹ä½œä¸ºåŸºç¡€ã€‚<br>
<strong>å£°æ˜</strong>ï¼šæœ¬ç¬”è®°ä¸ºä¸ªäººå­¦ä¹  Python æœŸé—´æ•´ç†ï¼Œéƒ¨åˆ†å†…å®¹åœ¨ AI è¾…åŠ©ä¸‹å®Œæˆã€‚ç”±äºæ°´å¹³æœ‰é™ï¼Œå¯èƒ½å­˜åœ¨é”™è¯¯æˆ–è¡¨è¿°ä¸å½“ä¹‹å¤„ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚</p>
<h1>ä¸€ã€ç®€å•ç±»å‹</h1>
<h2 id="1-æ•°å­—">1.æ•°å­—</h2>
<h3 id="ï¼ˆ1ï¼‰æ•°å­—ç±»å‹æ€»è§ˆ">ï¼ˆ1ï¼‰æ•°å­—ç±»å‹æ€»è§ˆ</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109210235954.png" alt=""></p>
<h3 id="ï¼ˆ2ï¼‰è¿ç®—ç¬¦">ï¼ˆ2ï¼‰è¿ç®—ç¬¦</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109211802890.png" alt=""></p>
<h3 id="ï¼ˆ3ï¼‰å…³é”®ç‰¹æ€§">ï¼ˆ3ï¼‰å…³é”®ç‰¹æ€§</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109210634283.png" alt=""><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109210655826.png" alt=""><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109210730504.png" alt=""></p>
<h4 id="è¡¥å……ï¼šâ€œä¸å¯å˜æ€§â€">è¡¥å……ï¼šâ€œä¸å¯å˜æ€§â€</h4>
<ul>
<li><strong>æ‰€æœ‰æ•°å­—ç±»å‹éƒ½æ˜¯ä¸å¯å˜å¯¹è±¡ï¼ˆä¿®æ”¹ä¼šç”Ÿæˆæ–°å¯¹è±¡ï¼‰</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ°å€å”¯ä¸€æ ‡è¯†å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. æ•´æ•°ç¤ºä¾‹</span></span><br><span class="line">a = <span class="number">10</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ä¿®æ”¹å‰ a çš„å€¼ï¼š<span class="subst">&#123;a&#125;</span>ï¼Œå†…å­˜åœ°å€ï¼š<span class="subst">&#123;<span class="built_in">id</span>(a)&#125;</span>&quot;</span>) <span class="comment"># ä¿®æ”¹å‰ a çš„å€¼ï¼š10ï¼Œå†…å­˜åœ°å€ï¼š140708467500096  </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># çœ‹ä¼¼â€œä¿®æ”¹â€aï¼Œå®é™…æ˜¯åˆ›å»ºæ–°å¯¹è±¡</span></span><br><span class="line">a += <span class="number">5</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ä¿®æ”¹å a çš„å€¼ï¼š<span class="subst">&#123;a&#125;</span>ï¼Œå†…å­˜åœ°å€ï¼š<span class="subst">&#123;<span class="built_in">id</span>(a)&#125;</span>&quot;</span>)  <span class="comment"># ä¿®æ”¹å a çš„å€¼ï¼š15ï¼Œå†…å­˜åœ°å€ï¼š140708467500256</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. æµ®ç‚¹æ•°ç¤ºä¾‹</span></span><br><span class="line">b = <span class="number">3.14</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;\nä¿®æ”¹å‰ b çš„å€¼ï¼š<span class="subst">&#123;b&#125;</span>ï¼Œå†…å­˜åœ°å€ï¼š<span class="subst">&#123;<span class="built_in">id</span>(b)&#125;</span>&quot;</span>) <span class="comment"># ä¿®æ”¹å‰ b çš„å€¼ï¼š3.14ï¼Œå†…å­˜åœ°å€ï¼š2865657515952</span></span><br><span class="line"></span><br><span class="line">b = b * <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ä¿®æ”¹å b çš„å€¼ï¼š<span class="subst">&#123;b&#125;</span>ï¼Œå†…å­˜åœ°å€ï¼š<span class="subst">&#123;<span class="built_in">id</span>(b)&#125;</span>&quot;</span>)  <span class="comment"># ä¿®æ”¹å b çš„å€¼ï¼š6.28ï¼Œå†…å­˜åœ°å€ï¼š2865657516176</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. å¤æ•°ç¤ºä¾‹</span></span><br><span class="line">c = <span class="number">1</span> + <span class="number">2j</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;\nä¿®æ”¹å‰ c çš„å€¼ï¼š<span class="subst">&#123;c&#125;</span>ï¼Œå†…å­˜åœ°å€ï¼š<span class="subst">&#123;<span class="built_in">id</span>(c)&#125;</span>&quot;</span>) <span class="comment"># ä¿®æ”¹å‰ c çš„å€¼ï¼š(1+2j)ï¼Œå†…å­˜åœ°å€ï¼š2865657468880</span></span><br><span class="line"></span><br><span class="line">c = c + (<span class="number">3</span> + <span class="number">4j</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ä¿®æ”¹å c çš„å€¼ï¼š<span class="subst">&#123;c&#125;</span>ï¼Œå†…å­˜åœ°å€ï¼š<span class="subst">&#123;<span class="built_in">id</span>(c)&#125;</span>&quot;</span>)  <span class="comment"># ä¿®æ”¹å c çš„å€¼ï¼š(4+6j)ï¼Œå†…å­˜åœ°å€ï¼š2865657469008</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ4ï¼‰ç±»å‹è½¬æ¢">ï¼ˆ4ï¼‰ç±»å‹è½¬æ¢</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109211200538.png" alt=""></p>
<h3 id="ï¼ˆ5ï¼‰å¸¸ç”¨å†…ç½®å‡½æ•°">ï¼ˆ5ï¼‰å¸¸ç”¨å†…ç½®å‡½æ•°</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109211352194.png" alt=""></p>
<h2 id="2-bool-å¸ƒå°”-ç±»å‹">2.bool(å¸ƒå°”)ç±»å‹</h2>
<h3 id="ï¼ˆ1ï¼‰bool-ç±»å‹çš„åŸºç¡€å®šä¹‰ä¸æœ¬è´¨">ï¼ˆ1ï¼‰bool ç±»å‹çš„åŸºç¡€å®šä¹‰ä¸æœ¬è´¨</h3>
<ul>
<li><strong>boolç±»å‹çš„å®šä¹‰</strong>ï¼š Python ä¸­ç”¨äº<strong>è¡¨ç¤ºã€ŒçœŸ/å‡ã€é€»è¾‘åˆ¤æ–­</strong>çš„åŸºç¡€ç±»å‹ï¼Œæ ¸å¿ƒå–å€¼ä»…ä¸¤ä¸ªï¼š<strong>Trueï¼ˆçœŸï¼‰</strong> å’Œ <strong>Falseï¼ˆå‡ï¼‰</strong></li>
<li><strong>boolç±»å‹çš„æœ¬è´¨</strong>ï¼šç‰¹æ®Šçš„æ•´æ•°ï¼Œå…¶ä¸­ True ç­‰ä»·äºæ•´æ•° 1ï¼ŒFalse ç­‰ä»·äºæ•´æ•° 0</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰bool-ç±»å‹çš„æ ¸å¿ƒç‰¹æ€§">ï¼ˆ2ï¼‰bool ç±»å‹çš„æ ¸å¿ƒç‰¹æ€§</h3>
<ul>
<li><strong>å–å€¼å”¯ä¸€</strong>ï¼šæŸä¸ªå¸ƒå°”è¡¨è¾¾å¼çš„ç»“æœåœ¨ç‰¹å®šæ—¶åˆ»åªèƒ½æ˜¯Trueæˆ–Falseä¹‹ä¸€
<ul>
<li><strong>é¦–å­—æ¯å¿…é¡»å¤§å†™</strong>ï¼Œtrueã€falseä¸ºæ— æ•ˆç±»å‹</li>
</ul>
</li>
<li><strong>ä¸å¯å˜æ€§</strong>ï¼šä¸æ•°å­—ã€å­—ç¬¦ä¸²ç±»å‹ä¸€è‡´ï¼Œbool ç±»å‹ä¹Ÿæ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œä¸€æ—¦åˆ›å»ºæ— æ³•ä¿®æ”¹å€¼ï¼ˆä½†å› å–å€¼å”¯ä¸€ï¼Œå®é™…æ— ä¿®æ”¹åœºæ™¯ï¼‰</li>
<li><strong>å­ç±»ç‰¹æ€§</strong>ï¼šbool æ˜¯ int çš„å­ç±»ï¼Œå› æ­¤å¯ç»§æ‰¿ int çš„éƒ¨åˆ†å±æ€§å’Œæ–¹æ³•ï¼Œä½†è‡ªèº«æ— é¢å¤–ç‰¹æœ‰æ–¹æ³•ï¼›</li>
<li><strong>é€»è¾‘è¿ç®—æ ¸å¿ƒ</strong>ï¼šæ”¯æŒandï¼ˆä¸ï¼‰ã€orï¼ˆæˆ–ï¼‰ã€notï¼ˆéï¼‰ä¸‰ç§æ ¸å¿ƒé€»è¾‘è¿ç®—
<ul>
<li><strong>æ³¨æ„</strong>ï¼šä¸æ˜¯åƒæŸäº›è¯­è¨€ç”¨ &amp;&amp; ã€ || ã€ !</li>
</ul>
</li>
</ul>
<h3 id="ï¼ˆ3ï¼‰å…¶ä»–ç±»å‹åˆ°-bool-ç±»å‹çš„è½¬æ¢è§„åˆ™">ï¼ˆ3ï¼‰å…¶ä»–ç±»å‹åˆ° bool ç±»å‹çš„è½¬æ¢è§„åˆ™</h3>
<ul>
<li><strong>Python ä¸­ï¼Œä»»ä½•ç±»å‹çš„å¯¹è±¡éƒ½å¯ä»¥é€šè¿‡ bool() å‡½æ•°è½¬ä¸º bool ç±»å‹</strong>
<ul>
<li><strong>è½¬æ¢è§„åˆ™</strong>ï¼šç©º/é›¶ä¸º Falseï¼Œéç©º/éé›¶ä¸º True<br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109222801836.png" alt=""></li>
</ul>
</li>
<li><strong>ä¸‡ç‰©çš†bool</strong>ï¼šæ‰€æœ‰ç±»å‹éƒ½å¯ä»¥ç›´æ¥ä½œä¸ºboolå‚ä¸åˆ¤æ–­ï¼ˆ<strong>éšå¼è½¬æ¢</strong>ï¼‰</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. æ•°å€¼ç±»å‹ï¼š0/0.0/0+0j ä¸º Falseï¼Œå…¶ä»–ä¸º True</span></span><br><span class="line"><span class="keyword">if</span> <span class="number">10</span>:  <span class="comment"># éé›¶ â†’ True</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;10 æ˜¯ True&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="number">0.0</span>:  <span class="comment"># é›¶ â†’ Falseï¼ˆä¸æ‰§è¡Œï¼‰</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;0.0 æ˜¯ True&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. å­—ç¬¦ä¸²ï¼šç©ºå­—ç¬¦ä¸² &#x27;&#x27; ä¸º Falseï¼Œå…¶ä»–ï¼ˆå«ç©ºç™½ï¼‰ä¸º True</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;hello&quot;</span>:  <span class="comment"># éç©º â†’ True</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;éç©ºå­—ç¬¦ä¸²æ˜¯ True&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;   &quot;</span>:  <span class="comment"># ç©ºç™½å­—ç¬¦ä¸²ï¼ˆéç©ºï¼‰â†’ True</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ç©ºç™½å­—ç¬¦ä¸²ä¹Ÿæ˜¯ True&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;&quot;</span>:  <span class="comment"># ç©ºå­—ç¬¦ä¸² â†’ Falseï¼ˆä¸æ‰§è¡Œï¼‰</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ç©ºå­—ç¬¦ä¸²æ˜¯ True&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. å®¹å™¨ç±»å‹ï¼šç©ºåˆ—è¡¨/å…ƒç»„/å­—å…¸ä¸º Falseï¼Œéç©ºä¸º True</span></span><br><span class="line"><span class="keyword">if</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]:  <span class="comment"># éç©ºåˆ—è¡¨ â†’ True</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;éç©ºåˆ—è¡¨æ˜¯ True&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> &#123;&#125;:  <span class="comment"># ç©ºå­—å…¸ â†’ Falseï¼ˆä¸æ‰§è¡Œï¼‰</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ç©ºå­—å…¸æ˜¯ True&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. Noneï¼šç›´æ¥åˆ¤æ–­ï¼Œæ— éœ€å†™ == None</span></span><br><span class="line">x = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> x:  <span class="comment"># None â†’ Falseï¼Œnot åä¸º True</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;x æ˜¯ None&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="3-å­—ç¬¦ä¸²">3.å­—ç¬¦ä¸²</h2>
<h3 id="ï¼ˆ1ï¼‰å­—ç¬¦ä¸²çš„å®šä¹‰ä¸åŸºç¡€è¡¨ç¤º">ï¼ˆ1ï¼‰å­—ç¬¦ä¸²çš„å®šä¹‰ä¸åŸºç¡€è¡¨ç¤º</h3>
<ul>
<li><strong>å•å¼•å·ï¼ˆ'ï¼‰</strong>ï¼šé€‚ç”¨äºçŸ­æ–‡æœ¬ï¼Œå†…éƒ¨å¯ç›´æ¥åŒ…å«åŒå¼•å·ï¼ˆæ— éœ€è½¬ä¹‰ï¼‰</li>
<li><strong>åŒå¼•å·ï¼ˆ&quot;ï¼‰</strong>ï¼šä¸å•å¼•å·åŠŸèƒ½åŸºæœ¬ä¸€è‡´ï¼Œå†…éƒ¨å¯ç›´æ¥åŒ…å«å•å¼•å·</li>
<li><strong>ä¸‰å¼•å·ï¼ˆâ€˜â€™â€™ æˆ– â€œâ€&quot;ï¼‰</strong>ï¼šæ”¯æŒå¤šè¡Œæ–‡æœ¬ï¼Œå¯ä¿ç•™æ¢è¡Œã€ç©ºæ ¼ç­‰æ ¼å¼ï¼Œä¹Ÿå¯ç”¨äºæ–‡æ¡£å­—ç¬¦ä¸²ï¼ˆæ³¨é‡Šï¼‰</li>
<li><strong>åŸå§‹å­—ç¬¦ä¸²ï¼ˆr/R å‰ç¼€ï¼‰</strong>ï¼šç¦æ­¢è½¬ä¹‰å­—ç¬¦ï¼ˆ\ï¼‰ç”Ÿæ•ˆï¼Œé€‚ç”¨äºè·¯å¾„ã€æ­£åˆ™è¡¨è¾¾å¼ç­‰åœºæ™¯</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. å•å¼•å·ä¸åŒå¼•å·</span></span><br><span class="line">str1 = <span class="string">&#x27;Hello Python&#x27;</span></span><br><span class="line">str2 = <span class="string">&quot;Hello &#x27;Python&#x27;&quot;</span>  <span class="comment"># å†…éƒ¨åŒ…å«å•å¼•å·ï¼Œç”¨åŒå¼•å·åŒ…è£¹æ— éœ€è½¬ä¹‰</span></span><br><span class="line">str3 = <span class="string">&#x27;Hello &quot;Python&quot;&#x27;</span>  <span class="comment"># å†…éƒ¨åŒ…å«åŒå¼•å·ï¼Œç”¨å•å¼•å·åŒ…è£¹æ— éœ€è½¬ä¹‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. ä¸‰å¼•å·ï¼ˆå¤šè¡Œæ–‡æœ¬ï¼‰</span></span><br><span class="line">str4 = <span class="string">&#x27;&#x27;&#x27;ç¬¬ä¸€è¡Œæ–‡æœ¬</span></span><br><span class="line"><span class="string">ç¬¬äºŒè¡Œæ–‡æœ¬</span></span><br><span class="line"><span class="string">ç¬¬ä¸‰è¡Œæ–‡æœ¬&#x27;&#x27;&#x27;</span>  <span class="comment"># ä¿ç•™æ¢è¡Œæ ¼å¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. åŸå§‹å­—ç¬¦ä¸²ï¼ˆç¦æ­¢è½¬ä¹‰ï¼‰</span></span><br><span class="line">str5 = <span class="string">r&#x27;C:\Users\test\Desktop&#x27;</span>  <span class="comment"># æ— éœ€å†™æˆ C:\\Users\\test\\Desktop</span></span><br><span class="line">str6 = <span class="string">R&#x27;hello\nworld&#x27;</span>  <span class="comment"># è¾“å‡ºï¼šhello\nworldï¼ˆ\nä¸è¢«è§£æä¸ºæ¢è¡Œï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(str2)  <span class="comment"># Hello &#x27;Python&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(str4)  <span class="comment"># æŒ‰å¤šè¡Œæ ¼å¼è¾“å‡º</span></span><br><span class="line"><span class="built_in">print</span>(str5)  <span class="comment"># C:\Users\test\Desktop</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰å­—ç¬¦ä¸²çš„å¸¸ç”¨æ“ä½œ">ï¼ˆ2ï¼‰å­—ç¬¦ä¸²çš„å¸¸ç”¨æ“ä½œ</h3>
<h4 id="1-æ‹¼æ¥ä¸é‡å¤">&lt;1&gt;æ‹¼æ¥ä¸é‡å¤</h4>
<ul>
<li><strong>æ‹¼æ¥</strong>ï¼šç”¨ + è¿ç®—ç¬¦ï¼Œå°†å¤šä¸ªå­—ç¬¦ä¸²åˆå¹¶ä¸ºä¸€ä¸ªæ–°å­—ç¬¦ä¸²</li>
<li><strong>é‡å¤</strong>ï¼šç”¨ * è¿ç®—ç¬¦ï¼Œå°†å­—ç¬¦ä¸²é‡å¤æŒ‡å®šæ¬¡æ•°</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ‹¼æ¥</span></span><br><span class="line">s1 = <span class="string">&#x27;Hello&#x27;</span></span><br><span class="line">s2 = <span class="string">&#x27;World&#x27;</span></span><br><span class="line">s3 = s1 + <span class="string">&#x27;, &#x27;</span> + s2 + <span class="string">&#x27;!&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(s3)  <span class="comment"># Hello, World!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¤</span></span><br><span class="line">s4 = <span class="string">&#x27;ab&#x27;</span> * <span class="number">3</span></span><br><span class="line"><span class="built_in">print</span>(s4)  <span class="comment"># ababab</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šå­—ç¬¦ä¸²ä¸èƒ½ä¸éå­—ç¬¦ä¸²ç±»å‹ç›´æ¥æ‹¼æ¥ï¼Œéœ€å…ˆè½¬æ¢ç±»å‹</span></span><br><span class="line">num = <span class="number">123</span></span><br><span class="line"><span class="comment"># s5 = s1 + num  # æŠ¥é”™ï¼šTypeError: can only concatenate str (not &quot;int&quot;) to str</span></span><br><span class="line">s5 = s1 + <span class="built_in">str</span>(num)  <span class="comment"># å…ˆå°†intè½¬ä¸ºstr</span></span><br><span class="line"><span class="built_in">print</span>(s5)  <span class="comment"># Hello123</span></span><br></pre></td></tr></table></figure>
<h4 id="2-æ ¼å¼åŒ–è½¬æ¢">&lt;2&gt;æ ¼å¼åŒ–è½¬æ¢</h4>
<p><strong>å­—ç¬¦ä¸²æ ¼å¼åŒ–ç”¨äºå°†å˜é‡/è¡¨è¾¾å¼çš„å€¼æ’å…¥åˆ°å­—ç¬¦ä¸²ä¸­ï¼Œå¸¸ç”¨ä¸‰ç§æ–¹å¼ï¼š</strong></p>
<ul>
<li><strong>% æ ¼å¼åŒ–</strong>ï¼šä¼ ç»Ÿæ–¹å¼ï¼Œç±»ä¼¼ C è¯­è¨€çš„ printfï¼›</li>
<li><strong>str.format()</strong>ï¼šPython 2.6+ å¼•å…¥ï¼Œæ›´çµæ´»çš„æ ¼å¼åŒ–æ–¹å¼ï¼›</li>
<li><strong>f-stringï¼ˆf/F å‰ç¼€ï¼‰</strong>ï¼šPython 3.6+ å¼•å…¥ï¼Œæœ€ç®€æ´é«˜æ•ˆçš„æ ¼å¼åŒ–æ–¹å¼ï¼Œæ”¯æŒåœ¨å­—ç¬¦ä¸²ä¸­<strong>ç›´æ¥åµŒå…¥å˜é‡/è¡¨è¾¾å¼</strong>ã€‚ï¼ˆ<strong>æœ€æ¨èï¼</strong>ï¼‰</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">name = <span class="string">&#x27;å°æ˜&#x27;</span></span><br><span class="line">age = <span class="number">20</span></span><br><span class="line">score = <span class="number">95.5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. % æ ¼å¼åŒ–</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;å§“åï¼š%sï¼Œå¹´é¾„ï¼š%dï¼Œæˆç»©ï¼š%.1f&#x27;</span> % (name, age, score))  <span class="comment"># å§“åï¼šå°æ˜ï¼Œå¹´é¾„ï¼š20ï¼Œæˆç»©ï¼š95.5</span></span><br><span class="line"><span class="comment"># è¯´æ˜ï¼š%sï¼ˆå­—ç¬¦ä¸²ï¼‰ã€%dï¼ˆæ•´æ•°ï¼‰ã€%.1fï¼ˆä¿ç•™1ä½å°æ•°çš„æµ®ç‚¹æ•°ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. str.format() æ ¼å¼åŒ–</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;å§“åï¼š&#123;&#125;ï¼Œå¹´é¾„ï¼š&#123;&#125;ï¼Œæˆç»©ï¼š&#123;:.1f&#125;&#x27;</span>.<span class="built_in">format</span>(name, age, score))  <span class="comment"># åŒä¸Š</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;å§“åï¼š&#123;0&#125;ï¼Œå¹´é¾„ï¼š&#123;1&#125;ï¼Œæˆç»©ï¼š&#123;2:.1f&#125;&#x27;</span>.<span class="built_in">format</span>(name, age, score))  <span class="comment"># æŒ‰ç´¢å¼•æŒ‡å®šå‚æ•°</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;å§“åï¼š&#123;n&#125;ï¼Œå¹´é¾„ï¼š&#123;a&#125;ï¼Œæˆç»©ï¼š&#123;s:.1f&#125;&#x27;</span>.<span class="built_in">format</span>(n=name, a=age, s=score))  <span class="comment"># æŒ‰å‚æ•°åæŒ‡å®š</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. f-string æ ¼å¼åŒ–ï¼ˆæ¨èï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;å§“åï¼š<span class="subst">&#123;name&#125;</span>ï¼Œå¹´é¾„ï¼š<span class="subst">&#123;age&#125;</span>ï¼Œæˆç»©ï¼š<span class="subst">&#123;score:<span class="number">.1</span>f&#125;</span>&#x27;</span>)  <span class="comment"># åŒä¸Š</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;æ˜å¹´å¹´é¾„ï¼š<span class="subst">&#123;age + <span class="number">1</span>&#125;</span>&#x27;</span>)  <span class="comment"># æ”¯æŒè¡¨è¾¾å¼ï¼šæ˜å¹´å¹´é¾„ï¼š21</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;æˆç»©çš„å¹³æ–¹ï¼š<span class="subst">&#123;score ** <span class="number">2</span>&#125;</span>&#x27;</span>)  <span class="comment"># æ”¯æŒè¡¨è¾¾å¼ï¼šæˆç»©çš„å¹³æ–¹ï¼š9120.25</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰å­—ç¬¦ä¸²å¸¸ç”¨å†…ç½®å‡½æ•°ä¸æ–¹æ³•">ï¼ˆ3ï¼‰å­—ç¬¦ä¸²å¸¸ç”¨å†…ç½®å‡½æ•°ä¸æ–¹æ³•</h3>
<h4 id="1-å†…ç½®å‡½æ•°ï¼ˆå…¨å±€å‡½æ•°ï¼Œå¯ç›´æ¥è°ƒç”¨ï¼‰">&lt;1&gt;å†…ç½®å‡½æ•°ï¼ˆå…¨å±€å‡½æ•°ï¼Œå¯ç›´æ¥è°ƒç”¨ï¼‰</h4>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260112103648031.png" alt=""></p>
<h4 id="2-å­—ç¬¦ä¸²å¯¹è±¡æ–¹æ³•ï¼ˆéœ€é€šè¿‡å­—ç¬¦ä¸²å®ä¾‹è°ƒç”¨ï¼Œs-æ–¹æ³•å-ï¼‰">&lt;2&gt;å­—ç¬¦ä¸²å¯¹è±¡æ–¹æ³•ï¼ˆéœ€é€šè¿‡å­—ç¬¦ä¸²å®ä¾‹è°ƒç”¨ï¼Œs.æ–¹æ³•å()ï¼‰</h4>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109215553043.png" alt=""></p>
<h4 id="è¡¥å……ï¼š-join-æ–¹æ³•">è¡¥å……ï¼š join()æ–¹æ³•</h4>
<p>join() æ˜¯å­—ç¬¦ä¸²çš„å†…ç½®æ–¹æ³•ï¼Œä½œç”¨æ˜¯å°†ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼ˆåˆ—è¡¨ã€å…ƒç»„ã€å­—ç¬¦ä¸²ã€ç”Ÿæˆå™¨ç­‰ï¼‰ä¸­çš„æ‰€æœ‰å…ƒç´ æ‹¼æ¥æˆä¸€ä¸ªæ–°å­—ç¬¦ä¸²ï¼Œ<strong>æ‹¼æ¥çš„åˆ†éš”ç¬¦å°±æ˜¯è°ƒç”¨ join() çš„è¿™ä¸ªå­—ç¬¦ä¸²</strong>ã€‚</p>
<h5 id="1ï¼‰åŸºæœ¬è¯­æ³•">1ï¼‰åŸºæœ¬è¯­æ³•</h5>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">åˆ†éš”ç¬¦å­—ç¬¦ä¸².join(å¯è¿­ä»£å¯¹è±¡)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>è¦æ±‚</strong>ï¼šå¯è¿­ä»£å¯¹è±¡ä¸­çš„å…ƒç´ å¿…é¡»<strong>éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹</strong>ï¼ˆå¦åˆ™ä¼šæŠ¥é”™ï¼‰ã€‚</li>
<li><strong>è¿”å›å€¼</strong>ï¼šæ‹¼æ¥åçš„æ–°å­—ç¬¦ä¸²ã€‚</li>
</ul>
<h5 id="2ï¼‰åŸºç¡€ç¤ºä¾‹">2ï¼‰åŸºç¡€ç¤ºä¾‹</h5>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¤ºä¾‹1ï¼šç”¨é€—å·æ‹¼æ¥åˆ—è¡¨å…ƒç´ </span></span><br><span class="line">lst = [<span class="string">&quot;è‹¹æœ&quot;</span>, <span class="string">&quot;é¦™è•‰&quot;</span>, <span class="string">&quot;æ©™å­&quot;</span>]</span><br><span class="line">result = <span class="string">&quot;,&quot;</span>.join(lst)</span><br><span class="line"><span class="built_in">print</span>(result)  <span class="comment"># è¾“å‡ºï¼šè‹¹æœ,é¦™è•‰,æ©™å­</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹2ï¼šç”¨ç©ºæ ¼æ‹¼æ¥å…ƒç»„å…ƒç´ </span></span><br><span class="line">tup = (<span class="string">&quot;Python&quot;</span>, <span class="string">&quot;Java&quot;</span>, <span class="string">&quot;C++&quot;</span>)</span><br><span class="line">result = <span class="string">&quot; &quot;</span>.join(tup)</span><br><span class="line"><span class="built_in">print</span>(result)  <span class="comment"># è¾“å‡ºï¼šPython Java C++</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹3ï¼šç©ºå­—ç¬¦ä¸²æ‹¼æ¥ï¼ˆæ— åˆ†éš”ç¬¦ï¼‰</span></span><br><span class="line">chars = [<span class="string">&quot;H&quot;</span>, <span class="string">&quot;e&quot;</span>, <span class="string">&quot;l&quot;</span>, <span class="string">&quot;l&quot;</span>, <span class="string">&quot;o&quot;</span>]</span><br><span class="line">result = <span class="string">&quot;&quot;</span>.join(chars)</span><br><span class="line"><span class="built_in">print</span>(result)  <span class="comment"># è¾“å‡ºï¼šHello</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹4ï¼šå¤æ‚åˆ†éš”ç¬¦</span></span><br><span class="line">words = [<span class="string">&quot;2026&quot;</span>, <span class="string">&quot;01&quot;</span>, <span class="string">&quot;12&quot;</span>]</span><br><span class="line">result = <span class="string">&quot;-&quot;</span>.join(words)</span><br><span class="line"><span class="built_in">print</span>(result)  <span class="comment"># è¾“å‡ºï¼š2026-01-12</span></span><br></pre></td></tr></table></figure>
<h5 id="3ï¼‰å¸¸è§å‘ç‚¹-è§£å†³æ–¹æ³•">3ï¼‰å¸¸è§å‘ç‚¹ &amp; è§£å†³æ–¹æ³•</h5>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å‘ç‚¹ 1ï¼šå¯è¿­ä»£å¯¹è±¡å«éå­—ç¬¦ä¸²å…ƒç´ </span></span><br><span class="line">nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># é”™è¯¯å†™æ³•ï¼ˆä¼šæŠ¥é”™ï¼‰</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    result = <span class="string">&quot;|&quot;</span>.join(nums)</span><br><span class="line"><span class="keyword">except</span> TypeError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æŠ¥é”™ï¼š<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼šæŠ¥é”™ï¼šsequence item 0: expected str instance, int found</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­£ç¡®å†™æ³•</span></span><br><span class="line">result = <span class="string">&quot;|&quot;</span>.join(<span class="built_in">str</span>(num) <span class="keyword">for</span> num <span class="keyword">in</span> nums)</span><br><span class="line"><span class="built_in">print</span>(result)  <span class="comment"># è¾“å‡ºï¼š1|2|3 âœ…</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘ç‚¹ 2ï¼šæ‹¼æ¥ç©ºå¯è¿­ä»£å¯¹è±¡</span></span><br><span class="line">empty_lst = []</span><br><span class="line">result = <span class="string">&quot;-&quot;</span>.join(empty_lst)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ç»“æœï¼š&#x27;<span class="subst">&#123;result&#125;</span>&#x27;&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šç»“æœï¼š&#x27;&#x27; </span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;é•¿åº¦ï¼š<span class="subst">&#123;<span class="built_in">len</span>(result)&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šé•¿åº¦ï¼š0 </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘ç‚¹ 3ï¼šè¯¯ä»¥ä¸ºæ˜¯ list.join() è€Œä¸æ˜¯ str.join()</span></span><br><span class="line">words = [<span class="string">&quot;Hello&quot;</span>, <span class="string">&quot;World&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># âŒ é”™è¯¯å†™æ³•ï¼ˆåˆå­¦è€…å¸¸çŠ¯ï¼‰</span></span><br><span class="line"><span class="comment"># words.join(&quot;-&quot;)  # æŠ¥é”™ï¼šAttributeError: &#x27;list&#x27; object has no attribute &#x27;join&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># âœ… æ­£ç¡®å†™æ³•ï¼šæ˜¯&quot;åˆ†éš”ç¬¦&quot;.join(åˆ—è¡¨)</span></span><br><span class="line">result = <span class="string">&quot;-&quot;</span>.join(words)</span><br><span class="line"><span class="built_in">print</span>(result)  <span class="comment"># è¾“å‡ºï¼šHello-World</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ4ï¼‰å­—ç¬¦ä¸²çš„æ ¸å¿ƒç‰¹æ€§">ï¼ˆ4ï¼‰å­—ç¬¦ä¸²çš„æ ¸å¿ƒç‰¹æ€§</h3>
<h4 id="1-ä¸å¯å˜æ€§">&lt;1&gt;ä¸å¯å˜æ€§</h4>
<ul>
<li>å­—ç¬¦ä¸²å¯¹è±¡<strong>ä¸€æ—¦åˆ›å»º</strong>ï¼Œå…¶å†…éƒ¨çš„å­—ç¬¦åºåˆ—å°±<strong>æ— æ³•è¢«ä¿®æ”¹</strong>ï¼ˆåŒ…æ‹¬å¢åˆ ã€æ›¿æ¢å•ä¸ªå­—ç¬¦ï¼‰</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">s = <span class="string">&#x27;hello&#x27;</span></span><br><span class="line"><span class="comment"># s[0] = &#x27;H&#x27;  # æŠ¥é”™ï¼šTypeError: &#x27;str&#x27; object does not support item assignmentï¼ˆå­—ç¬¦ä¸²ä¸æ”¯æŒå…ƒç´ èµ‹å€¼ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è‹¥éœ€ä¿®æ”¹ï¼Œéœ€é€šè¿‡åˆ‡ç‰‡ã€æ‹¼æ¥ç”Ÿæˆæ–°å­—ç¬¦ä¸²</span></span><br><span class="line">s_new = <span class="string">&#x27;H&#x27;</span> + s[<span class="number">1</span>:]  <span class="comment"># æ‹¼æ¥ï¼šç”¨&#x27;H&#x27;æ›¿æ¢ç¬¬ä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line"><span class="built_in">print</span>(s_new)  <span class="comment"># Hello</span></span><br></pre></td></tr></table></figure>
<ul>
<li>ä»»ä½•çœ‹ä¼¼ â€œä¿®æ”¹â€ å­—ç¬¦ä¸²çš„æ“ä½œï¼Œæœ¬è´¨éƒ½æ˜¯<strong>åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„å­—ç¬¦ä¸²å¯¹è±¡</strong>ï¼ŒåŸå¯¹è±¡ä¿æŒä¸å˜ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆå§‹å­—ç¬¦ä¸²</span></span><br><span class="line">s = <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;åˆå§‹å€¼ï¼š<span class="subst">&#123;s&#125;</span>ï¼Œå†…å­˜åœ°å€ï¼š<span class="subst">&#123;<span class="built_in">id</span>(s)&#125;</span>&quot;</span>)  <span class="comment"># æ¯”å¦‚ï¼šåˆå§‹å€¼ï¼šhelloï¼Œåœ°å€ï¼š140708467898160</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. æ‹¼æ¥æ“ä½œï¼ˆçœ‹ä¼¼ä¿®æ”¹ï¼Œå®é™…æ–°å»ºï¼‰</span></span><br><span class="line">s += <span class="string">&quot; world&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æ‹¼æ¥åï¼š<span class="subst">&#123;s&#125;</span>ï¼Œå†…å­˜åœ°å€ï¼š<span class="subst">&#123;<span class="built_in">id</span>(s)&#125;</span>&quot;</span>)  <span class="comment"># æ‹¼æ¥åï¼šhello worldï¼Œåœ°å€ï¼š140708467900272ï¼ˆåœ°å€å˜äº†ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. åˆ‡ç‰‡æ›¿æ¢ï¼ˆçœ‹ä¼¼ä¿®æ”¹ï¼Œå®é™…æ–°å»ºï¼‰</span></span><br><span class="line">s = <span class="string">&quot;hello&quot;</span></span><br><span class="line">s_new = <span class="string">&quot;H&quot;</span> + s[<span class="number">1</span>:]  <span class="comment"># ç”¨åˆ‡ç‰‡ç”Ÿæˆæ–°å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æ›¿æ¢åï¼š<span class="subst">&#123;s_new&#125;</span>ï¼ŒåŸsåœ°å€ï¼š<span class="subst">&#123;<span class="built_in">id</span>(s)&#125;</span>ï¼Œæ–°s_newåœ°å€ï¼š<span class="subst">&#123;<span class="built_in">id</span>(s_new)&#125;</span>&quot;</span>)</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼šæ›¿æ¢åï¼šHelloï¼ŒåŸsåœ°å€ï¼š140708467898160ï¼Œæ–°åœ°å€ï¼š140708467900400ï¼ˆåœ°å€ä¸åŒï¼‰</span></span><br></pre></td></tr></table></figure>
<h4 id="2-åºåˆ—ç‰¹æ€§ï¼ˆåˆå­¦è€…å¯ä»¥å…ˆäº†è§£ï¼Œä¹‹åå†å›å¤´çœ‹ï¼‰">&lt;2&gt;åºåˆ—ç‰¹æ€§ï¼ˆåˆå­¦è€…å¯ä»¥å…ˆäº†è§£ï¼Œä¹‹åå†å›å¤´çœ‹ï¼‰</h4>
<p>å­—ç¬¦ä¸²æ˜¯å­—ç¬¦çš„åºåˆ—ï¼Œæ”¯æŒã€Œç´¢å¼•ã€å’Œã€Œåˆ‡ç‰‡ã€æ“ä½œï¼Œå¯æŒ‰ä½ç½®è®¿é—®æˆ–æˆªå–å­—ç¬¦ï¼ˆä¸åˆ—è¡¨ã€å…ƒç»„çš„åºåˆ—æ“ä½œé€»è¾‘ä¸€è‡´ï¼‰</p>
<ul>
<li>
<p><strong>ç´¢å¼•</strong>ï¼šä» 0 å¼€å§‹ï¼ˆæ­£å‘ç´¢å¼•ï¼‰ï¼Œä¹Ÿå¯ä» -1 å¼€å§‹ï¼ˆåå‘ç´¢å¼•ï¼Œå³ä»æœ«å°¾å€’æ•°ï¼‰</p>
</li>
<li>
<p><strong>åˆ‡ç‰‡</strong>ï¼šè¯­æ³•ä¸º <strong>str[start:end:step]</strong>ï¼Œstart ä¸ºèµ·å§‹ä½ç½®ï¼ˆé»˜è®¤ 0ï¼‰ï¼Œend ä¸ºç»“æŸä½ç½®ï¼ˆä¸åŒ…å«ï¼Œé»˜è®¤å­—ç¬¦ä¸²é•¿åº¦ï¼‰ï¼Œstep ä¸ºæ­¥é•¿ï¼ˆé»˜è®¤ 1ï¼Œè´Ÿæ•°è¡¨ç¤ºåå‘åˆ‡ç‰‡ï¼‰ã€‚</p>
</li>
</ul>
<h4 id="3-ç¼–ç ç‰¹æ€§ï¼ˆç¼–ç å®‰å…¨ï¼‰">&lt;3&gt;ç¼–ç ç‰¹æ€§ï¼ˆç¼–ç å®‰å…¨ï¼‰</h4>
<ul>
<li><strong>UTF-8 ç¼–ç </strong>ï¼šPython 3 ä¸­å­—ç¬¦ä¸²é»˜è®¤é‡‡ç”¨ UTF-8 ç¼–ç ï¼Œæ”¯æŒå…¨çƒç»å¤§å¤šæ•°å­—ç¬¦ï¼ˆä¸­æ–‡ã€è‹±æ–‡ã€ç¬¦å·ç­‰ï¼‰ï¼Œæ— éœ€é¢å¤–å¤„ç†ç¼–ç é—®é¢˜</li>
<li><strong>ä¸å­—èŠ‚æµè½¬æ¢</strong>ï¼šè‹¥éœ€ä¸å­—èŠ‚æµï¼ˆbytesï¼‰è½¬æ¢ï¼Œå¯ä½¿ç”¨ <strong>encode()ï¼ˆå­—ç¬¦ä¸²è½¬å­—èŠ‚æµï¼‰</strong> å’Œ <strong>decode()ï¼ˆå­—èŠ‚æµè½¬å­—ç¬¦ä¸²ï¼‰</strong></li>
</ul>
<h3 id="ï¼ˆ5ï¼‰å­—ç¬¦ä¸²çš„å…³é”®æ³¨æ„äº‹é¡¹">ï¼ˆ5ï¼‰å­—ç¬¦ä¸²çš„å…³é”®æ³¨æ„äº‹é¡¹</h3>
<ul>
<li><strong>ä¸å¯å˜æ€§é¿å‘</strong>ï¼šé¿å…é¢‘ç¹ç”¨ + æ‹¼æ¥å¤§é‡å­—ç¬¦ä¸²ï¼ˆæ¯æ¬¡æ‹¼æ¥éƒ½ä¼šç”Ÿæˆæ–°å¯¹è±¡ï¼Œæ•ˆç‡ä½ï¼‰ï¼Œæ¨èç”¨ str.join() æˆ–åˆ—è¡¨æš‚å­˜å­—ç¬¦åæ‹¼æ¥ï¼š</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä½æ•ˆï¼šé¢‘ç¹ + æ‹¼æ¥</span></span><br><span class="line">s = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">    s += <span class="built_in">str</span>(i)  <span class="comment"># æ¯æ¬¡å¾ªç¯ç”Ÿæˆæ–°å­—ç¬¦ä¸²</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é«˜æ•ˆï¼šç”¨åˆ—è¡¨æš‚å­˜ï¼Œæœ€å join</span></span><br><span class="line">lst = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">    lst.append(<span class="built_in">str</span>(i))</span><br><span class="line">s = <span class="string">&#x27;&#x27;</span>.join(lst)  <span class="comment"># ä»…ç”Ÿæˆ1ä¸ªæ–°å­—ç¬¦ä¸²</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>è½¬ä¹‰å­—ç¬¦çš„ä½¿ç”¨</strong>ï¼šå½“å­—ç¬¦ä¸²ä¸­éœ€è¦åŒ…å«å¼•å·ã€æ¢è¡Œã€åˆ¶è¡¨ç¬¦ç­‰ç‰¹æ®Šå­—ç¬¦æ—¶ï¼Œå¯ä½¿ç”¨è½¬ä¹‰å­—ç¬¦ \ï¼š</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;He said: &quot;I\&#x27;m fine.&quot;&#x27;</span>)  <span class="comment"># He said: &quot;I&#x27;m fine.&quot;ï¼ˆ\è½¬ä¹‰å•å¼•å·ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;ç¬¬ä¸€è¡Œ\nç¬¬äºŒè¡Œ&#x27;</span>)  <span class="comment"># æ¢è¡Œè¾“å‡ºï¼ˆ\nè½¬ä¹‰ä¸ºæ¢è¡Œï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;å§“å\tå¹´é¾„&#x27;</span>)  <span class="comment"># å§“å    å¹´é¾„ï¼ˆ\tè½¬ä¹‰ä¸ºåˆ¶è¡¨ç¬¦ï¼Œç©ºæ ¼å¯¹é½ï¼‰</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>ç©ºå­—ç¬¦ä¸²ä¸ç©ºç™½å­—ç¬¦ä¸²çš„åŒºåˆ«</strong>:ç©ºå­—ç¬¦ä¸²ï¼ˆâ€˜â€™ï¼‰é•¿åº¦ä¸º 0ï¼Œæ— ä»»ä½•å­—ç¬¦ï¼›ç©ºç™½å­—ç¬¦ä¸²ï¼ˆâ€™   'ï¼‰é•¿åº¦ä¸ºç©ºæ ¼ä¸ªæ•°ï¼ŒåŒ…å«ç©ºç™½å­—ç¬¦ï¼š</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(<span class="string">&#x27;&#x27;</span>) == <span class="number">0</span>)    <span class="comment"># Trueï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(<span class="string">&#x27;   &#x27;</span>) == <span class="number">0</span>) <span class="comment"># Falseï¼ˆç©ºç™½å­—ç¬¦ä¸²ï¼Œé•¿åº¦3ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.strip() == <span class="string">&#x27;&#x27;</span>) <span class="comment"># Trueï¼ˆç©ºå­—ç¬¦ä¸²stripåä»ä¸ºç©ºï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;   &#x27;</span>.strip() == <span class="string">&#x27;&#x27;</span>) <span class="comment"># Trueï¼ˆç©ºç™½å­—ç¬¦ä¸²stripåä¸ºç©ºï¼‰</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>å­—ç¬¦ä¸²æ¯”è¾ƒ</strong>ï¼š
<ul>
<li>ç”¨ == æ¯”è¾ƒå­—ç¬¦ä¸²å†…å®¹æ˜¯å¦ç›¸åŒ</li>
<li>ç”¨ is æ¯”è¾ƒæ˜¯å¦ä¸ºåŒä¸€ä¸ªå¯¹è±¡(ä¸å¯å˜ç‰¹æ€§å¯¼è‡´ç›¸åŒå†…å®¹çš„çŸ­å­—ç¬¦ä¸²å¯èƒ½å¤ç”¨å¯¹è±¡ï¼Œä½†ä¸æ¨èç”¨ is æ¯”è¾ƒå†…å®¹ï¼‰</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">s1 = <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">s2 = <span class="string">&#x27;hello&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(s1 == s2)  <span class="comment"># Trueï¼ˆå†…å®¹ç›¸åŒï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(s1 <span class="keyword">is</span> s2)  <span class="comment"># Trueï¼ˆçŸ­å­—ç¬¦ä¸²å¤ç”¨å¯¹è±¡ï¼Œåœ°å€ç›¸åŒï¼‰</span></span><br><span class="line"></span><br><span class="line">s3 = <span class="string">&#x27;hello&#x27;</span> * <span class="number">1000</span></span><br><span class="line">s4 = <span class="string">&#x27;hello&#x27;</span> * <span class="number">1000</span></span><br><span class="line"><span class="built_in">print</span>(s3 == s4)  <span class="comment"># Trueï¼ˆå†…å®¹ç›¸åŒï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(s3 <span class="keyword">is</span> s4)  <span class="comment"># Falseï¼ˆé•¿å­—ç¬¦ä¸²ä¸å¤ç”¨å¯¹è±¡ï¼Œåœ°å€ä¸åŒï¼‰</span></span><br></pre></td></tr></table></figure>
<h2 id="è¡¥å……ï¼šdecimal-æ¨¡å—ï¼ˆç²¾ç¡®æµ®ç‚¹è¿ç®—ï¼‰">è¡¥å……ï¼šdecimal æ¨¡å—ï¼ˆç²¾ç¡®æµ®ç‚¹è¿ç®—ï¼‰</h2>
<h3 id="ï¼ˆ1ï¼‰ä¸ºä»€ä¹ˆéœ€è¦-decimalï¼Ÿ">ï¼ˆ1ï¼‰ä¸ºä»€ä¹ˆéœ€è¦ decimalï¼Ÿ</h3>
<p>Python çš„ float ç±»å‹ä½¿ç”¨äºŒè¿›åˆ¶æµ®ç‚¹æ•°è¡¨ç¤ºï¼Œä¼šäº§ç”Ÿç²¾åº¦ä¸¢å¤±ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç»å…¸çš„æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜</span></span><br><span class="line"><span class="built_in">print</span>(<span class="number">0.1</span> + <span class="number">0.2</span>)          <span class="comment"># è¾“å‡ºï¼š0.30000000000000004ï¼ˆä¸æ˜¯ 0.3ï¼ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="number">0.1</span> + <span class="number">0.2</span> == <span class="number">0.3</span>)   <span class="comment"># è¾“å‡ºï¼šFalse</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç´¯è®¡è¯¯å·®é—®é¢˜</span></span><br><span class="line">total = <span class="number">0.0</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    total += <span class="number">0.1</span></span><br><span class="line"><span class="built_in">print</span>(total)              <span class="comment"># è¾“å‡ºï¼š0.9999999999999999ï¼ˆä¸æ˜¯ 1.0ï¼ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡‘èè®¡ç®—ä¸­çš„ç¾éš¾</span></span><br><span class="line">price = <span class="number">19.99</span></span><br><span class="line">quantity = <span class="number">3</span></span><br><span class="line"><span class="built_in">print</span>(price * quantity)   <span class="comment"># è¾“å‡ºï¼š59.97000000000001ï¼ˆå¤šå‡º 0.00000000000001ï¼‰</span></span><br></pre></td></tr></table></figure>
<p><strong>åŸå› </strong>ï¼š0.1 åœ¨äºŒè¿›åˆ¶ä¸­æ˜¯æ— é™å¾ªç¯å°æ•°ï¼Œæ— æ³•ç²¾ç¡®è¡¨ç¤ºã€‚</p>
<h3 id="ï¼ˆ2ï¼‰decimal-æ¨¡å—åŸºç¡€ç”¨æ³•">ï¼ˆ2ï¼‰decimal æ¨¡å—åŸºç¡€ç”¨æ³•</h3>
<h4 id="1-å¯¼å…¥ä¸åˆ›å»º-Decimal-å¯¹è±¡">&lt;1&gt;å¯¼å…¥ä¸åˆ›å»º Decimal å¯¹è±¡</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal, getcontext</span><br><span class="line"></span><br><span class="line"><span class="comment"># âš ï¸ å…³é”®ï¼šç”¨å­—ç¬¦ä¸²åˆ›å»ºï¼Œé¿å… float çš„ç²¾åº¦é—®é¢˜</span></span><br><span class="line">d1 = Decimal(<span class="string">&quot;0.1&quot;</span>)       <span class="comment"># âœ… æ­£ç¡®ï¼šç²¾ç¡®çš„ 0.1</span></span><br><span class="line">d2 = Decimal(<span class="string">&quot;0.2&quot;</span>)</span><br><span class="line">d3 = Decimal(<span class="number">0.1</span>)         <span class="comment"># âŒ é”™è¯¯ï¼šå·²ç»ä¸¢å¤±ç²¾åº¦</span></span><br><span class="line"><span class="built_in">print</span>(d3)                 <span class="comment"># è¾“å‡ºï¼š0.1000000000000000055511151231257827021181583404541015625</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># éªŒè¯ç²¾åº¦</span></span><br><span class="line"><span class="built_in">print</span>(Decimal(<span class="string">&quot;0.1&quot;</span>) + Decimal(<span class="string">&quot;0.2&quot;</span>))              <span class="comment"># è¾“å‡ºï¼š0.3 âœ…</span></span><br><span class="line"><span class="built_in">print</span>(Decimal(<span class="string">&quot;0.1&quot;</span>) + Decimal(<span class="string">&quot;0.2&quot;</span>) == Decimal(<span class="string">&quot;0.3&quot;</span>))  <span class="comment"># è¾“å‡ºï¼šTrue âœ…</span></span><br></pre></td></tr></table></figure>
<h4 id="2-åŸºæœ¬è¿ç®—">&lt;2&gt;åŸºæœ¬è¿ç®—</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal</span><br><span class="line"></span><br><span class="line">a = Decimal(<span class="string">&quot;10.5&quot;</span>)</span><br><span class="line">b = Decimal(<span class="string">&quot;3&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a + b)    <span class="comment"># è¾“å‡ºï¼š13.5</span></span><br><span class="line"><span class="built_in">print</span>(a - b)    <span class="comment"># è¾“å‡ºï¼š7.5</span></span><br><span class="line"><span class="built_in">print</span>(a * b)    <span class="comment"># è¾“å‡ºï¼š31.5</span></span><br><span class="line"><span class="built_in">print</span>(a / b)    <span class="comment"># è¾“å‡ºï¼š3.5</span></span><br><span class="line"><span class="built_in">print</span>(a // b)   <span class="comment"># è¾“å‡ºï¼š3ï¼ˆæ•´é™¤ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(a % b)    <span class="comment"># è¾“å‡ºï¼š1.5ï¼ˆå–ä½™ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(a ** <span class="number">2</span>)   <span class="comment"># è¾“å‡ºï¼š110.25ï¼ˆå¹‚è¿ç®—ï¼‰</span></span><br></pre></td></tr></table></figure>
<h4 id="3-ç²¾åº¦æ§åˆ¶">&lt;3&gt;ç²¾åº¦æ§åˆ¶</h4>
<h5 id="1ï¼‰å…¨å±€ç²¾åº¦æ§åˆ¶">1ï¼‰å…¨å±€ç²¾åº¦æ§åˆ¶</h5>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal, getcontext</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹é»˜è®¤ç²¾åº¦ï¼ˆ28ä½æœ‰æ•ˆæ•°å­—ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(getcontext().prec)  <span class="comment"># è¾“å‡ºï¼š28</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å…¨å±€ç²¾åº¦ä¸º 6 ä½æœ‰æ•ˆæ•°å­—</span></span><br><span class="line">getcontext().prec = <span class="number">6</span></span><br><span class="line"></span><br><span class="line">result = Decimal(<span class="string">&quot;1&quot;</span>) / Decimal(<span class="string">&quot;7&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)  <span class="comment"># è¾“å‡ºï¼š0.142857ï¼ˆ6ä½æœ‰æ•ˆæ•°å­—ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¢å¤é»˜è®¤ç²¾åº¦</span></span><br><span class="line">getcontext().prec = <span class="number">28</span></span><br></pre></td></tr></table></figure>
<h5 id="2ï¼‰å±€éƒ¨ç²¾åº¦æ§åˆ¶ï¼ˆæ¨èï¼‰">2ï¼‰å±€éƒ¨ç²¾åº¦æ§åˆ¶ï¼ˆæ¨èï¼‰</h5>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal, localcontext</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ localcontext ä¸´æ—¶ä¿®æ”¹ç²¾åº¦ï¼Œä¸å½±å“å…¨å±€è®¾ç½®</span></span><br><span class="line"><span class="keyword">with</span> localcontext() <span class="keyword">as</span> ctx:</span><br><span class="line">    ctx.prec = <span class="number">4</span></span><br><span class="line">    result = Decimal(<span class="string">&quot;1&quot;</span>) / Decimal(<span class="string">&quot;7&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(result)  <span class="comment"># è¾“å‡ºï¼š0.1429</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é€€å‡º with å—åæ¢å¤åŸç²¾åº¦</span></span><br><span class="line">result = Decimal(<span class="string">&quot;1&quot;</span>) / Decimal(<span class="string">&quot;7&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)  <span class="comment"># è¾“å‡ºï¼š0.1428571428571428571428571429ï¼ˆ28ä½ï¼‰</span></span><br></pre></td></tr></table></figure>
<h4 id="4-èˆå…¥æ¨¡å¼">&lt;4&gt;èˆå…¥æ¨¡å¼</h4>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260112103214903.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal, ROUND_HALF_UP, ROUND_DOWN, ROUND_CEILING</span><br><span class="line"></span><br><span class="line">price = Decimal(<span class="string">&quot;19.996&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python çš„ ROUND_HALF_UP æ˜¯&quot;å››èˆäº”å…¥&quot;ï¼Œä½†è¦æ³¨æ„ï¼š</span></span><br><span class="line"><span class="comment"># 0.5 ä¼šå‘è¿œç¦»é›¶çš„æ–¹å‘èˆå…¥ï¼ˆå³æ­£æ•°å‘ä¸Šï¼Œè´Ÿæ•°å‘ä¸‹ï¼‰</span></span><br><span class="line"><span class="comment"># å››èˆäº”å…¥åˆ° 2 ä½å°æ•°ï¼ˆå¸¸ç”¨äºé‡‘èï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(price.quantize(Decimal(<span class="string">&quot;0.01&quot;</span>), rounding=ROUND_HALF_UP))  <span class="comment"># è¾“å‡ºï¼š20.00</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›´æ¥æˆªæ–­ï¼ˆå‘é›¶å–æ•´ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(price.quantize(Decimal(<span class="string">&quot;0.01&quot;</span>), rounding=ROUND_DOWN))     <span class="comment"># è¾“å‡ºï¼š19.99</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘ä¸Šå–æ•´ï¼ˆæ­£æ•°å‘æ­£æ— ç©·ï¼Œè´Ÿæ•°å‘é›¶ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(price.quantize(Decimal(<span class="string">&quot;0.01&quot;</span>), rounding=ROUND_CEILING))  <span class="comment"># è¾“å‡ºï¼š20.00</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è´Ÿæ•°çš„å‘ä¸Šå–æ•´</span></span><br><span class="line">neg_price = Decimal(<span class="string">&quot;-19.996&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(neg_price.quantize(Decimal(<span class="string">&quot;0.01&quot;</span>), rounding=ROUND_CEILING))  <span class="comment"># è¾“å‡ºï¼š-19.99</span></span><br></pre></td></tr></table></figure>
<h4 id="5-Decimal-ä¸å…¶ä»–ç±»å‹çš„è½¬æ¢">&lt;5&gt;Decimal ä¸å…¶ä»–ç±»å‹çš„è½¬æ¢</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal</span><br><span class="line"></span><br><span class="line"><span class="comment"># Decimal â†’ floatï¼ˆå¯èƒ½ä¸¢å¤±ç²¾åº¦ï¼‰</span></span><br><span class="line">d = Decimal(<span class="string">&quot;3.14159265358979323846&quot;</span>)</span><br><span class="line">f = <span class="built_in">float</span>(d)</span><br><span class="line"><span class="built_in">print</span>(f)  <span class="comment"># è¾“å‡ºï¼š3.141592653589793ï¼ˆç²¾åº¦ä¸¢å¤±ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Decimal â†’ intï¼ˆæˆªæ–­å°æ•°éƒ¨åˆ†ï¼‰</span></span><br><span class="line">d = Decimal(<span class="string">&quot;99.99&quot;</span>)</span><br><span class="line">i = <span class="built_in">int</span>(d)</span><br><span class="line"><span class="built_in">print</span>(i)  <span class="comment"># è¾“å‡ºï¼š99</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Decimal â†’ str</span></span><br><span class="line">d = Decimal(<span class="string">&quot;123.45&quot;</span>)</span><br><span class="line">s = <span class="built_in">str</span>(d)</span><br><span class="line"><span class="built_in">print</span>(s)  <span class="comment"># è¾“å‡ºï¼š123.45</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># float â†’ Decimalï¼ˆâš ï¸ ä¸æ¨èï¼Œç²¾åº¦å·²ä¸¢å¤±ï¼‰</span></span><br><span class="line">d = Decimal(<span class="number">0.1</span>)  <span class="comment"># ä¸è¦è¿™æ ·åšï¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># float â†’ Decimalï¼ˆæ­£ç¡®åšæ³•ï¼šå…ˆè½¬å­—ç¬¦ä¸²ï¼‰</span></span><br><span class="line">d = Decimal(<span class="built_in">str</span>(<span class="number">0.1</span>))  <span class="comment"># âœ…</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰æ€§èƒ½å¯¹æ¯”ä¸ä½¿ç”¨å»ºè®®">ï¼ˆ3ï¼‰æ€§èƒ½å¯¹æ¯”ä¸ä½¿ç”¨å»ºè®®</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> timeit</span><br><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ€§èƒ½å¯¹æ¯”</span></span><br><span class="line">float_time = timeit.timeit(<span class="string">&quot;0.1 + 0.2&quot;</span>, number=<span class="number">1000000</span>)</span><br><span class="line">decimal_time = timeit.timeit(</span><br><span class="line">    <span class="string">&quot;Decimal(&#x27;0.1&#x27;) + Decimal(&#x27;0.2&#x27;)&quot;</span>, </span><br><span class="line">    setup=<span class="string">&quot;from decimal import Decimal&quot;</span>,</span><br><span class="line">    number=<span class="number">1000000</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;float è¿ç®—æ—¶é—´ï¼š<span class="subst">&#123;float_time:<span class="number">.4</span>f&#125;</span>s&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Decimal è¿ç®—æ—¶é—´ï¼š<span class="subst">&#123;decimal_time:<span class="number">.4</span>f&#125;</span>s&quot;</span>)</span><br><span class="line"><span class="comment"># Decimal æ¯” float æ…¢çº¦ 10-100 å€</span></span><br></pre></td></tr></table></figure>
<p><strong>ä½¿ç”¨å»ºè®®</strong>ï¼š<br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260112000424733.png" alt=""></p>
<h3 id="ï¼ˆ4ï¼‰å¸¸è§é™·é˜±ä¸é¿å‘">ï¼ˆ4ï¼‰å¸¸è§é™·é˜±ä¸é¿å‘</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal</span><br><span class="line"></span><br><span class="line"><span class="comment"># âŒ é™·é˜±1ï¼šç”¨ float åˆ›å»º Decimal</span></span><br><span class="line">bad = Decimal(<span class="number">0.1</span>)</span><br><span class="line"><span class="built_in">print</span>(bad)  <span class="comment"># 0.1000000000000000055511151231257827...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># âœ… æ­£ç¡®ï¼šç”¨å­—ç¬¦ä¸²åˆ›å»º</span></span><br><span class="line">good = Decimal(<span class="string">&quot;0.1&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(good)  <span class="comment"># 0.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># âŒ é™·é˜±2ï¼šDecimal ä¸ float æ··åˆè¿ç®—</span></span><br><span class="line">d = Decimal(<span class="string">&quot;10.5&quot;</span>)</span><br><span class="line">f = <span class="number">3.0</span></span><br><span class="line"><span class="comment"># result = d + f  # TypeError: unsupported operand type(s)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># âœ… æ­£ç¡®ï¼šç»Ÿä¸€ç±»å‹</span></span><br><span class="line">result = d + Decimal(<span class="built_in">str</span>(f))</span><br><span class="line"><span class="built_in">print</span>(result)  <span class="comment"># 13.5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># âŒ é™·é˜±3ï¼šå¿˜è®°å¤„ç†ç²¾åº¦</span></span><br><span class="line">price = Decimal(<span class="string">&quot;19.99&quot;</span>) * Decimal(<span class="string">&quot;0.1&quot;</span>)  <span class="comment"># æ‰“9æŠ˜</span></span><br><span class="line"><span class="built_in">print</span>(price)  <span class="comment"># 1.999ï¼ˆå¯èƒ½éœ€è¦å››èˆäº”å…¥ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># âœ… æ­£ç¡®ï¼šæ˜ç¡®ç²¾åº¦</span></span><br><span class="line">price = (Decimal(<span class="string">&quot;19.99&quot;</span>) * Decimal(<span class="string">&quot;0.1&quot;</span>)).quantize(Decimal(<span class="string">&quot;0.01&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(price)  <span class="comment"># 2.00</span></span><br></pre></td></tr></table></figure>
<hr>
<h1>äºŒã€åˆ—è¡¨ï¼ˆlistï¼‰</h1>
<h2 id="1-åˆ—è¡¨çš„å®šä¹‰ä¸åŸºç¡€è¡¨ç¤º">1.åˆ—è¡¨çš„å®šä¹‰ä¸åŸºç¡€è¡¨ç¤º</h2>
<h3 id="ï¼ˆ1ï¼‰æ¦‚è¿°">ï¼ˆ1ï¼‰æ¦‚è¿°</h3>
<ul>
<li><strong>Python ä¸­å®šä¹‰åˆ—è¡¨ä½¿ç”¨æ–¹æ‹¬å· [] åŒ…è£¹å…ƒç´ ï¼Œå…ƒç´ ä¹‹é—´ç”¨é€—å· , åˆ†éš”</strong></li>
<li><strong>åˆ—è¡¨æ”¯æŒå­˜å‚¨ä¸åŒç±»å‹çš„å…ƒç´ ï¼Œä¹Ÿæ”¯æŒåµŒå¥—ï¼ˆåˆ—è¡¨å†…éƒ¨åŒ…å«åˆ—è¡¨ï¼‰</strong></li>
<li><strong>list()å‡½æ•°</strong>ï¼šå°†<strong>å¯è¿­ä»£å¯¹è±¡</strong>è½¬æ¢ä¸ºåˆ—è¡¨ï¼Œå¦‚å­—ç¬¦ä¸²ã€å…ƒç»„</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰å¸¸ç”¨åˆ›å»ºæ–¹æ³•">ï¼ˆ2ï¼‰å¸¸ç”¨åˆ›å»ºæ–¹æ³•</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ–¹æ³•1ï¼š åŸºç¡€åˆ—è¡¨å®šä¹‰ï¼ˆä¸åŒç±»å‹å…ƒç´ ï¼‰</span></span><br><span class="line">lst1 = [<span class="number">10</span>, <span class="number">3.14</span>, <span class="string">&quot;Python&quot;</span>, <span class="literal">True</span>]  <span class="comment"># åŒ…å« intã€floatã€strã€bool ç±»å‹</span></span><br><span class="line"><span class="built_in">print</span>(lst1)  <span class="comment"># [10, 3.14, &#x27;Python&#x27;, True]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•2ï¼šç©ºåˆ—è¡¨å®šä¹‰</span></span><br><span class="line">lst2 = []  <span class="comment"># ç©ºåˆ—è¡¨ï¼Œé•¿åº¦ä¸º 0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(lst2))  <span class="comment"># 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•3ï¼šåµŒå¥—åˆ—è¡¨ï¼ˆåˆ—è¡¨å†…éƒ¨åŒ…å«åˆ—è¡¨ï¼‰</span></span><br><span class="line">lst3 = [<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>], [<span class="number">5</span>, [<span class="number">6</span>, <span class="number">7</span>]]]  <span class="comment"># äºŒç»´ã€ä¸‰ç»´åµŒå¥—</span></span><br><span class="line"><span class="built_in">print</span>(lst3)  <span class="comment"># [1, 2, [3, 4], [5, [6, 7]]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•4ï¼šç”¨ list() å‡½æ•°åˆ›å»ºåˆ—è¡¨ï¼ˆå¯è½¬æ¢å¯è¿­ä»£å¯¹è±¡ï¼Œå¦‚å­—ç¬¦ä¸²ã€å…ƒç»„ï¼‰</span></span><br><span class="line">lst4 = <span class="built_in">list</span>(<span class="string">&quot;hello&quot;</span>)  <span class="comment"># å­—ç¬¦ä¸²è½¬åˆ—è¡¨ï¼ˆæ¯ä¸ªå­—ç¬¦ä¸ºå…ƒç´ ï¼‰</span></span><br><span class="line">lst5 = <span class="built_in">list</span>((<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>))  <span class="comment"># å…ƒç»„è½¬åˆ—è¡¨</span></span><br><span class="line"><span class="built_in">print</span>(lst4)  <span class="comment"># [&#x27;h&#x27;, &#x27;e&#x27;, &#x27;l&#x27;, &#x27;l&#x27;, &#x27;o&#x27;]</span></span><br><span class="line"><span class="built_in">print</span>(lst5)  <span class="comment"># [1, 2, 3]</span></span><br></pre></td></tr></table></figure>
<h2 id="2-åˆ—è¡¨çš„æ ¸å¿ƒç‰¹æ€§">2.åˆ—è¡¨çš„æ ¸å¿ƒç‰¹æ€§</h2>
<h3 id="ï¼ˆ1ï¼‰å¯å˜æ€§ï¼ˆæœ€æ ¸å¿ƒç‰¹æ€§ï¼‰">ï¼ˆ1ï¼‰å¯å˜æ€§ï¼ˆæœ€æ ¸å¿ƒç‰¹æ€§ï¼‰</h3>
<ul>
<li><strong>åˆ—è¡¨åˆ›å»ºåï¼Œå¯ç›´æ¥ä¿®æ”¹å…ƒç´ çš„å€¼ã€æ–°å¢å…ƒç´ ã€åˆ é™¤å…ƒç´ ï¼Œæ— éœ€ç”Ÿæˆæ–°åˆ—è¡¨</strong>ï¼ˆä¸å­—ç¬¦ä¸²ã€æ•°å­—ã€bool çš„ä¸å¯å˜æ€§å½¢æˆå¯¹æ¯”ï¼‰ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">lst = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="comment"># 1. ä¿®æ”¹å…ƒç´ ï¼ˆé€šè¿‡ç´¢å¼•èµ‹å€¼ï¼‰</span></span><br><span class="line">lst[<span class="number">0</span>] = <span class="number">10</span>  <span class="comment"># å°†ç¬¬ 0 ä½å…ƒç´ æ”¹ä¸º 10</span></span><br><span class="line"><span class="built_in">print</span>(lst)  <span class="comment"># [10, 2, 3]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. æ–°å¢å…ƒç´ ï¼ˆappend() æ–¹æ³•ï¼‰</span></span><br><span class="line">lst.append(<span class="number">4</span>)  <span class="comment"># åœ¨åˆ—è¡¨æœ«å°¾æ–°å¢å…ƒç´  4</span></span><br><span class="line"><span class="built_in">print</span>(lst)  <span class="comment"># [10, 2, 3, 4]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. åˆ é™¤å…ƒç´ ï¼ˆdel è¯­å¥ï¼‰</span></span><br><span class="line"><span class="keyword">del</span> lst[<span class="number">1</span>]  <span class="comment"># åˆ é™¤ç¬¬ 1 ä½å…ƒç´ ï¼ˆå€¼ä¸º 2ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(lst)  <span class="comment"># [10, 3, 4]</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰æœ‰åºæ€§">ï¼ˆ2ï¼‰æœ‰åºæ€§</h3>
<ul>
<li><strong>åˆ—è¡¨ä¸­çš„å…ƒç´ æŒ‰ã€Œæ’å…¥é¡ºåºã€æ’åˆ—ï¼Œæ”¯æŒé€šè¿‡ã€Œç´¢å¼•ã€ï¼ˆæ­£å‘ã€åå‘ï¼‰è®¿é—®å…ƒç´ ï¼Œä¹Ÿæ”¯æŒåˆ‡ç‰‡æˆªå–å­åˆ—è¡¨</strong>
<ul>
<li><strong>æ­£å‘ç´¢å¼•</strong>ï¼šä» 0 å¼€å§‹ï¼Œä¾æ¬¡é€’å¢ï¼ˆ0 è¡¨ç¤ºç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œ1 è¡¨ç¤ºç¬¬äºŒä¸ªï¼Œä»¥æ­¤ç±»æ¨ï¼‰ï¼›</li>
<li><strong>åå‘ç´¢å¼•</strong>ï¼šä» -1 å¼€å§‹ï¼Œä¾æ¬¡é€’å‡ï¼ˆ-1 è¡¨ç¤ºæœ€åä¸€ä¸ªå…ƒç´ ï¼Œ-2 è¡¨ç¤ºå€’æ•°ç¬¬äºŒä¸ªï¼Œä»¥æ­¤ç±»æ¨ï¼‰ï¼›</li>
<li><strong>åˆ‡ç‰‡</strong>ï¼šè¯­æ³•ä¸ºlst[start:end:step]ï¼Œstart èµ·å§‹ä½ç½®ï¼ˆé»˜è®¤ 0ï¼‰ï¼Œend ç»“æŸä½ç½®ï¼ˆä¸åŒ…å«ï¼Œé»˜è®¤åˆ—è¡¨é•¿åº¦ï¼‰ï¼Œstep æ­¥é•¿ï¼ˆé»˜è®¤ 1ï¼Œè´Ÿæ•°è¡¨ç¤ºåå‘åˆ‡ç‰‡ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">lst = [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;e&quot;</span>]</span><br><span class="line"><span class="comment"># 1. æ­£å‘ç´¢å¼•è®¿é—®</span></span><br><span class="line"><span class="built_in">print</span>(lst[<span class="number">0</span>])  <span class="comment"># &#x27;a&#x27;ï¼ˆç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(lst[<span class="number">2</span>])  <span class="comment"># &#x27;c&#x27;ï¼ˆç¬¬ä¸‰ä¸ªå…ƒç´ ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. åå‘ç´¢å¼•è®¿é—®</span></span><br><span class="line"><span class="built_in">print</span>(lst[-<span class="number">1</span>])  <span class="comment"># &#x27;e&#x27;ï¼ˆæœ€åä¸€ä¸ªå…ƒç´ ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(lst[-<span class="number">3</span>])  <span class="comment"># &#x27;c&#x27;ï¼ˆå€’æ•°ç¬¬ä¸‰ä¸ªå…ƒç´ ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. åˆ‡ç‰‡æ“ä½œ</span></span><br><span class="line"><span class="built_in">print</span>(lst[<span class="number">1</span>:<span class="number">4</span>])  <span class="comment"># [&#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;]ï¼ˆä»ç¬¬1ä½åˆ°ç¬¬3ä½ï¼Œä¸åŒ…å«ç¬¬4ä½ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(lst[:<span class="number">3</span>])   <span class="comment"># [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;]ï¼ˆä»å¼€å¤´åˆ°ç¬¬2ä½ï¼Œä¸åŒ…å«ç¬¬3ä½ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(lst[<span class="number">2</span>:])   <span class="comment"># [&#x27;c&#x27;, &#x27;d&#x27;, &#x27;e&#x27;]ï¼ˆä»ç¬¬2ä½åˆ°æœ«å°¾ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(lst[::<span class="number">2</span>])  <span class="comment"># [&#x27;a&#x27;, &#x27;c&#x27;, &#x27;e&#x27;]ï¼ˆæ­¥é•¿2ï¼Œæ¯éš”1ä¸ªå…ƒç´ å–1ä¸ªï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(lst[::-<span class="number">1</span>]) <span class="comment"># [&#x27;e&#x27;, &#x27;d&#x27;, &#x27;c&#x27;, &#x27;b&#x27;, &#x27;a&#x27;]ï¼ˆåå‘åˆ‡ç‰‡ï¼Œå€’åºè¾“å‡ºï¼‰</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰å…ƒç´ ç±»å‹æ— é™åˆ¶">ï¼ˆ3ï¼‰å…ƒç´ ç±»å‹æ— é™åˆ¶</h3>
<ul>
<li><strong>åˆ—è¡¨å¯å­˜å‚¨ä»»æ„ç±»å‹çš„å…ƒç´ ï¼ŒåŒ…æ‹¬æ•°å­—ã€å­—ç¬¦ä¸²ã€åˆ—è¡¨ã€å­—å…¸ç­‰ï¼Œç”šè‡³å¯ä»¥æ··åˆå­˜å‚¨ä¸åŒç±»å‹ã€‚</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">lst = [<span class="number">100</span>, <span class="string">&quot;hello&quot;</span>, [<span class="number">1</span>,<span class="number">2</span>], &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;å°æ˜&quot;</span>&#125;, <span class="literal">None</span>]</span><br><span class="line"><span class="built_in">print</span>(lst)  <span class="comment"># [100, &#x27;hello&#x27;, [1, 2], &#123;&#x27;name&#x27;: &#x27;å°æ˜&#x27;&#125;, None]</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ4ï¼‰ä¸å¯å“ˆå¸Œæ€§">ï¼ˆ4ï¼‰ä¸å¯å“ˆå¸Œæ€§</h3>
<p><strong>ç”±äºåˆ—è¡¨æ˜¯å¯å˜å¯¹è±¡ï¼Œå› æ­¤å®ƒæ˜¯ã€Œä¸å¯å“ˆå¸Œã€çš„ï¼Œæ— æ³•ä½œä¸ºå­—å…¸çš„é”®ï¼ˆkeyï¼‰ï¼Œä¹Ÿæ— æ³•æ”¾å…¥é›†åˆï¼ˆsetï¼‰ä¸­ï¼ˆé›†åˆå…ƒç´ éœ€å¯å“ˆå¸Œï¼‰ã€‚</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ—è¡¨ä½œä¸ºå­—å…¸é”®ï¼ˆæŠ¥é”™ï¼‰</span></span><br><span class="line"><span class="comment"># dict1 = &#123;[1,2]: &quot;error&quot;&#125;  # TypeError: unhashable type: &#x27;list&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—è¡¨æ”¾å…¥é›†åˆï¼ˆæŠ¥é”™ï¼‰</span></span><br><span class="line"><span class="comment"># set1 = &#123;[1,2], [3,4]&#125;  # TypeError: unhashable type: &#x27;list&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="3-åˆ—è¡¨çš„å¸¸ç”¨æ“ä½œ">3.åˆ—è¡¨çš„å¸¸ç”¨æ“ä½œ</h2>
<h3 id="ï¼ˆ1ï¼‰å…ƒç´ çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥">ï¼ˆ1ï¼‰å…ƒç´ çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥</h3>
<ul>
<li><strong>æŸ¥ï¼ˆè®¿é—®å…ƒç´ ï¼‰</strong>ï¼šé€šè¿‡ç´¢å¼•æˆ–åˆ‡ç‰‡è®¿é—®ï¼Œè‹¥ç´¢å¼•è¶…å‡ºèŒƒå›´ä¼šæŠ¥é”™ï¼ˆIndexErrorï¼‰ï¼›</li>
<li><strong>æ”¹ï¼ˆä¿®æ”¹å…ƒç´ ï¼‰</strong>ï¼šé€šè¿‡ç´¢å¼•èµ‹å€¼ä¿®æ”¹ï¼Œæ”¯æŒæ‰¹é‡ä¿®æ”¹ï¼ˆåˆ‡ç‰‡èµ‹å€¼ï¼‰ï¼›</li>
<li><strong>å¢ï¼ˆæ–°å¢å…ƒç´ ï¼‰</strong>ï¼š
<ul>
<li><strong>append()</strong>ï¼šæœ«å°¾æ–°å¢</li>
<li><strong>insert()</strong>ï¼šæŒ‡å®šä½ç½®æ–°å¢</li>
<li><strong>extend()</strong>ï¼šåˆå¹¶å¦ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡</li>
</ul>
</li>
<li><strong>åˆ ï¼ˆåˆ é™¤å…ƒç´ ï¼‰</strong>ï¼š
<ul>
<li><strong>del</strong>ï¼šæŒ‰ç´¢å¼•åˆ é™¤</li>
<li><strong>remove()</strong>ï¼šæŒ‰å€¼åˆ é™¤ï¼Œåˆ é™¤ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹</li>
<li><strong>pop()</strong>ï¼šæŒ‰ç´¢å¼•åˆ é™¤å¹¶è¿”å›å…ƒç´ ï¼Œé»˜è®¤åˆ é™¤æœ«å°¾</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æ³¨ï¼šåˆ‡ç‰‡æ˜¯â€œå·¦é—­å³å¼€â€</span></span><br><span class="line"></span><br><span class="line">lst = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="comment"># 1. æŸ¥</span></span><br><span class="line"><span class="built_in">print</span>(lst[<span class="number">1</span>])  <span class="comment"># 2ï¼ˆç´¢å¼•è®¿é—®ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(lst[<span class="number">0</span>:<span class="number">2</span>])  <span class="comment"># [1, 2]ï¼ˆåˆ‡ç‰‡è®¿é—®ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. æ”¹</span></span><br><span class="line">lst[<span class="number">2</span>] = <span class="number">30</span>  <span class="comment"># å•ä¸ªå…ƒç´ ä¿®æ”¹</span></span><br><span class="line"><span class="built_in">print</span>(lst)  <span class="comment"># [1, 2, 30]</span></span><br><span class="line">lst[<span class="number">0</span>:<span class="number">2</span>] = [<span class="number">10</span>, <span class="number">20</span>]  <span class="comment"># æ‰¹é‡ä¿®æ”¹ï¼ˆåˆ‡ç‰‡èµ‹å€¼ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(lst)  <span class="comment"># [10, 20, 30]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. å¢</span></span><br><span class="line">lst.append(<span class="number">40</span>)  <span class="comment"># æœ«å°¾æ–°å¢</span></span><br><span class="line"><span class="built_in">print</span>(lst)  <span class="comment"># [10, 20, 30, 40]</span></span><br><span class="line">lst.insert(<span class="number">1</span>, <span class="number">15</span>)  <span class="comment"># åœ¨ç¬¬1ä½æ’å…¥ 15</span></span><br><span class="line"><span class="built_in">print</span>(lst)  <span class="comment"># [10, 15, 20, 30, 40]</span></span><br><span class="line">lst.extend([<span class="number">50</span>, <span class="number">60</span>])  <span class="comment"># åˆå¹¶åˆ—è¡¨ [50,60]</span></span><br><span class="line"><span class="built_in">print</span>(lst)  <span class="comment"># [10, 15, 20, 30, 40, 50, 60]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. åˆ </span></span><br><span class="line"><span class="keyword">del</span> lst[<span class="number">1</span>]  <span class="comment"># æŒ‰ç´¢å¼•åˆ é™¤ç¬¬1ä½ï¼ˆ15ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(lst)  <span class="comment"># [10, 20, 30, 40, 50, 60]</span></span><br><span class="line">lst.remove(<span class="number">30</span>)  <span class="comment"># æŒ‰å€¼åˆ é™¤ 30ï¼ˆç¬¬ä¸€ä¸ªåŒ¹é…é¡¹ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(lst)  <span class="comment"># [10, 20, 40, 50, 60]</span></span><br><span class="line">pop_val = lst.pop()  <span class="comment"># é»˜è®¤åˆ é™¤æœ«å°¾å…ƒç´ ï¼Œè¿”å›åˆ é™¤çš„å€¼</span></span><br><span class="line"><span class="built_in">print</span>(pop_val)  <span class="comment"># 60</span></span><br><span class="line"><span class="built_in">print</span>(lst)  <span class="comment"># [10, 20, 40, 50]</span></span><br><span class="line">pop_val2 = lst.pop(<span class="number">0</span>)  <span class="comment"># åˆ é™¤ç¬¬0ä½å…ƒç´ ï¼Œè¿”å›å€¼</span></span><br><span class="line"><span class="built_in">print</span>(pop_val2)  <span class="comment"># 10</span></span><br><span class="line"><span class="built_in">print</span>(lst)  <span class="comment"># [20, 40, 50]</span></span><br></pre></td></tr></table></figure>
<p><strong>è¡¥å……ï¼šåˆ‡ç‰‡èµ‹å€¼çš„é•¿åº¦å¯ä»¥ä¸ä¸€è‡´</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">lst = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">lst[<span class="number">1</span>:<span class="number">3</span>] = [<span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>]  <span class="comment"># ç”¨4ä¸ªå…ƒç´ æ›¿æ¢2ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="built_in">print</span>(lst)  <span class="comment"># [1, 20, 30, 40, 50, 4, 5]</span></span><br><span class="line"></span><br><span class="line">lst[<span class="number">1</span>:<span class="number">5</span>] = [<span class="number">100</span>]  <span class="comment"># ç”¨1ä¸ªå…ƒç´ æ›¿æ¢4ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="built_in">print</span>(lst)  <span class="comment"># [1, 100, 4, 5]</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰åˆ—è¡¨çš„æ‹¼æ¥ä¸é‡å¤">ï¼ˆ2ï¼‰åˆ—è¡¨çš„æ‹¼æ¥ä¸é‡å¤</h3>
<ul>
<li><strong>+</strong>ï¼šæ‹¼æ¥ä¸¤ä¸ªåˆ—è¡¨</li>
<li><strong>*</strong>ï¼šå°†åˆ—è¡¨å…ƒç´ é‡å¤æŒ‡å®šæ¬¡æ•°</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">lst1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">lst2 = [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. æ‹¼æ¥ï¼ˆ+ï¼‰</span></span><br><span class="line">lst3 = lst1 + lst2</span><br><span class="line"><span class="built_in">print</span>(lst3)  <span class="comment"># [1, 2, 3, 4, 5, 6]</span></span><br><span class="line"><span class="built_in">print</span>(lst1)  <span class="comment"># [1, 2, 3]ï¼ˆåŸåˆ—è¡¨æœªä¿®æ”¹ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. é‡å¤ï¼ˆ*ï¼‰</span></span><br><span class="line">lst4 = lst1 * <span class="number">3</span></span><br><span class="line"><span class="built_in">print</span>(lst4)  <span class="comment"># [1, 2, 3, 1, 2, 3, 1, 2, 3]</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰æˆå‘˜åˆ¤æ–­ï¼ˆin-not-inï¼‰">ï¼ˆ3ï¼‰æˆå‘˜åˆ¤æ–­ï¼ˆin / not inï¼‰</h3>
<ul>
<li><strong>ç”¨ in åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨åˆ—è¡¨ä¸­ï¼Œnot in åˆ¤æ–­å…ƒç´ æ˜¯å¦ä¸åœ¨åˆ—è¡¨ä¸­ï¼Œè¿”å›å¸ƒå°”å€¼</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">lst = [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="string">&quot;hello&quot;</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="number">20</span> <span class="keyword">in</span> lst)  <span class="comment"># Trueï¼ˆå…ƒç´ å­˜åœ¨ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="number">40</span> <span class="keyword">in</span> lst)  <span class="comment"># Falseï¼ˆå…ƒç´ ä¸å­˜åœ¨ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;hello&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> lst)  <span class="comment"># Falseï¼ˆå…ƒç´ å­˜åœ¨ï¼Œnot in è¿”å› Falseï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;world&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> lst)  <span class="comment"># Trueï¼ˆå…ƒç´ ä¸å­˜åœ¨ï¼‰</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ4ï¼‰åˆ—è¡¨çš„æ’åºä¸åè½¬">ï¼ˆ4ï¼‰åˆ—è¡¨çš„æ’åºä¸åè½¬</h3>
<ul>
<li><strong>sort()</strong>ï¼šå¯¹åˆ—è¡¨è¿›è¡Œæ’åºï¼Œé»˜è®¤å‡åº</li>
<li><strong>reverse()</strong>ï¼šåè½¬åˆ—è¡¨</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">lst = [<span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>]</span><br><span class="line"><span class="comment"># 1. sort() æ’åºï¼ˆé»˜è®¤å‡åºï¼Œä¿®æ”¹åŸåˆ—è¡¨ï¼‰</span></span><br><span class="line">lst.sort()</span><br><span class="line"><span class="built_in">print</span>(lst)  <span class="comment"># [1, 2, 3, 4, 5]</span></span><br><span class="line"><span class="comment"># é™åºæ’åº</span></span><br><span class="line">lst.sort(reverse=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(lst)  <span class="comment"># [5, 4, 3, 2, 1]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. reverse() åè½¬ï¼ˆä¿®æ”¹åŸåˆ—è¡¨ï¼‰</span></span><br><span class="line"><span class="comment"># å½“å‰ lst ä¸º [5, 4, 3, 2, 1]ï¼Œåè½¬åå˜ä¸º [1, 2, 3, 4, 5]</span></span><br><span class="line">lst.reverse()</span><br><span class="line"><span class="built_in">print</span>(lst)  <span class="comment"># [1, 2, 3, 4, 5]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="4-åˆ—è¡¨å¸¸ç”¨å†…ç½®å‡½æ•°ä¸æ–¹æ³•">4.åˆ—è¡¨å¸¸ç”¨å†…ç½®å‡½æ•°ä¸æ–¹æ³•</h2>
<h3 id="ï¼ˆ1ï¼‰å†…ç½®å‡½æ•°ï¼ˆå…¨å±€å‡½æ•°ï¼Œç›´æ¥è°ƒç”¨ï¼‰">ï¼ˆ1ï¼‰å†…ç½®å‡½æ•°ï¼ˆå…¨å±€å‡½æ•°ï¼Œç›´æ¥è°ƒç”¨ï¼‰</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109232134158.png" alt=""></p>
<h3 id="ï¼ˆ2ï¼‰åˆ—è¡¨å¯¹è±¡æ–¹æ³•ï¼ˆlist-æ–¹æ³•å-ï¼‰">ï¼ˆ2ï¼‰åˆ—è¡¨å¯¹è±¡æ–¹æ³•ï¼ˆlist.æ–¹æ³•å()ï¼‰</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109233311166.png" alt=""></p>
<h2 id="5-æ“ä½œåˆ—è¡¨">5.æ“ä½œåˆ—è¡¨</h2>
<h3 id="ï¼ˆ1ï¼‰åˆ—è¡¨çš„åˆ›å»º">ï¼ˆ1ï¼‰åˆ—è¡¨çš„åˆ›å»º</h3>
<h4 id="1-ç›´æ¥ç”¨æ–¹æ‹¬å·å®šä¹‰ï¼ˆæœ€åŸºç¡€å¸¸ç”¨ï¼‰">&lt;1&gt;ç›´æ¥ç”¨æ–¹æ‹¬å·å®šä¹‰ï¼ˆæœ€åŸºç¡€å¸¸ç”¨ï¼‰</h4>
<ul>
<li><strong>ç”¨ [] åŒ…è£¹å…ƒç´ ï¼Œå…ƒç´ é—´ç”¨é€—å·åˆ†éš”ï¼Œæ”¯æŒæ··åˆç±»å‹å…ƒç´ å’ŒåµŒå¥—åˆ—è¡¨</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ··åˆç±»å‹åˆ—è¡¨</span></span><br><span class="line">lst1 = [<span class="number">10</span>, <span class="number">3.14</span>, <span class="string">&quot;Python&quot;</span>, <span class="literal">True</span>]</span><br><span class="line"><span class="built_in">print</span>(lst1)  <span class="comment"># è¾“å‡ºï¼š[10, 3.14, &#x27;Python&#x27;, True]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åµŒå¥—åˆ—è¡¨</span></span><br><span class="line">lst_nest = [<span class="number">1</span>, [<span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, [<span class="number">5</span>, <span class="number">6</span>]]]</span><br><span class="line"><span class="built_in">print</span>(lst_nest)  <span class="comment"># è¾“å‡ºï¼š[1, [2, 3], [4, [5, 6]]]</span></span><br></pre></td></tr></table></figure>
<h4 id="2-åˆ›å»ºç©ºåˆ—è¡¨ï¼ˆåŠ¨æ€æ·»åŠ å…ƒç´ åœºæ™¯ï¼‰">&lt;2&gt;åˆ›å»ºç©ºåˆ—è¡¨ï¼ˆåŠ¨æ€æ·»åŠ å…ƒç´ åœºæ™¯ï¼‰</h4>
<ul>
<li><strong>ç›´æ¥å†™ []ï¼Œåç»­é€šè¿‡ append()ã€extend() ç­‰æ–¹æ³•åŠ¨æ€æ·»åŠ å…ƒç´ </strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºç©ºåˆ—è¡¨</span></span><br><span class="line">lst2 = []</span><br><span class="line"><span class="comment"># åŠ¨æ€æ·»åŠ å•ä¸ªå…ƒç´ </span></span><br><span class="line">lst2.append(<span class="string">&quot;test&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(lst2)  <span class="comment"># è¾“å‡ºï¼š[&#x27;test&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»§ç»­åŠ¨æ€æ·»åŠ å¤šä¸ªå…ƒç´ </span></span><br><span class="line">lst2.extend([<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>])</span><br><span class="line"><span class="built_in">print</span>(lst2)  <span class="comment"># è¾“å‡ºï¼š[&#x27;test&#x27;, &#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;]</span></span><br></pre></td></tr></table></figure>
<h4 id="3-åˆ›å»ºæ•°å€¼åˆ—è¡¨ï¼ˆrange-ï¼‰">&lt;3&gt;åˆ›å»ºæ•°å€¼åˆ—è¡¨ï¼ˆrange()ï¼‰</h4>
<h5 id="1-ä½¿ç”¨rangeå‡½æ•°">1.ä½¿ç”¨rangeå‡½æ•°</h5>
<ul>
<li><strong>range(start, stop, step)èƒ½å¤Ÿè½»æ¾åœ°ç”Ÿæˆä¸€ç³»åˆ—çš„æ•°å­—ï¼ˆâ€œå·¦é—­å³å¼€åŒºé—´â€,stepï¼šæ­¥é•¿ï¼‰</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">3</span>):</span><br><span class="line">    <span class="built_in">print</span>(value)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">è¾“å‡ºï¼š</span></span><br><span class="line"><span class="string"> 1</span></span><br><span class="line"><span class="string"> 2</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<h5 id="2-ä½¿ç”¨range-åˆ›å»ºæ•°å­—åˆ—è¡¨">2.ä½¿ç”¨range()åˆ›å»ºæ•°å­—åˆ—è¡¨</h5>
<ul>
<li><strong>æ ¸å¿ƒè¯­æ³•ï¼šlist(range(start, stop, step))ï¼ˆstart é»˜è®¤ 0ï¼Œstep é»˜è®¤ 1ï¼‰</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¯­æ³•ï¼šlist(range(stop))</span></span><br><span class="line"><span class="comment"># ç”Ÿæˆï¼š0 ~ stop-1 çš„æ•´æ•°åˆ—è¡¨</span></span><br><span class="line">num_list1 = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">6</span>))</span><br><span class="line"><span class="built_in">print</span>(num_list1)  <span class="comment"># è¾“å‡ºï¼š[0, 1, 2, 3, 4, 5]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯­æ³•ï¼šlist(range(start, stop))</span></span><br><span class="line"><span class="comment"># ç”Ÿæˆï¼šstart ~ stop-1 çš„æ•´æ•°åˆ—è¡¨ï¼ˆå·¦é—­å³å¼€ï¼‰</span></span><br><span class="line">num_list2 = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">3</span>, <span class="number">9</span>))</span><br><span class="line"><span class="built_in">print</span>(num_list2)  <span class="comment"># è¾“å‡ºï¼š[3, 4, 5, 6, 7, 8]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯­æ³•ï¼šlist(range(start, stop, step))</span></span><br><span class="line"><span class="comment"># ç”Ÿæˆï¼šä» start å¼€å§‹ï¼Œæ¯æ¬¡åŠ  stepï¼Œç›´åˆ°ä¸è¶…è¿‡ stopï¼ˆå·¦é—­å³å¼€ï¼‰</span></span><br><span class="line"><span class="comment"># ç¤ºä¾‹1ï¼šç”Ÿæˆå¥‡æ•°åˆ—è¡¨ï¼ˆ1-9ï¼‰</span></span><br><span class="line">odd_nums = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>, <span class="number">2</span>))</span><br><span class="line"><span class="built_in">print</span>(odd_nums)  <span class="comment"># [1, 3, 5, 7, 9]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹2ï¼šç”Ÿæˆå¶æ•°åˆ—è¡¨ï¼ˆ0-10ï¼‰</span></span><br><span class="line">even_nums = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">0</span>, <span class="number">11</span>, <span class="number">2</span>))</span><br><span class="line"><span class="built_in">print</span>(even_nums)  <span class="comment"># [0, 2, 4, 6, 8, 10]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹3ï¼šç”Ÿæˆé€’å‡æ•°å€¼åˆ—è¡¨ï¼ˆæ­¥é•¿ä¸ºè´Ÿï¼‰</span></span><br><span class="line">desc_nums = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">10</span>, <span class="number">0</span>, -<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(desc_nums)  <span class="comment"># [10, 9, 8, 7, 6, 5, 4, 3, 2, 1]</span></span><br></pre></td></tr></table></figure>
<h4 id="4-list-å‡½æ•°è½¬æ¢ï¼ˆå¯è¿­ä»£å¯¹è±¡è½¬åˆ—è¡¨ï¼‰">&lt;4&gt;list()å‡½æ•°è½¬æ¢ï¼ˆå¯è¿­ä»£å¯¹è±¡è½¬åˆ—è¡¨ï¼‰</h4>
<ul>
<li><strong>å°†å­—ç¬¦ä¸²ã€å…ƒç»„ã€rangeå¯¹è±¡ç­‰å¯è¿­ä»£å¯¹è±¡è½¬æ¢ä¸ºåˆ—è¡¨</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å­—ç¬¦ä¸²è½¬åˆ—è¡¨ï¼ˆæ¯ä¸ªå­—ç¬¦ä¸ºå…ƒç´ ï¼‰</span></span><br><span class="line">str_to_lst = <span class="built_in">list</span>(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(str_to_lst)  <span class="comment"># è¾“å‡ºï¼š[&#x27;h&#x27;, &#x27;e&#x27;, &#x27;l&#x27;, &#x27;l&#x27;, &#x27;o&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…ƒç»„è½¬åˆ—è¡¨</span></span><br><span class="line">tuple_to_lst = <span class="built_in">list</span>((<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>))</span><br><span class="line"><span class="built_in">print</span>(tuple_to_lst)  <span class="comment"># è¾“å‡ºï¼š[1, 2, 3]</span></span><br></pre></td></tr></table></figure>
<h4 id="5-åˆ—è¡¨æ¨å¯¼å¼ï¼ˆé«˜æ•ˆç”Ÿæˆæœ‰è§„å¾‹åˆ—è¡¨ï¼‰">&lt;5&gt;åˆ—è¡¨æ¨å¯¼å¼ï¼ˆé«˜æ•ˆç”Ÿæˆæœ‰è§„å¾‹åˆ—è¡¨ï¼‰</h4>
<ul>
<li><strong>æ ¸å¿ƒè¯­æ³•ï¼š[è¡¨è¾¾å¼ for å˜é‡ in å¯è¿­ä»£å¯¹è±¡ if æ¡ä»¶]ï¼ˆæ¡ä»¶å¯é€‰ï¼‰</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿæˆ0-9çš„å¶æ•°åˆ—è¡¨ï¼ˆå¸¦æ¡ä»¶åˆ¤æ–­ï¼‰</span></span><br><span class="line">even_lst = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>) <span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(even_lst)  <span class="comment"># è¾“å‡ºï¼š[0, 2, 4, 6, 8]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹å·²æœ‰åˆ—è¡¨å…ƒç´ åŠ å·¥ï¼ˆæ— æ¡ä»¶åˆ¤æ–­ï¼‰</span></span><br><span class="line">processed_lst = [x*<span class="number">3</span> <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]]</span><br><span class="line"><span class="built_in">print</span>(processed_lst)  <span class="comment"># è¾“å‡ºï¼š[3, 6, 9]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åµŒå¥—åˆ—è¡¨æ¨å¯¼å¼ï¼ˆç”ŸæˆäºŒç»´åˆ—è¡¨ï¼‰</span></span><br><span class="line">two_dimensional_lst = [[i*j <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)]</span><br><span class="line"><span class="built_in">print</span>(two_dimensional_lst)  <span class="comment"># è¾“å‡ºï¼š[[0, 0, 0], [0, 1, 2]]</span></span><br></pre></td></tr></table></figure>
<h2 id="6-åˆ—è¡¨çš„éå†ï¼ˆforå¾ªç¯ï¼‰">6.åˆ—è¡¨çš„éå†ï¼ˆforå¾ªç¯ï¼‰</h2>
<h3 id="ï¼ˆ1ï¼‰åŸºç¡€forå¾ªç¯éå†ï¼ˆç›´æ¥éå†å…ƒç´ ï¼‰">ï¼ˆ1ï¼‰åŸºç¡€forå¾ªç¯éå†ï¼ˆç›´æ¥éå†å…ƒç´ ï¼‰</h3>
<ul>
<li><strong>æœ€å¸¸ç”¨çš„éå†æ–¹å¼ï¼Œç›´æ¥è¿­ä»£åˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œæ— éœ€å…³å¿ƒç´¢å¼•ï¼Œè¯­æ³•ç®€æ´é«˜æ•ˆï¼Œé€‚åˆä»…éœ€ä½¿ç”¨å…ƒç´ å€¼çš„åœºæ™¯ã€‚</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">lst = [<span class="string">&quot;è‹¹æœ&quot;</span>, <span class="string">&quot;é¦™è•‰&quot;</span>, <span class="string">&quot;æ©™å­&quot;</span>]</span><br><span class="line"><span class="comment"># åŸºç¡€éå†ï¼šç›´æ¥å–å…ƒç´ </span></span><br><span class="line"><span class="keyword">for</span> fruit <span class="keyword">in</span> lst:</span><br><span class="line">    <span class="built_in">print</span>(fruit)</span><br><span class="line"></span><br><span class="line"><span class="comment"># éå†æ··åˆç±»å‹åˆ—è¡¨</span></span><br><span class="line">mix_lst = [<span class="number">10</span>, <span class="number">3.14</span>, <span class="string">&quot;Python&quot;</span>]</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> mix_lst:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å…ƒç´ å€¼ï¼š<span class="subst">&#123;item&#125;</span>ï¼Œå…ƒç´ ç±»å‹ï¼š<span class="subst">&#123;<span class="built_in">type</span>(item)&#125;</span>&quot;</span>)</span><br><span class="line"><span class="comment"># è¾“å‡ºç»“æœï¼š</span></span><br><span class="line"><span class="comment"># å…ƒç´ å€¼ï¼š10ï¼Œå…ƒç´ ç±»å‹ï¼š&lt;class &#x27;int&#x27;&gt;</span></span><br><span class="line"><span class="comment"># å…ƒç´ å€¼ï¼š3.14ï¼Œå…ƒç´ ç±»å‹ï¼š&lt;class &#x27;float&#x27;&gt;</span></span><br><span class="line"><span class="comment"># å…ƒç´ å€¼ï¼šPythonï¼Œå…ƒç´ ç±»å‹ï¼š&lt;class &#x27;str&#x27;&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰å¸¦ç´¢å¼•çš„forå¾ªç¯éå†ï¼ˆenumerateå‡½æ•°ï¼‰">ï¼ˆ2ï¼‰å¸¦ç´¢å¼•çš„forå¾ªç¯éå†ï¼ˆenumerateå‡½æ•°ï¼‰</h3>
<ul>
<li><strong>å½“éœ€è¦åŒæ—¶è·å–å…ƒç´ çš„ã€Œç´¢å¼•ã€å’Œã€Œå€¼ã€æ—¶ï¼Œä½¿ç”¨ enumerate() å‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›å…ƒç»„ (ç´¢å¼•, å…ƒç´ å€¼)ï¼Œé»˜è®¤ç´¢å¼•ä»0å¼€å§‹ï¼Œä¹Ÿå¯æŒ‡å®šèµ·å§‹ç´¢å¼•ã€‚</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">lst = [<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>, <span class="string">&quot;D&quot;</span>]</span><br><span class="line"><span class="comment"># é»˜è®¤ç´¢å¼•ä»0å¼€å§‹</span></span><br><span class="line"><span class="keyword">for</span> idx, val <span class="keyword">in</span> <span class="built_in">enumerate</span>(lst):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ç´¢å¼•ï¼š<span class="subst">&#123;idx&#125;</span>ï¼Œå…ƒç´ ï¼š<span class="subst">&#123;val&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šç´¢å¼•ä»1å¼€å§‹</span></span><br><span class="line"><span class="keyword">for</span> idx, val <span class="keyword">in</span> <span class="built_in">enumerate</span>(lst, start=<span class="number">1</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;åºå·ï¼š<span class="subst">&#123;idx&#125;</span>ï¼Œå…ƒç´ ï¼š<span class="subst">&#123;val&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰åˆ‡ç‰‡éå†ï¼ˆéå†å­åˆ—è¡¨ï¼‰">ï¼ˆ3ï¼‰åˆ‡ç‰‡éå†ï¼ˆéå†å­åˆ—è¡¨ï¼‰</h3>
<p><strong>é€šè¿‡åˆ‡ç‰‡è·å–åˆ—è¡¨çš„å­åˆ—è¡¨åï¼Œå†ç”¨forå¾ªç¯éå†ï¼Œé€‚åˆä»…éœ€è¦éå†åˆ—è¡¨ä¸­éƒ¨åˆ†å…ƒç´ çš„åœºæ™¯ï¼ˆå¦‚å‰3ä¸ªå…ƒç´ ã€é—´éš”å…ƒç´ ã€å€’åºå…ƒç´ ç­‰ï¼‰</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">lst = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line"><span class="comment"># 1. éå†å‰5ä¸ªå…ƒç´ ï¼ˆåˆ‡ç‰‡ï¼šlst[:5]ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å‰5ä¸ªå…ƒç´ ï¼š&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> lst[:<span class="number">5</span>]:</span><br><span class="line">    <span class="built_in">print</span>(num, end=<span class="string">&quot; &quot;</span>)</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼šå‰5ä¸ªå…ƒç´ ï¼š0 1 2 3 4  (æ³¨ï¼šåº”è¯¥æ¢è¡Œï¼Œè¿™é‡Œä¸ºäº†èŠ‚çœç¯‡å¹…å°±ä¸æ¢äº†)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. éå†ç´¢å¼•2åˆ°7çš„å…ƒç´ ï¼ˆä¸åŒ…å«7ï¼Œåˆ‡ç‰‡ï¼šlst[2:7]ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nç´¢å¼•2-6çš„å…ƒç´ ï¼š&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> lst[<span class="number">2</span>:<span class="number">7</span>]:</span><br><span class="line">    <span class="built_in">print</span>(num, end=<span class="string">&quot; &quot;</span>)</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼šç´¢å¼•2-6çš„å…ƒç´ ï¼š2 3 4 5 6  (æ³¨ï¼šåº”è¯¥æ¢è¡Œï¼Œè¿™é‡Œä¸ºäº†èŠ‚çœç¯‡å¹…å°±ä¸æ¢äº†)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. éå†é—´éš”2çš„å…ƒç´ ï¼ˆæ­¥é•¿2ï¼Œåˆ‡ç‰‡ï¼šlst[::2]ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\né—´éš”2çš„å…ƒç´ ï¼š&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> lst[::<span class="number">2</span>]:</span><br><span class="line">    <span class="built_in">print</span>(num, end=<span class="string">&quot; &quot;</span>)</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼šé—´éš”2çš„å…ƒç´ ï¼š0 2 4 6 8 (æ³¨ï¼šåº”è¯¥æ¢è¡Œï¼Œè¿™é‡Œä¸ºäº†èŠ‚çœç¯‡å¹…å°±ä¸æ¢äº†)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. å€’åºéå†ï¼ˆæ­¥é•¿-1ï¼Œåˆ‡ç‰‡ï¼šlst[::-1]ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nå€’åºéå†æ‰€æœ‰å…ƒç´ ï¼š&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> lst[::-<span class="number">1</span>]:</span><br><span class="line">    <span class="built_in">print</span>(num, end=<span class="string">&quot; &quot;</span>)</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼šå€’åºéå†æ‰€æœ‰å…ƒç´ ï¼š9 8 7 6 5 4 3 2 1 0 (æ³¨ï¼šåº”è¯¥æ¢è¡Œï¼Œè¿™é‡Œä¸ºäº†èŠ‚çœç¯‡å¹…å°±ä¸æ¢äº†)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. éå†åµŒå¥—åˆ—è¡¨çš„å­åˆ—è¡¨</span></span><br><span class="line">nest_lst = [<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], <span class="number">6</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nåµŒå¥—åˆ—è¡¨ä¸­çš„å­åˆ—è¡¨å…ƒç´ ï¼š&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> nest_lst[<span class="number">2</span>]:  <span class="comment"># å…ˆå–å­åˆ—è¡¨ lst[2] = [3,4,5]ï¼Œå†éå†</span></span><br><span class="line">    <span class="built_in">print</span>(item, end=<span class="string">&quot; &quot;</span>)</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼šåµŒå¥—åˆ—è¡¨ä¸­çš„å­åˆ—è¡¨å…ƒç´ ï¼š3 4 5 (æ³¨ï¼šåº”è¯¥æ¢è¡Œï¼Œè¿™é‡Œä¸ºäº†èŠ‚çœç¯‡å¹…å°±ä¸æ¢äº†)</span></span><br></pre></td></tr></table></figure>
<h2 id="7-åˆ—è¡¨çš„å…³é”®æ³¨æ„äº‹é¡¹">7.åˆ—è¡¨çš„å…³é”®æ³¨æ„äº‹é¡¹</h2>
<h3 id="ï¼ˆ1ï¼‰å¯å˜å¯¹è±¡çš„å¼•ç”¨é—®é¢˜ï¼ˆâ€œå¯å˜æ€§â€ï¼‰">ï¼ˆ1ï¼‰å¯å˜å¯¹è±¡çš„å¼•ç”¨é—®é¢˜ï¼ˆâ€œå¯å˜æ€§â€ï¼‰</h3>
<ul>
<li><strong>åˆ—è¡¨æ˜¯å¯å˜å¯¹è±¡ï¼Œèµ‹å€¼æ—¶ä¼ é€’çš„æ˜¯å¼•ç”¨ï¼ˆå†…å­˜åœ°å€ï¼‰ï¼Œä¿®æ”¹æ–°åˆ—è¡¨ä¼šå½±å“åŸåˆ—è¡¨ï¼ˆä¸ä¸å¯å˜å¯¹è±¡çš„èµ‹å€¼é€»è¾‘ä¸åŒï¼‰</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¯å˜å¯¹è±¡å¼•ç”¨ä¼ é€’</span></span><br><span class="line">lst1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">lst2 = lst1  <span class="comment"># lst2 æŒ‡å‘ lst1 çš„å†…å­˜åœ°å€</span></span><br><span class="line">lst2[<span class="number">0</span>] = <span class="number">10</span>  <span class="comment"># ä¿®æ”¹ lst2ï¼ŒåŸåˆ—è¡¨ lst1 ä¹Ÿä¼šè¢«ä¿®æ”¹</span></span><br><span class="line"><span class="built_in">print</span>(lst1)  <span class="comment"># [10, 2, 3]</span></span><br><span class="line"><span class="built_in">print</span>(lst2)  <span class="comment"># [10, 2, 3]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å†³ï¼šåˆ›å»ºåˆ—è¡¨å‰¯æœ¬ï¼ˆä¸å½±å“åŸåˆ—è¡¨ï¼‰</span></span><br><span class="line">lst3 = lst1.copy()  <span class="comment"># æ–¹æ³•1ï¼šcopy() æ–¹æ³•</span></span><br><span class="line">lst4 = lst1[:]      <span class="comment"># æ–¹æ³•2ï¼šåˆ‡ç‰‡ï¼ˆå…¨åˆ‡ç‰‡ï¼‰</span></span><br><span class="line">lst5 = <span class="built_in">list</span>(lst1)   <span class="comment"># æ–¹æ³•3ï¼šlist() å‡½æ•°</span></span><br><span class="line">lst3[<span class="number">0</span>] = <span class="number">20</span></span><br><span class="line"><span class="built_in">print</span>(lst1)  <span class="comment"># [10, 2, 3]ï¼ˆåŸåˆ—è¡¨æœªå˜ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(lst3)  <span class="comment"># [20, 2, 3]ï¼ˆå‰¯æœ¬ä¿®æ”¹ï¼‰</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰åµŒå¥—åˆ—è¡¨çš„å‰¯æœ¬é—®é¢˜">ï¼ˆ2ï¼‰åµŒå¥—åˆ—è¡¨çš„å‰¯æœ¬é—®é¢˜</h3>
<ul>
<li><strong>æ™®é€š copy()/åˆ‡ç‰‡ æ˜¯ã€Œæµ…æ‹·è´ã€ï¼Œä»…å¤åˆ¶å¤–å±‚åˆ—è¡¨ï¼Œå†…å±‚åµŒå¥—åˆ—è¡¨ä»ä¸ºå¼•ç”¨ä¼ é€’ï¼Œä¿®æ”¹å†…å±‚åˆ—è¡¨ä¼šå½±å“åŸåˆ—è¡¨</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">lst1 = [<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>]]</span><br><span class="line">lst2 = lst1.copy()  <span class="comment"># æµ…æ‹·è´</span></span><br><span class="line">lst2[<span class="number">2</span>][<span class="number">0</span>] = <span class="number">30</span>  <span class="comment"># ä¿®æ”¹å†…å±‚åˆ—è¡¨</span></span><br><span class="line"><span class="built_in">print</span>(lst1)  <span class="comment"># [1, 2, [30, 4]]ï¼ˆåŸåˆ—è¡¨å†…å±‚è¢«ä¿®æ”¹ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(lst2)  <span class="comment"># [1, 2, [30, 4]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å†³ï¼šæ·±æ‹·è´ï¼ˆå¤åˆ¶æ‰€æœ‰å±‚çº§çš„å…ƒç´ ï¼Œå®Œå…¨ç‹¬ç«‹ï¼‰</span></span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line">lst3 = copy.deepcopy(lst1)  <span class="comment"># æ·±æ‹·è´</span></span><br><span class="line">lst3[<span class="number">2</span>][<span class="number">0</span>] = <span class="number">300</span></span><br><span class="line"><span class="built_in">print</span>(lst1)  <span class="comment"># [1, 2, [30, 4]]ï¼ˆåŸåˆ—è¡¨æœªå˜ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(lst3)  <span class="comment"># [1, 2, [300, 4]]</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰é¿å…é¢‘ç¹åœ¨åˆ—è¡¨å¼€å¤´å¢åˆ å…ƒç´ ">ï¼ˆ3ï¼‰é¿å…é¢‘ç¹åœ¨åˆ—è¡¨å¼€å¤´å¢åˆ å…ƒç´ </h3>
<ul>
<li><strong>åˆ—è¡¨æ˜¯åŠ¨æ€æ•°ç»„ï¼Œå¼€å¤´å¢åˆ å…ƒç´ ï¼ˆå¦‚ insert(0, x)ã€pop(0)ï¼‰éœ€è¦ç§»åŠ¨æ‰€æœ‰åç»­å…ƒç´ ï¼Œæ•ˆç‡ä½</strong></li>
<li><strong>è‹¥éœ€é¢‘ç¹åœ¨ä¸¤ç«¯æ“ä½œï¼Œæ¨èç”¨ collections.dequeï¼ˆåŒç«¯é˜Ÿåˆ—ï¼‰</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä½æ•ˆï¼šåˆ—è¡¨å¼€å¤´æ’å…¥</span></span><br><span class="line">lst = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">    lst.insert(<span class="number">0</span>, i)  <span class="comment"># æ¯æ¬¡æ’å…¥éƒ½è¦ç§»åŠ¨æ‰€æœ‰å…ƒç´ </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é«˜æ•ˆï¼šåŒç«¯é˜Ÿåˆ—å¼€å¤´æ’å…¥</span></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line">dq = deque()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">    dq.appendleft(i)  <span class="comment"># åŒç«¯é˜Ÿåˆ—å¼€å¤´æ’å…¥æ•ˆç‡é«˜</span></span><br></pre></td></tr></table></figure>
<hr>
<h1>ä¸‰ã€å…ƒç»„</h1>
<h2 id="1-å…ƒç»„çš„å®šä¹‰ä¸åŸºç¡€è¡¨ç¤º">1.å…ƒç»„çš„å®šä¹‰ä¸åŸºç¡€è¡¨ç¤º</h2>
<h3 id="ï¼ˆ1ï¼‰æ¦‚è¿°-2">ï¼ˆ1ï¼‰æ¦‚è¿°</h3>
<ul>
<li><strong>å®šä¹‰å…ƒç»„ä½¿ç”¨åœ†æ‹¬å· () åŒ…è£¹å…ƒç´ ï¼Œå…ƒç´ ä¹‹é—´ç”¨â€œé€—å· , â€åˆ†éš”</strong></li>
<li><strong>å…ƒç»„æ”¯æŒå­˜å‚¨ä¸åŒç±»å‹çš„å…ƒç´ ï¼Œä¹Ÿæ”¯æŒåµŒå¥—ï¼ˆå…ƒç»„å†…éƒ¨åŒ…å«å…ƒç»„ã€åˆ—è¡¨ç­‰ï¼‰</strong></li>
</ul>
<p><strong>æ³¨æ„ï¼šå½“å…ƒç»„ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå¿…é¡»åœ¨å…ƒç´ ååŠ â€œé€—å· , â€ï¼Œå¦åˆ™åœ†æ‹¬å·ä¼šè¢«å½“ä½œè¿ç®—ç¬¦å¤„ç†ï¼Œæ— æ³•æ­£ç¡®åˆ›å»ºå…ƒç»„ã€‚</strong></p>
<h3 id="ï¼ˆ2ï¼‰å¸¸ç”¨åˆ›å»ºæ–¹æ³•-2">ï¼ˆ2ï¼‰å¸¸ç”¨åˆ›å»ºæ–¹æ³•</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ–¹æ³•1ï¼šç›´æ¥ç”¨åœ†æ‹¬å·å®šä¹‰ï¼ˆæœ€å¸¸ç”¨ï¼Œæ”¯æŒæ··åˆç±»å‹/åµŒå¥—ï¼‰</span></span><br><span class="line">t1 = (<span class="number">10</span>, <span class="number">3.14</span>, <span class="string">&quot;Python&quot;</span>, <span class="literal">True</span>)  <span class="comment"># åŒ…å« intã€floatã€strã€bool ç±»å‹</span></span><br><span class="line">t_nest = (<span class="number">1</span>, <span class="number">2</span>, (<span class="number">3</span>, <span class="number">4</span>), (<span class="number">5</span>, [<span class="number">6</span>, <span class="number">7</span>]))  <span class="comment"># äºŒç»´åµŒå¥—å…ƒç»„ï¼ˆå†…éƒ¨å¯åŒ…å«åˆ—è¡¨ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(t1)  <span class="comment"># (10, 3.14, &#x27;Python&#x27;, True)</span></span><br><span class="line"><span class="built_in">print</span>(t_nest)  <span class="comment"># (1, 2, (3, 4), (5, [6, 7]))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•2ï¼šåˆ›å»ºå•å…ƒç´ å…ƒç»„ï¼ˆå¿…é¡»åŠ é€—å·ï¼Œå¦åˆ™ä¸æ˜¯å…ƒç»„ï¼‰</span></span><br><span class="line">t2 = (<span class="number">5</span>,)  <span class="comment"># æ­£ç¡®ï¼šå•å…ƒç´ å…ƒç»„ï¼Œé€—å·ä¸å¯çœç•¥</span></span><br><span class="line">t3 = (<span class="number">5</span>)   <span class="comment"># é”™è¯¯ï¼šè¢«å½“ä½œæ•´æ•° 5 å¤„ç†ï¼Œç±»å‹æ˜¯ int</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(t2))  <span class="comment"># &lt;class &#x27;tuple&#x27;&gt;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(t3))  <span class="comment"># &lt;class &#x27;int&#x27;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•3ï¼šçœç•¥åœ†æ‹¬å·åˆ›å»ºï¼ˆå…ƒç»„çš„ç‰¹æ®Šè¯­æ³•ï¼Œç®€æ´ï¼‰</span></span><br><span class="line">t4 = <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>  <span class="comment"># æ— éœ€åœ†æ‹¬å·ï¼Œç›´æ¥ç”¨é€—å·åˆ†éš”å…ƒç´ </span></span><br><span class="line"><span class="built_in">print</span>(t4)  <span class="comment"># (1, 2, 3)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(t4))  <span class="comment"># &lt;class &#x27;tuple&#x27;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•4ï¼šç”¨ tuple() å‡½æ•°è½¬æ¢ï¼ˆå¯è¿­ä»£å¯¹è±¡è½¬å…ƒç»„ï¼‰</span></span><br><span class="line">t5 = <span class="built_in">tuple</span>(<span class="string">&quot;hello&quot;</span>)  <span class="comment"># å­—ç¬¦ä¸²è½¬å…ƒç»„ï¼ˆæ¯ä¸ªå­—ç¬¦ä¸ºå…ƒç´ ï¼‰</span></span><br><span class="line">t6 = <span class="built_in">tuple</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])  <span class="comment"># åˆ—è¡¨è½¬å…ƒç»„</span></span><br><span class="line">t7 = <span class="built_in">tuple</span>(<span class="built_in">range</span>(<span class="number">5</span>))  <span class="comment"># rangeå¯¹è±¡è½¬å…ƒç»„ï¼ˆç”Ÿæˆè¿ç»­æ•´æ•°å…ƒç»„ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(t5)  <span class="comment"># (&#x27;h&#x27;, &#x27;e&#x27;, &#x27;l&#x27;, &#x27;l&#x27;, &#x27;o&#x27;)</span></span><br><span class="line"><span class="built_in">print</span>(t6)  <span class="comment"># (1, 2, 3)</span></span><br><span class="line"><span class="built_in">print</span>(t7)  <span class="comment"># (0, 1, 2, 3, 4)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•5ï¼šåˆ›å»ºç©ºå…ƒç»„</span></span><br><span class="line">t8 = ()  <span class="comment"># ç©ºå…ƒç»„ï¼Œé•¿åº¦ä¸º 0</span></span><br><span class="line">t9 = <span class="built_in">tuple</span>()  <span class="comment"># ç©ºå…ƒç»„ï¼ˆtuple() æ— å‚æ•°æ—¶è¿”å›ç©ºå…ƒç»„ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(t8))  <span class="comment"># 0</span></span><br><span class="line"><span class="built_in">print</span>(t9)  <span class="comment"># ()</span></span><br></pre></td></tr></table></figure>
<h2 id="2-å…ƒç»„çš„æ ¸å¿ƒç‰¹æ€§">2.å…ƒç»„çš„æ ¸å¿ƒç‰¹æ€§</h2>
<h3 id="ï¼ˆ1ï¼‰ä¸å¯å˜æ€§ï¼ˆæœ€æ ¸å¿ƒç‰¹æ€§ï¼Œå¿…çœ‹ï¼ï¼‰">ï¼ˆ1ï¼‰ä¸å¯å˜æ€§ï¼ˆæœ€æ ¸å¿ƒç‰¹æ€§ï¼Œå¿…çœ‹ï¼ï¼‰</h3>
<ul>
<li><strong>å…ƒç»„å­˜å‚¨çš„æ˜¯å¯¹è±¡çš„å¼•ç”¨ï¼Œè€Œéå¯¹è±¡æœ¬èº«</strong></li>
<li><strong>å…ƒç»„çš„ä¸å¯å˜æ€§ä»…æ„å‘³ç€å…ƒç»„çš„ç»“æ„ï¼ˆé•¿åº¦å’Œå¯¹è±¡å¼•ç”¨ï¼‰ä¸èƒ½æ”¹å˜</strong></li>
<li><strong>ä½†å¼•ç”¨æŒ‡å‘çš„å¯å˜å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€å¯ä»¥æ”¹å˜</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">t = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>,[<span class="number">3</span>,<span class="number">4</span>])</span><br><span class="line"><span class="comment"># 1. å°è¯•ä¿®æ”¹å…ƒç´ ï¼ˆæŠ¥é”™ï¼‰</span></span><br><span class="line"><span class="comment"># t[0] = 10  # TypeError: &#x27;tuple&#x27; object does not support item assignment</span></span><br><span class="line"><span class="comment"># 2. å°è¯•åˆ é™¤å…ƒç´ ï¼ˆæŠ¥é”™ï¼‰</span></span><br><span class="line"><span class="comment"># del t[1]  # TypeError: &#x27;tuple&#x27; object doesn&#x27;t support item deletion</span></span><br><span class="line"><span class="comment"># 3. å°è¯•æ–°å¢å…ƒç´ ï¼ˆæŠ¥é”™ï¼‰</span></span><br><span class="line"><span class="comment"># t.append(4)  # AttributeError: &#x27;tuple&#x27; object has no attribute &#x27;append&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.ä¿®æ”¹å…ƒç»„ä¸­åˆ—è¡¨çš„å†…å®¹ï¼ˆæˆåŠŸï¼‰</span></span><br><span class="line">t[<span class="number">3</span>].append(<span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ä¿®æ”¹åå…ƒç»„: <span class="subst">&#123;t&#125;</span>&quot;</span>)  <span class="comment"># ä¿®æ”¹åå…ƒç»„: (1, 2, 3,[3, 4, 5])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.å°è¯•æ›¿æ¢æ•´ä¸ªåˆ—è¡¨ï¼ˆæŠ¥é”™ï¼‰</span></span><br><span class="line">t[<span class="number">3</span>] = [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]  <span class="comment"># é”™è¯¯ï¼š&#x27;tuple&#x27; object does not support item assignment</span></span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„ï¼ï¼ï¼šè‹¥å…ƒç»„å†…éƒ¨åŒ…å«â€œå¯å˜å¯¹è±¡â€ï¼ˆå¦‚åˆ—è¡¨ï¼‰ï¼Œåˆ™å¯å˜å¯¹è±¡çš„å†…éƒ¨å…ƒç´ å¯ä»¥ä¿®æ”¹ï¼Œä½†å…ƒç»„çš„ç»“æ„ï¼ˆé•¿åº¦å’Œå¯¹è±¡å¼•ç”¨ï¼‰ä¸èƒ½æ”¹å˜</strong>ã€‚</p>
<ul>
<li><strong>å¯¹äºã€Œä¸å¯å˜å…ƒç´ ã€</strong>ï¼ˆå¦‚æ•°å­—ã€boolå€¼ã€å­—ç¬¦ä¸²ç­‰ï¼‰ï¼šå¼•ç”¨åœ°å€å’Œå®é™…å€¼ç»‘å®šï¼Œä¿®æ”¹å€¼ = ä¿®æ”¹å¼•ç”¨ï¼ˆ<strong>ç”±ä¸å¯å˜æ€§çŸ¥</strong>ï¼‰ï¼Œå› æ­¤å…ƒç»„ä¸å…è®¸æ“ä½œä¿®æ”¹<strong>ä¸å¯å˜å…ƒç´ </strong>çš„å€¼ï¼›
<ul>
<li><strong>ä¸å¯å˜å…ƒç´ </strong>ï¼šæ•´æ•°ï¼ˆintï¼‰ã€å¸ƒå°”å€¼ï¼ˆboolï¼‰ã€æµ®ç‚¹æ•°ï¼ˆfloatï¼‰ã€å­—ç¬¦ä¸²ï¼ˆstrï¼‰ã€å…ƒç»„ï¼ˆtupleï¼‰</li>
</ul>
</li>
<li><strong>å¯¹äºã€Œå¯å˜å…ƒç´ ã€</strong>ï¼ˆå¦‚åˆ—è¡¨ã€å­—å…¸ç­‰ï¼‰ï¼šå¼•ç”¨åœ°å€ä¸å®é™…å€¼åˆ†å¼€å­˜å‚¨ï¼Œä¿®æ”¹å€¼ != ä¿®æ”¹å¼•ç”¨ï¼ˆ<strong>æœ‰å¯å˜æ€§çŸ¥</strong>ï¼‰ï¼Œå› æ­¤å…ƒç»„å…è®¸æ“ä½œä¿®æ”¹<strong>å¯å˜å…ƒç´ </strong>å†…çš„å€¼ï¼›
<ul>
<li><strong>å¯å˜å…ƒç´ </strong>ï¼šåˆ—è¡¨ï¼ˆlistï¼‰ã€å­—å…¸ï¼ˆdictï¼‰ã€é›†åˆï¼ˆsetï¼‰ã€å­—èŠ‚æ•°ç»„ï¼ˆbytearrayï¼‰</li>
</ul>
</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰æœ‰åºæ€§-2">ï¼ˆ2ï¼‰æœ‰åºæ€§</h3>
<p><strong>å…ƒç»„ä¸­çš„å…ƒç´ æŒ‰ã€Œæ’å…¥é¡ºåºã€æ’åˆ—ï¼Œæ”¯æŒé€šè¿‡ã€Œç´¢å¼•ã€ï¼ˆæ­£å‘ã€åå‘ï¼‰è®¿é—®å…ƒç´ ï¼Œä¹Ÿæ”¯æŒåˆ‡ç‰‡æˆªå–å­å…ƒç»„ï¼Œæ“ä½œé€»è¾‘ä¸åˆ—è¡¨ã€å­—ç¬¦ä¸²å®Œå…¨ä¸€è‡´ã€‚</strong></p>
<ul>
<li><strong>æ­£å‘ç´¢å¼•</strong>ï¼šä» 0 å¼€å§‹ï¼Œä¾æ¬¡é€’å¢ï¼ˆ0 è¡¨ç¤ºç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰</li>
<li><strong>åå‘ç´¢å¼•</strong>ï¼šä» -1 å¼€å§‹ï¼Œä¾æ¬¡é€’å‡ï¼ˆ-1 è¡¨ç¤ºæœ€åä¸€ä¸ªå…ƒç´ ï¼‰</li>
<li><strong>åˆ‡ç‰‡</strong>ï¼šè¯­æ³•ä¸º t[start:end:step]ï¼Œstart èµ·å§‹ä½ç½®ï¼ˆé»˜è®¤ 0ï¼‰ï¼Œend ç»“æŸä½ç½®ï¼ˆä¸åŒ…å«ï¼Œé»˜è®¤å…ƒç»„é•¿åº¦ï¼‰ï¼Œstep æ­¥é•¿ï¼ˆé»˜è®¤ 1ï¼Œè´Ÿæ•°è¡¨ç¤ºåå‘åˆ‡ç‰‡ï¼‰</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">t = (<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;e&quot;</span>)</span><br><span class="line"><span class="comment"># 1. ç´¢å¼•è®¿é—®</span></span><br><span class="line"><span class="built_in">print</span>(t[<span class="number">0</span>])   <span class="comment"># &#x27;a&#x27;ï¼ˆæ­£å‘ç´¢å¼•ï¼šç¬¬0ä½ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(t[-<span class="number">1</span>])  <span class="comment"># &#x27;e&#x27;ï¼ˆåå‘ç´¢å¼•ï¼šæœ€åä¸€ä½ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(t[<span class="number">3</span>])   <span class="comment"># &#x27;d&#x27;ï¼ˆæ­£å‘ç´¢å¼•ï¼šç¬¬3ä½ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. åˆ‡ç‰‡æ“ä½œ</span></span><br><span class="line"><span class="built_in">print</span>(t[<span class="number">1</span>:<span class="number">4</span>])  <span class="comment"># (&#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;)ï¼ˆä»ç¬¬1ä½åˆ°ç¬¬3ä½ï¼Œä¸åŒ…å«ç¬¬4ä½ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(t[:<span class="number">3</span>])   <span class="comment"># (&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;)ï¼ˆä»å¼€å¤´åˆ°ç¬¬2ä½ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(t[<span class="number">2</span>:])   <span class="comment"># (&#x27;c&#x27;, &#x27;d&#x27;, &#x27;e&#x27;)ï¼ˆä»ç¬¬2ä½åˆ°æœ«å°¾ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(t[::<span class="number">2</span>])  <span class="comment"># (&#x27;a&#x27;, &#x27;c&#x27;, &#x27;e&#x27;)ï¼ˆæ­¥é•¿2ï¼Œé—´éš”å–å…ƒç´ ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(t[::-<span class="number">1</span>]) <span class="comment"># (&#x27;e&#x27;, &#x27;d&#x27;, &#x27;c&#x27;, &#x27;b&#x27;, &#x27;a&#x27;)ï¼ˆåå‘åˆ‡ç‰‡ï¼Œå€’åºè¾“å‡ºï¼‰</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰å…ƒç´ ç±»å‹æ— é™åˆ¶-2">ï¼ˆ3ï¼‰å…ƒç´ ç±»å‹æ— é™åˆ¶</h3>
<p><strong>å…ƒç»„å¯å­˜å‚¨ä»»æ„ç±»å‹çš„å…ƒç´ ï¼ŒåŒ…æ‹¬æ•°å­—ã€å­—ç¬¦ä¸²ã€å…ƒç»„ã€åˆ—è¡¨ã€å­—å…¸ç­‰ï¼Œæ”¯æŒæ··åˆç±»å‹å­˜å‚¨ã€‚</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">t = (<span class="number">100</span>, <span class="string">&quot;hello&quot;</span>, (<span class="number">1</span>,<span class="number">2</span>), [<span class="number">3</span>,<span class="number">4</span>], &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;å°æ˜&quot;</span>&#125;, <span class="literal">None</span>)</span><br><span class="line"><span class="built_in">print</span>(t)  <span class="comment"># (100, &#x27;hello&#x27;, (1, 2), [3, 4], &#123;&#x27;name&#x27;: &#x27;å°æ˜&#x27;&#125;, None)</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ4ï¼‰å¯å“ˆå¸Œæ€§">ï¼ˆ4ï¼‰å¯å“ˆå¸Œæ€§</h3>
<p><strong>ç”±äºå…ƒç»„æ˜¯ä¸å¯å˜çš„ï¼Œå› æ­¤å®ƒæ˜¯ã€Œå¯å“ˆå¸Œã€å¯¹è±¡ï¼Œå¯ä»¥ä½œä¸ºå­—å…¸çš„é”®ï¼ˆkeyï¼‰ï¼Œä¹Ÿå¯ä»¥æ”¾å…¥é›†åˆï¼ˆsetï¼‰ä¸­ï¼›è€Œåˆ—è¡¨æ˜¯ä¸å¯å“ˆå¸Œçš„ï¼Œæ— æ³•ä½œä¸ºå­—å…¸é”®æˆ–é›†åˆå…ƒç´ ã€‚</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…ƒç»„ä½œä¸ºå­—å…¸é”®ï¼ˆåˆæ³•ï¼‰</span></span><br><span class="line">dict1 = &#123;(<span class="number">1</span>,<span class="number">2</span>): <span class="string">&quot;a&quot;</span>, (<span class="number">3</span>,<span class="number">4</span>): <span class="string">&quot;b&quot;</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(dict1)  <span class="comment"># &#123;(1, 2): &#x27;a&#x27;, (3, 4): &#x27;b&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—è¡¨ä½œä¸ºå­—å…¸é”®ï¼ˆæŠ¥é”™ï¼‰</span></span><br><span class="line"><span class="comment"># dict2 = &#123;[1,2]: &quot;a&quot;&#125;  # TypeError: unhashable type: &#x27;list&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…ƒç»„æ”¾å…¥é›†åˆï¼ˆåˆæ³•ï¼‰</span></span><br><span class="line">set1 = &#123;(<span class="number">1</span>,<span class="number">2</span>), (<span class="number">3</span>,<span class="number">4</span>)&#125;</span><br><span class="line"><span class="built_in">print</span>(set1)  <span class="comment"># &#123;(1, 2), (3, 4)&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="3-å…ƒç»„çš„å¸¸è§æ“ä½œ">3.å…ƒç»„çš„å¸¸è§æ“ä½œ</h2>
<p><strong>å…ƒç»„çš„æ“ä½œä¸»è¦å›´ç»•ã€Œè¯»å–ã€å’Œã€Œåˆ¤æ–­ã€å±•å¼€ï¼Œå› â€œä¸å¯å˜æ€§â€ï¼Œæ— å¢åˆ æ”¹ç›¸å…³æ–¹æ³•ã€‚å¸¸ç”¨æ“ä½œåŒ…æ‹¬éå†ã€ç´¢å¼•/åˆ‡ç‰‡è®¿é—®ã€æ‹¼æ¥/é‡å¤ã€æˆå‘˜åˆ¤æ–­ç­‰ã€‚</strong></p>
<h3 id="ï¼ˆ1ï¼‰å…ƒç»„éå†">ï¼ˆ1ï¼‰å…ƒç»„éå†</h3>
<ul>
<li><strong>å…ƒç»„çš„éå†æ–¹å¼ä¸åˆ—è¡¨å®Œå…¨ä¸€è‡´ï¼Œæ”¯æŒåŸºç¡€ for å¾ªç¯ã€å¸¦ç´¢å¼•çš„éå†ï¼ˆenumerate å‡½æ•°ï¼‰ã€åˆ‡ç‰‡éå†ã€‚</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">t = (<span class="string">&quot;è‹¹æœ&quot;</span>, <span class="string">&quot;é¦™è•‰&quot;</span>, <span class="string">&quot;æ©™å­&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. åŸºç¡€ for å¾ªç¯ï¼ˆç›´æ¥éå†å…ƒç´ ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;åŸºç¡€éå†ï¼š&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> fruit <span class="keyword">in</span> t:</span><br><span class="line">    <span class="built_in">print</span>(fruit)  <span class="comment"># è‹¹æœã€é¦™è•‰ã€æ©™å­</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. å¸¦ç´¢å¼•çš„éå†ï¼ˆenumerate å‡½æ•°ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nå¸¦ç´¢å¼•éå†ï¼š&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> idx, val <span class="keyword">in</span> <span class="built_in">enumerate</span>(t, start=<span class="number">1</span>):  <span class="comment"># start=1 æŒ‡å®šç´¢å¼•ä»1å¼€å§‹</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;åºå·ï¼š<span class="subst">&#123;idx&#125;</span>ï¼Œå…ƒç´ ï¼š<span class="subst">&#123;val&#125;</span>&quot;</span>)  <span class="comment"># åºå·1-3ï¼Œå¯¹åº”å…ƒç´ </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. åˆ‡ç‰‡éå†ï¼ˆéå†å­å…ƒç»„ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nåˆ‡ç‰‡éå†å‰2ä¸ªå…ƒç´ ï¼š&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> fruit <span class="keyword">in</span> t[:<span class="number">2</span>]:</span><br><span class="line">    <span class="built_in">print</span>(fruit)  <span class="comment"># è‹¹æœã€é¦™è•‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. åµŒå¥—å…ƒç»„éå†</span></span><br><span class="line">t_nest = (<span class="number">1</span>, <span class="number">2</span>, (<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>), <span class="number">6</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nåµŒå¥—å…ƒç»„çš„å­å…ƒç»„éå†ï¼š&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> t_nest[<span class="number">2</span>]:  <span class="comment"># éå†å­å…ƒç»„ t_nest[2] = (3,4,5)</span></span><br><span class="line">    <span class="built_in">print</span>(item)  <span class="comment"># 3ã€4ã€5</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰æ‹¼æ¥ä¸é‡å¤">ï¼ˆ2ï¼‰æ‹¼æ¥ä¸é‡å¤</h3>
<p><strong>å…ƒç»„æ”¯æŒç”¨ + æ‹¼æ¥ï¼ˆåˆå¹¶ä¸¤ä¸ªå…ƒç»„ï¼‰ã€ç”¨ *é‡å¤ï¼ˆå°†å…ƒç»„å…ƒç´ é‡å¤æŒ‡å®šæ¬¡æ•°ï¼‰ï¼Œä½†è¿™ä¸¤ç§æ“ä½œä¼šç”Ÿæˆæ–°å…ƒç»„ï¼Œä¸ä¿®æ”¹åŸå…ƒç»„ï¼ˆç¬¦åˆä¸å¯å˜ç‰¹æ€§ï¼‰ã€‚</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">t1 = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">t2 = (<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. æ‹¼æ¥ï¼ˆ+ï¼‰</span></span><br><span class="line">t3 = t1 + t2</span><br><span class="line"><span class="built_in">print</span>(t3)  <span class="comment"># (1, 2, 3, 4, 5, 6)</span></span><br><span class="line"><span class="built_in">print</span>(t1)  <span class="comment"># (1, 2, 3)ï¼ˆåŸå…ƒç»„æœªä¿®æ”¹ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. é‡å¤ï¼ˆ*ï¼‰</span></span><br><span class="line">t4 = t1 * <span class="number">3</span></span><br><span class="line"><span class="built_in">print</span>(t4)  <span class="comment"># (1, 2, 3, 1, 2, 3, 1, 2, 3)</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰æˆå‘˜åˆ¤æ–­ï¼ˆin-not-inï¼‰-2">ï¼ˆ3ï¼‰æˆå‘˜åˆ¤æ–­ï¼ˆin / not inï¼‰</h3>
<p><strong>ç”¨ in åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨å…ƒç»„ä¸­ï¼Œnot in åˆ¤æ–­å…ƒç´ æ˜¯å¦ä¸åœ¨å…ƒç»„ä¸­ï¼Œè¿”å›å¸ƒå°”å€¼ã€‚</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">t = (<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="string">&quot;hello&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="number">20</span> <span class="keyword">in</span> t)  <span class="comment"># Trueï¼ˆå…ƒç´ å­˜åœ¨ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="number">40</span> <span class="keyword">in</span> t)  <span class="comment"># Falseï¼ˆå…ƒç´ ä¸å­˜åœ¨ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;hello&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> t)  <span class="comment"># Falseï¼ˆå…ƒç´ å­˜åœ¨ï¼Œnot in è¿”å› Falseï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;world&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> t)  <span class="comment"># Trueï¼ˆå…ƒç´ ä¸å­˜åœ¨ï¼‰</span></span><br></pre></td></tr></table></figure>
<h2 id="4-å…ƒç»„çš„å¸¸ç”¨å†…ç½®å‡½æ•°ä¸æ–¹æ³•">4.å…ƒç»„çš„å¸¸ç”¨å†…ç½®å‡½æ•°ä¸æ–¹æ³•</h2>
<p><strong>å…ƒç»„çš„æ–¹æ³•è¾ƒå°‘ï¼ˆå› ä¸å¯å˜æ€§ï¼‰ï¼Œæ ¸å¿ƒæ–¹æ³•ä¸º index()ï¼ˆæŸ¥æ‰¾å…ƒç´ ç´¢å¼•ï¼‰å’Œ count()ï¼ˆç»Ÿè®¡å…ƒç´ å‡ºç°æ¬¡æ•°ï¼‰ï¼›å¸¸ç”¨å†…ç½®å‡½æ•°ä¸åˆ—è¡¨é€šç”¨ã€‚</strong></p>
<h3 id="ï¼ˆ1ï¼‰å†…ç½®å‡½æ•°ï¼ˆå…¨å±€å‡½æ•°ï¼Œç›´æ¥è°ƒç”¨ï¼‰-2">ï¼ˆ1ï¼‰å†…ç½®å‡½æ•°ï¼ˆå…¨å±€å‡½æ•°ï¼Œç›´æ¥è°ƒç”¨ï¼‰</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260110090007457.png" alt=""></p>
<h3 id="ï¼ˆ2ï¼‰å…ƒç»„å¯¹è±¡æ–¹æ³•ï¼ˆt-æ–¹æ³•å-ï¼‰">ï¼ˆ2ï¼‰å…ƒç»„å¯¹è±¡æ–¹æ³•ï¼ˆt.æ–¹æ³•å()ï¼‰</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260110090252610.png" alt=""></p>
<h2 id="5-å…ƒç»„ä¸åˆ—è¡¨çš„æ ¸å¿ƒåŒºåˆ«">5.å…ƒç»„ä¸åˆ—è¡¨çš„æ ¸å¿ƒåŒºåˆ«</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260110090555054.png" alt=""></p>
<h2 id="6-å…ƒç»„çš„å…³é”®æ³¨æ„äº‹é¡¹">6.å…ƒç»„çš„å…³é”®æ³¨æ„äº‹é¡¹</h2>
<ul>
<li><strong>å•å…ƒç´ å…ƒç»„å¿…é¡»åŠ é€—å·</strong>ï¼šè¿™æ˜¯å¸¸è§çš„å‘ï¼è‹¥çœç•¥é€—å·ï¼Œåœ†æ‹¬å·ä¼šè¢«å½“ä½œè¿ç®—ç¬¦ï¼Œåˆ›å»ºçš„æ˜¯å¯¹åº”ç±»å‹çš„å•ä¸ªå…ƒç´ ï¼Œè€Œéå…ƒç»„ã€‚</li>
<li><strong>å…ƒç»„çš„ä¸å¯å˜æ˜¯ã€Œæµ…å±‚ä¸å¯å˜ã€</strong>ï¼šå…ƒç»„çš„ä¸å¯å˜æŒ‡çš„æ˜¯ã€Œå…ƒç´ çš„å¼•ç”¨ä¸å¯å˜ã€ï¼Œå³ä¸èƒ½ä¿®æ”¹å…ƒç»„ä¸­å…ƒç´ çš„æŒ‡å‘ï¼Œä½†å¦‚æœå…ƒç´ æœ¬èº«æ˜¯å¯å˜å¯¹è±¡ï¼ˆå¦‚åˆ—è¡¨ï¼‰ï¼Œå…¶å†…éƒ¨çŠ¶æ€å¯ä»¥æ”¹å˜ã€‚</li>
<li><strong>å…ƒç»„çš„ã€Œä¸å¯å˜ã€ä¸ä»£è¡¨å…ƒç´ ä¸å¯å˜</strong>ï¼šå…ƒç»„çš„ä¸å¯å˜æŒ‡çš„æ˜¯ã€Œå…ƒç´ çš„å¼•ç”¨ä¸å¯å˜ã€ï¼Œå³ä¸èƒ½ä¿®æ”¹å…ƒç»„ä¸­å…ƒç´ çš„æŒ‡å‘ï¼Œä½†å¦‚æœå…ƒç´ æœ¬èº«æ˜¯å¯å˜å¯¹è±¡ï¼ˆå¦‚åˆ—è¡¨ï¼‰ï¼Œå…¶å†…éƒ¨çŠ¶æ€å¯ä»¥æ”¹å˜ã€‚</li>
<li><strong>é¿å…ä¸å¿…è¦çš„å…ƒç»„è½¬åˆ—è¡¨</strong>ï¼šè‹¥ä»…éœ€è¯»å–æ•°æ®ï¼Œç›´æ¥ä½¿ç”¨å…ƒç»„æ›´é«˜æ•ˆï¼›è‹¥å¿…é¡»ä¿®æ”¹æ•°æ®ï¼Œå†è½¬ä¸ºåˆ—è¡¨ï¼ˆç”¨ list(tuple)ï¼‰ï¼Œä¿®æ”¹åå¯å†è½¬å›å…ƒç»„ï¼ˆç”¨ tuple(list)ï¼‰ã€‚</li>
<li><strong>å‡½æ•°è¿”å›å¤šä¸ªå€¼çš„æœ¬è´¨æ˜¯å…ƒç»„</strong>ï¼šPython ä¸­å‡½æ•°è¿”å›å¤šä¸ªå€¼æ—¶ï¼Œé»˜è®¤ä¼šå°†è¿™äº›å€¼å°è£…ä¸ºå…ƒç»„è¿”å›ï¼Œå³ä½¿æ²¡æœ‰æ˜¾å¼ç”¨åœ†æ‹¬å·åŒ…è£¹ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å‡½æ•°è¿”å›å¤šä¸ªå€¼ï¼ˆé»˜è®¤å…ƒç»„ï¼‰</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_info</span>():</span><br><span class="line">    name = <span class="string">&quot;å°æ˜&quot;</span></span><br><span class="line">    age = <span class="number">20</span></span><br><span class="line">    score = <span class="number">95.5</span></span><br><span class="line">    <span class="keyword">return</span> name, age, score  <span class="comment"># ç­‰ä»·äº return (name, age, score)</span></span><br><span class="line"></span><br><span class="line">result = get_info()</span><br><span class="line"><span class="built_in">print</span>(result)  <span class="comment"># (&#x27;å°æ˜&#x27;, 20, 95.5)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(result))  <span class="comment"># &lt;class &#x27;tuple&#x27;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£æ„èµ‹å€¼ï¼ˆç›´æ¥æå–å…ƒç»„å…ƒç´ ï¼‰</span></span><br><span class="line">name, age, score = get_info()</span><br><span class="line"><span class="built_in">print</span>(name)  <span class="comment"># å°æ˜</span></span><br><span class="line"><span class="built_in">print</span>(age)   <span class="comment"># 20</span></span><br><span class="line"><span class="built_in">print</span>(score) <span class="comment"># 95.5</span></span><br></pre></td></tr></table></figure>
<hr>
<h1>å››ã€å­—å…¸</h1>
<h2 id="1-å­—å…¸çš„å®šä¹‰ä¸åŸºç¡€è¡¨ç¤º">1.å­—å…¸çš„å®šä¹‰ä¸åŸºç¡€è¡¨ç¤º</h2>
<h3 id="ï¼ˆ1ï¼‰æ¦‚è¿°-3">ï¼ˆ1ï¼‰æ¦‚è¿°</h3>
<ul>
<li><strong>å®šä¹‰å­—å…¸ä½¿ç”¨èŠ±æ‹¬å· {} åŒ…è£¹é”®å€¼å¯¹ï¼Œé”®ä¸å€¼ä¹‹é—´ç”¨å†’å· : åˆ†éš”ï¼Œä¸åŒé”®å€¼å¯¹ä¹‹é—´ç”¨é€—å· , åˆ†éš”</strong>
<ul>
<li><strong>é”®ï¼ˆkeyï¼‰</strong>ï¼šå¿…é¡»æ˜¯<strong>ä¸å¯å˜å¯¹è±¡</strong>ï¼ˆå¦‚æ•´æ•°ã€å­—ç¬¦ä¸²ã€å…ƒç»„ï¼‰ï¼Œä¸”åœ¨åŒä¸€ä¸ªå­—å…¸ä¸­<strong>å”¯ä¸€</strong>ï¼Œ<strong>ä¸å¯é‡å¤</strong>ï¼›</li>
<li><strong>å€¼ï¼ˆvalueï¼‰</strong>ï¼šå¯ä»¥æ˜¯ä»»æ„ç±»å‹çš„å¯¹è±¡ï¼ˆå¦‚æ•´æ•°ã€å­—ç¬¦ä¸²ã€åˆ—è¡¨ã€å­—å…¸ç­‰ï¼‰ï¼Œ<strong>æ”¯æŒé‡å¤</strong>ï¼›</li>
<li><strong>æ— åºæ€§</strong>ï¼šPython 3.7 ä¹‹å‰å­—å…¸æ˜¯æ— åºçš„ï¼ŒPython 3.7 åŠä»¥åä¿è¯æ’å…¥é¡ºåºï¼Œä½†ä»ä¸æ”¯æŒç´¢å¼•è®¿é—®ï¼ˆéœ€é€šè¿‡é”®è®¿é—®ï¼‰</li>
</ul>
</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰å¸¸ç”¨åˆ›å»ºæ–¹æ³•-3">ï¼ˆ2ï¼‰å¸¸ç”¨åˆ›å»ºæ–¹æ³•</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ–¹æ³•1ï¼šç›´æ¥ç”¨èŠ±æ‹¬å·å®šä¹‰ï¼ˆæœ€å¸¸ç”¨ï¼Œæ”¯æŒæ··åˆç±»å‹å€¼ï¼‰</span></span><br><span class="line">dict1 = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;å°æ˜&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">20</span>, <span class="string">&quot;score&quot;</span>: <span class="number">95.5</span>, <span class="string">&quot;is_pass&quot;</span>: <span class="literal">True</span>&#125;</span><br><span class="line"><span class="comment"># é”®ï¼šå­—ç¬¦ä¸²ç±»å‹ï¼›å€¼ï¼šå­—ç¬¦ä¸²ã€æ•´æ•°ã€æµ®ç‚¹æ•°ã€å¸ƒå°”å€¼</span></span><br><span class="line"><span class="built_in">print</span>(dict1)  <span class="comment"># &#123;&#x27;name&#x27;: &#x27;å°æ˜&#x27;, &#x27;age&#x27;: 20, &#x27;score&#x27;: 95.5, &#x27;is_pass&#x27;: True&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•2ï¼šåˆ›å»ºç©ºå­—å…¸ï¼ˆåŠ¨æ€æ·»åŠ é”®å€¼å¯¹åœºæ™¯ï¼‰</span></span><br><span class="line">dict2 = &#123;&#125;  <span class="comment"># ç©ºå­—å…¸ï¼Œé•¿åº¦ä¸º 0</span></span><br><span class="line">dict3 = <span class="built_in">dict</span>()  <span class="comment"># ç©ºå­—å…¸ï¼ˆdict() æ— å‚æ•°æ—¶è¿”å›ç©ºå­—å…¸ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(dict2))  <span class="comment"># 0</span></span><br><span class="line"><span class="built_in">print</span>(dict3)  <span class="comment"># &#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•3ï¼šç”¨ dict() å‡½æ•°è½¬æ¢ï¼ˆå¤šç§å¯è¿­ä»£å¯¹è±¡è½¬å­—å…¸ï¼‰</span></span><br><span class="line"><span class="comment"># 3.1 åˆ—è¡¨/å…ƒç»„åµŒå¥—é”®å€¼å¯¹</span></span><br><span class="line">dict4 = <span class="built_in">dict</span>([(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;å°çº¢&quot;</span>), (<span class="string">&quot;age&quot;</span>, <span class="number">19</span>)])</span><br><span class="line">dict5 = <span class="built_in">dict</span>(((<span class="string">&quot;name&quot;</span>, <span class="string">&quot;å°åˆš&quot;</span>), (<span class="string">&quot;age&quot;</span>, <span class="number">21</span>)))</span><br><span class="line"><span class="built_in">print</span>(dict4)  <span class="comment"># &#123;&#x27;name&#x27;: &#x27;å°çº¢&#x27;, &#x27;age&#x27;: 19&#125;</span></span><br><span class="line"><span class="built_in">print</span>(dict5)  <span class="comment"># &#123;&#x27;name&#x27;: &#x27;å°åˆš&#x27;, &#x27;age&#x27;: 21&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.2 å…³é”®å­—å‚æ•°ï¼ˆé”®ä¸ºå­—ç¬¦ä¸²æ—¶å¯ç”¨ï¼‰</span></span><br><span class="line">dict6 = <span class="built_in">dict</span>(name=<span class="string">&quot;å°æ&quot;</span>, age=<span class="number">22</span>, score=<span class="number">88.0</span>)</span><br><span class="line"><span class="built_in">print</span>(dict6)  <span class="comment"># &#123;&#x27;name&#x27;: &#x27;å°æ&#x27;, &#x27;age&#x27;: 22, &#x27;score&#x27;: 88.0&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.3 ä¸¤ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼ˆé”®åˆ—è¡¨+å€¼åˆ—è¡¨ï¼Œç”¨ zip æ‰“åŒ…ï¼‰</span></span><br><span class="line">keys = [<span class="string">&quot;name&quot;</span>, <span class="string">&quot;age&quot;</span>]</span><br><span class="line">values = [<span class="string">&quot;å°ç‹&quot;</span>, <span class="number">23</span>]</span><br><span class="line">dict7 = <span class="built_in">dict</span>(<span class="built_in">zip</span>(keys, values))</span><br><span class="line"><span class="built_in">print</span>(dict7)  <span class="comment"># &#123;&#x27;name&#x27;: &#x27;å°ç‹&#x27;, &#x27;age&#x27;: 23&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•4ï¼šå­—å…¸æ¨å¯¼å¼ï¼ˆç®€æ´ç”Ÿæˆæœ‰è§„å¾‹çš„å­—å…¸ï¼Œé«˜æ•ˆï¼‰</span></span><br><span class="line">dict8 = &#123;i: i*<span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)&#125;  <span class="comment"># é”®ä¸º 0-4ï¼Œå€¼ä¸ºé”®çš„ 2 å€</span></span><br><span class="line">dict9 = &#123;k: v.upper() <span class="keyword">for</span> k, v <span class="keyword">in</span> &#123;<span class="string">&quot;a&quot;</span>: <span class="string">&quot;apple&quot;</span>, <span class="string">&quot;b&quot;</span>: <span class="string">&quot;banana&quot;</span>&#125;.items()&#125;</span><br><span class="line"><span class="built_in">print</span>(dict8)  <span class="comment"># &#123;0: 0, 1: 2, 2: 4, 3: 6, 4: 8&#125;</span></span><br><span class="line"><span class="built_in">print</span>(dict9)  <span class="comment"># &#123;&#x27;a&#x27;: &#x27;APPLE&#x27;, &#x27;b&#x27;: &#x27;BANANA&#x27;&#125;</span></span><br></pre></td></tr></table></figure>
<p><strong>è¡¥å……</strong>ï¼š</p>
<ul>
<li><strong>zip(*iterables)</strong>ï¼šå°†å¤šä¸ªå¯è¿­ä»£å¯¹è±¡ï¼ˆå¦‚åˆ—è¡¨ã€å…ƒç»„ç­‰ï¼‰å¯¹åº”ä½ç½®çš„å…ƒç´ æ‰“åŒ…æˆä¸€ä¸ªä¸ªå…ƒç»„ï¼Œè¿”å›ä¸€ä¸ªå¯è¿­ä»£çš„ zip å¯¹è±¡ã€‚</li>
<li><strong>å­—å…¸æ¨å¯¼å¼è¯­æ³•</strong>ï¼š{key_expr: value_expr for item in iterable if condition}</li>
</ul>
<h2 id="2-å­—å…¸çš„æ ¸å¿ƒç‰¹æ€§">2.å­—å…¸çš„æ ¸å¿ƒç‰¹æ€§</h2>
<h3 id="ï¼ˆ1ï¼‰é”®å€¼å¯¹æ˜ å°„ï¼ˆæ ¸å¿ƒç‰¹æ€§ï¼‰">ï¼ˆ1ï¼‰é”®å€¼å¯¹æ˜ å°„ï¼ˆæ ¸å¿ƒç‰¹æ€§ï¼‰</h3>
<ul>
<li><strong>å­—å…¸çš„æ ¸å¿ƒä½œç”¨æ˜¯é€šè¿‡ã€Œé”®ã€å¿«é€Ÿå®šä½ã€Œå€¼ã€ï¼Œæ— éœ€åƒåˆ—è¡¨/å…ƒç»„é‚£æ ·éå†æŸ¥æ‰¾ï¼Œè®¿é—®æ•ˆç‡æé«˜ï¼ˆæ—¶é—´å¤æ‚åº¦ O(1)ï¼‰</strong></li>
<li><strong>é”®æ˜¯æŸ¥æ‰¾çš„å”¯ä¸€æ ‡è¯†ï¼Œå¿…é¡»æ»¡è¶³ã€Œä¸å¯å˜ã€å’Œã€Œå”¯ä¸€ã€ä¸¤ä¸ªæ¡ä»¶ã€‚</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dict1 = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;å°æ˜&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">20</span>&#125;</span><br><span class="line"><span class="comment"># é€šè¿‡é”®è®¿é—®å€¼ï¼ˆæ ¸å¿ƒç”¨æ³•ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(dict1[<span class="string">&quot;name&quot;</span>])  <span class="comment"># å°æ˜</span></span><br><span class="line"><span class="built_in">print</span>(dict1[<span class="string">&quot;age&quot;</span>])   <span class="comment"># 20</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é”®å¿…é¡»å”¯ä¸€ï¼Œé‡å¤é”®ä¼šè¦†ç›–å‰é¢çš„å€¼</span></span><br><span class="line">dict2 = &#123;<span class="string">&quot;a&quot;</span>: <span class="number">1</span>, <span class="string">&quot;a&quot;</span>: <span class="number">2</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(dict2)  <span class="comment"># &#123;&#x27;a&#x27;: 2&#125;ï¼ˆåé¢çš„é”®å€¼å¯¹è¦†ç›–å‰é¢çš„ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é”®å¿…é¡»æ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œç”¨å¯å˜å¯¹è±¡ä½œé”®ä¼šæŠ¥é”™</span></span><br><span class="line"><span class="comment"># dict3 = &#123;[1,2]: &quot;error&quot;&#125;  # TypeError: unhashable type: &#x27;list&#x27;</span></span><br><span class="line"><span class="comment"># åˆæ³•çš„é”®ç±»å‹ï¼šæ•´æ•°ã€å­—ç¬¦ä¸²ã€å…ƒç»„</span></span><br><span class="line">dict4 = &#123;<span class="number">1</span>: <span class="string">&quot;int&quot;</span>, <span class="string">&quot;str&quot;</span>: <span class="number">2</span>, (<span class="number">3</span>,<span class="number">4</span>): <span class="number">3</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(dict4)  <span class="comment"># &#123;1: &#x27;int&#x27;, &#x27;str&#x27;: 2, (3, 4): 3&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰å¯å˜æ€§ï¼ˆæ”¯æŒåŠ¨æ€å¢åˆ æ”¹ï¼‰">ï¼ˆ2ï¼‰å¯å˜æ€§ï¼ˆæ”¯æŒåŠ¨æ€å¢åˆ æ”¹ï¼‰</h3>
<p><strong>å­—å…¸åˆ›å»ºåï¼Œå¯è‡ªç”±æ·»åŠ æ–°çš„é”®å€¼å¯¹ã€ä¿®æ”¹å·²æœ‰é”®å¯¹åº”çš„å€¼ã€åˆ é™¤ä¸éœ€è¦çš„é”®å€¼å¯¹ï¼Œä¸”ä¿®æ”¹åå­—å…¸å¯¹è±¡çš„å†…å­˜åœ°å€ä¸å˜ï¼ˆç›´æ¥ä¿®æ”¹åŸå¯¹è±¡ï¼‰ã€‚</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dict1 = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;å°æ˜&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">20</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ä¿®æ”¹å‰åœ°å€ï¼š<span class="subst">&#123;<span class="built_in">id</span>(dict1)&#125;</span>&quot;</span>)  <span class="comment"># å¦‚ï¼š140692251235840</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. ä¿®æ”¹å·²æœ‰é”®çš„å€¼</span></span><br><span class="line">dict1[<span class="string">&quot;age&quot;</span>] = <span class="number">21</span></span><br><span class="line"><span class="built_in">print</span>(dict1)  <span class="comment"># &#123;&#x27;name&#x27;: &#x27;å°æ˜&#x27;, &#x27;age&#x27;: 21&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. æ·»åŠ æ–°é”®å€¼å¯¹ï¼ˆé”®ä¸å­˜åœ¨åˆ™æ–°å¢ï¼‰</span></span><br><span class="line">dict1[<span class="string">&quot;score&quot;</span>] = <span class="number">95.5</span></span><br><span class="line"><span class="built_in">print</span>(dict1)  <span class="comment"># &#123;&#x27;name&#x27;: &#x27;å°æ˜&#x27;, &#x27;age&#x27;: 21, &#x27;score&#x27;: 95.5&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. åˆ é™¤é”®å€¼å¯¹</span></span><br><span class="line"><span class="keyword">del</span> dict1[<span class="string">&quot;score&quot;</span>]</span><br><span class="line"><span class="built_in">print</span>(dict1)  <span class="comment"># &#123;&#x27;name&#x27;: &#x27;å°æ˜&#x27;, &#x27;age&#x27;: 21&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ä¿®æ”¹ååœ°å€ï¼š<span class="subst">&#123;<span class="built_in">id</span>(dict1)&#125;</span>&quot;</span>)  <span class="comment"># å¦‚ï¼š140692251235840ï¼ˆåœ°å€ä¸å˜ï¼‰</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰æ— åºæ€§ï¼ˆPython-3-7-æœ‰æ¡ä»¶æœ‰åºï¼‰">ï¼ˆ3ï¼‰æ— åºæ€§ï¼ˆPython 3.7+ æœ‰æ¡ä»¶æœ‰åºï¼‰</h3>
<ul>
<li><strong>python 3.6 ä¹‹å‰</strong>ï¼šå­—å…¸å®Œå…¨æ— åºï¼Œæ¯æ¬¡è¿­ä»£å¯èƒ½é¡ºåºä¸åŒ</li>
<li><strong>Python 3.7+</strong>ï¼šæ­£å¼å°†ä¿ç•™æ’å…¥é¡ºåºä½œä¸ºè¯­è¨€ç‰¹æ€§</li>
<li><strong>æ— è®ºæ˜¯å¦æœ‰åºï¼Œå­—å…¸çš„æ ¸å¿ƒè®¿é—®æ–¹å¼éƒ½æ˜¯é€šè¿‡é”®ï¼Œè€Œéä½ç½®ã€‚</strong></li>
<li><strong>ä¿ç•™æ’å…¥é¡ºåºä¸ç­‰äºæ’åº</strong>ï¼šå­—å…¸ä¸ä¼šè‡ªåŠ¨å¯¹é”®è¿›è¡Œæ’åº</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dict1 = &#123;<span class="string">&quot;b&quot;</span>: <span class="number">2</span>, <span class="string">&quot;a&quot;</span>: <span class="number">1</span>, <span class="string">&quot;c&quot;</span>: <span class="number">3</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(dict1)  <span class="comment"># Python 3.7+ è¾“å‡ºï¼š&#123;&#x27;b&#x27;: 2, &#x27;a&#x27;: 1, &#x27;c&#x27;: 3&#125;ï¼ˆä¿ç•™æ’å…¥é¡ºåºï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸æ”¯æŒç´¢å¼•è®¿é—®ï¼ŒæŠ¥é”™</span></span><br><span class="line"><span class="comment"># print(dict1[0])  # TypeError: &#x27;dict&#x27; object is not subscriptable</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ4ï¼‰å€¼å¯ä»»æ„æ€§ä¸å¯é‡å¤æ€§">ï¼ˆ4ï¼‰å€¼å¯ä»»æ„æ€§ä¸å¯é‡å¤æ€§</h3>
<p><strong>å­—å…¸çš„å€¼å¯ä»¥æ˜¯ä»»æ„ç±»å‹çš„å¯¹è±¡ï¼ˆåŒ…æ‹¬å¯å˜å¯¹è±¡å¦‚åˆ—è¡¨ã€å­—å…¸ï¼‰ï¼Œä¸”å¤šä¸ªé”®å¯ä»¥å¯¹åº”ç›¸åŒçš„å€¼ï¼ˆå€¼ä¸å”¯ä¸€ï¼‰ã€‚</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dict1 = &#123;</span><br><span class="line">    <span class="string">&quot;list&quot;</span>: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],  <span class="comment"># å€¼ä¸ºåˆ—è¡¨ï¼ˆå¯å˜ï¼‰</span></span><br><span class="line">    <span class="string">&quot;dict&quot;</span>: &#123;<span class="string">&quot;a&quot;</span>: <span class="number">1</span>&#125;,  <span class="comment"># å€¼ä¸ºå­—å…¸ï¼ˆå¯å˜ï¼‰</span></span><br><span class="line">    <span class="string">&quot;tuple&quot;</span>: (<span class="number">4</span>,<span class="number">5</span>),   <span class="comment"># å€¼ä¸ºå…ƒç»„ï¼ˆä¸å¯å˜ï¼‰</span></span><br><span class="line">    <span class="string">&quot;repeat_val&quot;</span>: <span class="number">10</span>  <span class="comment"># é‡å¤å€¼</span></span><br><span class="line">&#125;</span><br><span class="line">dict1[<span class="string">&quot;another_repeat&quot;</span>] = <span class="number">10</span>  <span class="comment"># æ–°å¢é”®ï¼Œå€¼ä¸ä¸Šé¢é‡å¤</span></span><br><span class="line"><span class="built_in">print</span>(dict1)</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š&#123;&#x27;list&#x27;: [1, 2, 3], &#x27;dict&#x27;: &#123;&#x27;a&#x27;: 1&#125;, &#x27;tuple&#x27;: (4, 5), &#x27;repeat_val&#x27;: 10, &#x27;another_repeat&#x27;: 10&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ5ï¼‰ä¸å¯å“ˆå¸Œæ€§">ï¼ˆ5ï¼‰ä¸å¯å“ˆå¸Œæ€§</h3>
<p><strong>ç”±äºå­—å…¸æ˜¯å¯å˜å¯¹è±¡ï¼Œå› æ­¤å®ƒæ˜¯ã€Œä¸å¯å“ˆå¸Œã€çš„ï¼Œæ— æ³•ä½œä¸ºå­—å…¸çš„é”®ï¼ˆkeyï¼‰ï¼Œä¹Ÿæ— æ³•æ”¾å…¥é›†åˆï¼ˆsetï¼‰ä¸­ï¼ˆé›†åˆå…ƒç´ éœ€å¯å“ˆå¸Œï¼‰ã€‚</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å­—å…¸ä½œä¸ºå­—å…¸é”®ï¼ˆæŠ¥é”™ï¼‰</span></span><br><span class="line"><span class="comment"># dict1 = &#123;&#123;&quot;a&quot;:1&#125;: &quot;error&quot;&#125;  # TypeError: unhashable type: &#x27;dict&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å­—å…¸æ”¾å…¥é›†åˆï¼ˆæŠ¥é”™ï¼‰</span></span><br><span class="line"><span class="comment"># set1 = &#123;&#123;&quot;a&quot;:1&#125;, &#123;&quot;b&quot;:2&#125;&#125;  # TypeError: unhashable type: &#x27;dict&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="3-å­—å…¸çš„å¸¸ç”¨æ“ä½œ">3.å­—å…¸çš„å¸¸ç”¨æ“ä½œ</h2>
<p><strong>å­—å…¸çš„æ“ä½œå›´ç»•ã€Œé”®å€¼å¯¹çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥ã€å±•å¼€ï¼Œæä¾›äº†ä¸°å¯Œçš„å†…ç½®æ–¹æ³•ï¼Œæ ¸å¿ƒæ“ä½œåŒ…æ‹¬è®¿é—®å€¼ã€æ·»åŠ /ä¿®æ”¹é”®å€¼å¯¹ã€åˆ é™¤é”®å€¼å¯¹ã€éå†å­—å…¸ç­‰ã€‚</strong></p>
<h3 id="ï¼ˆ1ï¼‰é”®å€¼å¯¹â€œå¢åŠ æ“ä½œâ€ï¼ˆå«â€œæ›´æ–°æ“ä½œâ€ï¼‰">ï¼ˆ1ï¼‰é”®å€¼å¯¹â€œå¢åŠ æ“ä½œâ€ï¼ˆå«â€œæ›´æ–°æ“ä½œâ€ï¼‰</h3>
<p><strong>å­—å…¸çš„å¢åŠ æ“ä½œæ ¸å¿ƒæ˜¯å‘å­—å…¸ä¸­æ·»åŠ æ–°çš„é”®å€¼å¯¹ï¼Œå¸¸ç”¨æ–¹å¼æœ‰3ç§ï¼Œæ ¹æ®åœºæ™¯çµæ´»é€‰æ‹©ï¼š</strong></p>
<ul>
<li><strong>ç›´æ¥èµ‹å€¼ï¼ˆæœ€å¸¸ç”¨ï¼‰</strong>ï¼šé€šè¿‡ å­—å…¸[æ–°é”®] = æ–°å€¼ çš„å½¢å¼æ·»åŠ ï¼Œ<strong>è‹¥é”®ä¸å­˜åœ¨åˆ™æ–°å¢ï¼Œè‹¥é”®å·²å­˜åœ¨åˆ™è¦†ç›–åŸæœ‰å€¼</strong>ï¼›</li>
<li><strong>setdefault() æ–¹æ³•</strong>ï¼šæ·»åŠ é”®å€¼å¯¹ï¼Œ<strong>è‹¥é”®å·²å­˜åœ¨åˆ™è¿”å›åŸæœ‰å€¼ï¼ˆä¸è¦†ç›–ï¼‰ï¼Œè‹¥é”®ä¸å­˜åœ¨åˆ™æ·»åŠ å¹¶è¿”å›é»˜è®¤å€¼ï¼ˆå¦‚æœä¸è®¾ç½®é»˜è®¤å€¼ï¼Œåˆ™è¿”å›Noneï¼‰</strong>ï¼›</li>
<li><strong>update() æ–¹æ³•</strong>ï¼šæ‰¹é‡æ·»åŠ é”®å€¼å¯¹ï¼Œæ”¯æŒ<strong>ä¼ å…¥å­—å…¸</strong>æˆ–<strong>é”®å€¼å¯¹å‚æ•°</strong>,<strong>è‹¥é”®ä¸å­˜åœ¨åˆ™æ–°å¢ï¼Œè‹¥é”®å·²å­˜åœ¨åˆ™è¦†ç›–åŸæœ‰å€¼</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. ç›´æ¥èµ‹å€¼ï¼ˆæ–°å¢é”®å€¼å¯¹ï¼‰</span></span><br><span class="line">dict1 = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;å°æ˜&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">20</span>&#125;</span><br><span class="line">dict1[<span class="string">&quot;score&quot;</span>] = <span class="number">95.5</span>  <span class="comment"># é”®&quot;score&quot;ä¸å­˜åœ¨ï¼Œæ–°å¢</span></span><br><span class="line">dict1[<span class="string">&quot;gender&quot;</span>] = <span class="string">&quot;ç”·&quot;</span>  <span class="comment"># é”®&quot;gender&quot;ä¸å­˜åœ¨ï¼Œæ–°å¢</span></span><br><span class="line"><span class="built_in">print</span>(dict1)  <span class="comment"># &#123;&#x27;name&#x27;: &#x27;å°æ˜&#x27;, &#x27;age&#x27;: 20, &#x27;score&#x27;: 95.5, &#x27;gender&#x27;: &#x27;ç”·&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šé”®å·²å­˜åœ¨æ—¶ä¼šè¦†ç›–</span></span><br><span class="line">dict1[<span class="string">&quot;age&quot;</span>] = <span class="number">21</span>  <span class="comment"># é”®&quot;age&quot;å·²å­˜åœ¨ï¼Œè¦†ç›–åŸæœ‰å€¼</span></span><br><span class="line"><span class="built_in">print</span>(dict1)  <span class="comment"># &#123;&#x27;name&#x27;: &#x27;å°æ˜&#x27;, &#x27;age&#x27;: 21, &#x27;score&#x27;: 95.5, &#x27;gender&#x27;: &#x27;ç”·&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. setdefault() æ–¹æ³•ï¼ˆæ–°å¢ä¸è¦†ç›–ï¼‰</span></span><br><span class="line">dict2 = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;å°çº¢&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">19</span>&#125;</span><br><span class="line"><span class="comment"># é”®ä¸å­˜åœ¨ï¼Œæ–°å¢å¹¶è¿”å›é»˜è®¤å€¼</span></span><br><span class="line">hobby = dict2.setdefault(<span class="string">&quot;hobby&quot;</span>, <span class="string">&quot;ç”»ç”»&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(hobby)  <span class="comment"># ç”»ç”»</span></span><br><span class="line"><span class="built_in">print</span>(dict2)  <span class="comment"># &#123;&#x27;name&#x27;: &#x27;å°çº¢&#x27;, &#x27;age&#x27;: 19, &#x27;hobby&#x27;: &#x27;ç”»ç”»&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é”®ä¸å­˜åœ¨ï¼Œä¸”ä¸è®¾ç½®é»˜è®¤å€¼ï¼Œè¿”å›None</span></span><br><span class="line">d = &#123;&#125;</span><br><span class="line">result = d.setdefault(<span class="string">&quot;key&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)  <span class="comment"># None</span></span><br><span class="line"><span class="built_in">print</span>(d)       <span class="comment"># &#123;&#x27;key&#x27;: None&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># é”®å·²å­˜åœ¨ï¼Œè¿”å›åŸæœ‰å€¼ï¼Œä¸è¦†ç›–</span></span><br><span class="line">age = dict2.setdefault(<span class="string">&quot;age&quot;</span>, <span class="number">20</span>)</span><br><span class="line"><span class="built_in">print</span>(age)  <span class="comment"># 19</span></span><br><span class="line"><span class="built_in">print</span>(dict2)  <span class="comment"># &#123;&#x27;name&#x27;: &#x27;å°çº¢&#x27;, &#x27;age&#x27;: 19, &#x27;hobby&#x27;: &#x27;ç”»ç”»&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. update() æ–¹æ³•ï¼ˆæ‰¹é‡æ–°å¢ï¼‰</span></span><br><span class="line">dict3 = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;å°åˆš&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">22</span>&#125;</span><br><span class="line"><span class="comment"># ä¼ å…¥å­—å…¸æ‰¹é‡æ–°å¢</span></span><br><span class="line">dict3.update(&#123;<span class="string">&quot;score&quot;</span>: <span class="number">88.0</span>, <span class="string">&quot;address&quot;</span>: <span class="string">&quot;åŒ—äº¬&quot;</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(dict3)  <span class="comment"># &#123;&#x27;name&#x27;: &#x27;å°åˆš&#x27;, &#x27;age&#x27;: 22, &#x27;score&#x27;: 88.0, &#x27;address&#x27;: &#x27;åŒ—äº¬&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¼ å…¥é”®å€¼å¯¹å‚æ•°æ‰¹é‡æ–°å¢</span></span><br><span class="line">dict3.update(gender=<span class="string">&quot;ç”·&quot;</span>, hobby=<span class="string">&quot;ç¯®çƒ&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(dict3)  <span class="comment"># &#123;&#x27;name&#x27;: &#x27;å°åˆš&#x27;, &#x27;age&#x27;: 22, &#x27;score&#x27;: 88.0, &#x27;address&#x27;: &#x27;åŒ—äº¬&#x27;, &#x27;gender&#x27;: &#x27;ç”·&#x27;, &#x27;hobby&#x27;: &#x27;ç¯®çƒ&#x27;&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰è®¿é—®å­—å…¸çš„å€¼ï¼ˆ3ç§å¸¸ç”¨æ–¹å¼ï¼‰">ï¼ˆ2ï¼‰è®¿é—®å­—å…¸çš„å€¼ï¼ˆ3ç§å¸¸ç”¨æ–¹å¼ï¼‰</h3>
<ul>
<li><strong>æ–¹æ‹¬å· [] è®¿é—®</strong>ï¼šç›´æ¥é€šè¿‡é”®è®¿é—®ï¼Œé”®ä¸å­˜åœ¨åˆ™æŠ¥é”™ï¼ˆKeyErrorï¼‰</li>
<li><strong>get() æ–¹æ³•è®¿é—®</strong>ï¼šé”®ä¸å­˜åœ¨æ—¶è¿”å›é»˜è®¤å€¼ï¼ˆé»˜è®¤ Noneï¼Œå¯æ‰‹åŠ¨æŒ‡å®šï¼‰ï¼Œä¸ä¼šæŠ¥é”™ï¼ˆ<strong>æ¨èä½¿ç”¨</strong>ï¼‰</li>
<li><strong>values() æ–¹æ³•</strong>ï¼šè·å–æ‰€æœ‰å€¼ç»„æˆçš„å¯è¿­ä»£å¯¹è±¡ï¼ˆè§†å›¾å¯¹è±¡ï¼‰ï¼Œå¯ç”¨äºè½¬ä¸ºåˆ—è¡¨ç­‰</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dict1 = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;å°æ˜&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">20</span>, <span class="string">&quot;score&quot;</span>: <span class="number">95.5</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. æ–¹æ‹¬å· [] è®¿é—®</span></span><br><span class="line"><span class="built_in">print</span>(dict1[<span class="string">&quot;name&quot;</span>])  <span class="comment"># å°æ˜</span></span><br><span class="line"><span class="comment"># print(dict1[&quot;gender&quot;])  # KeyError: &#x27;gender&#x27;ï¼ˆé”®ä¸å­˜åœ¨æŠ¥é”™ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. get() æ–¹æ³•è®¿é—®ï¼ˆæ¨èï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(dict1.get(<span class="string">&quot;age&quot;</span>))  <span class="comment"># 20</span></span><br><span class="line"><span class="built_in">print</span>(dict1.get(<span class="string">&quot;gender&quot;</span>))  <span class="comment"># Noneï¼ˆé”®ä¸å­˜åœ¨ï¼Œè¿”å›é»˜è®¤å€¼ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(dict1.get(<span class="string">&quot;gender&quot;</span>, <span class="string">&quot;æœªçŸ¥&quot;</span>))  <span class="comment"># æœªçŸ¥ï¼ˆæŒ‡å®šé»˜è®¤å€¼ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. values() æ–¹æ³•ï¼ˆè·å–æ‰€æœ‰å€¼ï¼‰</span></span><br><span class="line">values = dict1.values()</span><br><span class="line"><span class="built_in">print</span>(values)  <span class="comment"># dict_values([&#x27;å°æ˜&#x27;, 20, 95.5])ï¼ˆè§†å›¾å¯¹è±¡ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(values))  <span class="comment"># [&#x27;å°æ˜&#x27;, 20, 95.5]ï¼ˆè½¬ä¸ºåˆ—è¡¨ï¼‰</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰â€œè·å–ã€åˆ¤æ–­â€å­—å…¸çš„é”®">ï¼ˆ3ï¼‰â€œè·å–ã€åˆ¤æ–­â€å­—å…¸çš„é”®</h3>
<ul>
<li><strong>keys() æ–¹æ³•</strong>ï¼šè·å–æ‰€æœ‰é”®ç»„æˆçš„å¯è¿­ä»£å¯¹è±¡ï¼ˆè§†å›¾å¯¹è±¡ï¼‰,å¯ç”¨äºè½¬ä¸ºåˆ—è¡¨ç­‰</li>
<li><strong>items() æ–¹æ³•</strong>ï¼šè·å–æ‰€æœ‰é”®å€¼å¯¹ç»„æˆçš„å¯è¿­ä»£å¯¹è±¡ï¼ˆ<strong>æ¯ä¸ªå…ƒç´ æ˜¯ (key, value) å…ƒç»„</strong>ï¼‰</li>
<li><strong>in / not in</strong>ï¼šåˆ¤æ–­é”®æ˜¯å¦å­˜åœ¨äºå­—å…¸ä¸­ï¼ˆ<strong>åˆ¤æ–­çš„æ˜¯é”®ï¼Œä¸æ˜¯å€¼</strong>ï¼‰</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dict1 = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;å°æ˜&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">20</span>, <span class="string">&quot;score&quot;</span>: <span class="number">95.5</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. keys() æ–¹æ³•ï¼ˆè·å–æ‰€æœ‰é”®ï¼‰</span></span><br><span class="line">keys = dict1.keys()</span><br><span class="line"><span class="built_in">print</span>(keys)  <span class="comment"># dict_keys([&#x27;name&#x27;, &#x27;age&#x27;, &#x27;score&#x27;])ï¼ˆè§†å›¾å¯¹è±¡ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(keys))  <span class="comment"># [&#x27;name&#x27;, &#x27;age&#x27;, &#x27;score&#x27;]ï¼ˆè½¬ä¸ºåˆ—è¡¨ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. items() æ–¹æ³•ï¼ˆè·å–æ‰€æœ‰é”®å€¼å¯¹ï¼‰</span></span><br><span class="line">items = dict1.items()</span><br><span class="line"><span class="built_in">print</span>(items)  <span class="comment"># dict_items([(&#x27;name&#x27;, &#x27;å°æ˜&#x27;), (&#x27;age&#x27;, 20)])ï¼ˆè§†å›¾å¯¹è±¡ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(items))  <span class="comment"># [(&#x27;name&#x27;, &#x27;å°æ˜&#x27;), (&#x27;age&#x27;, 20)]ï¼ˆè½¬ä¸ºåˆ—è¡¨ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. æˆå‘˜åˆ¤æ–­ï¼ˆin / not inï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;name&quot;</span> <span class="keyword">in</span> dict1)  <span class="comment"># Trueï¼ˆé”®å­˜åœ¨ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;gender&quot;</span> <span class="keyword">in</span> dict1)  <span class="comment"># Falseï¼ˆé”®ä¸å­˜åœ¨ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å°æ˜&quot;</span> <span class="keyword">in</span> dict1)  <span class="comment"># Falseï¼ˆåˆ¤æ–­çš„æ˜¯é”®ï¼Œä¸æ˜¯å€¼ï¼‰</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ4ï¼‰åˆ é™¤é”®å€¼å¯¹ï¼ˆ4ç§å¸¸ç”¨æ–¹å¼ï¼‰">ï¼ˆ4ï¼‰åˆ é™¤é”®å€¼å¯¹ï¼ˆ4ç§å¸¸ç”¨æ–¹å¼ï¼‰</h3>
<ul>
<li><strong>del è¯­å¥</strong>ï¼šé€šè¿‡é”®åˆ é™¤æŒ‡å®šé”®å€¼å¯¹ï¼Œé”®ä¸å­˜åœ¨åˆ™æŠ¥é”™</li>
<li><strong>pop() æ–¹æ³•</strong>ï¼šåˆ é™¤æŒ‡å®šé”®çš„é”®å€¼å¯¹ï¼Œå¹¶è¿”å›å¯¹åº”çš„å€¼ï¼Œé”®ä¸å­˜åœ¨å¯æŒ‡å®šé»˜è®¤å€¼</li>
<li><strong>popitem() æ–¹æ³•</strong>ï¼šåˆ é™¤å¹¶è¿”å›æœ€åæ’å…¥çš„é”®å€¼å¯¹ï¼ˆå…ƒç»„å½¢å¼ï¼‰ï¼Œç©ºå­—å…¸è°ƒç”¨æŠ¥é”™</li>
<li><strong>clear() æ–¹æ³•</strong>ï¼šæ¸…ç©ºå­—å…¸ä¸­æ‰€æœ‰é”®å€¼å¯¹ï¼Œè¿”å›ç©ºå­—å…¸</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dict1 = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;å°æ˜&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">20</span>, <span class="string">&quot;score&quot;</span>: <span class="number">95.5</span>, <span class="string">&quot;gender&quot;</span>: <span class="string">&quot;ç”·&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. del è¯­å¥</span></span><br><span class="line"><span class="keyword">del</span> dict1[<span class="string">&quot;gender&quot;</span>]</span><br><span class="line"><span class="built_in">print</span>(dict1)  <span class="comment"># &#123;&#x27;name&#x27;: &#x27;å°æ˜&#x27;, &#x27;age&#x27;: 20, &#x27;score&#x27;: 95.5&#125;</span></span><br><span class="line"><span class="comment"># del dict1[&quot;address&quot;]  # KeyError: &#x27;address&#x27;ï¼ˆé”®ä¸å­˜åœ¨æŠ¥é”™ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. pop() æ–¹æ³•</span></span><br><span class="line">score = dict1.pop(<span class="string">&quot;score&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(score)  <span class="comment"># 95.5ï¼ˆè¿”å›åˆ é™¤çš„å€¼ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(dict1)  <span class="comment"># &#123;&#x27;name&#x27;: &#x27;å°æ˜&#x27;, &#x27;age&#x27;: 20&#125;</span></span><br><span class="line"><span class="comment"># é”®ä¸å­˜åœ¨æ—¶æŒ‡å®šé»˜è®¤å€¼</span></span><br><span class="line">address = dict1.pop(<span class="string">&quot;address&quot;</span>, <span class="string">&quot;æœªçŸ¥&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(address)  <span class="comment"># æœªçŸ¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. popitem() æ–¹æ³•ï¼ˆåˆ é™¤æœ€åæ’å…¥çš„é”®å€¼å¯¹ï¼‰</span></span><br><span class="line">item = dict1.popitem()</span><br><span class="line"><span class="built_in">print</span>(item)  <span class="comment"># (&#x27;age&#x27;, 20)ï¼ˆè¿”å›åˆ é™¤çš„é”®å€¼å¯¹å…ƒç»„ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(dict1)  <span class="comment"># &#123;&#x27;name&#x27;: &#x27;å°æ˜&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. clear() æ–¹æ³•ï¼ˆæ¸…ç©ºå­—å…¸ï¼‰</span></span><br><span class="line">dict1.clear()</span><br><span class="line"><span class="built_in">print</span>(dict1)  <span class="comment"># &#123;&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ5ï¼‰å­—å…¸çš„éå†ï¼ˆ3ç§æ ¸å¿ƒåœºæ™¯ï¼‰">ï¼ˆ5ï¼‰å­—å…¸çš„éå†ï¼ˆ3ç§æ ¸å¿ƒåœºæ™¯ï¼‰</h3>
<p><strong>æ ¸å¿ƒé€»è¾‘ï¼šå­—å…¸é»˜è®¤éå†çš„æ˜¯é”®ï¼Œé€šè¿‡ keys()ã€values()ã€items() æ–¹æ³•å¯åˆ†åˆ«è·å–â€œé”®â€ã€â€œå€¼â€ã€â€œé”®å€¼å¯¹â€çš„å¯è¿­ä»£å¯¹è±¡ï¼ˆè§†å›¾å¯¹è±¡ï¼‰ï¼Œè¿›è€Œå®ç°é’ˆå¯¹æ€§éå†ã€‚</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dict1 = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;å°æ˜&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">20</span>, <span class="string">&quot;score&quot;</span>: <span class="number">95.5</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. éå†é”®ï¼ˆæœ€å¸¸ç”¨ï¼Œé»˜è®¤éå†é”®ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;éå†é”®ï¼š&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> dict1:</span><br><span class="line">    <span class="built_in">print</span>(key)  <span class="comment"># nameã€ageã€score</span></span><br><span class="line"><span class="comment"># ç­‰ä»·äºï¼šfor key in dict1.keys():</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. éå†å€¼</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\néå†å€¼ï¼š&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> dict1.values():</span><br><span class="line">    <span class="built_in">print</span>(value)  <span class="comment"># å°æ˜ã€20ã€95.5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. éå†é”®å€¼å¯¹ï¼ˆæœ€å®ç”¨ï¼Œé€šè¿‡ items() æ–¹æ³•ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\néå†é”®å€¼å¯¹ï¼š&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> dict1.items():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;key&#125;</span>: <span class="subst">&#123;value&#125;</span>&quot;</span>)</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment"># name: å°æ˜</span></span><br><span class="line"><span class="comment"># age: 20</span></span><br><span class="line"><span class="comment"># score: 95.5</span></span><br></pre></td></tr></table></figure>
<h3 id="è¡¥å……ï¼šè§†å›¾å¯¹è±¡">è¡¥å……ï¼šè§†å›¾å¯¹è±¡</h3>
<h4 id="1-è§†å›¾å¯¹è±¡çš„æ ¸å¿ƒå®šä¹‰">&lt;1&gt;è§†å›¾å¯¹è±¡çš„æ ¸å¿ƒå®šä¹‰</h4>
<p><strong>è§†å›¾å¯¹è±¡æ˜¯é€šè¿‡å­—å…¸çš„ keys()ã€values()ã€items() æ–¹æ³•è¿”å›çš„å¯¹è±¡ï¼ˆåˆ†åˆ«å¯¹åº”ã€Œé”®è§†å›¾ã€ã€Œå€¼è§†å›¾ã€ã€Œé”®å€¼å¯¹è§†å›¾ã€ï¼‰ï¼Œç‰¹ç‚¹æ˜¯ï¼š</strong></p>
<ul>
<li><strong>åŠ¨æ€å…³è”</strong>ï¼šè§†å›¾å¯¹è±¡<strong>ä¸å­˜å‚¨æ•°æ®</strong>ï¼Œè€Œæ˜¯å®æ—¶æ˜ å°„åŸå­—å…¸çš„å†…å®¹ â€”â€” <strong>åŸå­—å…¸ä¿®æ”¹åï¼Œè§†å›¾å¯¹è±¡ä¼šç«‹å³åæ˜ å‡ºå˜åŒ–</strong>ï¼›</li>
<li><strong>ä¸å¯ä¿®æ”¹</strong>ï¼šè§†å›¾å¯¹è±¡æœ¬èº«ä¸èƒ½ç›´æ¥å¢åˆ æ”¹ï¼ˆæ¯”å¦‚ä¸èƒ½ç»™ dict.keys() è¿”å›çš„å¯¹è±¡åŠ å…ƒç´ ï¼‰ï¼Œä½†å¯é€šè¿‡åŸå­—å…¸ä¿®æ”¹ï¼Œè§†å›¾ä¼šåŒæ­¥ï¼›</li>
<li><strong>å¯è¿­ä»£</strong>ï¼šå¯ä»¥ç”¨ for å¾ªç¯éå†ï¼Œä¹Ÿæ”¯æŒéƒ¨åˆ†é›†åˆæ“ä½œï¼ˆå¦‚åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼‰ã€‚</li>
</ul>
<h4 id="2-ä¸‰ç±»è§†å›¾å¯¹è±¡åŠåŸºç¡€ç”¨æ³•">&lt;2&gt;ä¸‰ç±»è§†å›¾å¯¹è±¡åŠåŸºç¡€ç”¨æ³•</h4>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260110102612554.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆå§‹åŒ–å­—å…¸</span></span><br><span class="line">student = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">25</span>, <span class="string">&quot;city&quot;</span>: <span class="string">&quot;åŒ—äº¬&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. é”®è§†å›¾ï¼ˆdict_keysï¼‰</span></span><br><span class="line">key_view = student.keys()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;é”®è§†å›¾å¯¹è±¡ï¼š&quot;</span>, key_view)  <span class="comment"># é”®è§†å›¾å¯¹è±¡ï¼š dict_keys([&#x27;name&#x27;, &#x27;age&#x27;, &#x27;city&#x27;])</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;éå†é”®è§†å›¾ï¼š&quot;</span>, end=<span class="string">&quot; &quot;</span>)</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> key_view:</span><br><span class="line">    <span class="built_in">print</span>(k, end=<span class="string">&quot; &quot;</span>)  <span class="comment"># éå†é”®è§†å›¾ï¼š name age city</span></span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. å€¼è§†å›¾ï¼ˆdict_valuesï¼‰</span></span><br><span class="line">value_view = student.values()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å€¼è§†å›¾å¯¹è±¡ï¼š&quot;</span>, value_view)  <span class="comment"># å€¼è§†å›¾å¯¹è±¡ï¼š dict_values([&#x27;å¼ ä¸‰&#x27;, 25, &#x27;åŒ—äº¬&#x27;])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. é”®å€¼å¯¹è§†å›¾ï¼ˆdict_itemsï¼‰</span></span><br><span class="line">item_view = student.items()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;é”®å€¼å¯¹è§†å›¾å¯¹è±¡ï¼š&quot;</span>, item_view)  <span class="comment"># é”®å€¼å¯¹è§†å›¾å¯¹è±¡ï¼š dict_items([(&#x27;name&#x27;, &#x27;å¼ ä¸‰&#x27;), (&#x27;age&#x27;, 25), (&#x27;city&#x27;, &#x27;åŒ—äº¬&#x27;)])</span></span><br><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> item_view:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;k&#125;</span>: <span class="subst">&#123;v&#125;</span>&quot;</span>)  <span class="comment"># é€è¡Œè¾“å‡º name: å¼ ä¸‰ / age:25 / city:åŒ—äº¬</span></span><br></pre></td></tr></table></figure>
<h4 id="3-è§†å›¾å¯¹è±¡çš„æ ¸å¿ƒç‰¹æ€§ï¼ˆé‡ç‚¹ï¼‰">&lt;3&gt;è§†å›¾å¯¹è±¡çš„æ ¸å¿ƒç‰¹æ€§ï¼ˆé‡ç‚¹ï¼‰</h4>
<h5 id="ç‰¹æ€§1ï¼šåŠ¨æ€å…³è”åŸå­—å…¸ï¼ˆæœ€æ ¸å¿ƒï¼‰">ç‰¹æ€§1ï¼šåŠ¨æ€å…³è”åŸå­—å…¸ï¼ˆæœ€æ ¸å¿ƒï¼‰</h5>
<p><strong>è§†å›¾å¯¹è±¡ä¸å¤åˆ¶æ•°æ®ï¼ŒåŸå­—å…¸ä¿®æ”¹åï¼Œè§†å›¾ä¼šå®æ—¶æ›´æ–°ï¼Œè¿™æ˜¯å’Œåˆ—è¡¨æœ€å¤§çš„åŒºåˆ«</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆå§‹åŒ–å­—å…¸</span></span><br><span class="line">student = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">25</span>, <span class="string">&quot;city&quot;</span>: <span class="string">&quot;åŒ—äº¬&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># é”®è§†å›¾ï¼ˆdict_keysï¼‰</span></span><br><span class="line">key_view = student.keys()</span><br><span class="line"><span class="comment"># å€¼è§†å›¾ï¼ˆdict_valuesï¼‰</span></span><br><span class="line">value_view = student.values()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;ä¿®æ”¹å‰å€¼è§†å›¾ï¼š&quot;</span>, value_view)  <span class="comment"># ä¿®æ”¹å‰å€¼è§†å›¾ï¼š dict_values([&#x27;å¼ ä¸‰&#x27;, 25, &#x27;åŒ—äº¬&#x27;])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹åŸå­—å…¸çš„å†…å®¹</span></span><br><span class="line">student[<span class="string">&quot;age&quot;</span>] = <span class="number">26</span>  <span class="comment"># è¦†ç›–å·²æœ‰å€¼</span></span><br><span class="line">student[<span class="string">&quot;gender&quot;</span>] = <span class="string">&quot;ç”·&quot;</span>  <span class="comment"># æ–°å¢é”®å€¼å¯¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§†å›¾å¯¹è±¡è‡ªåŠ¨åŒæ­¥å˜åŒ–ï¼ˆæ— éœ€é‡æ–°è·å–ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;ä¿®æ”¹åå€¼è§†å›¾ï¼š&quot;</span>, value_view)  <span class="comment"># ä¿®æ”¹åå€¼è§†å›¾ï¼š dict_values([&#x27;å¼ ä¸‰&#x27;, 26, &#x27;åŒ—äº¬&#x27;, &#x27;ç”·&#x27;])</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;ä¿®æ”¹åé”®è§†å›¾ï¼š&quot;</span>, key_view)    <span class="comment"># ä¿®æ”¹åé”®è§†å›¾ï¼š dict_keys([&#x27;name&#x27;, &#x27;age&#x27;, &#x27;city&#x27;, &#x27;gender&#x27;])</span></span><br></pre></td></tr></table></figure>
<h5 id="ç‰¹æ€§2ï¼šä¸å¯ç›´æ¥ä¿®æ”¹ï¼Œä½†å¯åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨">ç‰¹æ€§2ï¼šä¸å¯ç›´æ¥ä¿®æ”¹ï¼Œä½†å¯åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨</h5>
<p><strong>å›¾å¯¹è±¡æœ¬èº«ä¸èƒ½å¢åˆ æ”¹ï¼Œä½†è‹¥æƒ³ä¿®æ”¹å†…å®¹ï¼Œéœ€æ“ä½œåŸå­—å…¸ï¼›åŒæ—¶æ”¯æŒ in æ“ä½œåˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆå§‹åŒ–å­—å…¸</span></span><br><span class="line">student = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">25</span>, <span class="string">&quot;city&quot;</span>: <span class="string">&quot;åŒ—äº¬&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># é”®è§†å›¾ï¼ˆdict_keysï¼‰</span></span><br><span class="line">key_view = student.keys()</span><br><span class="line"><span class="comment"># å€¼è§†å›¾ï¼ˆdict_valuesï¼‰</span></span><br><span class="line">value_view = student.values()</span><br><span class="line"><span class="comment"># é”®å€¼å¯¹è§†å›¾ï¼ˆdict_itemsï¼‰</span></span><br><span class="line">item_view = student.items()</span><br><span class="line"><span class="comment"># 1. åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼ˆæ”¯æŒï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;name&quot;</span> <span class="keyword">in</span> key_view)  <span class="comment"># Trueï¼ˆé”®è§†å›¾åˆ¤æ–­é”®æ˜¯å¦å­˜åœ¨ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="number">25</span> <span class="keyword">in</span> value_view)    <span class="comment"># Trueï¼ˆå€¼è§†å›¾åˆ¤æ–­å€¼æ˜¯å¦å­˜åœ¨ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>((<span class="string">&#x27;age&#x27;</span>, <span class="number">25</span>) <span class="keyword">in</span> item_view)  <span class="comment"># Trueï¼ˆé”®å€¼å¯¹è§†å›¾åˆ¤æ–­é”®å€¼å¯¹æ˜¯å¦å­˜åœ¨ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. å°è¯•ç›´æ¥ä¿®æ”¹è§†å›¾ï¼ˆæŠ¥é”™ï¼‰</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    key_view.append(<span class="string">&quot;hobby&quot;</span>)  <span class="comment"># è§†å›¾å¯¹è±¡æ— appendæ–¹æ³•</span></span><br><span class="line"><span class="keyword">except</span> AttributeError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;æŠ¥é”™ï¼š&quot;</span>, e)  <span class="comment"># æŠ¥é”™ï¼š &#x27;dict_keys&#x27; object has no attribute &#x27;append&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. æ­£ç¡®ä¿®æ”¹æ–¹å¼ï¼šæ“ä½œåŸå­—å…¸ï¼Œè§†å›¾è‡ªåŠ¨åŒæ­¥</span></span><br><span class="line">student[<span class="string">&quot;hobby&quot;</span>] = <span class="string">&quot;ç¯®çƒ&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;æ–°å¢hobbyåé”®è§†å›¾ï¼š&quot;</span>, key_view)  <span class="comment"># ä¿®æ”¹åé”®è§†å›¾ï¼š dict_keys([&#x27;name&#x27;, &#x27;age&#x27;, &#x27;city&#x27;, &#x27;gender&#x27;,&#x27;hobby&#x27;])</span></span><br></pre></td></tr></table></figure>
<h5 id="ç‰¹æ€§3ï¼šå¯è½¬ä¸ºåˆ—è¡¨-é›†åˆï¼ˆæŒ‰éœ€å¤åˆ¶æ•°æ®ï¼‰">ç‰¹æ€§3ï¼šå¯è½¬ä¸ºåˆ—è¡¨/é›†åˆï¼ˆæŒ‰éœ€å¤åˆ¶æ•°æ®ï¼‰</h5>
<p><strong>è‹¥éœ€è¦å¯¹â€œé”®/å€¼/é”®å€¼å¯¹â€åšå¢åˆ æ”¹ã€åˆ‡ç‰‡ç­‰æ“ä½œï¼Œå¯å°†è§†å›¾å¯¹è±¡è½¬ä¸ºåˆ—è¡¨/é›†åˆï¼ˆæ­¤æ—¶ä¼šå¤åˆ¶æ•°æ®ï¼Œä¸å†å…³è”åŸå­—å…¸ï¼‰ï¼š</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è§†å›¾è½¬åˆ—è¡¨ï¼ˆå¤åˆ¶æ•°æ®ï¼Œåç»­ä¿®æ”¹åˆ—è¡¨ä¸å½±å“åŸå­—å…¸ï¼‰</span></span><br><span class="line">key_list = <span class="built_in">list</span>(key_view)</span><br><span class="line">key_list.append(<span class="string">&quot;score&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;åˆ—è¡¨æ–°å¢å…ƒç´ ï¼š&quot;</span>, key_list)  <span class="comment"># [&#x27;name&#x27;, &#x27;age&#x27;, &#x27;city&#x27;, &#x27;gender&#x27;, &#x27;hobby&#x27;, &#x27;score&#x27;]</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;åŸå­—å…¸é”®è§†å›¾ï¼š&quot;</span>, key_view)  <span class="comment"># ä»ä¸º [&#x27;name&#x27;, &#x27;age&#x27;, &#x27;city&#x27;, &#x27;gender&#x27;, &#x27;hobby&#x27;]ï¼ˆæ— scoreï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§†å›¾è½¬é›†åˆï¼ˆæ”¯æŒé›†åˆè¿ç®—ï¼‰</span></span><br><span class="line">value_set = <span class="built_in">set</span>(value_view)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å€¼é›†åˆï¼š&quot;</span>, value_set)  <span class="comment"># &#123;&#x27;å¼ ä¸‰&#x27;, 26, &#x27;åŒ—äº¬&#x27;, &#x27;ç”·&#x27;, &#x27;ç¯®çƒ&#x27;&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="4-å­—å…¸çš„å¸¸ç”¨å†…ç½®å‡½æ•°ä¸æ–¹æ³•">4.å­—å…¸çš„å¸¸ç”¨å†…ç½®å‡½æ•°ä¸æ–¹æ³•</h2>
<h3 id="ï¼ˆ1ï¼‰å†…ç½®å‡½æ•°ï¼ˆå…¨å±€å‡½æ•°ï¼Œç›´æ¥è°ƒç”¨ï¼‰-3">ï¼ˆ1ï¼‰å†…ç½®å‡½æ•°ï¼ˆå…¨å±€å‡½æ•°ï¼Œç›´æ¥è°ƒç”¨ï¼‰</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260110103442591.png" alt=""></p>
<h3 id="ï¼ˆ2ï¼‰å­—å…¸å¯¹è±¡æ–¹æ³•ï¼ˆd-æ–¹æ³•å-ï¼‰">ï¼ˆ2ï¼‰å­—å…¸å¯¹è±¡æ–¹æ³•ï¼ˆd.æ–¹æ³•å()ï¼‰</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260110103756223.png" alt=""></p>
<h2 id="5-å­—å…¸ä¸å…ƒç»„ã€åˆ—è¡¨çš„æ ¸å¿ƒåŒºåˆ«">5.å­—å…¸ä¸å…ƒç»„ã€åˆ—è¡¨çš„æ ¸å¿ƒåŒºåˆ«</h2>
<p><strong>å­—å…¸ã€å…ƒç»„ã€åˆ—è¡¨æ˜¯ Python ä¸­æœ€å¸¸ç”¨çš„ä¸‰ç§å®¹å™¨ç±»å‹ï¼Œæ ¸å¿ƒå·®å¼‚åœ¨äºã€Œæ•°æ®ç»„ç»‡æ–¹å¼ã€å’Œã€Œå¯å˜æ€§ã€ï¼Œé€‚ç”¨åœºæ™¯å®Œå…¨ä¸åŒã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†å¯¹æ¯”ï¼š</strong><br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260110104027376.png" alt=""></p>
<h2 id="6-å­—å…¸çš„å…³é”®æ³¨æ„äº‹é¡¹">6.å­—å…¸çš„å…³é”®æ³¨æ„äº‹é¡¹</h2>
<ul>
<li><strong>é”®çš„é€‰æ‹©åŸåˆ™</strong>
<ul>
<li>ä¼˜å…ˆä½¿ç”¨å­—ç¬¦ä¸²ä½œä¸ºé”®ï¼ˆè¯­ä¹‰æ¸…æ™°ï¼Œé€šç”¨æ€§å¼ºï¼‰</li>
<li>é¿å…ä½¿ç”¨å¤æ‚ä¸å¯å˜å¯¹è±¡ï¼ˆå¦‚åµŒå¥—å…ƒç»„ï¼‰</li>
<li><strong>é”®å¿…é¡»å”¯ä¸€ï¼Œé‡å¤é”®ä¼šè¦†ç›–å‰é¢çš„å€¼</strong></li>
</ul>
</li>
<li><strong>è®¿é—®å€¼çš„æ¨èæ–¹å¼</strong>
<ul>
<li>ä¼˜å…ˆä½¿ç”¨ get() æ–¹æ³•è®¿é—®å€¼ï¼Œè€Œéæ–¹æ‹¬å· []ï¼Œå¯é¿å…é”®ä¸å­˜åœ¨æ—¶çš„ KeyError æŠ¥é”™ï¼Œæå‡ä»£ç ç¨³å®šæ€§ã€‚</li>
</ul>
</li>
<li><strong>å­—å…¸çš„æµ…æ‹·è´ä¸æ·±æ‹·è´</strong>
<ul>
<li><strong>æµ…æ‹·è´</strong>ï¼ˆd.copy()ã€dict(d)ï¼‰ï¼šä»…å¤åˆ¶å­—å…¸æœ¬èº«ï¼Œå€¼ä¸ºå¼•ç”¨ï¼ˆè‹¥å€¼æ˜¯å¯å˜å¯¹è±¡ï¼Œä¿®æ”¹åŸå­—å…¸çš„å€¼ä¼šå½±å“æ‹·è´åçš„å­—å…¸ï¼‰ï¼›</li>
<li><strong>æ·±æ‹·è´</strong>ï¼ˆéœ€å¯¼å…¥ copy æ¨¡å—ï¼Œcopy.deepcopy(d)ï¼‰ï¼šå®Œå…¨å¤åˆ¶å­—å…¸åŠæ‰€æœ‰å€¼å¯¹è±¡ï¼ŒåŸå­—å…¸ä¸æ‹·è´å­—å…¸ç›¸äº’ç‹¬ç«‹ã€‚</li>
</ul>
</li>
<li><strong>é¿å…åœ¨éå†å­—å…¸æ—¶ä¿®æ”¹ç»“æ„</strong>
<ul>
<li>éå†å­—å…¸ï¼ˆå¦‚ for key in dï¼‰æ—¶ï¼Œ<strong>ç¦æ­¢ç›´æ¥æ·»åŠ /åˆ é™¤é”®å€¼å¯¹ï¼ˆä¼šå¯¼è‡´éå†å¼‚å¸¸ï¼‰</strong></li>
<li>è‹¥éœ€ä¿®æ”¹ï¼Œå¯å…ˆéå†å­—å…¸çš„é”®åˆ—è¡¨ï¼ˆfor key in list(d.keys())ï¼‰</li>
</ul>
</li>
<li><strong>ç©ºå­—å…¸çš„åˆ¤æ–­</strong>
<ul>
<li>åˆ¤æ–­å­—å…¸æ˜¯å¦ä¸ºç©ºï¼Œ<strong>ä¼˜å…ˆä½¿ç”¨ if not d:ï¼ˆç®€æ´é«˜æ•ˆï¼‰</strong>ï¼Œè€Œé if len(d) == 0:</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. æµ…æ‹·è´ vs æ·±æ‹·è´ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line">d1 = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;å°æ˜&quot;</span>, <span class="string">&quot;hobbies&quot;</span>: [<span class="string">&quot;ç¯®çƒ&quot;</span>, <span class="string">&quot;æ¸¸æˆ&quot;</span>]&#125;</span><br><span class="line">d2 = d1.copy()  <span class="comment"># æµ…æ‹·è´</span></span><br><span class="line">d3 = copy.deepcopy(d1)  <span class="comment"># æ·±æ‹·è´</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹åŸå­—å…¸çš„å¯å˜å€¼ï¼ˆhobbiesåˆ—è¡¨ï¼‰</span></span><br><span class="line">d1[<span class="string">&quot;hobbies&quot;</span>].append(<span class="string">&quot;è¯»ä¹¦&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(d2[<span class="string">&quot;hobbies&quot;</span>])  <span class="comment"># [&#x27;ç¯®çƒ&#x27;, &#x27;æ¸¸æˆ&#x27;, &#x27;è¯»ä¹¦&#x27;]ï¼ˆæµ…æ‹·è´å—å½±å“ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(d3[<span class="string">&quot;hobbies&quot;</span>])  <span class="comment"># [&#x27;ç¯®çƒ&#x27;, &#x27;æ¸¸æˆ&#x27;]ï¼ˆæ·±æ‹·è´ä¸å—å½±å“ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. éå†å­—å…¸æ—¶ä¿®æ”¹ç»“æ„ï¼ˆæ­£ç¡®åšæ³•ï¼‰</span></span><br><span class="line">d4 = &#123;<span class="string">&quot;a&quot;</span>:<span class="number">1</span>, <span class="string">&quot;b&quot;</span>:<span class="number">2</span>, <span class="string">&quot;c&quot;</span>:<span class="number">3</span>&#125;</span><br><span class="line"><span class="comment"># é”™è¯¯ï¼šç›´æ¥éå†å­—å…¸æ—¶åˆ é™¤é”®</span></span><br><span class="line"><span class="comment"># for key in d4:</span></span><br><span class="line"><span class="comment">#     del d4[key]  # RuntimeError: dictionary changed size during iteration</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­£ç¡®ï¼šéå†é”®åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> <span class="built_in">list</span>(d4.keys()):</span><br><span class="line">    <span class="keyword">del</span> d4[key]</span><br><span class="line"><span class="built_in">print</span>(d4)  <span class="comment"># &#123;&#125;ï¼ˆæ­£å¸¸æ¸…ç©ºï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. ç©ºå­—å…¸åˆ¤æ–­</span></span><br><span class="line">d5 = &#123;&#125;</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> d5:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å­—å…¸ä¸ºç©º&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šå­—å…¸ä¸ºç©º</span></span><br></pre></td></tr></table></figure>
<hr>
<h1>äº”ã€åˆ†æ”¯ç»“æ„ï¼ˆifã€match-caseï¼‰</h1>
<h2 id="1-if-è¯­å¥ï¼šçµæ´»é€‚é…å¤æ‚æ¡ä»¶çš„åŸºç¡€åˆ†æ”¯">1.if è¯­å¥ï¼šçµæ´»é€‚é…å¤æ‚æ¡ä»¶çš„åŸºç¡€åˆ†æ”¯</h2>
<ul>
<li><strong>if è¯­å¥æ˜¯ Python ä¸­æœ€åŸºç¡€ã€æœ€å¸¸ç”¨çš„åˆ†æ”¯ç»“æ„ï¼Œæ ¸å¿ƒé€»è¾‘æ˜¯ã€Œåˆ¤æ–­æ¡ä»¶è¡¨è¾¾å¼çš„å¸ƒå°”å€¼ï¼ˆTrue/Falseï¼‰ï¼Œæ‰§è¡Œå¯¹åº”ä»£ç å—ã€ã€‚</strong></li>
<li><strong>æ”¯æŒå•åˆ†æ”¯ã€åŒåˆ†æ”¯ã€å¤šåˆ†æ”¯ä¸‰ç§å½¢å¼ï¼Œå¯çµæ´»åº”å¯¹ä»ç®€å•åˆ°å¤æ‚çš„å„ç±»æ¡ä»¶åˆ¤æ–­åœºæ™¯ã€‚</strong></li>
</ul>
<h3 id="ï¼ˆ1ï¼‰æ ¸å¿ƒè¯­æ³•ä¸ç»“æ„ï¼ˆæœ‰åŸºç¡€çš„å¯è·³è¿‡è¿™èŠ‚ï¼‰">ï¼ˆ1ï¼‰æ ¸å¿ƒè¯­æ³•ä¸ç»“æ„ï¼ˆæœ‰åŸºç¡€çš„å¯è·³è¿‡è¿™èŠ‚ï¼‰</h3>
<p><strong>Python ä¸­ if è¯­å¥çš„è¯­æ³•æ ¸å¿ƒæ˜¯ã€Œæ¡ä»¶è¡¨è¾¾å¼ + ç¼©è¿›ä»£ç å—ã€ï¼Œç¼©è¿›ï¼ˆé€šå¸¸ 4 ä¸ªç©ºæ ¼ï¼‰æ˜¯åŒºåˆ†ä»£ç å—å½’å±çš„å…³é”®ï¼ˆæ— å¤§æ‹¬å· {} åŒ…è£¹ï¼‰ã€‚</strong></p>
<h4 id="1-å•åˆ†æ”¯ï¼šæ»¡è¶³æ¡ä»¶æ‰æ‰§è¡Œ">&lt;1&gt;å•åˆ†æ”¯ï¼šæ»¡è¶³æ¡ä»¶æ‰æ‰§è¡Œ</h4>
<p><strong>é€‚ç”¨åœºæ™¯ï¼šä»…éœ€åœ¨æŸä¸ªæ¡ä»¶æˆç«‹æ—¶æ‰§è¡Œä¸€æ®µä»£ç ï¼Œä¸æˆç«‹åˆ™è·³è¿‡</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¯­æ³•ç»“æ„</span></span><br><span class="line"><span class="keyword">if</span> æ¡ä»¶è¡¨è¾¾å¼:</span><br><span class="line">    ç¼©è¿›çš„ä»£ç å—  <span class="comment"># æ¡ä»¶ä¸º True æ—¶æ‰§è¡Œï¼ŒFalse åˆ™è·³è¿‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®æˆ˜ç¤ºä¾‹ï¼šåˆ¤æ–­æ•°å€¼æ˜¯å¦ä¸ºæ­£æ•°</span></span><br><span class="line">num = <span class="number">15</span></span><br><span class="line"><span class="keyword">if</span> num &gt; <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;num&#125;</span> æ˜¯æ­£æ•°&quot;</span>)  <span class="comment"># è¾“å‡ºï¼š15 æ˜¯æ­£æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¡ä»¶ä¸æˆç«‹æ—¶çš„æƒ…å†µ</span></span><br><span class="line">num = -<span class="number">3</span></span><br><span class="line"><span class="keyword">if</span> num &gt; <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;num&#125;</span> æ˜¯æ­£æ•°&quot;</span>)  <span class="comment"># æ— è¾“å‡ºï¼ˆæ¡ä»¶ä¸º Falseï¼Œä»£ç å—è·³è¿‡ï¼‰</span></span><br></pre></td></tr></table></figure>
<h4 id="2-åŒåˆ†æ”¯ï¼šéæ­¤å³å½¼çš„äºŒé€‰ä¸€">&lt;2&gt;åŒåˆ†æ”¯ï¼šéæ­¤å³å½¼çš„äºŒé€‰ä¸€</h4>
<p><strong>é€‚ç”¨åœºæ™¯ï¼šå­˜åœ¨ä¸¤ç§äº’æ–¥æ¡ä»¶ï¼Œæ— è®ºå“ªç§æƒ…å†µéƒ½éœ€æ‰§è¡Œå¯¹åº”ä»£ç ï¼ˆå¿…èµ°ä¸€ä¸ªåˆ†æ”¯ï¼‰</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¯­æ³•ç»“æ„</span></span><br><span class="line"><span class="keyword">if</span> æ¡ä»¶è¡¨è¾¾å¼:</span><br><span class="line">    ä»£ç å—<span class="number">1</span>  <span class="comment"># æ¡ä»¶ä¸º True æ—¶æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    ä»£ç å—<span class="number">2</span>  <span class="comment"># æ¡ä»¶ä¸º False æ—¶æ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®æˆ˜ç¤ºä¾‹ï¼šåˆ¤æ–­æˆç»©æ˜¯å¦åˆæ ¼</span></span><br><span class="line">score = <span class="number">75</span></span><br><span class="line"><span class="keyword">if</span> score &gt;= <span class="number">60</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;æˆç»©åˆæ ¼ï¼Œé¡ºåˆ©é€šè¿‡&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šæˆç»©åˆæ ¼ï¼Œé¡ºåˆ©é€šè¿‡</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;æˆç»©ä¸åˆæ ¼ï¼Œéœ€è¡¥è€ƒ&quot;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="3-ä¸‰å…ƒè¡¨è¾¾å¼ï¼šåŒåˆ†æ”¯çš„ç®€æ´å†™æ³•">&lt;3&gt;ä¸‰å…ƒè¡¨è¾¾å¼ï¼šåŒåˆ†æ”¯çš„ç®€æ´å†™æ³•</h4>
<ul>
<li><strong>ä¸‰å…ƒè¡¨è¾¾å¼æ˜¯ if-else åŒåˆ†æ”¯çš„ç®€åŒ–å½¢å¼ï¼Œé€‚ç”¨äºä¸¤ä¸ªåˆ†æ”¯å‡åªæœ‰å•æ¡è¯­å¥ã€ä¸”ç›®çš„æ˜¯è¿”å›ä¸€ä¸ªå€¼çš„åœºæ™¯</strong></li>
<li><strong>å®ƒèƒ½è®©ä»£ç æ›´ç®€æ´ç´§å‡‘ï¼Œä½†å¤æ‚é€»è¾‘ä¸‹ä¸å»ºè®®ä½¿ç”¨ï¼ˆä¼šé™ä½å¯è¯»æ€§ï¼‰</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ ¸å¿ƒè¯­æ³•</span></span><br><span class="line">ç»“æœå˜é‡ = è¡¨è¾¾å¼<span class="number">1</span> <span class="keyword">if</span> æ¡ä»¶è¡¨è¾¾å¼ <span class="keyword">else</span> è¡¨è¾¾å¼<span class="number">2</span></span><br><span class="line"><span class="comment"># é€»è¾‘ï¼šæ¡ä»¶è¡¨è¾¾å¼ä¸º True æ—¶ï¼Œç»“æœå˜é‡ = è¡¨è¾¾å¼1ï¼›å¦åˆ™ = è¡¨è¾¾å¼2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŸºç¡€ç¤ºä¾‹ï¼šåˆ¤æ–­æˆç»©åˆæ ¼ä¸å¦</span></span><br><span class="line">score = <span class="number">75</span></span><br><span class="line">result = <span class="string">&quot;åˆæ ¼&quot;</span> <span class="keyword">if</span> score &gt;= <span class="number">60</span> <span class="keyword">else</span> <span class="string">&quot;ä¸åˆæ ¼&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æˆç»©ç­‰çº§ï¼š<span class="subst">&#123;result&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šæˆç»©ç­‰çº§ï¼šåˆæ ¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹æ¯”æ™®é€š if-elseï¼ˆåŠŸèƒ½ç­‰ä»·ï¼Œä¸‰å…ƒè¡¨è¾¾å¼æ›´ç®€æ´ï¼‰</span></span><br><span class="line">score = <span class="number">75</span></span><br><span class="line"><span class="keyword">if</span> score &gt;= <span class="number">60</span>:</span><br><span class="line">    result = <span class="string">&quot;åˆæ ¼&quot;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    result = <span class="string">&quot;ä¸åˆæ ¼&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æˆç»©ç­‰çº§ï¼š<span class="subst">&#123;result&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šæˆç»©ç­‰çº§ï¼šåˆæ ¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›é˜¶ç¤ºä¾‹ï¼šç”¨äºç®€å•è®¡ç®—</span></span><br><span class="line">a = <span class="number">10</span></span><br><span class="line">b = <span class="number">20</span></span><br><span class="line">max_num = a <span class="keyword">if</span> a &gt; b <span class="keyword">else</span> b</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;è¾ƒå¤§å€¼ï¼š<span class="subst">&#123;max_num&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šè¾ƒå¤§å€¼ï¼š20</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šä¸‰å…ƒè¡¨è¾¾å¼æ”¯æŒåµŒå¥—ï¼Œä½†ä¸æ¨èï¼ˆå¯è¯»æ€§å·®ï¼‰</span></span><br><span class="line"><span class="comment"># åµŒå¥—ç¤ºä¾‹ï¼šåˆ¤æ–­åˆ†æ•°ç­‰çº§ï¼ˆåŠæ ¼/è‰¯å¥½/ä¼˜ç§€ç®€åŒ–ç‰ˆï¼‰</span></span><br><span class="line">score = <span class="number">88</span></span><br><span class="line">level = <span class="string">&quot;ä¼˜ç§€&quot;</span> <span class="keyword">if</span> score &gt;= <span class="number">90</span> <span class="keyword">else</span> (<span class="string">&quot;è‰¯å¥½&quot;</span> <span class="keyword">if</span> score &gt;= <span class="number">80</span> <span class="keyword">else</span> <span class="string">&quot;åŠæ ¼&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æˆç»©ç­‰çº§ï¼š<span class="subst">&#123;level&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šæˆç»©ç­‰çº§ï¼šè‰¯å¥½</span></span><br></pre></td></tr></table></figure>
<h4 id="4-å¤šåˆ†æ”¯ï¼šæŒ‰é¡ºåºåŒ¹é…å¤šä¸ªæ¡ä»¶">&lt;4&gt;å¤šåˆ†æ”¯ï¼šæŒ‰é¡ºåºåŒ¹é…å¤šä¸ªæ¡ä»¶</h4>
<p><strong>é€‚ç”¨åœºæ™¯ï¼šå­˜åœ¨å¤šä¸ªé€’è¿›æ¡ä»¶ï¼ŒæŒ‰é¡ºåºåˆ¤æ–­ï¼ŒåŒ¹é…åˆ°ç¬¬ä¸€ä¸ªæˆç«‹çš„æ¡ä»¶åæ‰§è¡Œå¯¹åº”ä»£ç ï¼Œåç»­æ¡ä»¶ä¸å†åˆ¤æ–­ï¼ˆé¿å…é‡å¤æ‰§è¡Œï¼‰ã€‚</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¯­æ³•ç»“æ„</span></span><br><span class="line"><span class="keyword">if</span> æ¡ä»¶è¡¨è¾¾å¼<span class="number">1</span>:</span><br><span class="line">    ä»£ç å—<span class="number">1</span>  <span class="comment"># æ¡ä»¶1ä¸º True æ—¶æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">elif</span> æ¡ä»¶è¡¨è¾¾å¼<span class="number">2</span>:  <span class="comment"># å¯æ·»åŠ å¤šä¸ª elifï¼ˆelse if çš„ç¼©å†™ï¼‰</span></span><br><span class="line">    ä»£ç å—<span class="number">2</span>  <span class="comment"># æ¡ä»¶2ä¸º True æ—¶æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">elif</span> æ¡ä»¶è¡¨è¾¾å¼<span class="number">3</span>:</span><br><span class="line">    ä»£ç å—<span class="number">3</span>  <span class="comment"># æ¡ä»¶3ä¸º True æ—¶æ‰§è¡Œ</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">else</span>:  <span class="comment"># å¯é€‰ï¼Œæ‰€æœ‰æ¡ä»¶éƒ½ä¸æˆç«‹æ—¶æ‰§è¡Œ</span></span><br><span class="line">    ä»£ç å—n</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®æˆ˜ç¤ºä¾‹ï¼šæ ¹æ®åˆ†æ•°åˆ’åˆ†ç­‰çº§</span></span><br><span class="line">score = <span class="number">88</span></span><br><span class="line"><span class="keyword">if</span> score &gt;= <span class="number">90</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ç­‰çº§ï¼šä¼˜ç§€&quot;</span>)</span><br><span class="line"><span class="keyword">elif</span> score &gt;= <span class="number">80</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ç­‰çº§ï¼šè‰¯å¥½&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šç­‰çº§ï¼šè‰¯å¥½ï¼ˆç¬¬ä¸€ä¸ªåŒ¹é…çš„æ¡ä»¶ï¼‰</span></span><br><span class="line"><span class="keyword">elif</span> score &gt;= <span class="number">60</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ç­‰çº§ï¼šåŠæ ¼&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ç­‰çº§ï¼šä¸åŠæ ¼&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šå¤šåˆ†æ”¯çš„æ¡ä»¶é¡ºåºä¸å¯éšæ„è°ƒæ¢</span></span><br><span class="line"><span class="comment"># é”™è¯¯ç¤ºä¾‹ï¼šè‹¥å…ˆåˆ¤æ–­ score &gt;=60ï¼Œä¼šå¯¼è‡´ 88 ç›´æ¥åŒ¹é…åˆ°åŠæ ¼ï¼Œåç»­æ¡ä»¶å¤±æ•ˆ</span></span><br><span class="line">score = <span class="number">88</span></span><br><span class="line"><span class="keyword">if</span> score &gt;= <span class="number">60</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ç­‰çº§ï¼šåŠæ ¼&quot;</span>)  <span class="comment"># é”™è¯¯è¾“å‡ºï¼šç­‰çº§ï¼šåŠæ ¼</span></span><br><span class="line"><span class="keyword">elif</span> score &gt;= <span class="number">80</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ç­‰çº§ï¼šè‰¯å¥½&quot;</span>)</span><br><span class="line"><span class="keyword">elif</span> score &gt;= <span class="number">90</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ç­‰çº§ï¼šä¼˜ç§€&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰æ¡ä»¶è¡¨è¾¾å¼çš„åˆæ³•å½¢å¼">ï¼ˆ2ï¼‰æ¡ä»¶è¡¨è¾¾å¼çš„åˆæ³•å½¢å¼</h3>
<p><strong>if è¯­å¥çš„æ¡ä»¶è¡¨è¾¾å¼æœ€ç»ˆéœ€è¿”å›å¸ƒå°”å€¼ï¼ˆTrue/Falseï¼‰ï¼Œå¸¸è§åˆæ³•å½¢å¼åŒ…æ‹¬ï¼š</strong></p>
<ul>
<li><strong>ç›´æ¥å¸ƒå°”å€¼</strong>ï¼šTrue/False ç›´æ¥ä½œä¸ºæ¡ä»¶</li>
<li><strong>æ¯”è¾ƒè¿ç®—</strong>ï¼š==ï¼ˆç­‰äºï¼‰ã€!=ï¼ˆä¸ç­‰äºï¼‰ã€&gt;ï¼ˆå¤§äºï¼‰ã€&lt;ï¼ˆå°äºï¼‰ã€&gt;=ï¼ˆå¤§äºç­‰äºï¼‰ã€&lt;=ï¼ˆå°äºç­‰äºï¼‰</li>
<li><strong>é€»è¾‘è¿ç®—</strong>
<ul>
<li><strong>andï¼ˆä¸ï¼‰</strong>ï¼šæ‰€æœ‰æ¡ä»¶éƒ½æˆç«‹æ‰ä¸º True</li>
<li><strong>or ï¼ˆæˆ–ï¼‰</strong>ï¼šä»»æ„ä¸€ä¸ªæ¡ä»¶æˆç«‹å³ä¸º True</li>
<li><strong>notï¼ˆéï¼‰</strong>ï¼šå–åï¼‰</li>
</ul>
</li>
<li><strong>æˆå‘˜åˆ¤æ–­</strong>
<ul>
<li><strong>in</strong>ï¼šå…ƒç´ åœ¨å®¹å™¨ä¸­</li>
<li><strong>not in</strong>ï¼šå…ƒç´ ä¸åœ¨å®¹å™¨ä¸­</li>
</ul>
</li>
<li><strong>èº«ä»½åˆ¤æ–­</strong>
<ul>
<li><strong>is</strong>ï¼šä¸¤ä¸ªå¯¹è±¡æ˜¯åŒä¸€å†…å­˜åœ°å€</li>
<li><strong>is not</strong>ï¼šä¸¤ä¸ªå¯¹è±¡ä¸æ˜¯åŒä¸€å†…å­˜åœ°å€</li>
</ul>
</li>
<li><strong>å¯¹è±¡ï¼ˆè‡ªåŠ¨è½¬ä¸ºboolå€¼ï¼‰</strong>
<ul>
<li><strong>æ•°å­—</strong>ï¼š0 ä¸º Falseï¼Œé 0 ä¸º True</li>
<li><strong>å­—ç¬¦ä¸²</strong>ï¼šç©ºå­—ç¬¦ä¸²ä¸º Falseï¼Œéç©ºä¸º True</li>
<li><strong>å®¹å™¨</strong>ï¼šç©ºåˆ—è¡¨/å­—å…¸/å…ƒç»„ä¸º Falseï¼Œéç©ºä¸º True</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. æ¯”è¾ƒè¿ç®— + é€»è¾‘è¿ç®—</span></span><br><span class="line">age = <span class="number">22</span></span><br><span class="line"><span class="keyword">if</span> age &gt;= <span class="number">18</span> <span class="keyword">and</span> age &lt;= <span class="number">30</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;é’å¹´&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šé’å¹´</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. æˆå‘˜åˆ¤æ–­</span></span><br><span class="line">fruits = [<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;orange&quot;</span>]</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;banana&quot;</span> <span class="keyword">in</span> fruits:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;åŒ…å«é¦™è•‰&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šåŒ…å«é¦™è•‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. èº«ä»½åˆ¤æ–­ï¼ˆåˆ¤æ–­æ˜¯å¦ä¸º Noneï¼‰</span></span><br><span class="line">obj = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> obj <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å¯¹è±¡ä¸ºç©º&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šå¯¹è±¡ä¸ºç©º</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. è‡ªåŠ¨è½¬æ¢ä¸ºå¸ƒå°”å€¼çš„å¯¹è±¡</span></span><br><span class="line">s = <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="keyword">if</span> s:  <span class="comment"># éç©ºå­—ç¬¦ä¸² â†’ True</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å­—ç¬¦ä¸²éç©º&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šå­—ç¬¦ä¸²éç©º</span></span><br><span class="line"></span><br><span class="line">lst = []</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> lst:  <span class="comment"># ç©ºåˆ—è¡¨ â†’ Falseï¼Œnot å–åä¸º True</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;åˆ—è¡¨ä¸ºç©º&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šåˆ—è¡¨ä¸ºç©º</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰if-è¯­å¥çš„é¿å‘è¦ç‚¹">ï¼ˆ3ï¼‰if è¯­å¥çš„é¿å‘è¦ç‚¹</h3>
<ul>
<li><strong>ç¼©è¿›é”™è¯¯æ˜¯è‡´å‘½é—®é¢˜</strong>
<ul>
<li>ä»£ç å—å¿…é¡»ç¼©è¿›ï¼ˆ4 ä¸ªç©ºæ ¼ï¼‰ï¼Œä¸”åŒä¸€çº§ä»£ç å—ç¼©è¿›ä¸€è‡´ï¼›</li>
<li>è‹¥å¿˜è®°ç¼©è¿›æˆ–ç¼©è¿›æ··ä¹±ï¼Œä¼šæŠ¥ IndentationError é”™è¯¯ï¼›</li>
</ul>
</li>
<li><strong>ä¸è¦æ··æ·† == å’Œ is</strong>
<ul>
<li><strong>==</strong>ï¼š åˆ¤æ–­å€¼æ˜¯å¦ç›¸ç­‰</li>
<li><strong>is</strong>ï¼šåˆ¤æ–­å†…å­˜åœ°å€æ˜¯å¦ç›¸åŒ</li>
<li>é€šå¸¸åˆ¤æ–­å€¼ç”¨ ==ï¼Œåˆ¤æ–­æ˜¯å¦ä¸º None ç”¨ is</li>
</ul>
</li>
<li><strong>å¤šåˆ†æ”¯æ¡ä»¶éœ€æŒ‰ã€Œä»ä¸¥æ ¼åˆ°å®½æ¾ã€æ’åº</strong>
<ul>
<li>å¦‚åˆ’åˆ†æˆç»©ç­‰çº§æ—¶ï¼Œéœ€å…ˆåˆ¤æ–­é«˜åˆ†æ®µï¼ˆ90+ï¼‰ï¼Œå†åˆ¤æ–­ä½åˆ†æ®µï¼ˆ80+ï¼‰ï¼Œå¦åˆ™ä¼šå‡ºç°é€»è¾‘é”™è¯¯</li>
</ul>
</li>
<li><strong>é¿å…å†—ä½™æ¡ä»¶</strong>ï¼š
<ul>
<li>å¤šåˆ†æ”¯ä¸­ï¼Œåç»­æ¡ä»¶é»˜è®¤æ˜¯ã€Œå‰é¢æ¡ä»¶ä¸æˆç«‹ã€çš„å‰æä¸‹åˆ¤æ–­ï¼Œæ— éœ€é‡å¤æ·»åŠ å‰é¢çš„æ¡ä»¶ï¼ˆå¦‚æ— éœ€å†™ if score &gt;=80 and score &lt;90ï¼‰</li>
</ul>
</li>
</ul>
<h2 id="2-caseåˆ†æ”¯ï¼ˆPython-3-10-æ–°å¢çš„æ¨¡å¼åŒ¹é…ï¼‰">2.caseåˆ†æ”¯ï¼ˆPython 3.10+ æ–°å¢çš„æ¨¡å¼åŒ¹é…ï¼‰</h2>
<h3 id="ï¼ˆ1ï¼‰æ ¸å¿ƒè¯­æ³•ä¸ç»“æ„">ï¼ˆ1ï¼‰æ ¸å¿ƒè¯­æ³•ä¸ç»“æ„</h3>
<p><strong>match-case çš„è¯­æ³•æ ¸å¿ƒæ˜¯ã€ŒåŒ¹é…è¡¨è¾¾å¼ + å¤šä¸ª case æ¨¡å¼ + ä»£ç å—ã€ï¼Œæ¯ä¸ª case å¯¹åº”ä¸€ç§åŒ¹é…è§„åˆ™ï¼Œæœ€åå¯é€šè¿‡é€šé…ç¬¦ _ åŒ¹é…æ‰€æœ‰æœªå‘½ä¸­çš„æƒ…å†µã€‚</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŸºç¡€è¯­æ³•ç»“æ„</span></span><br><span class="line"><span class="keyword">match</span> åŒ¹é…è¡¨è¾¾å¼:  <span class="comment"># éœ€åŒ¹é…çš„å€¼/è¡¨è¾¾å¼ï¼ˆå¦‚å˜é‡ã€å‡½æ•°è¿”å›å€¼ï¼‰</span></span><br><span class="line">    <span class="keyword">case</span> æ¨¡å¼<span class="number">1</span>:  <span class="comment"># ç¬¬ä¸€ä¸ªåŒ¹é…æ¨¡å¼</span></span><br><span class="line">        ä»£ç å—<span class="number">1</span>  <span class="comment"># åŒ¹é…æˆåŠŸåˆ™æ‰§è¡Œï¼Œæ‰§è¡Œåè‡ªåŠ¨ç»ˆæ­¢ï¼ˆæ— éœ€ breakï¼‰</span></span><br><span class="line">    <span class="keyword">case</span> æ¨¡å¼<span class="number">2</span>:  <span class="comment"># ç¬¬äºŒä¸ªåŒ¹é…æ¨¡å¼</span></span><br><span class="line">        ä»£ç å—<span class="number">2</span>  <span class="comment"># æ¨¡å¼1ä¸åŒ¹é…æ—¶ï¼Œåˆ¤æ–­æ¨¡å¼2</span></span><br><span class="line">    <span class="keyword">case</span> æ¨¡å¼<span class="number">3</span> | æ¨¡å¼<span class="number">4</span>:  <span class="comment"># å¤šæ¨¡å¼åŒ¹é…ï¼ˆç”¨ | åˆ†éš”ï¼Œæ»¡è¶³ä¸€ä¸ªå³å¯ï¼‰</span></span><br><span class="line">        ä»£ç å—<span class="number">3</span></span><br><span class="line">    <span class="keyword">case</span> _:  <span class="comment"># é€šé…ç¬¦ï¼ŒåŒ¹é…æ‰€æœ‰æœªåŒ¹é…çš„æƒ…å†µï¼ˆç±»ä¼¼ elseï¼Œå¯é€‰ï¼‰</span></span><br><span class="line">        ä»£ç å—n</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€ç®€å•ç¤ºä¾‹ï¼šç²¾å‡†åŒ¹é…å€¼</span></span><br><span class="line">day = <span class="number">3</span></span><br><span class="line"><span class="keyword">match</span> day:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;æ˜ŸæœŸä¸€&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;æ˜ŸæœŸäºŒ&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;æ˜ŸæœŸä¸‰&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šæ˜ŸæœŸä¸‰</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span> | <span class="number">5</span>:  <span class="comment"># å¤šæ¨¡å¼åŒ¹é…ï¼š4 æˆ– 5</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;å·¥ä½œæ—¥&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="number">6</span> | <span class="number">7</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;å‘¨æœ«&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> _:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;æ— æ•ˆçš„æ—¥æœŸ&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰å¸¸ç”¨åŒ¹é…æ¨¡å¼ï¼ˆæ ¸å¿ƒé‡ç‚¹ï¼‰">ï¼ˆ2ï¼‰å¸¸ç”¨åŒ¹é…æ¨¡å¼ï¼ˆæ ¸å¿ƒé‡ç‚¹ï¼‰</h3>
<p><strong>match-case çš„å¼ºå¤§ä¹‹å¤„åœ¨äºæ”¯æŒå¤šç§çµæ´»çš„æ¨¡å¼ï¼Œè€Œéä»…èƒ½åŒ¹é…å›ºå®šå€¼ï¼Œä»¥ä¸‹æ˜¯æœ€å¸¸ç”¨çš„ 6 ç§æ¨¡å¼ï¼š</strong></p>
<h4 id="1-å­—é¢é‡æ¨¡å¼ï¼šç²¾å‡†åŒ¹é…å›ºå®šå€¼">&lt;1&gt;å­—é¢é‡æ¨¡å¼ï¼šç²¾å‡†åŒ¹é…å›ºå®šå€¼</h4>
<p><strong>åŒ¹é…è¡¨è¾¾å¼çš„å€¼ä¸ case åçš„å­—é¢é‡ï¼ˆå­—ç¬¦ä¸²ã€æ•´æ•°ã€å¸ƒå°”å€¼ç­‰ï¼‰å®Œå…¨ç›¸ç­‰æ—¶å‘½ä¸­ï¼Œæ˜¯æœ€åŸºç¡€çš„æ¨¡å¼ã€‚</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŒ¹é…å­—ç¬¦ä¸²</span></span><br><span class="line">fruit = <span class="string">&quot;apple&quot;</span></span><br><span class="line"><span class="keyword">match</span> fruit:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;apple&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è‹¹æœï¼Œå•ä»· 5 å…ƒ/æ–¤&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šè‹¹æœï¼Œå•ä»· 5 å…ƒ/æ–¤</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;banana&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;é¦™è•‰ï¼Œå•ä»· 3 å…ƒ/æ–¤&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;orange&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;æ©™å­ï¼Œå•ä»· 4 å…ƒ/æ–¤&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> _:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;æœªçŸ¥æ°´æœ&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŒ¹é…å¸ƒå°”å€¼ï¼ˆæ³¨æ„ï¼šTrue/False æ˜¯å­—é¢é‡ï¼Œ0/1 ä¸åŒ¹é…ï¼‰</span></span><br><span class="line">flag = <span class="literal">True</span></span><br><span class="line"><span class="keyword">match</span> flag:</span><br><span class="line">    <span class="keyword">case</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;æ¡ä»¶æˆç«‹&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šæ¡ä»¶æˆç«‹</span></span><br><span class="line">    <span class="keyword">case</span> <span class="literal">False</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;æ¡ä»¶ä¸æˆç«‹&quot;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="2-å˜é‡æ¨¡å¼ï¼šåŒ¹é…ä»»æ„å€¼å¹¶ç»‘å®šåˆ°å˜é‡">&lt;2&gt;å˜é‡æ¨¡å¼ï¼šåŒ¹é…ä»»æ„å€¼å¹¶ç»‘å®šåˆ°å˜é‡</h4>
<p><strong>case åè·Ÿå˜é‡åæ—¶ï¼Œä¼šåŒ¹é…ä»»æ„å€¼ï¼Œå¹¶å°†åŒ¹é…è¡¨è¾¾å¼çš„å€¼ç»‘å®šåˆ°è¯¥å˜é‡ï¼ˆç±»ä¼¼èµ‹å€¼ï¼‰ï¼Œå¸¸ç”¨äºæ¥æ”¶ä¸ç¡®å®šçš„å€¼ã€‚</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å˜é‡æ¨¡å¼åŒ¹é…ä»»æ„å€¼</span></span><br><span class="line">user_input = <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="keyword">match</span> user_input:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;quit&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;é€€å‡ºç¨‹åº&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> msg:  <span class="comment"># åŒ¹é…ä»»æ„å€¼ï¼Œç»‘å®šåˆ° msg å˜é‡</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;ä½ è¾“å…¥çš„å†…å®¹ï¼š<span class="subst">&#123;msg&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šä½ è¾“å…¥çš„å†…å®¹ï¼šhello</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»“åˆå¤šæ¨¡å¼ä½¿ç”¨</span></span><br><span class="line">num = <span class="number">7</span></span><br><span class="line"><span class="keyword">match</span> num:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span> | <span class="number">3</span> | <span class="number">5</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;å¥‡æ•°ï¼ˆ1/3/5ï¼‰&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> x:  <span class="comment"># åŒ¹é…å…¶ä»–æ‰€æœ‰å€¼ï¼Œç»‘å®šåˆ° x</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;å…¶ä»–æ•°å­—ï¼š<span class="subst">&#123;x&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šå…¶ä»–æ•°å­—ï¼š7</span></span><br></pre></td></tr></table></figure>
<h4 id="3-é€šé…ç¬¦æ¨¡å¼ï¼š-åŒ¹é…ä»»æ„å€¼ä½†ä¸ç»‘å®š">&lt;3&gt;é€šé…ç¬¦æ¨¡å¼ï¼š _  åŒ¹é…ä»»æ„å€¼ä½†ä¸ç»‘å®š</h4>
<p><strong>_ æ˜¯ç‰¹æ®Šçš„é€šé…ç¬¦æ¨¡å¼ï¼Œå¯åŒ¹é…ä»»æ„å€¼ï¼Œä½†ä¸ä¼šå°†å€¼ç»‘å®šåˆ°å˜é‡ï¼ˆå³æ— æ³•åœ¨ä»£ç å—ä¸­ä½¿ç”¨è¯¥å€¼ï¼‰ï¼Œå¸¸ç”¨äºã€Œå¿½ç•¥æ— å…³å€¼ã€æˆ–ã€Œå…œåº•åŒ¹é…ã€ï¼ˆç±»ä¼¼ elseï¼‰ã€‚</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…œåº•åŒ¹é…ï¼ˆç±»ä¼¼ elseï¼‰</span></span><br><span class="line">color = <span class="string">&quot;purple&quot;</span></span><br><span class="line"><span class="keyword">match</span> color:</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;red&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;çº¢è‰²&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;green&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ç»¿è‰²&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;blue&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è“è‰²&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> _:  <span class="comment"># åŒ¹é…æ‰€æœ‰æœªå‘½ä¸­çš„æƒ…å†µ</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;å…¶ä»–é¢œè‰²&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šå…¶ä»–é¢œè‰²</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¿½ç•¥æ— å…³å€¼ï¼ˆä»…å…³å¿ƒç‰¹å®šä½ç½®çš„å€¼ï¼‰</span></span><br><span class="line">person = (<span class="string">&quot;å°æ˜&quot;</span>, <span class="number">22</span>, <span class="string">&quot;ç”·&quot;</span>)  <span class="comment"># å…ƒç»„ï¼š(å§“å, å¹´é¾„, æ€§åˆ«)</span></span><br><span class="line"><span class="keyword">match</span> person:</span><br><span class="line">    <span class="keyword">case</span> (name, _, gender):  <span class="comment"># å¿½ç•¥å¹´é¾„ï¼ˆç”¨ _ åŒ¹é…ï¼‰</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;å§“åï¼š<span class="subst">&#123;name&#125;</span>ï¼Œæ€§åˆ«ï¼š<span class="subst">&#123;gender&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šå§“åï¼šå°æ˜ï¼Œæ€§åˆ«ï¼šç”·</span></span><br></pre></td></tr></table></figure>
<h4 id="4-ç»“æ„æ¨¡å¼ï¼šåŒ¹é…å®¹å™¨ï¼ˆåˆ—è¡¨-å…ƒç»„-å­—å…¸ï¼‰çš„ç»“æ„">&lt;4&gt;ç»“æ„æ¨¡å¼ï¼šåŒ¹é…å®¹å™¨ï¼ˆåˆ—è¡¨/å…ƒç»„/å­—å…¸ï¼‰çš„ç»“æ„</h4>
<p><strong>å¯ç²¾å‡†åŒ¹é…åˆ—è¡¨ã€å…ƒç»„ã€å­—å…¸çš„ã€Œç»“æ„ã€ï¼ˆé•¿åº¦ã€å…ƒç´ ä½ç½®ã€é”®åï¼‰ï¼Œå¹¶æå–å…¶ä¸­çš„å…ƒç´ ï¼Œæ˜¯ match-case æœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€ã€‚</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. åŒ¹é…å…ƒç»„ç»“æ„ï¼ˆå›ºå®šé•¿åº¦ã€æå–å…ƒç´ ï¼‰</span></span><br><span class="line">point = (<span class="number">3</span>, <span class="number">4</span>)  <span class="comment"># äºŒç»´åæ ‡ï¼š(x, y)</span></span><br><span class="line"><span class="keyword">match</span> point:</span><br><span class="line">    <span class="keyword">case</span> (<span class="number">0</span>, <span class="number">0</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;åŸç‚¹&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> (x, <span class="number">0</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;åœ¨ x è½´ä¸Šï¼Œx = <span class="subst">&#123;x&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> (<span class="number">0</span>, y):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;åœ¨ y è½´ä¸Šï¼Œy = <span class="subst">&#123;y&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> (x, y):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;åœ¨å¹³é¢å†…ï¼Œåæ ‡ (<span class="subst">&#123;x&#125;</span>, <span class="subst">&#123;y&#125;</span>)&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šåœ¨å¹³é¢å†…ï¼Œåæ ‡ (3, 4)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. åŒ¹é…åˆ—è¡¨ç»“æ„ï¼ˆæ”¯æŒå¯å˜é•¿åº¦ï¼Œç”¨ * è¡¨ç¤ºå‰©ä½™å…ƒç´ ï¼‰</span></span><br><span class="line">nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="keyword">match</span> nums:</span><br><span class="line">    <span class="keyword">case</span> [<span class="number">1</span>, *rest]:  <span class="comment"># ä»¥ 1 å¼€å¤´ï¼Œå‰©ä½™å…ƒç´ ç»‘å®šåˆ° rest</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;ä»¥ 1 å¼€å¤´ï¼Œå‰©ä½™å…ƒç´ ï¼š<span class="subst">&#123;rest&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šä»¥ 1 å¼€å¤´ï¼Œå‰©ä½™å…ƒç´ ï¼š[2, 3, 4]</span></span><br><span class="line">    <span class="keyword">case</span> [a, b]:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;ä¸¤ä¸ªå…ƒç´ ï¼š<span class="subst">&#123;a&#125;</span>, <span class="subst">&#123;b&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. åŒ¹é…å­—å…¸ç»“æ„ï¼ˆåŒ¹é…æŒ‡å®šé”®ï¼Œæå–å€¼,ä¸éœ€è¦å®Œå…¨åŒ¹é…ï¼Œå¯ä»¥æ˜¯è¶…é›†ï¼‰</span></span><br><span class="line">user = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;å°çº¢&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">19</span>, <span class="string">&quot;score&quot;</span>: <span class="number">92</span>&#125;</span><br><span class="line"><span class="keyword">match</span> user:</span><br><span class="line">    <span class="keyword">case</span> &#123;<span class="string">&quot;name&quot;</span>: name, <span class="string">&quot;age&quot;</span>: age&#125;:  <span class="comment"># åŒ¹é…åŒ…å« name å’Œ age é”®çš„å­—å…¸ï¼Œæå–å€¼</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;å§“åï¼š<span class="subst">&#123;name&#125;</span>ï¼Œå¹´é¾„ï¼š<span class="subst">&#123;age&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šå§“åï¼šå°çº¢ï¼Œå¹´é¾„ï¼š19</span></span><br><span class="line">    <span class="keyword">case</span> &#123;<span class="string">&quot;name&quot;</span>: name, <span class="string">&quot;score&quot;</span>: score&#125;:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;å§“åï¼š<span class="subst">&#123;name&#125;</span>ï¼Œæˆç»©ï¼š<span class="subst">&#123;score&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="5-ç±»å‹æ¨¡å¼ï¼šåŒ¹é…æŒ‡å®šæ•°æ®ç±»å‹">&lt;5&gt;ç±»å‹æ¨¡å¼ï¼šåŒ¹é…æŒ‡å®šæ•°æ®ç±»å‹</h4>
<p><strong>é€šè¿‡ â€œç±»å‹å()â€ çš„å½¢å¼åŒ¹é…å€¼çš„ç±»å‹ï¼Œå¯åŒæ—¶å°†å€¼ç»‘å®šåˆ°å˜é‡ï¼Œé€‚åˆã€Œæ ¹æ®æ•°æ®ç±»å‹æ‰§è¡Œä¸åŒé€»è¾‘ã€çš„åœºæ™¯ã€‚</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç±»å‹æ¨¡å¼åŒ¹é…</span></span><br><span class="line">data = <span class="number">3.14</span></span><br><span class="line"><span class="keyword">match</span> data:</span><br><span class="line">    <span class="keyword">case</span> <span class="built_in">int</span>():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æ•´æ•°ç±»å‹ï¼š<span class="subst">&#123;data&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="built_in">float</span>():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æµ®ç‚¹æ•°ç±»å‹ï¼š<span class="subst">&#123;data&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šæµ®ç‚¹æ•°ç±»å‹ï¼š3.14</span></span><br><span class="line">    <span class="keyword">case</span> <span class="built_in">str</span>():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;å­—ç¬¦ä¸²ç±»å‹ï¼š<span class="subst">&#123;data&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="built_in">list</span>():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;åˆ—è¡¨ç±»å‹ï¼š<span class="subst">&#123;data&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> _:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;æœªçŸ¥ç±»å‹&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç±»å‹æ¨¡å¼ + ç»‘å®šå˜é‡ï¼ˆæ›´å¸¸ç”¨ï¼‰</span></span><br><span class="line">data = <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="keyword">match</span> data:</span><br><span class="line">    <span class="keyword">case</span> <span class="built_in">int</span>(n):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æ•´æ•°ï¼š<span class="subst">&#123;n * <span class="number">2</span>&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="built_in">str</span>(s):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;å­—ç¬¦ä¸²ï¼š<span class="subst">&#123;s.upper()&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šå­—ç¬¦ä¸²ï¼šHELLO</span></span><br><span class="line">    <span class="keyword">case</span> <span class="built_in">float</span>(num):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æµ®ç‚¹æ•°ï¼š<span class="subst">&#123;num + <span class="number">1</span>&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="6-å®ˆå«æ¨¡å¼ï¼šåœ¨æ¨¡å¼åŒ¹é…çš„åŸºç¡€ä¸Šæ·»åŠ é¢å¤–æ¡ä»¶">&lt;6&gt;å®ˆå«æ¨¡å¼ï¼šåœ¨æ¨¡å¼åŒ¹é…çš„åŸºç¡€ä¸Šæ·»åŠ é¢å¤–æ¡ä»¶</h4>
<p><strong>é€šè¿‡ â€œif æ¡ä»¶â€ ç»™æ¨¡å¼æ·»åŠ é¢å¤–é™åˆ¶ï¼Œä»…å½“ã€Œæ¨¡å¼åŒ¹é…æˆåŠŸã€ä¸”ã€Œæ¡ä»¶æˆç«‹ã€æ—¶æ‰æ‰§è¡Œä»£ç å—ï¼Œå¼¥è¡¥äº†çº¯æ¨¡å¼åŒ¹é…çš„çµæ´»æ€§ä¸è¶³ã€‚</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®ˆå«æ¨¡å¼ï¼ˆæ¨¡å¼ + é¢å¤–æ¡ä»¶ï¼‰</span></span><br><span class="line">num = <span class="number">18</span></span><br><span class="line"><span class="keyword">match</span> num:</span><br><span class="line">    <span class="keyword">case</span> <span class="built_in">int</span>(n) <span class="keyword">if</span> n &gt; <span class="number">18</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;å¤§äº 18 çš„æ•´æ•°ï¼š<span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="built_in">int</span>(n) <span class="keyword">if</span> n == <span class="number">18</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;ç­‰äº 18 çš„æ•´æ•°ï¼š<span class="subst">&#123;n&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šç­‰äº 18 çš„æ•´æ•°ï¼š18</span></span><br><span class="line">    <span class="keyword">case</span> <span class="built_in">int</span>(n) <span class="keyword">if</span> n &lt; <span class="number">18</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;å°äº 18 çš„æ•´æ•°ï¼š<span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»“åˆç»“æ„æ¨¡å¼ä½¿ç”¨</span></span><br><span class="line">point = (<span class="number">5</span>, <span class="number">5</span>)</span><br><span class="line"><span class="keyword">match</span> point:</span><br><span class="line">    <span class="keyword">case</span> (x, y) <span class="keyword">if</span> x == y:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;åœ¨ y = x ç›´çº¿ä¸Šï¼Œåæ ‡ (<span class="subst">&#123;x&#125;</span>, <span class="subst">&#123;y&#125;</span>)&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šåœ¨ y = x ç›´çº¿ä¸Šï¼Œåæ ‡ (5, 5)</span></span><br><span class="line">    <span class="keyword">case</span> (x, y):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;åæ ‡ (<span class="subst">&#123;x&#125;</span>, <span class="subst">&#123;y&#125;</span>)&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰case-åˆ†æ”¯çš„é¿å‘è¦ç‚¹">ï¼ˆ3ï¼‰case åˆ†æ”¯çš„é¿å‘è¦ç‚¹</h3>
<ul>
<li>
<p><strong>ç‰ˆæœ¬é™åˆ¶</strong></p>
<ul>
<li>match-case ä»…æ”¯æŒ Python 3.10 åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œä½ç‰ˆæœ¬ä½¿ç”¨ä¼šæŠ¥è¯­æ³•é”™è¯¯ï¼›</li>
</ul>
</li>
<li>
<p><strong>è‡ªåŠ¨ç»ˆæ­¢</strong></p>
<ul>
<li><strong>æ— éœ€ break</strong>ï¼šä¸å…¶ä»–è¯­è¨€ï¼ˆå¦‚ Javaï¼‰çš„ switch-case ä¸åŒï¼ŒPython çš„ match-case åŒ¹é…æˆåŠŸåä¼šè‡ªåŠ¨ç»ˆæ­¢ï¼Œæ— éœ€æ·»åŠ  break</li>
<li><strong>éœ€ç»§ç»­åŒ¹é…åç»­æ¨¡å¼</strong>ï¼šå¯ä½¿ç”¨ case â€¦ if False ç­‰ç‰¹æ®ŠæŠ€å·§ï¼Œ<strong>ä½†ä¸æ¨è</strong>ï¼›</li>
</ul>
</li>
<li>
<p><strong>é€šé…ç¬¦ _ çš„ä½ç½®</strong></p>
<ul>
<li><strong>_</strong> ï¼šæ˜¯â€œå…œåº•åŒ¹é…â€ï¼Œéœ€<strong>æ”¾åœ¨æ‰€æœ‰ case çš„æœ€å</strong>ï¼Œå¦åˆ™ä¼šè¦†ç›–å‰é¢çš„æ¨¡å¼ï¼ˆå¯¼è‡´å‰é¢çš„æ¨¡å¼æ— æ³•å‘½ä¸­ï¼‰ï¼›</li>
</ul>
</li>
<li>
<p><strong>æ¨¡å¼åŒ¹é…çš„ä¼˜å…ˆçº§</strong></p>
<ul>
<li>æ›´<strong>å…·ä½“çš„æ¨¡å¼</strong>ï¼ˆå¦‚å­—é¢é‡æ¨¡å¼ã€å›ºå®šç»“æ„æ¨¡å¼ï¼‰åº”<strong>æ”¾åœ¨å‰é¢</strong>ï¼Œæ›´<strong>é€šç”¨çš„æ¨¡å¼</strong>ï¼ˆå¦‚å˜é‡æ¨¡å¼ã€é€šé…ç¬¦ï¼‰åº”<strong>æ”¾åœ¨åé¢</strong>ï¼›</li>
</ul>
</li>
<li>
<p><strong>å­—å…¸æ¨¡å¼çš„åŒ¹é…è§„åˆ™</strong></p>
<ul>
<li>åŒ¹é…å­—å…¸æ—¶ï¼Œä»…è¦æ±‚å­—å…¸åŒ…å« case ä¸­æŒ‡å®šçš„é”®å³å¯ï¼ˆ<strong>ä¸è¦æ±‚é”®å®Œå…¨ä¸€è‡´</strong>ï¼‰ï¼Œä¼šæå–æŒ‡å®šé”®çš„å€¼ï¼›</li>
</ul>
</li>
<li>
<p><strong>é¿å…è¿‡åº¦ä½¿ç”¨</strong></p>
<ul>
<li>ç®€å•çš„æ¡ä»¶åˆ¤æ–­ï¼ˆå¦‚å•ä¸€æ¯”è¾ƒï¼‰ç”¨ if è¯­å¥æ›´ç›´è§‚</li>
<li>match-case æ›´é€‚åˆå¤šå€¼ç²¾å‡†åŒ¹é…ã€ç»“æ„åŒ¹é…ã€ç±»å‹åŒ¹é…åœºæ™¯ã€‚</li>
</ul>
</li>
</ul>
<h3 id="ï¼ˆ4ï¼‰ä¸å…¶ä»–è¯­è¨€switchçš„åŒºåˆ«">ï¼ˆ4ï¼‰ä¸å…¶ä»–è¯­è¨€switchçš„åŒºåˆ«</h3>
<ul>
<li>Pythonçš„match-case<strong>ä¸éœ€è¦breakè¯­å¥</strong>é˜»æ­¢ç»§ç»­æ‰§è¡Œï¼ˆè‡ªåŠ¨ç»ˆæ­¢ï¼‰</li>
<li>æ”¯æŒå¤æ‚çš„æ¨¡å¼åŒ¹é…è€Œéä»…æ”¯æŒå¸¸é‡å€¼æ¯”è¾ƒ</li>
<li>å¯ä»¥ç›´æ¥ä»åŒ¹é…ä¸­æå–å’Œç»‘å®šå˜é‡</li>
<li>æ”¯æŒç»“æ„è§£æ„å’Œç±»å‹åŒ¹é…</li>
</ul>
<hr>
<h1>å…­ã€whileå¾ªç¯</h1>
<h2 id="1-æ ¸å¿ƒè¯­æ³•ä¸åŸºç¡€æœºåˆ¶">1.æ ¸å¿ƒè¯­æ³•ä¸åŸºç¡€æœºåˆ¶</h2>
<p><strong>while å¾ªç¯çš„è¯­æ³•ç®€æ´ï¼Œæ ¸å¿ƒç”±ã€Œæ¡ä»¶è¡¨è¾¾å¼ã€å’Œã€Œå¾ªç¯ä½“ã€ç»„æˆï¼Œé€šè¿‡æ¡ä»¶çš„å¸ƒå°”å€¼æ§åˆ¶å¾ªç¯çš„å¯åŠ¨ä¸ç»ˆæ­¢ã€‚</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŸºç¡€è¯­æ³•</span></span><br><span class="line"><span class="keyword">while</span> æ¡ä»¶è¡¨è¾¾å¼:</span><br><span class="line">    ç¼©è¿›çš„å¾ªç¯ä½“ä»£ç   <span class="comment"># æ¡ä»¶ä¸º True æ—¶æ‰§è¡Œ</span></span><br><span class="line">    ï¼ˆå¯é€‰ä½†æ¨èï¼‰æ¡ä»¶æ›´æ–°è¯­å¥  <span class="comment"># ç”¨äºä¿®æ”¹æ¡ä»¶ï¼Œé¿å…æ— é™å¾ªç¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç©ºå¾ªç¯ï¼ˆä»…å ä½/å»¶è¿Ÿï¼Œæ— å®é™…é€»è¾‘ï¼‰</span></span><br><span class="line"><span class="keyword">while</span> æ¡ä»¶è¡¨è¾¾å¼:</span><br><span class="line">    <span class="keyword">pass</span>  <span class="comment"># pass æ˜¯å ä½ç¬¦ï¼Œä»£è¡¨â€œæ— æ“ä½œâ€ï¼ˆç”¨ä¸æš‚æ—¶ä¸éœ€è¦å®ç°ï¼Œåç»­è¡¥å……/æ‰©å±•ï¼‰</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¤ºä¾‹1ï¼šåŸºæœ¬å¾ªç¯ï¼ˆè¾“å‡º 1-5ï¼‰</span></span><br><span class="line">num = <span class="number">1</span>  <span class="comment"># åˆå§‹åŒ–æ¡ä»¶å˜é‡</span></span><br><span class="line"><span class="keyword">while</span> num &lt;= <span class="number">5</span>:  <span class="comment"># æ¡ä»¶ï¼šnum å°äºç­‰äº 5</span></span><br><span class="line">    <span class="built_in">print</span>(num)  <span class="comment"># å¾ªç¯ä½“ï¼šè¾“å‡º numï¼Œä¾æ¬¡ä¸º 1ã€2ã€3ã€4ã€5</span></span><br><span class="line">    num += <span class="number">1</span>  <span class="comment"># æ¡ä»¶æ›´æ–°ï¼šnum è‡ªå¢ 1ï¼ˆå…³é”®ï¼é¿å…æ— é™å¾ªç¯ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹2ï¼šæ¡ä»¶æ›´æ–°ï¼ˆå»¶è¿Ÿ 3 ç§’ï¼Œä»…ä½œæ¼”ç¤ºï¼‰</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> count &lt; <span class="number">3</span>:</span><br><span class="line">    time.sleep(<span class="number">1</span>)  <span class="comment"># æš‚åœ 1 ç§’</span></span><br><span class="line">    count += <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å»¶è¿Ÿ <span class="subst">&#123;count&#125;</span> ç§’...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹3ï¼šçº¯å ä½ç©ºå¾ªç¯ï¼ˆä»£ç æ¡†æ¶æ­å»ºé˜¶æ®µï¼‰</span></span><br><span class="line"><span class="comment"># ä½œç”¨ï¼šå…ˆå®šä¹‰å¾ªç¯ç»“æ„ï¼Œåç»­è¡¥å……ä¸šåŠ¡é€»è¾‘ï¼Œé¿å…è¯­æ³•é”™è¯¯</span></span><br><span class="line">empty_flag = <span class="literal">False</span>  <span class="comment"># åˆå§‹ä¸ºFalseï¼Œå¾ªç¯ä¸æ‰§è¡Œï¼ˆä»…å ä½ï¼‰</span></span><br><span class="line"><span class="keyword">while</span> empty_flag:</span><br><span class="line">    <span class="keyword">pass</span> <span class="comment"># while å¿…é¡»æœ‰å¾ªç¯ä½“ï¼Œè‹¥æ²¡æœ‰ä»»ä½•å®ç°åˆä¸ç”¨ pass å ä½ï¼Œåˆ™ä¼šæŠ¥é”™</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹4ï¼šæ— é™å¾ªç¯å ä½ï¼ˆéœ€é…åˆbreakï¼Œå¦åˆ™ä¼šå¡æ­»ï¼‰</span></span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    count += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> count &gt; <span class="number">5</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">pass</span>  <span class="comment"># å¾ªç¯ä½“é€»è¾‘åç»­è¡¥å……</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹5ï¼šåµŒå¥— while å¾ªç¯ï¼ˆå¤šå±‚å¾ªç¯ï¼‰</span></span><br><span class="line">row = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> row &lt;= <span class="number">3</span>:  <span class="comment"># å¤–å±‚å¾ªç¯ï¼šæ§åˆ¶è¡Œæ•°</span></span><br><span class="line">    col = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> col &lt;= <span class="number">4</span>:  <span class="comment"># å†…å±‚å¾ªç¯ï¼šæ§åˆ¶æ¯è¡Œçš„åˆ—æ•°</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;*&quot;</span>, end=<span class="string">&quot; &quot;</span>)  <span class="comment"># end=&quot; &quot; ä½¿æ‰“å°ä¸æ¢è¡Œ</span></span><br><span class="line">        col += <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>()  <span class="comment"># ä¸€è¡Œæ‰“å°å®Œæ¯•ï¼Œæ¢è¡Œ</span></span><br><span class="line">    row += <span class="number">1</span></span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment"># * * * * </span></span><br><span class="line"><span class="comment"># * * * * </span></span><br><span class="line"><span class="comment"># * * * * </span></span><br></pre></td></tr></table></figure>
<p><strong>passï¼šã€Œè¯­æ³•å ä½ç¬¦ã€</strong></p>
<ul>
<li><strong>æ ¸å¿ƒä½œç”¨</strong>ï¼šé¿å… â€œç¼ºå°‘è¯­å¥å¯¼è‡´çš„è¯­æ³•é”™è¯¯â€</li>
</ul>
<h2 id="2-å¾ªç¯æ§åˆ¶å…³é”®å­—ï¼šbreak-ä¸-continue">2.å¾ªç¯æ§åˆ¶å…³é”®å­—ï¼šbreak ä¸ continue</h2>
<p><strong>é»˜è®¤æƒ…å†µä¸‹ï¼Œwhile å¾ªç¯æŒ‰ã€Œæ¡ä»¶åˆ¤æ–­â†’å¾ªç¯ä½“æ‰§è¡Œã€çš„æµç¨‹é‡å¤ï¼Œä½†å®é™…å¼€å‘ä¸­å¸¸éœ€çµæ´»æ§åˆ¶å¾ªç¯ï¼ˆå¦‚æå‰ç»ˆæ­¢ã€è·³è¿‡æŸæ¬¡å¾ªç¯ï¼‰ï¼Œæ­¤æ—¶éœ€ç”¨åˆ° break å’Œ continue ä¸¤ä¸ªæ ¸å¿ƒå…³é”®å­—ã€‚</strong></p>
<h3 id="ï¼ˆ1ï¼‰breakï¼ˆç«‹å³ç»ˆæ­¢å¾ªç¯ï¼‰">ï¼ˆ1ï¼‰breakï¼ˆç«‹å³ç»ˆæ­¢å¾ªç¯ï¼‰</h3>
<p><strong>ä½œç”¨</strong>ï¼šå½“æ‰§è¡Œåˆ° break æ—¶ï¼Œç›´æ¥ç»ˆæ­¢å½“å‰æ‰€åœ¨çš„å¾ªç¯ï¼Œè·³å‡ºå¾ªç¯ä½“ï¼Œç¨‹åºæ‰§è¡Œå¾ªç¯ä¹‹åçš„ä»£ç ï¼ˆæ— è®ºæ¡ä»¶æ˜¯å¦ä»æˆç«‹ï¼‰ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¤ºä¾‹ï¼šæ‰¾åˆ°ç›®æ ‡å€¼åç«‹å³ç»ˆæ­¢å¾ªç¯</span></span><br><span class="line">target = <span class="number">3</span></span><br><span class="line">num = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> num &lt;= <span class="number">10</span>:</span><br><span class="line">    <span class="keyword">if</span> num == target:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æ‰¾åˆ°ç›®æ ‡å€¼ï¼š<span class="subst">&#123;num&#125;</span>ï¼Œç»ˆæ­¢å¾ªç¯&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span>  <span class="comment"># æ‰¾åˆ°ç›®æ ‡ï¼Œç«‹å³ç»ˆæ­¢å¾ªç¯</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å½“å‰å€¼ï¼š<span class="subst">&#123;num&#125;</span>&quot;</span>)</span><br><span class="line">    num += <span class="number">1</span></span><br><span class="line"><span class="comment"># è¾“å‡ºï¼šå½“å‰å€¼ï¼š1 â†’ å½“å‰å€¼ï¼š2 â†’ æ‰¾åˆ°ç›®æ ‡å€¼ï¼š3ï¼Œç»ˆæ­¢å¾ªç¯</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰continueï¼ˆè·³è¿‡å½“å‰å¾ªç¯ï¼Œè¿›å…¥ä¸‹ä¸€è½®ï¼‰">ï¼ˆ2ï¼‰continueï¼ˆè·³è¿‡å½“å‰å¾ªç¯ï¼Œè¿›å…¥ä¸‹ä¸€è½®ï¼‰</h3>
<p><strong>ä½œç”¨</strong>ï¼šå½“æ‰§è¡Œåˆ° continue æ—¶ï¼Œè·³è¿‡å½“å‰å¾ªç¯ä½“ä¸­å‰©ä½™çš„ä»£ç ï¼Œç›´æ¥å›åˆ°ã€Œæ¡ä»¶åˆ¤æ–­ã€ç¯èŠ‚ï¼Œå‡†å¤‡æ‰§è¡Œä¸‹ä¸€è½®å¾ªç¯ï¼ˆä¸ä¼šç»ˆæ­¢å¾ªç¯ï¼‰ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¤ºä¾‹ï¼šè·³è¿‡å¶æ•°ï¼Œåªè¾“å‡ºå¥‡æ•°ï¼ˆ1-5ï¼‰</span></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> num &lt; <span class="number">5</span>:</span><br><span class="line">    num += <span class="number">1</span>    <span class="comment"># æ³¨ï¼šå¿…é¡»åœ¨ continue ä¹‹å‰æ›´æ–°å¾ªç¯å˜é‡ï¼</span></span><br><span class="line">    <span class="keyword">if</span> num % <span class="number">2</span> == <span class="number">0</span>:  <span class="comment"># åˆ¤æ–­æ˜¯å¦ä¸ºå¶æ•°</span></span><br><span class="line">        <span class="keyword">continue</span>  <span class="comment"># æ˜¯å¶æ•°åˆ™è·³è¿‡åç»­æ‰“å°ä»£ç </span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å¥‡æ•°ï¼š<span class="subst">&#123;num&#125;</span>&quot;</span>)  <span class="comment"># ä»…è¾“å‡ºå¥‡æ•°ï¼š1ã€3ã€5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># âŒ é”™è¯¯ç¤ºä¾‹ï¼šä¼šå¯¼è‡´æ­»å¾ªç¯</span></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> num &lt; <span class="number">5</span>:</span><br><span class="line">    <span class="keyword">if</span> num % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">continue</span>  <span class="comment"># å½“ num=0 æ—¶ï¼Œè·³è¿‡äº† num+=1ï¼Œæ°¸è¿œå¡åœ¨ 0</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å¥‡æ•°ï¼š<span class="subst">&#123;num&#125;</span>&quot;</span>)</span><br><span class="line">    num += <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h1>ä¸ƒã€ç”¨æˆ·è¾“å…¥ï¼ˆinputï¼‰</h1>
<h2 id="1-æ ¸å¿ƒè¯­æ³•ä¸åŸºç¡€ç”¨æ³•">1.æ ¸å¿ƒè¯­æ³•ä¸åŸºç¡€ç”¨æ³•</h2>
<p><strong>input() å‡½æ•°çš„è¯­æ³•ç®€æ´ï¼Œæ ¸å¿ƒåŠŸèƒ½æ˜¯â€œé˜»å¡ç¨‹åºç­‰å¾…ç”¨æˆ·è¾“å…¥ï¼Œè·å–è¾“å…¥å†…å®¹å¹¶è¿”å›â€ã€‚æ ¹æ®æ˜¯å¦éœ€è¦æç¤ºç”¨æˆ·ï¼Œå¯åˆ†ä¸ºå¸¦æç¤º/ä¸å¸¦æç¤ºä¸¤ç§ç”¨æ³•</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŸºç¡€è¯­æ³•</span></span><br><span class="line"><span class="comment"># ç”¨æ³•1ï¼šæ— æç¤ºä¿¡æ¯ï¼ˆä»…ç­‰å¾…ç”¨æˆ·è¾“å…¥ï¼‰</span></span><br><span class="line">è¾“å…¥å˜é‡ = <span class="built_in">input</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨æ³•2ï¼šå¸¦è‡ªå®šä¹‰æç¤ºä¿¡æ¯ï¼ˆæ¨èï¼Œæå‡ç”¨æˆ·ä½“éªŒï¼‰</span></span><br><span class="line">è¾“å…¥å˜é‡ = <span class="built_in">input</span>(<span class="string">&quot;è¯·è¾“å…¥xxxï¼š&quot;</span>)  <span class="comment"># æç¤ºä¿¡æ¯ä¼šç›´æ¥æ˜¾ç¤ºåœ¨æ§åˆ¶å°ï¼Œå¼•å¯¼ç”¨æˆ·è¾“å…¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="comment"># ç¤ºä¾‹1ï¼šæ— æç¤ºä¿¡æ¯çš„è¾“å…¥</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;è¯·è¾“å…¥ä»»æ„å†…å®¹ï¼ŒæŒ‰å›è½¦ç»“æŸï¼š&quot;</span>)</span><br><span class="line">content = <span class="built_in">input</span>()  <span class="comment"># ç¨‹åºé˜»å¡ï¼Œç­‰å¾…ç”¨æˆ·è¾“å…¥</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ä½ è¾“å…¥çš„å†…å®¹æ˜¯ï¼š<span class="subst">&#123;content&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºç”¨æˆ·è¾“å…¥çš„å†…å®¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹2ï¼šå¸¦æç¤ºä¿¡æ¯çš„è¾“å…¥ï¼ˆæ—¥å¸¸å¼€å‘é¦–é€‰ï¼‰</span></span><br><span class="line">name = <span class="built_in">input</span>(<span class="string">&quot;è¯·è¾“å…¥ä½ çš„å§“åï¼š&quot;</span>)</span><br><span class="line">age = <span class="built_in">input</span>(<span class="string">&quot;è¯·è¾“å…¥ä½ çš„å¹´é¾„ï¼š&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æ¬¢è¿ä½ ï¼Œ<span class="subst">&#123;name&#125;</span>ï¼ä½ çš„å¹´é¾„æ˜¯ <span class="subst">&#123;age&#125;</span> å²ã€‚&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="2-input-å‡½æ•°çš„æ ¸å¿ƒç‰¹æ€§ï¼ˆå¿…è®°ï¼‰">2.input() å‡½æ•°çš„æ ¸å¿ƒç‰¹æ€§ï¼ˆå¿…è®°ï¼‰</h2>
<p><strong>ç†è§£ input() çš„æ ¸å¿ƒç‰¹æ€§æ˜¯æ­£ç¡®å¤„ç†ç”¨æˆ·è¾“å…¥çš„å…³é”®ï¼Œå°¤å…¶æ˜¯â€œè¿”å›å€¼ç±»å‹â€å’Œâ€œé˜»å¡ç‰¹æ€§â€ï¼Œç›´æ¥å½±å“åç»­ä»£ç é€»è¾‘</strong></p>
<h3 id="ï¼ˆ1ï¼‰è¿”å›å€¼æ°¸è¿œæ˜¯å­—ç¬¦ä¸²ç±»å‹">ï¼ˆ1ï¼‰è¿”å›å€¼æ°¸è¿œæ˜¯å­—ç¬¦ä¸²ç±»å‹</h3>
<ul>
<li><strong>æ— è®ºç”¨æˆ·è¾“å…¥çš„æ˜¯æ•°å­—ï¼ˆå¦‚ 18ï¼‰ã€å¸ƒå°”å€¼ï¼ˆå¦‚ Trueï¼‰è¿˜æ˜¯ç¬¦å·ï¼ˆå¦‚ @ï¼‰ï¼Œinput() çš„è¿”å›å€¼éƒ½é»˜è®¤æ˜¯ å­—ç¬¦ä¸²ï¼ˆstrï¼‰</strong></li>
<li><strong>è‹¥éœ€è¦ç”¨è¾“å…¥å†…å®¹è¿›è¡Œæ•°å­¦è¿ç®—ï¼Œå¿…é¡»â€œæ‰‹åŠ¨è¿›è¡Œç±»å‹è½¬æ¢â€ï¼Œå¦åˆ™ä¼šæŠ¥é”™</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…¸å‹é”™è¯¯ç¤ºä¾‹ï¼šç›´æ¥ç”¨è¾“å…¥çš„â€œæ•°å­—å­—ç¬¦ä¸²â€åšè¿ç®—</span></span><br><span class="line">score = <span class="built_in">input</span>(<span class="string">&quot;è¯·è¾“å…¥ä½ çš„æˆç»©ï¼š&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(score + <span class="number">10</span>)  <span class="comment"># æŠ¥é”™ï¼šTypeError: can only concatenate str (not &quot;int&quot;) to str</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­£ç¡®ç¤ºä¾‹ï¼šå…ˆè½¬æ¢ä¸ºå¯¹åº”æ•°å­—ç±»å‹</span></span><br><span class="line">score = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;è¯·è¾“å…¥ä½ çš„æˆç»©ï¼š&quot;</span>))  <span class="comment"># è½¬æ¢ä¸ºæ•´æ•°ï¼ˆé€‚ç”¨äºæ•´æ•°è¾“å…¥ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æˆç»©+10åçš„åˆ†æ•°ï¼š<span class="subst">&#123;score + <span class="number">10</span>&#125;</span>&quot;</span>)  <span class="comment"># æ­£å¸¸æ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line">height = <span class="built_in">float</span>(<span class="built_in">input</span>(<span class="string">&quot;è¯·è¾“å…¥ä½ çš„èº«é«˜ï¼ˆmï¼‰ï¼š&quot;</span>))  <span class="comment"># è½¬æ¢ä¸ºæµ®ç‚¹æ•°ï¼ˆé€‚ç”¨äºå°æ•°è¾“å…¥ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;èº«é«˜çš„2å€ï¼š<span class="subst">&#123;height * <span class="number">2</span>&#125;</span>&quot;</span>)  <span class="comment"># æ­£å¸¸æ‰§è¡Œ</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰ç¨‹åºé˜»å¡ç‰¹æ€§">ï¼ˆ2ï¼‰ç¨‹åºé˜»å¡ç‰¹æ€§</h3>
<ul>
<li><strong>å½“ç¨‹åºæ‰§è¡Œåˆ° input() æ—¶ï¼Œä¼šç«‹å³æš‚åœï¼ˆé˜»å¡ï¼‰ï¼Œç›´åˆ°ç”¨æˆ·å®Œæˆè¾“å…¥å¹¶æŒ‰ä¸‹ã€Œå›è½¦é”®ã€ï¼Œç¨‹åºæ‰ä¼šç»§ç»­æ‰§è¡Œåç»­ä»£ç </strong></li>
<li><strong>æ³¨æ„ï¼šç”¨æˆ·æœªè¾“å…¥æ—¶ï¼Œç¨‹åºä¼šä¸€ç›´ç­‰å¾…ï¼Œä¸ä¼šè‡ªåŠ¨ç»§ç»­ã€‚</strong></li>
</ul>
<h3 id="ï¼ˆ3ï¼‰ç©ºè¾“å…¥çš„å¤„ç†">ï¼ˆ3ï¼‰ç©ºè¾“å…¥çš„å¤„ç†</h3>
<ul>
<li><strong>è‹¥ç”¨æˆ·æœªè¾“å…¥ä»»ä½•å†…å®¹ï¼Œç›´æ¥æŒ‰ä¸‹å›è½¦é”®ï¼Œinput() ä¼šè¿”å›ä¸€ä¸ª ç©ºå­—ç¬¦ä¸²ï¼ˆâ€œâ€ï¼‰ã€‚</strong></li>
<li><strong>ç©ºè¾“å…¥æ˜¯å¸¸è§åœºæ™¯ï¼Œéœ€æ ¹æ®ä¸šåŠ¡éœ€æ±‚åˆ¤æ–­æ˜¯å¦å…è®¸ï¼Œé¿å…ç¨‹åºå› ç©ºå€¼å‡ºç°é€»è¾‘é”™è¯¯ã€‚</strong></li>
<li><strong>æ­¤å¤–ï¼Œinput() åœ¨é‡åˆ° EOFï¼ˆå¦‚ Ctrl+D / Ctrl+Z æˆ–é‡å®šå‘ç©ºæ–‡ä»¶ï¼‰æ—¶ä¼šæŠ› EOFErrorï¼Œåœ¨æŸäº›è‡ªåŠ¨åŒ–/æµ‹è¯•åœºæ™¯ä¸‹éœ€è¦æ³¨æ„ã€‚</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¤ºä¾‹ï¼šå¤„ç†ç©ºè¾“å…¥</span></span><br><span class="line">user_input = <span class="built_in">input</span>(<span class="string">&quot;è¯·è¾“å…¥å†…å®¹ï¼ˆä¸èƒ½ä¸ºç©ºï¼‰ï¼š&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> user_input == <span class="string">&quot;&quot;</span>:  <span class="comment"># åˆ¤æ–­æ˜¯å¦ä¸ºç©ºè¾“å…¥</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;é”™è¯¯ï¼šè¾“å…¥ä¸èƒ½ä¸ºç©ºï¼Œè¯·é‡æ–°è¾“å…¥ï¼&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ä½ è¾“å…¥çš„å†…å®¹æ˜¯ï¼š<span class="subst">&#123;user_input&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="3-è¾“å…¥å†…å®¹çš„ç±»å‹è½¬æ¢ï¼ˆå…³é”®æ“ä½œï¼‰">3.è¾“å…¥å†…å®¹çš„ç±»å‹è½¬æ¢ï¼ˆå…³é”®æ“ä½œï¼‰</h2>
<p><strong>æ—¥å¸¸å¼€å‘ä¸­ï¼Œç”¨æˆ·è¾“å…¥å¸¸éœ€ä½œä¸ºæ•°å­—ï¼ˆint/floatï¼‰ã€å¸ƒå°”å€¼ï¼ˆboolï¼‰ç­‰ç±»å‹ä½¿ç”¨ï¼Œå› æ­¤â€œç±»å‹è½¬æ¢â€æ˜¯input() ç”¨æ³•çš„æ ¸å¿ƒå»¶ä¼¸ã€‚éœ€æ ¹æ®è¾“å…¥åœºæ™¯é€‰æ‹©åˆé€‚çš„è½¬æ¢æ–¹å¼ï¼Œå¹¶å¤„ç†è½¬æ¢å¤±è´¥çš„æƒ…å†µã€‚</strong></p>
<h3 id="ï¼ˆ1ï¼‰å¸¸è§ç±»å‹è½¬æ¢åœºæ™¯ä¸ç¤ºä¾‹">ï¼ˆ1ï¼‰å¸¸è§ç±»å‹è½¬æ¢åœºæ™¯ä¸ç¤ºä¾‹</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260110115257300.png" alt=""></p>
<h3 id="ï¼ˆ2ï¼‰å¤šå€¼è¾“å…¥çš„å¤„ç†æŠ€å·§">ï¼ˆ2ï¼‰å¤šå€¼è¾“å…¥çš„å¤„ç†æŠ€å·§</h3>
<p><strong>è‹¥éœ€è¦ç”¨æˆ·ä¸€æ¬¡æ€§è¾“å…¥å¤šä¸ªå€¼ï¼ˆå¦‚â€œå§“å å¹´é¾„ æˆç»©â€â€œå¤šä¸ªæ•°å­—â€ï¼‰ï¼Œå¯ç»“åˆ split() æ–¹æ³•æ‹†åˆ†è¾“å…¥å­—ç¬¦ä¸²ï¼Œå†æ‰¹é‡è½¬æ¢ç±»å‹ï¼š</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¤ºä¾‹1ï¼šç”¨ç©ºæ ¼åˆ†éš”å¤šä¸ªå€¼ï¼ˆå¦‚â€œå°æ˜ 20 95â€ï¼‰</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    info = <span class="built_in">input</span>(<span class="string">&quot;è¯·è¾“å…¥å§“å å¹´é¾„ æˆç»©ï¼ˆç”¨ç©ºæ ¼åˆ†éš”ï¼‰ï¼š&quot;</span>).split()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(info) != <span class="number">3</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;é”™è¯¯ï¼šè¯·è¾“å…¥æ°å¥½ 3 ä¸ªå€¼ï¼&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        name = info[<span class="number">0</span>]</span><br><span class="line">        age = <span class="built_in">int</span>(info[<span class="number">1</span>])</span><br><span class="line">        score = <span class="built_in">int</span>(info[<span class="number">2</span>])</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;å§“åï¼š<span class="subst">&#123;name&#125;</span>ï¼Œå¹´é¾„ï¼š<span class="subst">&#123;age&#125;</span>ï¼Œæˆç»©ï¼š<span class="subst">&#123;score&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹2ï¼šç”¨é€—å·åˆ†éš”å¤šä¸ªå€¼ï¼ˆå¦‚â€œ90,85,92â€ï¼‰</span></span><br><span class="line">scores_input = <span class="built_in">input</span>(<span class="string">&quot;è¯·è¾“å…¥å¤šä¸ªæˆç»©ï¼Œç”¨é€—å·åˆ†éš”ï¼š&quot;</span>).split(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">scores = [<span class="built_in">int</span>(s) <span class="keyword">for</span> s <span class="keyword">in</span> scores_input]  <span class="comment"># åˆ—è¡¨æ¨å¯¼å¼æ‰¹é‡è½¬æ¢ä¸ºæ•´æ•°</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æˆç»©åˆ—è¡¨ï¼š<span class="subst">&#123;scores&#125;</span>ï¼Œå¹³å‡æˆç»©ï¼š<span class="subst">&#123;<span class="built_in">sum</span>(scores)/<span class="built_in">len</span>(scores):<span class="number">.2</span>f&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="4-æ ¸å¿ƒéš¾ç‚¹ï¼šè¾“å…¥éªŒè¯ä¸å¼‚å¸¸å¤„ç†">4.æ ¸å¿ƒéš¾ç‚¹ï¼šè¾“å…¥éªŒè¯ä¸å¼‚å¸¸å¤„ç†</h2>
<p><strong>ç”¨æˆ·è¾“å…¥å…·æœ‰ä¸å¯æ§æ€§ï¼ˆå¦‚è¦æ±‚è¾“å…¥æ•°å­—å´è¾“å…¥æ–‡å­—ã€è¾“å…¥è¶…å‡ºèŒƒå›´çš„å€¼ï¼‰ï¼Œç›´æ¥ä½¿ç”¨è¾“å…¥å†…å®¹ä¼šå¯¼è‡´ç¨‹åºå´©æºƒã€‚å› æ­¤ï¼Œâ€œè¾“å…¥éªŒè¯â€å’Œâ€œå¼‚å¸¸å¤„ç†â€æ˜¯ä¿éšœç¨‹åºç¨³å®šæ€§çš„å…³é”®ï¼Œå¸¸ç”¨ try-except è¯­å¥æ•è·è½¬æ¢å¼‚å¸¸ã€‚</strong></p>
<h3 id="ï¼ˆ1ï¼‰åŸºç¡€å¼‚å¸¸å¤„ç†ï¼šç¡®ä¿è¾“å…¥å¯è½¬æ¢ä¸ºç›®æ ‡ç±»å‹">ï¼ˆ1ï¼‰åŸºç¡€å¼‚å¸¸å¤„ç†ï¼šç¡®ä¿è¾“å…¥å¯è½¬æ¢ä¸ºç›®æ ‡ç±»å‹</h3>
<p><strong>å½“ç”¨æˆ·è¾“å…¥æ— æ³•è½¬æ¢ä¸ºç›®æ ‡ç±»å‹ï¼ˆå¦‚è¾“å…¥â€œabcâ€å´è¦è½¬æ¢ä¸º intï¼‰æ—¶ï¼Œä¼šè§¦å‘ ValueError å¼‚å¸¸ï¼Œç”¨ try-except æ•è·å¹¶æç¤ºç”¨æˆ·é‡æ–°è¾“å…¥</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¤ºä¾‹ï¼šç¡®ä¿ç”¨æˆ·è¾“å…¥çš„æ˜¯æ•´æ•°</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:  <span class="comment"># å¾ªç¯ç›´åˆ°è¾“å…¥æ­£ç¡®</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        num = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;è¯·è¾“å…¥ä¸€ä¸ªæ•´æ•°ï¼š&quot;</span>))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;ä½ è¾“å…¥çš„æ•´æ•°æ˜¯ï¼š<span class="subst">&#123;num&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span>  <span class="comment"># è¾“å…¥æ­£ç¡®ï¼Œé€€å‡ºå¾ªç¯</span></span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;é”™è¯¯ï¼šè¾“å…¥çš„ä¸æ˜¯æœ‰æ•ˆæ•´æ•°ï¼Œè¯·é‡æ–°è¾“å…¥ï¼&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰è¿›é˜¶éªŒè¯ï¼šåŒæ—¶éªŒè¯ç±»å‹ä¸å€¼çš„èŒƒå›´">ï¼ˆ2ï¼‰è¿›é˜¶éªŒè¯ï¼šåŒæ—¶éªŒè¯ç±»å‹ä¸å€¼çš„èŒƒå›´</h3>
<p><strong>é™¤äº†ç±»å‹éªŒè¯ï¼Œè¿˜éœ€éªŒè¯è¾“å…¥å€¼æ˜¯å¦ç¬¦åˆä¸šåŠ¡èŒƒå›´ï¼ˆå¦‚å¹´é¾„ 0-120ã€æˆç»© 0-100ï¼‰ï¼Œç»“åˆ if-else å®ç°å®Œæ•´éªŒè¯é€»è¾‘</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¤ºä¾‹ï¼šéªŒè¯è¾“å…¥çš„æ˜¯ 0-100 ä¹‹é—´çš„æˆç»©</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        score = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;è¯·è¾“å…¥æˆç»©ï¼ˆ0-100ï¼‰ï¼š&quot;</span>))</span><br><span class="line">        <span class="comment"># éªŒè¯å€¼çš„èŒƒå›´</span></span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> &lt;= score &lt;= <span class="number">100</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;æˆç»©å½•å…¥æˆåŠŸï¼š<span class="subst">&#123;score&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;é”™è¯¯ï¼šæˆç»©å¿…é¡»åœ¨ 0-100 ä¹‹é—´ï¼Œè¯·é‡æ–°è¾“å…¥ï¼&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;é”™è¯¯ï¼šè¾“å…¥çš„ä¸æ˜¯æœ‰æ•ˆæ•°å­—ï¼Œè¯·é‡æ–°è¾“å…¥ï¼&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰å¤æ‚éªŒè¯ï¼šå¤šæ¡ä»¶ç»„åˆéªŒè¯">ï¼ˆ3ï¼‰å¤æ‚éªŒè¯ï¼šå¤šæ¡ä»¶ç»„åˆéªŒè¯</h3>
<p><strong>é’ˆå¯¹æ›´å¤æ‚çš„è¾“å…¥éœ€æ±‚ï¼ˆå¦‚å¯†ç é•¿åº¦ã€æ ¼å¼éªŒè¯ï¼‰ï¼Œå¯ç»„åˆå¤šä¸ªæ¡ä»¶å®ç°ç²¾å‡†éªŒè¯</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¤ºä¾‹ï¼šéªŒè¯å¯†ç æ ¼å¼ï¼ˆé•¿åº¦â‰¥6ï¼ŒåŒ…å«å­—æ¯å’Œæ•°å­—ï¼‰</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    password = <span class="built_in">input</span>(<span class="string">&quot;è¯·è®¾ç½®å¯†ç ï¼ˆé•¿åº¦â‰¥6ï¼ŒåŒ…å«å­—æ¯å’Œæ•°å­—ï¼‰ï¼š&quot;</span>)</span><br><span class="line">    <span class="comment"># éªŒè¯æ¡ä»¶ï¼šé•¿åº¦â‰¥6ã€åŒ…å«å­—æ¯ã€åŒ…å«æ•°å­—</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(password) &lt; <span class="number">6</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;é”™è¯¯ï¼šå¯†ç é•¿åº¦å¿…é¡»â‰¥6ï¼Œè¯·é‡æ–°è®¾ç½®ï¼&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> <span class="built_in">any</span>(c.isalpha() <span class="keyword">for</span> c <span class="keyword">in</span> password):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;é”™è¯¯ï¼šå¯†ç å¿…é¡»åŒ…å«å­—æ¯ï¼Œè¯·é‡æ–°è®¾ç½®ï¼&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> <span class="built_in">any</span>(c.isdigit() <span class="keyword">for</span> c <span class="keyword">in</span> password):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;é”™è¯¯ï¼šå¯†ç å¿…é¡»åŒ…å«æ•°å­—ï¼Œè¯·é‡æ–°è®¾ç½®ï¼&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;å¯†ç è®¾ç½®æˆåŠŸï¼&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<h2 id="5-é«˜çº§æŠ€å·§ï¼šæå‡è¾“å…¥äº¤äº’ä½“éªŒ">5.é«˜çº§æŠ€å·§ï¼šæå‡è¾“å…¥äº¤äº’ä½“éªŒ</h2>
<p><strong>åœ¨åŸºç¡€ç”¨æ³•ä¹‹ä¸Šï¼Œå¯é€šè¿‡ä¸€äº›æŠ€å·§ä¼˜åŒ–ç”¨æˆ·è¾“å…¥ä½“éªŒï¼Œé€‚é…æ›´å¤šç‰¹æ®Šåœºæ™¯</strong></p>
<h3 id="ï¼ˆ1ï¼‰éšè—æ•æ„Ÿè¾“å…¥ï¼ˆå¦‚å¯†ç ï¼‰">ï¼ˆ1ï¼‰éšè—æ•æ„Ÿè¾“å…¥ï¼ˆå¦‚å¯†ç ï¼‰</h3>
<p><strong>é»˜è®¤æƒ…å†µä¸‹ï¼Œç”¨æˆ·è¾“å…¥çš„å†…å®¹ä¼šæ˜æ–‡æ˜¾ç¤ºåœ¨æ§åˆ¶å°ï¼Œå¯¹äºå¯†ç ç­‰æ•æ„Ÿä¿¡æ¯ï¼Œå¯ä½¿ç”¨ getpass æ¨¡å—çš„ getpass() å‡½æ•°éšè—è¾“å…¥ï¼ˆè¾“å…¥å†…å®¹ä¸æ˜¾ç¤ºï¼‰</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> getpass  <span class="comment"># å¯¼å…¥æ¨¡å—</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># éšè—å¯†ç è¾“å…¥ï¼ˆè¾“å…¥å†…å®¹ä¸æ˜¾ç¤ºï¼‰</span></span><br><span class="line">username = <span class="built_in">input</span>(<span class="string">&quot;è¯·è¾“å…¥ç”¨æˆ·åï¼š&quot;</span>)</span><br><span class="line">password = getpass.getpass(<span class="string">&quot;è¯·è¾“å…¥å¯†ç ï¼š&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç®€å•éªŒè¯ï¼ˆå®é™…å¼€å‘ä¸­éœ€å¯¹æ¥æ•°æ®åº“ï¼‰</span></span><br><span class="line"><span class="keyword">if</span> username == <span class="string">&quot;admin&quot;</span> <span class="keyword">and</span> password == <span class="string">&quot;123456&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ç™»å½•æˆåŠŸï¼&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰é¢„è®¾é»˜è®¤å€¼ï¼ˆç”¨æˆ·å¯ç›´æ¥å›è½¦ä½¿ç”¨é»˜è®¤å€¼ï¼‰">ï¼ˆ2ï¼‰é¢„è®¾é»˜è®¤å€¼ï¼ˆç”¨æˆ·å¯ç›´æ¥å›è½¦ä½¿ç”¨é»˜è®¤å€¼ï¼‰</h3>
<p><strong>å¯¹äºå¯é€‰è¾“å…¥é¡¹ï¼Œå¯è®¾ç½®é»˜è®¤å€¼ï¼Œç”¨æˆ·ç›´æ¥æŒ‰ä¸‹å›è½¦é”®æ—¶ï¼Œä½¿ç”¨é¢„è®¾å€¼ï¼Œæå‡äº¤äº’æ•ˆç‡</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¤ºä¾‹ï¼šè®¾ç½®é»˜è®¤å¹´é¾„ä¸º 18</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        user_input = <span class="built_in">input</span>(<span class="string">&quot;è¯·è¾“å…¥ä½ çš„å¹´é¾„ï¼ˆé»˜è®¤ 18ï¼‰ï¼š&quot;</span>)</span><br><span class="line">        age = <span class="built_in">int</span>(user_input) <span class="keyword">if</span> user_input != <span class="string">&quot;&quot;</span> <span class="keyword">else</span> <span class="number">18</span> <span class="comment"># ç©ºè¾“å…¥åˆ™ä½¿ç”¨é»˜è®¤å€¼ 18</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;é”™è¯¯ï¼šè¾“å…¥çš„ä¸æ˜¯æœ‰æ•ˆæ•°å­—ï¼Œè¯·é‡æ–°è¾“å…¥ï¼&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ä½ çš„å¹´é¾„ï¼š<span class="subst">&#123;age&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="6-é¿å‘è¦ç‚¹ä¸æ³¨æ„äº‹é¡¹">6.é¿å‘è¦ç‚¹ä¸æ³¨æ„äº‹é¡¹</h2>
<ul>
<li><strong>æ°¸è¿œä¸è¦ä¿¡ä»»ç”¨æˆ·è¾“å…¥</strong>ï¼šç”¨æˆ·è¾“å…¥å…·æœ‰ä¸å¯æ§æ€§ï¼Œå¿…é¡»è¿›è¡ŒéªŒè¯ï¼ˆç±»å‹ã€èŒƒå›´ã€æ ¼å¼ï¼‰ï¼Œå¦åˆ™ä¼šå¯¼è‡´ç¨‹åºå´©æºƒæˆ–é€»è¾‘é”™è¯¯</li>
<li><strong>ç‰¢è®°è¿”å›å€¼æ˜¯å­—ç¬¦ä¸²</strong>ï¼šæ— è®ºç”¨æˆ·è¾“å…¥ä»€ä¹ˆï¼Œå…ˆæŒ‰å­—ç¬¦ä¸²å¤„ç†ï¼Œå†æ ¹æ®éœ€æ±‚è½¬æ¢ç±»å‹ï¼Œé¿å…ç›´æ¥ç”¨è¾“å…¥å†…å®¹åšè¿ç®—</li>
<li><strong>å¾ªç¯éªŒè¯æ—¶æ³¨æ„é€€å‡ºæ¡ä»¶</strong>ï¼šç”¨ while True åšå¾ªç¯éªŒè¯æ—¶ï¼Œå¿…é¡»ç¡®ä¿æœ‰ breakè¯­å¥é€€å‡ºå¾ªç¯ï¼Œé¿å…æ— é™å¾ªç¯</li>
<li><strong>åŒºåˆ† split() ä¸ split(â€˜åˆ†éš”ç¬¦â€™)</strong>
<ul>
<li><strong>split()</strong>ï¼š é»˜è®¤æŒ‰ä»»æ„ç©ºç™½å­—ç¬¦ï¼ˆç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œï¼‰æ‹†åˆ†</li>
<li><strong>split(â€˜åˆ†éš”ç¬¦â€™)</strong>ï¼šæŒ‰æŒ‡å®šåˆ†éš”ç¬¦æ‹†åˆ†ï¼Œéœ€æ ¹æ®ç”¨æˆ·è¾“å…¥æ ¼å¼é€‰æ‹©</li>
</ul>
</li>
<li><strong>æ•æ„Ÿè¾“å…¥ç”¨ getpass è€Œé input</strong>ï¼šå¯†ç ã€éªŒè¯ç ç­‰æ•æ„Ÿä¿¡æ¯ï¼Œä¸è¦ç”¨ input() æ˜æ–‡æ˜¾ç¤ºï¼Œä¼˜å…ˆä½¿ç”¨ getpass.getpass()</li>
<li><strong>å…¼å®¹ç©ºè¾“å…¥åœºæ™¯</strong>ï¼šç”¨æˆ·å¯èƒ½ç›´æ¥å›è½¦ï¼Œéœ€æå‰åˆ¤æ–­ç©ºå­—ç¬¦ä¸²å¹¶å¤„ç†ï¼ˆå¦‚è®¾ç½®é»˜è®¤å€¼ã€æç¤ºé‡æ–°è¾“å…¥ï¼‰</li>
</ul>
<h1>å…«ã€å‡½æ•°</h1>
<h2 id="1-å‡½æ•°çš„æ ¸å¿ƒå®šä¹‰">1.å‡½æ•°çš„æ ¸å¿ƒå®šä¹‰</h2>
<p><strong>å‡½æ•°æ˜¯ Python ä¸­ã€Œå°è£…å¯å¤ç”¨é€»è¾‘çš„åŸºæœ¬å•å…ƒã€ï¼Œæœ¬è´¨æ˜¯â€œè¾“å…¥â†’å¤„ç†â†’è¾“å‡ºâ€çš„é»‘ç›’</strong></p>
<ul>
<li><strong>è¾“å…¥</strong>ï¼šé€šè¿‡å‚æ•°æ¥æ”¶å¤–éƒ¨æ•°æ®</li>
<li><strong>å¤„ç†</strong>ï¼šæ‰§è¡Œå°è£…çš„ä»£ç é€»è¾‘</li>
<li><strong>è¾“å‡º</strong>ï¼šé€šè¿‡è¿”å›å€¼å‘å¤–éƒ¨åé¦ˆç»“æœï¼ˆæ— è¿”å›å€¼åˆ™é»˜è®¤è¿”å› Noneï¼‰</li>
</ul>
<p><strong>æ³¨ï¼ï¼</strong>ï¼šå‡½æ•°ä½“å¿…é¡»<strong>é€šè¿‡ç¼©è¿›æ¥æ ‡è¯†</strong>ï¼ˆé»˜è®¤ 4 ä¸ªç©ºæ ¼ï¼‰ï¼Œè¿™æ˜¯ Python åŒºåˆ†ä»£ç å—å½’å±çš„æ ¸å¿ƒè§„åˆ™ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260110153245076.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®Œæ•´ç»“æ„ï¼šå…³é”®å­— + å‡½æ•°å + å‚æ•° + å†’å· + ç¼©è¿›ä½“ + è¿”å›å€¼</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">å‡½æ•°å</span>(<span class="params">å‚æ•°åˆ—è¡¨</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ–‡æ¡£å­—ç¬¦ä¸²ï¼ˆå¯é€‰ï¼Œç”¨äºè¯´æ˜å‡½æ•°åŠŸèƒ½ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># å‡½æ•°ä½“ï¼ˆè¦æ‰§è¡Œçš„é€»è¾‘ï¼‰</span></span><br><span class="line">    å¤„ç†é€»è¾‘</span><br><span class="line">    <span class="keyword">return</span> è¿”å›å€¼  <span class="comment"># å¯é€‰ï¼Œæ— returnåˆ™è¿”å›None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€ç®€ç¤ºä¾‹ï¼šè®¡ç®—ä¸¤æ•°ä¹‹å’Œ</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è®¡ç®—ä¸¤ä¸ªæ•°çš„å’Œ&quot;&quot;&quot;</span></span><br><span class="line">    result = a + b</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨å‡½æ•°ï¼ˆæ‰§è¡Œå‡½æ•°é€»è¾‘ï¼Œè·å–è¿”å›å€¼ï¼‰</span></span><br><span class="line">sum_result = add(<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line"><span class="built_in">print</span>(sum_result)  <span class="comment"># è¾“å‡ºï¼š30</span></span><br></pre></td></tr></table></figure>
<h2 id="2-å‡½æ•°çš„å‚æ•°ä½“ç³»ï¼ˆæ ¸å¿ƒé‡ç‚¹ï¼‰">2.å‡½æ•°çš„å‚æ•°ä½“ç³»ï¼ˆæ ¸å¿ƒé‡ç‚¹ï¼‰</h2>
<p><strong>å‚æ•°ç»„åˆé¡ºåº</strong>:ä½ç½®å‚æ•° â†’ é»˜è®¤å‚æ•° â†’ *args â†’ ä»…é™å…³é”®å­—å‚æ•° â†’ **kwargs</p>
<h3 id="ï¼ˆ1ï¼‰ä½ç½®å‚æ•°">ï¼ˆ1ï¼‰ä½ç½®å‚æ•°</h3>
<ul>
<li><strong>å®šä¹‰</strong>ï¼šæœ€åŸºç¡€çš„å‚æ•°ï¼Œè°ƒç”¨æ—¶<strong>å¿…é¡»æŒ‰ã€Œå®šä¹‰é¡ºåºã€ä¼ å…¥</strong>ï¼Œ<strong>æ•°é‡å¿…é¡»åŒ¹é…</strong></li>
<li><strong>ç‰¹ç‚¹</strong>ï¼šæ— é»˜è®¤å€¼ï¼Œä¸ä¼ åˆ™æŠ¥é”™</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">print_info</span>(<span class="params">name, age</span>):  <span class="comment"># nameã€ageæ˜¯ä½ç½®å‚æ•°</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å§“åï¼š<span class="subst">&#123;name&#125;</span>ï¼Œå¹´é¾„ï¼š<span class="subst">&#123;age&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­£ç¡®è°ƒç”¨ï¼ˆæŒ‰ä½ç½®ä¼ å‚ï¼‰</span></span><br><span class="line">print_info(<span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="number">25</span>)  <span class="comment"># è¾“å‡ºï¼šå§“åï¼šå¼ ä¸‰ï¼Œå¹´é¾„ï¼š25</span></span><br><span class="line"><span class="comment"># é”™è¯¯è°ƒç”¨ï¼ˆå°‘ä¼ å‚æ•°ï¼‰</span></span><br><span class="line"><span class="comment"># print_info(&quot;æå››&quot;)  # æŠ¥é”™ï¼šmissing 1 required positional argument: &#x27;age&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰é»˜è®¤å‚æ•°">ï¼ˆ2ï¼‰é»˜è®¤å‚æ•°</h3>
<ul>
<li><strong>å®šä¹‰</strong>ï¼šç»™å‚æ•°æŒ‡å®šé»˜è®¤å€¼ï¼Œè°ƒç”¨æ—¶<strong>å¯çœç•¥ä¸ä¼ </strong>ï¼ˆä½¿ç”¨é»˜è®¤å€¼ï¼‰</li>
<li><strong>ç‰¹ç‚¹</strong>
<ul>
<li>é»˜è®¤å‚æ•°<strong>å¿…é¡»æ”¾åœ¨ã€Œä½ç½®å‚æ•°ä¹‹åã€</strong></li>
<li>é»˜è®¤å‚æ•°<strong>å»ºè®®ç”¨ã€Œä¸å¯å˜å¯¹è±¡ã€</strong>ï¼ˆå¦‚æ•°å­—ã€å­—ç¬¦ä¸²ã€å…ƒç»„ï¼‰ï¼Œé¿å…ç”¨åˆ—è¡¨/å­—å…¸ï¼ˆå¯å˜å¯¹è±¡ä¼šå¯¼è‡´å¤šæ¬¡è°ƒç”¨å…±äº«æ•°æ®ï¼‰</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># cityæ˜¯é»˜è®¤å‚æ•°ï¼ˆé»˜è®¤å€¼&quot;åŒ—äº¬&quot;ï¼‰ï¼Œå¿…é¡»æ”¾åœ¨ä½ç½®å‚æ•°å</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_info</span>(<span class="params">name, age, city=<span class="string">&quot;åŒ—äº¬&quot;</span></span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å§“åï¼š<span class="subst">&#123;name&#125;</span>ï¼Œå¹´é¾„ï¼š<span class="subst">&#123;age&#125;</span>ï¼ŒåŸå¸‚ï¼š<span class="subst">&#123;city&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># çœç•¥é»˜è®¤å‚æ•°ï¼ˆä½¿ç”¨&quot;åŒ—äº¬&quot;ï¼‰</span></span><br><span class="line">print_info(<span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="number">25</span>)  <span class="comment"># è¾“å‡ºï¼šå§“åï¼šå¼ ä¸‰ï¼Œå¹´é¾„ï¼š25ï¼ŒåŸå¸‚ï¼šåŒ—äº¬</span></span><br><span class="line"><span class="comment"># è¦†ç›–é»˜è®¤å‚æ•°ï¼ˆä¼ &quot;ä¸Šæµ·&quot;ï¼‰</span></span><br><span class="line">print_info(<span class="string">&quot;æå››&quot;</span>, <span class="number">30</span>, <span class="string">&quot;ä¸Šæµ·&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šå§“åï¼šæå››ï¼Œå¹´é¾„ï¼š30ï¼ŒåŸå¸‚ï¼šä¸Šæµ·</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘ç‚¹ï¼šé»˜è®¤å‚æ•°ç”¨å¯å˜å¯¹è±¡ï¼ˆåˆ—è¡¨ï¼‰çš„é—®é¢˜</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_item</span>(<span class="params">item, lst=[]</span>):  <span class="comment"># ä¸æ¨èï¼lstæ˜¯å¯å˜å¯¹è±¡</span></span><br><span class="line">    lst.append(item)</span><br><span class="line">    <span class="keyword">return</span> lst</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(add_item(<span class="number">1</span>))  <span class="comment"># [1]ï¼ˆç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œlståˆå§‹åŒ–ä¸ºç©ºåˆ—è¡¨ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(add_item(<span class="number">2</span>))  <span class="comment"># [1,2]ï¼ˆç¬¬äºŒæ¬¡è°ƒç”¨ï¼Œlstå¤ç”¨äº†ä¸Šæ¬¡çš„åˆ—è¡¨ï¼‰</span></span><br><span class="line"><span class="comment"># æ­£ç¡®å†™æ³•ï¼šé»˜è®¤å‚æ•°ç”¨Noneï¼Œå†…éƒ¨åˆå§‹åŒ–</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_item</span>(<span class="params">item, lst=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> lst <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        lst = []</span><br><span class="line">    lst.append(item)</span><br><span class="line">    <span class="keyword">return</span> lst</span><br><span class="line"><span class="built_in">print</span>(add_item(<span class="number">1</span>))  <span class="comment"># [1]</span></span><br><span class="line"><span class="built_in">print</span>(add_item(<span class="number">2</span>))  <span class="comment"># [2]</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰å…³é”®å­—å‚æ•°">ï¼ˆ3ï¼‰å…³é”®å­—å‚æ•°</h3>
<ul>
<li><strong>å®šä¹‰</strong>ï¼šè°ƒç”¨å‡½æ•°æ—¶ï¼Œé€šè¿‡ <strong>ã€Œå‚æ•°å=å€¼ã€</strong> çš„æ–¹å¼ä¼ å‚ï¼Œ<strong>æ— éœ€æŒ‰ä½ç½®é¡ºåºä¼ å…¥</strong></li>
<li><strong>ç‰¹ç‚¹</strong>ï¼šæé«˜ä»£ç å¯è¯»æ€§ï¼Œé€‚åˆå‚æ•°å¤šçš„åœºæ™¯</li>
<li><strong>æ³¨æ„</strong>ï¼šè°ƒç”¨æ—¶ï¼Œå…³é”®å­—å‚æ•°ä¸èƒ½åœ¨ä½ç½®å‚æ•°å‰</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">print_info</span>(<span class="params">name, age, city</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å§“åï¼š<span class="subst">&#123;name&#125;</span>ï¼Œå¹´é¾„ï¼š<span class="subst">&#123;age&#125;</span>ï¼ŒåŸå¸‚ï¼š<span class="subst">&#123;city&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é”®å­—å‚æ•°ï¼ˆé¡ºåºå¯æ‰“ä¹±ï¼‰</span></span><br><span class="line">print_info(age=<span class="number">25</span>, name=<span class="string">&quot;å¼ ä¸‰&quot;</span>, city=<span class="string">&quot;åŒ—äº¬&quot;</span>)  <span class="comment"># è¾“å‡ºæ­£å¸¸</span></span><br><span class="line"><span class="comment"># æ··åˆä½ç½®å‚æ•°+å…³é”®å­—å‚æ•°ï¼ˆä½ç½®å‚æ•°å¿…é¡»åœ¨å‰ï¼‰</span></span><br><span class="line">print_info(<span class="string">&quot;å¼ ä¸‰&quot;</span>, city=<span class="string">&quot;ä¸Šæµ·&quot;</span>, age=<span class="number">30</span>)  <span class="comment"># æ­£ç¡®</span></span><br><span class="line"><span class="comment"># print_info(city=&quot;å¹¿å·&quot;, &quot;æå››&quot;, 28)  # é”™è¯¯ï¼šå…³é”®å­—å‚æ•°ä¸èƒ½åœ¨ä½ç½®å‚æ•°å‰</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ4ï¼‰ä»…é™å…³é”®å­—å‚æ•°ï¼ˆ-ï¼‰ï¼ˆPython-3-ï¼‰">ï¼ˆ4ï¼‰ä»…é™å…³é”®å­—å‚æ•°ï¼ˆ * ï¼‰ï¼ˆPython 3+ï¼‰</h3>
<ul>
<li><strong>å®šä¹‰</strong>ï¼šå¿…é¡»é€šè¿‡å…³é”®å­—å‚æ•°ä¼ å…¥çš„å‚æ•°ï¼Œæ”¾åœ¨ *args ä¹‹åã€**kwargs ä¹‹å‰ï¼›</li>
<li><strong>ä½œç”¨</strong>ï¼šå¼ºåˆ¶è°ƒç”¨è€…æ˜ç¡®å‚æ•°åï¼Œé¿å…æ­§ä¹‰</li>
<li><strong>å®šä¹‰ä»…é™å…³é”®å­—</strong>ï¼š
<ul>
<li>1.ä½¿ç”¨ <strong>*</strong> ä½œä¸ºåˆ†éš”ç¬¦ï¼š<br>
* ä¹‹åçš„å‚æ•°éƒ½è¢«æ ‡è®°ä¸ºä»…é™å…³é”®å­—å‚æ•°ï¼Œè°ƒç”¨æ—¶å¿…é¡»ç”¨ å…³é”®å­—=å€¼ çš„å½¢å¼ä¼ é€’ã€‚</li>
<li>2.*args ä¹‹åçš„å‚æ•°è‡ªåŠ¨æˆä¸ºä»…é™å…³é”®å­—å‚æ•°</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1.ä½¿ç”¨ * ä½œä¸ºåˆ†éš”ç¬¦</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">a, *, b, c</span>):  <span class="comment"># * ä¹‹åçš„bã€cæ˜¯ä»…é™å…³é”®å­—å‚æ•°</span></span><br><span class="line">    <span class="built_in">print</span>(a, b, c)</span><br><span class="line"></span><br><span class="line">func(<span class="number">1</span>, b=<span class="number">2</span>, c=<span class="number">3</span>)  <span class="comment"># æ­£ç¡®ï¼ˆå¿…é¡»ç”¨å…³é”®å­—ä¼ bã€cï¼‰</span></span><br><span class="line"><span class="comment"># func(1, 2, 3)  # é”™è¯¯ï¼šb,c must be keyword arguments</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 2.\*args ä¹‹å</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_info</span>(<span class="params">*args, sep=<span class="string">&#x27; &#x27;</span>, end=<span class="string">&#x27;\n&#x27;</span>, file=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    æ¨¡æ‹ŸPythonå†…ç½®çš„printå‡½æ•°ï¼š*argsæ¥æ”¶ä»»æ„ä½ç½®å‚æ•°ï¼Œsep/end/fileæ˜¯ä»…é™å…³é”®å­—å‚æ•°</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    output = sep.join(<span class="built_in">map</span>(<span class="built_in">str</span>, args))</span><br><span class="line">    <span class="built_in">print</span>(output, end=end, file=file)</span><br><span class="line"></span><br><span class="line"><span class="comment"># âœ… æ­£ç¡®è°ƒç”¨</span></span><br><span class="line">print_info(<span class="string">&#x27;Hello&#x27;</span>, <span class="string">&#x27;Python&#x27;</span>, sep=<span class="string">&#x27;-&#x27;</span>, end=<span class="string">&#x27;!\n&#x27;</span>)  <span class="comment"># è¾“å‡º: Hello-Python!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># âŒ é”™è¯¯è°ƒç”¨</span></span><br><span class="line"><span class="comment"># print_info(&#x27;Hello&#x27;, &#x27;Python&#x27;, &#x27;-&#x27;, &#x27;!\n&#x27;)  # sep/endè¢«å½“ä½œargsä¼ é€’ï¼Œè¾¾ä¸åˆ°é¢„æœŸæ•ˆæœ</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ5ï¼‰ä¸‡èƒ½å‚æ•°ï¼ˆ-args-å’Œ-kwargsï¼‰">ï¼ˆ5ï¼‰ä¸‡èƒ½å‚æ•°ï¼ˆ*args å’Œ **kwargsï¼‰</h3>
<ul>
<li><strong>ç”¨äºæ¥æ”¶ã€Œä¸ç¡®å®šæ•°é‡ã€çš„å‚æ•°ï¼Œæ˜¯å®ç°é€šç”¨å‡½æ•°çš„æ ¸å¿ƒ</strong></li>
<li><strong>æ³¨æ„</strong>ï¼š*args å’Œ **kwargs å‡<strong>æ”¯æŒä¸ä¼ å…¥ä»»ä½•å¯¹åº”å‚æ•°</strong>ï¼Œç¨‹åºä¸ä¼šæŠ¥é”™ï¼Œä¼šè‡ªåŠ¨ä»¥ç©ºå®¹å™¨æ¥æ”¶</li>
</ul>
<h4 id="1-argsï¼šæ¥æ”¶ä»»æ„æ•°é‡çš„ä½ç½®å‚æ•°ï¼Œæ‰“åŒ…ä¸ºâ€œå…ƒç»„â€">&lt;1&gt;*argsï¼šæ¥æ”¶ä»»æ„æ•°é‡çš„ä½ç½®å‚æ•°ï¼Œæ‰“åŒ…ä¸ºâ€œå…ƒç»„â€</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">sum_all</span>(<span class="params">*args</span>):  <span class="comment"># argsæ˜¯å…ƒç»„ï¼Œæ¥æ”¶æ‰€æœ‰ä½ç½®å‚æ•°</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;argsç±»å‹ï¼š&quot;</span>, <span class="built_in">type</span>(args))  <span class="comment"># &lt;class &#x27;tuple&#x27;&gt;</span></span><br><span class="line">    total = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> args:</span><br><span class="line">        total += num</span><br><span class="line">    <span class="keyword">return</span> total</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¼ å…¥ä»»æ„æ•°é‡å‚æ•°</span></span><br><span class="line"><span class="built_in">print</span>(sum_all(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>))  <span class="comment"># 6</span></span><br><span class="line"><span class="built_in">print</span>(sum_all(<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>))  <span class="comment"># 100</span></span><br><span class="line"><span class="built_in">print</span>(sum_all())  <span class="comment"># 0ï¼ˆæ— å‚æ•°æ—¶argsæ˜¯ç©ºå…ƒç»„ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£åŒ…åˆ—è¡¨/å…ƒç»„ä¼ å…¥args</span></span><br><span class="line">nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="built_in">print</span>(sum_all(*nums))  <span class="comment"># 6ï¼ˆ*è¡¨ç¤ºè§£åŒ…ï¼‰</span></span><br></pre></td></tr></table></figure>
<h4 id="2-kwargsï¼šæ¥æ”¶ä»»æ„æ•°é‡çš„å…³é”®å­—å‚æ•°ï¼Œæ‰“åŒ…ä¸ºâ€œå­—å…¸â€">&lt;2&gt;**kwargsï¼šæ¥æ”¶ä»»æ„æ•°é‡çš„å…³é”®å­—å‚æ•°ï¼Œæ‰“åŒ…ä¸ºâ€œå­—å…¸â€</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">print_kwargs</span>(<span class="params">**kwargs</span>):  <span class="comment"># kwargsæ˜¯å­—å…¸ï¼Œæ¥æ”¶æ‰€æœ‰å…³é”®å­—å‚æ•°</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;kwargsç±»å‹ï¼š&quot;</span>, <span class="built_in">type</span>(kwargs))  <span class="comment"># &lt;class &#x27;dict&#x27;&gt;</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> kwargs.items():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;k&#125;</span>: <span class="subst">&#123;v&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¼ å…¥ä»»æ„æ•°é‡å…³é”®å­—å‚æ•°</span></span><br><span class="line">print_kwargs(name=<span class="string">&quot;å¼ ä¸‰&quot;</span>, age=<span class="number">25</span>, city=<span class="string">&quot;åŒ—äº¬&quot;</span>)</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment"># name: å¼ ä¸‰</span></span><br><span class="line"><span class="comment"># age: 25</span></span><br><span class="line"><span class="comment"># city: åŒ—äº¬</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£åŒ…å­—å…¸ä¼ å…¥kwargs</span></span><br><span class="line">info = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;æå››&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">30</span>&#125;</span><br><span class="line">print_kwargs(**info)  <span class="comment"># **è¡¨ç¤ºè§£åŒ…å­—å…¸</span></span><br></pre></td></tr></table></figure>
<h4 id="3-args-ä¸-kwargs-å››ç§ä¼ å‚åœºæ™¯æ¼”ç¤º">&lt;3&gt;*args ä¸ **kwargs å››ç§ä¼ å‚åœºæ™¯æ¼”ç¤º</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰æ”¯æŒä»»æ„ä½ç½®å‚æ•°å’Œå…³é”®å­—å‚æ•°çš„å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;1. ä½ç½®å‚æ•° argsï¼š<span class="subst">&#123;args&#125;</span>&quot;</span>)  <span class="comment"># argsæ‰“åŒ…ä¸ºå…ƒç»„</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;2. å…³é”®å­—å‚æ•° kwargsï¼š<span class="subst">&#123;kwargs&#125;</span>&quot;</span>)  <span class="comment"># kwargsæ‰“åŒ…ä¸ºå­—å…¸</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">30</span>)  <span class="comment"># åˆ†éš”çº¿ï¼Œæ¸…æ™°åŒºåˆ†ä¸åŒåœºæ™¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœºæ™¯1ï¼šä¸ä¼ å‚</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;åœºæ™¯1ï¼šä¸ä¼ å‚&quot;</span>)</span><br><span class="line">func()</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœºæ™¯2ï¼šä»…*argsä¼ å‚ï¼ˆä½ç½®å‚æ•°ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;åœºæ™¯2ï¼šä»…*argsä¼ å‚ï¼ˆ2ä¸ªä½ç½®å‚æ•°ï¼‰&quot;</span>)</span><br><span class="line">func(<span class="number">10</span>, <span class="number">20</span>)  <span class="comment"># ç›´æ¥ä¼ ä½ç½®å‚æ•°ï¼Œè‡ªåŠ¨æ‰“åŒ…åˆ°args</span></span><br><span class="line"><span class="comment"># ä¹Ÿå¯é€šè¿‡è§£åŒ…å¯è¿­ä»£å¯¹è±¡ä¼ å‚ï¼ˆå‘¼åº”å‰æ–‡*è§£åŒ…çŸ¥è¯†ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;åœºæ™¯2æ‰©å±•ï¼šè§£åŒ…åˆ—è¡¨ä¼ å‚ç»™*args&quot;</span>)</span><br><span class="line">func(*[<span class="number">30</span>, <span class="number">40</span>])  <span class="comment"># è§£åŒ…åˆ—è¡¨ä¸ºä½ç½®å‚æ•°ï¼Œç­‰ä»·äºfunc(30,40)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœºæ™¯3ï¼šä»…**kwargsä¼ å‚ï¼ˆå…³é”®å­—å‚æ•°ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;åœºæ™¯3ï¼šä»…**kwargsä¼ å‚ï¼ˆ2ä¸ªå…³é”®å­—å‚æ•°ï¼‰&quot;</span>)</span><br><span class="line">func(name=<span class="string">&quot;Python&quot;</span>, version=<span class="number">3.10</span>)  <span class="comment"># ç›´æ¥ä¼ å…³é”®å­—å‚æ•°ï¼Œè‡ªåŠ¨æ‰“åŒ…åˆ°kwargs</span></span><br><span class="line"><span class="comment"># ä¹Ÿå¯é€šè¿‡è§£åŒ…å­—å…¸ä¼ å‚ï¼ˆå‘¼åº”å‰æ–‡**è§£åŒ…çŸ¥è¯†ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;åœºæ™¯3æ‰©å±•ï¼šè§£åŒ…å­—å…¸ä¼ å‚ç»™**kwargs&quot;</span>)</span><br><span class="line">func(**&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Java&quot;</span>, <span class="string">&quot;version&quot;</span>: <span class="number">17</span>&#125;)  <span class="comment"># è§£åŒ…å­—å…¸ä¸ºå…³é”®å­—å‚æ•°ï¼Œç­‰ä»·äºfunc(name=&quot;Java&quot;, version=17)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœºæ™¯4ï¼š*args + **kwargs æ··åˆä¼ å‚</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;åœºæ™¯4ï¼šæ··åˆä¼ å‚ï¼ˆ2ä¸ªä½ç½®å‚æ•° + 2ä¸ªå…³é”®å­—å‚æ•°ï¼‰&quot;</span>)</span><br><span class="line">func(<span class="number">1</span>, <span class="number">2</span>, x=<span class="number">3</span>, y=<span class="number">4</span>)</span><br><span class="line"><span class="comment"># æ··åˆè§£åŒ…ä¼ å‚ï¼ˆå®ç”¨åœºæ™¯ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;åœºæ™¯4æ‰©å±•ï¼šæ··åˆè§£åŒ…ä¼ å‚&quot;</span>)</span><br><span class="line">func(*(<span class="number">5</span>, <span class="number">6</span>), **&#123;<span class="string">&quot;x&quot;</span>:<span class="number">7</span>, <span class="string">&quot;y&quot;</span>:<span class="number">8</span>&#125;)  <span class="comment"># è§£åŒ…å…ƒç»„+å­—å…¸ï¼Œç­‰ä»·äºfunc(5,6,x=7,y=8)</span></span><br></pre></td></tr></table></figure>
<h4 id="4-å‚æ•°ç»„åˆé¡ºåºï¼ˆå¿…é¡»éµå®ˆï¼‰">&lt;4&gt;å‚æ•°ç»„åˆé¡ºåºï¼ˆå¿…é¡»éµå®ˆï¼‰</h4>
<p><strong>ä½ç½®å‚æ•° â†’ é»˜è®¤å‚æ•° â†’ *args â†’ ä»…é™å…³é”®å­—å‚æ•° â†’ **kwargs</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ­£ç¡®é¡ºåºç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">a, b=<span class="number">10</span>, *args, c, **kwargs</span>):</span><br><span class="line">    <span class="built_in">print</span>(a, b, args, c, kwargs)</span><br><span class="line"></span><br><span class="line">func(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, c=<span class="number">5</span>, d=<span class="number">6</span>, e=<span class="number">7</span>)  <span class="comment"># è¾“å‡ºï¼š1 2 (3, 4) 5 &#123;&#x27;d&#x27;: 6, &#x27;e&#x27;: 7&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="3-å‡½æ•°çš„è¿”å›å€¼">3.å‡½æ•°çš„è¿”å›å€¼</h2>
<h3 id="ï¼ˆ1ï¼‰åŸºæœ¬è§„åˆ™">ï¼ˆ1ï¼‰åŸºæœ¬è§„åˆ™</h3>
<ul>
<li><strong>æ—  return è¯­å¥</strong>ï¼šå‡½æ•°æ‰§è¡Œå®Œé»˜è®¤è¿”å› None</li>
<li><strong>æœ‰ return è¯­å¥</strong>ï¼šæ‰§è¡Œåˆ° return ç«‹å³ç»ˆæ­¢å‡½æ•°ï¼Œè¿”å›æŒ‡å®šå€¼</li>
<li><strong>å¯è¿”å›ä»»æ„ç±»å‹</strong>ï¼šæ•°å­—ã€å­—ç¬¦ä¸²ã€åˆ—è¡¨ã€å­—å…¸ã€å‡½æ•°ã€å¯¹è±¡ç­‰</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰å¤šè¿”å›å€¼ï¼ˆPython-ç‰¹è‰²ï¼‰">ï¼ˆ2ï¼‰å¤šè¿”å›å€¼ï¼ˆPython ç‰¹è‰²ï¼‰</h3>
<p><strong>Python æ²¡æœ‰çœŸæ­£çš„â€œå¤šè¿”å›å€¼â€ï¼Œæœ¬è´¨æ˜¯è¿”å›ã€Œå…ƒç»„ã€ï¼Œåªæ˜¯çœç•¥äº†æ‹¬å·</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_info</span>():</span><br><span class="line">    name = <span class="string">&quot;å¼ ä¸‰&quot;</span></span><br><span class="line">    age = <span class="number">25</span></span><br><span class="line">    <span class="keyword">return</span> name, age  <span class="comment"># ç­‰ä»·äº return (name, age)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¥æ”¶å¤šè¿”å›å€¼ï¼ˆè‡ªåŠ¨è§£åŒ…ï¼‰</span></span><br><span class="line">name, age = get_info()</span><br><span class="line"><span class="built_in">print</span>(name, age)  <span class="comment"># å¼ ä¸‰ 25</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥æ¥æ”¶ä¸ºå…ƒç»„</span></span><br><span class="line">result = get_info()</span><br><span class="line"><span class="built_in">print</span>(result)  <span class="comment"># (&#x27;å¼ ä¸‰&#x27;, 25)</span></span><br></pre></td></tr></table></figure>
<h2 id="4-å‡½æ•°çš„ä½œç”¨åŸŸï¼ˆå˜é‡å¯è§æ€§ï¼‰">4.å‡½æ•°çš„ä½œç”¨åŸŸï¼ˆå˜é‡å¯è§æ€§ï¼‰</h2>
<h3 id="ï¼ˆ1ï¼‰å››ç§ä½œç”¨åŸŸä»‹ç»">ï¼ˆ1ï¼‰å››ç§ä½œç”¨åŸŸä»‹ç»</h3>
<p>Python éµå¾ªã€ŒLEGB è§„åˆ™ã€ï¼Œå˜é‡æŸ¥æ‰¾ä¼˜å…ˆçº§ï¼š</p>
<ul>
<li><strong>å…¨å±€ä½œç”¨åŸŸï¼ˆGlobalï¼‰</strong>
<ul>
<li>æ¨¡å—ï¼ˆ.pyæ–‡ä»¶ï¼‰çº§åˆ«çš„å˜é‡ï¼Œå¯è¢«å½“å‰æ¨¡å—å†…çš„æ‰€æœ‰å‡½æ•°ã€ç±»è®¿é—®ï¼Œé™¤éè¢«å±€éƒ¨å˜é‡é®è”½ï¼›</li>
</ul>
</li>
<li><strong>å±€éƒ¨ä½œç”¨åŸŸï¼ˆLocalï¼‰</strong>
<ul>
<li>å‡½æ•°å†…éƒ¨å®šä¹‰çš„å˜é‡ï¼Œä»…åœ¨å½“å‰å‡½æ•°ä½“å†…æœ‰æ•ˆï¼Œå‡½æ•°æ‰§è¡Œç»“æŸåå˜é‡è¢«é”€æ¯</li>
</ul>
</li>
<li><strong>åµŒå¥—ä½œç”¨åŸŸï¼ˆEnclosingï¼‰</strong>
<ul>
<li>å¤–éƒ¨å‡½æ•°ï¼ˆåµŒå¥—å‡½æ•°çš„å¤–å±‚ï¼‰å®šä¹‰çš„å˜é‡ï¼Œä»…å¯¹å¤–éƒ¨å‡½æ•°è‡ªèº«åŠå†…éƒ¨åµŒå¥—å‡½æ•°å¯è§</li>
</ul>
</li>
<li><strong>å†…ç½®ä½œç”¨åŸŸï¼ˆBuilt-inï¼‰</strong>
<ul>
<li>Python å†…ç½®çš„å‡½æ•°ã€å…³é”®å­—ç­‰ï¼ˆå¦‚ printã€lenã€intï¼‰ï¼Œæ— éœ€å®šä¹‰å³å¯åœ¨ä»»æ„ä½ç½®ç›´æ¥ä½¿ç”¨ã€‚</li>
</ul>
</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰å››ç§ä½œç”¨åŸŸç¤ºä¾‹">ï¼ˆ2ï¼‰å››ç§ä½œç”¨åŸŸç¤ºä¾‹</h3>
<h4 id="1-å…¨å±€ä½œç”¨åŸŸç¤ºä¾‹">&lt;1&gt;å…¨å±€ä½œç”¨åŸŸç¤ºä¾‹</h4>
<p>å…¨å±€å˜é‡å®šä¹‰åœ¨æ¨¡å—çº§åˆ«ï¼Œå¯è¢«æ¨¡å—å†…æ‰€æœ‰å‡½æ•°è®¿é—®ï¼Œ<strong>ä¿®æ”¹éœ€ç”¨ global å£°æ˜</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…¨å±€å˜é‡ï¼šå®šä¹‰åœ¨æ¨¡å—æœ€å¤–å±‚ï¼Œæ¨¡å—å†…æ‰€æœ‰å‡½æ•°å¯è®¿é—®</span></span><br><span class="line">global_app_name = <span class="string">&quot;Pythonå­¦ä¹ å·¥å…·&quot;</span></span><br><span class="line">global_user_count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register_user</span>(<span class="params">username</span>):</span><br><span class="line">    <span class="comment"># è®¿é—®å…¨å±€å˜é‡global_app_nameï¼ˆæ— éœ€å£°æ˜ï¼Œç›´æ¥è®¿é—®ï¼‰</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ã€<span class="subst">&#123;global_app_name&#125;</span>ã€‘ç”¨æˆ·æ³¨å†Œï¼š<span class="subst">&#123;username&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="comment"># ä¿®æ”¹å…¨å±€å˜é‡éœ€ç”¨globalå£°æ˜</span></span><br><span class="line">    <span class="keyword">global</span> global_user_count</span><br><span class="line">    global_user_count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_user_count</span>():</span><br><span class="line">    <span class="comment"># ä¸åŒå‡½æ•°å¯å…±äº«å…¨å±€å˜é‡</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ã€<span class="subst">&#123;global_app_name&#125;</span>ã€‘å½“å‰æ³¨å†Œç”¨æˆ·æ•°ï¼š<span class="subst">&#123;global_user_count&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨å‡½æ•°ï¼Œå…±äº«å¹¶ä¿®æ”¹å…¨å±€å˜é‡</span></span><br><span class="line">register_user(<span class="string">&quot;å¼ ä¸‰&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šã€Pythonå­¦ä¹ å·¥å…·ã€‘ç”¨æˆ·æ³¨å†Œï¼šå¼ ä¸‰</span></span><br><span class="line">register_user(<span class="string">&quot;æå››&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šã€Pythonå­¦ä¹ å·¥å…·ã€‘ç”¨æˆ·æ³¨å†Œï¼šæå››</span></span><br><span class="line">get_user_count()       <span class="comment"># è¾“å‡ºï¼šã€Pythonå­¦ä¹ å·¥å…·ã€‘å½“å‰æ³¨å†Œç”¨æˆ·æ•°ï¼š2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨¡å—å¤–éƒ¨ï¼ˆå½“å‰è„šæœ¬å†…ï¼‰å¯ç›´æ¥è®¿é—®å…¨å±€å˜é‡</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;å…¨å±€åº”ç”¨åï¼š<span class="subst">&#123;global_app_name&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šå…¨å±€åº”ç”¨åï¼šPythonå­¦ä¹ å·¥å…·</span></span><br></pre></td></tr></table></figure>
<h4 id="2-å±€éƒ¨ä½œç”¨åŸŸç¤ºä¾‹">&lt;2&gt;å±€éƒ¨ä½œç”¨åŸŸç¤ºä¾‹</h4>
<p>å±€éƒ¨å˜é‡ä»…åœ¨å®šä¹‰å®ƒçš„å‡½æ•°å†…éƒ¨æœ‰æ•ˆï¼Œå¤–éƒ¨æ— æ³•è®¿é—®ï¼Œå‡½æ•°æ‰§è¡Œå®Œæ¯•åå˜é‡é‡Šæ”¾</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰å‡½æ•°ï¼Œå†…éƒ¨åŒ…å«å±€éƒ¨å˜é‡</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_area</span>(<span class="params">radius</span>):</span><br><span class="line">    <span class="comment"># å±€éƒ¨å˜é‡ï¼šä»…åœ¨calculate_areaå†…éƒ¨æœ‰æ•ˆ</span></span><br><span class="line">    pi = <span class="number">3.14159</span>  </span><br><span class="line">    area = pi * radius ** <span class="number">2</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;åœ†çš„é¢ç§¯ï¼š<span class="subst">&#123;area&#125;</span>&quot;</span>)  <span class="comment"># å‡½æ•°å†…éƒ¨å¯æ­£å¸¸è®¿é—®å±€éƒ¨å˜é‡piã€area</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨å‡½æ•°</span></span><br><span class="line">calculate_area(<span class="number">5</span>)  <span class="comment"># è¾“å‡ºï¼šåœ†çš„é¢ç§¯ï¼š78.53975</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é”™è¯¯ï¼šå¤–éƒ¨æ— æ³•è®¿é—®å‡½æ•°å†…çš„å±€éƒ¨å˜é‡</span></span><br><span class="line"><span class="comment"># print(pi)  # æŠ¥é”™ï¼šname &#x27;pi&#x27; is not defined</span></span><br><span class="line"><span class="comment"># print(area)  # æŠ¥é”™ï¼šname &#x27;area&#x27; is not defined</span></span><br></pre></td></tr></table></figure>
<h4 id="3-åµŒå¥—ä½œç”¨åŸŸç¤ºä¾‹">&lt;3&gt;åµŒå¥—ä½œç”¨åŸŸç¤ºä¾‹</h4>
<p>åµŒå¥—ä½œç”¨åŸŸå˜é‡ç”±å¤–éƒ¨å‡½æ•°å®šä¹‰ï¼Œå†…éƒ¨å‡½æ•°å¯ç›´æ¥è®¿é—®ï¼Œå¤–éƒ¨å‡½æ•°å¤–æ— æ³•è®¿é—®</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¤–éƒ¨å‡½æ•°ï¼ˆå®šä¹‰åµŒå¥—ä½œç”¨åŸŸå˜é‡ï¼‰</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">outer_func</span>(<span class="params">company</span>):</span><br><span class="line">    <span class="comment"># åµŒå¥—ä½œç”¨åŸŸå˜é‡ï¼šå¯¹outer_funcå’Œinner_funcå¯è§</span></span><br><span class="line">    department = <span class="string">&quot;æŠ€æœ¯éƒ¨&quot;</span>  </span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å†…éƒ¨å‡½æ•°ï¼ˆåµŒå¥—åœ¨outer_funcå†…éƒ¨ï¼‰</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner_func</span>(<span class="params">name</span>):</span><br><span class="line">        <span class="comment"># å¯ç›´æ¥è®¿é—®åµŒå¥—ä½œç”¨åŸŸå˜é‡departmentå’Œå¤–éƒ¨å‡½æ•°å‚æ•°company</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;å§“åï¼š<span class="subst">&#123;name&#125;</span>ï¼Œå…¬å¸ï¼š<span class="subst">&#123;company&#125;</span>ï¼Œéƒ¨é—¨ï¼š<span class="subst">&#123;department&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    inner_func(<span class="string">&quot;å¼ ä¸‰&quot;</span>)  <span class="comment"># å†…éƒ¨å‡½æ•°è°ƒç”¨ï¼Œæ­£å¸¸è®¿é—®åµŒå¥—å˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨å¤–éƒ¨å‡½æ•°</span></span><br><span class="line">outer_func(<span class="string">&quot;å­—èŠ‚è·³åŠ¨&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šå§“åï¼šå¼ ä¸‰ï¼Œå…¬å¸ï¼šå­—èŠ‚è·³åŠ¨ï¼Œéƒ¨é—¨ï¼šæŠ€æœ¯éƒ¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é”™è¯¯ï¼šå¤–éƒ¨æ— æ³•è®¿é—®åµŒå¥—ä½œç”¨åŸŸå˜é‡</span></span><br><span class="line"><span class="comment"># print(department)  # æŠ¥é”™ï¼šname &#x27;department&#x27; is not defined</span></span><br><span class="line"><span class="comment"># é”™è¯¯ï¼šå¤–éƒ¨æ— æ³•ç›´æ¥è°ƒç”¨å†…éƒ¨å‡½æ•°ï¼ˆé—´æ¥ä½“ç°åµŒå¥—ä½œç”¨åŸŸéš”ç¦»ï¼‰</span></span><br><span class="line"><span class="comment"># inner_func(&quot;æå››&quot;)  # æŠ¥é”™ï¼šname &#x27;inner_func&#x27; is not defined</span></span><br></pre></td></tr></table></figure>
<h4 id="4-å†…ç½®ä½œç”¨åŸŸç¤ºä¾‹">&lt;4&gt;å†…ç½®ä½œç”¨åŸŸç¤ºä¾‹</h4>
<p>å†…ç½®ä½œç”¨åŸŸåŒ…å« Python è‡ªå¸¦çš„å‡½æ•°/å…³é”®å­—ï¼Œæ— éœ€å®šä¹‰å³å¯ç›´æ¥ä½¿ç”¨ï¼Œ<strong>ä¼˜å…ˆçº§æœ€ä½ï¼ˆå½“å…¶ä»–ä½œç”¨åŸŸæœ‰åŒåå˜é‡æ—¶ä¼šè¢«é®è”½ï¼‰</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç›´æ¥ä½¿ç”¨å†…ç½®å‡½æ•°printï¼ˆæ— éœ€å®šä¹‰ï¼Œå±äºå†…ç½®ä½œç”¨åŸŸï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;ä½¿ç”¨å†…ç½®å‡½æ•°printè¾“å‡º&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šä½¿ç”¨å†…ç½®å‡½æ•°printè¾“å‡º</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›´æ¥ä½¿ç”¨å†…ç½®å‡½æ•°lenï¼ˆè®¡ç®—å­—ç¬¦ä¸²é•¿åº¦ï¼‰</span></span><br><span class="line">str_data = <span class="string">&quot;Pythonä½œç”¨åŸŸ&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;å­—ç¬¦ä¸²é•¿åº¦ï¼š<span class="subst">&#123;<span class="built_in">len</span>(str_data)&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šå­—ç¬¦ä¸²é•¿åº¦ï¼š8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šåŒåå±€éƒ¨å˜é‡ä¼šé®è”½å†…ç½®å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_builtin</span>():</span><br><span class="line">    <span class="comment"># å®šä¹‰ä¸å†…ç½®å‡½æ•°åŒåçš„å±€éƒ¨å˜é‡ï¼Œé®è”½å†…ç½®len</span></span><br><span class="line">    <span class="built_in">len</span> = <span class="number">10</span>  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å±€éƒ¨å˜é‡lenï¼š<span class="subst">&#123;<span class="built_in">len</span>&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šå±€éƒ¨å˜é‡lenï¼š10</span></span><br><span class="line">    <span class="comment"># æ­¤æ—¶æ— æ³•ç›´æ¥ä½¿ç”¨å†…ç½®lenå‡½æ•°ï¼Œéœ€é€šè¿‡__builtins__è®¿é—®</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å†…ç½®lenè®¡ç®—é•¿åº¦ï¼š<span class="subst">&#123;__builtins__.<span class="built_in">len</span>(<span class="string">&#x27;test&#x27;</span>)&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šå†…ç½®lenè®¡ç®—é•¿åº¦ï¼š4</span></span><br><span class="line"></span><br><span class="line">test_builtin()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤–éƒ¨ä»å¯æ­£å¸¸ä½¿ç”¨å†…ç½®lenï¼ˆå±€éƒ¨å˜é‡ä¸å½±å“å…¨å±€/å†…ç½®ä½œç”¨åŸŸï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;å¤–éƒ¨ä½¿ç”¨å†…ç½®lenï¼š<span class="subst">&#123;<span class="built_in">len</span>(<span class="string">&#x27;hello&#x27;</span>)&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šå¤–éƒ¨ä½¿ç”¨å†…ç½®lenï¼š5</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰global-ä¸-nonlocal-å…³é”®å­—">ï¼ˆ3ï¼‰global ä¸ nonlocal å…³é”®å­—</h3>
<ul>
<li>åœ¨ Python ä½œç”¨åŸŸè§„åˆ™ä¸­ï¼Œé»˜è®¤**â€œå†…éƒ¨ä½œç”¨åŸŸä¸èƒ½ç›´æ¥ä¿®æ”¹å¤–éƒ¨ä½œç”¨åŸŸå˜é‡â€**ã€‚</li>
<li>global å’Œ nonlocal å…³é”®å­—çš„<strong>æ ¸å¿ƒä½œç”¨</strong>ï¼šã€Œæ‰“ç ´è¿™ä¸€é™åˆ¶ã€ï¼Œæ˜ç¡®å£°æ˜å˜é‡çš„ä½œç”¨åŸŸå½’å±ï¼Œå®ç°å¯¹å¤–éƒ¨å˜é‡çš„ä¿®æ”¹ã€‚</li>
<li>ä¸¤è€…é€‚ç”¨åœºæ™¯ä¸åŒï¼Œéœ€ä¸¥æ ¼åŒºåˆ†ä½¿ç”¨ã€‚</li>
</ul>
<h4 id="1-global-å…³é”®å­—">&lt;1&gt;global å…³é”®å­—</h4>
<ul>
<li><strong>ä½œç”¨</strong>:
<ul>
<li>å£°æ˜å˜é‡æ˜¯ã€Œå…¨å±€ä½œç”¨åŸŸã€çš„å˜é‡ï¼Œå…è®¸<strong>åœ¨å±€éƒ¨ä½œç”¨åŸŸï¼ˆå‡½æ•°å†…éƒ¨ï¼‰ä¸­ä¿®æ”¹å…¨å±€å˜é‡</strong></li>
</ul>
</li>
<li><strong>æ ¸å¿ƒè§„åˆ™</strong>ï¼š
<ul>
<li><strong>ä»…è¯»å–å…¨å±€å˜é‡</strong>ï¼šæ— éœ€ç”¨ global å£°æ˜ï¼Œç›´æ¥è®¿é—®å³å¯</li>
<li><strong>åœ¨å‡½æ•°å†…éƒ¨ä¿®æ”¹å…¨å±€å˜é‡</strong>ï¼š<strong>å¿…é¡»å…ˆé€šè¿‡ global å£°æ˜</strong>ï¼Œå¦åˆ™ä¼šè¢«è§£æä¸ºå±€éƒ¨å˜é‡</li>
<li>å¯åŒæ—¶å£°æ˜å¤šä¸ªå…¨å±€å˜é‡ï¼Œç”¨é€—å·åˆ†éš”ï¼ˆå¦‚ global a, b, cï¼‰</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…¨å±€å˜é‡ï¼ˆæ¨¡å—çº§åˆ«ï¼‰</span></span><br><span class="line">global_count = <span class="number">0</span></span><br><span class="line">global_name = <span class="string">&quot;å…¨å±€é»˜è®¤å&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹1ï¼šä»…è¯»å–å…¨å±€å˜é‡ï¼ˆæ— éœ€globalå£°æ˜ï¼‰</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_global</span>():</span><br><span class="line">    <span class="comment"># ä»…è®¿é—®å…¨å±€å˜é‡ï¼Œä¸ä¿®æ”¹ï¼Œæ— éœ€å£°æ˜global</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ä»…è¯»å–å…¨å±€å˜é‡ï¼šcount=<span class="subst">&#123;global_count&#125;</span>, name=<span class="subst">&#123;global_name&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">read_global()  <span class="comment"># è¾“å‡ºï¼šä»…è¯»å–å…¨å±€å˜é‡ï¼šcount=0, name=å…¨å±€é»˜è®¤å</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹2ï¼šä¿®æ”¹å…¨å±€å˜é‡ï¼ˆå¿…é¡»ç”¨globalå£°æ˜ï¼‰</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modify_global</span>():</span><br><span class="line">    <span class="comment"># å£°æ˜è¦ä¿®æ”¹çš„æ˜¯å…¨å±€å˜é‡ï¼ˆå¿…é¡»åœ¨èµ‹å€¼å‰å£°æ˜ï¼‰</span></span><br><span class="line">    <span class="keyword">global</span> global_count, global_name</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ä¿®æ”¹å…¨å±€å˜é‡</span></span><br><span class="line">    global_count += <span class="number">10</span></span><br><span class="line">    global_name = <span class="string">&quot;ä¿®æ”¹åçš„å…¨å±€å&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è¯»å–å…¨å±€å˜é‡ï¼ˆå£°æ˜åå¯ç›´æ¥ä½¿ç”¨ï¼‰</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å‡½æ•°å†…è®¿é—®å…¨å±€å˜é‡ï¼šcount=<span class="subst">&#123;global_count&#125;</span>, name=<span class="subst">&#123;global_name&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨å‡½æ•°ï¼Œè§¦å‘å…¨å±€å˜é‡ä¿®æ”¹</span></span><br><span class="line">modify_global()  <span class="comment"># è¾“å‡ºï¼šå‡½æ•°å†…è®¿é—®å…¨å±€å˜é‡ï¼šcount=10, name=ä¿®æ”¹åçš„å…¨å±€å</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡½æ•°å¤–éƒ¨éªŒè¯å…¨å±€å˜é‡å·²è¢«ä¿®æ”¹</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;å‡½æ•°å¤–è®¿é—®å…¨å±€å˜é‡ï¼šcount=<span class="subst">&#123;global_count&#125;</span>, name=<span class="subst">&#123;global_name&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šcount=10, name=ä¿®æ”¹åçš„å…¨å±€å</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åé¢æ¡ˆä¾‹ï¼šæœªå£°æ˜globalç›´æ¥èµ‹å€¼ï¼ˆè¢«è§£æä¸ºå±€éƒ¨å˜é‡ï¼‰</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">wrong_modify</span>():</span><br><span class="line">    global_count = <span class="number">100</span>  <span class="comment"># æ­¤å¤„æ˜¯æ–°çš„å±€éƒ¨å˜é‡ï¼Œä¸å…¨å±€å˜é‡æ— å…³</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å‡½æ•°å†…å±€éƒ¨å˜é‡ï¼š<span class="subst">&#123;global_count&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">wrong_modify()  <span class="comment"># è¾“å‡ºï¼šå‡½æ•°å†…å±€éƒ¨å˜é‡ï¼š100</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;å…¨å±€å˜é‡æœªå˜ï¼š<span class="subst">&#123;global_count&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šå…¨å±€å˜é‡æœªå˜ï¼š10</span></span><br></pre></td></tr></table></figure>
<h4 id="2-nonlocal-å…³é”®å­—">&lt;2&gt;nonlocal å…³é”®å­—</h4>
<ul>
<li><strong>ä½œç”¨</strong>ï¼š
<ul>
<li>å£°æ˜å˜é‡æ˜¯ã€ŒåµŒå¥—ä½œç”¨åŸŸã€çš„å˜é‡ï¼ˆå¤–éƒ¨å‡½æ•°çš„å˜é‡ï¼‰ï¼Œå…è®¸<strong>åœ¨å†…éƒ¨å‡½æ•°ä¸­ä¿®æ”¹å¤–éƒ¨å‡½æ•°çš„å˜é‡</strong></li>
</ul>
</li>
<li><strong>æ ¸å¿ƒè§„åˆ™</strong>ï¼š
<ul>
<li>nonlocal ä»…é€‚ç”¨äºåµŒå¥—ç»“æ„ï¼Œ<strong>ä¸èƒ½ç”¨äºä¿®æ”¹å…¨å±€å˜é‡</strong></li>
<li>å£°æ˜çš„å˜é‡<strong>å¿…é¡»åœ¨å¤–éƒ¨å‡½æ•°ä¸­å·²å®šä¹‰</strong>ï¼Œä¸èƒ½æ˜¯æœªå®šä¹‰çš„æ–°å˜é‡</li>
<li>å¤šå±‚åµŒå¥— nonlocalé€å±‚å‘ä¸ŠæŸ¥æ‰¾å˜é‡</li>
<li>å¯åŒæ—¶å£°æ˜å¤šä¸ªåµŒå¥—å˜é‡ï¼Œç”¨é€—å·åˆ†éš”ï¼ˆå¦‚ nonlocal x, yï¼‰</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¤ºä¾‹1ï¼šä»…è¯»å–å¤–éƒ¨å‡½æ•°å˜é‡ï¼ˆæ— éœ€nonlocalå£°æ˜ï¼‰</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">outer_func_read</span>():</span><br><span class="line">    <span class="comment"># å¤–éƒ¨å‡½æ•°å˜é‡ï¼ˆåµŒå¥—ä½œç”¨åŸŸï¼‰</span></span><br><span class="line">    outer_var = <span class="string">&quot;å¤–éƒ¨å‡½æ•°çš„å˜é‡&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner_func_read</span>():</span><br><span class="line">        <span class="comment"># ä»…è¯»å–å¤–éƒ¨å˜é‡ï¼Œä¸ä¿®æ”¹ï¼Œæ— éœ€å£°æ˜nonlocal</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;å†…éƒ¨å‡½æ•°ä»…è¯»å–å¤–éƒ¨å˜é‡ï¼š<span class="subst">&#123;outer_var&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    inner_func_read()  <span class="comment"># è°ƒç”¨å†…éƒ¨å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">outer_func_read()  <span class="comment"># è¾“å‡ºï¼šå†…éƒ¨å‡½æ•°ä»…è¯»å–å¤–éƒ¨å˜é‡ï¼šå¤–éƒ¨å‡½æ•°çš„å˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹2ï¼šä¿®æ”¹å¤–éƒ¨å‡½æ•°å˜é‡ï¼ˆå¿…é¡»ç”¨nonlocalå£°æ˜ï¼‰</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">outer_func</span>():</span><br><span class="line">    <span class="comment"># å¤–éƒ¨å‡½æ•°å˜é‡ï¼ˆåµŒå¥—ä½œç”¨åŸŸï¼‰</span></span><br><span class="line">    outer_num = <span class="number">10</span></span><br><span class="line">    outer_str = <span class="string">&quot;å¤–éƒ¨é»˜è®¤å­—ç¬¦ä¸²&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner_func</span>():</span><br><span class="line">        <span class="comment"># å£°æ˜è¦ä¿®æ”¹çš„æ˜¯åµŒå¥—ä½œç”¨åŸŸå˜é‡</span></span><br><span class="line">        <span class="keyword">nonlocal</span> outer_num, outer_str</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ä¿®æ”¹åµŒå¥—ä½œç”¨åŸŸå˜é‡</span></span><br><span class="line">        outer_num *= <span class="number">2</span></span><br><span class="line">        outer_str = <span class="string">&quot;ä¿®æ”¹åçš„åµŒå¥—å­—ç¬¦ä¸²&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;å†…éƒ¨å‡½æ•°è®¿é—®ï¼šnum=<span class="subst">&#123;outer_num&#125;</span>, str=<span class="subst">&#123;outer_str&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    inner_func()  <span class="comment"># è°ƒç”¨å†…éƒ¨å‡½æ•°</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å¤–éƒ¨å‡½æ•°éªŒè¯ï¼šnum=<span class="subst">&#123;outer_num&#125;</span>, str=<span class="subst">&#123;outer_str&#125;</span>&quot;</span>)  <span class="comment"># å˜é‡å·²è¢«å†…éƒ¨å‡½æ•°ä¿®æ”¹</span></span><br><span class="line"></span><br><span class="line">outer_func()</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment"># å†…éƒ¨å‡½æ•°è®¿é—®ï¼šnum=20, str=ä¿®æ”¹åçš„åµŒå¥—å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment"># å¤–éƒ¨å‡½æ•°éªŒè¯ï¼šnum=20, str=ä¿®æ”¹åçš„åµŒå¥—å­—ç¬¦ä¸²</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åé¢æ¡ˆä¾‹ï¼šnonlocalä¿®é¥°æœªå®šä¹‰çš„å˜é‡</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">wrong_outer</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrong_inner</span>():</span><br><span class="line">        <span class="keyword">nonlocal</span> undefined_var  <span class="comment"># è¯­æ³•é”™è¯¯ï¼šnonlocalå£°æ˜çš„å˜é‡å¿…é¡»åœ¨å¤–å±‚å‡½æ•°ä½œç”¨åŸŸä¸­å­˜åœ¨</span></span><br><span class="line">        undefined_var = <span class="number">5</span></span><br><span class="line">    wrong_inner()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šè¿™æ®µä»£ç åœ¨**å®šä¹‰é˜¶æ®µ**å°±ä¼šè§¦å‘ SyntaxErrorï¼ˆè¯­æ³•é”™è¯¯ï¼‰ï¼Œè€Œéè¿è¡Œæ—¶é”™è¯¯</span></span><br><span class="line"><span class="comment"># wrong_outer()  # å®é™…æ‰§è¡Œå‰å°±ä¼šæŠ¥é”™ï¼šSyntaxError: no binding for nonlocal &#x27;undefined_var&#x27; found</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹3ï¼šå¤šå±‚åµŒå¥—åœºæ™¯ï¼ˆnonlocalé€å±‚å‘ä¸ŠæŸ¥æ‰¾å˜é‡ï¼‰</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">outer_layer1</span>():</span><br><span class="line">    var = <span class="string">&quot;æœ€å¤–å±‚å˜é‡&quot;</span>  <span class="comment"># å±‚çº§1ï¼šæœ€å¤–å±‚å¤–éƒ¨å‡½æ•°å˜é‡</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">outer_layer2</span>():  <span class="comment"># å±‚çº§2ï¼šä¸­é—´åµŒå¥—å‡½æ•°</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">inner_layer</span>():  <span class="comment"># å±‚çº§3ï¼šæœ€å†…å±‚å†…éƒ¨å‡½æ•°</span></span><br><span class="line">            <span class="keyword">nonlocal</span> var  <span class="comment"># æŸ¥æ‰¾è§„åˆ™ï¼šä»å¤–å±‚2å¼€å§‹å‘ä¸Šæ‰¾ï¼Œæœ€ç»ˆæ‰¾åˆ°outer_layer1çš„var</span></span><br><span class="line">            var = <span class="string">&quot;è¢«æœ€å†…å±‚å‡½æ•°ä¿®æ”¹&quot;</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;æœ€å†…å±‚å‡½æ•°ä¿®æ”¹åï¼š<span class="subst">&#123;var&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        inner_layer()  <span class="comment"># è°ƒç”¨æœ€å†…å±‚å‡½æ•°</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;ä¸­é—´å±‚å‡½æ•°è®¿é—®ï¼š<span class="subst">&#123;var&#125;</span>&quot;</span>)  <span class="comment"># èƒ½è®¿é—®åˆ°è¢«ä¿®æ”¹åçš„var</span></span><br><span class="line">    </span><br><span class="line">    outer_layer2()  <span class="comment"># è°ƒç”¨ä¸­é—´å±‚å‡½æ•°</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æœ€å¤–å±‚å‡½æ•°éªŒè¯ï¼š<span class="subst">&#123;var&#125;</span>&quot;</span>)  <span class="comment"># æœ€ç»ˆå˜é‡è¢«ä¿®æ”¹</span></span><br><span class="line"></span><br><span class="line">outer_layer1()</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment"># æœ€å†…å±‚å‡½æ•°ä¿®æ”¹åï¼šè¢«æœ€å†…å±‚å‡½æ•°ä¿®æ”¹</span></span><br><span class="line"><span class="comment"># ä¸­é—´å±‚å‡½æ•°è®¿é—®ï¼šè¢«æœ€å†…å±‚å‡½æ•°ä¿®æ”¹</span></span><br><span class="line"><span class="comment"># æœ€å¤–å±‚å‡½æ•°éªŒè¯ï¼šè¢«æœ€å†…å±‚å‡½æ•°ä¿®æ”¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹4ï¼šå¤šå±‚åµŒå¥—ä¸­å­˜åœ¨åŒåå˜é‡ï¼ˆnonlocalä¼˜å…ˆæ‰¾æœ€è¿‘çš„å¤–å±‚å˜é‡ï¼‰</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">outer1</span>():</span><br><span class="line">    var = <span class="string">&quot;outer1çš„å˜é‡&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">outer2</span>():</span><br><span class="line">        var = <span class="string">&quot;outer2çš„å˜é‡&quot;</span>  <span class="comment"># ä¸å¤–å±‚åŒåçš„ä¸­é—´å±‚å˜é‡</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">inner</span>():</span><br><span class="line">            <span class="keyword">nonlocal</span> var  <span class="comment"># ä¼˜å…ˆæ‰¾æœ€è¿‘çš„å¤–å±‚ï¼ˆouter2ï¼‰çš„varï¼Œè€Œéouter1çš„var</span></span><br><span class="line">            var = <span class="string">&quot;ä¿®æ”¹outer2çš„å˜é‡&quot;</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;å†…å±‚å‡½æ•°ï¼š<span class="subst">&#123;var&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        inner()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;outer2å‡½æ•°ï¼š<span class="subst">&#123;var&#125;</span>&quot;</span>)  <span class="comment"># è¢«ä¿®æ”¹çš„æ˜¯outer2çš„var</span></span><br><span class="line">    </span><br><span class="line">    outer2()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;outer1å‡½æ•°ï¼š<span class="subst">&#123;var&#125;</span>&quot;</span>)  <span class="comment"># outer1çš„varæœªè¢«ä¿®æ”¹</span></span><br><span class="line"></span><br><span class="line">outer1()</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment"># å†…å±‚å‡½æ•°ï¼šä¿®æ”¹outer2çš„å˜é‡</span></span><br><span class="line"><span class="comment"># outer2å‡½æ•°ï¼šä¿®æ”¹outer2çš„å˜é‡</span></span><br><span class="line"><span class="comment"># outer1å‡½æ•°ï¼šouter1çš„å˜é‡</span></span><br></pre></td></tr></table></figure>
<h4 id="3-global-ä¸-nonlocal-æ ¸å¿ƒå·®å¼‚å¯¹æ¯”">&lt;3&gt;global ä¸ nonlocal æ ¸å¿ƒå·®å¼‚å¯¹æ¯”</h4>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260110210400109.png" alt=""></p>
<h2 id="5-å†…éƒ¨å‡½æ•°ï¼ˆåµŒå¥—å‡½æ•°ï¼‰">5.å†…éƒ¨å‡½æ•°ï¼ˆåµŒå¥—å‡½æ•°ï¼‰</h2>
<p>å†…éƒ¨å‡½æ•°æŒ‡ã€Œåœ¨å¦ä¸€ä¸ªå‡½æ•°ï¼ˆå¤–éƒ¨å‡½æ•°ï¼‰å†…éƒ¨å®šä¹‰çš„å‡½æ•°ã€ï¼Œä¹Ÿå«åµŒå¥—å‡½æ•°ã€‚å®ƒæ˜¯å®ç°é—­åŒ…ã€è£…é¥°å™¨ç­‰è¿›é˜¶ç‰¹æ€§çš„åŸºç¡€ï¼Œæ ¸å¿ƒä»·å€¼æ˜¯<strong>å°è£…å†…éƒ¨é€»è¾‘ã€éš”ç¦»ä½œç”¨åŸŸ</strong>ã€‚</p>
<h3 id="æ ¸å¿ƒå®šä¹‰ä¸ç‰¹å¾">æ ¸å¿ƒå®šä¹‰ä¸ç‰¹å¾</h3>
<ul>
<li><strong>å®šä¹‰ä½ç½®</strong>ï¼šå¿…é¡»åœ¨å¤–éƒ¨å‡½æ•°çš„å‡½æ•°ä½“å†…éƒ¨</li>
<li><strong>ä½œç”¨åŸŸéš”ç¦»</strong>ï¼šå†…éƒ¨å‡½æ•°é»˜è®¤åªèƒ½åœ¨å¤–éƒ¨å‡½æ•°å†…éƒ¨è¢«è°ƒç”¨ï¼Œå¤–éƒ¨æ— æ³•ç›´æ¥è®¿é—®</li>
<li><strong>å˜é‡è®¿é—®</strong>ï¼šå†…éƒ¨å‡½æ•°å¯ç›´æ¥è®¿é—®å¤–éƒ¨å‡½æ•°çš„å˜é‡ï¼ˆåµŒå¥—ä½œç”¨åŸŸå˜é‡ï¼‰ï¼Œè‹¥éœ€ä¿®æ”¹éœ€ç”¨ nonlocal å£°æ˜</li>
<li><strong>ç‹¬ç«‹æ€§</strong>ï¼š<strong>å†…éƒ¨å‡½æ•°å¯ä½œä¸ºå¤–éƒ¨å‡½æ•°çš„è¿”å›å€¼ä¼ å‡ºï¼Œæˆ–ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–å‡½æ•°</strong>ï¼ˆä¾æ‰˜å‡½æ•°æ˜¯ä¸€ç­‰å¯¹è±¡çš„ç‰¹æ€§ï¼‰ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¤ºä¾‹1ï¼šä½œç”¨åŸŸéš”ç¦»ï¼ˆå†…éƒ¨å‡½æ•°å˜é‡å¤–éƒ¨ä¸å¯è®¿é—®ï¼‰</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">outer1</span>():</span><br><span class="line">    inner_var = <span class="string">&quot;å†…éƒ¨å‡½æ•°å˜é‡&quot;</span>  <span class="comment"># å†…éƒ¨å‡½æ•°å±€éƒ¨å˜é‡</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner1</span>():</span><br><span class="line">        <span class="built_in">print</span>(inner_var)  <span class="comment"># å†…éƒ¨å¯è®¿é—®è‡ªèº«å˜é‡</span></span><br><span class="line">    </span><br><span class="line">    inner1()</span><br><span class="line"></span><br><span class="line">outer1()</span><br><span class="line"><span class="comment"># print(inner_var)  # æŠ¥é”™ï¼šname &#x27;inner_var&#x27; is not definedï¼ˆå¤–éƒ¨æ— æ³•è®¿é—®ï¼Œä½“ç°éš”ç¦»ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹2ï¼šå˜é‡è®¿é—®ä¸ä¿®æ”¹ï¼ˆå†…éƒ¨å‡½æ•°è®¿é—®/ä¿®æ”¹å¤–å±‚å˜é‡ï¼‰</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">outer2</span>():</span><br><span class="line">    outer_var = <span class="string">&quot;å¤–å±‚å˜é‡&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å­ç¤ºä¾‹2-1ï¼šä»…è®¿é—®å¤–å±‚å˜é‡ï¼ˆæ— éœ€nonlocalï¼‰</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner2_read</span>():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;ä»…è®¿é—®å¤–å±‚å˜é‡ï¼š<span class="subst">&#123;outer_var&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å­ç¤ºä¾‹2-2ï¼šæœªç”¨nonlocalä¿®æ”¹ï¼ˆå®é™…åˆ›å»ºå±€éƒ¨å˜é‡ï¼Œä¿®æ”¹å¤±è´¥ï¼‰</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner2_wrong_modify</span>():</span><br><span class="line">        outer_var = <span class="string">&quot;å†…éƒ¨åˆ›å»ºçš„å±€éƒ¨å˜é‡&quot;</span>  <span class="comment"># ä¸å¤–å±‚å˜é‡åŒåï¼Œä¸å½±å“å¤–å±‚</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æœªç”¨nonlocalä¿®æ”¹åï¼ˆå±€éƒ¨å˜é‡ï¼‰ï¼š<span class="subst">&#123;outer_var&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å­ç¤ºä¾‹2-3ï¼šç”¨nonlocalä¿®æ”¹ï¼ˆæˆåŠŸä¿®æ”¹å¤–å±‚å˜é‡ï¼‰</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner2_correct_modify</span>():</span><br><span class="line">        <span class="keyword">nonlocal</span> outer_var  <span class="comment"># å£°æ˜å˜é‡æ¥è‡ªåµŒå¥—ä½œç”¨åŸŸ</span></span><br><span class="line">        outer_var = <span class="string">&quot;ä¿®æ”¹åçš„å¤–å±‚å˜é‡&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;ä½¿ç”¨nonlocalä¿®æ”¹åï¼ˆå¤–å±‚å˜é‡ï¼‰ï¼š<span class="subst">&#123;outer_var&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    inner2_read()</span><br><span class="line">    inner2_wrong_modify()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æœªç”¨nonlocalåï¼Œå¤–å±‚å˜é‡ä»ä¸ºï¼š<span class="subst">&#123;outer_var&#125;</span>&quot;</span>)</span><br><span class="line">    inner2_correct_modify()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ä½¿ç”¨nonlocalåï¼Œå¤–å±‚å˜é‡å˜ä¸ºï¼š<span class="subst">&#123;outer_var&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">outer2()</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment"># ä»…è®¿é—®å¤–å±‚å˜é‡ï¼šå¤–å±‚å˜é‡</span></span><br><span class="line"><span class="comment"># æœªç”¨nonlocalä¿®æ”¹åï¼ˆå±€éƒ¨å˜é‡ï¼‰ï¼šå†…éƒ¨åˆ›å»ºçš„å±€éƒ¨å˜é‡</span></span><br><span class="line"><span class="comment"># æœªç”¨nonlocalåï¼Œå¤–å±‚å˜é‡ä»ä¸ºï¼šå¤–å±‚å˜é‡</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨nonlocalä¿®æ”¹åï¼ˆå¤–å±‚å˜é‡ï¼‰ï¼šä¿®æ”¹åçš„å¤–å±‚å˜é‡</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨nonlocalåï¼Œå¤–å±‚å˜é‡å˜ä¸ºï¼šä¿®æ”¹åçš„å¤–å±‚å˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹3ï¼šç‹¬ç«‹æ€§ï¼ˆå†…éƒ¨å‡½æ•°å¯ä½œä¸ºè¿”å›å€¼ç‹¬ç«‹ä¼ é€’ï¼‰</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">outer3</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner3</span>():</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;å†…éƒ¨å‡½æ•°æ‰§è¡Œç»“æœ&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> inner3  <span class="comment"># è¿”å›å†…éƒ¨å‡½æ•°å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç‹¬ç«‹è°ƒç”¨è¿”å›çš„å†…éƒ¨å‡½æ•°ï¼ˆä¸åŸå¤–éƒ¨å‡½æ•°è„±ç¦»ä»å¯æ‰§è¡Œï¼‰</span></span><br><span class="line">inner_obj = outer3()</span><br><span class="line"><span class="built_in">print</span>(inner_obj())  <span class="comment"># è¾“å‡ºï¼šå†…éƒ¨å‡½æ•°æ‰§è¡Œç»“æœ</span></span><br></pre></td></tr></table></figure>
<h2 id="6-è§£åŒ…ï¼ˆåºåˆ—è§£åŒ…ï¼‰">6.* è§£åŒ…ï¼ˆåºåˆ—è§£åŒ…ï¼‰</h2>
<ul>
<li><strong>åœ¨å‡½æ•°å‚æ•°ç›¸å…³æ“ä½œä¸­ï¼Œ* é™¤äº†ç”¨äºå®šä¹‰å¯å˜é•¿åº¦å‚æ•°ï¼ˆ*argsï¼‰ï¼Œè¿˜å¸¸ç”¨äºã€Œåºåˆ—è§£åŒ…ã€</strong>
<ul>
<li>å°†<strong>å¯è¿­ä»£å¯¹è±¡</strong>ï¼ˆåˆ—è¡¨ã€å…ƒç»„ã€å­—ç¬¦ä¸²ç­‰ï¼‰çš„<strong>å…ƒç´ é€ä¸ªæ‹†è§£</strong>ï¼Œä½œä¸º<strong>ç‹¬ç«‹å‚æ•°</strong>ä¼ å…¥å‡½æ•°</li>
<li>è¿™æ˜¯ Python ä¸­ç®€åŒ–å‚æ•°ä¼ é€’çš„å®ç”¨æŠ€å·§ï¼Œä¸<strong>å¯å˜é•¿åº¦å‚æ•°</strong>ç›¸è¾…ç›¸æˆ</li>
</ul>
</li>
</ul>
<h3 id="ï¼ˆ1ï¼‰æ ¸å¿ƒä½œç”¨">ï¼ˆ1ï¼‰æ ¸å¿ƒä½œç”¨</h3>
<ul>
<li>å°†<strong>å¯è¿­ä»£å¯¹è±¡</strong>â€œæ‰“æ•£â€ä¸º<strong>å•ä¸ªå…ƒç´ </strong>ï¼Œé¿å…æ‰‹åŠ¨é€ä¸ªæå–å…ƒç´ ä¼ å‚</li>
<li>å¯ä¸æ™®é€šå‚æ•°ã€å…³é”®å­—å‚æ•°æ··åˆä½¿ç”¨ï¼Œçµæ´»é€‚é…ä¸åŒå‡½æ•°çš„å‚æ•°è¦æ±‚<br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260110162021473.png" alt=""></li>
</ul>
<h3 id="ï¼ˆ2ï¼‰é€‚ç”¨åœºæ™¯ä¸ç¤ºä¾‹">ï¼ˆ2ï¼‰é€‚ç”¨åœºæ™¯ä¸ç¤ºä¾‹</h3>
<h4 id="åœºæ™¯1ï¼šè§£åŒ…åˆ—è¡¨-å…ƒç»„ä¼ å…¥æ™®é€šå‡½æ•°ï¼ˆéœ€åŒ¹é…å‚æ•°æ•°é‡ï¼‰">åœºæ™¯1ï¼šè§£åŒ…åˆ—è¡¨/å…ƒç»„ä¼ å…¥æ™®é€šå‡½æ•°ï¼ˆéœ€åŒ¹é…å‚æ•°æ•°é‡ï¼‰</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ™®é€šå‡½æ•°ï¼ˆ2ä¸ªä½ç½®å‚æ•°ï¼‰</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—è¡¨è§£åŒ…</span></span><br><span class="line">nums_list = [<span class="number">3</span>, <span class="number">5</span>]</span><br><span class="line"><span class="built_in">print</span>(add(*nums_list))  <span class="comment"># ç­‰ä»·äº add(3, 5)ï¼Œè¾“å‡ºï¼š8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…ƒç»„è§£åŒ…</span></span><br><span class="line">nums_tuple = (<span class="number">4</span>, <span class="number">6</span>)</span><br><span class="line"><span class="built_in">print</span>(add(*nums_tuple))  <span class="comment"># ç­‰ä»·äº add(4, 6)ï¼Œè¾“å‡ºï¼š10</span></span><br></pre></td></tr></table></figure>
<h4 id="åœºæ™¯2ï¼šè§£åŒ…åºåˆ—ä¼ å…¥-argsï¼ˆè¡¥å……å¯å˜é•¿åº¦å‚æ•°ï¼‰">åœºæ™¯2ï¼šè§£åŒ…åºåˆ—ä¼ å…¥*argsï¼ˆè¡¥å……å¯å˜é•¿åº¦å‚æ•°ï¼‰</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¯å˜é•¿åº¦å‚æ•°å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sum_all</span>(<span class="params">*args</span>):</span><br><span class="line">    total = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> args:</span><br><span class="line">        total += num</span><br><span class="line">    <span class="keyword">return</span> total</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹1ï¼šè§£åŒ…åˆ—è¡¨è¡¥å……å‚æ•°</span></span><br><span class="line">base_nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="built_in">print</span>(sum_all(*base_nums, <span class="number">4</span>, <span class="number">5</span>))  <span class="comment"># ç­‰ä»·äº sum_all(1,2,3,4,5)ï¼Œè¾“å‡ºï¼š15</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹2ï¼šè§£åŒ…å­—ç¬¦ä¸²ï¼ˆå­—ç¬¦ä¸²æ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Œæ‹†è§£ä¸ºå•ä¸ªå­—ç¬¦ï¼‰</span></span><br><span class="line">str_chars = <span class="string">&quot;123&quot;</span></span><br><span class="line"><span class="built_in">print</span>(sum_all(*str_chars))  <span class="comment"># ç­‰ä»·äº sum_all(&#x27;1&#x27;,&#x27;2&#x27;,&#x27;3&#x27;)ï¼Ÿæ³¨æ„ï¼šæ­¤å¤„ä¼šæŠ¥é”™ï¼Œéœ€ç¡®ä¿å…ƒç´ ç±»å‹åŒ¹é…</span></span><br><span class="line"><span class="comment"># æ­£ç¡®ç”¨æ³•ï¼šå…ˆè½¬æ¢å…ƒç´ ç±»å‹</span></span><br><span class="line">str_nums = <span class="string">&quot;123&quot;</span></span><br><span class="line"><span class="built_in">print</span>(sum_all(*<span class="built_in">map</span>(<span class="built_in">int</span>, str_nums)))  <span class="comment"># ç­‰ä»·äº sum_all(1,2,3)ï¼Œè¾“å‡ºï¼š6</span></span><br></pre></td></tr></table></figure>
<h4 id="åœºæ™¯3ï¼šä¸å…³é”®å­—å‚æ•°æ··åˆä½¿ç”¨ï¼ˆè§£åŒ…éœ€åœ¨å…³é”®å­—å‚æ•°å‰ï¼‰">åœºæ™¯3ï¼šä¸å…³é”®å­—å‚æ•°æ··åˆä½¿ç”¨ï¼ˆè§£åŒ…éœ€åœ¨å…³é”®å­—å‚æ•°å‰ï¼‰</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">print_info</span>(<span class="params">name, age, city</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å§“åï¼š<span class="subst">&#123;name&#125;</span>ï¼Œå¹´é¾„ï¼š<span class="subst">&#123;age&#125;</span>ï¼ŒåŸå¸‚ï¼š<span class="subst">&#123;city&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£åŒ…åˆ—è¡¨ä¼ å…¥å‰ä¸¤ä¸ªä½ç½®å‚æ•°ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ç”¨å…³é”®å­—ä¼ </span></span><br><span class="line">info_list = [<span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="number">25</span>]</span><br><span class="line">print_info(*info_list, city=<span class="string">&quot;åŒ—äº¬&quot;</span>)  <span class="comment"># ç­‰ä»·äº print_info(&quot;å¼ ä¸‰&quot;,25,city=&quot;åŒ—äº¬&quot;)ï¼Œè¾“å‡ºæ­£å¸¸</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é”™è¯¯ç”¨æ³•ï¼šè§£åŒ…ä¸èƒ½åœ¨å…³é”®å­—å‚æ•°å</span></span><br><span class="line"><span class="comment"># print_info(name=&quot;æå››&quot;, *[30, &quot;ä¸Šæµ·&quot;])  # æŠ¥é”™ï¼špositional argument follows keyword argument</span></span><br></pre></td></tr></table></figure>
<p><strong>ä½ç½®å‚æ•° â†’ é»˜è®¤å‚æ•° â†’ *args â†’ ä»…é™å…³é”®å­—å‚æ•° â†’ **kwargs</strong></p>
<h2 id="7-è§£åŒ…ï¼ˆå­—å…¸è§£åŒ…ï¼‰">7.** è§£åŒ…ï¼ˆå­—å…¸è§£åŒ…ï¼‰</h2>
<p><strong>ä¸ * è§£åŒ…åºåˆ—å¯¹åº”ï¼Œ** ä¸“é—¨ç”¨äºã€Œå­—å…¸è§£åŒ…ã€</strong></p>
<ul>
<li>å°†å­—å…¸çš„é”®å€¼å¯¹æ‹†è§£ä¸ºâ€œ<strong>å‚æ•°å=å‚æ•°å€¼</strong>â€çš„å…³é”®å­—å‚æ•°å½¢å¼ä¼ å…¥å‡½æ•°æˆ–â€œåˆå¹¶å¤šä¸ªå­—å…¸â€</li>
<li>è¿™ä¸€æŠ€å·§å¸¸ç”¨äºçµæ´»<strong>ä¼ é€’å¤šä¸ªå…³é”®å­—å‚æ•°</strong>ï¼Œå°¤å…¶é€‚åˆå‚æ•°æ•°é‡ä¸ç¡®å®šæˆ–éœ€è¦æ‰¹é‡ä¼ å…¥é…ç½®ä¿¡æ¯çš„åœºæ™¯ã€‚</li>
<li><strong>æ³¨</strong>ï¼š<strong>ä»…å­—å…¸å¯ä½¿ç”¨ ** è§£åŒ…</strong></li>
</ul>
<h3 id="ï¼ˆ1ï¼‰æ ¸å¿ƒä½œç”¨-2">ï¼ˆ1ï¼‰æ ¸å¿ƒä½œç”¨</h3>
<ul>
<li>å°†å­—å…¸â€œæ‰“æ•£â€ä¸ºå¤šä¸ªå…³é”®å­—å‚æ•°ï¼Œé¿å…æ‰‹åŠ¨é€ä¸ªå†™ å‚æ•°å=å€¼ï¼Œç®€åŒ–å¤šå…³é”®å­—å‚æ•°çš„ä¼ é€’</li>
<li>å¯ä¸æ™®é€šä½ç½®å‚æ•°ã€å…³é”®å­—å‚æ•°æ··åˆä½¿ç”¨ï¼Œç²¾å‡†åŒ¹é…å‡½æ•°çš„å‚æ•°è¦æ±‚</li>
<li>ä¸ **kwargs ï¼ˆæ¥æ”¶å¯å˜å…³é”®å­—å‚æ•°ï¼‰ç›¸è¾…ç›¸æˆï¼Œå®ç°â€œæ‰¹é‡ä¼ å‚+åŠ¨æ€æ¥æ”¶â€çš„ç»„åˆã€‚<br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260110201433413.png" alt=""></li>
</ul>
<h3 id="ï¼ˆ2ï¼‰é€‚ç”¨åœºæ™¯ä¸ç¤ºä¾‹-2">ï¼ˆ2ï¼‰é€‚ç”¨åœºæ™¯ä¸ç¤ºä¾‹</h3>
<h4 id="åœºæ™¯1ï¼šè§£åŒ…å­—å…¸ä¼ å…¥æ™®é€šå‡½æ•°ï¼ˆéœ€å­—å…¸é”®ä¸å‡½æ•°å‚æ•°åå®Œå…¨åŒ¹é…ï¼‰">åœºæ™¯1ï¼šè§£åŒ…å­—å…¸ä¼ å…¥æ™®é€šå‡½æ•°ï¼ˆéœ€å­—å…¸é”®ä¸å‡½æ•°å‚æ•°åå®Œå…¨åŒ¹é…ï¼‰</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ™®é€šå‡½æ•°ï¼ˆ3ä¸ªä½ç½®/å…³é”®å­—å‚æ•°ï¼‰</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_info</span>(<span class="params">name, age, city</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å§“åï¼š<span class="subst">&#123;name&#125;</span>ï¼Œå¹´é¾„ï¼š<span class="subst">&#123;age&#125;</span>ï¼ŒåŸå¸‚ï¼š<span class="subst">&#123;city&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å­—å…¸è§£åŒ…ï¼ˆé”®å¿…é¡»ä¸å‚æ•°åä¸€è‡´ï¼‰</span></span><br><span class="line">info_dict = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">25</span>, <span class="string">&quot;city&quot;</span>: <span class="string">&quot;åŒ—äº¬&quot;</span>&#125;</span><br><span class="line">print_info(**info_dict)  <span class="comment"># ç­‰ä»·äº print_info(name=&quot;å¼ ä¸‰&quot;, age=25, city=&quot;åŒ—äº¬&quot;)ï¼Œè¾“å‡ºæ­£å¸¸</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é”™è¯¯ç”¨æ³•ï¼šå­—å…¸é”®ä¸å‚æ•°åä¸åŒ¹é…</span></span><br><span class="line">wrong_dict = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;æå››&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">30</span>, <span class="string">&quot;address&quot;</span>: <span class="string">&quot;ä¸Šæµ·&quot;</span>&#125;</span><br><span class="line"><span class="comment"># print_info(**wrong_dict)  # æŠ¥é”™ï¼šgot an unexpected keyword argument &#x27;address&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="åœºæ™¯2ï¼šè§£åŒ…å­—å…¸ä¼ å…¥-kwargsï¼ˆè¡¥å……å¯å˜å…³é”®å­—å‚æ•°ï¼‰">åœºæ™¯2ï¼šè§£åŒ…å­—å…¸ä¼ å…¥**kwargsï¼ˆè¡¥å……å¯å˜å…³é”®å­—å‚æ•°ï¼‰</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¯å˜å…³é”®å­—å‚æ•°å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_details</span>(<span class="params">**kwargs</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> kwargs.items():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;k&#125;</span>ï¼š<span class="subst">&#123;v&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£åŒ…å­—å…¸è¡¥å……å‚æ•°</span></span><br><span class="line">base_info = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;ç‹äº”&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">28</span>&#125;</span><br><span class="line">print_details(**base_info, city=<span class="string">&quot;å¹¿å·&quot;</span>, gender=<span class="string">&quot;ç”·&quot;</span>)  <span class="comment"># ç­‰ä»·äº print_details(name=&quot;ç‹äº”&quot;, age=28, city=&quot;å¹¿å·&quot;, gender=&quot;ç”·&quot;)</span></span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment"># nameï¼šç‹äº”</span></span><br><span class="line"><span class="comment"># ageï¼š28</span></span><br><span class="line"><span class="comment"># cityï¼šå¹¿å·</span></span><br><span class="line"><span class="comment"># genderï¼šç”·</span></span><br></pre></td></tr></table></figure>
<h4 id="åœºæ™¯3ï¼šæ··åˆ-è§£åŒ…ä¸-è§£åŒ…ï¼ˆåºåˆ—-å­—å…¸è”åˆä¼ å‚ï¼‰">åœºæ™¯3ï¼šæ··åˆ*è§£åŒ…ä¸**è§£åŒ…ï¼ˆåºåˆ—+å­—å…¸è”åˆä¼ å‚ï¼‰</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ··åˆå‚æ•°çš„å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">a, b, c, d</span>):</span><br><span class="line">    <span class="built_in">print</span>(a + b + c + d)</span><br><span class="line"></span><br><span class="line"><span class="comment"># *è§£åŒ…åˆ—è¡¨ï¼ˆä½ç½®å‚æ•°ï¼‰ + **è§£åŒ…å­—å…¸ï¼ˆå…³é”®å­—å‚æ•°ï¼‰</span></span><br><span class="line">list_data = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">dict_data = &#123;<span class="string">&quot;c&quot;</span>: <span class="number">3</span>, <span class="string">&quot;d&quot;</span>: <span class="number">4</span>&#125;</span><br><span class="line">func(*list_data, **dict_data)  <span class="comment"># ç­‰ä»·äº func(1, 2, c=3, d=4)ï¼Œè¾“å‡ºï¼š10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨æ„é¡ºåºï¼š*è§£åŒ…ï¼ˆä½ç½®å‚æ•°ï¼‰å¿…é¡»åœ¨**è§£åŒ…ï¼ˆå…³é”®å­—å‚æ•°ï¼‰ä¹‹å‰</span></span><br><span class="line"><span class="comment"># func(**dict_data, *list_data)  # æŠ¥é”™ï¼špositional argument follows keyword argument</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰æ³¨æ„äº‹é¡¹">ï¼ˆ3ï¼‰æ³¨æ„äº‹é¡¹</h3>
<ul>
<li>
<p><strong>å­—å…¸çš„é”®å¿…é¡»æ˜¯ã€Œå­—ç¬¦ä¸²ç±»å‹ã€</strong>ï¼Œä¸”<strong>ä¸å‡½æ•°çš„å‚æ•°åå®Œå…¨ä¸€è‡´</strong>ï¼Œå¦åˆ™ä¼šæŠ¥â€œæ„å¤–çš„å…³é”®å­—å‚æ•°â€é”™è¯¯</p>
</li>
<li>
<p>å•ä¸ªå‡½æ•°è°ƒç”¨ä¸­å¯å¤šæ¬¡è§£åŒ…å­—å…¸ï¼Œä½†éœ€ç¡®ä¿ä¸é‡å¤ä¼ é€’åŒåå‚æ•°ï¼ˆå¦åˆ™æŠ¥é”™ duplicate keyword argumentï¼‰ï¼›</p>
</li>
<li>
<p><strong>** ä»…ç”¨äºè§£åŒ…ã€Œå­—å…¸ç±»å‹ã€</strong>ï¼šdictã€OrderedDict ç­‰ï¼‰</p>
<ul>
<li>ä¸èƒ½ç”¨äºåˆ—è¡¨ã€å…ƒç»„ç­‰åºåˆ—ï¼ˆä¼šæŠ¥é”™ TypeError: <strong>dict</strong> must be a mappingï¼‰ï¼›</li>
</ul>
</li>
<li>
<p><strong>** è§£åŒ…åªèƒ½ç”¨äºå‡½æ•°å‚æ•°ä¼ é€’åœºæ™¯ï¼Œä¸èƒ½å•ç‹¬ç”¨äºèµ‹å€¼</strong></p>
<ul>
<li>å¦‚ a, b, c = **dict_data æ˜¯é”™è¯¯çš„ï¼‰ï¼›</li>
</ul>
</li>
<li>
<p>æ··åˆä¼ å‚æ—¶ï¼Œå¿…é¡»éµå¾ªâ€œä½ç½®å‚æ•°â†’*è§£åŒ…ï¼ˆä½ç½®å‚æ•°ï¼‰â†’å…³é”®å­—å‚æ•°â†’**è§£åŒ…ï¼ˆå…³é”®å­—å‚æ•°ï¼‰â€çš„é¡ºåºã€‚</p>
</li>
</ul>
<h2 id="8-å‡½æ•°çš„è¿›é˜¶ç‰¹æ€§">8.å‡½æ•°çš„è¿›é˜¶ç‰¹æ€§</h2>
<h3 id="ï¼ˆ1ï¼‰å‡½æ•°æ˜¯ä¸€ç­‰å¯¹è±¡ï¼ˆPython-æ ¸å¿ƒç‰¹æ€§ï¼‰">ï¼ˆ1ï¼‰å‡½æ•°æ˜¯ä¸€ç­‰å¯¹è±¡ï¼ˆPython æ ¸å¿ƒç‰¹æ€§ï¼‰</h3>
<p><strong>å‡½æ•°å¯ä»¥ä½œä¸ºï¼šå‚æ•°ã€è¿”å›å€¼ã€èµ‹å€¼ç»™å˜é‡ã€å­˜å‚¨åœ¨å®¹å™¨ä¸­ï¼ˆåˆ—è¡¨/å­—å…¸ï¼‰ï¼Œè¿™æ˜¯é«˜é˜¶å‡½æ•°çš„åŸºç¡€</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. å‡½æ•°èµ‹å€¼ç»™å˜é‡</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line">f = add  <span class="comment"># å˜é‡fæŒ‡å‘addå‡½æ•°</span></span><br><span class="line"><span class="built_in">print</span>(f(<span class="number">10</span>, <span class="number">20</span>))  <span class="comment"># 30</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. å‡½æ•°ä½œä¸ºå‚æ•°ä¼ å…¥å¦ä¸€ä¸ªå‡½æ•°ï¼ˆé«˜é˜¶å‡½æ•°ï¼‰</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate</span>(<span class="params">func, x, y</span>):</span><br><span class="line">    <span class="keyword">return</span> func(x, y)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(calculate(add, <span class="number">5</span>, <span class="number">6</span>))  <span class="comment"># 11ï¼ˆaddä½œä¸ºå‚æ•°ä¼ å…¥ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. å‡½æ•°ä½œä¸ºè¿”å›å€¼ï¼ˆé«˜é˜¶å‡½æ•°ï¼‰</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_operation</span>(<span class="params">op</span>):</span><br><span class="line">    <span class="keyword">if</span> op == <span class="string">&quot;+&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> add</span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">&quot;-&quot;</span>:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">sub</span>(<span class="params">a, b</span>):  <span class="comment"># å†…éƒ¨å‡½æ•°</span></span><br><span class="line">            <span class="keyword">return</span> a - b</span><br><span class="line">        <span class="keyword">return</span> sub</span><br><span class="line"></span><br><span class="line">f = get_operation(<span class="string">&quot;+&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(f(<span class="number">3</span>, <span class="number">2</span>))  <span class="comment"># 5</span></span><br><span class="line">f = get_operation(<span class="string">&quot;-&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(f(<span class="number">3</span>, <span class="number">2</span>))  <span class="comment"># 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. å‡½æ•°å­˜å‚¨åœ¨åˆ—è¡¨ä¸­</span></span><br><span class="line">funcs = [add, <span class="keyword">lambda</span> x,y: x*y]</span><br><span class="line"><span class="built_in">print</span>(funcs[<span class="number">0</span>](<span class="number">2</span>,<span class="number">3</span>))  <span class="comment"># 5</span></span><br><span class="line"><span class="built_in">print</span>(funcs[<span class="number">1</span>](<span class="number">2</span>,<span class="number">3</span>))  <span class="comment"># 6</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰åŒ¿åå‡½æ•°ï¼ˆlambdaï¼‰">ï¼ˆ2ï¼‰åŒ¿åå‡½æ•°ï¼ˆlambdaï¼‰</h3>
<ul>
<li><strong>å®šä¹‰</strong>ï¼š
<ul>
<li>ç”¨ <strong>lambda å…³é”®å­—</strong>åˆ›å»ºçš„æç®€å‡½æ•°ï¼Œ<strong>æ— å‡½æ•°åï¼ˆåŒ¿åï¼‰</strong>ï¼Œä»…é€‚ç”¨äºç®€å•é€»è¾‘</li>
</ul>
</li>
<li><strong>è¯­æ³•</strong>ï¼š
<ul>
<li>lambda å‚æ•°åˆ—è¡¨: è¡¨è¾¾å¼ï¼ˆè¡¨è¾¾å¼ç»“æœå°±æ˜¯è¿”å›å€¼ï¼Œæ—  returnï¼‰</li>
</ul>
</li>
<li><strong>è¿”å›å€¼</strong>ï¼š
<ul>
<li>lambda åŒ¿åå‡½æ•°<strong>ä¸€å®šæœ‰è¿”å›å€¼</strong>ï¼Œã€Œè¡¨è¾¾å¼ã€çš„è®¡ç®—ç»“æœä¼šè‡ªåŠ¨ä½œä¸ºè¿”å›å€¼</li>
</ul>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>
<ul>
<li>ä¸´æ—¶ä½¿ç”¨çš„ç®€å•å‡½æ•°ï¼ˆå¦‚é…åˆ map/filter/sortedï¼‰</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŸºç¡€ç”¨æ³•</span></span><br><span class="line">add = <span class="keyword">lambda</span> a, b: a + b</span><br><span class="line"><span class="built_in">print</span>(add(<span class="number">1</span>, <span class="number">2</span>))  <span class="comment"># 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…åˆmapä½¿ç”¨ï¼ˆæ‰¹é‡è®¡ç®—ï¼‰</span></span><br><span class="line">nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">result = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x*<span class="number">2</span>, nums))</span><br><span class="line"><span class="built_in">print</span>(result)  <span class="comment"># [2,4,6]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…åˆsortedä½¿ç”¨ï¼ˆè‡ªå®šä¹‰æ’åºï¼‰</span></span><br><span class="line">students = [(<span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="number">25</span>), (<span class="string">&quot;æå››&quot;</span>, <span class="number">20</span>), (<span class="string">&quot;ç‹äº”&quot;</span>, <span class="number">30</span>)]</span><br><span class="line"><span class="comment"># æŒ‰å¹´é¾„å‡åºæ’åºï¼ˆå–å…ƒç»„ç¬¬äºŒä¸ªå…ƒç´ ï¼‰</span></span><br><span class="line">sorted_students = <span class="built_in">sorted</span>(students, key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(sorted_students)  <span class="comment"># [(&#x27;æå››&#x27;,20), (&#x27;å¼ ä¸‰&#x27;,25), (&#x27;ç‹äº”&#x27;,30)]</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¸€å®šæœ‰è¿”å›å€¼</span></span><br><span class="line"><span class="comment"># 1. å¸¸è§„è¡¨è¾¾å¼ï¼Œè¿”å›è®¡ç®—ç»“æœ</span></span><br><span class="line">add = <span class="keyword">lambda</span> a, b: a + b</span><br><span class="line"><span class="built_in">print</span>(add(<span class="number">1</span>,<span class="number">2</span>))  <span class="comment"># è¾“å‡º 3ï¼ˆè¿”å› a+b çš„ç»“æœï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. æ— å‚æ•°ï¼Œè¿”å›å›ºå®šå€¼</span></span><br><span class="line">hello = <span class="keyword">lambda</span>: <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="built_in">print</span>(hello())  <span class="comment"># è¾“å‡º &quot;hello&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. è¡¨è¾¾å¼ç»“æœä¸º Noneï¼ˆä»æœ‰è¿”å›å€¼ï¼‰</span></span><br><span class="line">empty = <span class="keyword">lambda</span> x: x <span class="keyword">if</span> x &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line"><span class="built_in">print</span>(empty(-<span class="number">5</span>))  <span class="comment"># è¾“å‡º Noneï¼ˆå¹¶éæ²¡æœ‰è¿”å›å€¼ï¼‰</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰é—­åŒ…">ï¼ˆ3ï¼‰é—­åŒ…</h3>
<ul>
<li><strong>å®šä¹‰</strong>ï¼š
<ul>
<li>å†…éƒ¨å‡½æ•°å¼•ç”¨å¤–éƒ¨å‡½æ•°çš„å˜é‡ï¼Œä¸”å¤–éƒ¨å‡½æ•°è¿”å›å†…éƒ¨å‡½æ•°ï¼ˆå½¢æˆâ€œå°é—­ç¯å¢ƒâ€ï¼‰ï¼›</li>
</ul>
</li>
<li><strong>æ ¸å¿ƒ</strong>ï¼š
<ul>
<li><strong>ä¿å­˜å¤–éƒ¨å‡½æ•°çš„å˜é‡çŠ¶æ€</strong>ï¼Œå³ä½¿å¤–éƒ¨å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œå˜é‡ä»å¯è¢«å†…éƒ¨å‡½æ•°è®¿é—®ï¼›</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¤ºä¾‹1</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">outer</span>(<span class="params">num1</span>):</span><br><span class="line">    <span class="comment"># å¤–éƒ¨å‡½æ•°å˜é‡</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner</span>(<span class="params">num2</span>):</span><br><span class="line">        <span class="comment"># å†…éƒ¨å‡½æ•°å¼•ç”¨å¤–éƒ¨å˜é‡num1ï¼ˆé—­åŒ…ï¼‰</span></span><br><span class="line">        <span class="keyword">return</span> num1 + num2</span><br><span class="line">    <span class="comment"># è¿”å›å†…éƒ¨å‡½æ•°</span></span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºé—­åŒ…å®ä¾‹ï¼ˆç»‘å®šnum1=10ï¼‰</span></span><br><span class="line">f = outer(<span class="number">10</span>)</span><br><span class="line"><span class="comment"># è°ƒç”¨å†…éƒ¨å‡½æ•°ï¼ˆä»èƒ½è®¿é—®num1=10ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(f(<span class="number">5</span>))  <span class="comment"># 15</span></span><br><span class="line"><span class="built_in">print</span>(f(<span class="number">6</span>))  <span class="comment"># 16</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹2ï¼šâ€œçŠ¶æ€ä¿æŒâ€</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">counter</span>():</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">increment</span>():</span><br><span class="line">        <span class="keyword">nonlocal</span> count</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> count</span><br><span class="line">    <span class="keyword">return</span> increment</span><br><span class="line"></span><br><span class="line">c = counter()</span><br><span class="line"><span class="built_in">print</span>(c())  <span class="comment"># 1</span></span><br><span class="line"><span class="built_in">print</span>(c())  <span class="comment"># 2</span></span><br><span class="line"><span class="built_in">print</span>(c())  <span class="comment"># 3ï¼ˆcount çŠ¶æ€è¢«ä¿æŒï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># âŒ å¿˜è®°ä½¿ç”¨ nonlocal ä¼šæŠ¥é”™</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">counter_wrong</span>():</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">increment</span>():</span><br><span class="line">        count += <span class="number">1</span>  <span class="comment"># UnboundLocalError: &#x27;count&#x27; referenced before assignment</span></span><br><span class="line">        <span class="keyword">return</span> count</span><br><span class="line">    <span class="keyword">return</span> increment</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ4ï¼‰è£…é¥°å™¨ï¼ˆé—­åŒ…çš„æ ¸å¿ƒåº”ç”¨ï¼‰">ï¼ˆ4ï¼‰è£…é¥°å™¨ï¼ˆé—­åŒ…çš„æ ¸å¿ƒåº”ç”¨ï¼‰</h3>
<h4 id="1-ä»‹ç»">&lt;1&gt;ä»‹ç»</h4>
<ul>
<li><strong>å®šä¹‰</strong>ï¼š
<ul>
<li>åœ¨ä¸ä¿®æ”¹åŸå‡½æ•°ä»£ç çš„å‰æä¸‹ï¼Œä¸ºå‡½æ•°æ·»åŠ é¢å¤–åŠŸèƒ½ï¼ˆå¦‚æ—¥å¿—ã€è®¡æ—¶ã€æƒé™æ ¡éªŒï¼‰</li>
</ul>
</li>
<li><strong>æ ¸å¿ƒåŸç†</strong>ï¼š
<ul>
<li>è£…é¥°å™¨æœ¬è´¨æ˜¯ã€Œé«˜é˜¶å‡½æ•°ã€ï¼ˆæ¥æ”¶å‡½æ•°ä½œä¸ºå‚æ•°ã€è¿”å›å‡½æ•°ä½œä¸ºç»“æœï¼‰ï¼Œåˆ©ç”¨å‡½æ•°æ˜¯ä¸€ç­‰å¯¹è±¡çš„ç‰¹æ€§ï¼Œé€šè¿‡â€œåŒ…è£…â€åŸå‡½æ•°å®ç°åŠŸèƒ½æ‰©å±•ï¼Œæœ€ç»ˆæ›¿æ¢åŸå‡½æ•°çš„å¼•ç”¨ã€‚</li>
</ul>
</li>
<li>å¯ä½¿ç”¨ <strong>@è¯­æ³•ç³–</strong>ç®€åŒ–åŒ…è£…è¿‡ç¨‹</li>
<li>**æ³¨ï¼ï¼š**è£…é¥°å™¨ä¼šå¯¼è‡´åŸå‡½æ•°çš„ <strong>name</strong>ã€<strong>doc</strong> ä¸¢å¤±ï¼Œå®é™…å¼€å‘ä¸­é€šå¸¸ä¼šåŠ  <strong>@wraps</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. å®šä¹‰è£…é¥°å™¨å‡½æ•°ï¼ˆlogger_decoratoræ˜¯è£…é¥°å™¨ï¼Œæ¥æ”¶åŸå‡½æ•°ä½œä¸ºå‚æ•°ï¼‰</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logger_decorator</span>(<span class="params">func</span>):  <span class="comment"># funcï¼šæ¥æ”¶è¢«è£…é¥°çš„åŸå‡½æ•°ï¼ˆå¦‚åç»­çš„addå‡½æ•°ï¼‰</span></span><br><span class="line">    <span class="comment"># 2. å®šä¹‰å†…éƒ¨åŒ…è£…å‡½æ•°ï¼ˆwrapperæ˜¯æ ¸å¿ƒï¼Œè´Ÿè´£æ·»åŠ é¢å¤–åŠŸèƒ½+æ‰§è¡ŒåŸå‡½æ•°ï¼‰</span></span><br><span class="line">    <span class="comment"># *args, **kwargsï¼šä¸‡èƒ½å‚æ•°ï¼Œç¡®ä¿èƒ½æ¥æ”¶åŸå‡½æ•°çš„ä»»æ„å‚æ•°ï¼Œä¿è¯è£…é¥°å™¨é€šç”¨æ€§</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        <span class="comment"># 3. å‰ç½®é¢å¤–åŠŸèƒ½ï¼šåœ¨åŸå‡½æ•°æ‰§è¡Œå‰æ‰§è¡Œï¼ˆæ­¤å¤„æ˜¯æ‰“å°è°ƒç”¨æ—¥å¿—ï¼‰</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;è°ƒç”¨å‡½æ•°ï¼š<span class="subst">&#123;func.__name__&#125;</span>ï¼Œå‚æ•°ï¼š<span class="subst">&#123;args&#125;</span>, <span class="subst">&#123;kwargs&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="comment"># 4. æ‰§è¡ŒåŸå‡½æ•°ï¼šè°ƒç”¨ä¼ å…¥çš„åŸå‡½æ•°funcï¼Œä¼ å…¥æ¥æ”¶çš„å‚æ•°ï¼Œè·å–è¿”å›å€¼</span></span><br><span class="line">        result = func(*args, **kwargs)  <span class="comment"># è‹¥åŸå‡½æ•°æ— è¿”å›å€¼ï¼Œresultä¸ºNone</span></span><br><span class="line">        <span class="comment"># 5. åç½®é¢å¤–åŠŸèƒ½ï¼šåœ¨åŸå‡½æ•°æ‰§è¡Œåæ‰§è¡Œï¼ˆæ­¤å¤„æ˜¯æ‰“å°è¿”å›å€¼ï¼‰</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;å‡½æ•°è¿”å›å€¼ï¼š<span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="comment"># 6. è¿”å›åŸå‡½æ•°çš„è¿”å›å€¼ï¼šç¡®ä¿è£…é¥°åçš„å‡½æ•°ä¸åŸå‡½æ•°è¿”å›å€¼ä¸€è‡´ï¼Œä¸ç ´ååŸé€»è¾‘</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="comment"># 7. è£…é¥°å™¨è¿”å›åŒ…è£…å‡½æ•°ï¼šç”¨wrapperæ›¿æ¢åŸå‡½æ•°çš„å¼•ç”¨</span></span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰‹åŠ¨åŒ…è£…ï¼ˆä¸æ¨èï¼Œæ¨èç”¨ @è¯­æ³•ç³–ï¼‰</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_original</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"><span class="comment"># æ‰‹åŠ¨å®Œæˆè£…é¥°å™¨çš„ç»‘å®šï¼šä¼ å…¥åŸå‡½æ•°â†’è·å–åŒ…è£…å‡½æ•°â†’é‡æ–°èµ‹å€¼</span></span><br><span class="line">add_original = logger_decorator(add_original)</span><br><span class="line">add_original(<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line"><span class="comment"># è¾“å‡º</span></span><br><span class="line"><span class="comment"># è°ƒç”¨å‡½æ•°ï¼šadd_originalï¼Œå‚æ•°ï¼š(10, 20), &#123;&#125;</span></span><br><span class="line"><span class="comment"># å‡½æ•°è¿”å›å€¼ï¼š30</span></span><br></pre></td></tr></table></figure>
<h4 id="2-è¯­æ³•ç³–">&lt;2&gt;@è¯­æ³•ç³–</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 1. å®šä¹‰è£…é¥°å™¨å‡½æ•°ï¼ˆlogger_decoratoræ˜¯è£…é¥°å™¨ï¼Œæ¥æ”¶åŸå‡½æ•°ä½œä¸ºå‚æ•°ï¼‰</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logger_decorator</span>(<span class="params">func</span>):  <span class="comment"># funcï¼šæ¥æ”¶è¢«è£…é¥°çš„åŸå‡½æ•°ï¼ˆå¦‚åç»­çš„addå‡½æ•°ï¼‰</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;è°ƒç”¨å‡½æ•°ï¼š<span class="subst">&#123;func.__name__&#125;</span>ï¼Œå‚æ•°ï¼š<span class="subst">&#123;args&#125;</span>, <span class="subst">&#123;kwargs&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        result = func(*args, **kwargs)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;å‡½æ•°è¿”å›å€¼ï¼š<span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨@è¯­æ³•ç³–ï¼ˆç®€æ´ï¼Œæ¨èï¼‰</span></span><br><span class="line"><span class="meta">@logger_decorator  </span><span class="comment"># ç­‰ä»·äºï¼šadd = logger_decorator(add)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a, b</span>):  <span class="comment"># åŸå‡½æ•°ï¼šæ ¸å¿ƒé€»è¾‘æ˜¯è®¡ç®—ä¸¤æ•°ä¹‹å’Œï¼Œæ— é¢å¤–åŠŸèƒ½</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br></pre></td></tr></table></figure>
<ul>
<li>å½“ç¨‹åºæ‰§è¡Œåˆ° <strong>@è£…é¥°å™¨å</strong> æ—¶ï¼Œä¼šè‡ªåŠ¨å®Œæˆ 3 æ­¥æ“ä½œï¼š
<ul>
<li>1.å…ˆå®šä¹‰ä¸‹æ–¹çš„åŸå‡½æ•°ï¼ˆå¦‚ addï¼‰</li>
<li>2.å°†åŸå‡½æ•°ä½œä¸ºå‚æ•°ä¼ å…¥ @ åé¢çš„è£…é¥°å™¨å‡½æ•°ï¼ˆå¦‚ logger_decorator(add)ï¼‰</li>
<li>3.æŠŠè£…é¥°å™¨å‡½æ•°è¿”å›çš„ã€ŒåŒ…è£…å‡½æ•°ã€ï¼ˆå¦‚ wrapperï¼‰é‡æ–°èµ‹å€¼ç»™åŸå‡½æ•°åï¼ˆå¦‚ add = wrapperï¼‰</li>
<li>æœ€ç»ˆæ•ˆæœï¼šåç»­è°ƒç”¨åŸå‡½æ•°åï¼ˆå¦‚ add(10,20)ï¼‰ï¼Œå®é™…è°ƒç”¨çš„æ˜¯è£…é¥°å™¨è¿”å›çš„åŒ…è£…å‡½æ•°ã€‚</li>
</ul>
</li>
<li><strong>@è¯­æ³•çš„æ ¸å¿ƒä¼˜åŠ¿</strong>ï¼š
<ul>
<li><strong>ç®€æ´æ€§</strong>ï¼šæ— éœ€æ‰‹åŠ¨å†™â€œåŸå‡½æ•° = è£…é¥°å™¨(åŸå‡½æ•°)â€çš„èµ‹å€¼è¯­å¥ï¼Œä¸€è¡Œ @è£…é¥°å™¨å å³å¯å®Œæˆè£…é¥°å™¨ç»‘å®šï¼›</li>
<li><strong>å¯è¯»æ€§</strong>ï¼šè£…é¥°å™¨ä¸åŸå‡½æ•°çš„å…³è”å…³ç³»ç›´è§‚ï¼Œä¸€çœ¼å°±èƒ½çœ‹å‡ºâ€œè¯¥å‡½æ•°è¢«å“ªä¸ªè£…é¥°å™¨å¢å¼ºâ€ï¼›</li>
<li><strong>å¯å åŠ æ€§</strong>ï¼šæ”¯æŒå¤šä¸ªè£…é¥°å™¨å åŠ ä½¿ç”¨ï¼ˆæŒ‰ä»ä¸Šåˆ°ä¸‹çš„é¡ºåºä¾æ¬¡è£…é¥°ï¼‰</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@decorator1</span></span><br><span class="line"><span class="meta">@decorator2</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">ç­‰ä»·äºï¼šfunc = decorator1(decorator2(func))</span><br></pre></td></tr></table></figure>
<h4 id="3-wrapsçš„ä½¿ç”¨">&lt;3&gt;@wrapsçš„ä½¿ç”¨</h4>
<ul>
<li>åœ¨ä¸Šè¿°åŸºç¡€è£…é¥°å™¨ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªéšè—é—®é¢˜ï¼š
<ul>
<li>è£…é¥°åçš„å‡½æ•°ï¼ˆå¦‚è¢«è£…é¥°çš„addï¼‰ï¼Œå…¶åŸå§‹ä¿¡æ¯ï¼ˆå¦‚å‡½æ•°å__name__ã€æ–‡æ¡£å­—ç¬¦ä¸²__doc__ï¼‰ä¼šè¢«åŒ…è£…å‡½æ•°wrapperè¦†ç›–ï¼Œè¿™ä¼šå½±å“ä¾èµ–å‡½æ•°åŸå§‹ä¿¡æ¯çš„åœºæ™¯ï¼ˆå¦‚æŸ¥çœ‹æ–‡æ¡£ã€åå°„ç­‰ï¼‰</li>
</ul>
</li>
<li><strong>@wraps çš„æ ¸å¿ƒä½œç”¨</strong>ï¼š
<ul>
<li>å°†åŸå‡½æ•°çš„å…ƒä¿¡æ¯ï¼ˆå‡½æ•°åã€æ–‡æ¡£å­—ç¬¦ä¸²ç­‰ï¼‰å¤åˆ¶åˆ°åŒ…è£…å‡½æ•°ä¸­ï¼Œä¿ç•™åŸå‡½æ•°çš„èº«ä»½ä¿¡æ¯ã€‚</li>
</ul>
</li>
</ul>
<h5 id="1ï¼‰é—®é¢˜æ¼”ç¤ºï¼ˆæœªä½¿ç”¨-wrapsï¼‰">1ï¼‰é—®é¢˜æ¼”ç¤ºï¼ˆæœªä½¿ç”¨@wrapsï¼‰</h5>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">logger_decorator</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;è°ƒç”¨å‡½æ•°ï¼š<span class="subst">&#123;func.__name__&#125;</span>&quot;</span>)</span><br><span class="line">        result = func(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@logger_decorator</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è®¡ç®—ä¸¤ä¸ªæ•°çš„å’Œ&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹è£…é¥°åå‡½æ•°çš„ä¿¡æ¯ï¼ˆè¢«wrapperè¦†ç›–ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;å‡½æ•°åï¼š<span class="subst">&#123;add.__name__&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šwrapperï¼ˆæœŸæœ›æ˜¯addï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æ–‡æ¡£å­—ç¬¦ä¸²ï¼š<span class="subst">&#123;add.__doc__&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šNoneï¼ˆæœŸæœ›æ˜¯â€œè®¡ç®—ä¸¤ä¸ªæ•°çš„å’Œâ€ï¼‰</span></span><br></pre></td></tr></table></figure>
<h5 id="2ï¼‰-wrapsçš„ä½¿ç”¨æ–¹æ³•ï¼ˆè§£å†³é—®é¢˜ï¼‰">2ï¼‰@wrapsçš„ä½¿ç”¨æ–¹æ³•ï¼ˆè§£å†³é—®é¢˜ï¼‰</h5>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps  <span class="comment"># å¿…é¡»å¯¼å…¥wraps</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logger_decorator</span>(<span class="params">func</span>):</span><br><span class="line"><span class="meta">    @wraps(<span class="params">func</span>)  </span><span class="comment"># å…³é”®ï¼šå°†funcçš„å…ƒä¿¡æ¯å¤åˆ¶åˆ°wrapper</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;è°ƒç”¨å‡½æ•°ï¼š<span class="subst">&#123;func.__name__&#125;</span>&quot;</span>)</span><br><span class="line">        result = func(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@logger_decorator</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è®¡ç®—ä¸¤ä¸ªæ•°çš„å’Œ&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†æ¬¡æŸ¥çœ‹å‡½æ•°ä¿¡æ¯ï¼ˆå·²ä¿ç•™åŸå‡½æ•°ä¿¡æ¯ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;å‡½æ•°åï¼š<span class="subst">&#123;add.__name__&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šaddï¼ˆæ­£ç¡®ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æ–‡æ¡£å­—ç¬¦ä¸²ï¼š<span class="subst">&#123;add.__doc__&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šè®¡ç®—ä¸¤ä¸ªæ•°çš„å’Œï¼ˆæ­£ç¡®ï¼‰</span></span><br></pre></td></tr></table></figure>
<h2 id="9-å‡½æ•°çš„å®æˆ˜æŠ€å·§">9.å‡½æ•°çš„å®æˆ˜æŠ€å·§</h2>
<h3 id="ï¼ˆ1ï¼‰æ–‡æ¡£å­—ç¬¦ä¸²ï¼ˆè§„èŒƒå†™æ³•ï¼‰">ï¼ˆ1ï¼‰æ–‡æ¡£å­—ç¬¦ä¸²ï¼ˆè§„èŒƒå†™æ³•ï¼‰</h3>
<p>æŠ€å·§æ„ä¹‰ï¼šæå‡ä»£ç å¯ç»´æŠ¤æ€§ä¸å¯è¯»æ€§ï¼Œæ–¹ä¾¿ä½¿ç”¨è€…å¿«é€Ÿäº†è§£å‡½æ•°ä¿¡æ¯ï¼Œé€‚é…å›¢é˜Ÿåä½œä¸è§„èŒƒåŒ–å¼€å‘ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    è®¡ç®—ä¸¤ä¸ªæ•°çš„å’Œ</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    å‚æ•°ï¼š</span></span><br><span class="line"><span class="string">        a (int/float)ï¼šç¬¬ä¸€ä¸ªæ•°</span></span><br><span class="line"><span class="string">        b (int/float)ï¼šç¬¬äºŒä¸ªæ•°</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    è¿”å›å€¼ï¼š</span></span><br><span class="line"><span class="string">        int/floatï¼šä¸¤ä¸ªæ•°çš„å’Œ</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ–‡æ¡£å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="built_in">print</span>(add.__doc__)</span><br><span class="line"><span class="built_in">help</span>(add)  <span class="comment"># æ›´æ¸…æ™°çš„æ ¼å¼</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰å‡½æ•°æ³¨è§£">ï¼ˆ2ï¼‰å‡½æ•°æ³¨è§£</h3>
<ul>
<li><strong>å®šä¹‰</strong>ï¼šä¸ºå‚æ•°/è¿”å›å€¼æ·»åŠ ç±»å‹æç¤ºï¼ˆ<strong>ä»…æç¤ºï¼Œä¸å¼ºåˆ¶æ ¡éªŒ</strong>ï¼‰</li>
<li><strong>ä½œç”¨</strong>ï¼šæé«˜ä»£ç å¯è¯»æ€§ï¼Œé…åˆIDEè‡ªåŠ¨æç¤ºï¼Œæ˜ç¡®å‚æ•°ä¸è¿”å›å€¼ç±»å‹ï¼Œé™ä½ä¼ å‚é”™è¯¯ï¼Œæå‡å¼€å‘æ•ˆç‡ï¼Œæ”¯æŒé™æ€ç±»å‹æ ¡éªŒã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ³¨è§£æ ¼å¼ï¼šå‚æ•°: ç±»å‹ï¼Œè¿”å›å€¼ -&gt; ç±»å‹</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨è§£ä¸å½±å“æ‰§è¡Œï¼ˆä¼ å…¥å­—ç¬¦ä¸²ä¹Ÿèƒ½è¿è¡Œï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(add(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>))  <span class="comment"># helloworld</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ³¨è§£</span></span><br><span class="line"><span class="built_in">print</span>(add.__annotations__)  <span class="comment"># &#123;&#x27;a&#x27;: int, &#x27;b&#x27;: int, &#x27;return&#x27;: int&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰åå‡½æ•°ï¼ˆfunctools-partialï¼‰">ï¼ˆ3ï¼‰åå‡½æ•°ï¼ˆfunctools.partialï¼‰</h3>
<ul>
<li><strong>å®šä¹‰</strong>ï¼š
<ul>
<li>åå‡½æ•°æ˜¯ Python functools æ¨¡å—æä¾›çš„å·¥å…·ï¼Œç”¨äºå›ºå®šåŸå‡½æ•°çš„éƒ¨åˆ†å‚æ•°ï¼ˆä½ç½®å‚æ•°æˆ–å…³é”®å­—å‚æ•°ï¼‰ï¼Œç”Ÿæˆä¸€ä¸ªå‚æ•°æ›´å°‘çš„æ–°å‡½æ•°</li>
<li>æ–°å‡½æ•°è°ƒç”¨æ—¶åªéœ€ä¼ å…¥å‰©ä½™æœªå›ºå®šçš„å‚æ•°ï¼Œå³å¯å®ŒæˆåŸå‡½æ•°çš„é€»è¾‘æ‰§è¡Œï¼Œæ ¸å¿ƒä»·å€¼æ˜¯ç®€åŒ–é‡å¤åœºæ™¯ä¸‹çš„å‡½æ•°è°ƒç”¨</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. å¯¼å…¥åå‡½æ•°å·¥å…·ï¼ˆå¿…é¡»ï¼‰</span></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. åå‡½æ•°æ ¸å¿ƒè¯­æ³•æ ¼å¼</span></span><br><span class="line">æ–°å‡½æ•°å = partial(åŸå‡½æ•°å, å›ºå®šå‚æ•°<span class="number">1</span>=å€¼<span class="number">1</span>, å›ºå®šå‚æ•°<span class="number">2</span>=å€¼<span class="number">2</span>, ...)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯­æ³•è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment"># - åŸå‡½æ•°åï¼šéœ€è¦è¢«å›ºå®šå‚æ•°çš„åŸå§‹å‡½æ•°</span></span><br><span class="line"><span class="comment"># - å›ºå®šå‚æ•°ï¼šå¯æŒ‡å®šåŸå‡½æ•°çš„ä»»æ„ä½ç½®å‚æ•°ï¼ˆæŒ‰é¡ºåºå›ºå®šï¼‰æˆ–å…³é”®å­—å‚æ•°ï¼ˆæŒ‰å‚æ•°åå›ºå®šï¼‰</span></span><br><span class="line"><span class="comment"># - æ–°å‡½æ•°åï¼šç”Ÿæˆçš„ç®€åŒ–ç‰ˆå‡½æ•°ï¼Œè°ƒç”¨æ—¶ä¼ å…¥å‰©ä½™å‚æ•°å³å¯</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a, b, c</span>):</span><br><span class="line">    <span class="keyword">return</span> a + b + c</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹1ï¼šå›ºå®šå…³é”®å­—å‚æ•°c=10ï¼Œç”Ÿæˆæ–°å‡½æ•°add_10</span></span><br><span class="line">add_10 = partial(add, c=<span class="number">10</span>)</span><br><span class="line"><span class="built_in">print</span>(add_10(<span class="number">1</span>, <span class="number">2</span>))  <span class="comment"># 13ï¼ˆ1+2+10ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹2ï¼šå›ºå®šä½ç½®å‚æ•°a=5ï¼Œç”Ÿæˆæ–°å‡½æ•°add_5</span></span><br><span class="line">add_5 = partial(add, <span class="number">5</span>)  <span class="comment"># æŒ‰ä½ç½®å›ºå®šç¬¬ä¸€ä¸ªå‚æ•°a</span></span><br><span class="line"><span class="built_in">print</span>(add_5(<span class="number">2</span>, <span class="number">3</span>))  <span class="comment"># 10ï¼ˆ5+2+3ï¼‰</span></span><br></pre></td></tr></table></figure>
<h2 id="10-å¸¸ç”¨é«˜é˜¶è¾…åŠ©å‡½æ•°">10.å¸¸ç”¨é«˜é˜¶è¾…åŠ©å‡½æ•°</h2>
<p>é«˜é˜¶å‡½æ•°æ˜¯æŒ‡â€œæ¥æ”¶å‡½æ•°ä½œä¸ºå‚æ•°â€æˆ–â€œè¿”å›å‡½æ•°ä½œä¸ºç»“æœâ€çš„å‡½æ•°ï¼Œæ˜¯ Python å‡½æ•°å¼ç¼–ç¨‹çš„æ ¸å¿ƒï¼Œå¸¸<strong>ä¸åŒ¿åå‡½æ•°ï¼ˆlambdaï¼‰é…åˆ</strong>ï¼Œæå‡ä»£ç ç®€æ´æ€§å’Œå¯è¯»æ€§ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260110231245247.png" alt=""></p>
<h3 id="ï¼ˆ1ï¼‰enumerate-ï¼šç´¢å¼•-å…ƒç´ å¯¹-è¿­ä»£">ï¼ˆ1ï¼‰enumerate()ï¼šç´¢å¼•-å…ƒç´ å¯¹ è¿­ä»£</h3>
<ul>
<li>
<p><strong>å®šä¹‰</strong>ï¼š</p>
<ul>
<li>éå†å¯è¿­ä»£å¯¹è±¡æ—¶ï¼Œ<strong>åŒæ—¶è¿”å›å…ƒç´ çš„â€œç´¢å¼•â€å’Œâ€œå¯¹åº”å€¼â€</strong>ï¼Œå°†ä¸¤è€…æ‰“åŒ…ä¸ºå…ƒç»„åºåˆ—ï¼Œè¿”å›è¿­ä»£å™¨ï¼ˆéœ€ç”¨ list/tuple è½¬æ¢æŸ¥çœ‹ï¼‰</li>
</ul>
</li>
<li>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<ul>
<li>enumerate(å¯è¿­ä»£å¯¹è±¡, start=0)ï¼›</li>
</ul>
</li>
<li>
<p><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>ç´¢å¼•èµ·å§‹å€¼é»˜è®¤ 0ï¼Œå¯é€šè¿‡ start å‚æ•°è‡ªå®šä¹‰ï¼ˆå¦‚ start=1 å®ç°åºå·ä» 1 å¼€å§‹ï¼‰ï¼›</li>
<li>è¿”å›æšä¸¾è¿­ä»£å™¨ï¼ŒèŠ‚çœå†…å­˜ï¼Œéå†æ•ˆç‡é«˜äºæ‰‹åŠ¨ç»´æŠ¤ç´¢å¼•ï¼ˆå¦‚ i=0; for x in lst: â€¦; i+=1ï¼‰ï¼›</li>
<li>é€‚ç”¨äºéœ€è¦åŒæ—¶è·å–â€œä½ç½®â€å’Œâ€œå…ƒç´ å€¼â€çš„åœºæ™¯ï¼ˆå¦‚åˆ—è¡¨éå†æ ‡åºå·ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŸºç¡€ç”¨æ³•ï¼šé»˜è®¤ç´¢å¼•ä»0å¼€å§‹</span></span><br><span class="line">fruits = [<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;pear&quot;</span>, <span class="string">&quot;orange&quot;</span>]</span><br><span class="line"><span class="keyword">for</span> idx, fruit <span class="keyword">in</span> <span class="built_in">enumerate</span>(fruits):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ç´¢å¼•<span class="subst">&#123;idx&#125;</span>ï¼š<span class="subst">&#123;fruit&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šç´¢å¼•0ï¼šappleï¼›ç´¢å¼•1ï¼šbananaï¼›ç´¢å¼•2ï¼špearï¼›ç´¢å¼•3ï¼šorange</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›é˜¶ç”¨æ³•ï¼šè‡ªå®šä¹‰ç´¢å¼•èµ·å§‹å€¼ï¼ˆé€‚åˆç”Ÿæˆåºå·ï¼‰</span></span><br><span class="line"><span class="keyword">for</span> seq, fruit <span class="keyword">in</span> <span class="built_in">enumerate</span>(fruits, start=<span class="number">1</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;åºå·<span class="subst">&#123;seq&#125;</span>ï¼š<span class="subst">&#123;fruit&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šåºå·1ï¼šappleï¼›åºå·2ï¼šbananaï¼›åºå·3ï¼špearï¼›åºå·4ï¼šorange</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è½¬æ¢ä¸ºåˆ—è¡¨æŸ¥çœ‹å®Œæ•´ç»“æœ</span></span><br><span class="line">enum_result = <span class="built_in">list</span>(<span class="built_in">enumerate</span>(fruits))</span><br><span class="line"><span class="built_in">print</span>(enum_result)  <span class="comment"># è¾“å‡ºï¼š[(0, &#x27;apple&#x27;), (1, &#x27;banana&#x27;), (2, &#x27;pear&#x27;), (3, &#x27;orange&#x27;)]</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰zip-ï¼šå¤šåºåˆ—å…ƒç´ æ‰“åŒ…">ï¼ˆ2ï¼‰zip()ï¼šå¤šåºåˆ—å…ƒç´ æ‰“åŒ…</h3>
<ul>
<li><strong>å®šä¹‰</strong>ï¼š
<ul>
<li>å°†å¤šä¸ªå¯è¿­ä»£å¯¹è±¡ï¼ˆåˆ—è¡¨ã€å…ƒç»„ç­‰ï¼‰çš„**â€œå¯¹åº”ä½ç½®â€<strong>å…ƒç´ æ‰“åŒ…ä¸º</strong>å…ƒç»„**ï¼Œè¿”å›è¿­ä»£å™¨</li>
<li>å½“å¤šä¸ªåºåˆ—é•¿åº¦ä¸ä¸€è‡´æ—¶ï¼Œä»¥æœ€çŸ­çš„åºåˆ—ä¸ºå‡†åœæ­¢æ‰“åŒ…</li>
</ul>
</li>
<li><strong>è¯­æ³•</strong>ï¼š
<ul>
<li>zip(å¯è¿­ä»£å¯¹è±¡1, å¯è¿­ä»£å¯¹è±¡2, â€¦)</li>
</ul>
</li>
<li><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼š
<ul>
<li>æ”¯æŒä»»æ„æ•°é‡çš„å¯è¿­ä»£å¯¹è±¡ï¼ˆå¦‚ 2 ä¸ªã€3 ä¸ªç”šè‡³æ›´å¤šï¼‰</li>
<li>è¿”å› zip è¿­ä»£å™¨ï¼Œéœ€ç”¨ list/tuple è½¬æ¢æŸ¥çœ‹å…·ä½“å…ƒç´ </li>
<li>å¯é€šè¿‡ * è¿ç®—ç¬¦è§£åŒ… zip ç»“æœï¼Œ<strong>å†…å®¹</strong>ä¸Šèƒ½è¿˜åŸåŸå§‹åºåˆ—çš„å…ƒç´ ï¼Œä½†<strong>ç±»å‹</strong>ä¸Šå¾—åˆ°çš„æ˜¯<strong>å…ƒç»„</strong>
<ul>
<li><strong>æ³¨æ„ï¼šè¿”å›çš„æ˜¯â€œå…ƒç»„â€ï¼</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŸºç¡€ç”¨æ³•1ï¼šæ‰“åŒ…ä¸¤ä¸ªåºåˆ—ï¼ˆé•¿åº¦ä¸€è‡´ï¼‰å¹¶å¾ªç¯å¤„ç†ç»“æœ</span></span><br><span class="line">names = [<span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="string">&quot;æå››&quot;</span>, <span class="string">&quot;ç‹äº”&quot;</span>]</span><br><span class="line">ages = [<span class="number">25</span>, <span class="number">30</span>, <span class="number">28</span>]</span><br><span class="line">user_info = <span class="built_in">zip</span>(names, ages)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœºæ™¯1ï¼šå¾ªç¯éå†æ‰“åŒ…ç»“æœï¼Œæ‰¹é‡å¤„ç†ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">for</span> name, age <span class="keyword">in</span> user_info:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ç”¨æˆ·ï¼š<span class="subst">&#123;name&#125;</span>ï¼Œå¹´é¾„ï¼š<span class="subst">&#123;age&#125;</span>ï¼Œæ˜¯å¦æˆå¹´ï¼š<span class="subst">&#123;age &gt;= <span class="number">18</span>&#125;</span>&quot;</span>)</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment"># ç”¨æˆ·ï¼šå¼ ä¸‰ï¼Œå¹´é¾„ï¼š25ï¼Œæ˜¯å¦æˆå¹´ï¼šTrue</span></span><br><span class="line"><span class="comment"># ç”¨æˆ·ï¼šæå››ï¼Œå¹´é¾„ï¼š30ï¼Œæ˜¯å¦æˆå¹´ï¼šTrue</span></span><br><span class="line"><span class="comment"># ç”¨æˆ·ï¼šç‹äº”ï¼Œå¹´é¾„ï¼š28ï¼Œæ˜¯å¦æˆå¹´ï¼šTrue</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›é˜¶ç”¨æ³•1ï¼šæ‰“åŒ…å¤šä¸ªåºåˆ—ï¼ˆä»¥æœ€çŸ­ä¸ºå‡†ï¼‰å¹¶è½¬æ¢ä¸ºåˆ—è¡¨ç”¨äºåç»­æ“ä½œ</span></span><br><span class="line">scores = [<span class="number">85</span>, <span class="number">92</span>]  <span class="comment"># é•¿åº¦æ¯” names/ages çŸ­</span></span><br><span class="line">user_detail = <span class="built_in">zip</span>(names, ages, scores)</span><br><span class="line">detail_list = <span class="built_in">list</span>(user_detail)  <span class="comment"># è½¬æ¢ä¸ºåˆ—è¡¨ä¾¿äºå¤šæ¬¡ä½¿ç”¨ï¼ˆè¿­ä»£å™¨åªèƒ½éå†ä¸€æ¬¡ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœºæ™¯2ï¼šæ ¹æ®æ‰“åŒ…æ•°æ®ç”Ÿæˆç”¨æˆ·æˆç»©å­—å…¸</span></span><br><span class="line">score_dict = &#123;name: (age, score) <span class="keyword">for</span> name, age, score <span class="keyword">in</span> detail_list&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;ç”¨æˆ·æˆç»©å­—å…¸ï¼š&quot;</span>, score_dict)</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼šç”¨æˆ·æˆç»©å­—å…¸ï¼š &#123;&#x27;å¼ ä¸‰&#x27;: (25, 85), &#x27;æå››&#x27;: (30, 92)&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›é˜¶ç”¨æ³•2ï¼šè§£åŒ…zipç»“æœï¼ˆæ ¸å¿ƒä¿®æ”¹ï¼šå…ƒç»„è½¬åˆ—è¡¨ï¼Œæ”¯æŒä¿®æ”¹ï¼‰</span></span><br><span class="line">packed = <span class="built_in">zip</span>(names, ages)</span><br><span class="line">unpacked_names, unpacked_ages = <span class="built_in">zip</span>(*packed)  <span class="comment"># è§£åŒ…å¾—åˆ°å…ƒç»„</span></span><br><span class="line"><span class="comment"># å…³é”®æ­¥éª¤ï¼šå°†ä¸å¯å˜çš„å…ƒç»„è½¬ä¸ºå¯å˜çš„åˆ—è¡¨</span></span><br><span class="line">unpacked_names_list = <span class="built_in">list</span>(unpacked_names)</span><br><span class="line">unpacked_ages_list = <span class="built_in">list</span>(unpacked_ages)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœºæ™¯3ï¼šè§£åŒ…åæ‰¹é‡æ›´æ–°åºåˆ—æ•°æ®ï¼ˆåˆ—è¡¨å¯ç›´æ¥ä¿®æ”¹ï¼‰</span></span><br><span class="line"><span class="comment"># æ–¹å¼1ï¼šåˆ—è¡¨æ¨å¯¼å¼ç”Ÿæˆæ–°åˆ—è¡¨ï¼ˆæ¨èï¼‰</span></span><br><span class="line">updated_ages = [age + <span class="number">1</span> <span class="keyword">for</span> age <span class="keyword">in</span> unpacked_ages_list]  <span class="comment"># æ‰€æœ‰äººå¹´é¾„+1</span></span><br><span class="line"><span class="comment"># æ–¹å¼2ï¼šç›´æ¥ä¿®æ”¹åŸåˆ—è¡¨ï¼ˆæŒ‰éœ€é€‰æ‹©ï¼‰</span></span><br><span class="line"><span class="comment"># unpacked_ages_list[0] = 100  # ç›´æ¥ä¿®æ”¹å¼ ä¸‰çš„å¹´é¾„ä¸º100</span></span><br><span class="line"></span><br><span class="line">updated_user_info = <span class="built_in">zip</span>(unpacked_names_list, updated_ages)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å¹´é¾„æ›´æ–°åçš„æ•°æ®ï¼š&quot;</span>, <span class="built_in">list</span>(updated_user_info))</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼šå¹´é¾„æ›´æ–°åçš„æ•°æ®ï¼š [(&#x27;å¼ ä¸‰&#x27;, 26), (&#x27;æå››&#x27;, 31), (&#x27;ç‹äº”&#x27;, 29)]</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰sorted-ï¼šé€šç”¨æ’åº">ï¼ˆ3ï¼‰sorted()ï¼šé€šç”¨æ’åº</h3>
<ul>
<li><strong>å®šä¹‰</strong>ï¼š
<ul>
<li>å¯¹ä»»æ„å¯è¿­ä»£å¯¹è±¡ï¼ˆåˆ—è¡¨ã€å…ƒç»„ã€å­—ç¬¦ä¸²ç­‰ï¼‰<strong>æŒ‰æŒ‡å®šè§„åˆ™æ’åº</strong>ï¼Œè¿”å›â€œæ–°çš„æ’åºåˆ—è¡¨â€ï¼Œä¸ä¼šä¿®æ”¹åŸå¯è¿­ä»£å¯¹è±¡</li>
</ul>
</li>
<li><strong>è¯­æ³•</strong>ï¼š
<ul>
<li>sorted(å¯è¿­ä»£å¯¹è±¡, key=None, reverse=False)</li>
</ul>
</li>
<li><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼š
<ul>
<li><strong>key å‚æ•°</strong>ï¼š
<ul>
<li>æ¥æ”¶å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œç”¨äºè‡ªå®šä¹‰æ’åºè§„åˆ™ï¼ˆå¦‚æŒ‰å­—ç¬¦ä¸²é•¿åº¦ã€å­—å…¸æŸå­—æ®µæ’åºï¼‰</li>
</ul>
</li>
<li><strong>reverse å‚æ•°</strong>ï¼š
<ul>
<li>æ§åˆ¶æ’åºæ–¹å‘ï¼Œé»˜è®¤ Falseï¼ˆå‡åºï¼‰ï¼ŒTrue ä¸ºé™åº</li>
</ul>
</li>
<li><strong>é€šç”¨æ€§å¼º</strong>ï¼šå¯ç”¨äºæ‰€æœ‰å¯è¿­ä»£å¯¹è±¡ï¼ˆåŒºåˆ«äºåˆ—è¡¨çš„ sort() æ–¹æ³•ï¼Œsort() ä»…é€‚ç”¨äºåˆ—è¡¨ä¸”ä¿®æ”¹åŸåˆ—è¡¨ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># åŸºç¡€ç”¨æ³•ï¼šé»˜è®¤å‡åºæ’åºï¼Œåç»­ç”¨äºè®¡ç®—æ’åºååˆ—è¡¨çš„æ€»å’Œ</span></span><br><span class="line">nums = [<span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">2</span>]</span><br><span class="line">sorted_nums = <span class="built_in">sorted</span>(nums)</span><br><span class="line"><span class="built_in">print</span>(sorted_nums)  <span class="comment"># è¾“å‡ºï¼š[1, 1, 2, 3, 4, 5, 9]</span></span><br><span class="line"><span class="built_in">print</span>(nums)         <span class="comment"># è¾“å‡ºï¼š[3, 1, 4, 1, 5, 9, 2]ï¼ˆåŸåˆ—è¡¨æœªä¿®æ”¹ï¼‰</span></span><br><span class="line"><span class="comment"># å®é™…ä½¿ç”¨ï¼šè®¡ç®—æ’åºååˆ—è¡¨çš„æ€»å’Œ</span></span><br><span class="line">sorted_sum = <span class="built_in">sum</span>(sorted_nums)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æ’åºååˆ—è¡¨çš„æ€»å’Œï¼š<span class="subst">&#123;sorted_sum&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šæ’åºååˆ—è¡¨çš„æ€»å’Œï¼š25</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›é˜¶ç”¨æ³•1ï¼šé™åºæ’åºï¼Œåç»­ç”¨äºç­›é€‰å‰3ä¸ªæœ€å¤§å€¼</span></span><br><span class="line">desc_nums = <span class="built_in">sorted</span>(nums, reverse=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(desc_nums)    <span class="comment"># è¾“å‡ºï¼š[9, 5, 4, 3, 2, 1, 1]</span></span><br><span class="line"><span class="comment"># å®é™…ä½¿ç”¨ï¼šç­›é€‰å‰3ä¸ªæœ€å¤§å€¼å¹¶ç»„æˆæ–°åˆ—è¡¨</span></span><br><span class="line">top3_nums = desc_nums[:<span class="number">3</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;åˆ—è¡¨ä¸­çš„å‰3ä¸ªæœ€å¤§å€¼ï¼š<span class="subst">&#123;top3_nums&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šåˆ—è¡¨ä¸­çš„å‰3ä¸ªæœ€å¤§å€¼ï¼š[9, 5, 4]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›é˜¶ç”¨æ³•2ï¼šè‡ªå®šä¹‰æ’åºè§„åˆ™ï¼ˆæŒ‰å­—ç¬¦ä¸²é•¿åº¦æ’åºï¼‰ï¼Œåç»­ç”¨äºæ„å»ºé•¿åº¦æ˜ å°„å­—å…¸</span></span><br><span class="line">strs = [<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;pear&quot;</span>, <span class="string">&quot;grape&quot;</span>]</span><br><span class="line">sorted_strs = <span class="built_in">sorted</span>(strs, key=<span class="built_in">len</span>)  <span class="comment"># key=len è¡¨ç¤ºæŒ‰å­—ç¬¦ä¸²é•¿åº¦æ’åº</span></span><br><span class="line"><span class="built_in">print</span>(sorted_strs)  <span class="comment"># è¾“å‡ºï¼š[&#x27;pear&#x27;, &#x27;apple&#x27;, &#x27;grape&#x27;, &#x27;banana&#x27;]ï¼ˆé•¿åº¦ï¼š4â†’5â†’5â†’6ï¼‰</span></span><br><span class="line"><span class="comment"># å®é™…ä½¿ç”¨ï¼šæ„å»ºå­—ç¬¦ä¸²ä¸å¯¹åº”é•¿åº¦çš„æ˜ å°„å­—å…¸</span></span><br><span class="line">str_len_dict = &#123;s: <span class="built_in">len</span>(s) <span class="keyword">for</span> s <span class="keyword">in</span> sorted_strs&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;å­—ç¬¦ä¸²-é•¿åº¦æ˜ å°„å­—å…¸ï¼š<span class="subst">&#123;str_len_dict&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šå­—ç¬¦ä¸²-é•¿åº¦æ˜ å°„å­—å…¸ï¼š&#123;&#x27;pear&#x27;:4, &#x27;apple&#x27;:5, &#x27;grape&#x27;:5, &#x27;banana&#x27;:6&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›é˜¶ç”¨æ³•3ï¼šæŒ‰å­—å…¸å­—æ®µæ’åºï¼Œåç»­ç”¨äºæå–æ’åºåçš„å§“ååˆ—è¡¨</span></span><br><span class="line">users = [&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">25</span>&#125;, &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;æå››&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">20</span>&#125;, &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;ç‹äº”&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">30</span>&#125;]</span><br><span class="line">sorted_users = <span class="built_in">sorted</span>(users, key=<span class="keyword">lambda</span> x: x[<span class="string">&quot;age&quot;</span>])  <span class="comment"># æŒ‰ age å­—æ®µå‡åº</span></span><br><span class="line"><span class="built_in">print</span>(sorted_users)  <span class="comment"># è¾“å‡ºï¼š[&#123;&#x27;name&#x27;: &#x27;æå››&#x27;, &#x27;age&#x27;: 20&#125;, &#123;&#x27;name&#x27;: &#x27;å¼ ä¸‰&#x27;, &#x27;age&#x27;: 25&#125;, &#123;&#x27;name&#x27;: &#x27;ç‹äº”&#x27;, &#x27;age&#x27;: 30&#125;]</span></span><br><span class="line"><span class="comment"># å®é™…ä½¿ç”¨ï¼šæå–æ’åºåçš„å§“åï¼Œç”Ÿæˆæœ‰åºå§“ååˆ—è¡¨</span></span><br><span class="line">sorted_names = [user[<span class="string">&quot;name&quot;</span>] <span class="keyword">for</span> user <span class="keyword">in</span> sorted_users]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æŒ‰å¹´é¾„å‡åºçš„å§“ååˆ—è¡¨ï¼š<span class="subst">&#123;sorted_names&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šæŒ‰å¹´é¾„å‡åºçš„å§“ååˆ—è¡¨ï¼š[&#x27;æå››&#x27;, &#x27;å¼ ä¸‰&#x27;, &#x27;ç‹äº”&#x27;]</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ4ï¼‰max-min-ï¼šæœ€å€¼è·å–">ï¼ˆ4ï¼‰max() / min()ï¼šæœ€å€¼è·å–</h3>
<ul>
<li><strong>å®šä¹‰</strong>ï¼š
<ul>
<li>max() ç”¨äºè·å–å¯è¿­ä»£å¯¹è±¡æˆ–å¤šä¸ªé›¶æ•£å‚æ•°çš„â€œæœ€å¤§å€¼â€</li>
<li>min() ç”¨äºè·å–â€œæœ€å°å€¼â€</li>
</ul>
</li>
<li><strong>è¯­æ³•</strong>ï¼š
<ul>
<li>max(å¯è¿­ä»£å¯¹è±¡/å‚æ•°ç»„, key=None)</li>
<li>min(å¯è¿­ä»£å¯¹è±¡/å‚æ•°ç»„, key=None)</li>
</ul>
</li>
<li><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼š
<ul>
<li>æ”¯æŒä¸¤ç§ä¼ å‚æ–¹å¼ï¼š
<ul>
<li>ç›´æ¥ä¼ å¤šä¸ªé›¶æ•£å‚æ•°ï¼š å¦‚max(2,5,1)</li>
<li>ä¼ ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼šå¦‚max([2,5,1])</li>
</ul>
</li>
<li><strong>key å‚æ•°</strong>ï¼š
<ul>
<li>æ¥æ”¶å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè‡ªå®šä¹‰æ¯”è¾ƒè§„åˆ™ï¼ˆå¦‚æŒ‰å­—ç¬¦ä¸²é•¿åº¦æ‰¾æœ€é•¿/æœ€çŸ­å­—ç¬¦ä¸²ï¼‰</li>
</ul>
</li>
<li><strong>è¿”å›å€¼</strong>ï¼š
<ul>
<li>å•ä¸ªæœ€å€¼ï¼ˆéè¿­ä»£å™¨ï¼‰ï¼Œè‹¥å¯è¿­ä»£å¯¹è±¡ä¸ºç©ºåˆ™æŠ¥é”™ï¼ˆéœ€æ³¨æ„è¾¹ç•Œå¤„ç†ï¼‰ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŸºç¡€ç”¨æ³•1ï¼šå¯¹å¯è¿­ä»£å¯¹è±¡å–æœ€å€¼</span></span><br><span class="line">nums = [<span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">5</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">max</span>(nums))  <span class="comment"># è¾“å‡ºï¼š5</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">min</span>(nums))  <span class="comment"># è¾“å‡ºï¼š1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŸºç¡€ç”¨æ³•2ï¼šå¯¹å¤šä¸ªé›¶æ•£å‚æ•°å–æœ€å€¼</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">max</span>(<span class="number">2</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">7</span>))  <span class="comment"># è¾“å‡ºï¼š7</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">min</span>(<span class="number">2</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">7</span>))  <span class="comment"># è¾“å‡ºï¼š1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›é˜¶ç”¨æ³•ï¼šè‡ªå®šä¹‰æ¯”è¾ƒè§„åˆ™ï¼ˆæŒ‰å­—ç¬¦ä¸²é•¿åº¦æ‰¾æœ€å€¼ï¼‰</span></span><br><span class="line">strs = [<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;pear&quot;</span>]</span><br><span class="line">longest_str = <span class="built_in">max</span>(strs, key=<span class="built_in">len</span>)  <span class="comment"># æœ€é•¿å­—ç¬¦ä¸²</span></span><br><span class="line">shortest_str = <span class="built_in">min</span>(strs, key=<span class="built_in">len</span>)  <span class="comment"># æœ€çŸ­å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="built_in">print</span>(longest_str)  <span class="comment"># è¾“å‡ºï¼šbanana</span></span><br><span class="line"><span class="built_in">print</span>(shortest_str) <span class="comment"># è¾“å‡ºï¼špear</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›é˜¶ç”¨æ³•2ï¼šæŒ‰å­—å…¸å­—æ®µæ‰¾æœ€å€¼</span></span><br><span class="line">users = [&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="string">&quot;score&quot;</span>: <span class="number">85</span>&#125;, &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;æå››&quot;</span>, <span class="string">&quot;score&quot;</span>: <span class="number">92</span>&#125;, &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;ç‹äº”&quot;</span>, <span class="string">&quot;score&quot;</span>: <span class="number">78</span>&#125;]</span><br><span class="line">max_score_user = <span class="built_in">max</span>(users, key=<span class="keyword">lambda</span> x: x[<span class="string">&quot;score&quot;</span>])</span><br><span class="line">min_score_user = <span class="built_in">min</span>(users, key=<span class="keyword">lambda</span> x: x[<span class="string">&quot;score&quot;</span>])</span><br><span class="line"><span class="built_in">print</span>(max_score_user)  <span class="comment"># è¾“å‡ºï¼š&#123;&#x27;name&#x27;: &#x27;æå››&#x27;, &#x27;score&#x27;: 92&#125;</span></span><br><span class="line"><span class="built_in">print</span>(min_score_user)  <span class="comment"># è¾“å‡ºï¼š&#123;&#x27;name&#x27;: &#x27;ç‹äº”&#x27;, &#x27;score&#x27;: 78&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ5ï¼‰any-all-ï¼šå¸ƒå°”å€¼åˆ¤æ–­">ï¼ˆ5ï¼‰any() / all()ï¼šå¸ƒå°”å€¼åˆ¤æ–­</h3>
<ul>
<li>
<p><strong>å®šä¹‰</strong>ï¼š</p>
<ul>
<li>any() å’Œ all() ç”¨äºåˆ¤æ–­å¯è¿­ä»£å¯¹è±¡ä¸­å…ƒç´ çš„å¸ƒå°”å€¼çŠ¶æ€ï¼Œè¿”å›å•ä¸ªå¸ƒå°”å€¼ï¼›</li>
<li><strong>any()</strong>ï¼š
<ul>
<li>å¯è¿­ä»£å¯¹è±¡ä¸­**â€œä»»ä¸€å…ƒç´ ä¸º Trueâ€åˆ™è¿”å› True**ï¼Œå¦åˆ™è¿”å› Falseï¼›</li>
</ul>
</li>
<li><strong>all()</strong>ï¼š
<ul>
<li>å¯è¿­ä»£å¯¹è±¡ä¸­**â€œæ‰€æœ‰å…ƒç´ ä¸º Trueâ€æ‰è¿”å› True**ï¼Œå¦åˆ™è¿”å› Falseã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<ul>
<li>any(å¯è¿­ä»£å¯¹è±¡)ï¼›</li>
<li>all(å¯è¿­ä»£å¯¹è±¡)ï¼›</li>
</ul>
</li>
<li>
<p><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>çŸ­è·¯æ±‚å€¼ï¼š
<ul>
<li>any() æ‰¾åˆ°ç¬¬ä¸€ä¸ª True å°±åœæ­¢éå†ï¼Œall() æ‰¾åˆ°ç¬¬ä¸€ä¸ª False å°±åœæ­¢éå†ï¼Œæ•ˆç‡é«˜ï¼›</li>
</ul>
</li>
<li>ç©ºå¯è¿­ä»£å¯¹è±¡<strong>ç‰¹æ®Šå¤„ç†</strong>ï¼š
<ul>
<li>any(ç©ºåºåˆ—) è¿”å› Falseï¼Œ<strong>all(ç©ºåºåˆ—) è¿”å› True</strong>ï¼ˆé€»è¾‘ä¸Šç†è§£ä¸º&quot;ä¸å­˜åœ¨ False çš„å…ƒç´ &quot;ï¼Œå³&quot;æ²¡æœ‰åä¾‹&quot;ï¼‰</li>
</ul>
</li>
<li>ä»…å…³æ³¨å¸ƒå°”å€¼ï¼š
<ul>
<li>ä¸å¤„ç†å…ƒç´ æœ¬èº«ï¼Œä»…åˆ¤æ–­å…ƒç´ çš„â€œçœŸå€¼â€ï¼ˆ0ã€ç©ºå­—ç¬¦ä¸²ã€ç©ºåˆ—è¡¨ç­‰ä¸º Falseï¼Œéç©º/é0ä¸º Trueï¼‰ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŸºç¡€ç”¨æ³•ï¼šany() åˆ¤æ–­â€œä»»ä¸€ä¸ºçœŸâ€</span></span><br><span class="line">list1 = [<span class="literal">False</span>, <span class="number">0</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;hello&quot;</span>]  <span class="comment"># å­˜åœ¨ &quot;hello&quot;ï¼ˆTrueï¼‰</span></span><br><span class="line">list2 = [<span class="literal">False</span>, <span class="number">0</span>, <span class="string">&quot;&quot;</span>]           <span class="comment"># æ‰€æœ‰å…ƒç´ å‡ä¸º False</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">any</span>(list1))  <span class="comment"># è¾“å‡ºï¼šTrue</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">any</span>(list2))  <span class="comment"># è¾“å‡ºï¼šFalse</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŸºç¡€ç”¨æ³•ï¼šall() åˆ¤æ–­â€œæ‰€æœ‰ä¸ºçœŸâ€</span></span><br><span class="line">list3 = [<span class="literal">True</span>, <span class="number">1</span>, <span class="string">&quot;hello&quot;</span>]  <span class="comment"># æ‰€æœ‰å…ƒç´ å‡ä¸º True</span></span><br><span class="line">list4 = [<span class="literal">True</span>, <span class="number">1</span>, <span class="string">&quot;&quot;</span>]       <span class="comment"># å­˜åœ¨ &quot;&quot;ï¼ˆFalseï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">all</span>(list3))  <span class="comment"># è¾“å‡ºï¼šTrue</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">all</span>(list4))  <span class="comment"># è¾“å‡ºï¼šFalse</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›é˜¶ç”¨æ³•ï¼šç©ºåºåˆ—å¤„ç†</span></span><br><span class="line">empty_list = []</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">any</span>(empty_list))  <span class="comment"># è¾“å‡ºï¼šFalse</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">all</span>(empty_list))  <span class="comment"># è¾“å‡ºï¼šTrue</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®æˆ˜åœºæ™¯ï¼šåˆ¤æ–­åˆ—è¡¨æ˜¯å¦å­˜åœ¨è´Ÿæ•°</span></span><br><span class="line">nums = [<span class="number">3</span>, -<span class="number">2</span>, <span class="number">5</span>, <span class="number">7</span>]</span><br><span class="line">has_negative = <span class="built_in">any</span>(num &lt; <span class="number">0</span> <span class="keyword">for</span> num <span class="keyword">in</span> nums)</span><br><span class="line"><span class="built_in">print</span>(has_negative)  <span class="comment"># è¾“å‡ºï¼šTrue</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®æˆ˜åœºæ™¯ï¼šåˆ¤æ–­åˆ—è¡¨æ‰€æœ‰å…ƒç´ å‡ä¸ºæ­£æ•°</span></span><br><span class="line">all_positive = <span class="built_in">all</span>(num &gt; <span class="number">0</span> <span class="keyword">for</span> num <span class="keyword">in</span> nums)</span><br><span class="line"><span class="built_in">print</span>(all_positive)  <span class="comment"># è¾“å‡ºï¼šFalse</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ6ï¼‰filter-ï¼šå…ƒç´ ç­›é€‰">ï¼ˆ6ï¼‰filter()ï¼šå…ƒç´ ç­›é€‰</h3>
<ul>
<li><strong>å®šä¹‰</strong>ï¼š
<ul>
<li>æ¥æ”¶ä¸€ä¸ªâ€œç­›é€‰å‡½æ•°â€å’Œä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œéå†å¯è¿­ä»£å¯¹è±¡çš„æ¯ä¸ªå…ƒç´ ï¼Œ<strong>ä¿ç•™â€œç­›é€‰å‡½æ•°è¿”å› Trueâ€çš„å…ƒç´ </strong>ï¼Œè¿”å›è¿­ä»£å™¨ï¼ˆéœ€ç”¨ list/tuple è½¬æ¢æŸ¥çœ‹ç»“æœï¼‰ï¼›</li>
</ul>
</li>
<li><strong>è¯­æ³•</strong>ï¼š
<ul>
<li>filter(ç­›é€‰å‡½æ•°, å¯è¿­ä»£å¯¹è±¡)ï¼›</li>
</ul>
</li>
<li><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼š
<ul>
<li>ç­›é€‰å‡½æ•°å¯ä¸º Noneï¼šæ­¤æ—¶ç›´æ¥åˆ¤æ–­å…ƒç´ è‡ªèº«çš„å¸ƒå°”å€¼ï¼ˆä¿ç•™ True çš„å…ƒç´ ï¼‰ï¼›</li>
<li>è¿”å› filter è¿­ä»£å™¨ï¼ŒèŠ‚çœå†…å­˜ï¼Œä»…åœ¨éå†/è½¬æ¢æ—¶æ‰æ‰§è¡Œç­›é€‰ï¼›</li>
<li>ä»…ä¿ç•™ç¬¦åˆæ¡ä»¶çš„â€œåŸå§‹å…ƒç´ â€ï¼Œä¸ä¿®æ”¹å…ƒç´ æœ¬èº«ã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŸºç¡€ç”¨æ³•1ï¼šè‡ªå®šä¹‰ç­›é€‰å‡½æ•°ï¼ˆç­›é€‰å¶æ•°ï¼‰</span></span><br><span class="line">nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_even</span>(<span class="params">num</span>):</span><br><span class="line">    <span class="keyword">return</span> num % <span class="number">2</span> == <span class="number">0</span>  <span class="comment"># å¶æ•°è¿”å› Trueï¼Œå¥‡æ•°è¿”å› False</span></span><br><span class="line"></span><br><span class="line">even_nums = <span class="built_in">filter</span>(is_even, nums)</span><br><span class="line">even_list = <span class="built_in">list</span>(even_nums)  <span class="comment"># è½¬æ¢ä¸ºåˆ—è¡¨ä¾¿äºåç»­ä½¿ç”¨</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨ç­›é€‰ç»“æœè¿›è¡Œåç»­è®¡ç®—ï¼ˆæ±‚å¶æ•°å’Œï¼‰</span></span><br><span class="line">even_sum = <span class="built_in">sum</span>(even_list)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ç­›é€‰å‡ºçš„å¶æ•°åˆ—è¡¨ï¼š<span class="subst">&#123;even_list&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼š[2, 4, 6, 8]</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;å¶æ•°åˆ—è¡¨çš„å’Œï¼š<span class="subst">&#123;even_sum&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼š20</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŸºç¡€ç”¨æ³•2ï¼šç­›é€‰å‡½æ•°ä¸º Noneï¼ˆä¿ç•™éç©ºå…ƒç´ ï¼‰</span></span><br><span class="line">strs = [<span class="string">&quot;&quot;</span>, <span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;æå››&quot;</span>, <span class="string">&quot;ç‹äº”&quot;</span>, <span class="string">&quot;&quot;</span>]</span><br><span class="line">non_empty_strs = <span class="built_in">filter</span>(<span class="literal">None</span>, strs)</span><br><span class="line">non_empty_list = <span class="built_in">list</span>(non_empty_strs)</span><br><span class="line"><span class="comment"># ä½¿ç”¨ç­›é€‰ç»“æœæ„å»ºå­—å…¸ï¼ˆå§“å-åºå·æ˜ å°„ï¼‰</span></span><br><span class="line">name_dict = &#123;name: idx+<span class="number">1</span> <span class="keyword">for</span> idx, name <span class="keyword">in</span> <span class="built_in">enumerate</span>(non_empty_list)&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;éç©ºå§“ååˆ—è¡¨ï¼š<span class="subst">&#123;non_empty_list&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼š[&#x27;å¼ ä¸‰&#x27;, &#x27;æå››&#x27;, &#x27;ç‹äº”&#x27;]</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;å§“ååºå·å­—å…¸ï¼š<span class="subst">&#123;name_dict&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼š&#123;&#x27;å¼ ä¸‰&#x27;: 1, &#x27;æå››&#x27;: 2, &#x27;ç‹äº”&#x27;: 3&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›é˜¶ç”¨æ³•ï¼šç»“åˆ lambda ç®€åŒ–ç­›é€‰ï¼ˆç­›é€‰å¹´é¾„å¤§äº25çš„ç”¨æˆ·ï¼‰</span></span><br><span class="line">users = [(<span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="number">25</span>), (<span class="string">&quot;æå››&quot;</span>, <span class="number">30</span>), (<span class="string">&quot;ç‹äº”&quot;</span>, <span class="number">28</span>), (<span class="string">&quot;èµµå…­&quot;</span>, <span class="number">22</span>)]</span><br><span class="line">adult_users = <span class="built_in">filter</span>(<span class="keyword">lambda</span> x: x[<span class="number">1</span>] &gt; <span class="number">25</span>, users)</span><br><span class="line">adult_list = <span class="built_in">list</span>(adult_users)</span><br><span class="line"><span class="comment"># ä½¿ç”¨ç­›é€‰ç»“æœæå–å§“åï¼Œç”Ÿæˆæˆå¹´ç”¨æˆ·åå•</span></span><br><span class="line">adult_names = [user[<span class="number">0</span>] <span class="keyword">for</span> user <span class="keyword">in</span> adult_list]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æˆå¹´ç”¨æˆ·åˆ—è¡¨ï¼š<span class="subst">&#123;adult_list&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼š[(&#x27;æå››&#x27;, 30), (&#x27;ç‹äº”&#x27;, 28)]</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æˆå¹´ç”¨æˆ·åå•ï¼š<span class="subst">&#123;adult_names&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼š[&#x27;æå››&#x27;, &#x27;ç‹äº”&#x27;]</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ7ï¼‰map-ï¼šå…ƒç´ æ˜ å°„è½¬æ¢">ï¼ˆ7ï¼‰map()ï¼šå…ƒç´ æ˜ å°„è½¬æ¢</h3>
<ul>
<li><strong>å®šä¹‰</strong>ï¼š
<ul>
<li>æ¥æ”¶ä¸€ä¸ªâ€œæ˜ å°„å‡½æ•°â€å’Œä¸€ä¸ª/å¤šä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œå¯¹å¯è¿­ä»£å¯¹è±¡çš„<strong>æ¯ä¸ªå…ƒç´ â€œåº”ç”¨â€æ˜ å°„å‡½æ•°</strong>ï¼Œå°†å‡½æ•°æ‰§è¡Œç»“æœä½œä¸ºæ–°å…ƒç´ ï¼Œè¿”å›è¿­ä»£å™¨ï¼ˆéœ€ç”¨ list/tuple è½¬æ¢æŸ¥çœ‹ï¼‰</li>
</ul>
</li>
<li><strong>è¯­æ³•</strong>ï¼š
<ul>
<li>map(æ˜ å°„å‡½æ•°, å¯è¿­ä»£å¯¹è±¡1, å¯è¿­ä»£å¯¹è±¡2, â€¦)</li>
</ul>
</li>
<li><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼š
<ul>
<li>æ˜ å°„å‡½æ•°å¯ä¸ºæ™®é€šå‡½æ•°ã€åŒ¿åå‡½æ•°ï¼ˆlambdaï¼‰ï¼Œä¹Ÿå¯ä¸ºå†…ç½®å‡½æ•°ï¼ˆå¦‚ intã€strï¼‰</li>
<li>æ”¯æŒå¤šä¸ªå¯è¿­ä»£å¯¹è±¡ï¼šæ˜ å°„å‡½æ•°éœ€æ¥æ”¶å¯¹åº”æ•°é‡çš„å‚æ•°ï¼Œä»¥æœ€çŸ­çš„å¯è¿­ä»£å¯¹è±¡ä¸ºå‡†åœæ­¢ï¼›</li>
<li>è¿”å› map è¿­ä»£å™¨ï¼Œå…ƒç´ ä¸ºæ˜ å°„å‡½æ•°çš„æ‰§è¡Œç»“æœï¼ˆå®ç°å…ƒç´ çš„æ‰¹é‡è½¬æ¢ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># åŸºç¡€ç”¨æ³•1ï¼šå•ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼ˆå…ƒç´ æ‰¹é‡ä¹˜2ï¼Œåç»­ç”¨äºæ±‚å’Œè®¡ç®—ï¼‰</span></span><br><span class="line">nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">double_nums = <span class="built_in">map</span>(<span class="keyword">lambda</span> x: x * <span class="number">2</span>, nums)</span><br><span class="line">double_list = <span class="built_in">list</span>(double_nums)  <span class="comment"># è½¬æ¢ä¸ºåˆ—è¡¨ä¾¿äºåç»­ä½¿ç”¨</span></span><br><span class="line"><span class="comment"># å®é™…ä½¿ç”¨ï¼šè®¡ç®—ç¿»å€åçš„æ€»å’Œ</span></span><br><span class="line">double_sum = <span class="built_in">sum</span>(double_list)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;å…ƒç´ ç¿»å€åˆ—è¡¨ï¼š<span class="subst">&#123;double_list&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼š[2, 4, 6, 8, 10]</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ç¿»å€åæ€»å’Œï¼š<span class="subst">&#123;double_sum&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼š30</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŸºç¡€ç”¨æ³•2ï¼šå¤šä¸ªå¯è¿­ä»£å¯¹è±¡ï¼ˆä¸¤åˆ—è¡¨å…ƒç´ å¯¹åº”ç›¸åŠ ï¼Œåç»­ç”¨äºç­›é€‰å¤§äº30çš„ç»“æœï¼‰</span></span><br><span class="line">list1 = [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>]</span><br><span class="line">list2 = [<span class="number">5</span>, <span class="number">15</span>, <span class="number">25</span>]  <span class="comment"># é•¿åº¦è¾ƒçŸ­ï¼Œä»¥è¯¥åˆ—è¡¨ä¸ºå‡†åœæ­¢</span></span><br><span class="line">sum_list = <span class="built_in">map</span>(<span class="keyword">lambda</span> x, y: x + y, list1, list2)</span><br><span class="line">sum_result = <span class="built_in">list</span>(sum_list)</span><br><span class="line"><span class="comment"># å®é™…ä½¿ç”¨ï¼šç­›é€‰ç›¸åŠ ç»“æœå¤§äº30çš„æ•°æ®</span></span><br><span class="line">filtered_sum = [num <span class="keyword">for</span> num <span class="keyword">in</span> sum_result <span class="keyword">if</span> num &gt; <span class="number">30</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ä¸¤åˆ—è¡¨å¯¹åº”ç›¸åŠ ç»“æœï¼š<span class="subst">&#123;sum_result&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼š[15, 35, 55]</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ç›¸åŠ ç»“æœä¸­å¤§äº30çš„æ•°ï¼š<span class="subst">&#123;filtered_sum&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼š[35, 55]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›é˜¶ç”¨æ³•ï¼šå†…ç½®å‡½æ•°ä½œä¸ºæ˜ å°„å‡½æ•°ï¼ˆå­—ç¬¦ä¸²è½¬æ•´æ•°ï¼Œåç»­ç”¨äºæ±‚å¹³å‡å€¼ï¼‰</span></span><br><span class="line">str_nums = [<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>, <span class="string">&quot;4&quot;</span>, <span class="string">&quot;5&quot;</span>]</span><br><span class="line">int_nums = <span class="built_in">map</span>(<span class="built_in">int</span>, str_nums)</span><br><span class="line">int_list = <span class="built_in">list</span>(int_nums)</span><br><span class="line"><span class="comment"># å®é™…ä½¿ç”¨ï¼šè®¡ç®—è½¬æ¢åçš„æ•´æ•°å¹³å‡å€¼</span></span><br><span class="line">average = <span class="built_in">sum</span>(int_list) / <span class="built_in">len</span>(int_list)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;å­—ç¬¦ä¸²è½¬æ•´æ•°åˆ—è¡¨ï¼š<span class="subst">&#123;int_list&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼š[1, 2, 3, 4, 5]</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æ•´æ•°åˆ—è¡¨çš„å¹³å‡å€¼ï¼š<span class="subst">&#123;average&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼š3.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›é˜¶ç”¨æ³•ï¼šè‡ªå®šä¹‰å‡½æ•°å®ç°å¤šå…ƒç´ è½¬æ¢ï¼ˆæ ¼å¼åŒ–ç”¨æˆ·ä¿¡æ¯ï¼Œåç»­ç”¨äºç”Ÿæˆç”¨æˆ·åˆ—è¡¨ï¼‰</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">format_user</span>(<span class="params">name, age</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;å§“åï¼š<span class="subst">&#123;name&#125;</span>ï¼Œå¹´é¾„ï¼š<span class="subst">&#123;age&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">names = [<span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="string">&quot;æå››&quot;</span>, <span class="string">&quot;ç‹äº”&quot;</span>]</span><br><span class="line">ages = [<span class="number">25</span>, <span class="number">30</span>, <span class="number">28</span>]</span><br><span class="line">formatted_users = <span class="built_in">map</span>(format_user, names, ages)</span><br><span class="line">formatted_list = <span class="built_in">list</span>(formatted_users)</span><br><span class="line"><span class="comment"># å®é™…ä½¿ç”¨ï¼šå°†æ ¼å¼åŒ–åçš„ç”¨æˆ·ä¿¡æ¯å†™å…¥æ¨¡æ‹Ÿæ–‡ä»¶</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;user_info.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> user <span class="keyword">in</span> formatted_list:</span><br><span class="line">        f.write(user + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æ ¼å¼åŒ–ç”¨æˆ·ä¿¡æ¯åˆ—è¡¨ï¼š<span class="subst">&#123;formatted_list&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼š[&#x27;å§“åï¼šå¼ ä¸‰ï¼Œå¹´é¾„ï¼š25&#x27;, &#x27;å§“åï¼šæå››ï¼Œå¹´é¾„ï¼š30&#x27;, &#x27;å§“åï¼šç‹äº”ï¼Œå¹´é¾„ï¼š28&#x27;]</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;ç”¨æˆ·ä¿¡æ¯å·²å†™å…¥ user_info.txt æ–‡ä»¶&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ8ï¼‰reduce-ï¼šç´¯ç§¯è®¡ç®—">ï¼ˆ8ï¼‰reduce()ï¼šç´¯ç§¯è®¡ç®—</h3>
<ul>
<li><strong>å®šä¹‰</strong>ï¼š
<ul>
<li>æ¥æ”¶ä¸€ä¸ªâ€œç´¯ç§¯å‡½æ•°â€å’Œä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œä»å·¦åˆ°å³éå†å¯è¿­ä»£å¯¹è±¡ï¼Œå°†å‰ä¸¤ä¸ªå…ƒç´ çš„è®¡ç®—ç»“æœä¸ä¸‹ä¸€ä¸ªå…ƒç´ ç»§ç»­ç´¯ç§¯ï¼Œæœ€ç»ˆè¿”å›â€œå•ä¸ªç´¯ç§¯ç»“æœâ€ï¼ˆéè¿­ä»£å™¨ï¼‰ï¼›</li>
</ul>
</li>
<li><strong>è¯­æ³•</strong>ï¼š
<ul>
<li>reduce(func, iterable[, initial])</li>
<li>éœ€ä» functools æ¨¡å—å¯¼å…¥</li>
</ul>
</li>
<li><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼š
<ul>
<li>å¿…é¡»å¯¼å…¥ï¼š
<ul>
<li>reduce() ä¸åœ¨ Python å†…ç½®å‡½æ•°ä¸­ï¼Œéœ€é€šè¿‡ <strong>from functools import reduce</strong> å¯¼å…¥ï¼›</li>
</ul>
</li>
<li>initial å‚æ•°ï¼ˆå¯é€‰ï¼‰ï¼š
<ul>
<li>ä¸ºç´¯ç§¯è®¡ç®—è®¾ç½®åˆå§‹å€¼ï¼ˆåˆå§‹å€¼å°†å‚ä¸ç¬¬ä¸€æ¬¡è®¡ç®—ï¼Œå¦‚ initial=10 æ—¶ï¼Œå…ˆè®¡ç®— 10+ç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰ï¼›</li>
</ul>
</li>
<li>ç´¯ç§¯å‡½æ•°è¦æ±‚ï¼š
<ul>
<li>å¿…é¡»æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼ˆå‰ä¸€æ¬¡ç´¯ç§¯ç»“æœå’Œå½“å‰å…ƒç´ ï¼‰ï¼Œè¿”å›æ–°çš„ç´¯ç§¯ç»“æœã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŸºç¡€ç”¨æ³•1ï¼šç´¯ç§¯æ±‚å’Œ</span></span><br><span class="line">nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">sum_result = reduce(<span class="keyword">lambda</span> x, y: x + y, nums)</span><br><span class="line"><span class="built_in">print</span>(sum_result)  <span class="comment"># è¾“å‡ºï¼š15ï¼ˆè®¡ç®—è¿‡ç¨‹ï¼š((((1+2)+3)+4)+5)ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŸºç¡€ç”¨æ³•2ï¼šç´¯ç§¯æ±‚ç§¯</span></span><br><span class="line">product_result = reduce(<span class="keyword">lambda</span> x, y: x * y, nums)</span><br><span class="line"><span class="built_in">print</span>(product_result)  <span class="comment"># è¾“å‡ºï¼š120ï¼ˆè®¡ç®—è¿‡ç¨‹ï¼š((((1*2)*3)*4)*5)ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›é˜¶ç”¨æ³•ï¼šè®¾ç½®åˆå§‹å€¼ï¼ˆåˆå§‹å€¼å‚ä¸ç¬¬ä¸€æ¬¡è®¡ç®—ï¼‰</span></span><br><span class="line">sum_with_init = reduce(<span class="keyword">lambda</span> x, y: x + y, nums, <span class="number">10</span>)  <span class="comment"># åˆå§‹å€¼10</span></span><br><span class="line"><span class="built_in">print</span>(sum_with_init)  <span class="comment"># è¾“å‡ºï¼š25ï¼ˆè®¡ç®—è¿‡ç¨‹ï¼š(((((10+1)+2)+3)+4)+5)ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›é˜¶ç”¨æ³•ï¼šè‡ªå®šä¹‰ç´¯ç§¯å‡½æ•°ï¼ˆæ‹¼æ¥å­—ç¬¦ä¸²ï¼‰</span></span><br><span class="line">strs = [<span class="string">&quot;Hello&quot;</span>, <span class="string">&quot; &quot;</span>, <span class="string">&quot;Python&quot;</span>, <span class="string">&quot; &quot;</span>, <span class="string">&quot;World&quot;</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">concat_str</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line">final_str = reduce(concat_str, strs)</span><br><span class="line"><span class="built_in">print</span>(final_str)  <span class="comment"># è¾“å‡ºï¼šHello Python World</span></span><br></pre></td></tr></table></figure>
<h1>ä¹ã€ç±»</h1>
<h2 id="1-ç±»çš„åŸºç¡€æ¦‚å¿µå’Œå®šä¹‰">1.ç±»çš„åŸºç¡€æ¦‚å¿µå’Œå®šä¹‰</h2>
<h3 id="ï¼ˆ1ï¼‰æ ¸å¿ƒæ¦‚å¿µ">ï¼ˆ1ï¼‰æ ¸å¿ƒæ¦‚å¿µ</h3>
<ul>
<li><strong>ç±»ï¼ˆclassï¼‰</strong>ï¼šæ˜¯å¯¹ä¸€ç±»å…·æœ‰ç›¸åŒå±æ€§å’Œæ–¹æ³•çš„å¯¹è±¡çš„æŠ½è±¡æè¿°ï¼Œç›¸å½“äºä¸€ä¸ªâ€œæ¨¡æ¿â€ã€‚
<ul>
<li>ä¾‹å¦‚ï¼Œâ€œåŠ¨ç‰©â€ç±»å¯ä»¥æŠ½è±¡å‡ºæ‰€æœ‰åŠ¨ç‰©å…±æœ‰çš„å±æ€§ï¼ˆå¦‚åå­—ã€å¹´é¾„ï¼‰å’Œæ–¹æ³•ï¼ˆå¦‚è¿›é£Ÿã€ç§»åŠ¨ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>å¯¹è±¡ï¼ˆobjectï¼‰</strong>ï¼šæ˜¯ç±»çš„å®ä¾‹åŒ–ç»“æœï¼Œæ˜¯å…·ä½“çš„å®ä½“ã€‚
<ul>
<li>ä¾‹å¦‚ï¼Œâ€œä¸€åªåå«æ—ºè´¢çš„ç‹—â€æ˜¯â€œåŠ¨ç‰©â€ç±»çš„ä¸€ä¸ªå¯¹è±¡ï¼Œå…·å¤‡å…·ä½“çš„åå­—ï¼ˆæ—ºè´¢ï¼‰å’Œå¹´é¾„ï¼ˆ3å²ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>é¢å‘å¯¹è±¡ä¸‰å¤§ç‰¹å¾</strong>ï¼šå°è£…ã€ç»§æ‰¿ã€å¤šæ€ï¼Œæ˜¯ç±»è®¾è®¡çš„æ ¸å¿ƒæ€æƒ³ã€‚</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰ç±»çš„å®šä¹‰è¯­æ³•">ï¼ˆ2ï¼‰ç±»çš„å®šä¹‰è¯­æ³•</h3>
<p>ä½¿ç”¨ <strong>class</strong> å…³é”®å­—å®šä¹‰ç±»ï¼ŒåŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŸºç¡€ç±»å®šä¹‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ç±»å</span>(<span class="title class_ inherited__">çˆ¶ç±»åˆ—è¡¨</span>):  <span class="comment"># çˆ¶ç±»åˆ—è¡¨å¯é€‰ï¼Œé»˜è®¤ç»§æ‰¿objectï¼ˆPython3ä¸­æ‰€æœ‰ç±»çš„åŸºç±»ï¼‰</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;ç±»çš„æ–‡æ¡£å­—ç¬¦ä¸²ï¼ˆç”¨äºè¯´æ˜ç±»çš„åŠŸèƒ½ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># ç±»å±æ€§ï¼ˆå±äºç±»æœ¬èº«ï¼Œæ‰€æœ‰å®ä¾‹å…±äº«ï¼‰</span></span><br><span class="line">    ç±»å±æ€§å = å±æ€§å€¼</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ„é€ æ–¹æ³•ï¼ˆåˆå§‹åŒ–å®ä¾‹å±æ€§ï¼‰</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, å‚æ•°åˆ—è¡¨</span>):</span><br><span class="line">        <span class="comment"># å®ä¾‹å±æ€§ï¼ˆå±äºå•ä¸ªå®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹ç‹¬ç«‹ï¼‰</span></span><br><span class="line">        <span class="variable language_">self</span>.å®ä¾‹å±æ€§å = å‚æ•°å€¼</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ç±»çš„æ–¹æ³•ï¼ˆç”¨äºæ“ä½œå±æ€§ã€å®ç°åŠŸèƒ½ï¼‰</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">æ–¹æ³•å</span>(<span class="params">self, å‚æ•°åˆ—è¡¨</span>):</span><br><span class="line">        æ–¹æ³•ä½“</span><br><span class="line">        <span class="keyword">return</span> è¿”å›å€¼</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®ä¾‹åŒ–å¯¹è±¡ï¼ˆåˆ›å»ºç±»çš„å…·ä½“å®ä½“ï¼‰</span></span><br><span class="line">å¯¹è±¡å = ç±»å(å‚æ•°åˆ—è¡¨)  <span class="comment"># å‚æ•°åˆ—è¡¨å¯¹åº”__init__æ–¹æ³•çš„å‚æ•°ï¼ˆé™¤selfå¤–ï¼‰</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰Animalç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;åŠ¨ç‰©ç±»ï¼Œå°è£…åŠ¨ç‰©çš„åŸºæœ¬å±æ€§å’Œè¡Œä¸º&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># ç±»å±æ€§ï¼šæ‰€æœ‰åŠ¨ç‰©å…±æœ‰çš„å±æ€§ï¼ˆå¦‚æ‰€å±ç•Œåˆ«ï¼‰</span></span><br><span class="line">    kingdom = <span class="string">&quot;åŠ¨ç‰©ç•Œ&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ„é€ æ–¹æ³•ï¼šåˆå§‹åŒ–å®ä¾‹å±æ€§ï¼ˆåå­—ã€å¹´é¾„ï¼‰</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="comment"># selfï¼šå¿…é¡»ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒæŒ‡ä»£å½“å‰å®ä¾‹æœ¬èº«</span></span><br><span class="line">        <span class="variable language_">self</span>.name = name  <span class="comment"># å®ä¾‹å±æ€§ï¼šåå­—</span></span><br><span class="line">        <span class="variable language_">self</span>.age = age    <span class="comment"># å®ä¾‹å±æ€§ï¼šå¹´é¾„</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å®ä¾‹æ–¹æ³•ï¼šåŠ¨ç‰©çš„è¡Œä¸ºï¼ˆè¿›é£Ÿï¼‰</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">eat</span>(<span class="params">self, food</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span>ï¼ˆ<span class="subst">&#123;self.age&#125;</span>å²ï¼‰æ­£åœ¨åƒ<span class="subst">&#123;food&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å®ä¾‹æ–¹æ³•ï¼šåŠ¨ç‰©çš„è¡Œä¸ºï¼ˆç§»åŠ¨ï¼‰</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">move</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span>æ­£åœ¨ç§»åŠ¨&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. å®ä¾‹åŒ–å¯¹è±¡ï¼ˆåˆ›å»ºå…·ä½“çš„åŠ¨ç‰©ï¼‰</span></span><br><span class="line">dog = Animal(<span class="string">&quot;æ—ºè´¢&quot;</span>, <span class="number">3</span>)  <span class="comment"># dogæ˜¯Animalç±»çš„ä¸€ä¸ªå®ä¾‹</span></span><br><span class="line">cat = Animal(<span class="string">&quot;å’ªå®&quot;</span>, <span class="number">2</span>)  <span class="comment"># catæ˜¯å¦ä¸€ä¸ªå®ä¾‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. è®¿é—®ç±»å±æ€§ï¼ˆæ‰€æœ‰å®ä¾‹å…±äº«ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(Animal.kingdom)  <span class="comment"># è¾“å‡ºï¼šåŠ¨ç‰©ç•Œ</span></span><br><span class="line"><span class="built_in">print</span>(dog.kingdom)     <span class="comment"># è¾“å‡ºï¼šåŠ¨ç‰©ç•Œï¼ˆå®ä¾‹å¯è®¿é—®ç±»å±æ€§ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(cat.kingdom)     <span class="comment"># è¾“å‡ºï¼šåŠ¨ç‰©ç•Œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. è®¿é—®å®ä¾‹å±æ€§ï¼ˆæ¯ä¸ªå®ä¾‹ç‹¬ç«‹ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(dog.name)  <span class="comment"># è¾“å‡ºï¼šæ—ºè´¢</span></span><br><span class="line"><span class="built_in">print</span>(cat.name)  <span class="comment"># è¾“å‡ºï¼šå’ªå®</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. è°ƒç”¨å®ä¾‹æ–¹æ³•</span></span><br><span class="line">dog.eat(<span class="string">&quot;éª¨å¤´&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šæ—ºè´¢ï¼ˆ3å²ï¼‰æ­£åœ¨åƒéª¨å¤´</span></span><br><span class="line">cat.move()       <span class="comment"># è¾“å‡ºï¼šå’ªå®æ­£åœ¨ç§»åŠ¨</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰-init-ï¼šæ ¸å¿ƒæ„é€ æ–¹æ³•">ï¼ˆ3ï¼‰__init__ï¼šæ ¸å¿ƒæ„é€ æ–¹æ³•</h3>
<p>__init__æ˜¯Pythonç±»ä¸­æœ€æ ¸å¿ƒçš„é­”æœ¯æ–¹æ³•ï¼ˆç‰¹æ®Šæ–¹æ³•ï¼‰ä¹‹ä¸€ï¼Œä¸“é—¨ç”¨äº<strong>åœ¨å®ä¾‹åŒ–å¯¹è±¡æ—¶å®Œæˆå®ä¾‹å±æ€§çš„åˆå§‹åŒ–</strong>ï¼Œç›¸å½“äºå¯¹è±¡çš„â€œå‡ºç”Ÿåˆå§‹åŒ–å™¨â€ã€‚å®ƒæ˜¯è¿æ¥ç±»æ¨¡æ¿ä¸å…·ä½“å¯¹è±¡çš„å…³é”®æ¡¥æ¢ï¼Œå†³å®šäº†å¯¹è±¡åˆ›å»ºæ—¶å¿…é¡»å…·å¤‡çš„åˆå§‹çŠ¶æ€ã€‚</p>
<h4 id="1-æ ¸å¿ƒç‰¹å¾">&lt;1&gt;æ ¸å¿ƒç‰¹å¾</h4>
<ul>
<li><strong>è‡ªåŠ¨è§¦å‘æ‰§è¡Œ</strong>ï¼š
<ul>
<li>ä»…åœ¨é€šè¿‡ <strong>ç±»å()</strong> è¿›è¡Œå®ä¾‹åŒ–æ—¶<strong>è‡ªåŠ¨è°ƒç”¨</strong>ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨ã€‚</li>
<li>ä¾‹å¦‚ï¼šæ‰§è¡Œdog = Animal(â€œæ—ºè´¢â€, 3)æ—¶ï¼ŒPythonä¼šè‡ªåŠ¨è§¦å‘Animal.<strong>init</strong>(dog, â€œæ—ºè´¢â€, 3)çš„æ‰§è¡Œã€‚</li>
</ul>
</li>
<li><strong>å¼ºåˆ¶é¦–ä¸ªå‚æ•°ä¸ºself</strong>
<ul>
<li><strong>self</strong>æ˜¯Pythonçš„å†…ç½®çº¦å®šï¼Œç”¨äº<strong>æŒ‡ä»£</strong>å½“å‰æ­£åœ¨åˆ›å»ºçš„<strong>å®ä¾‹å¯¹è±¡æœ¬èº«</strong>ã€‚</li>
<li>Pythonä¼šè‡ªåŠ¨å°†æ–°åˆ›å»ºçš„å®ä¾‹ä½œä¸ºå‚æ•°ä¼ é€’ç»™selfï¼Œå¼€å‘è€…æ— éœ€æ‰‹åŠ¨ä¼ å…¥ã€‚</li>
</ul>
</li>
<li><strong>æ— é»˜è®¤è¿”å›å€¼</strong>ï¼š
<ul>
<li>__init__æ–¹æ³•çš„<strong>è¿”å›å€¼å¿…é¡»æ˜¯None</strong>ï¼Œä¸èƒ½è¿”å›ä»»ä½•å…¶ä»–æ•°æ®ç±»å‹ï¼ˆå¦åˆ™ä¼šç›´æ¥æŠ›å‡ºTypeErrorå¼‚å¸¸ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>å®ä¾‹å±æ€§çš„è½½ä½“</strong>ï¼š
<ul>
<li><strong>é€šè¿‡self.å±æ€§å = å€¼çš„è¯­æ³•ï¼Œå°†æ•°æ®ç»‘å®šåˆ°å½“å‰å®ä¾‹ä¸Š</strong>ï¼Œè¿™äº›å±æ€§ä¼šæˆä¸ºå®ä¾‹çš„<strong>ä¸“å±æ•°æ®</strong>ï¼Œå®ç°ä¸åŒå®ä¾‹é—´çš„<strong>æ•°æ®éš”ç¦»</strong>ã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ç±»å</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, å‚æ•°<span class="number">1</span>, å‚æ•°<span class="number">2</span>, ...</span>):</span><br><span class="line">        <span class="comment"># åˆå§‹åŒ–å®ä¾‹å±æ€§</span></span><br><span class="line">        <span class="variable language_">self</span>.å±æ€§<span class="number">1</span> = å‚æ•°<span class="number">1</span></span><br><span class="line">        <span class="variable language_">self</span>.å±æ€§<span class="number">2</span> = å‚æ•°<span class="number">2</span></span><br><span class="line">        <span class="comment"># å¯å®šä¹‰é»˜è®¤å±æ€§ï¼ˆæ— éœ€å¤–éƒ¨ä¼ å…¥ï¼‰</span></span><br><span class="line">        <span class="variable language_">self</span>.å±æ€§<span class="number">3</span> = é»˜è®¤å€¼</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®ä¾‹åŒ–æ—¶ä¼ å…¥å‚æ•°ï¼ˆåŒ¹é…__init__é™¤selfå¤–çš„å‚æ•°ï¼‰</span></span><br><span class="line">å¯¹è±¡ = ç±»å(å‚æ•°<span class="number">1</span>, å‚æ•°<span class="number">2</span>, ...)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰Personç±»ï¼Œé€šè¿‡__init__åˆå§‹åŒ–å§“åå’Œå¹´é¾„å±æ€§</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="comment"># å°†å¤–éƒ¨ä¼ å…¥çš„nameç»‘å®šä¸ºå®ä¾‹å±æ€§self.name</span></span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="comment"># å°†å¤–éƒ¨ä¼ å…¥çš„ageç»‘å®šä¸ºå®ä¾‹å±æ€§self.age</span></span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line">        <span class="comment"># å®šä¹‰é»˜è®¤å®ä¾‹å±æ€§ï¼ˆæ— éœ€å¤–éƒ¨ä¼ å…¥ï¼‰</span></span><br><span class="line">        <span class="variable language_">self</span>.gender = <span class="string">&quot;æœªçŸ¥&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®ä¾‹åŒ–å¯¹è±¡ï¼šä¼ å…¥nameå’Œageå‚æ•°ï¼Œ__init__è‡ªåŠ¨æ‰§è¡Œ</span></span><br><span class="line">p1 = Person(<span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="number">18</span>)</span><br><span class="line">p2 = Person(<span class="string">&quot;æå››&quot;</span>, <span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¿é—®å®ä¾‹å±æ€§ï¼ˆæ¯ä¸ªå®ä¾‹çš„å±æ€§ç‹¬ç«‹ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(p1.name, p1.age, p1.gender)  <span class="comment"># è¾“å‡ºï¼šå¼ ä¸‰ 18 æœªçŸ¥</span></span><br><span class="line"><span class="built_in">print</span>(p2.name, p2.age, p2.gender)  <span class="comment"># è¾“å‡ºï¼šæå›› 20 æœªçŸ¥</span></span><br></pre></td></tr></table></figure>
<h4 id="2-init-æ–¹æ³•çš„é«˜çº§ç”¨æ³•">&lt;2&gt;__init__æ–¹æ³•çš„é«˜çº§ç”¨æ³•</h4>
<h5 id="1ï¼‰å‚æ•°é»˜è®¤å€¼ï¼šæå‡åˆå§‹åŒ–çµæ´»æ€§">1ï¼‰å‚æ•°é»˜è®¤å€¼ï¼šæå‡åˆå§‹åŒ–çµæ´»æ€§</h5>
<p>å¯ä»¥ä¸º__init__çš„å‚æ•°è®¾ç½®é»˜è®¤å€¼ï¼Œå®ä¾‹åŒ–æ—¶å¯çœç•¥è¿™äº›å‚æ•°ï¼Œä½¿ç”¨é»˜è®¤å€¼åˆå§‹åŒ–å±æ€§ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age=<span class="number">18</span>, score=<span class="number">60</span></span>):</span><br><span class="line">        <span class="comment"># ageé»˜è®¤å€¼18ï¼Œscoreé»˜è®¤å€¼60</span></span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line">        <span class="variable language_">self</span>.score = score</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®ä¾‹åŒ–æ—¶ä¼ å…¥ä¸åŒæ•°é‡çš„å‚æ•°</span></span><br><span class="line">s1 = Student(<span class="string">&quot;ç‹äº”&quot;</span>)  <span class="comment"># ä»…ä¼ nameï¼Œageå’Œscoreç”¨é»˜è®¤å€¼</span></span><br><span class="line">s2 = Student(<span class="string">&quot;èµµå…­&quot;</span>, <span class="number">19</span>)  <span class="comment"># ä¼ nameå’Œageï¼Œscoreç”¨é»˜è®¤å€¼</span></span><br><span class="line">s3 = Student(<span class="string">&quot;å­™ä¸ƒ&quot;</span>, <span class="number">20</span>, <span class="number">95</span>)  <span class="comment"># ä¼ æ‰€æœ‰å‚æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(s1.age, s1.score)  <span class="comment"># è¾“å‡ºï¼š18 60</span></span><br><span class="line"><span class="built_in">print</span>(s2.age, s2.score)  <span class="comment"># è¾“å‡ºï¼š19 60</span></span><br><span class="line"><span class="built_in">print</span>(s3.age, s3.score)  <span class="comment"># è¾“å‡ºï¼š20 95</span></span><br></pre></td></tr></table></figure>
<h5 id="2ï¼‰å¯å˜å‚æ•°ï¼šæ”¯æŒåŠ¨æ€ä¼ å…¥å¤šä¸ªå±æ€§">2ï¼‰å¯å˜å‚æ•°ï¼šæ”¯æŒåŠ¨æ€ä¼ å…¥å¤šä¸ªå±æ€§</h5>
<p>é€šè¿‡*argsï¼ˆå¯å˜ä½ç½®å‚æ•°ï¼‰å’Œ**kwargsï¼ˆå¯å˜å…³é”®å­—å‚æ•°ï¼‰ï¼Œè®©__init__æ”¯æŒåŠ¨æ€ä¼ å…¥ä»»æ„æ•°é‡çš„å‚æ•°ï¼Œé€‚é…æ›´å¤æ‚çš„åˆå§‹åŒ–åœºæ™¯ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Product</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, price, *args, **kwargs</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.price = price</span><br><span class="line">        <span class="comment"># å¤„ç†å¯å˜ä½ç½®å‚æ•°ï¼ˆå¦‚å•†å“æ ‡ç­¾ï¼‰</span></span><br><span class="line">        <span class="variable language_">self</span>.tags = args</span><br><span class="line">        <span class="comment"># å¤„ç†å¯å˜å…³é”®å­—å‚æ•°ï¼ˆå¦‚äº§åœ°ã€ä¿è´¨æœŸç­‰é¢å¤–å±æ€§ï¼‰</span></span><br><span class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> kwargs.items():</span><br><span class="line">            <span class="built_in">setattr</span>(<span class="variable language_">self</span>, key, value)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®ä¾‹åŒ–æ—¶ä¼ å…¥å›ºå®šå‚æ•°ã€å¯å˜ä½ç½®å‚æ•°ã€å¯å˜å…³é”®å­—å‚æ•°</span></span><br><span class="line">p = Product(<span class="string">&quot;æ‰‹æœº&quot;</span>, <span class="number">2999</span>, <span class="string">&quot;ç”µå­äº§å“&quot;</span>, <span class="string">&quot;æ™ºèƒ½&quot;</span>, origin=<span class="string">&quot;ä¸­å›½&quot;</span>, shelf_life=<span class="string">&quot;2å¹´&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(p.name, p.price)  <span class="comment"># è¾“å‡ºï¼šæ‰‹æœº 2999</span></span><br><span class="line"><span class="built_in">print</span>(p.tags)  <span class="comment"># è¾“å‡ºï¼š(&#x27;ç”µå­äº§å“&#x27;, &#x27;æ™ºèƒ½&#x27;)</span></span><br><span class="line"><span class="built_in">print</span>(p.origin, p.shelf_life)  <span class="comment"># è¾“å‡ºï¼šä¸­å›½ 2å¹´</span></span><br></pre></td></tr></table></figure>
<p><strong>è¡¥å……</strong>ï¼š</p>
<ul>
<li>setattr() æ˜¯ Python å†…ç½®å‡½æ•°ï¼Œä½œç”¨æ˜¯<strong>åŠ¨æ€</strong>ç»™å¯¹è±¡ï¼ˆç±»å®ä¾‹ / ç±»æœ¬èº«ï¼‰è®¾ç½®å±æ€§</li>
<li>è¯­æ³•ï¼š setattr(å¯¹è±¡, å±æ€§å, å±æ€§å€¼)
<ul>
<li>ç­‰ä»·äº <strong>å¯¹è±¡.å±æ€§å = å±æ€§å€¼</strong>ï¼Œä½†æ”¯æŒåŠ¨æ€ä¼ å…¥å±æ€§åå­—ç¬¦ä¸²ï¼ˆçµæ´»åº¦æ›´é«˜ï¼‰</li>
<li><strong>å±æ€§ä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œå­˜åœ¨åˆ™è¦†ç›–åŸæœ‰å€¼</strong></li>
</ul>
</li>
</ul>
<h2 id="2-ç±»çš„å±æ€§">2.ç±»çš„å±æ€§</h2>
<p>å±æ€§åˆ†ä¸º <strong>ã€Œç±»å±æ€§ã€</strong> å’Œ <strong>ã€Œå®ä¾‹å±æ€§ã€</strong> ï¼Œæ ¸å¿ƒåŒºåˆ«åœ¨äº<strong>ä½œç”¨åŸŸï¼ˆæ˜¯å¦å…±äº«ï¼‰</strong>ã€‚</p>
<h3 id="ï¼ˆ1ï¼‰ç±»å±æ€§">ï¼ˆ1ï¼‰ç±»å±æ€§</h3>
<ul>
<li><strong>å®šä¹‰ä½ç½®</strong>ï¼šåœ¨ç±»ä½“ä¸­ã€æ‰€æœ‰æ–¹æ³•ä¹‹å¤–ã€‚</li>
<li><strong>ä½œç”¨åŸŸ</strong>ï¼šå±äºç±»æœ¬èº«ï¼Œæ‰€æœ‰å®ä¾‹<strong>å…±äº«</strong>è¯¥å±æ€§ï¼Œä¿®æ”¹ç±»å±æ€§ä¼šå½±å“æ‰€æœ‰å®ä¾‹ã€‚</li>
<li><strong>è®¿é—®æ–¹å¼</strong>ï¼š
<ul>
<li><strong>ç±»å.ç±»å±æ€§åï¼ˆæ¨èï¼‰</strong></li>
<li>å®ä¾‹å.ç±»å±æ€§åï¼ˆä¸æ¨èï¼Œæ˜“æ··æ·†å®ä¾‹å±æ€§ï¼‰</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>:</span><br><span class="line">    <span class="comment"># ç±»å±æ€§ï¼šæ‰€æœ‰å­¦ç”Ÿå…±äº«çš„å­¦æ ¡åç§°</span></span><br><span class="line">    school = <span class="string">&quot;åŒ—äº¬å¤§å­¦&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name  <span class="comment"># å®ä¾‹å±æ€§ï¼šå­¦ç”Ÿå§“å</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¿é—®ç±»å±æ€§</span></span><br><span class="line"><span class="built_in">print</span>(Student.school)  <span class="comment"># è¾“å‡ºï¼šåŒ—äº¬å¤§å­¦</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤šä¸ªå®ä¾‹å…±äº«ç±»å±æ€§</span></span><br><span class="line">stu1 = Student(<span class="string">&quot;å¼ ä¸‰&quot;</span>)</span><br><span class="line">stu2 = Student(<span class="string">&quot;æå››&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(stu1.school)  <span class="comment"># è¾“å‡ºï¼šåŒ—äº¬å¤§å­¦</span></span><br><span class="line"><span class="built_in">print</span>(stu2.school)  <span class="comment"># è¾“å‡ºï¼šåŒ—äº¬å¤§å­¦</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹ç±»å±æ€§ï¼ˆå½±å“æ‰€æœ‰å®ä¾‹ï¼‰</span></span><br><span class="line">Student.school = <span class="string">&quot;æ¸…åå¤§å­¦&quot;</span></span><br><span class="line"><span class="built_in">print</span>(stu1.school)  <span class="comment"># è¾“å‡ºï¼šæ¸…åå¤§å­¦</span></span><br><span class="line"><span class="built_in">print</span>(stu2.school)  <span class="comment"># è¾“å‡ºï¼šæ¸…åå¤§å­¦</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šå®ä¾‹ä¸èƒ½ç›´æ¥ä¿®æ”¹ç±»å±æ€§ï¼ˆä¼šåˆ›å»ºåŒåå®ä¾‹å±æ€§è¦†ç›–ç±»å±æ€§ï¼‰</span></span><br><span class="line">stu1.school = <span class="string">&quot;å¤æ—¦å¤§å­¦&quot;</span></span><br><span class="line"><span class="built_in">print</span>(stu1.school)  <span class="comment"># è¾“å‡ºï¼šå¤æ—¦å¤§å­¦ï¼ˆå®ä¾‹å±æ€§è¦†ç›–ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(stu2.school)  <span class="comment"># è¾“å‡ºï¼šæ¸…åå¤§å­¦ï¼ˆç±»å±æ€§æœªå˜ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(Student.school)  <span class="comment"># è¾“å‡ºï¼šæ¸…åå¤§å­¦ï¼ˆç±»å±æ€§æœªå˜ï¼‰</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="è¡¥å……ï¼šç±»å±æ€§å¿…é¡»åœ¨ç±»ä½“ä¸­å®šä¹‰æ—¶å°±èµ‹å€¼ï¼ˆå“ªæ€•èµ‹-Noneï¼‰">è¡¥å……ï¼šç±»å±æ€§å¿…é¡»åœ¨ç±»ä½“ä¸­å®šä¹‰æ—¶å°±èµ‹å€¼ï¼ˆå“ªæ€•èµ‹ Noneï¼‰</h4>
<ul>
<li><strong>åŸå› </strong>ï¼šç±»å±æ€§çš„æ ¸å¿ƒæ˜¯ â€œèµ‹å€¼â€ï¼Œä»…å†™å±æ€§åæ²¡æœ‰èµ‹å€¼ï¼ŒPython ä¸ä¼šå°†å…¶æ³¨å†Œä¸ºç±»çš„å±æ€§ï¼Œè‡ªç„¶æ— æ³•è®¿é—®ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1.é”™è¯¯ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>:</span><br><span class="line">    school  <span class="comment"># âŒ ç©ºå£°æ˜ï¼Œä¸æ˜¯æœ‰æ•ˆç±»å±æ€§ï¼ˆæ— èµ‹å€¼ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.æ­£ç¡®ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>:</span><br><span class="line">    school=<span class="string">&quot;åŒ—äº¬å¤§å­¦&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.ç±»å±æ€§çš„ â€œå»¶è¿Ÿèµ‹å€¼â€ï¼ˆç‰¹æ®Šåœºæ™¯ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>:</span><br><span class="line">    <span class="comment"># å…ˆå£°æ˜ç±»å±æ€§ï¼ˆæ— åˆå§‹å€¼ï¼‰ï¼Œåç»­èµ‹å€¼</span></span><br><span class="line">    school = <span class="literal">None</span>  <span class="comment"># å…ˆèµ‹ç©ºå€¼ï¼Œé¿å…ç©ºå£°æ˜</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># åç»­ç»™ç±»å±æ€§èµ‹å€¼ï¼ˆä»æ— éœ€__init__ï¼‰</span></span><br><span class="line">Student.school = <span class="string">&quot;å¤æ—¦å¤§å­¦&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(Student.school)  <span class="comment"># è¾“å‡ºï¼šå¤æ—¦å¤§å­¦</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰å®ä¾‹å±æ€§">ï¼ˆ2ï¼‰å®ä¾‹å±æ€§</h3>
<ul>
<li><strong>å®šä¹‰ä½ç½®</strong>ï¼š
<ul>
<li>é€šå¸¸<strong>åœ¨ <strong>init</strong> æ–¹æ³•ä¸­</strong></li>
<li>é€šè¿‡ <strong>self.å±æ€§å</strong> å®šä¹‰ã€‚</li>
</ul>
</li>
<li><strong>ä½œç”¨åŸŸ</strong>ï¼š
<ul>
<li>å±äºå•ä¸ªå®ä¾‹ï¼Œ<strong>æ¯ä¸ªå®ä¾‹çš„å±æ€§ç‹¬ç«‹</strong></li>
<li>ä¿®æ”¹ä¸€ä¸ªå®ä¾‹çš„å±æ€§ä¸å½±å“å…¶ä»–å®ä¾‹ã€‚</li>
</ul>
</li>
<li><strong>è®¿é—®æ–¹å¼</strong>ï¼š
<ul>
<li><strong>å®ä¾‹å.å®ä¾‹å±æ€§å</strong></li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, height</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name      <span class="comment"># å®ä¾‹å±æ€§ï¼šå§“å</span></span><br><span class="line">        <span class="variable language_">self</span>.height = height  <span class="comment"># å®ä¾‹å±æ€§ï¼šèº«é«˜</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ–¹æ³•ä¸­è®¿é—®å®ä¾‹å±æ€§</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show_info</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;å§“åï¼š<span class="subst">&#123;self.name&#125;</span>ï¼Œèº«é«˜ï¼š<span class="subst">&#123;self.height&#125;</span>cm&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®ä¾‹1</span></span><br><span class="line">p1 = Person(<span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="number">180</span>)</span><br><span class="line"><span class="comment"># å®ä¾‹2</span></span><br><span class="line">p2 = Person(<span class="string">&quot;æå››&quot;</span>, <span class="number">175</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¿é—®å®ä¾‹å±æ€§</span></span><br><span class="line">p1.show_info()  <span class="comment"># è¾“å‡ºï¼šå§“åï¼šå¼ ä¸‰ï¼Œèº«é«˜ï¼š180cm</span></span><br><span class="line">p2.show_info()  <span class="comment"># è¾“å‡ºï¼šå§“åï¼šæå››ï¼Œèº«é«˜ï¼š175cm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹å®ä¾‹å±æ€§ï¼ˆä»…å½±å“å½“å‰å®ä¾‹ï¼‰</span></span><br><span class="line">p1.height = <span class="number">182</span></span><br><span class="line">p1.show_info()  <span class="comment"># è¾“å‡ºï¼šå§“åï¼šå¼ ä¸‰ï¼Œèº«é«˜ï¼š182cm</span></span><br><span class="line">p2.show_info()  <span class="comment"># è¾“å‡ºï¼šå§“åï¼šæå››ï¼Œèº«é«˜ï¼š175cmï¼ˆæ— å˜åŒ–ï¼‰</span></span><br></pre></td></tr></table></figure>
<p><strong>è¡¥å……</strong></p>
<ul>
<li>å®ä¾‹å±æ€§<strong>æ¨è</strong>åœ¨ <strong>init</strong> ä¸­é€šè¿‡ self.å±æ€§ = å€¼ åˆå§‹åŒ–ï¼ˆç¡®ä¿æ‰€æœ‰å®ä¾‹å…·æœ‰ä¸€è‡´çš„å±æ€§ç»“æ„ï¼‰</li>
<li>å®ä¾‹å±æ€§ä¹Ÿå¯ä»¥åœ¨å…¶ä»–æ–¹æ³•ä¸­åŠ¨æ€æ·»åŠ ï¼Œä½†<strong>ä¸æ¨è</strong>ï¼ˆä¼šå¯¼è‡´ä¸åŒå®ä¾‹å±æ€§ä¸ä¸€è‡´ï¼‰</li>
<li>å®ä¾‹å±æ€§ä¹Ÿå¯ä»¥æ˜¯ç±»ï¼Œå³<strong>ç»„åˆ</strong>ï¼Œè¯¦æƒ…è§<a href="#class-composition">ç±»çš„ç»„åˆ</a></li>
</ul>
<h3 id="ï¼ˆ3ï¼‰ç§æœ‰å±æ€§ï¼ˆéšè—å±æ€§ï¼‰">ï¼ˆ3ï¼‰ç§æœ‰å±æ€§ï¼ˆéšè—å±æ€§ï¼‰</h3>
<p>Pythonä¸­æ²¡æœ‰ä¸¥æ ¼çš„â€œç§æœ‰â€å…³é”®å­—ï¼Œé€šè¿‡å±æ€§åå‰ç¼€çš„ä¸‹åˆ’çº¿åŒºåˆ†ä¸åŒè®¿é—®æƒé™çš„å±æ€§ï¼Œä¸»è¦åˆ†ä¸º**å•ä¸‹åˆ’çº¿ _<strong>å±æ€§å’Œ</strong>åŒä¸‹åˆ’çº¿ __**å±æ€§ä¸¤ç±»ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯æ§åˆ¶å±æ€§çš„è®¿é—®èŒƒå›´ï¼Œä½“ç°å°è£…ç‰¹æ€§ã€‚</p>
<h4 id="1-å•ä¸‹åˆ’çº¿å±æ€§ï¼ˆ-attrï¼‰">&lt;1&gt;å•ä¸‹åˆ’çº¿å±æ€§ï¼ˆ_attrï¼‰</h4>
<p>å•ä¸‹åˆ’çº¿å±æ€§æ˜¯Pythonç¤¾åŒºçš„<strong>çº¦å®šä¿—æˆè§„èŒƒ</strong>ï¼Œå¹¶éè¯­æ³•çº§åˆ«çš„é™åˆ¶ï¼Œç”¨äºæ ‡è¯†â€œä¸å»ºè®®å¤–éƒ¨ç›´æ¥è®¿é—®â€çš„å±æ€§ï¼Œä½†<strong>å¤–éƒ¨ä»å¯ç›´æ¥è®¿é—®å’Œä¿®æ”¹</strong>ï¼Œä»…ä½œä¸ºå¼€å‘è€…ä¹‹é—´çš„æ²Ÿé€šä¿¡å·ï¼ˆç±»ä¼¼â€œå†…éƒ¨ä½¿ç”¨ï¼Œè°¨æ…æ“ä½œâ€çš„æé†’ï¼‰ã€‚</p>
<ul>
<li>å®šä¹‰ï¼šself._ä¿æŠ¤å±æ€§å = å±æ€§å€¼ã€‚</li>
<li>è®¿é—®ï¼šå¤–éƒ¨å¯ç›´æ¥è®¿é—®ï¼ˆå®ä¾‹å._ä¿æŠ¤å±æ€§åï¼‰ï¼Œæ— è¯­æ³•é™åˆ¶ã€‚</li>
<li>ç”¨é€”ï¼šæ ‡è®°ç±»çš„å†…éƒ¨å±æ€§ï¼Œæç¤ºå¤–éƒ¨å°½é‡é€šè¿‡ç±»æä¾›çš„å…¬å¼€æ–¹æ³•æ“ä½œï¼Œè€Œéç›´æ¥ä¿®æ”¹ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å•ä¸‹åˆ’çº¿ä¿æŠ¤å±æ€§ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name          <span class="comment"># å…¬å¼€å±æ€§</span></span><br><span class="line">        <span class="variable language_">self</span>._age = age           <span class="comment"># ä¿æŠ¤å±æ€§ï¼ˆçº¦å®šä¸å»ºè®®å¤–éƒ¨ç›´æ¥è®¿é—®ï¼‰</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å…¬å¼€æ–¹æ³•æ“ä½œä¿æŠ¤å±æ€§</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_age</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._age</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_age</span>(<span class="params">self, new_age</span>):</span><br><span class="line">        <span class="keyword">if</span> new_age &gt; <span class="number">0</span> <span class="keyword">and</span> new_age &lt; <span class="number">150</span>:</span><br><span class="line">            <span class="variable language_">self</span>._age = new_age</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;å¹´é¾„è¾“å…¥æ— æ•ˆï¼&quot;</span>)</span><br><span class="line"></span><br><span class="line">p = Person(<span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="number">18</span>)</span><br><span class="line"><span class="comment"># å¤–éƒ¨å¯ç›´æ¥è®¿é—®ä¿æŠ¤å±æ€§ï¼ˆä¸æ¨èï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(p._age)  <span class="comment"># è¾“å‡ºï¼š18</span></span><br><span class="line"><span class="comment"># å¤–éƒ¨å¯ç›´æ¥ä¿®æ”¹ä¿æŠ¤å±æ€§ï¼ˆä¸æ¨èï¼‰</span></span><br><span class="line">p._age = <span class="number">20</span></span><br><span class="line"><span class="built_in">print</span>(p._age)  <span class="comment"># è¾“å‡ºï¼š20</span></span><br><span class="line"><span class="comment"># æ¨èï¼šé€šè¿‡å…¬å¼€æ–¹æ³•æ“ä½œ</span></span><br><span class="line">p.set_age(<span class="number">25</span>)</span><br><span class="line"><span class="built_in">print</span>(p.get_age())  <span class="comment"># è¾“å‡ºï¼š25</span></span><br></pre></td></tr></table></figure>
<h4 id="2-åŒä¸‹åˆ’çº¿å±æ€§ï¼ˆ-attrï¼‰">&lt;2&gt;åŒä¸‹åˆ’çº¿å±æ€§ï¼ˆ__attrï¼‰</h4>
<p>åŒä¸‹åˆ’çº¿å±æ€§æ˜¯Pythonçš„è¯­æ³•ç‰¹æ€§ï¼Œé€šè¿‡<strong>åç§°ä¿®é¥°ï¼ˆName Manglingï¼‰æœºåˆ¶</strong>å®ç°çœŸæ­£çš„è®¿é—®é™åˆ¶ï¼Œå¤–éƒ¨æ— æ³•ç›´æ¥é€šè¿‡åŸå±æ€§åè®¿é—®ï¼Œåªèƒ½é€šè¿‡ç±»å†…éƒ¨çš„æ–¹æ³•æ“ä½œã€‚</p>
<h5 id="1ï¼‰æ ¸å¿ƒåŸç†ï¼šåç§°ä¿®é¥°ï¼ˆName-Manglingï¼‰">1ï¼‰æ ¸å¿ƒåŸç†ï¼šåç§°ä¿®é¥°ï¼ˆName Manglingï¼‰</h5>
<ul>
<li>å½“ç±»ä¸­å®šä¹‰åŒä¸‹åˆ’çº¿å±æ€§æ—¶ï¼ŒPythonè§£é‡Šå™¨ä¼šè‡ªåŠ¨å°†å±æ€§åä¿®æ”¹ä¸º <strong>_ç±»å__å±æ€§å</strong> çš„æ ¼å¼ï¼ˆå³ _ClassName__attrï¼‰ï¼Œä»è€Œéšè—åŸå±æ€§åï¼Œé¿å…å¤–éƒ¨ç›´æ¥è®¿é—®ã€‚</li>
<li>è¿™ç§ä¿®æ”¹æ˜¯è¯­æ³•å±‚é¢çš„ï¼Œå¹¶éåŠ å¯†ï¼Œ<strong>å¤–éƒ¨ä»å¯é€šè¿‡ä¿®æ”¹åçš„åç§°è®¿é—®</strong>ï¼ˆä¸æ¨èï¼Œè¿åå°è£…è®¾è®¡ï¼‰ã€‚</li>
</ul>
<h5 id="2ï¼‰å®šä¹‰ä¸è®¿é—®è§„åˆ™ï¼š">2ï¼‰å®šä¹‰ä¸è®¿é—®è§„åˆ™ï¼š</h5>
<ul>
<li>å®šä¹‰ï¼šself.__ç§æœ‰å±æ€§å = å±æ€§å€¼ã€‚</li>
<li>è®¿é—®é™åˆ¶ï¼šå¤–éƒ¨ç›´æ¥é€šè¿‡ å®ä¾‹å.__ç§æœ‰å±æ€§å ä¼šæŠ¥é”™ï¼ˆAttributeErrorï¼‰ã€‚</li>
<li>åˆæ³•è®¿é—®ï¼šåªèƒ½é€šè¿‡ç±»å†…éƒ¨çš„â€œgetter/setterâ€ç­‰å…¬å¼€æ–¹æ³•è®¿é—®å’Œä¿®æ”¹ã€‚</li>
<li>ç‰¹æ®Šè®¿é—®ï¼ˆä¸æ¨èï¼‰ï¼šå¤–éƒ¨å¯é€šè¿‡ <strong>å®ä¾‹å._ç±»å__ç§æœ‰å±æ€§å</strong> è®¿é—®ä¿®é¥°åçš„å±æ€§ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŒä¸‹åˆ’çº¿å±æ€§åŸç†è§£æ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, username, password</span>):</span><br><span class="line">        <span class="variable language_">self</span>.username = username          <span class="comment"># å…¬å¼€å±æ€§</span></span><br><span class="line">        <span class="variable language_">self</span>.__password = password        <span class="comment"># åŒä¸‹åˆ’çº¿ç§æœ‰å±æ€§ï¼ˆä¼šè¢«åç§°ä¿®é¥°ï¼‰</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># getteræ–¹æ³•ï¼šç±»å†…éƒ¨è®¿é—®ç§æœ‰å±æ€§ï¼ˆæ­£å¸¸ï¼‰</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_password</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># ç±»å†…éƒ¨å¯ç›´æ¥ä½¿ç”¨åŸå±æ€§åè®¿é—®</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.__password</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># setteræ–¹æ³•ï¼šç±»å†…éƒ¨ä¿®æ”¹ç§æœ‰å±æ€§ï¼ˆæ­£å¸¸ï¼‰</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_password</span>(<span class="params">self, new_password</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(new_password) &gt;= <span class="number">6</span>:</span><br><span class="line">            <span class="variable language_">self</span>.__password = new_password</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;å¯†ç é•¿åº¦ä¸èƒ½å°äº6ä½ï¼&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®ä¾‹åŒ–</span></span><br><span class="line">user = User(<span class="string">&quot;zhangsan&quot;</span>, <span class="string">&quot;123456&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. è®¿é—®å…¬å¼€å±æ€§ï¼ˆæ­£å¸¸ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(user.username)  <span class="comment"># è¾“å‡ºï¼šzhangsan</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. ç›´æ¥è®¿é—®åŸç§æœ‰å±æ€§åï¼ˆæŠ¥é”™ï¼šåç§°å·²è¢«ä¿®é¥°ï¼‰</span></span><br><span class="line"><span class="comment"># print(user.__password)  # AttributeError: &#x27;User&#x27; object has no attribute &#x27;__password&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. æŸ¥çœ‹å®ä¾‹çš„å±æ€§åˆ—è¡¨ï¼ˆå¯çœ‹åˆ°ä¿®é¥°åçš„å±æ€§åï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(user.__dict__)  <span class="comment"># è¾“å‡ºï¼š&#123;&#x27;username&#x27;: &#x27;zhangsan&#x27;, &#x27;_User__password&#x27;: &#x27;123456&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. å¤–éƒ¨é€šè¿‡ä¿®é¥°åçš„åç§°è®¿é—®ï¼ˆä¸æ¨èï¼Œç ´åå°è£…ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(user._User__password)  <span class="comment"># è¾“å‡ºï¼š123456</span></span><br><span class="line"><span class="comment"># å¤–éƒ¨é€šè¿‡ä¿®é¥°åçš„åç§°ä¿®æ”¹ï¼ˆä¸æ¨èï¼‰</span></span><br><span class="line">user._User__password = <span class="string">&quot;abc123456&quot;</span></span><br><span class="line"><span class="built_in">print</span>(user.get_password())  <span class="comment"># è¾“å‡ºï¼šabc123456</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. é€šè¿‡åˆæ³•çš„getter/setteræ–¹æ³•æ“ä½œï¼ˆæ¨èï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(user.get_password())  <span class="comment"># è¾“å‡ºï¼šabc123456</span></span><br><span class="line">user.set_password(<span class="string">&quot;654321&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(user.get_password())  <span class="comment"># è¾“å‡ºï¼š654321</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ4ï¼‰è¡¥å……ï¼š-å®ä¾‹å±æ€§åå†™é”™ä¼š-â€œé™é»˜åˆ›å»ºæ–°å±æ€§â€-çš„é—®é¢˜">ï¼ˆ4ï¼‰è¡¥å……ï¼š å®ä¾‹å±æ€§åå†™é”™ä¼š â€œé™é»˜åˆ›å»ºæ–°å±æ€§â€ çš„é—®é¢˜</h3>
<h4 id="1-é—®é¢˜æè¿°">&lt;1&gt;é—®é¢˜æè¿°</h4>
<p><strong>é—®é¢˜æœ¬è´¨</strong>ï¼šPython æ˜¯åŠ¨æ€ç±»å‹è¯­è¨€ï¼Œå±æ€§ / å˜é‡æ— éœ€æå‰å£°æ˜ï¼Œä¸ä¼šåœ¨è¿è¡Œå‰æ£€æŸ¥å±æ€§ / å˜é‡æ˜¯å¦å­˜åœ¨</p>
<ul>
<li>è‹¥ä½ æ‰‹æ»‘å†™æˆ stu1.scholl = â€œå¤æ—¦å¤§å­¦â€ï¼ˆå¤šå†™ä¸€ä¸ª lï¼‰ï¼ŒPython ä¸ä¼šæŠ¥é”™ï¼Œè€Œæ˜¯é»˜é»˜åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ scholl å®ä¾‹å±æ€§ï¼ŒåŸ school ç±»å±æ€§ / å®ä¾‹å±æ€§å®Œå…¨ä¸å—å½±å“ã€‚</li>
<li>è¿™ç§é”™è¯¯åœ¨è¿è¡Œå‰ï¼ˆé™æ€æ£€æŸ¥ï¼‰å¾ˆéš¾å‘ç°ï¼Œåªæœ‰è¿è¡Œæ—¶ç”¨åˆ°è¯¥å±æ€§æ—¶æ‰ä¼šæš´éœ²ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>:</span><br><span class="line">    school = <span class="string">&quot;åŒ—äº¬å¤§å­¦&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line"></span><br><span class="line">stu1 = Student(<span class="string">&quot;å¼ ä¸‰&quot;</span>)</span><br><span class="line"><span class="comment"># æ‰‹æ»‘æŠŠ school å†™æˆ schollï¼ˆæ‹¼å†™é”™è¯¯ï¼‰</span></span><br><span class="line">stu1.scholl = <span class="string">&quot;å¤æ—¦å¤§å­¦&quot;</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤æ—¶è®¿é—®æ­£ç¡®å±æ€§åï¼Œè¿˜æ˜¯åŸæ¥çš„ç±»å±æ€§å€¼ï¼Œä½ å¯èƒ½è¯¯ä»¥ä¸ºä¿®æ”¹æˆåŠŸ</span></span><br><span class="line"><span class="built_in">print</span>(stu1.school)  <span class="comment"># è¾“å‡ºï¼šåŒ—äº¬å¤§å­¦ï¼ˆå®Œå…¨æ²¡è¾¾åˆ°ä¿®æ”¹é¢„æœŸï¼‰</span></span><br><span class="line"><span class="comment"># è€Œé”™è¯¯çš„å±æ€§åè¢«æ‚„æ‚„åˆ›å»ºï¼Œä½ å¯èƒ½å®Œå…¨æ²¡æ„è¯†åˆ°</span></span><br><span class="line"><span class="built_in">print</span>(stu1.scholl)  <span class="comment"># è¾“å‡ºï¼šå¤æ—¦å¤§å­¦ï¼ˆè¿™ä¸ªå±æ€§æœ¬ä¸è¯¥å­˜åœ¨ï¼‰</span></span><br></pre></td></tr></table></figure>
<h4 id="2-å¸¸ç”¨åº”å¯¹æ–¹æ³•">&lt;2&gt;å¸¸ç”¨åº”å¯¹æ–¹æ³•</h4>
<h5 id="1ï¼‰ä½¿ç”¨-slots-ï¼ˆæœ€ç›´æ¥ï¼‰">1ï¼‰ä½¿ç”¨ __slots__ï¼ˆæœ€ç›´æ¥ï¼‰</h5>
<p>é€šè¿‡åœ¨ç±»ä¸­å®šä¹‰ __slots__ï¼Œå¯ä»¥æŒ‡å®šå®ä¾‹<strong>åªèƒ½æ‹¥æœ‰â€œå®ä¾‹å±æ€§â€</strong>ï¼Œä¸€æ—¦å°è¯•åˆ›å»ºæœªå£°æ˜çš„â€œå®ä¾‹å±æ€§â€ï¼Œä¼šç›´æ¥æŠ›å‡º AttributeErrorï¼Œä»æ ¹æºä¸Šé˜»æ­¢æ‹¼å†™é”™è¯¯å¯¼è‡´çš„ â€œé™é»˜åˆ›å»ºæ–°å®ä¾‹å±æ€§â€ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>:</span><br><span class="line">    <span class="comment"># é™åˆ¶å®ä¾‹åªèƒ½æœ‰ name/school ä¸¤ä¸ªå±æ€§ï¼Œå…¶ä»–å®ä¾‹å±æ€§åˆ›å»ºä¼šæŠ¥é”™</span></span><br><span class="line">    __slots__ = [<span class="string">&quot;name&quot;</span>]  </span><br><span class="line">    school = <span class="string">&quot;åŒ—äº¬å¤§å­¦&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line"></span><br><span class="line">stu1 = Student(<span class="string">&quot;å¼ ä¸‰&quot;</span>)</span><br><span class="line"><span class="comment"># æ‹¼å†™é”™è¯¯ï¼šscholl ä¸åœ¨ __slots__ ä¸­ï¼Œç›´æ¥æŠ¥é”™</span></span><br><span class="line">stu1.scholl = <span class="string">&quot;å¤æ—¦å¤§å­¦&quot;</span>  </span><br><span class="line"><span class="comment"># æŠ¥é”™ï¼šAttributeError: &#x27;Student&#x27; object has no attribute &#x27;scholl&#x27;</span></span><br></pre></td></tr></table></figure>
<h5 id="è¡¥å……ï¼š-slots-çš„åŸç†-ä¸-ç»§æ‰¿è§„åˆ™">è¡¥å……ï¼š__slots__ çš„åŸç† ä¸ ç»§æ‰¿è§„åˆ™</h5>
<ol>
<li>
<p><strong>åŠ¨æ€æ·»åŠ å®ä¾‹å±æ€§çš„æœ¬è´¨</strong>ï¼š</p>
<ul>
<li>é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ä¾‹é€šè¿‡ __dict__ å­—å…¸å­˜å‚¨å±æ€§ï¼Œå› æ­¤å¯ä»¥åŠ¨æ€æ·»åŠ ä»»æ„å±æ€§</li>
</ul>
</li>
<li>
<p><strong>slotsçš„åŸç†</strong>ï¼š</p>
</li>
</ol>
<ul>
<li>ä¸ºå®ä¾‹æŒ‡å®š<strong>å›ºå®šçš„å±æ€§ååˆ—è¡¨</strong>ï¼Œç”¨å›ºå®šå†…å­˜ä½ç½®æ›¿ä»£ __dict__</li>
<li>å®ä¾‹åªèƒ½æ‹¥æœ‰ __slots__ ä¸­å£°æ˜çš„å±æ€§</li>
</ul>
<ol start="3">
<li><strong>slots çš„ç»§æ‰¿è§„åˆ™</strong></li>
</ol>
<ul>
<li><strong>è§„åˆ™ 1</strong>ï¼šå­ç±»ä¸è‡ªåŠ¨ç»§æ‰¿çˆ¶ç±»çš„ __slots__
<ul>
<li>çˆ¶ç±»æœ‰ __slots__ã€å­ç±»æ—  â†’ å­ç±»å®ä¾‹æœ‰ __dict__ï¼Œå¯è‡ªç”±æ·»åŠ å±æ€§</li>
</ul>
</li>
<li><strong>è§„åˆ™ 2</strong>ï¼šå­ç±»ä¼šç»§æ‰¿çˆ¶ç±»çš„ __dict__ï¼ˆå¦‚æœæœ‰ï¼‰
<ul>
<li>çˆ¶ç±»æ—  __slots__ã€å­ç±»æœ‰ â†’ å­ç±»çš„ __slots__ è¢«ç»•è¿‡</li>
</ul>
</li>
<li><strong>è§„åˆ™ 3</strong>ï¼šçˆ¶å­éƒ½æœ‰ __slots__ â†’ å®ä¾‹å¯ç”¨å±æ€§ä¸ºä¸¤è€…å åŠ </li>
</ul>
<ol start="4">
<li><strong>åˆ¤æ–­å…³é”®</strong>ï¼š
<ul>
<li>çœ‹å®ä¾‹æœ€ç»ˆæ˜¯å¦æœ‰ __dict__ â†’ æœ‰åˆ™å¯è‡ªç”±æ·»åŠ ï¼Œæ— åˆ™å—é™äº __slots__</li>
<li>__slots__ ä¸­åŒ…å« â€˜__dict__â€™ æ—¶ï¼Œç›¸å½“äºæ¢å¤åŠ¨æ€èƒ½åŠ›</li>
</ul>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è§„åˆ™ 1ï¼šå­ç±»ä¸è‡ªåŠ¨ç»§æ‰¿çˆ¶ç±»çš„ __slots__</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Parent</span>:</span><br><span class="line">    __slots__ = [<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span>(<span class="title class_ inherited__">Parent</span>):</span><br><span class="line">    <span class="keyword">pass</span>  <span class="comment"># å­ç±»æœªå®šä¹‰ __slots__</span></span><br><span class="line"></span><br><span class="line">c = Child()</span><br><span class="line">c.name = <span class="string">&quot;å¼ ä¸‰&quot;</span>      <span class="comment"># âœ… ç»§æ‰¿è‡ªçˆ¶ç±» slots</span></span><br><span class="line">c.age = <span class="number">18</span>           <span class="comment"># âœ… å­ç±»æœ‰ __dict__ï¼Œå¯è‡ªç”±æ·»åŠ </span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hasattr</span>(c, <span class="string">&#x27;__dict__&#x27;</span>))  <span class="comment"># True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å­ç±»ç»§æ‰¿çˆ¶ç±»çš„ __dict__ï¼Œå¯¼è‡´å­ç±» __slots__ æ— æ•ˆ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Parent</span>:</span><br><span class="line">    <span class="keyword">pass</span>  <span class="comment"># æ—  __slots__ï¼Œæœ‰ __dict__</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span>(<span class="title class_ inherited__">Parent</span>):</span><br><span class="line">    __slots__ = [<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line"></span><br><span class="line">c = Child()</span><br><span class="line">c.name = <span class="string">&quot;å¼ ä¸‰&quot;</span>      <span class="comment"># âœ…</span></span><br><span class="line">c.age = <span class="number">18</span>           <span class="comment"># âœ… ä¸æŠ¥é”™ï¼å› ä¸ºç»§æ‰¿äº† __dict__</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hasattr</span>(c, <span class="string">&#x27;__dict__&#x27;</span>))  <span class="comment"># True</span></span><br><span class="line"><span class="built_in">print</span>(c.__dict__)    <span class="comment"># &#123;&#x27;age&#x27;: 18&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§„åˆ™ 3ï¼šçˆ¶å­éƒ½æœ‰ __slots__ï¼Œå åŠ ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Parent</span>:</span><br><span class="line">    __slots__ = [<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span>(<span class="title class_ inherited__">Parent</span>):</span><br><span class="line">    __slots__ = [<span class="string">&#x27;age&#x27;</span>]</span><br><span class="line"></span><br><span class="line">c = Child()</span><br><span class="line">c.name = <span class="string">&quot;å¼ ä¸‰&quot;</span>      <span class="comment"># âœ… æ¥è‡ªçˆ¶ç±» slots</span></span><br><span class="line">c.age = <span class="number">18</span>           <span class="comment"># âœ… æ¥è‡ªå­ç±» slots</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hasattr</span>(c, <span class="string">&#x27;__dict__&#x27;</span>))  <span class="comment"># False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°è¯•æ·»åŠ  slots å¤–çš„å±æ€§</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    c.gender = <span class="string">&quot;ç”·&quot;</span></span><br><span class="line"><span class="keyword">except</span> AttributeError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(e)  <span class="comment"># &#x27;Child&#x27; object has no attribute &#x27;gender&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¡¥å……1ï¼š__slots__ ä¸­åŒ…å« &#x27;__dict__&#x27;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Parent</span>:</span><br><span class="line">    __slots__ = [<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span>(<span class="title class_ inherited__">Parent</span>):</span><br><span class="line">    __slots__ = [<span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;__dict__&#x27;</span>]</span><br><span class="line"></span><br><span class="line">c = Child()</span><br><span class="line">c.name = <span class="string">&quot;å¼ ä¸‰&quot;</span></span><br><span class="line">c.age = <span class="number">18</span></span><br><span class="line">c.gender = <span class="string">&quot;ç”·&quot;</span>      <span class="comment"># âœ… å¯ä»¥ï¼Œå› ä¸ºæœ‰ __dict__</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hasattr</span>(c, <span class="string">&#x27;__dict__&#x27;</span>))  <span class="comment"># True</span></span><br><span class="line"><span class="built_in">print</span>(c.__dict__)    <span class="comment"># &#123;&#x27;gender&#x27;: &#x27;ç”·&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¡¥å……2ï¼šç©º __slots__ ç¦ç”¨ä¸€åˆ‡åŠ¨æ€å±æ€§</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Empty</span>:</span><br><span class="line">    __slots__ = []</span><br><span class="line"></span><br><span class="line">e = Empty()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    e.name = <span class="string">&quot;å¼ ä¸‰&quot;</span></span><br><span class="line"><span class="keyword">except</span> AttributeError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(e)  <span class="comment"># &#x27;Empty&#x27; object has no attribute &#x27;name&#x27;</span></span><br></pre></td></tr></table></figure>
<h5 id="3ï¼‰å°è£…ä¿®æ”¹å±æ€§çš„æ–¹æ³•ï¼ˆè€Œéç›´æ¥èµ‹å€¼ï¼‰">3ï¼‰å°è£…ä¿®æ”¹å±æ€§çš„æ–¹æ³•ï¼ˆè€Œéç›´æ¥èµ‹å€¼ï¼‰</h5>
<p>é€šè¿‡è‡ªå®šä¹‰æ–¹æ³•ä¿®æ”¹å±æ€§ï¼Œåœ¨æ–¹æ³•å†…æ ¡éªŒå±æ€§å / å€¼çš„åˆæ³•æ€§ï¼Œé¿å…ç›´æ¥èµ‹å€¼çš„éšæ„æ€§ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>:</span><br><span class="line">    school = <span class="string">&quot;åŒ—äº¬å¤§å­¦&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_school</span>(<span class="params">self, new_school</span>):</span><br><span class="line">        <span class="comment"># æ–¹æ³•å†…åªå¤„ç†æ­£ç¡®çš„å±æ€§åï¼Œé¿å…æ‹¼å†™é”™è¯¯</span></span><br><span class="line">        <span class="variable language_">self</span>.school = new_school</span><br><span class="line"></span><br><span class="line">stu1 = Student(<span class="string">&quot;å¼ ä¸‰&quot;</span>)</span><br><span class="line"><span class="comment"># åªèƒ½é€šè¿‡æ–¹æ³•ä¿®æ”¹ï¼Œæ— æ³•å†™é”™å±æ€§åï¼ˆæ–¹æ³•åé”™ä¼šç›´æ¥æŠ¥é”™ï¼Œæ›´å®¹æ˜“å‘ç°ï¼‰</span></span><br><span class="line">stu1.set_school(<span class="string">&quot;å¤æ—¦å¤§å­¦&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(stu1.school)  <span class="comment"># è¾“å‡ºï¼šå¤æ—¦å¤§å­¦ï¼ˆæ­£ç¡®ä¿®æ”¹ï¼‰</span></span><br><span class="line"><span class="comment"># è‹¥æ‰‹æ»‘å†™ stu1.set_scholl(&quot;å¤æ—¦å¤§å­¦&quot;)ï¼Œä¼šç›´æ¥æŠ¥ AttributeErrorï¼Œç«‹åˆ»å‘ç°é”™è¯¯</span></span><br></pre></td></tr></table></figure>
<h5 id="3ï¼‰IDE-æç¤º">3ï¼‰IDE æç¤º</h5>
<p>PyCharm/VSCode ç­‰DIEä¸­ä¼šç»™å‡º**â€œè­¦å‘Šæç¤ºâ€**ï¼Œçœ‹è§æ—¶éœ€æ³¨æ„</p>
<h2 id="3-ç±»çš„æ–¹æ³•">3.ç±»çš„æ–¹æ³•</h2>
<p>æ–¹æ³•æ˜¯ç±»ä¸­å®šä¹‰çš„å‡½æ•°ï¼Œæ ¹æ®å‚æ•°å’Œä½œç”¨åŸŸå¯åˆ†ä¸º <strong>ã€Œå®ä¾‹æ–¹æ³•ã€</strong> ã€ <strong>ã€Œç±»æ–¹æ³•ã€</strong>ã€ <strong>ã€Œé™æ€æ–¹æ³•ã€</strong> ä¸‰ç±»ã€‚</p>
<h3 id="ï¼ˆ1ï¼‰å®ä¾‹æ–¹æ³•">ï¼ˆ1ï¼‰å®ä¾‹æ–¹æ³•</h3>
<ul>
<li><strong>å®šä¹‰</strong>ï¼š
<ul>
<li><strong>ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯ self</strong>ï¼ˆæŒ‡ä»£å½“å‰å®ä¾‹ï¼‰</li>
<li>é€šè¿‡ self è®¿é—®å®ä¾‹å±æ€§å’Œå…¶ä»–å®ä¾‹æ–¹æ³•ã€‚</li>
</ul>
</li>
<li><strong>è°ƒç”¨</strong>ï¼š
<ul>
<li>åªèƒ½é€šè¿‡ã€Œå®ä¾‹ã€è°ƒç”¨ï¼ˆ<strong>å®ä¾‹å.æ–¹æ³•å()</strong>ï¼‰ï¼Œself ç”±Pythonè‡ªåŠ¨ä¼ é€’ï¼Œæ— éœ€æ‰‹åŠ¨ä¼ å…¥ã€‚</li>
</ul>
</li>
<li><strong>ç”¨é€”</strong>ï¼š
<ul>
<li>æ“ä½œå®ä¾‹å±æ€§ï¼Œå®ç°ä¸å…·ä½“å®ä¾‹ç›¸å…³çš„åŠŸèƒ½ã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰åŒ…å«å®ä¾‹æ–¹æ³•çš„ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="comment"># æ„é€ æ–¹æ³•åˆå§‹åŒ–å®ä¾‹å±æ€§</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name  <span class="comment"># å®ä¾‹å±æ€§ï¼šå§“å</span></span><br><span class="line">        <span class="variable language_">self</span>.age = age    <span class="comment"># å®ä¾‹å±æ€§ï¼šå¹´é¾„</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å®ä¾‹æ–¹æ³•1ï¼šè®¿é—®å®ä¾‹å±æ€§</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show_info</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># é€šè¿‡selfè®¿é—®å½“å‰å®ä¾‹çš„å±æ€§</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;å§“åï¼š<span class="subst">&#123;self.name&#125;</span>ï¼Œå¹´é¾„ï¼š<span class="subst">&#123;self.age&#125;</span>å²&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å®ä¾‹æ–¹æ³•2ï¼šä¿®æ”¹å®ä¾‹å±æ€§</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">grow_up</span>(<span class="params">self, years=<span class="number">1</span></span>):</span><br><span class="line">        <span class="comment"># é€šè¿‡selfä¿®æ”¹å®ä¾‹å±æ€§</span></span><br><span class="line">        <span class="variable language_">self</span>.age += years</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span>é•¿å¤§äº†<span class="subst">&#123;years&#125;</span>å²ï¼Œç°åœ¨<span class="subst">&#123;self.age&#125;</span>å²&quot;</span>)</span><br><span class="line">        <span class="comment"># é€šè¿‡selfè°ƒç”¨å…¶ä»–å®ä¾‹æ–¹æ³•</span></span><br><span class="line">        <span class="variable language_">self</span>.show_info()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. å®ä¾‹åŒ–å¯¹è±¡ï¼ˆè§¦å‘__init__åˆå§‹åŒ–å±æ€§ï¼‰</span></span><br><span class="line">p = Person(<span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="number">18</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. è°ƒç”¨å®ä¾‹æ–¹æ³•ï¼ˆæ— éœ€ä¼ é€’selfï¼ŒPythonè‡ªåŠ¨ç»‘å®šï¼‰</span></span><br><span class="line">p.show_info()  <span class="comment"># è¾“å‡ºï¼šå§“åï¼šå¼ ä¸‰ï¼Œå¹´é¾„ï¼š18å²</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. è°ƒç”¨å¸¦å‚æ•°çš„å®ä¾‹æ–¹æ³•</span></span><br><span class="line">p.grow_up(<span class="number">2</span>)  <span class="comment"># è¾“å‡ºï¼šå¼ ä¸‰é•¿å¤§äº†2å²ï¼Œç°åœ¨20å²ï¼›å§“åï¼šå¼ ä¸‰ï¼Œå¹´é¾„ï¼š20å²</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. å†æ¬¡è°ƒç”¨å®ä¾‹æ–¹æ³•ï¼ŒéªŒè¯å±æ€§å·²ä¿®æ”¹</span></span><br><span class="line">p.show_info()  <span class="comment"># è¾“å‡ºï¼šå§“åï¼šå¼ ä¸‰ï¼Œå¹´é¾„ï¼š20å²</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰ç±»æ–¹æ³•">ï¼ˆ2ï¼‰ç±»æ–¹æ³•</h3>
<p>ä½¿ç”¨ <strong>@classmethod è£…é¥°å™¨å®šä¹‰</strong>ï¼Œ<strong>ç”¨äºæ“ä½œç±»å±æ€§</strong>ï¼Œä¸ä¾èµ–å®ä¾‹ã€‚</p>
<ul>
<li><strong>å®šä¹‰</strong>ï¼š
<ul>
<li>ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯ clsï¼ˆ<strong>æŒ‡ä»£å½“å‰ç±»</strong>ï¼‰</li>
<li>é€šè¿‡ cls è®¿é—®ç±»å±æ€§å’Œå…¶ä»–ç±»æ–¹æ³•ã€‚</li>
</ul>
</li>
<li><strong>è°ƒç”¨</strong>ï¼š
<ul>
<li><strong>å¯é€šè¿‡ã€Œç±»ã€æˆ–ã€Œå®ä¾‹ã€è°ƒç”¨</strong>ï¼ˆæ¨èç”¨ç±»è°ƒç”¨ï¼šç±»å.æ–¹æ³•å()ï¼‰ï¼Œcls ç”±Pythonè‡ªåŠ¨ä¼ é€’ã€‚</li>
</ul>
</li>
<li><strong>ç”¨é€”</strong>ï¼š
<ul>
<li>ä¿®æ”¹ç±»å±æ€§ã€åˆ›å»ºå®ä¾‹ï¼ˆæ›¿ä»£æ„é€ æ–¹æ³•ï¼‰ç­‰ä¸ç±»ç›¸å…³çš„æ“ä½œã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span>:</span><br><span class="line">    <span class="comment"># ç±»å±æ€§ï¼šæ±½è½¦æ€»æ•°</span></span><br><span class="line">    total_cars = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, brand</span>):</span><br><span class="line">        <span class="variable language_">self</span>.brand = brand  <span class="comment"># å®ä¾‹å±æ€§ï¼šå“ç‰Œ</span></span><br><span class="line">        Car.total_cars += <span class="number">1</span>  <span class="comment"># æ¯åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œæ±½è½¦æ€»æ•°+1</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ç±»æ–¹æ³•ï¼šè·å–æ±½è½¦æ€»æ•°ï¼ˆæ“ä½œç±»å±æ€§ï¼‰</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_total_cars</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;å½“å‰æ±½è½¦æ€»æ•°ï¼š<span class="subst">&#123;cls.total_cars&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> cls.total_cars</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ç±»æ–¹æ³•ï¼šåˆ›å»ºé»˜è®¤å“ç‰Œçš„æ±½è½¦ï¼ˆæ›¿ä»£æ„é€ æ–¹æ³•ï¼‰</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_default_car</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="keyword">return</span> cls(brand=<span class="string">&quot;ä¸°ç”°&quot;</span>)  <span class="comment"># ç­‰ä»·äº Car(&quot;ä¸°ç”°&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. å®ä¾‹åŒ–æ±½è½¦</span></span><br><span class="line">car1 = Car(<span class="string">&quot;å®é©¬&quot;</span>)</span><br><span class="line">car2 = Car(<span class="string">&quot;å¥”é©°&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. è°ƒç”¨ç±»æ–¹æ³•ï¼ˆç±»è°ƒç”¨ï¼‰</span></span><br><span class="line">Car.get_total_cars()  <span class="comment"># è¾“å‡ºï¼šå½“å‰æ±½è½¦æ€»æ•°ï¼š2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. å®ä¾‹è°ƒç”¨ç±»æ–¹æ³•ï¼ˆä¹Ÿå¯ï¼Œä½†ä¸æ¨èï¼‰</span></span><br><span class="line">car1.get_total_cars()  <span class="comment"># è¾“å‡ºï¼šå½“å‰æ±½è½¦æ€»æ•°ï¼š2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. é€šè¿‡ç±»æ–¹æ³•åˆ›å»ºå®ä¾‹</span></span><br><span class="line">default_car = Car.create_default_car()</span><br><span class="line"><span class="built_in">print</span>(default_car.brand)  <span class="comment"># è¾“å‡ºï¼šä¸°ç”°</span></span><br><span class="line">Car.get_total_cars()  <span class="comment"># è¾“å‡ºï¼šå½“å‰æ±½è½¦æ€»æ•°ï¼š3</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰é™æ€æ–¹æ³•">ï¼ˆ3ï¼‰é™æ€æ–¹æ³•</h3>
<p>ä½¿ç”¨ <strong>@staticmethod è£…é¥°å™¨</strong>å®šä¹‰ï¼Œæ—¢ä¸ä¾èµ–å®ä¾‹ï¼ˆæ—  selfï¼‰ï¼Œä¹Ÿä¸ä¾èµ–ç±»ï¼ˆæ—  clsï¼‰ï¼Œç›¸å½“äºç±»ä¸­çš„â€œæ™®é€šå‡½æ•°â€ã€‚</p>
<ul>
<li><strong>å®šä¹‰</strong>ï¼š
<ul>
<li>æ— å¼ºåˆ¶ç¬¬ä¸€ä¸ªå‚æ•°selfï¼Œå‚æ•°è‡ªç”±å®šä¹‰ã€‚</li>
</ul>
</li>
<li><strong>è°ƒç”¨</strong>ï¼š
<ul>
<li>å¯é€šè¿‡ã€Œç±»ã€æˆ–ã€Œå®ä¾‹ã€è°ƒç”¨ï¼ˆæ¨èç”¨ç±»è°ƒç”¨ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>ç”¨é€”</strong>ï¼š
<ul>
<li>å®ç°ä¸ç±»å’Œå®ä¾‹éƒ½æ— å…³çš„è¾…åŠ©åŠŸèƒ½ï¼ˆå¦‚å·¥å…·å‡½æ•°ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MathTools</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ•°å­¦å·¥å…·ç±»ï¼ŒåŒ…å«é™æ€æ–¹æ³•å®ç°è¾…åŠ©è®¡ç®—&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># é™æ€æ–¹æ³•ï¼šè®¡ç®—ä¸¤ä¸ªæ•°çš„å¹³æ–¹å’Œ</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sum_of_squares</span>(<span class="params">a, b</span>):</span><br><span class="line">        <span class="keyword">return</span> a**<span class="number">2</span> + b**<span class="number">2</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># é™æ€æ–¹æ³•ï¼šåˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦ä¸ºå¶æ•°</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_even</span>(<span class="params">num</span>):</span><br><span class="line">        <span class="keyword">return</span> num % <span class="number">2</span> == <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. ç±»è°ƒç”¨é™æ€æ–¹æ³•ï¼ˆæ¨èï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(MathTools.sum_of_squares(<span class="number">3</span>, <span class="number">4</span>))  <span class="comment"># è¾“å‡ºï¼š25ï¼ˆ3Â²+4Â²=25ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(MathTools.is_even(<span class="number">6</span>))            <span class="comment"># è¾“å‡ºï¼šTrue</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. å®ä¾‹è°ƒç”¨é™æ€æ–¹æ³•ï¼ˆä¹Ÿå¯ï¼‰</span></span><br><span class="line">tools = MathTools()</span><br><span class="line"><span class="built_in">print</span>(tools.sum_of_squares(<span class="number">5</span>, <span class="number">12</span>))  <span class="comment"># è¾“å‡ºï¼š169ï¼ˆ5Â²+12Â²=169ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(tools.is_even(<span class="number">7</span>))             <span class="comment"># è¾“å‡ºï¼šFalse</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ4ï¼‰æ–¹æ³•å¯¹æ¯”æ€»ç»“">ï¼ˆ4ï¼‰æ–¹æ³•å¯¹æ¯”æ€»ç»“</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260111104147036.png" alt=""></p>
<h2 id="4-é¢å‘å¯¹è±¡ä¸‰å¤§ç‰¹æ€§ï¼šå°è£…ã€ç»§æ‰¿ã€å¤šæ€">4.é¢å‘å¯¹è±¡ä¸‰å¤§ç‰¹æ€§ï¼šå°è£…ã€ç»§æ‰¿ã€å¤šæ€</h2>
<h3 id="ï¼ˆ1ï¼‰å°è£…">ï¼ˆ1ï¼‰å°è£…</h3>
<ul>
<li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼š
<ul>
<li>å°†ç±»çš„å±æ€§å’Œæ–¹æ³•â€œåŒ…è£¹â€èµ·æ¥ï¼Œ<strong>éšè—å†…éƒ¨å®ç°ç»†èŠ‚ï¼Œåªå¯¹å¤–æä¾›æœ‰é™çš„è®¿é—®æ¥å£ï¼ˆå¦‚getter/setteræ–¹æ³•ï¼‰ï¼Œé˜²æ­¢å¤–éƒ¨éšæ„ä¿®æ”¹å†…éƒ¨æ•°æ®</strong>ï¼Œä¿è¯æ•°æ®çš„å®‰å…¨æ€§å’Œä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚</li>
</ul>
</li>
<li><strong>å®ç°æ–¹å¼</strong>ï¼š
<ul>
<li>ä½¿ç”¨ __ å®šä¹‰ç§æœ‰å±æ€§/ç§æœ‰æ–¹æ³•ï¼ˆå¤–éƒ¨æ— æ³•ç›´æ¥è®¿é—®ï¼‰ã€‚</li>
<li>æä¾›å…¬å¼€çš„getterï¼ˆè·å–ï¼‰ã€setterï¼ˆä¿®æ”¹ï¼‰æ–¹æ³•ï¼Œæ§åˆ¶å¯¹ç§æœ‰å±æ€§çš„è®¿é—®é€»è¾‘ã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BankAccount</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;é“¶è¡Œè´¦æˆ·ç±»ï¼Œå°è£…è´¦æˆ·ä½™é¢çš„è®¿é—®å’Œä¿®æ”¹&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, account_id, balance=<span class="number">0</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.account_id = account_id      <span class="comment"># å…¬å¼€å±æ€§ï¼šè´¦å·</span></span><br><span class="line">        <span class="variable language_">self</span>.__balance = balance          <span class="comment"># ç§æœ‰å±æ€§ï¼šä½™é¢ï¼ˆéšè—ï¼‰</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ç§æœ‰æ–¹æ³•ï¼šæ—¥å¿—è®°å½•ï¼ˆå†…éƒ¨ä½¿ç”¨ï¼Œå¤–éƒ¨æ— æ³•è°ƒç”¨ï¼‰</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__log</span>(<span class="params">self, action, amount</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;è´¦å·<span class="subst">&#123;self.account_id&#125;</span>ï¼š<span class="subst">&#123;action&#125;</span> <span class="subst">&#123;amount&#125;</span>å…ƒï¼Œå½“å‰ä½™é¢ï¼š<span class="subst">&#123;self.__balance&#125;</span>å…ƒ&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># getteræ–¹æ³•ï¼šæŸ¥è¯¢ä½™é¢</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_balance</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.__log(<span class="string">&quot;æŸ¥è¯¢ä½™é¢&quot;</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.__balance</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># setteræ–¹æ³•ï¼šå­˜æ¬¾ï¼ˆæ§åˆ¶å­˜æ¬¾é€»è¾‘ï¼‰</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">deposit</span>(<span class="params">self, amount</span>):</span><br><span class="line">        <span class="keyword">if</span> amount &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="variable language_">self</span>.__balance += amount</span><br><span class="line">            <span class="variable language_">self</span>.__log(<span class="string">&quot;å­˜æ¬¾&quot;</span>, amount)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;å­˜æ¬¾é‡‘é¢å¿…é¡»å¤§äº0ï¼&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># setteræ–¹æ³•ï¼šå–æ¬¾ï¼ˆæ§åˆ¶å–æ¬¾é€»è¾‘ï¼‰</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">withdraw</span>(<span class="params">self, amount</span>):</span><br><span class="line">        <span class="keyword">if</span> amount &gt; <span class="number">0</span> <span class="keyword">and</span> amount &lt;= <span class="variable language_">self</span>.__balance:</span><br><span class="line">            <span class="variable language_">self</span>.__balance -= amount</span><br><span class="line">            <span class="variable language_">self</span>.__log(<span class="string">&quot;å–æ¬¾&quot;</span>, amount)</span><br><span class="line">            <span class="keyword">return</span> amount</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;å–æ¬¾é‡‘é¢æ— æ•ˆæˆ–ä½™é¢ä¸è¶³ï¼&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®ä¾‹åŒ–è´¦æˆ·</span></span><br><span class="line">account = BankAccount(<span class="string">&quot;6222081234567890&quot;</span>, <span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¿é—®å…¬å¼€å±æ€§</span></span><br><span class="line"><span class="built_in">print</span>(account.account_id)  <span class="comment"># è¾“å‡ºï¼š6222081234567890</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡å…¬å¼€æ–¹æ³•æ“ä½œç§æœ‰å±æ€§</span></span><br><span class="line">account.deposit(<span class="number">500</span>)        <span class="comment"># è¾“å‡ºï¼šè´¦å·6222081234567890ï¼šå­˜æ¬¾ 500å…ƒï¼Œå½“å‰ä½™é¢ï¼š1500å…ƒ</span></span><br><span class="line">account.withdraw(<span class="number">300</span>)       <span class="comment"># è¾“å‡ºï¼šè´¦å·6222081234567890ï¼šå–æ¬¾ 300å…ƒï¼Œå½“å‰ä½™é¢ï¼š1200å…ƒ</span></span><br><span class="line"><span class="built_in">print</span>(account.get_balance())<span class="comment"># è¾“å‡ºï¼šè´¦å·6222081234567890ï¼šæŸ¥è¯¢ä½™é¢ 0å…ƒï¼Œå½“å‰ä½™é¢ï¼š1200å…ƒ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°è¯•ç›´æ¥è®¿é—®ç§æœ‰å±æ€§/æ–¹æ³•ï¼ˆæŠ¥é”™ï¼‰</span></span><br><span class="line"><span class="comment"># print(account.__balance)  # AttributeError</span></span><br><span class="line"><span class="comment"># account.__log(&quot;æµ‹è¯•&quot;, 0)  # AttributeError</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰ç»§æ‰¿ï¼ˆInheritanceï¼‰">ï¼ˆ2ï¼‰ç»§æ‰¿ï¼ˆInheritanceï¼‰</h3>
<h4 id="1-ä»‹ç»-2">&lt;1&gt;ä»‹ç»</h4>
<ul>
<li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼š
<ul>
<li><strong>å­ç±»ï¼ˆæ´¾ç”Ÿç±»ï¼‰ç»§æ‰¿çˆ¶ç±»ï¼ˆåŸºç±»ï¼‰çš„å±æ€§å’Œæ–¹æ³•</strong>ï¼Œæ— éœ€é‡å¤ç¼–å†™ä»£ç ï¼ŒåŒæ—¶å­ç±»å¯æ‰©å±•æ–°çš„å±æ€§å’Œæ–¹æ³•ï¼Œæˆ–é‡å†™çˆ¶ç±»çš„æ–¹æ³•ï¼ˆè¦†ç›–çˆ¶ç±»é€»è¾‘ï¼‰ï¼Œå®ç°ä»£ç å¤ç”¨å’Œæ‰©å±•ã€‚</li>
<li>Pythonæ”¯æŒã€Œå•ç»§æ‰¿ã€å’Œã€Œå¤šç»§æ‰¿ã€ï¼ˆä¸€ä¸ªå­ç±»ç»§æ‰¿å¤šä¸ªçˆ¶ç±»ï¼‰ï¼Œä½†å¤šç»§æ‰¿æ˜“å¯¼è‡´é€»è¾‘å¤æ‚ï¼Œé€šå¸¸æ¨èå•ç»§æ‰¿ã€‚</li>
</ul>
</li>
<li><strong>åŸºæœ¬è¯­æ³•</strong>ï¼š</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># çˆ¶ç±»ï¼ˆåŸºç±»ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">çˆ¶ç±»å</span>:</span><br><span class="line">    çˆ¶ç±»å±æ€§å’Œæ–¹æ³•</span><br><span class="line"></span><br><span class="line"><span class="comment"># å­ç±»ï¼ˆæ´¾ç”Ÿç±»ï¼‰ç»§æ‰¿çˆ¶ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">å­ç±»å</span>(<span class="title class_ inherited__">çˆ¶ç±»å</span>):</span><br><span class="line">    <span class="comment"># å­ç±»å¯æ‰©å±•æ–°çš„å±æ€§å’Œæ–¹æ³•</span></span><br><span class="line">    å­ç±»å±æ€§å’Œæ–¹æ³•</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ï¼ˆå¯é€‰ï¼‰é‡å†™çˆ¶ç±»æ–¹æ³•ï¼ˆè¦†ç›–çˆ¶ç±»é€»è¾‘ï¼‰</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">çˆ¶ç±»æ–¹æ³•å</span>(<span class="params">self, å‚æ•°åˆ—è¡¨</span>):</span><br><span class="line">        å­ç±»çš„æ–¹æ³•ä½“</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>å…³é”®æ¦‚å¿µ</strong>
<ul>
<li><strong>ç»§æ‰¿ä¼ é€’æ€§</strong>ï¼š
<ul>
<li>å¦‚æœBç»§æ‰¿Aï¼ŒCç»§æ‰¿Bï¼Œåˆ™CåŒæ—¶æ‹¥æœ‰Aå’ŒBçš„å±æ€§å’Œæ–¹æ³•ã€‚</li>
</ul>
</li>
<li><strong>é‡å†™ï¼ˆOverrideï¼‰</strong>ï¼š
<ul>
<li>å­ç±»å®šä¹‰ä¸çˆ¶ç±»åŒåçš„æ–¹æ³•ï¼Œè¦†ç›–çˆ¶ç±»çš„å®ç°é€»è¾‘ï¼ˆå½“è°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œä¼˜å…ˆæ‰§è¡Œå­ç±»é€»è¾‘ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>super()</strong>ï¼š
<ul>
<li>åœ¨å­ç±»ä¸­è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼ˆå¦‚ <strong>super().__init__()</strong> è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼‰ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>æ³¨æ„ï¼ï¼</strong>ï¼šå¦‚æœè¦ç»§æ‰¿çˆ¶ç±»çš„å±æ€§ï¼Œ<strong>å­ç±»__init__å¿…é¡»æ˜¾å¼è°ƒç”¨çˆ¶ç±»__init__</strong></p>
<ul>
<li>å­ç±»è‡ªå®šä¹‰äº†__init__æ–¹æ³•ï¼Œä¼šè¦†ç›–çˆ¶ç±»çš„__init__æ–¹æ³•ã€‚</li>
<li>è‹¥å­ç±»éœ€è¦ç»§æ‰¿çˆ¶ç±»çš„å®ä¾‹å±æ€§ï¼Œå¿…é¡»é€šè¿‡ super().__init__(å‚æ•°) æ˜¾å¼è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œå¦åˆ™çˆ¶ç±»çš„å®ä¾‹å±æ€§æ— æ³•è¢«åˆå§‹åŒ–ï¼Œå­ç±»å®ä¾‹å°†ç¼ºå°‘çˆ¶ç±»çš„ç›¸å…³å±æ€§ã€‚</li>
</ul>
<h4 id="2-ç¤ºä¾‹ï¼šå•ç»§æ‰¿ä¸é‡å†™">&lt;2&gt;ç¤ºä¾‹ï¼šå•ç»§æ‰¿ä¸é‡å†™</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># çˆ¶ç±»ï¼šAnimal</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">eat</span>(<span class="params">self, food</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span>æ­£åœ¨åƒ<span class="subst">&#123;food&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">move</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span>æ­£åœ¨ç¼“æ…¢ç§»åŠ¨&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å­ç±»ï¼šDog ç»§æ‰¿ Animal</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line">    <span class="comment"># æ‰©å±•å­ç±»ç‰¹æœ‰çš„å±æ€§ï¼ˆå“ç§ï¼‰</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age, breed</span>):</span><br><span class="line">        <span class="comment"># å…³é”®ï¼šå¿…é¡»æ˜¾å¼è°ƒç”¨çˆ¶ç±»__init__ï¼Œæ‰èƒ½ç»§æ‰¿nameå’Œageå±æ€§</span></span><br><span class="line">        <span class="comment"># è‹¥çœç•¥æ­¤å¥ï¼ŒDogå®ä¾‹å°†ç¼ºå°‘nameå’Œageå±æ€§ï¼Œè°ƒç”¨çˆ¶ç±»æ–¹æ³•æ—¶ä¼šæŠ¥é”™</span></span><br><span class="line">        <span class="built_in">super</span>().__init__(name, age)</span><br><span class="line">        <span class="variable language_">self</span>.breed = breed  <span class="comment"># å­ç±»æ–°å¢å±æ€§ï¼šå“ç§</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># é‡å†™çˆ¶ç±»çš„moveæ–¹æ³•ï¼ˆè¦†ç›–çˆ¶ç±»é€»è¾‘ï¼‰</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">move</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span>ï¼ˆ<span class="subst">&#123;self.breed&#125;</span>ï¼‰æ­£åœ¨å¿«é€Ÿå¥”è·‘&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ‰©å±•å­ç±»ç‰¹æœ‰çš„æ–¹æ³•ï¼ˆå«ï¼‰</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">bark</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span>æ±ªæ±ªå«ï¼&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®ä¾‹åŒ–å­ç±»Dog</span></span><br><span class="line">dog = Dog(<span class="string">&quot;æ—ºè´¢&quot;</span>, <span class="number">3</span>, <span class="string">&quot;é‡‘æ¯›&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¿é—®çˆ¶ç±»çš„å±æ€§ï¼ˆå› æ˜¾å¼è°ƒç”¨çˆ¶ç±»__init__ï¼Œæ‰å¯æ­£å¸¸è®¿é—®ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(dog.name)  <span class="comment"># è¾“å‡ºï¼šæ—ºè´¢</span></span><br><span class="line"><span class="built_in">print</span>(dog.age)   <span class="comment"># è¾“å‡ºï¼š3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¿é—®å­ç±»çš„å±æ€§</span></span><br><span class="line"><span class="built_in">print</span>(dog.breed)  <span class="comment"># è¾“å‡ºï¼šé‡‘æ¯›</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼ˆæœªè¢«é‡å†™ï¼‰</span></span><br><span class="line">dog.eat(<span class="string">&quot;éª¨å¤´&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šæ—ºè´¢æ­£åœ¨åƒéª¨å¤´</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨é‡å†™åçš„æ–¹æ³•ï¼ˆæ‰§è¡Œå­ç±»é€»è¾‘ï¼‰</span></span><br><span class="line">dog.move()  <span class="comment"># è¾“å‡ºï¼šæ—ºè´¢ï¼ˆé‡‘æ¯›ï¼‰æ­£åœ¨å¿«é€Ÿå¥”è·‘</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨å­ç±»ç‰¹æœ‰çš„æ–¹æ³•</span></span><br><span class="line">dog.bark()  <span class="comment"># è¾“å‡ºï¼šæ—ºè´¢æ±ªæ±ªå«ï¼</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åé¢ç¤ºä¾‹ï¼šå­ç±»æœªè°ƒç”¨çˆ¶ç±»__init__</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, color</span>):</span><br><span class="line">        <span class="variable language_">self</span>.color = color  <span class="comment"># ä»…å®šä¹‰å­ç±»å±æ€§ï¼Œæœªè°ƒç”¨çˆ¶ç±»__init__</span></span><br><span class="line"></span><br><span class="line">cat = Cat(<span class="string">&quot;æ©˜è‰²&quot;</span>)</span><br><span class="line"><span class="comment"># print(cat.name)  # æŠ¥é”™ï¼šAttributeError: &#x27;Cat&#x27; object has no attribute &#x27;name&#x27;</span></span><br><span class="line"><span class="comment"># cat.eat(&quot;é±¼&quot;)    # æŠ¥é”™ï¼šAttributeError: &#x27;Cat&#x27; object has no attribute &#x27;name&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-ç¤ºä¾‹ï¼šå¤šç»§æ‰¿ï¼ˆäº†è§£ï¼‰">&lt;3&gt;ç¤ºä¾‹ï¼šå¤šç»§æ‰¿ï¼ˆäº†è§£ï¼‰</h4>
<ul>
<li>å­ç±»ç»§æ‰¿å¤šä¸ªçˆ¶ç±»ï¼Œè¯­æ³•ä¸º <strong>class å­ç±»å(çˆ¶ç±»1, çˆ¶ç±»2, â€¦)</strong></li>
<li>æ³¨æ„ã€Œæ–¹æ³•è§£æé¡ºåºï¼ˆMROï¼‰ã€ï¼š
<ul>
<li>å½“å¤šä¸ªçˆ¶ç±»æœ‰åŒåæ–¹æ³•æ—¶ï¼Œå­ç±»æŒ‰ç»§æ‰¿åˆ—è¡¨çš„é¡ºåºä¼˜å…ˆè°ƒç”¨å‰é¢çˆ¶ç±»çš„æ–¹æ³•ã€‚</li>
<li>è‹¥è¦è°ƒç”¨åé¢çˆ¶ç±»çš„æ–¹æ³•ï¼Œå¯é€šè¿‡ç±»åç›´æ¥è°ƒç”¨å¹¶ä¼ é€’å®ä¾‹</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># çˆ¶ç±»1</span></span><br><span class="line"><span class="comment"># çˆ¶ç±»1ï¼šæ‹¥æœ‰è‡ªèº«å±æ€§å’Œæ–¹æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    <span class="comment"># çˆ¶ç±»1çš„å±æ€§</span></span><br><span class="line">    feature_a = <span class="string">&quot;æ¥è‡ªAç±»çš„ç‰¹å¾&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Aç±»çš„showæ–¹æ³•&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># çˆ¶ç±»1çš„ç‹¬æœ‰æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">func_a</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;è°ƒç”¨Aç±»ç‹¬æœ‰æ–¹æ³•ï¼Œ<span class="subst">&#123;self.feature_a&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># çˆ¶ç±»2ï¼šæ‹¥æœ‰è‡ªèº«å±æ€§å’Œæ–¹æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>:</span><br><span class="line">    <span class="comment"># çˆ¶ç±»2çš„å±æ€§</span></span><br><span class="line">    feature_b = <span class="string">&quot;æ¥è‡ªBç±»çš„ç‰¹å¾&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Bç±»çš„showæ–¹æ³•&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># çˆ¶ç±»2çš„ç‹¬æœ‰æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">func_b</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;è°ƒç”¨Bç±»ç‹¬æœ‰æ–¹æ³•ï¼Œ<span class="subst">&#123;self.feature_b&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å­ç±»Cç»§æ‰¿Aå’ŒBï¼ˆé¡ºåºï¼šAåœ¨å‰ï¼ŒBåœ¨åï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span>(A, B):</span><br><span class="line">    <span class="comment"># å­ç±»å¯æ–°å¢è‡ªèº«å±æ€§</span></span><br><span class="line">    own_feature = <span class="string">&quot;Cç±»è‡ªèº«çš„ç‰¹å¾&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å­ç±»å¯æ–°å¢è‡ªèº«æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">func_own</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;è°ƒç”¨Cç±»è‡ªèº«æ–¹æ³•ï¼Œ<span class="subst">&#123;self.own_feature&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®ä¾‹åŒ–C</span></span><br><span class="line">c = C()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. è®¿é—®ç»§æ‰¿è‡ªAç±»çš„å±æ€§å’Œç‹¬æœ‰æ–¹æ³•</span></span><br><span class="line"><span class="built_in">print</span>(c.feature_a)  <span class="comment"># è¾“å‡ºï¼šæ¥è‡ªAç±»çš„ç‰¹å¾</span></span><br><span class="line">c.func_a()          <span class="comment"># è¾“å‡ºï¼šè°ƒç”¨Aç±»ç‹¬æœ‰æ–¹æ³•ï¼Œæ¥è‡ªAç±»çš„ç‰¹å¾</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. è®¿é—®ç»§æ‰¿è‡ªBç±»çš„å±æ€§å’Œç‹¬æœ‰æ–¹æ³•</span></span><br><span class="line"><span class="built_in">print</span>(c.feature_b)  <span class="comment"># è¾“å‡ºï¼šæ¥è‡ªBç±»çš„ç‰¹å¾</span></span><br><span class="line">c.func_b()          <span class="comment"># è¾“å‡ºï¼šè°ƒç”¨Bç±»ç‹¬æœ‰æ–¹æ³•ï¼Œæ¥è‡ªBç±»çš„ç‰¹å¾</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. è®¿é—®å­ç±»è‡ªèº«çš„å±æ€§å’Œæ–¹æ³•</span></span><br><span class="line"><span class="built_in">print</span>(c.own_feature)<span class="comment"># è¾“å‡ºï¼šCç±»è‡ªèº«çš„ç‰¹å¾</span></span><br><span class="line">c.func_own()        <span class="comment"># è¾“å‡ºï¼šè°ƒç”¨Cç±»è‡ªèº«æ–¹æ³•ï¼ŒCç±»è‡ªèº«çš„ç‰¹å¾</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. è°ƒç”¨åŒåæ–¹æ³•show()ï¼Œéµå¾ªMROä¼˜å…ˆè°ƒç”¨Aç±»æ–¹æ³•ï¼ˆAåœ¨ç»§æ‰¿åˆ—è¡¨å‰ï¼‰</span></span><br><span class="line">c.show()            <span class="comment"># è¾“å‡ºï¼šAç±»çš„showæ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. æŸ¥çœ‹MROï¼ˆæ–¹æ³•è§£æé¡ºåºï¼‰ï¼šC -&gt; A -&gt; B -&gt; object</span></span><br><span class="line"><span class="built_in">print</span>(C.mro())  <span class="comment"># è¾“å‡ºï¼š[&lt;class &#x27;__main__.C&#x27;&gt;, &lt;class &#x27;__main__.A&#x27;&gt;, &lt;class &#x27;__main__.B&#x27;&gt;, &lt;class &#x27;object&#x27;&gt;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. è‹¥éœ€è°ƒç”¨Bç±»çš„åŒåshowæ–¹æ³•ï¼Œå¯é€šè¿‡ç±»åç›´æ¥è°ƒç”¨å¹¶ä¼ é€’å®ä¾‹</span></span><br><span class="line">B.show(c)  <span class="comment"># è¾“å‡ºï¼šBç±»çš„showæ–¹æ³•</span></span><br></pre></td></tr></table></figure>
<h4 id="è¡¥å……1ï¼šçˆ¶ç±»å„å±æ€§çš„ç»§æ‰¿æƒ…å†µ">è¡¥å……1ï¼šçˆ¶ç±»å„å±æ€§çš„ç»§æ‰¿æƒ…å†µ</h4>
<h5 id="1ï¼‰ç±»å±æ€§ï¼šå®Œå…¨ç»§æ‰¿">1ï¼‰ç±»å±æ€§ï¼šå®Œå…¨ç»§æ‰¿</h5>
<ul>
<li>å­ç±»ä¼šç›´æ¥ç»§æ‰¿çˆ¶ç±»çš„æ‰€æœ‰ç±»å±æ€§ï¼ˆå…¬å¼€ã€å•ä¸‹åˆ’çº¿ä¿æŠ¤çš„ç±»å±æ€§ï¼‰</li>
<li>é€šè¿‡ <strong>ã€Œå­ç±»å.ç±»å±æ€§åã€</strong> æˆ– <strong>ã€Œå­ç±»å®ä¾‹.ç±»å±æ€§åã€</strong> ç›´æ¥ <strong>è®¿é—®</strong>
<ul>
<li>å¦‚æœé€šè¿‡ã€Œå­ç±»å.ç±»å±æ€§åã€æˆ–ã€Œå­ç±»å®ä¾‹.ç±»å±æ€§åã€ <strong>ä¿®æ”¹</strong> â€”â€”&gt;å…¶å®æ˜¯<strong>å­ç±»é‡å†™è¯¥å±æ€§</strong></li>
</ul>
</li>
<li><strong>ä¿®æ”¹çˆ¶ç±»çš„ç±»å±æ€§ä¼šå½±å“æ‰€æœ‰å­ç±»å®ä¾‹ï¼ˆå­ç±»æœªé‡å†™è¯¥ç±»å±æ€§æ—¶ï¼‰</strong>ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># çˆ¶ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="comment"># ç±»å±æ€§ï¼šå…¬å¼€å±æ€§+å•ä¸‹åˆ’çº¿ä¿æŠ¤å±æ€§ï¼Œå‡å¯è¢«å­ç±»ç»§æ‰¿</span></span><br><span class="line">    species = <span class="string">&quot;äººç±»&quot;</span></span><br><span class="line">    _feature = <span class="string">&quot;è¯­è¨€èƒ½åŠ›&quot;</span>  <span class="comment"># ä¿æŠ¤ç±»å±æ€§ï¼Œå­ç±»ä»å¯ç»§æ‰¿/è®¿é—®</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å­ç±»ï¼ˆç»§æ‰¿çˆ¶ç±»ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>(<span class="title class_ inherited__">Person</span>):</span><br><span class="line">    <span class="keyword">pass</span>  <span class="comment"># æ— è‡ªå®šä¹‰å±æ€§ï¼Œå®Œå…¨ç»§æ‰¿çˆ¶ç±»æ‰€æœ‰ç±»å±æ€§</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. å­ç±»/å®ä¾‹è®¿é—®ç»§æ‰¿çš„ç±»å±æ€§ï¼ˆå«ä¿æŠ¤å±æ€§ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(Student.species)       <span class="comment"># å­ç±»åè®¿é—®å…¬å¼€ç±»å±æ€§ â†’ äººç±»</span></span><br><span class="line">stu1 = Student()</span><br><span class="line"><span class="built_in">print</span>(stu1._feature)         <span class="comment"># å®ä¾‹è®¿é—®ç»§æ‰¿çš„ä¿æŠ¤ç±»å±æ€§ â†’ è¯­è¨€èƒ½åŠ›</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. ä¿®æ”¹çˆ¶ç±»ç±»å±æ€§ï¼Œå½±å“å­ç±»å®ä¾‹</span></span><br><span class="line">Person.species = <span class="string">&quot;æ™ºäºº&quot;</span></span><br><span class="line"><span class="built_in">print</span>(stu1.species)          <span class="comment"># å­ç±»å®ä¾‹åŒæ­¥å˜åŒ– â†’ æ™ºäºº</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. å­ç±»åˆ›å»ºäº†è‡ªå·±çš„åŒåç±»å±æ€§ï¼Œé®è”½äº†çˆ¶ç±»çš„ç±»å±æ€§</span></span><br><span class="line">Student.species = <span class="string">&quot;å­¦ç”Ÿ&quot;</span></span><br><span class="line"><span class="built_in">print</span>(stu1.species)          <span class="comment"># å­ç±»å®ä¾‹ç”¨é‡å†™å€¼ â†’ å­¦ç”Ÿ</span></span><br><span class="line"><span class="built_in">print</span>(Person.species)        <span class="comment"># çˆ¶ç±»å±æ€§ä¸å˜ â†’ æ™ºäºº</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. å­ç±»å®ä¾‹ç›´æ¥ä¿®æ”¹ä¿æŠ¤ç±»å±æ€§ï¼ˆ_featureï¼‰ï¼Œå®é™…åˆ›å»ºåŒåå®ä¾‹å±æ€§</span></span><br><span class="line">stu1._feature = <span class="string">&quot;é€»è¾‘æ€ç»´èƒ½åŠ›&quot;</span></span><br><span class="line"><span class="built_in">print</span>(stu1._feature)         <span class="comment"># å®ä¾‹å±æ€§è¦†ç›– â†’ é€»è¾‘æ€ç»´èƒ½åŠ›</span></span><br><span class="line"><span class="built_in">print</span>(Student._feature)      <span class="comment"># å­ç±»ç±»å±æ€§ä»ä¸º â†’ è¯­è¨€èƒ½åŠ›</span></span><br><span class="line"><span class="built_in">print</span>(Person._feature)       <span class="comment"># çˆ¶ç±»ç±»å±æ€§ä»ä¸º â†’ è¯­è¨€èƒ½åŠ›</span></span><br></pre></td></tr></table></figure>
<h5 id="2ï¼‰å®ä¾‹å±æ€§ï¼šéœ€æ˜¾å¼è°ƒç”¨çˆ¶ç±»-init-æ‰ç»§æ‰¿">2ï¼‰å®ä¾‹å±æ€§ï¼šéœ€æ˜¾å¼è°ƒç”¨çˆ¶ç±»__init__æ‰ç»§æ‰¿</h5>
<ul>
<li>çˆ¶ç±»çš„å®ä¾‹å±æ€§å®šä¹‰åœ¨__init__ä¸­</li>
<li><strong>è‹¥å­ç±»è‡ªå®šä¹‰äº†__init__</strong>ï¼š
<ul>
<li>å¿…é¡»é€šè¿‡super().__init__(å‚æ•°)<strong>æ˜¾å¼è°ƒç”¨çˆ¶ç±»æ„é€ æ–¹æ³•</strong>ï¼Œæ‰èƒ½ç»§æ‰¿çˆ¶ç±»çš„å®ä¾‹å±æ€§</li>
</ul>
</li>
<li><strong>è‹¥å­ç±»æœªè‡ªå®šä¹‰__init__</strong>ï¼š
<ul>
<li>ä¼šè‡ªåŠ¨ç»§æ‰¿çˆ¶ç±»çš„__init__ï¼Œå®ä¾‹åŒ–æ—¶ç›´æ¥ä¼ å…¥çˆ¶ç±»æ‰€éœ€å‚æ•°å³å¯ç»§æ‰¿ã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># çˆ¶ç±»ï¼š__init__ä¸­å®šä¹‰å®ä¾‹å±æ€§nameã€age</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name  <span class="comment"># çˆ¶ç±»å®ä¾‹å±æ€§1</span></span><br><span class="line">        <span class="variable language_">self</span>.age = age    <span class="comment"># çˆ¶ç±»å®ä¾‹å±æ€§2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å­ç±»1ï¼šæœªè‡ªå®šä¹‰__init__ â†’ è‡ªåŠ¨ç»§æ‰¿çˆ¶ç±»__init__</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student1</span>(<span class="title class_ inherited__">Person</span>):</span><br><span class="line">    <span class="keyword">pass</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment"># å®ä¾‹åŒ–å­ç±»1ï¼šç›´æ¥ä¼ å…¥çˆ¶ç±»æ‰€éœ€å‚æ•°ï¼Œç»§æ‰¿æ‰€æœ‰å®ä¾‹å±æ€§</span></span><br><span class="line">stu1 = Student1(<span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="number">18</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Student1ï¼š<span class="subst">&#123;stu1.name&#125;</span>ï¼Œ<span class="subst">&#123;stu1.age&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šå¼ ä¸‰ï¼Œ18</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å­ç±»2ï¼šè‡ªå®šä¹‰__init__ä½†æœªè°ƒç”¨çˆ¶ç±»æ„é€ æ–¹æ³• â†’ ä¸ç»§æ‰¿çˆ¶ç±»å®ä¾‹å±æ€§</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student2</span>(<span class="title class_ inherited__">Person</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, school</span>):</span><br><span class="line">        <span class="variable language_">self</span>.school = school  <span class="comment"># ä»…å­ç±»è‡ªèº«å®ä¾‹å±æ€§</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®ä¾‹åŒ–å­ç±»2ï¼šä»…ä¼ å­ç±»å‚æ•°ï¼Œæ— æ³•è®¿é—®çˆ¶ç±»å±æ€§</span></span><br><span class="line">stu2 = Student2(<span class="string">&quot;åŒ—äº¬å¤§å­¦&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Student2ï¼š<span class="subst">&#123;stu2.school&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šåŒ—äº¬å¤§å­¦</span></span><br><span class="line"><span class="comment"># print(stu2.name)  # æŠ¥é”™ï¼š&#x27;Student2&#x27; object has no attribute &#x27;name&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å­ç±»3ï¼šè‡ªå®šä¹‰__init__ä¸”æ˜¾å¼è°ƒç”¨çˆ¶ç±»æ„é€ æ–¹æ³• â†’ ç»§æ‰¿çˆ¶ç±»å®ä¾‹å±æ€§</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student3</span>(<span class="title class_ inherited__">Person</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age, school</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(name, age)  <span class="comment"># æ˜¾å¼è°ƒç”¨çˆ¶ç±»__init__</span></span><br><span class="line">        <span class="variable language_">self</span>.school = school        <span class="comment"># å­ç±»æ‰©å±•å®ä¾‹å±æ€§</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®ä¾‹åŒ–å­ç±»3ï¼šä¼ å…¥çˆ¶ç±»+å­ç±»å‚æ•°ï¼Œå¯è®¿é—®æ‰€æœ‰å±æ€§</span></span><br><span class="line">stu3 = Student3(<span class="string">&quot;æå››&quot;</span>, <span class="number">20</span>, <span class="string">&quot;æ¸…åå¤§å­¦&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Student3ï¼š<span class="subst">&#123;stu3.name&#125;</span>ï¼Œ<span class="subst">&#123;stu3.age&#125;</span>ï¼Œ<span class="subst">&#123;stu3.school&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šæå››ï¼Œ20ï¼Œæ¸…åå¤§å­¦</span></span><br></pre></td></tr></table></figure>
<h5 id="3ï¼‰ç§æœ‰å±æ€§ï¼ˆåŒä¸‹åˆ’çº¿-attrï¼‰ï¼šä¸ç›´æ¥ç»§æ‰¿ï¼Œå¯é€šè¿‡çˆ¶ç±»å…¬å¼€æ–¹æ³•é—´æ¥è®¿é—®">3ï¼‰ç§æœ‰å±æ€§ï¼ˆåŒä¸‹åˆ’çº¿__attrï¼‰ï¼šä¸ç›´æ¥ç»§æ‰¿ï¼Œå¯é€šè¿‡çˆ¶ç±»å…¬å¼€æ–¹æ³•é—´æ¥è®¿é—®</h5>
<ul>
<li>çˆ¶ç±»çš„åŒä¸‹åˆ’çº¿ç§æœ‰å±æ€§ä¼šè¢« Python é€šè¿‡**ã€Œåç§°ä¿®é¥°ã€æœºåˆ¶**éšè—ï¼ˆä¿®é¥°ä¸º_çˆ¶ç±»å__ç§æœ‰å±æ€§åï¼‰</li>
<li>å­ç±»æ— æ³•ç›´æ¥é€šè¿‡åŸå±æ€§åè®¿é—®ï¼Œä¹Ÿä¸è§†ä¸º â€œç»§æ‰¿â€ äº†è¯¥å±æ€§ï¼ˆ<strong>è¯­æ³•å±‚é¢éš”ç¦»</strong>ï¼‰ã€‚</li>
<li>ä½†å­ç±»å¯é€šè¿‡çˆ¶ç±»æä¾›çš„å…¬å¼€ getter/setter æ–¹æ³•é—´æ¥æ“ä½œçˆ¶ç±»çš„ç§æœ‰å±æ€§ï¼ˆ<strong>æœ¬è´¨æ˜¯çˆ¶ç±»å†…éƒ¨å…è®¸è®¿é—®ï¼Œå­ç±»è°ƒç”¨çˆ¶ç±»æ–¹æ³•å®ç°</strong>ï¼‰</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name        <span class="comment"># å…¬å¼€å±æ€§</span></span><br><span class="line">        <span class="variable language_">self</span>.__age = age        <span class="comment"># ç§æœ‰å±æ€§ï¼ˆåç§°ä¿®é¥°ï¼‰</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å…¬å¼€æ–¹æ³•ï¼šæ“ä½œç§æœ‰å±æ€§ï¼ˆå‡½æ•°ä½“ç¼©è¿›4ç©ºæ ¼ï¼Œæ ¸å¿ƒè§„åˆ™ï¼‰</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_age</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.__age</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_age</span>(<span class="params">self, new_age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.__age = new_age</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>(<span class="title class_ inherited__">Person</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age, school</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(name, age)</span><br><span class="line">        <span class="variable language_">self</span>.school = school</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. å­ç±»æ— æ³•ç›´æ¥è®¿é—®çˆ¶ç±»ç§æœ‰å±æ€§</span></span><br><span class="line">stu = Student(<span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="number">18</span>, <span class="string">&quot;åŒ—å¤§&quot;</span>)</span><br><span class="line"><span class="comment"># print(stu.__age)  # æŠ¥é”™ï¼šæ— __ageå±æ€§</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. å­ç±»é€šè¿‡çˆ¶ç±»å…¬å¼€æ–¹æ³•é—´æ¥æ“ä½œ</span></span><br><span class="line"><span class="built_in">print</span>(stu.get_age())  <span class="comment"># è¾“å‡ºï¼š18</span></span><br><span class="line">stu.set_age(<span class="number">20</span>)</span><br><span class="line"><span class="built_in">print</span>(stu.get_age())  <span class="comment"># è¾“å‡ºï¼š20</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. éªŒè¯åç§°ä¿®é¥°ï¼ˆä»…ç†è§£ï¼Œç¦æ­¢ä½¿ç”¨ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(stu._Person__age)  <span class="comment"># è¾“å‡ºï¼š20</span></span><br></pre></td></tr></table></figure>
<h4 id="è¡¥å……2ï¼šçˆ¶ç±»å„ç±»æ–¹æ³•çš„ç»§æ‰¿æƒ…å†µ">è¡¥å……2ï¼šçˆ¶ç±»å„ç±»æ–¹æ³•çš„ç»§æ‰¿æƒ…å†µ</h4>
<h5 id="1ï¼‰å®ä¾‹æ–¹æ³•ï¼ˆå…¬å¼€ã€å•ä¸‹åˆ’çº¿ä¿æŠ¤ï¼‰ï¼šå®Œå…¨ç»§æ‰¿">1ï¼‰å®ä¾‹æ–¹æ³•ï¼ˆå…¬å¼€ã€å•ä¸‹åˆ’çº¿ä¿æŠ¤ï¼‰ï¼šå®Œå…¨ç»§æ‰¿</h5>
<ul>
<li>å­ç±»ä¼šç»§æ‰¿çˆ¶ç±»çš„æ‰€æœ‰å…¬å¼€å®ä¾‹æ–¹æ³•ï¼ˆæ— ä¸‹åˆ’çº¿ï¼‰ã€å•ä¸‹åˆ’çº¿ä¿æŠ¤å®ä¾‹æ–¹æ³•ï¼Œå¯é€šè¿‡å­ç±»å®ä¾‹ç›´æ¥è°ƒç”¨</li>
<li>è‹¥å­ç±»å®šä¹‰äº†ä¸çˆ¶ç±»åŒåçš„æ–¹æ³•ï¼Œä¼šé‡å†™çˆ¶ç±»æ–¹æ³•ï¼ˆè°ƒç”¨æ—¶ä¼˜å…ˆæ‰§è¡Œå­ç±»é€»è¾‘ï¼‰ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="comment"># å…¬å¼€å®ä¾‹æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">say_hello</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;çˆ¶ç±»ï¼šä½ å¥½ï¼&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å•ä¸‹åˆ’çº¿ä¿æŠ¤å®ä¾‹æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_show_info</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;çˆ¶ç±»ï¼šåŸºç¡€ä¿¡æ¯&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å­ç±»ç»§æ‰¿çˆ¶ç±»æ–¹æ³•ï¼Œå¹¶é‡å†™å…¬å¼€æ–¹æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>(<span class="title class_ inherited__">Person</span>):</span><br><span class="line">    <span class="comment"># é‡å†™çˆ¶ç±»å…¬å¼€æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">say_hello</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;å­ç±»ï¼šåŒå­¦ä½ å¥½ï¼&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. å­ç±»å®ä¾‹è°ƒç”¨ç»§æ‰¿çš„ä¿æŠ¤æ–¹æ³•</span></span><br><span class="line">stu = Student()</span><br><span class="line">stu._show_info()  <span class="comment"># è¾“å‡ºï¼šçˆ¶ç±»ï¼šåŸºç¡€ä¿¡æ¯ï¼ˆç»§æ‰¿ä¿æŠ¤æ–¹æ³•ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. å­ç±»å®ä¾‹è°ƒç”¨é‡å†™åçš„å…¬å¼€æ–¹æ³•</span></span><br><span class="line">stu.say_hello()   <span class="comment"># è¾“å‡ºï¼šå­ç±»ï¼šåŒå­¦ä½ å¥½ï¼ï¼ˆä¼˜å…ˆæ‰§è¡Œå­ç±»é€»è¾‘ï¼‰</span></span><br></pre></td></tr></table></figure>
<h5 id="2ï¼‰ç±»æ–¹æ³•ã€é™æ€æ–¹æ³•ï¼šå®Œå…¨ç»§æ‰¿">2ï¼‰ç±»æ–¹æ³•ã€é™æ€æ–¹æ³•ï¼šå®Œå…¨ç»§æ‰¿</h5>
<ul>
<li>å­ç±»ä¼šç›´æ¥ç»§æ‰¿çˆ¶ç±»çš„å…¬å¼€ / ä¿æŠ¤ç±»æ–¹æ³•ï¼ˆ<strong>@classmethodä¿®é¥°</strong>ï¼‰ã€é™æ€æ–¹æ³•ï¼ˆ<strong>@staticmethodä¿®é¥°</strong>ï¼‰</li>
<li>é€šè¿‡ã€Œ<strong>å­ç±»å.æ–¹æ³•å</strong>ã€æˆ–ã€Œ<strong>å­ç±»å®ä¾‹.æ–¹æ³•å</strong>ã€è°ƒç”¨</li>
<li>å­ç±»å¯é‡å†™çˆ¶ç±»çš„ç±»æ–¹æ³•ã€é™æ€æ–¹æ³•ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="comment"># ç±»æ–¹æ³•</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">class_func</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;çˆ¶ç±»ç±»æ–¹æ³•&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># é™æ€æ–¹æ³•</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">static_func</span>():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;çˆ¶ç±»é™æ€æ–¹æ³•&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>(<span class="title class_ inherited__">Person</span>):</span><br><span class="line">    <span class="comment"># é‡å†™çˆ¶ç±»ç±»æ–¹æ³•</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">class_func</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;å­ç±»ç±»æ–¹æ³•&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. å­ç±»åè°ƒç”¨ç»§æ‰¿çš„é™æ€æ–¹æ³•</span></span><br><span class="line">Student.static_func()  <span class="comment"># è¾“å‡ºï¼šçˆ¶ç±»é™æ€æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. å­ç±»å®ä¾‹è°ƒç”¨ç»§æ‰¿çš„é™æ€æ–¹æ³•</span></span><br><span class="line">stu = Student()</span><br><span class="line">stu.static_func()      <span class="comment"># è¾“å‡ºï¼šçˆ¶ç±»é™æ€æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. å­ç±»åè°ƒç”¨é‡å†™åçš„ç±»æ–¹æ³•</span></span><br><span class="line">Student.class_func()   <span class="comment"># è¾“å‡ºï¼šå­ç±»ç±»æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. å­ç±»å®ä¾‹è°ƒç”¨é‡å†™åçš„ç±»æ–¹æ³•</span></span><br><span class="line">stu.class_func()       <span class="comment"># è¾“å‡ºï¼šå­ç±»ç±»æ–¹æ³•</span></span><br></pre></td></tr></table></figure>
<h5 id="3ï¼‰ç§æœ‰æ–¹æ³•ï¼ˆåŒä¸‹åˆ’çº¿-methodï¼‰ï¼šä¸ç›´æ¥ç»§æ‰¿ï¼Œå¯é€šè¿‡çˆ¶ç±»å…¬å¼€æ–¹æ³•é—´æ¥è°ƒç”¨">3ï¼‰ç§æœ‰æ–¹æ³•ï¼ˆåŒä¸‹åˆ’çº¿__methodï¼‰ï¼šä¸ç›´æ¥ç»§æ‰¿ï¼Œå¯é€šè¿‡çˆ¶ç±»å…¬å¼€æ–¹æ³•é—´æ¥è°ƒç”¨</h5>
<ul>
<li>ä¸ç§æœ‰å±æ€§ç±»ä¼¼ï¼Œçˆ¶ç±»çš„åŒä¸‹åˆ’çº¿ç§æœ‰æ–¹æ³•ä¼šè¢«åç§°ä¿®é¥°ï¼ˆä¿®é¥°ä¸º <strong>_çˆ¶ç±»å__ç§æœ‰æ–¹æ³•å</strong>ï¼‰</li>
<li>å­ç±»æ— æ³•ç›´æ¥è°ƒç”¨ï¼Œåªèƒ½<strong>é€šè¿‡çˆ¶ç±»çš„å…¬å¼€æ–¹æ³•é—´æ¥è§¦å‘</strong>ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># åŒä¸‹åˆ’çº¿ç§æœ‰æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__private_func</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;çˆ¶ç±»ç§æœ‰æ–¹æ³•&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å…¬å¼€æ–¹æ³•ï¼šé—´æ¥è§¦å‘ç§æœ‰æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">call_private</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.__private_func()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>(<span class="title class_ inherited__">Person</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">try_call_private</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># ç›´æ¥è°ƒç”¨çˆ¶ç±»ç§æœ‰æ–¹æ³•ä¼šæŠ¥é”™</span></span><br><span class="line">        <span class="comment"># self.__private_func()</span></span><br><span class="line">        <span class="comment"># è°ƒç”¨çˆ¶ç±»å…¬å¼€æ–¹æ³•é—´æ¥è§¦å‘ç§æœ‰æ–¹æ³•</span></span><br><span class="line">        <span class="variable language_">self</span>.call_private()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. å­ç±»å®ä¾‹æ— æ³•ç›´æ¥è°ƒç”¨ç§æœ‰æ–¹æ³•</span></span><br><span class="line">stu = Student()</span><br><span class="line"><span class="comment"># stu.__private_func()  # æŠ¥é”™ï¼šæ— è¯¥å±æ€§</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. å­ç±»é€šè¿‡çˆ¶ç±»å…¬å¼€æ–¹æ³•é—´æ¥è§¦å‘ç§æœ‰æ–¹æ³•</span></span><br><span class="line">stu.try_call_private()  <span class="comment"># è¾“å‡ºï¼šçˆ¶ç±»ç§æœ‰æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. éªŒè¯åç§°ä¿®é¥°ï¼ˆä»…ç†è§£ï¼Œç¦æ­¢ä½¿ç”¨ï¼‰</span></span><br><span class="line">stu._Person__private_func()  <span class="comment"># è¾“å‡ºï¼šçˆ¶ç±»ç§æœ‰æ–¹æ³•</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260111114413251.png" alt=""></p>
<h3 id="ï¼ˆ3ï¼‰å¤šæ€">ï¼ˆ3ï¼‰å¤šæ€</h3>
<ul>
<li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼š
<ul>
<li>åŒä¸€æ–¹æ³•ååœ¨ä¸åŒç±»ä¸­æœ‰ä¸åŒçš„å®ç°é€»è¾‘ï¼Œå½“è°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œæ ¹æ®å¯¹è±¡çš„å®é™…ç±»å‹æ‰§è¡Œå¯¹åº”çš„é€»è¾‘ï¼ˆå³â€œä¸€ä¸ªæ¥å£ï¼Œå¤šç§å®ç°â€ï¼‰ã€‚</li>
<li>å¤šæ€ä¾èµ–äºç»§æ‰¿å’Œé‡å†™ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯æé«˜ä»£ç çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚</li>
</ul>
</li>
<li><strong>å®ç°æ¡ä»¶</strong>ï¼š
<ul>
<li>å­˜åœ¨ç»§æ‰¿å…³ç³»ï¼ˆå­ç±»ç»§æ‰¿çˆ¶ç±»ï¼‰</li>
<li>å­ç±»é‡å†™çˆ¶ç±»çš„æ–¹æ³•</li>
<li>ä½¿ç”¨<strong>çˆ¶ç±»ç±»å‹çš„å˜é‡å¼•ç”¨å­ç±»å¯¹è±¡</strong>ï¼Œ<strong>è°ƒç”¨é‡å†™æ–¹æ³•</strong>æ—¶è‡ªåŠ¨åŒ¹é…å­ç±»é€»è¾‘ã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># çˆ¶ç±»ï¼šAnimal</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># çˆ¶ç±»æ–¹æ³•ï¼ˆè¢«å­ç±»é‡å†™ï¼‰</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">make_sound</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span>å‘å‡ºå£°éŸ³&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å­ç±»1ï¼šDogï¼ˆé‡å†™make_soundï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">make_sound</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span>æ±ªæ±ªå«ï¼&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å­ç±»2ï¼šCatï¼ˆé‡å†™make_soundï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">make_sound</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span>å–µå–µå«ï¼&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å­ç±»3ï¼šDuckï¼ˆé‡å†™make_soundï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Duck</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">make_sound</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span>å˜å˜å«ï¼&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤šæ€æ ¸å¿ƒï¼šç»Ÿä¸€æ¥å£ï¼ˆè°ƒç”¨make_soundï¼‰ï¼Œä¸åŒå¯¹è±¡æ‰§è¡Œä¸åŒé€»è¾‘</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">animal_sound</span>(<span class="params">animal</span>):</span><br><span class="line">    <span class="comment"># æ¥æ”¶Animalç±»å‹çš„å‚æ•°ï¼ˆå®é™…å¯ä¼ å…¥ä»»æ„å­ç±»å¯¹è±¡ï¼‰</span></span><br><span class="line">    animal.make_sound()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®ä¾‹åŒ–ä¸åŒå­ç±»</span></span><br><span class="line">dog = Dog(<span class="string">&quot;æ—ºè´¢&quot;</span>)</span><br><span class="line">cat = Cat(<span class="string">&quot;å’ªå®&quot;</span>)</span><br><span class="line">duck = Duck(<span class="string">&quot;å°é»„&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨ç»Ÿä¸€æ¥å£ï¼Œè‡ªåŠ¨åŒ¹é…å­ç±»é€»è¾‘</span></span><br><span class="line">animal_sound(dog)  <span class="comment"># è¾“å‡ºï¼šæ—ºè´¢æ±ªæ±ªå«ï¼</span></span><br><span class="line">animal_sound(cat)  <span class="comment"># è¾“å‡ºï¼šå’ªå®å–µå–µå«ï¼</span></span><br><span class="line">animal_sound(duck) <span class="comment"># è¾“å‡ºï¼šå°é»„å˜å˜å«ï¼</span></span><br></pre></td></tr></table></figure>
<h2 id="5-ç±»çš„é«˜çº§ç”¨æ³•">5.ç±»çš„é«˜çº§ç”¨æ³•</h2>
<h3 id="ï¼ˆ1ï¼‰é­”æœ¯æ–¹æ³•ï¼ˆç‰¹æ®Šæ–¹æ³•ï¼‰">ï¼ˆ1ï¼‰é­”æœ¯æ–¹æ³•ï¼ˆç‰¹æ®Šæ–¹æ³•ï¼‰</h3>
<p>Pythonç±»ä¸­<strong>ä»¥ __ å¼€å¤´å’Œç»“å°¾</strong>çš„æ–¹æ³•ç§°ä¸ºâ€œé­”æœ¯æ–¹æ³•â€ï¼ˆå¦‚__init__ï¼‰ï¼Œå®ƒä»¬åœ¨<strong>ç‰¹å®šåœºæ™¯ä¸‹è‡ªåŠ¨è°ƒç”¨ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨</strong></p>
<h4 id="1-æ„é€ ä¸ææ„ç›¸å…³">&lt;1&gt;æ„é€ ä¸ææ„ç›¸å…³</h4>
<ul>
<li><strong>__init__(self, â€¦)</strong>ï¼šæ„é€ æ–¹æ³•ï¼Œå®ä¾‹åŒ–å¯¹è±¡æ—¶è‡ªåŠ¨è°ƒç”¨ï¼ˆåˆå§‹åŒ–å±æ€§ï¼‰ã€‚</li>
<li><strong>__del__(self)</strong>ï¼šï¼šææ„æ–¹æ³•ï¼Œå¯¹è±¡è¢«åƒåœ¾å›æ”¶æ—¶è‡ªåŠ¨è°ƒç”¨ï¼ˆé‡Šæ”¾èµ„æºï¼Œå¦‚å…³é—­æ–‡ä»¶ï¼‰ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FileHandler</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, filename</span>):</span><br><span class="line">        <span class="variable language_">self</span>.filename = filename</span><br><span class="line">        <span class="variable language_">self</span>.file = <span class="built_in">open</span>(filename, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æ‰“å¼€æ–‡ä»¶ï¼š<span class="subst">&#123;self.filename&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">read_content</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.file.read()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__del__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.file.close()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;å…³é—­æ–‡ä»¶ï¼š<span class="subst">&#123;self.filename&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®ä¾‹åŒ–</span></span><br><span class="line">fh = FileHandler(<span class="string">&quot;test.txt&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(fh.read_content())</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼šï¼ˆæ–‡ä»¶å†…å®¹ï¼‰</span></span><br><span class="line"><span class="comment"># ç¨‹åºç»“æŸæ—¶è‡ªåŠ¨è¾“å‡ºï¼šå…³é—­æ–‡ä»¶ï¼štest.txt</span></span><br></pre></td></tr></table></figure>
<h4 id="2-è¿ç®—ç¬¦é‡è½½ç›¸å…³">&lt;2&gt;è¿ç®—ç¬¦é‡è½½ç›¸å…³</h4>
<p>é€šè¿‡é‡å†™é­”æœ¯æ–¹æ³•ï¼Œè®©è‡ªå®šä¹‰ç±»çš„å¯¹è±¡æ”¯æŒPythonå†…ç½®è¿ç®—ç¬¦ï¼ˆå¦‚ +ã€-ã€==ã€&lt; ç­‰ï¼‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, x, y</span>):</span><br><span class="line">        <span class="variable language_">self</span>.x = x</span><br><span class="line">        <span class="variable language_">self</span>.y = y</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># é‡è½½ + è¿ç®—ç¬¦ï¼ˆå®ç°ä¸¤ä¸ªPointå¯¹è±¡ç›¸åŠ ï¼‰</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__add__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> Point(<span class="variable language_">self</span>.x + other.x, <span class="variable language_">self</span>.y + other.y)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># é‡è½½ == è¿ç®—ç¬¦ï¼ˆåˆ¤æ–­ä¸¤ä¸ªPointå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼‰</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__eq__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.x == other.x <span class="keyword">and</span> <span class="variable language_">self</span>.y == other.y</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># é‡è½½å­—ç¬¦ä¸²è¾“å‡ºï¼ˆprintå¯¹è±¡æ—¶æ˜¾ç¤ºè‡ªå®šä¹‰æ ¼å¼ï¼‰</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;Point(<span class="subst">&#123;self.x&#125;</span>, <span class="subst">&#123;self.y&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®ä¾‹åŒ–</span></span><br><span class="line">p1 = Point(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">p2 = Point(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨__add__ï¼ˆ+è¿ç®—ç¬¦ï¼‰</span></span><br><span class="line">p3 = p1 + p2</span><br><span class="line"><span class="built_in">print</span>(p3)  <span class="comment"># è¾“å‡ºï¼šPoint(4, 6)ï¼ˆè°ƒç”¨__str__ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨__eq__ï¼ˆ==è¿ç®—ç¬¦ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(p1 == p2)  <span class="comment"># è¾“å‡ºï¼šFalse</span></span><br><span class="line"><span class="built_in">print</span>(p1 == Point(<span class="number">1</span>, <span class="number">2</span>))  <span class="comment"># è¾“å‡ºï¼šTrue</span></span><br></pre></td></tr></table></figure>
<p><strong>æƒ³è¿›ä¸€æ­¥äº†è§£ï¼Œè¯·å‚è€ƒ:</strong><a href="/2026/01/09/Python/%E3%80%8A%E6%B5%81%E7%95%85%E7%9A%84python%E3%80%8B/%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9APython%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B/">Pythonæ•°æ®æ¨¡å‹</a></p>
<h3 id="ï¼ˆ2ï¼‰ç±»çš„ç»„åˆ-a-id-class-composition-a">ï¼ˆ2ï¼‰ç±»çš„ç»„åˆ <a id="class-composition"></a></h3>
<ul>
<li>ç»„åˆæ˜¯å¦ä¸€ç§ä»£ç å¤ç”¨æ–¹å¼ï¼ŒæŒ‡<strong>ä¸€ä¸ªç±»çš„å±æ€§æ˜¯å¦ä¸€ä¸ªç±»çš„å¯¹è±¡</strong>ï¼ˆå³â€œä¸€ä¸ªç±»åŒ…å«å¦ä¸€ä¸ªç±»â€ï¼‰</li>
<li>é€‚ç”¨äºâ€œæ•´ä½“-éƒ¨åˆ†â€å…³ç³»ï¼ˆå¦‚â€œæ±½è½¦â€åŒ…å«â€œå‘åŠ¨æœºâ€ã€â€œè½®èƒâ€ï¼‰ã€‚ç»„åˆæ¯”ç»§æ‰¿æ›´çµæ´»ï¼Œé¿å…äº†ç»§æ‰¿çš„è€¦åˆæ€§ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># éƒ¨åˆ†ç±»1ï¼šå‘åŠ¨æœº</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Engine</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;å‘åŠ¨æœºå¯åŠ¨&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">stop</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;å‘åŠ¨æœºå…³é—­&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># éƒ¨åˆ†ç±»2ï¼šè½®èƒ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tire</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, brand</span>):</span><br><span class="line">        <span class="variable language_">self</span>.brand = brand</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">rotate</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.brand&#125;</span>è½®èƒæ—‹è½¬&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•´ä½“ç±»ï¼šæ±½è½¦ï¼ˆç»„åˆEngineå’ŒTireï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, tire_brand</span>):</span><br><span class="line">        <span class="comment"># ç»„åˆï¼šCarç±»åŒ…å«Engineå¯¹è±¡å’ŒTireå¯¹è±¡</span></span><br><span class="line">        <span class="variable language_">self</span>.engine = Engine()</span><br><span class="line">        <span class="variable language_">self</span>.tire1 = Tire(tire_brand)</span><br><span class="line">        <span class="variable language_">self</span>.tire2 = Tire(tire_brand)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.engine.start()</span><br><span class="line">        <span class="variable language_">self</span>.tire1.rotate()</span><br><span class="line">        <span class="variable language_">self</span>.tire2.rotate()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;æ±½è½¦è¡Œé©¶ä¸­...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®ä¾‹åŒ–æ±½è½¦</span></span><br><span class="line">car = Car(<span class="string">&quot;ç±³å…¶æ—&quot;</span>)</span><br><span class="line">car.run()</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment"># å‘åŠ¨æœºå¯åŠ¨</span></span><br><span class="line"><span class="comment"># ç±³å…¶æ—è½®èƒæ—‹è½¬</span></span><br><span class="line"><span class="comment"># ç±³å…¶æ—è½®èƒæ—‹è½¬</span></span><br><span class="line"><span class="comment"># æ±½è½¦è¡Œé©¶ä¸­...</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰æŠ½è±¡ç±»ï¼ˆABCæ¨¡å—ï¼‰">ï¼ˆ3ï¼‰æŠ½è±¡ç±»ï¼ˆABCæ¨¡å—ï¼‰</h3>
<ul>
<li>æŠ½è±¡ç±»æ˜¯ä¸€ç§â€œ<strong>ä¸èƒ½å®ä¾‹åŒ–</strong>â€çš„ç±»ï¼Œç”¨äºå®šä¹‰å­ç±»å¿…é¡»å®ç°çš„æ–¹æ³•ï¼ˆè§„èŒƒå­ç±»æ¥å£ï¼‰ã€‚</li>
<li>Pythoné€šè¿‡ abc æ¨¡å—å®ç°æŠ½è±¡ç±»</li>
<li>æ ¸å¿ƒä½œç”¨ï¼šæ˜¯å¼ºåˆ¶å­ç±»éµå¾ªç»Ÿä¸€çš„æ¥å£è§„èŒƒã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="comment"># ABC æ˜¯ Abstract Base Class çš„ç¼©å†™ï¼Œä¸” Python 3.4+ æ¨èç›´æ¥ç»§æ‰¿ ABCï¼Œè€Œéä½¿ç”¨ metaclass=ABCMeta</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŠ½è±¡ç±»ï¼ˆç»§æ‰¿ABCï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">    <span class="comment"># æŠ½è±¡æ–¹æ³•ï¼ˆå­ç±»å¿…é¡»é‡å†™ï¼‰</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">area</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æŠ½è±¡æ–¹æ³•ï¼ˆå­ç±»å¿…é¡»é‡å†™ï¼‰</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">perimeter</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å­ç±»1ï¼šåœ†å½¢ï¼ˆå®ç°æŠ½è±¡æ–¹æ³•ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span>(<span class="title class_ inherited__">Shape</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, radius</span>):</span><br><span class="line">        <span class="variable language_">self</span>.radius = radius</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">area</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">3.14</span> * <span class="variable language_">self</span>.radius ** <span class="number">2</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">perimeter</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * <span class="number">3.14</span> * <span class="variable language_">self</span>.radius</span><br><span class="line"></span><br><span class="line"><span class="comment"># å­ç±»2ï¼šæ­£æ–¹å½¢ï¼ˆå®ç°æŠ½è±¡æ–¹æ³•ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Square</span>(<span class="title class_ inherited__">Shape</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, side</span>):</span><br><span class="line">        <span class="variable language_">self</span>.side = side</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">area</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.side ** <span class="number">2</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">perimeter</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">4</span> * <span class="variable language_">self</span>.side</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŠ½è±¡ç±»ä¸èƒ½å®ä¾‹åŒ–ï¼ˆæŠ¥é”™ï¼‰</span></span><br><span class="line"><span class="comment"># shape = Shape()  # TypeError: Can&#x27;t instantiate abstract class Shape with abstract method area, perimeter</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å­ç±»å¯å®ä¾‹åŒ–ï¼ˆå·²å®ç°æ‰€æœ‰æŠ½è±¡æ–¹æ³•ï¼‰</span></span><br><span class="line">circle = Circle(<span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;åœ†å½¢é¢ç§¯ï¼š<span class="subst">&#123;circle.area()&#125;</span>, å‘¨é•¿ï¼š<span class="subst">&#123;circle.perimeter()&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šåœ†å½¢é¢ç§¯ï¼š78.5, å‘¨é•¿ï¼š31.4</span></span><br><span class="line"></span><br><span class="line">square = Square(<span class="number">4</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æ­£æ–¹å½¢é¢ç§¯ï¼š<span class="subst">&#123;square.area()&#125;</span>, å‘¨é•¿ï¼š<span class="subst">&#123;square.perimeter()&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šæ­£æ–¹å½¢é¢ç§¯ï¼š16, å‘¨é•¿ï¼š16</span></span><br></pre></td></tr></table></figure>
<h2 id="6-å¯¼å…¥ç±»">6.å¯¼å…¥ç±»</h2>
<p>åœ¨ Python ä¸­ï¼Œâ€œå¯¼å…¥ç±»â€æ˜¯å®ç°ä»£ç æ¨¡å—åŒ–å¤ç”¨çš„æ ¸å¿ƒæ‰‹æ®µï¼Œé€šè¿‡å°†ä¸åŒåŠŸèƒ½çš„ç±»æ‹†åˆ†åˆ°ä¸åŒâ€œ<strong>æ¨¡å—</strong>â€ï¼ˆ<strong>.py æ–‡ä»¶</strong>ï¼‰ï¼Œå¯å¤§å¹…æå‡ä»£ç çš„å¯ç»´æŠ¤æ€§ã€å¯è¯»æ€§å’Œå¤ç”¨æ€§ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260111154058716.png" alt=""></p>
<h3 id="ï¼ˆ1ï¼‰æ ¸å¿ƒæ¦‚å¿µ-2">ï¼ˆ1ï¼‰æ ¸å¿ƒæ¦‚å¿µ</h3>
<ul>
<li><strong>æ¨¡å—ï¼ˆmoduleï¼‰</strong>ï¼š
<ul>
<li>æœ¬è´¨æ˜¯ä¸€ä¸ª <strong>.py åç¼€</strong>çš„ Python æ–‡ä»¶ï¼Œå¯åŒ…å«ç±»ã€å‡½æ•°ã€å˜é‡ç­‰ä»£ç ç‰‡æ®µï¼Œæ˜¯ä»£ç ç»„ç»‡çš„åŸºæœ¬å•ä½ã€‚
<ul>
<li>ä¾‹å¦‚ï¼š<a href="http://animal.py">animal.py</a> å°±æ˜¯ä¸€ä¸ªæ¨¡å—</li>
</ul>
</li>
</ul>
</li>
<li><strong>åŒ…ï¼ˆpackageï¼‰</strong>ï¼š
<ul>
<li><strong>åŒ…å«å¤šä¸ªæ¨¡å—çš„ç›®å½•</strong>ï¼Œéœ€åŒ…å« <strong>__init__.py</strong> æ–‡ä»¶ï¼ˆPython 3.3+ å¯çœç•¥ï¼Œä½†æ¨èä¿ç•™ï¼‰ï¼Œç”¨äºç®¡ç†å¤šæ¨¡å—å±‚çº§ç»“æ„ã€‚
<ul>
<li>ä¾‹å¦‚ my_package/ ç›®å½•ä¸‹åŒ…å« <a href="http://animal.py">animal.py</a>ã€<a href="http://person.py">person.py</a>ï¼Œåˆ™ my_package æ˜¯åŒ…</li>
</ul>
</li>
</ul>
</li>
<li><strong>å¯¼å…¥æ ¸å¿ƒç›®çš„</strong>ï¼š
<ul>
<li>åœ¨å½“å‰æ¨¡å—ä¸­å¤ç”¨å…¶ä»–æ¨¡å—å·²å®šä¹‰çš„ç±»ï¼Œé¿å…é‡å¤ç¼–ç ï¼›</li>
<li>å®ç°ä»£ç åŠŸèƒ½æ‹†åˆ†ï¼Œè®©ä¸åŒæ¨¡å—è´Ÿè´£ä¸åŒä¸šåŠ¡é€»è¾‘ã€‚</li>
</ul>
</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰å¯¼å…¥å•ä¸ªç±»">ï¼ˆ2ï¼‰å¯¼å…¥å•ä¸ªç±»</h3>
<p>é€‚ç”¨äºåªéœ€ä½¿ç”¨ç›®æ ‡æ¨¡å—ä¸­æŸä¸€ä¸ªç‰¹å®šç±»çš„åœºæ™¯ï¼Œè¯­æ³•ç®€æ´ï¼Œå¯¼å…¥åå¯ç›´æ¥ä½¿ç”¨ç±»åè°ƒç”¨ã€‚</p>
<h4 id="1-è¯­æ³•æ ¼å¼">&lt;1&gt;è¯­æ³•æ ¼å¼</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> æ¨¡å—å <span class="keyword">import</span> ç±»å</span><br></pre></td></tr></table></figure>
<h4 id="2-å®æˆ˜ç¤ºä¾‹">&lt;2&gt;å®æˆ˜ç¤ºä¾‹</h4>
<ul>
<li>æ­¥éª¤1ï¼šå®šä¹‰æ¨¡å—ï¼ˆè¢«å¯¼å…¥æ–¹ï¼‰â€”â€” æ–°å»ºanimal.pyæ–‡ä»¶ï¼Œå®šä¹‰å•ä¸ªç±»</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># animal.pyï¼ˆæ¨¡å—ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">eat</span>(<span class="params">self, food</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span>ï¼ˆ<span class="subst">&#123;self.age&#125;</span>å²ï¼‰æ­£åœ¨åƒ<span class="subst">&#123;food&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>æ­¥éª¤2ï¼šå¯¼å…¥å¹¶ä½¿ç”¨ï¼ˆå¯¼å…¥æ–¹ï¼‰â€”â€” æ–°å»º <a href="http://main.py">main.py</a>ï¼Œä» <a href="http://animal.py">animal.py</a> ä¸­å¯¼å…¥ Animal ç±»</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># main.pyï¼ˆå½“å‰æ¨¡å—ï¼‰</span></span><br><span class="line"><span class="keyword">from</span> animal <span class="keyword">import</span> Animal  <span class="comment"># ä» animal æ¨¡å—å¯¼å…¥ Animal ç±»</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›´æ¥ä½¿ç”¨å¯¼å…¥çš„ç±»å®ä¾‹åŒ–</span></span><br><span class="line">dog = Animal(<span class="string">&quot;æ—ºè´¢&quot;</span>, <span class="number">3</span>)</span><br><span class="line">dog.eat(<span class="string">&quot;éª¨å¤´&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šæ—ºè´¢ï¼ˆ3å²ï¼‰æ­£åœ¨åƒéª¨å¤´</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰åœ¨ä¸€ä¸ªæ¨¡å—ä¸­å­˜å‚¨å¤šä¸ªç±»">ï¼ˆ3ï¼‰åœ¨ä¸€ä¸ªæ¨¡å—ä¸­å­˜å‚¨å¤šä¸ªç±»</h3>
<p>é€‚ç”¨äºå¤šä¸ªç±»åŠŸèƒ½å…³è”ç´§å¯†ï¼ˆå¦‚åŒä¸€ä¸šåŠ¡é¢†åŸŸçš„ä¸åŒå®ä½“ï¼‰çš„åœºæ™¯ï¼Œå°†ç›¸å…³ç±»é›†ä¸­å­˜å‚¨åœ¨ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œä¾¿äºç®¡ç†å’Œç»´æŠ¤ã€‚</p>
<h4 id="1-æ ¸å¿ƒåŸåˆ™">&lt;1&gt;æ ¸å¿ƒåŸåˆ™</h4>
<p>æ¨¡å—å†…çš„ç±»éœ€åŠŸèƒ½ç›¸å…³ï¼Œé¿å…å°†æ— å…³è”çš„ç±»éšæ„æ”¾åœ¨åŒä¸€æ¨¡å—ï¼ˆå¦‚å°†â€œåŠ¨ç‰©ç±»â€å’Œâ€œæ•°æ®åº“æ“ä½œç±»â€æ”¾åœ¨åŒä¸€æ¨¡å—ä¼šå¯¼è‡´æ··ä¹±ï¼‰ã€‚</p>
<h4 id="2-å®æˆ˜ç¤ºä¾‹-2">&lt;2&gt;å®æˆ˜ç¤ºä¾‹</h4>
<ul>
<li>æ­¥éª¤1ï¼šæ¨¡å—ä¸­å®šä¹‰å¤šä¸ªå…³è”ç±»â€”â€” ä¿®æ”¹ <a href="http://animal.py">animal.py</a>ï¼Œæ–°å¢ Dogã€Cat ç±»ï¼ˆå‡ç»§æ‰¿ Animalï¼‰</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># animal.pyï¼ˆå­˜å‚¨å¤šä¸ªå…³è”ç±»ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>:  <span class="comment"># çˆ¶ç±»</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">eat</span>(<span class="params">self, food</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span>ï¼ˆ<span class="subst">&#123;self.age&#125;</span>å²ï¼‰æ­£åœ¨åƒ<span class="subst">&#123;food&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>(<span class="title class_ inherited__">Animal</span>):  <span class="comment"># å­ç±»1ï¼šç‹—</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">bark</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span>æ±ªæ±ªå«ï¼&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span>(<span class="title class_ inherited__">Animal</span>):  <span class="comment"># å­ç±»2ï¼šçŒ«</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">meow</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span>å–µå–µå«ï¼&quot;</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>æ­¥éª¤2ï¼šå¯¼å…¥ä½¿ç”¨æ¨¡å—ä¸­çš„å¤šä¸ªç±» â€”â€” åœ¨ <a href="http://main.py">main.py</a> ä¸­å¯æŒ‰éœ€å¯¼å…¥å…¶ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªç±»ã€‚ï¼ˆè§ä¸‹æ–‡ï¼‰</li>
</ul>
<h3 id="ï¼ˆ4ï¼‰ä»ä¸€ä¸ªæ¨¡å—ä¸­å¯¼å…¥å¤šä¸ªç±»">ï¼ˆ4ï¼‰ä»ä¸€ä¸ªæ¨¡å—ä¸­å¯¼å…¥å¤šä¸ªç±»</h3>
<p>é€‚ç”¨äºéœ€è¦ä½¿ç”¨ç›®æ ‡æ¨¡å—ä¸­å¤šä¸ªç±»çš„åœºæ™¯ï¼Œé€šè¿‡é€—å·åˆ†éš”ç±»åï¼Œä¸€æ¬¡æ€§å¯¼å…¥å¤šä¸ªæ‰€éœ€ç±»ã€‚</p>
<h4 id="1-è¯­æ³•æ ¼å¼-2">&lt;1&gt;è¯­æ³•æ ¼å¼</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> æ¨¡å—å <span class="keyword">import</span> ç±»å<span class="number">1</span>, ç±»å<span class="number">2</span>, ç±»å<span class="number">3</span></span><br></pre></td></tr></table></figure>
<h4 id="2-å®æˆ˜æ¼”ç¤º">&lt;2&gt;å®æˆ˜æ¼”ç¤º</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"><span class="keyword">from</span> animal <span class="keyword">import</span> Dog, Cat  <span class="comment"># ä» animal æ¨¡å—å¯¼å…¥ Dog å’Œ Cat ä¸¤ä¸ªç±»</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨å¯¼å…¥çš„å¤šä¸ªç±»</span></span><br><span class="line">dog = Dog(<span class="string">&quot;æ—ºè´¢&quot;</span>, <span class="number">3</span>)</span><br><span class="line">dog.eat(<span class="string">&quot;éª¨å¤´&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šæ—ºè´¢ï¼ˆ3å²ï¼‰æ­£åœ¨åƒéª¨å¤´</span></span><br><span class="line">dog.bark()       <span class="comment"># è¾“å‡ºï¼šæ—ºè´¢æ±ªæ±ªå«ï¼</span></span><br><span class="line"></span><br><span class="line">cat = Cat(<span class="string">&quot;å’ªå®&quot;</span>, <span class="number">2</span>)</span><br><span class="line">cat.eat(<span class="string">&quot;é±¼&quot;</span>)    <span class="comment"># è¾“å‡ºï¼šå’ªå®ï¼ˆ2å²ï¼‰æ­£åœ¨åƒé±¼</span></span><br><span class="line">cat.meow()       <span class="comment"># è¾“å‡ºï¼šå’ªå®å–µå–µå«ï¼</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ5ï¼‰å¯¼å…¥æ•´ä¸ªæ¨¡å—">ï¼ˆ5ï¼‰å¯¼å…¥æ•´ä¸ªæ¨¡å—</h3>
<ul>
<li>é€‚ç”¨äºéœ€è¦ä½¿ç”¨ç›®æ ‡æ¨¡å—ä¸­å¤šä¸ªç±»ï¼Œä¸”å¸Œæœ›åŒºåˆ†â€œç±»æ‰€å±æ¨¡å—â€çš„åœºæ™¯ï¼ˆé¿å…ç±»åå†²çªï¼‰ã€‚</li>
<li>å¯¼å…¥åéœ€é€šè¿‡â€œ<strong>æ¨¡å—å.ç±»å</strong>â€çš„æ–¹å¼è®¿é—®ç±»ã€‚</li>
<li><strong>æ ¸å¿ƒä¼˜åŠ¿</strong>ï¼šæ˜ç¡®ç±»çš„æ¥æºï¼Œé¿å…ä¸åŒæ¨¡å—ä¸­åŒåç±»çš„å†²çªï¼ˆå¦‚åŒæ—¶å¯¼å…¥ä¸¤ä¸ªæ¨¡å—çš„ Person ç±»ï¼Œå¯é€šè¿‡ module1.Person å’Œ module2.Person åŒºåˆ†ï¼‰</li>
</ul>
<h4 id="1-è¯­æ³•æ ¼å¼-3">&lt;1&gt;è¯­æ³•æ ¼å¼</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> æ¨¡å—å</span><br></pre></td></tr></table></figure>
<h4 id="2-å®æˆ˜æ¼”ç¤º-2">&lt;2&gt;å®æˆ˜æ¼”ç¤º</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"><span class="keyword">import</span> animal  <span class="comment"># å¯¼å…¥æ•´ä¸ª animal æ¨¡å—</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡â€œæ¨¡å—å.ç±»åâ€è®¿é—®æ¨¡å—ä¸­çš„ç±»</span></span><br><span class="line">animal_obj = animal.Animal(<span class="string">&quot;é€šç”¨åŠ¨ç‰©&quot;</span>, <span class="number">1</span>)</span><br><span class="line">animal_obj.eat(<span class="string">&quot;é£Ÿç‰©&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šé€šç”¨åŠ¨ç‰©ï¼ˆ1å²ï¼‰æ­£åœ¨åƒé£Ÿç‰©</span></span><br><span class="line"></span><br><span class="line">dog = animal.Dog(<span class="string">&quot;å°é»‘&quot;</span>, <span class="number">2</span>)</span><br><span class="line">dog.bark()  <span class="comment"># è¾“å‡ºï¼šå°é»‘æ±ªæ±ªå«ï¼</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ6ï¼‰å¯¼å…¥æ¨¡å—ä¸­çš„æ‰€æœ‰ç±»ï¼ˆä¸æ¨èï¼‰">ï¼ˆ6ï¼‰å¯¼å…¥æ¨¡å—ä¸­çš„æ‰€æœ‰ç±»ï¼ˆä¸æ¨èï¼‰</h3>
<ul>
<li>é€‚ç”¨äºéœ€è¦ä½¿ç”¨ç›®æ ‡æ¨¡å—ä¸­ç»å¤§å¤šæ•°æˆ–å…¨éƒ¨ç±»çš„åœºæ™¯ï¼Œä½†<strong>å› æ˜“å¯¼è‡´â€œå‘½åæ±¡æŸ“â€ï¼ˆå¯¼å…¥å†—ä½™ç±»ï¼‰å’Œâ€œç±»åå†²çªâ€</strong></li>
<li>ä»…æ¨èåœ¨å°å‹è„šæœ¬ä¸­ä½¿ç”¨ï¼Œ<strong>å¼ºçƒˆä¸æ¨èåœ¨æ­£å¼é¡¹ç›®</strong>ä¸­ä½¿ç”¨
<ul>
<li>ä¸æ¸…æ¥šå¯¼å…¥äº†å“ªäº›åç§°</li>
<li>å¯èƒ½è¦†ç›–å½“å‰æ¨¡å—å·²æœ‰çš„åŒåå˜é‡/å‡½æ•°/ç±»</li>
</ul>
</li>
</ul>
<h4 id="1-è¯­æ³•æ ¼å¼-4">&lt;1&gt;è¯­æ³•æ ¼å¼</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> æ¨¡å—å <span class="keyword">import</span> *</span><br></pre></td></tr></table></figure>
<h4 id="2-å®æˆ˜ç¤ºä¾‹-3">&lt;2&gt;å®æˆ˜ç¤ºä¾‹</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"><span class="keyword">from</span> animal <span class="keyword">import</span> *  <span class="comment"># å¯¼å…¥ animal æ¨¡å—ä¸­çš„æ‰€æœ‰ç±»</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›´æ¥ä½¿ç”¨æ¨¡å—ä¸­çš„æ‰€æœ‰ç±»ï¼ˆæ— éœ€åŠ æ¨¡å—åå‰ç¼€ï¼‰</span></span><br><span class="line">animal_obj = Animal(<span class="string">&quot;é€šç”¨åŠ¨ç‰©&quot;</span>, <span class="number">1</span>)</span><br><span class="line">dog = Dog(<span class="string">&quot;æ—ºè´¢&quot;</span>, <span class="number">3</span>)</span><br><span class="line">cat = Cat(<span class="string">&quot;å’ªå®&quot;</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">animal_obj.eat(<span class="string">&quot;é£Ÿç‰©&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šé€šç”¨åŠ¨ç‰©ï¼ˆ1å²ï¼‰æ­£åœ¨åƒé£Ÿç‰©</span></span><br><span class="line">dog.bark()              <span class="comment"># è¾“å‡ºï¼šæ—ºè´¢æ±ªæ±ªå«ï¼</span></span><br><span class="line">cat.meow()              <span class="comment"># è¾“å‡ºï¼šå’ªå®å–µå–µå«ï¼</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ7ï¼‰è‡ªå®šä¹‰å¯¼å…¥ï¼ˆåˆ«åã€åŒ…å±‚çº§å¯¼å…¥ã€è·¯å¾„é…ç½®ï¼‰">ï¼ˆ7ï¼‰è‡ªå®šä¹‰å¯¼å…¥ï¼ˆåˆ«åã€åŒ…å±‚çº§å¯¼å…¥ã€è·¯å¾„é…ç½®ï¼‰</h3>
<p>é’ˆå¯¹ç‰¹æ®Šéœ€æ±‚ï¼ˆå¦‚<strong>ç±»å/æ¨¡å—åè¿‡é•¿</strong>ã€<strong>åŒåå†²çª</strong>ã€<strong>è·¨ç›®å½•å¯¼å…¥</strong>ï¼‰çš„è‡ªå®šä¹‰å¯¼å…¥æ–¹å¼ï¼Œæ˜¯å®é™…å¼€å‘ä¸­é«˜é¢‘ä½¿ç”¨çš„è¿›é˜¶æŠ€å·§ã€‚</p>
<h4 id="1-ç»™ç±»-æ¨¡å—æŒ‡å®šåˆ«åï¼ˆè§£å†³å‘½åå†²çª-ç®€åŒ–åç§°ï¼‰">&lt;1&gt;ç»™ç±»/æ¨¡å—æŒ‡å®šåˆ«åï¼ˆè§£å†³å‘½åå†²çª/ç®€åŒ–åç§°ï¼‰</h4>
<p>å½“ç±»å/æ¨¡å—åè¿‡é•¿ï¼Œæˆ–ä¸åŒæ¨¡å—å­˜åœ¨åŒåç±»æ—¶ï¼Œé€šè¿‡ as å…³é”®å­—æŒ‡å®šåˆ«åï¼Œæå‡ä»£ç ç®€æ´æ€§å¹¶é¿å…å†²çªã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¯­æ³•</span></span><br><span class="line"><span class="comment"># 1.ç»™ç±»æŒ‡å®šåˆ«å</span></span><br><span class="line"><span class="keyword">from</span> æ¨¡å—å <span class="keyword">import</span> ç±»å <span class="keyword">as</span> åˆ«å</span><br><span class="line"><span class="comment"># 2.ç»™æ¨¡å—æŒ‡å®šåˆ«å</span></span><br><span class="line"><span class="keyword">import</span> æ¨¡å—å <span class="keyword">as</span> æ¨¡å—åˆ«å</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ----------------- ç»™ç±»æŒ‡å®šåˆ«å ----------------</span></span><br><span class="line"><span class="comment"># æ¨¡å—1ï¼šperson1.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æ¥è‡ªperson1çš„<span class="subst">&#123;name&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨¡å—2ï¼šperson2.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æ¥è‡ªperson2çš„<span class="subst">&#123;name&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å…¥æ—¶æŒ‡å®šåˆ«å</span></span><br><span class="line"><span class="keyword">from</span> person1 <span class="keyword">import</span> Person <span class="keyword">as</span> P1</span><br><span class="line"><span class="keyword">from</span> person2 <span class="keyword">import</span> Person <span class="keyword">as</span> P2</span><br><span class="line"></span><br><span class="line">p1 = P1(<span class="string">&quot;å¼ ä¸‰&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šæ¥è‡ªperson1çš„å¼ ä¸‰</span></span><br><span class="line">p2 = P2(<span class="string">&quot;æå››&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šæ¥è‡ªperson2çš„æå››</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------- ç»™æ¨¡å—æŒ‡å®šåˆ«å ---------------</span></span><br><span class="line"><span class="keyword">import</span> very_long_module_name <span class="keyword">as</span> vlmn  <span class="comment"># ç»™é•¿æ¨¡å—åæŒ‡å®šçŸ­åˆ«å</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡æ¨¡å—åˆ«åè®¿é—®ç±»ï¼Œä¸ç›´æ¥é€šè¿‡åˆ«åå˜é‡å¯¼å…¥</span></span><br><span class="line">obj = vlmn.VeryLongClassName()</span><br><span class="line">obj.show()  <span class="comment"># ç®€æ´è°ƒç”¨</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>æ³¨ï¼ï¼</strong>ï¼šä¸èƒ½é€šè¿‡æ¨¡å—åˆ«åå˜é‡å¯¼å…¥ç±»ï¼ˆPythonæ— æ³•è¯†åˆ«ï¼‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é”™è¯¯å†™æ³•ï¼šè¯•å›¾é€šè¿‡æ¨¡å—åˆ«åå˜é‡å¯¼å…¥ç±»ï¼ˆPythonæ— æ³•è¯†åˆ«ï¼‰</span></span><br><span class="line"><span class="comment"># from vlmn import VeryLongClassName  # æŠ¥é”™ï¼šModuleNotFoundError: No module named &#x27;vlmn&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-åŒ…å±‚çº§å¯¼å…¥ï¼ˆè·¨ç›®å½•å¯¼å…¥ï¼‰">&lt;2&gt;åŒ…å±‚çº§å¯¼å…¥ï¼ˆè·¨ç›®å½•å¯¼å…¥ï¼‰</h4>
<p>å½“ç±»æ‰€åœ¨çš„æ¨¡å—ä½äºåŒ…ï¼ˆç›®å½•ï¼‰ä¸­æ—¶ï¼Œéœ€é€šè¿‡â€œåŒ…å.æ¨¡å—åâ€çš„å±‚çº§è·¯å¾„å¯¼å…¥ï¼Œé€‚ç”¨äºå¤§å‹é¡¹ç›®çš„å¤šç›®å½•ç»“æ„ç®¡ç†ã€‚</p>
<p><strong>ç›®å½•ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">my_project/          # é¡¹ç›®æ ¹ç›®å½•</span><br><span class="line">â”œâ”€â”€ main.py          # å½“å‰æ¨¡å—ï¼ˆå¯¼å…¥æ–¹ï¼‰</span><br><span class="line">â””â”€â”€ my_package/      # åŒ…ç›®å½•</span><br><span class="line">    â”œâ”€â”€ __init__.py  # åŒ…åˆå§‹åŒ–æ–‡ä»¶ï¼ˆå¯ä¸ºç©ºï¼‰</span><br><span class="line">    â”œâ”€â”€ animal.py    # æ¨¡å—1ï¼ˆå« Animalã€Dogã€Cat ç±»ï¼‰</span><br><span class="line">    â””â”€â”€ person.py    # æ¨¡å—2ï¼ˆå« Person ç±»ï¼‰</span><br></pre></td></tr></table></figure>
<p><strong>å¯¼å…¥è¯­æ³•</strong>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ–¹å¼1ï¼šä»åŒ…çš„æ¨¡å—ä¸­å¯¼å…¥å•ä¸ªç±»</span></span><br><span class="line"><span class="keyword">from</span> my_package.animal <span class="keyword">import</span> Dog</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼2ï¼šå¯¼å…¥åŒ…çš„æ¨¡å—ï¼Œå†é€šè¿‡æ¨¡å—è®¿é—®ç±»</span></span><br><span class="line"><span class="keyword">import</span> my_package.person <span class="keyword">as</span> mp_person</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼3ï¼šä»åŒ…ä¸­å¯¼å…¥æ•´ä¸ªæ¨¡å—</span></span><br><span class="line"><span class="keyword">from</span> my_package <span class="keyword">import</span> animal</span><br></pre></td></tr></table></figure>
<p><strong>ä½¿ç”¨ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># my_package/animal.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">eat</span>(<span class="params">self, food</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span>ï¼ˆ<span class="subst">&#123;self.age&#125;</span>å²ï¼‰æ­£åœ¨åƒ<span class="subst">&#123;food&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">bark</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span>æ±ªæ±ªå«ï¼&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">meow</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span>å–µå–µå«ï¼&quot;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># my_package/person.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, pet</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.pet = pet</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">play_with_pet</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span> å’Œ <span class="subst">&#123;self.pet.name&#125;</span> ä¸€èµ·ç©è€&quot;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"><span class="keyword">from</span> my_package.animal <span class="keyword">import</span> Dog</span><br><span class="line"><span class="keyword">import</span> my_package.person <span class="keyword">as</span> mp_person</span><br><span class="line"><span class="keyword">from</span> my_package <span class="keyword">import</span> animal</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨æ–¹å¼1å¯¼å…¥çš„ Dog ç±»</span></span><br><span class="line">dog = Dog(<span class="string">&quot;æ—ºè´¢&quot;</span>, <span class="number">3</span>)</span><br><span class="line">dog.bark()  <span class="comment"># è¾“å‡ºï¼šæ—ºè´¢æ±ªæ±ªå«ï¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨æ–¹å¼2å¯¼å…¥çš„æ¨¡å—è®¿é—® Person ç±»</span></span><br><span class="line">person = mp_person.Person(<span class="string">&quot;å¼ ä¸‰&quot;</span>, dog)</span><br><span class="line">person.play_with_pet()  <span class="comment"># è¾“å‡ºï¼šå¼ ä¸‰ å’Œ æ—ºè´¢ ä¸€èµ·ç©è€</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨æ–¹å¼3å¯¼å…¥çš„æ¨¡å—è®¿é—®ç±»</span></span><br><span class="line">cat = animal.Animal(<span class="string">&quot;å’ªå’ª&quot;</span>, <span class="number">2</span>)</span><br><span class="line">cat.eat(<span class="string">&quot;é±¼&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šå’ªå’ªï¼ˆ2å²ï¼‰æ­£åœ¨åƒé±¼</span></span><br></pre></td></tr></table></figure>
<h4 id="3-è‡ªå®šä¹‰æ¨¡å—è·¯å¾„ï¼ˆå¯¼å…¥éé¡¹ç›®æ ¹ç›®å½•çš„æ¨¡å—ï¼‰">&lt;3&gt;è‡ªå®šä¹‰æ¨¡å—è·¯å¾„ï¼ˆå¯¼å…¥éé¡¹ç›®æ ¹ç›®å½•çš„æ¨¡å—ï¼‰</h4>
<p>éœ€è¦å¯¼å…¥çš„æ¨¡å—ä¸åœ¨ Python é»˜è®¤æœç´¢è·¯å¾„ï¼ˆsys.pathï¼‰ä¸­æ—¶ï¼Œéœ€æ‰‹åŠ¨å°†æ¨¡å—æ‰€åœ¨ç›®å½•æ·»åŠ åˆ°æœç´¢è·¯å¾„ï¼Œå†è¿›è¡Œå¯¼å…¥ã€‚</p>
<p><strong>ç›®å½•ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight nix"><table><tr><td class="code"><pre><span class="line"><span class="operator">/</span>home<span class="operator">/</span>user<span class="symbol">/</span></span><br><span class="line">â”œâ”€â”€ my_project<span class="symbol">/</span>         <span class="comment"># é¡¹ç›®æ ¹ç›®å½•</span></span><br><span class="line">â”‚   â””â”€â”€ main.py          <span class="comment"># ä½ çš„ä¸»ç¨‹åº</span></span><br><span class="line">â”‚</span><br><span class="line">â””â”€â”€ shared_libs<span class="symbol">/</span>         <span class="comment"># é¡¹ç›®å¤–éƒ¨çš„å…¬å…±åº“ï¼ˆä¸åœ¨ my_project ä¸‹ï¼‰</span></span><br><span class="line">    â””â”€â”€ utils.py         <span class="comment"># æƒ³å¯¼å…¥çš„æ¨¡å—</span></span><br></pre></td></tr></table></figure>
<p><strong>é—®é¢˜</strong>ï¼š</p>
<ul>
<li>ç›´æ¥åœ¨ <a href="http://main.py">main.py</a> ä¸­ import utils ä¼šæŠ¥é”™,å› ä¸º shared_libs/ ä¸åœ¨ Python çš„æœç´¢è·¯å¾„ä¸­ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"><span class="keyword">import</span> utils  <span class="comment"># âŒ ModuleNotFoundError: No module named &#x27;utils&#x27;</span></span><br></pre></td></tr></table></figure>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰‹åŠ¨æ·»åŠ å¤–éƒ¨æ¨¡å—æ‰€åœ¨ç›®å½•</span></span><br><span class="line">sys.path.append(<span class="string">&quot;/home/user/shared_libs&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç°åœ¨å¯ä»¥å¯¼å…¥äº†</span></span><br><span class="line"><span class="keyword">import</span> utils</span><br><span class="line">utils.helper()  <span class="comment"># âœ… æ­£å¸¸è°ƒç”¨</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ8ï¼‰æ³¨æ„äº‹é¡¹">ï¼ˆ8ï¼‰æ³¨æ„äº‹é¡¹</h3>
<h4 id="1-æ¦‚è¿°">&lt;1&gt;æ¦‚è¿°</h4>
<ul>
<li><strong>é¿å…å¾ªç¯å¯¼å…¥</strong>ï¼š
<ul>
<li>ç¦æ­¢å‡ºç°â€œæ¨¡å— A å¯¼å…¥æ¨¡å— B çš„ç±»ï¼Œæ¨¡å— B åˆå¯¼å…¥æ¨¡å— A çš„ç±»â€çš„å¾ªç¯ä¾èµ–ï¼Œä¼šç›´æ¥å¯¼è‡´å¯¼å…¥å¤±è´¥ï¼ˆImportErrorï¼‰ã€‚</li>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š
<ul>
<li>å°†å…±åŒä¾èµ–çš„ç±»æå–åˆ°ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œæˆ–å»¶è¿Ÿå¯¼å…¥ï¼ˆåœ¨å‡½æ•°å†…éƒ¨å¯¼å…¥ï¼‰ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><strong>ä¼˜å…ˆæ˜ç¡®å¯¼å…¥</strong>ï¼š
<ul>
<li>æ¨èä½¿ç”¨â€œfrom æ¨¡å—å import ç±»åâ€ï¼ˆå¯¼å…¥å•ä¸ª/å¤šä¸ªç±»ï¼‰æˆ–â€œimport æ¨¡å—åâ€ï¼ˆå¯¼å…¥æ•´ä¸ªæ¨¡å—ï¼‰</li>
<li>é¿å…ä½¿ç”¨â€œfrom æ¨¡å—å import *â€ï¼Œå‡å°‘å‘½åæ±¡æŸ“å’Œå†²çªé£é™©ã€‚</li>
</ul>
</li>
<li><strong>æ¨¡å—è·¯å¾„è§„èŒƒ</strong>ï¼š
<ul>
<li>åŒç›®å½•å¯¼å…¥ï¼šç›´æ¥ä½¿ç”¨æ¨¡å—åï¼ˆå¦‚ from animal import Animalï¼‰ã€‚</li>
</ul>
</li>
<li><strong>å­ç›®å½•å¯¼å…¥</strong>ï¼š
<ul>
<li>é€šè¿‡åŒ…å+æ¨¡å—åï¼ˆå¦‚ from my_package.animal import Animalï¼‰ã€‚</li>
</ul>
</li>
<li><strong>ä¸Šçº§ç›®å½•å¯¼å…¥</strong>ï¼š
<ul>
<li>éœ€æ‰‹åŠ¨æ·»åŠ è·¯å¾„åˆ° sys.pathï¼ˆå¦‚ sys.path.append(â€œâ€¦/â€)ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>ç±»åå†²çªå¤„ç†</strong>ï¼š
<ul>
<li>å½“å¯¼å…¥çš„ç±»ä¸å½“å‰æ¨¡å—çš„ç±»åŒåæ—¶ï¼Œâ€œåå¯¼å…¥/å®šä¹‰çš„ç±»â€ä¼šè¦†ç›–â€œå…ˆå¯¼å…¥/å®šä¹‰çš„ç±»â€œã€‚</li>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š
<ul>
<li>ä½¿ç”¨<strong>åˆ«åï¼ˆasï¼‰</strong> æˆ–é€šè¿‡ **â€œæ¨¡å—å.ç±»åâ€**è®¿é—®ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="2-å¾ªç¯å¯¼å…¥é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ">&lt;2&gt; å¾ªç¯å¯¼å…¥é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h4>
<ul>
<li><strong>é”™è¯¯ç¤ºä¾‹</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ---------- é”™è¯¯ç¤ºä¾‹ï¼šå¾ªç¯å¯¼å…¥å¯¼è‡´æ¨¡å—åŠ è½½å¤±è´¥ ----------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨¡å— Aï¼ša.py</span></span><br><span class="line"><span class="keyword">from</span> b <span class="keyword">import</span> B  <span class="comment"># æ¨¡å—åŠ è½½æ—¶ç«‹å³å¯¼å…¥ B</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.b = B()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;A æŒæœ‰ B: <span class="subst">&#123;self.b&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨¡å— Bï¼šb.py</span></span><br><span class="line"><span class="keyword">from</span> a <span class="keyword">import</span> A  <span class="comment"># æ¨¡å—åŠ è½½æ—¶ç«‹å³å¯¼å…¥ Aï¼ˆå½¢æˆå¾ªç¯ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.a = A()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;B æŒæœ‰ A: <span class="subst">&#123;self.a&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># main.py</span></span><br><span class="line"><span class="keyword">from</span> a <span class="keyword">import</span> A  <span class="comment"># âŒ æŠ¥é”™</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ImportError: cannot import name &#x27;B&#x27; from partially initialized module &#x27;b&#x27;</span></span><br><span class="line"><span class="comment"># (most likely due to a circular import)</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>æ­£ç¡®è§£å†³æ–¹æ¡ˆ1</strong>ï¼šåˆå¹¶åˆ°åŒä¸€æ¨¡å—</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ¨¡å—ï¼šentities.pyï¼ˆå°†ç›¸äº’ä¾èµ–çš„ç±»æ”¾åœ¨åŒä¸€æ¨¡å—ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.b = <span class="literal">None</span>  <span class="comment"># å…ˆä¸åˆå§‹åŒ–</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_b</span>(<span class="params">self, b</span>):</span><br><span class="line">        <span class="variable language_">self</span>.b = b</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.a = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_a</span>(<span class="params">self, a</span>):</span><br><span class="line">        <span class="variable language_">self</span>.a = a</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨æ–¹ï¼šmain.py</span></span><br><span class="line"><span class="keyword">from</span> entities <span class="keyword">import</span> A, B</span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">b = B()</span><br><span class="line">a.set_b(b)  <span class="comment"># æ‰‹åŠ¨å…³è”</span></span><br><span class="line">b.set_a(a)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a.b)  <span class="comment"># &lt;entities.B object ...&gt;</span></span><br><span class="line"><span class="built_in">print</span>(b.a)  <span class="comment"># &lt;entities.A object ...&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>æ­£ç¡®è§£å†³æ–¹æ¡ˆ1ï¼ˆå˜ä½“ï¼‰</strong>ï¼šé€šè¿‡å·¥å‚/åè°ƒæ¨¡å—è§£è€¦</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ¨¡å— Aï¼ša.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.b = <span class="literal">None</span>  <span class="comment"># ä¸åœ¨æ„é€ å‡½æ•°ä¸­åˆ›å»º B</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">link</span>(<span class="params">self, b</span>):</span><br><span class="line">        <span class="variable language_">self</span>.b = b</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨¡å— Bï¼šb.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.a = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">link</span>(<span class="params">self, a</span>):</span><br><span class="line">        <span class="variable language_">self</span>.a = a</span><br><span class="line"></span><br><span class="line"><span class="comment"># åè°ƒæ¨¡å—ï¼šfactory.pyï¼ˆè´Ÿè´£åˆ›å»ºå’Œå…³è”ï¼‰</span></span><br><span class="line"><span class="keyword">from</span> a <span class="keyword">import</span> A</span><br><span class="line"><span class="keyword">from</span> b <span class="keyword">import</span> B</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_linked_pair</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;åˆ›å»ºäº’ç›¸å…³è”çš„ A å’Œ B å®ä¾‹&quot;&quot;&quot;</span></span><br><span class="line">    a = A()</span><br><span class="line">    b = B()</span><br><span class="line">    a.link(b)</span><br><span class="line">    b.link(a)</span><br><span class="line">    <span class="keyword">return</span> a, b</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨æ–¹ï¼šmain.py</span></span><br><span class="line"><span class="keyword">from</span> factory <span class="keyword">import</span> create_linked_pair</span><br><span class="line"></span><br><span class="line">a, b = create_linked_pair()</span><br><span class="line"><span class="built_in">print</span>(a.b)  <span class="comment"># &lt;b.B object ...&gt;</span></span><br><span class="line"><span class="built_in">print</span>(b.a)  <span class="comment"># &lt;a.A object ...&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>æ­£ç¡®è§£å†³æ–¹æ¡ˆ2</strong>ï¼šå»¶è¿Ÿå¯¼å…¥ï¼ˆå‡½æ•°å†…éƒ¨å¯¼å…¥ï¼‰</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ---------- æ­£ç¡®è§£å†³æ–¹æ¡ˆ2ï¼šå»¶è¿Ÿå¯¼å…¥ï¼ˆå‡½æ•°å†…éƒ¨å¯¼å…¥ï¼‰ ----------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨¡å— Aï¼ša.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.b = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_b</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">from</span> b <span class="keyword">import</span> B</span><br><span class="line">        <span class="variable language_">self</span>.b = B()</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.b</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">self</span>):  <span class="comment"># è¡¥å…… show æ–¹æ³•</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;A æŒæœ‰ B: <span class="subst">&#123;self.b&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨¡å— Bï¼šb.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.a = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_a</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">from</span> a <span class="keyword">import</span> A</span><br><span class="line">        <span class="variable language_">self</span>.a = A()</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.a</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">self</span>):  <span class="comment"># è¡¥å…… show æ–¹æ³•</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;B æŒæœ‰ A: <span class="subst">&#123;self.a&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨æ–¹ï¼šmain.py</span></span><br><span class="line"><span class="keyword">from</span> a <span class="keyword">import</span> A  <span class="comment"># è¡¥å……å¯¼å…¥</span></span><br><span class="line">a = A()</span><br><span class="line">b = a.create_b()</span><br><span class="line">b.a = a  <span class="comment"># æ‰‹åŠ¨åå‘å…³è”</span></span><br><span class="line"></span><br><span class="line">a.show()  <span class="comment"># è¾“å‡ºï¼šA æŒæœ‰ B: &lt;b.B object at 0x...&gt;</span></span><br><span class="line">b.show()  <span class="comment"># è¾“å‡ºï¼šB æŒæœ‰ A: &lt;a.A object at 0x...&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>æ­£ç¡®è§£å†³æ–¹æ¡ˆ2ï¼ˆå˜ä½“ï¼‰</strong>ï¼šç”¨äºç±»å‹æ³¨è§£çš„å»¶è¿Ÿå¯¼å…¥</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ¨¡å— Aï¼ša.py</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations  <span class="comment"># å¯ç”¨å»¶è¿Ÿæ³¨è§£æ±‚å€¼</span></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> TYPE_CHECKING</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> TYPE_CHECKING:  <span class="comment"># ä»…åœ¨ç±»å‹æ£€æŸ¥æ—¶å¯¼å…¥ï¼Œè¿è¡Œæ—¶ä¸æ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">from</span> b <span class="keyword">import</span> B</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.b: B | <span class="literal">None</span> = <span class="literal">None</span>  <span class="comment"># ç±»å‹æ³¨è§£å¯ç”¨ï¼Œä½†è¿è¡Œæ—¶ä¸å¯¼å…¥</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_b</span>(<span class="params">self, b: B</span>):</span><br><span class="line">        <span class="variable language_">self</span>.b = b</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨¡å— Bï¼šb.py</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> TYPE_CHECKING</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> TYPE_CHECKING:</span><br><span class="line">    <span class="keyword">from</span> a <span class="keyword">import</span> A</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.a: A | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_a</span>(<span class="params">self, a: A</span>):</span><br><span class="line">        <span class="variable language_">self</span>.a = a</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨æ–¹ï¼šmain.py</span></span><br><span class="line"><span class="keyword">from</span> a <span class="keyword">import</span> A</span><br><span class="line"><span class="keyword">from</span> b <span class="keyword">import</span> B</span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">b = B()</span><br><span class="line">a.set_b(b)</span><br><span class="line">b.set_a(a)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;a.b = <span class="subst">&#123;a.b&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºæ­£å¸¸</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;b.a = <span class="subst">&#123;b.a&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºæ­£å¸¸</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="è¡¥å……ï¼š-init-py-æ–‡ä»¶-çš„ä½¿ç”¨">è¡¥å……ï¼š__init__.py æ–‡ä»¶ çš„ä½¿ç”¨</h3>
<p>åœ¨åŒ…ç›®å½•ä¸­ï¼Œ__init__.py æ˜¯æ ‡è¯†ç›®å½•ä¸º Python åŒ…çš„æ ¸å¿ƒæ–‡ä»¶ï¼ˆPython 3.3+ æ”¯æŒéšå¼å‘½åç©ºé—´åŒ…ï¼Œå¯çœç•¥ï¼Œä½†å·¥ç¨‹åŒ–å¼€å‘ä¸­æ¨èä¿ç•™ï¼‰ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯ç®€åŒ–å¯¼å…¥å’Œæ§åˆ¶åŒ…çš„æš´éœ²å†…å®¹ï¼Œå…·ä½“ç”¨æ³•åˆ†ä¸º3ç±»ã€‚</p>
<h4 id="1-åŸºç¡€ç”¨æ³•ï¼šç©ºæ–‡ä»¶ï¼ˆä»…æ ‡è¯†åŒ…">&lt;1&gt;åŸºç¡€ç”¨æ³•ï¼šç©ºæ–‡ä»¶ï¼ˆä»…æ ‡è¯†åŒ…)</h4>
<p>åªéœ€åœ¨åŒ…ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªç©ºçš„ __init__.py æ–‡ä»¶ï¼Œå³å¯è®© Python å°†è¯¥ç›®å½•è¯†åˆ«ä¸ºåŒ…ï¼Œæ”¯æŒåŸºç¡€çš„åŒ…å±‚çº§å¯¼å…¥ã€‚</p>
<figure class="highlight nix"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é¡¹ç›®ç»“æ„ï¼ˆç©º __init__.py ç¤ºä¾‹ï¼‰</span></span><br><span class="line">my_package<span class="symbol">/</span>          <span class="comment"># åŒ…ç›®å½•</span></span><br><span class="line">â”œâ”€â”€ __init__.py      <span class="comment"># ç©ºæ–‡ä»¶ï¼ˆæ ¸å¿ƒï¼šæ ‡è¯†ä¸ºPythonåŒ…ï¼‰</span></span><br><span class="line">â”œâ”€â”€ animal.py        <span class="comment"># å« Animalã€Dog ç±»</span></span><br><span class="line">â””â”€â”€ person.py        <span class="comment"># å« Person ç±»</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¯¼å…¥ä½¿ç”¨ï¼ˆç©º __init__.py æ”¯æŒçš„åŸºç¡€å¯¼å…¥ï¼‰</span></span><br><span class="line"><span class="keyword">from</span> my_package.animal <span class="keyword">import</span> Dog</span><br><span class="line">dog = Dog(<span class="string">&quot;æ—ºè´¢&quot;</span>, <span class="number">3</span>)</span><br><span class="line">dog.bark()  <span class="comment"># æ­£å¸¸è¿è¡Œ</span></span><br></pre></td></tr></table></figure>
<h4 id="2-è¿›é˜¶ç”¨æ³•1ï¼šç®€åŒ–å¯¼å…¥è·¯å¾„ï¼ˆå¸¸ç”¨ï¼‰">&lt;2&gt;è¿›é˜¶ç”¨æ³•1ï¼šç®€åŒ–å¯¼å…¥è·¯å¾„ï¼ˆå¸¸ç”¨ï¼‰</h4>
<p>é€šè¿‡åœ¨ __init__.py ä¸­æå‰å¯¼å…¥åŒ…å†…æ¨¡å—çš„ç±»/å‡½æ•°ï¼Œå¯è®©å¤–éƒ¨å¯¼å…¥æ—¶è·³è¿‡ä¸­é—´æ¨¡å—ï¼Œç›´æ¥ä»åŒ…åå¯¼å…¥ç›®æ ‡ç±»ï¼Œå¤§å¹…ç®€åŒ–å¯¼å…¥è¯­æ³•ã€‚</p>
<figure class="highlight nix"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é¡¹ç›®ç»“æ„ï¼ˆç©º __init__.py ç¤ºä¾‹ï¼‰</span></span><br><span class="line">my_package<span class="symbol">/</span>          <span class="comment"># åŒ…ç›®å½•</span></span><br><span class="line">â”œâ”€â”€ __init__.py      <span class="comment"># ç©ºæ–‡ä»¶ï¼ˆæ ¸å¿ƒï¼šæ ‡è¯†ä¸ºPythonåŒ…ï¼‰</span></span><br><span class="line">â”œâ”€â”€ animal.py        <span class="comment"># å« Animalã€Dog ç±»</span></span><br><span class="line">â””â”€â”€ person.py        <span class="comment"># å« Person ç±»</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¬¬ä¸€æ­¥ï¼šç¼–å†™ my_package/__init__.py</span></span><br><span class="line"><span class="keyword">from</span> .animal <span class="keyword">import</span> Animal, Dog  <span class="comment"># ä»å½“å‰åŒ…çš„ animal æ¨¡å—å¯¼å…¥æŒ‡å®šç±»</span></span><br><span class="line"><span class="keyword">from</span> .person <span class="keyword">import</span> Person       <span class="comment"># ä»å½“å‰åŒ…çš„ person æ¨¡å—å¯¼å…¥æŒ‡å®šç±»</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¬¬äºŒæ­¥ï¼šå¤–éƒ¨å¯¼å…¥ï¼ˆç®€åŒ–å‰ vs ç®€åŒ–åï¼‰</span></span><br><span class="line"><span class="comment"># ç®€åŒ–å‰ï¼ˆéœ€å†™å…¨æ¨¡å—è·¯å¾„ï¼‰</span></span><br><span class="line"><span class="keyword">from</span> my_package.animal <span class="keyword">import</span> Dog</span><br><span class="line"><span class="keyword">from</span> my_package.person <span class="keyword">import</span> Person</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç®€åŒ–åï¼ˆç›´æ¥ä»åŒ…åå¯¼å…¥ï¼Œè·³è¿‡æ¨¡å—åï¼‰</span></span><br><span class="line"><span class="keyword">from</span> my_package <span class="keyword">import</span> Dog, Person</span><br><span class="line">dog = Dog(<span class="string">&quot;æ—ºè´¢&quot;</span>, <span class="number">3</span>)</span><br><span class="line">person = Person(<span class="string">&quot;å¼ ä¸‰&quot;</span>, dog)</span><br><span class="line">person.play_with_pet()  <span class="comment"># æ­£å¸¸è¿è¡Œ</span></span><br></pre></td></tr></table></figure>
<h4 id="3-è¿›é˜¶ç”¨æ³•2ï¼šæ§åˆ¶â€œfrom-åŒ…å-import-â€çš„å¯¼å…¥å†…å®¹">&lt;3&gt;è¿›é˜¶ç”¨æ³•2ï¼šæ§åˆ¶â€œfrom åŒ…å import *â€çš„å¯¼å…¥å†…å®¹</h4>
<p>é€šè¿‡ __all__ å˜é‡ï¼ˆåˆ—è¡¨ç±»å‹ï¼‰ï¼Œå¯æ˜ç¡®æŒ‡å®šå½“å¤–éƒ¨ä½¿ç”¨ from åŒ…å import * æ—¶ï¼Œèƒ½å¯¼å…¥çš„ç±»/æ¨¡å—åˆ—è¡¨ï¼Œé¿å…å¯¼å…¥å†—ä½™å†…å®¹ï¼Œå‡å°‘å‘½åæ±¡æŸ“ã€‚</p>
<figure class="highlight nix"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é¡¹ç›®ç»“æ„ï¼ˆç©º __init__.py ç¤ºä¾‹ï¼‰</span></span><br><span class="line">my_package<span class="symbol">/</span>          <span class="comment"># åŒ…ç›®å½•</span></span><br><span class="line">â”œâ”€â”€ __init__.py      <span class="comment"># ç©ºæ–‡ä»¶ï¼ˆæ ¸å¿ƒï¼šæ ‡è¯†ä¸ºPythonåŒ…ï¼‰</span></span><br><span class="line">â”œâ”€â”€ animal.py        <span class="comment"># å« Animalã€Dog ç±»</span></span><br><span class="line">â””â”€â”€ person.py        <span class="comment"># å« Person ç±»</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¬¬ä¸€æ­¥ï¼šç¼–å†™ my_package/__init__.py</span></span><br><span class="line">__all__ = [<span class="string">&quot;Animal&quot;</span>, <span class="string">&quot;Person&quot;</span>]  <span class="comment"># ä»…å…è®¸å¤–éƒ¨é€šé…å¯¼å…¥è¿™ä¸¤ä¸ªç±»</span></span><br><span class="line"><span class="keyword">from</span> .animal <span class="keyword">import</span> Animal, Dog  <span class="comment"># åŒ…å†…å¯¼å…¥äº† Dogï¼Œä½†æœªåŠ å…¥ __all__</span></span><br><span class="line"><span class="keyword">from</span> .person <span class="keyword">import</span> Person</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¬¬äºŒæ­¥ï¼šå¤–éƒ¨é€šé…å¯¼å…¥æµ‹è¯•</span></span><br><span class="line"><span class="keyword">from</span> my_package <span class="keyword">import</span> *  <span class="comment"># ä»…èƒ½å¯¼å…¥ __all__ ä¸­çš„ Animal å’Œ Person</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯æ­£å¸¸ä½¿ç”¨</span></span><br><span class="line">animal = Animal(<span class="string">&quot;é€šç”¨åŠ¨ç‰©&quot;</span>, <span class="number">1</span>)</span><br><span class="line">person = Person(<span class="string">&quot;å¼ ä¸‰&quot;</span>, animal)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ— æ³•ä½¿ç”¨ï¼ˆDog æœªåœ¨ __all__ ä¸­ï¼Œé€šé…å¯¼å…¥æœªåŒ…å«ï¼‰</span></span><br><span class="line"><span class="comment"># dog = Dog(&quot;æ—ºè´¢&quot;, 3)  # æŠ¥é”™ï¼šNameError: name &#x27;Dog&#x27; is not defined</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è‹¥éœ€ä½¿ç”¨ Dogï¼Œéœ€æ˜ç¡®å¯¼å…¥</span></span><br><span class="line"><span class="keyword">from</span> my_package.animal <span class="keyword">import</span> Dog</span><br><span class="line">dog = Dog(<span class="string">&quot;æ—ºè´¢&quot;</span>, <span class="number">3</span>)  <span class="comment"># æ­£å¸¸è¿è¡Œ</span></span><br></pre></td></tr></table></figure>
<h3 id="è¡¥å……ï¼š-name-â€œ-main-â€">è¡¥å……ï¼š__name__ == â€œ__main__â€</h3>
<p>Python ä¸­ __name__ == â€œ__main__â€ çš„æ ¸å¿ƒä½œç”¨ï¼Œæ˜¯é€šè¿‡ __name__ å˜é‡çš„åŠ¨æ€å–å€¼ï¼ŒåŒºåˆ†æ¨¡å—çš„ä¸¤ç§æ ¸å¿ƒä½¿ç”¨çŠ¶æ€â€”â€”<strong>ã€Œç›´æ¥ä½¿ç”¨ã€<strong>å’Œ</strong>ã€Œè¢«å¯¼å…¥ã€</strong>ï¼Œè¿›è€Œ<strong>å®ç°ä»£ç çš„â€œæŒ‰éœ€æ‰§è¡Œâ€</strong>ã€‚</p>
<h4 id="1ï¼‰-name-æ˜¯ä»€ä¹ˆï¼Ÿ">1ï¼‰__name__ æ˜¯ä»€ä¹ˆï¼Ÿ</h4>
<p>__name__ æ˜¯ Python ä¸ºæ¯ä¸ª .py æ–‡ä»¶ï¼ˆæ¨¡å—ï¼‰å†…ç½®çš„ <strong>ã€Œæ¨¡å—çº§ç‰¹æ®Šå˜é‡ã€</strong>ï¼Œæ— éœ€æ‰‹åŠ¨å®šä¹‰ï¼Œå…¶å€¼ç”±æ¨¡å—çš„â€œä½¿ç”¨æ–¹å¼â€å†³å®šï¼š</p>
<ul>
<li>å½“æ¨¡å— <strong>ç›´æ¥ä½¿ç”¨</strong> æ—¶ï¼š
<ul>
<li><strong>__name__ = â€œ__main__â€</strong>ï¼ˆ__main__ æ˜¯ Python è§„å®šçš„â€œä¸»æ¨¡å—â€æ ‡è¯†ï¼‰</li>
</ul>
</li>
<li>å½“æ¨¡å— <strong>è¢«å¯¼å…¥</strong> æ—¶ï¼š
<ul>
<li>__name__ = æ¨¡å—åï¼ˆå³<strong>æ¨¡å—çš„æ–‡ä»¶å</strong>ï¼Œä¸å« .py åç¼€ï¼‰</li>
</ul>
</li>
</ul>
<p>__name__ == â€œ__main__â€ æœ¬è´¨æ˜¯ä¸€ä¸ªâ€œçŠ¶æ€åˆ¤æ–­è¯­å¥â€ï¼Œç”¨äºæ£€æµ‹å½“å‰æ¨¡å—æ˜¯å¦å¤„äºã€Œç›´æ¥ä½¿ç”¨ã€çŠ¶æ€ã€‚</p>
<h4 id="2ï¼‰æ¨¡å—è¢«ç›´æ¥ä½¿ç”¨ï¼ˆä½œä¸ºä¸»ç¨‹åºå…¥å£ï¼‰">2ï¼‰æ¨¡å—è¢«ç›´æ¥ä½¿ç”¨ï¼ˆä½œä¸ºä¸»ç¨‹åºå…¥å£ï¼‰</h4>
<p>å½“æˆ‘ä»¬é€šè¿‡å‘½ä»¤è¡Œæ‰§è¡Œ <strong>python <a href="http://xn--eqr79ejvx.py">æ¨¡å—å.py</a></strong> ï¼Œæˆ–åœ¨ IDE ä¸­<strong>ç›´æ¥è¿è¡ŒæŸä¸ª .py æ–‡ä»¶</strong>æ—¶ï¼Œè¯¥æ¨¡å—å°±æ˜¯â€œç›´æ¥ä½¿ç”¨â€çš„ä¸»æ¨¡å—ï¼Œæ­¤æ—¶ï¼š</p>
<ul>
<li>æ¨¡å—çš„ __name__ è‡ªåŠ¨èµ‹å€¼ä¸º â€œ__main__â€ï¼›</li>
<li>__name__ == â€œ__main__â€ æ¡ä»¶æˆç«‹ï¼Œä¼šæ‰§è¡Œè¯¥åˆ¤æ–­è¯­å¥ä¸‹çš„ä»£ç å—ã€‚</li>
</ul>
<p><strong>æ³¨ï¼ï¼</strong>ï¼š</p>
<ul>
<li><strong>è¿™é‡Œçš„â€œä¸»ç¨‹åºå…¥å£â€ï¼Œæ˜¯æŒ‡&quot;åˆ¤æ–­å½“å‰æ¨¡å—æ˜¯å¦æ˜¯ç”¨æˆ·ç›´æ¥è¿è¡Œçš„ä¸»æ¨¡å—&quot;ï¼Œè€Œä¸æ˜¯â€œæ‰§è¡Œå…¥å£â€</strong></li>
</ul>
<p><strong>ç¤ºä¾‹ä»£ç </strong>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># calculator.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;åŠ æ³•å‡½æ•°&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">multiply</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä¹˜æ³•å‡½æ•°&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> a * b</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰æ¨¡å—çš„ __name__ å€¼</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;å½“å‰æ¨¡å—çš„ __name__ = <span class="subst">&#123;__name__&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ¤æ–­æ˜¯å¦ä¸ºç›´æ¥è¿è¡Œ</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># åªæœ‰ç›´æ¥è¿è¡Œ calculator.py æ—¶ï¼Œè¿™é‡Œçš„ä»£ç æ‰ä¼šæ‰§è¡Œ</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">40</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;æ¨¡å—è¢«ç›´æ¥è¿è¡Œï¼Œæ‰§è¡Œæµ‹è¯•ä»£ç ï¼š&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;add(10, 20) = <span class="subst">&#123;add(<span class="number">10</span>, <span class="number">20</span>)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;multiply(5, 6) = <span class="subst">&#123;multiply(<span class="number">5</span>, <span class="number">6</span>)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">40</span>)</span><br></pre></td></tr></table></figure>
<p><strong>ç›´æ¥è¿è¡Œ</strong>ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">python calculator.py</span><br></pre></td></tr></table></figure>
<p><strong>è¾“å‡º</strong>ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">å½“å‰æ¨¡å—çš„ __name__ = __main__</span><br><span class="line">========================================</span><br><span class="line">æ¨¡å—è¢«ç›´æ¥è¿è¡Œï¼Œæ‰§è¡Œæµ‹è¯•ä»£ç ï¼š</span><br><span class="line">add(10, 20) = 30</span><br><span class="line">multiply(5, 6) = 30</span><br><span class="line">========================================</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="3ï¼‰æ¨¡å—è¢«å¯¼å…¥ä½¿ç”¨">3ï¼‰æ¨¡å—è¢«å¯¼å…¥ä½¿ç”¨</h4>
<p>å½“æˆ‘ä»¬åœ¨ A æ¨¡å—ä¸­é€šè¿‡import B å¯¼å…¥ B æ¨¡å—æ—¶ï¼ŒB æ¨¡å—æ˜¯â€œè¢«å¯¼å…¥â€çš„å·¥å…·åº“æ¨¡å—ï¼Œæ­¤æ—¶ï¼š</p>
<ul>
<li>B æ¨¡å—çš„ __name__ è‡ªåŠ¨èµ‹å€¼ä¸ºå…¶æ¨¡å—åï¼ˆå¦‚ â€œdirect_use_demoâ€ï¼‰ï¼›</li>
<li>B æ¨¡å—ä¸­ __name__ == â€œ__main__â€ æ¡ä»¶ä¸æˆç«‹ï¼Œä¸ä¼šæ‰§è¡Œè¯¥åˆ¤æ–­ä¸‹çš„ä»£ç å—ã€‚</li>
</ul>
<p><strong>æ–‡ä»¶ç»“æ„</strong></p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">project/</span><br><span class="line">â”œâ”€â”€ utils.py      # è¢«å¯¼å…¥çš„å·¥å…·æ¨¡å—ï¼ˆBæ¨¡å—ï¼‰</span><br><span class="line">â””â”€â”€ main.py       # ä¸»ç¨‹åºï¼ˆAæ¨¡å—ï¼‰</span><br></pre></td></tr></table></figure>
<p><strong><a href="http://utils.py">utils.py</a>ï¼ˆè¢«å¯¼å…¥çš„æ¨¡å—ï¼‰</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># utils.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">greet</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;é—®å€™å‡½æ•°&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;Hello, <span class="subst">&#123;name&#125;</span>!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_area</span>(<span class="params">radius</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è®¡ç®—åœ†çš„é¢ç§¯&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">import</span> math</span><br><span class="line">    <span class="keyword">return</span> math.pi * radius ** <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰æ¨¡å—çš„ __name__ å€¼</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;[utils.py] å½“å‰ __name__ = <span class="subst">&#123;__name__&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™æ®µä»£ç åªæœ‰ç›´æ¥è¿è¡Œ utils.py æ—¶æ‰æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">40</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;utils.py è¢«ç›´æ¥è¿è¡Œï¼Œæ‰§è¡Œæµ‹è¯•ä»£ç ï¼š&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(greet(<span class="string">&quot;World&quot;</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;åŠå¾„ä¸º 5 çš„åœ†é¢ç§¯ï¼š<span class="subst">&#123;calculate_area(<span class="number">5</span>):<span class="number">.2</span>f&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">40</span>)</span><br></pre></td></tr></table></figure>
<p><strong>è¿è¡Œ <a href="http://main.py">main.py</a>ï¼ˆutils è¢«å¯¼å…¥ï¼‰</strong></p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">python main.py</span><br></pre></td></tr></table></figure>
<p><strong>è¾“å‡º</strong>ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[main.py] ç¨‹åºå¼€å§‹</span><br><span class="line">[main.py] å½“å‰ __name__ = __main__</span><br><span class="line">----------------------------------------</span><br><span class="line">[utils.py] å½“å‰ __name__ = utils</span><br><span class="line">----------------------------------------</span><br><span class="line">[main.py] å¯¼å…¥å®Œæˆï¼Œå¼€å§‹è°ƒç”¨å‡½æ•°</span><br><span class="line">Hello, Python!</span><br><span class="line">åŠå¾„ä¸º <span class="number">10</span> çš„åœ†é¢ç§¯ï¼š<span class="number">314.16</span></span><br></pre></td></tr></table></figure>
<h1>åã€æ–‡ä»¶</h1>
<ul>
<li>Python æ–‡ä»¶æ“ä½œçš„æ ¸å¿ƒæ˜¯é€šè¿‡å†…ç½®å‡½æ•°ï¼ˆå¦‚ <strong>open()</strong>ï¼‰å’Œæ ‡å‡†åº“ï¼ˆå¦‚ <strong>json</strong>ã€pickleï¼‰å®ç°æ•°æ®çš„è¯»å–ã€å†™å…¥ä¸ç»“æ„åŒ–å­˜å‚¨ã€‚</li>
</ul>
<h2 id="1-open-å‡½æ•°">1.open()å‡½æ•°</h2>
<ul>
<li>Python æ“ä½œæ–‡ä»¶çš„<strong>åŸºç¡€å…¥å£</strong>æ˜¯ open() å‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›æ–‡ä»¶å¯¹è±¡ï¼Œé€šè¿‡æ–‡ä»¶å¯¹è±¡çš„æ–¹æ³•å®ç°è¯»å†™</li>
<li><strong>æ ¸å¿ƒè¯­æ³•</strong>ï¼š
<ul>
<li><strong>open(file, mode, encoding, â€¦)</strong>
<ul>
<li><strong>mode</strong>ï¼ˆæ‰“å¼€æ¨¡å¼ï¼‰ï¼šå†³å®šæ“ä½œç±»å‹</li>
<li><strong>encoding</strong>ï¼ˆç¼–ç ï¼‰ï¼šä»…é’ˆå¯¹æ–‡æœ¬æ–‡ä»¶</li>
<li><strong>è¿”å›å€¼</strong>ï¼šæ–‡ä»¶å¯¹è±¡<br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260111171120316.png" alt=""><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260112011135864.png" alt=""></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="2-withè¯­å¥">2.withè¯­å¥</h2>
<h3 id="ï¼ˆ1ï¼‰åŸºæœ¬è¯­æ³•ä¸æ‰§è¡Œæµç¨‹">ï¼ˆ1ï¼‰åŸºæœ¬è¯­æ³•ä¸æ‰§è¡Œæµç¨‹</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(file, mode, encoding=<span class="string">&quot;ç¼–ç &quot;</span>) <span class="keyword">as</span> æ–‡ä»¶å¯¹è±¡:</span><br><span class="line">    <span class="comment"># æ–‡ä»¶æ“ä½œä»£ç </span></span><br><span class="line">    å†…å®¹ = æ–‡ä»¶å¯¹è±¡.read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># with å—ç»“æŸåï¼Œæ–‡ä»¶è‡ªåŠ¨å…³é—­</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">     â”‚                                             â”‚</span><br><span class="line">     â”‚ â‘  è°ƒç”¨ <span class="built_in">open</span>() è¿”å›æ–‡ä»¶å¯¹è±¡                  â”‚</span><br><span class="line">     â”‚ â‘¡ è°ƒç”¨æ–‡ä»¶å¯¹è±¡çš„ __enter__() æ–¹æ³•           â”‚</span><br><span class="line">     â”‚ â‘¢ å°†è¿”å›å€¼èµ‹ç»™ f                            â”‚</span><br><span class="line">     â–¼                                             â”‚</span><br><span class="line">    content = f.read()  â—„â”€â”€â”€ â‘£ æ‰§è¡Œ <span class="keyword">with</span> å—å†…ä»£ç </span><br><span class="line">     â”‚</span><br><span class="line">     â”‚ â‘¤ <span class="keyword">with</span> å—ç»“æŸï¼ˆæ­£å¸¸/å¼‚å¸¸ï¼‰</span><br><span class="line">     â–¼</span><br><span class="line">    è‡ªåŠ¨è°ƒç”¨ f.__exit__() â”€â”€â–º å†…éƒ¨æ‰§è¡Œ f.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰åŒæ—¶æ‰“å¼€å¤šä¸ªæ–‡ä»¶">ï¼ˆ2ï¼‰åŒæ—¶æ‰“å¼€å¤šä¸ªæ–‡ä»¶</h3>
<h4 id="1-æ‹¬å·æ¢è¡Œï¼ˆPython-3-10-æ¨èï¼ï¼ï¼‰">&lt;1&gt;æ‹¬å·æ¢è¡Œï¼ˆPython 3.10+ æ¨èï¼ï¼ï¼‰</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> (</span><br><span class="line">    <span class="built_in">open</span>(<span class="string">&quot;file1.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f1,</span><br><span class="line">    <span class="built_in">open</span>(<span class="string">&quot;file2.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f2,</span><br><span class="line">    <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f_out,</span><br><span class="line">):</span><br><span class="line">    content1 = f1.read()</span><br><span class="line">    content2 = f2.read()</span><br><span class="line">    f_out.write(content1 + <span class="string">&quot;\n&quot;</span> + content2)</span><br></pre></td></tr></table></figure>
<h4 id="2-å•è¡Œå†™æ³•ï¼ˆé€—å·åˆ†éš”ï¼‰">&lt;2&gt;å•è¡Œå†™æ³•ï¼ˆé€—å·åˆ†éš”ï¼‰</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;input.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f_in, <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f_out:</span><br><span class="line">    content = f_in.read()</span><br><span class="line">    f_out.write(content.upper())</span><br><span class="line"><span class="comment"># ä¸¤ä¸ªæ–‡ä»¶éƒ½ä¼šè‡ªåŠ¨å…³é—­</span></span><br></pre></td></tr></table></figure>
<h4 id="3-åæ–œæ æ¢è¡Œï¼ˆæé«˜å¯è¯»æ€§ï¼‰">&lt;3&gt;åæ–œæ æ¢è¡Œï¼ˆæé«˜å¯è¯»æ€§ï¼‰</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;input.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f_in, \</span><br><span class="line">     <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f_out:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f_in:</span><br><span class="line">        f_out.write(line.upper())</span><br></pre></td></tr></table></figure>
<h4 id="4-åµŒå¥—å†™æ³•ï¼ˆå…¼å®¹æ‰€æœ‰ç‰ˆæœ¬ï¼‰">&lt;4&gt;åµŒå¥—å†™æ³•ï¼ˆå…¼å®¹æ‰€æœ‰ç‰ˆæœ¬ï¼‰</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;input.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f_in:</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f_out:</span><br><span class="line">        f_out.write(f_in.read())</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰ä½¿ç”¨-vs-ä¸ä½¿ç”¨-with">ï¼ˆ3ï¼‰ä½¿ç”¨ vs ä¸ä½¿ç”¨ with</h3>
<ul>
<li><strong>ä½¿ç”¨with</strong>ï¼š
<ul>
<li>èƒ½è‡ªåŠ¨ã€å®‰å…¨åœ°ç®¡ç†èµ„æºç”Ÿå‘½å‘¨æœŸï¼ˆæ— éœ€æ‰‹åŠ¨å…³é—­ï¼Œå³ä½¿ä»£ç æŠ›å‡ºå¼‚å¸¸ä¹Ÿä¼šä¿è¯èµ„æºé‡Šæ”¾ï¼‰</li>
</ul>
</li>
<li><strong>ä¸ä½¿ç”¨with</strong>ï¼š
<ul>
<li>è¦ä¹ˆå®¹æ˜“å› å¿˜è®°å…³é—­å¯¼è‡´èµ„æºæ³„æ¼ï¼Œè¦ä¹ˆéœ€æ‰‹åŠ¨å†™ try-finally ä¿è¯å®‰å…¨ï¼ˆä»£ç ç¹çï¼‰ï¼Œæˆ–ä»…ç®€å•æ‰‹åŠ¨å…³é—­ï¼ˆå¼‚å¸¸åœºæ™¯ä¸‹èµ„æºæ— æ³•é‡Šæ”¾ï¼‰ï¼Œæ—¢å¢åŠ å¼€å‘æˆæœ¬ï¼Œåˆå­˜åœ¨èµ„æºç®¡ç†æ¼æ´ã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ–¹å¼1ï¼šå¿˜è®°å…³é—­ï¼ˆèµ„æºæ³„æ¼ï¼‰</span></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">content = f.read()</span><br><span class="line"><span class="comment"># å¿˜è®° f.close()ï¼Œæ–‡ä»¶å¥æŸ„æœªé‡Šæ”¾</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼2ï¼šæ‰‹åŠ¨å…³é—­ï¼ˆå¼‚å¸¸ä¸å®‰å…¨ï¼‰</span></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">content = f.read()</span><br><span class="line">f.close()  <span class="comment"># å¦‚æœ read() æŠ›å¼‚å¸¸ï¼Œclose() ä¸ä¼šæ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼3ï¼štry-finallyï¼ˆç¹çä½†å®‰å…¨ï¼‰</span></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    content = f.read()</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    f.close()  <span class="comment"># æ— è®ºæ˜¯å¦å¼‚å¸¸éƒ½ä¼šæ‰§è¡Œ</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ4ï¼‰with-è¯­å¥ä¸ä¼šåˆ›å»ºæ–°çš„ä½œç”¨åŸŸ">ï¼ˆ4ï¼‰with è¯­å¥ä¸ä¼šåˆ›å»ºæ–°çš„ä½œç”¨åŸŸ</h3>
<p>with ä¸åˆ›å»ºæ–°ä½œç”¨åŸŸï¼Œå˜é‡å±äºå¤–å±‚ä½œç”¨åŸŸï¼Œåªæ˜¯æ–‡ä»¶è¢«å…³é—­äº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content = f.read()</span><br><span class="line">    lines = f.readlines()  <span class="comment"># æ³¨æ„ï¼šæ­¤æ—¶å·²è¯»å®Œï¼Œlines ä¸ºç©º</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># with å—å¤–</span></span><br><span class="line"><span class="built_in">print</span>(content)      <span class="comment"># âœ… å¯ç”¨ï¼Œcontent ä»å­˜åœ¨</span></span><br><span class="line"><span class="built_in">print</span>(f)            <span class="comment"># âœ… f ä»å­˜åœ¨</span></span><br><span class="line"><span class="built_in">print</span>(f.closed)     <span class="comment"># âœ… è¾“å‡º Trueï¼ˆæ–‡ä»¶å·²å…³é—­ï¼‰</span></span><br><span class="line"><span class="comment"># f.read()          # âŒ æŠ¥é”™ï¼šI/O operation on closed file</span></span><br></pre></td></tr></table></figure>
<h2 id="3-è¯»å–æ–‡ä»¶">3.è¯»å–æ–‡ä»¶</h2>
<ul>
<li>è¯»å–æ–‡ä»¶çš„æ ¸å¿ƒé€»è¾‘ï¼šç”¨ open() ä»¥â€œè¯»æ¨¡å¼â€æ‰“å¼€æ–‡ä»¶ï¼Œé€šè¿‡æ–‡ä»¶å¯¹è±¡çš„è¯»å–æ–¹æ³•è·å–æ•°æ®ï¼Œæœ€åå…³é—­æ–‡ä»¶</li>
<li><strong>æ¨èç”¨ with ä¸Šä¸‹æ–‡ç®¡ç†å™¨è‡ªåŠ¨å…³é—­ï¼</strong></li>
</ul>
<h3 id="ï¼ˆ1ï¼‰read-size-ï¼šè¯»å–æŒ‡å®šé•¿åº¦-å…¨éƒ¨å†…å®¹">ï¼ˆ1ï¼‰read(size) ï¼šè¯»å–æŒ‡å®šé•¿åº¦/å…¨éƒ¨å†…å®¹</h3>
<ul>
<li><strong>è¯»å–æŒ‡å®šé•¿åº¦/å…¨éƒ¨å†…å®¹</strong></li>
<li><strong>å‚æ•° size</strong>ï¼ˆå¯é€‰ï¼‰ï¼š
<ul>
<li>æŒ‡å®šè¯»å–çš„å­—èŠ‚æ•°</li>
<li>ä¸æŒ‡å®šæ—¶è¯»å–æ–‡ä»¶å…¨éƒ¨å†…å®¹</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¯­æ³•ç¤ºä¾‹1ï¼šè¯»å–å…¨éƒ¨æ–‡æœ¬å†…å®¹ï¼ˆåº”ç”¨ï¼šå†…å®¹ç­›é€‰ä¸ä¿å­˜ï¼‰</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content = f.read()  <span class="comment"># è¯»å–å…¨éƒ¨å†…å®¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®é™…åº”ç”¨ï¼šç­›é€‰åŒ…å«&quot;Python&quot;çš„å¥å­ï¼Œå†™å…¥æ–°æ–‡ä»¶</span></span><br><span class="line">filtered_content = [sentence <span class="keyword">for</span> sentence <span class="keyword">in</span> content.split(<span class="string">&quot;\n&quot;</span>) <span class="keyword">if</span> <span class="string">&quot;Python&quot;</span> <span class="keyword">in</span> sentence]</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;python_related.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">&quot;\n&quot;</span>.join(filtered_content))</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯­æ³•ç¤ºä¾‹2ï¼šè¯»å–å‰ 10 ä¸ªå­—ç¬¦ï¼ˆåº”ç”¨ï¼šè·å–æ–‡ä»¶å¤´éƒ¨ä¿¡æ¯ï¼‰</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    header = f.read(<span class="number">10</span>)  <span class="comment"># ä»…è¯»å–å‰10ä¸ªå­—ç¬¦</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®é™…åº”ç”¨ï¼šåˆ¤æ–­æ–‡ä»¶æ˜¯å¦ä¸ºæŒ‡å®šç±»å‹ï¼ˆå¦‚åˆ¤æ–­æ—¥å¿—æ–‡ä»¶å¤´éƒ¨æ ‡è¯†ï¼‰</span></span><br><span class="line"><span class="keyword">if</span> header.startswith(<span class="string">&quot;LOG-2024&quot;</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;è¿™æ˜¯2024å¹´çš„æ—¥å¿—æ–‡ä»¶&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;éç›®æ ‡æ—¥å¿—æ–‡ä»¶&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰readline-ï¼šæŒ‰è¡Œè¯»å–ï¼ˆä¸€æ¬¡ä¸€è¡Œï¼‰">ï¼ˆ2ï¼‰readline()ï¼šæŒ‰è¡Œè¯»å–ï¼ˆä¸€æ¬¡ä¸€è¡Œï¼‰</h3>
<ul>
<li><strong>æŒ‰è¡Œè¯»å–ï¼ˆä¸€æ¬¡ä¸€è¡Œï¼‰</strong></li>
<li>é€‚ç”¨äºå¤§æ–‡ä»¶ï¼ˆé¿å…ä¸€æ¬¡æ€§åŠ è½½å…¨éƒ¨å†…å®¹å ç”¨å†…å­˜ï¼‰ï¼Œæ¯æ¬¡è°ƒç”¨è¯»å–ä¸€è¡Œï¼Œç›´åˆ°æ–‡ä»¶æœ«å°¾è¿”å›ç©ºå­—ç¬¦ä¸²</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¯­æ³•ç¤ºä¾‹1ï¼šé€è¡Œè¯»å–æ–‡æœ¬ï¼ˆä»…æ¼”ç¤ºï¼‰</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        line = f.readline()  <span class="comment"># ä¸€æ¬¡è¯»ä¸€è¡Œ</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> line:  <span class="comment"># è¯»åˆ°æœ«å°¾ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²ï¼Œé€€å‡ºå¾ªç¯</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="built_in">print</span>(line.strip())  <span class="comment"># strip() å»é™¤æ¢è¡Œç¬¦å’Œç©ºæ ¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼2ï¼šç›´æ¥è¿­ä»£æ–‡ä»¶å¯¹è±¡ï¼ˆæ›´æ¨èï¼‰</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">        <span class="built_in">print</span>(line.strip())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯­æ³•ç¤ºä¾‹2ï¼šé€è¡Œè¯»å–æ–‡æœ¬ï¼ˆåº”ç”¨ï¼šç»Ÿè®¡ç‰¹å®šè¡Œæ•°é‡ï¼‰ï¼ˆä»…æ¼”ç¤ºï¼‰</span></span><br><span class="line">count = <span class="number">0</span></span><br><span class="line">target_keyword = <span class="string">&quot;é”™è¯¯&quot;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;large_log.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f, \</span><br><span class="line">     <span class="built_in">open</span>(<span class="string">&quot;error_log.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> err_f:</span><br><span class="line">    line_num = <span class="number">1</span>  <span class="comment"># æ‰‹åŠ¨ç»´æŠ¤è¡Œå·ï¼ˆenumerateçš„æ›¿ä»£æ–¹æ¡ˆï¼‰</span></span><br><span class="line">    <span class="comment"># ç”¨readline()å¾ªç¯è¯»å–ï¼Œç›´åˆ°è¿”å›ç©ºå­—ç¬¦ä¸²ï¼ˆæ–‡ä»¶æœ«å°¾ï¼‰</span></span><br><span class="line">    line = f.readline()</span><br><span class="line">    <span class="keyword">while</span> line:  <span class="comment"># éç©ºå­—ç¬¦ä¸²ä¸ºTrueï¼Œç©ºå­—ç¬¦ä¸²ï¼ˆEOFï¼‰ä¸ºFalse</span></span><br><span class="line">        <span class="keyword">if</span> target_keyword <span class="keyword">in</span> line:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            <span class="comment"># å†™å…¥å¸¦è¡Œå·çš„é”™è¯¯è¡Œï¼Œä¿æŒå’ŒåŸä»£ç ä¸€è‡´çš„æ ¼å¼</span></span><br><span class="line">            err_f.write(<span class="string">f&quot;è¡Œ<span class="subst">&#123;line_num&#125;</span>ï¼š<span class="subst">&#123;line.strip()&#125;</span>\n&quot;</span>)</span><br><span class="line">        <span class="comment"># è¯»å–ä¸‹ä¸€è¡Œï¼Œå¹¶æ›´æ–°è¡Œå·</span></span><br><span class="line">        line = f.readline()</span><br><span class="line">        line_num += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æ—¥å¿—ä¸­åŒ…å«&#x27;é”™è¯¯&#x27;çš„è¡Œæ•°ï¼š<span class="subst">&#123;count&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#  æ–¹å¼2ï¼šç›´æ¥è¿­ä»£æ–‡ä»¶å¯¹è±¡ï¼ˆæ›´æ¨èï¼‰</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;large_log.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f, \</span><br><span class="line">     <span class="built_in">open</span>(<span class="string">&quot;error_log.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> err_f:  <span class="comment"># åŒæ—¶æ‰“å¼€ä¸¤ä¸ªæ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">for</span> line_num, line <span class="keyword">in</span> <span class="built_in">enumerate</span>(f, <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> target_keyword <span class="keyword">in</span> line:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            err_f.write(<span class="string">f&quot;è¡Œ<span class="subst">&#123;line_num&#125;</span>ï¼š<span class="subst">&#123;line.strip()&#125;</span>\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æ—¥å¿—ä¸­åŒ…å«&#x27;é”™è¯¯&#x27;çš„è¡Œæ•°ï¼š<span class="subst">&#123;count&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰readlines-ï¼šè¯»å–æ‰€æœ‰è¡Œ-è¿”å›åˆ—è¡¨">ï¼ˆ3ï¼‰readlines()ï¼šè¯»å–æ‰€æœ‰è¡Œ,è¿”å›åˆ—è¡¨</h3>
<p>ä¸€æ¬¡æ€§è¯»å–æ–‡ä»¶æ‰€æœ‰è¡Œï¼Œæ¯ä¸€è¡Œä½œä¸ºåˆ—è¡¨çš„ä¸€ä¸ªå…ƒç´ ï¼Œé€‚ç”¨äºä¸­å°æ–‡ä»¶ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¯­æ³•ç¤ºä¾‹1ï¼šè¯»å–æ‰€æœ‰è¡Œå¹¶éå†</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    lines = f.readlines()  <span class="comment"># è¿”å›åˆ—è¡¨ï¼Œå…ƒç´ ä¸ºæ¯ä¸€è¡Œå†…å®¹</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">    <span class="built_in">print</span>(line.strip())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯­æ³•ç¤ºä¾‹2ï¼šè¯»å–æ‰€æœ‰è¡Œå¹¶éå†ï¼ˆåº”ç”¨ï¼šæ•°æ®æ¸…æ´—ä¸æ ¼å¼è½¬æ¢ï¼‰</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;data.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    lines = f.readlines()  <span class="comment"># è¿”å›åˆ—è¡¨ï¼Œå…ƒç´ ä¸ºæ¯ä¸€è¡Œå†…å®¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¥éª¤1ï¼šæ¸…æ´—ç©ºè¡Œå’Œç©ºæ ¼</span></span><br><span class="line">cleaned_lines = [line.strip() <span class="keyword">for</span> line <span class="keyword">in</span> lines <span class="keyword">if</span> line.strip()]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¥éª¤2ï¼šæ ¼å¼è½¬æ¢ï¼ˆå°†&quot;å§“å:å¹´é¾„&quot;æ ¼å¼è½¬ä¸º&quot;å§“å,å¹´é¾„&quot;çš„CSVæ ¼å¼ï¼‰</span></span><br><span class="line">csv_lines = [line.replace(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;,&quot;</span>) <span class="keyword">for</span> line <span class="keyword">in</span> cleaned_lines]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¥éª¤3ï¼šå†™å…¥CSVæ–‡ä»¶</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;data.csv&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">&quot;å§“å,å¹´é¾„\n&quot;</span>)</span><br><span class="line">    f.writelines([line + <span class="string">&quot;\n&quot;</span> <span class="keyword">for</span> line <span class="keyword">in</span> csv_lines])</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ4ï¼‰äºŒè¿›åˆ¶æ–‡ä»¶è¯»å–ï¼ˆå¦‚å›¾ç‰‡ã€è§†é¢‘ï¼‰">ï¼ˆ4ï¼‰äºŒè¿›åˆ¶æ–‡ä»¶è¯»å–ï¼ˆå¦‚å›¾ç‰‡ã€è§†é¢‘ï¼‰</h3>
<p>äºŒè¿›åˆ¶æ–‡ä»¶éœ€ç”¨**â€œrbâ€æ¨¡å¼**æ‰“å¼€ï¼Œè¯»å–çš„å†…å®¹ä¸ºå­—èŠ‚ä¸²ï¼ˆbytes ç±»å‹ï¼‰ï¼Œæ— éœ€æŒ‡å®š encodingã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¯­æ³•ç¤ºä¾‹1ï¼šæ–‡ä»¶å¤åˆ¶ï¼ˆå®é™…åº”ç”¨ï¼šå¤‡ä»½å›¾ç‰‡/è§†é¢‘ï¼‰</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;image.jpg&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    img_data = f.read()  <span class="comment"># è¯»å–äºŒè¿›åˆ¶æ•°æ®ï¼ˆbytes ç±»å‹ï¼‰</span></span><br><span class="line"><span class="comment"># å†™å…¥æ–°æ–‡ä»¶å®ç°å¤‡ä»½ï¼Œä¿ç•™åŸå§‹æ ¼å¼</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;image_backup.jpg&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(img_data)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å›¾ç‰‡å¤‡ä»½å®Œæˆ&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯­æ³•ç¤ºä¾‹2ï¼šéªŒè¯æ–‡ä»¶æ ¼å¼ï¼ˆå®é™…åº”ç”¨ï¼šåˆ¤æ–­æ˜¯å¦ä¸ºJPGå›¾ç‰‡ï¼‰</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;unknown_file.bin&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="comment"># æ£€æŸ¥æ–‡ä»¶å¤´ï¼ˆå‰ 2 å­—èŠ‚ï¼‰</span></span><br><span class="line">    header = f.read(<span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ£€æŸ¥æ–‡ä»¶å°¾ï¼ˆæœ€å 2 å­—èŠ‚ï¼‰</span></span><br><span class="line">    f.seek(-<span class="number">2</span>, <span class="number">2</span>)  <span class="comment"># ä»æ–‡ä»¶æœ«å°¾å‘å‰ç§»åŠ¨ 2 å­—èŠ‚</span></span><br><span class="line">    footer = f.read(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># JPG æ–‡ä»¶ï¼šå¤´éƒ¨ 0xFFD8ï¼Œå°¾éƒ¨ 0xFFD9</span></span><br><span class="line"><span class="keyword">if</span> header == <span class="string">b&#x27;\xff\xd8&#x27;</span> <span class="keyword">and</span> footer == <span class="string">b&#x27;\xff\xd9&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;è¯¥æ–‡ä»¶æ˜¯å®Œæ•´çš„ JPG å›¾ç‰‡æ ¼å¼&quot;</span>)</span><br><span class="line"><span class="keyword">elif</span> header == <span class="string">b&#x27;\xff\xd8&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;è¯¥æ–‡ä»¶å¯èƒ½æ˜¯ JPG å›¾ç‰‡ï¼ˆå¤´éƒ¨åŒ¹é…ï¼Œä½†å°¾éƒ¨ä¸å®Œæ•´ï¼‰&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;é JPG å›¾ç‰‡æ ¼å¼&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯­æ³•ç¤ºä¾‹3ï¼šæˆªå–éƒ¨åˆ†å­—èŠ‚æ•°æ®ï¼ˆå®é™…åº”ç”¨ï¼šæå–å›¾ç‰‡ç¼©ç•¥ä¿¡æ¯ï¼‰</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;video.mp4&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="comment"># è¯»å–å‰100å­—èŠ‚æ•°æ®ï¼ˆMP4æ–‡ä»¶å¤´éƒ¨åŒ…å«æ ¼å¼ä¿¡æ¯ï¼‰</span></span><br><span class="line">    video_header = f.read(<span class="number">100</span>)</span><br><span class="line"><span class="comment"># å°†æˆªå–çš„å¤´éƒ¨ä¿¡æ¯å†™å…¥æ–°æ–‡ä»¶ï¼Œç”¨äºæ ¼å¼åˆ†æ</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;video_header.bin&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(video_header)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;è§†é¢‘å¤´éƒ¨ä¿¡æ¯æå–å®Œæˆ&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="è¡¥å……ï¼šè¯»å–ç»“æœcontent">è¡¥å……ï¼šè¯»å–ç»“æœcontent</h3>
<h4 id="1-contentçš„ç±»å‹">&lt;1&gt;contentçš„ç±»å‹</h4>
<p><strong>1.æ–‡æœ¬æ¨¡å¼ï¼ˆrã€r+ï¼‰</strong>ï¼š</p>
<ul>
<li>content æ˜¯ <strong>str ç±»å‹ï¼ˆå­—ç¬¦ä¸²ï¼‰</strong> â€”â€”&gt; æ“ä½œæ–¹å¼å°±æ˜¯æ“ä½œâ€œå­—ç¬¦ä¸²â€</li>
<li>åŒ…å«æ–‡ä»¶ä¸­çš„åŸå§‹å­—ç¬¦ï¼ˆå¦‚æ¢è¡Œç¬¦ \nã€ç©ºæ ¼ç­‰ï¼‰</li>
</ul>
<p><strong>2.äºŒè¿›åˆ¶æ¨¡å¼ï¼ˆrbã€rb+ï¼‰</strong>ï¼š</p>
<ul>
<li>content æ˜¯ <strong>bytes ç±»å‹ï¼ˆå­—èŠ‚ä¸²ï¼‰</strong></li>
<li>æ ¼å¼ä¸º b&quot;xxx&quot;ï¼Œä¸æ¶‰åŠç¼–ç è½¬æ¢</li>
</ul>
<h4 id="2-contentçš„ç”Ÿå‘½å‘¨æœŸ">&lt;2&gt;contentçš„ç”Ÿå‘½å‘¨æœŸ</h4>
<p>contentä¸æ˜¯ç¼©è¿›åœ¨withå—ä¸­å®šä¹‰å—ï¼Œä¸ºä»€ä¹ˆwithè¯­å¥ç»“æŸåä»èƒ½ä½¿ç”¨ï¼Ÿ</p>
<ul>
<li><strong>with è¯­å¥ä¸ä¼šåˆ›å»ºæ–°çš„ä½œç”¨åŸŸï¼ï¼</strong>
<ul>
<li>æ‰€ä»¥ with å—å†…å®šä¹‰çš„å˜é‡ï¼Œåœ¨å—å¤–ä»å±äºåŒä¸€ä½œç”¨åŸŸï¼Œå¯ä»¥ç»§ç»­è®¿é—®</li>
</ul>
</li>
</ul>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(...) <span class="keyword">as</span> f:</span><br><span class="line">    content = f.<span class="built_in">read</span>()</span><br><span class="line">    â”‚</span><br><span class="line">    â””â”€â”€ content å®šä¹‰åœ¨ <span class="keyword">with</span> å—å†…</span><br><span class="line">        ä½† <span class="keyword">with</span> ä¸åˆ›å»ºæ–°ä½œç”¨åŸŸ</span><br><span class="line">        â†“</span><br><span class="line">        content å±äºå¤–å±‚ä½œç”¨åŸŸï¼ˆé€šå¸¸æ˜¯å‡½æ•°/æ¨¡å—çº§ï¼‰</span><br><span class="line">        â†“</span><br><span class="line">        <span class="keyword">with</span> ç»“æŸåä»å¯è®¿é—® content</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¤ºä¾‹1ï¼šwith å—å†…çš„å˜é‡åœ¨å—å¤–å¯ç”¨</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content = f.read()</span><br><span class="line">    line_count = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(content)      <span class="comment"># âœ… æ­£å¸¸</span></span><br><span class="line"><span class="built_in">print</span>(line_count)   <span class="comment"># âœ… æ­£å¸¸ï¼Œè¾“å‡º 10</span></span><br><span class="line"><span class="built_in">print</span>(f.closed)     <span class="comment"># âœ… è¾“å‡º Trueï¼ˆæ–‡ä»¶å·²å…³é—­ï¼Œä½† f å˜é‡ä»å­˜åœ¨ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹2ï¼šfor å¾ªç¯åŒç†</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    x = i * <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(i)  <span class="comment"># âœ… è¾“å‡º 4ï¼ˆå¾ªç¯å˜é‡åœ¨å¾ªç¯å¤–å¯ç”¨ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(x)  <span class="comment"># âœ… è¾“å‡º 8</span></span><br></pre></td></tr></table></figure>
<h2 id="4-å†™å…¥æ–‡ä»¶">4.å†™å…¥æ–‡ä»¶</h2>
<ul>
<li>å†™å…¥æ–‡ä»¶çš„æ ¸å¿ƒé€»è¾‘ï¼šç”¨ open() ä»¥â€œå†™æ¨¡å¼â€æ‰“å¼€æ–‡ä»¶ï¼Œé€šè¿‡æ–‡ä»¶å¯¹è±¡çš„å†™å…¥æ–¹æ³•å†™å…¥æ•°æ®ï¼Œ</li>
<li><strong>æ³¨æ„</strong>ï¼šâ€œå†™æ¨¡å¼â€ä¼šè¦†ç›–åŸæœ‰å†…å®¹ï¼Œâ€œè¿½åŠ æ¨¡å¼â€åˆ™åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ã€‚</li>
</ul>
<h3 id="ï¼ˆ1ï¼‰write-string-bytes-ï¼šå†™å…¥å­—ç¬¦ä¸²-å­—èŠ‚ä¸²">ï¼ˆ1ï¼‰write(string/bytes)ï¼šå†™å…¥å­—ç¬¦ä¸²/å­—èŠ‚ä¸²</h3>
<ul>
<li>æ–‡æœ¬æ¨¡å¼ä¸‹å†™å…¥å­—ç¬¦ä¸²ï¼ŒäºŒè¿›åˆ¶æ¨¡å¼ä¸‹å†™å…¥å­—èŠ‚ä¸²</li>
<li>è¿”å›å†™å…¥çš„å­—ç¬¦/å­—èŠ‚æ•°ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¯­æ³•ç¤ºä¾‹1ï¼šæ–‡æœ¬å†™å…¥ï¼ˆè¦†ç›–åŸæœ‰å†…å®¹ï¼Œæ¨¡å¼ &quot;w&quot;ï¼‰</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    count = f.write(<span class="string">&quot;Hello Python!\n&quot;</span>)  <span class="comment"># å†™å…¥å­—ç¬¦ä¸²ï¼Œ\n è¡¨ç¤ºæ¢è¡Œ</span></span><br><span class="line">    f.write(<span class="string">&quot;è¿™æ˜¯ç¬¬äºŒè¡Œå†…å®¹&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;å†™å…¥çš„å­—ç¬¦æ•°ï¼š<span class="subst">&#123;count&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šå†™å…¥çš„å­—ç¬¦æ•°ï¼š14</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯­æ³•ç¤ºä¾‹2ï¼šæ–‡æœ¬è¿½åŠ ï¼ˆæ¨¡å¼ &quot;a&quot;ï¼Œåœ¨æœ«å°¾æ·»åŠ ï¼Œä¸è¦†ç›–åŸæœ‰å†…å®¹ï¼‰</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;a&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">&quot;\nè¿™æ˜¯è¿½åŠ çš„å†…å®¹&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯­æ³•ç¤ºä¾‹3ï¼šäºŒè¿›åˆ¶å†™å…¥ï¼ˆæ¨¡å¼ &quot;wb&quot;ï¼‰</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;data.bin&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">b&quot;Hello Binary!&quot;</span>)  <span class="comment"># å†™å…¥å­—èŠ‚ä¸²ï¼Œå‰ç¼€ b è¡¨ç¤º bytes ç±»å‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¡¥å……ç¤ºä¾‹4ï¼šè¯»å–æ–‡æœ¬æ–‡ä»¶å†…å®¹ï¼Œå†™å…¥å¦ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼ˆæ–‡æœ¬æ–‡ä»¶å¤åˆ¶/æ ¼å¼è½¬æ¢ï¼‰</span></span><br><span class="line"><span class="comment"># åœºæ™¯ï¼šè¯»å–æºæ–‡ä»¶ï¼Œè¿‡æ»¤ç©ºè¡Œåå†™å…¥ç›®æ ‡æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;source.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> read_f, <span class="built_in">open</span>(<span class="string">&quot;target.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> write_f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> read_f:  <span class="comment"># é€è¡Œè¯»å–æºæ–‡ä»¶ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½å¤§æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span> line.strip():  <span class="comment"># è¿‡æ»¤ç©ºè¡Œï¼ˆstrip() å»é™¤ç©ºç™½å­—ç¬¦ååˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼‰</span></span><br><span class="line">            write_f.write(line)  <span class="comment"># å°†éç©ºè¡Œå†™å…¥ç›®æ ‡æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;æ–‡æœ¬æ–‡ä»¶å†…å®¹è¿‡æ»¤å¹¶å†™å…¥å®Œæˆ&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¡¥å……ç¤ºä¾‹5ï¼šè¯»å–äºŒè¿›åˆ¶æ–‡ä»¶å†…å®¹ï¼Œå†™å…¥å¦ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæ–‡ä»¶å¤‡ä»½ï¼‰</span></span><br><span class="line"><span class="comment"># åœºæ™¯ï¼šå¤‡ä»½å›¾ç‰‡ã€è§†é¢‘ç­‰äºŒè¿›åˆ¶æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;original.jpg&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> read_f, <span class="built_in">open</span>(<span class="string">&quot;backup.jpg&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> write_f:</span><br><span class="line">    <span class="comment"># åˆ†å—è¯»å–ï¼ˆæ¯æ¬¡1024å­—èŠ‚ï¼‰ï¼Œé€‚ç”¨äºå¤§äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé¿å…å†…å­˜å ç”¨è¿‡é«˜</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        chunk = read_f.read(<span class="number">1024</span>)  <span class="comment"># è¯»å–1024å­—èŠ‚å—</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> chunk:  <span class="comment"># è¯»å–å®Œæ¯•ï¼ˆchunkä¸ºç©ºå­—èŠ‚ä¸²ï¼‰</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        write_f.write(chunk)  <span class="comment"># å†™å…¥å­—èŠ‚å—åˆ°å¤‡ä»½æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;äºŒè¿›åˆ¶æ–‡ä»¶å¤‡ä»½å®Œæˆ&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰writelines-iterable-ï¼šå†™å…¥å¯è¿­ä»£å¯¹è±¡ï¼ˆåˆ—è¡¨-å…ƒç»„ç­‰ï¼‰">ï¼ˆ2ï¼‰writelines(iterable)ï¼šå†™å…¥å¯è¿­ä»£å¯¹è±¡ï¼ˆåˆ—è¡¨/å…ƒç»„ç­‰ï¼‰</h3>
<ul>
<li>æ¥æ”¶å­—ç¬¦ä¸²/å­—èŠ‚ä¸²ç»„æˆçš„<strong>å¯è¿­ä»£å¯¹è±¡</strong>ï¼Œæ‰¹é‡å†™å…¥</li>
<li>ä¸ä¼šè‡ªåŠ¨æ·»åŠ æ¢è¡Œç¬¦ï¼Œéœ€æ‰‹åŠ¨åœ¨å…ƒç´ ä¸­æ·»åŠ  \n</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŸºç¡€ç¤ºä¾‹ï¼šæ‰¹é‡å†™å…¥å¤šè¡Œå›ºå®šå†…å®¹</span></span><br><span class="line">lines = [<span class="string">&quot;ç¬¬ä¸€è¡Œ\n&quot;</span>, <span class="string">&quot;ç¬¬äºŒè¡Œ\n&quot;</span>, <span class="string">&quot;ç¬¬ä¸‰è¡Œ\n&quot;</span>]</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.writelines(lines)  <span class="comment"># æ‰¹é‡å†™å…¥åˆ—è¡¨ä¸­çš„å­—ç¬¦ä¸²ï¼Œ\n å®ç°æ¢è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®é™…åº”ç”¨1ï¼šè¯»å–å¤šä¸ªæ–‡ä»¶å†…å®¹ï¼Œæ•´åˆåæ‰¹é‡å†™å…¥æ–°æ–‡ä»¶</span></span><br><span class="line"><span class="comment"># åœºæ™¯ï¼šåˆå¹¶å¤šä¸ªæ—¥å¿—æ–‡ä»¶å†…å®¹åˆ°ä¸€ä¸ªæ±‡æ€»æ–‡ä»¶</span></span><br><span class="line">log_files = [<span class="string">&quot;log1.txt&quot;</span>, <span class="string">&quot;log2.txt&quot;</span>, <span class="string">&quot;log3.txt&quot;</span>]</span><br><span class="line">summary_lines = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…ˆè¯»å–æ‰€æœ‰æ—¥å¿—æ–‡ä»¶å†…å®¹ï¼Œæ·»åŠ åˆ°åˆ—è¡¨ä¸­ï¼ˆå¸¦æ–‡ä»¶æ ‡è¯†ï¼‰</span></span><br><span class="line"><span class="keyword">for</span> idx, log_file <span class="keyword">in</span> <span class="built_in">enumerate</span>(log_files, <span class="number">1</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(log_file, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="comment"># ç»™æ¯ä¸ªæ–‡ä»¶çš„å†…å®¹æ·»åŠ æ ‡è¯†è¡Œï¼Œä¾¿äºåŒºåˆ†æ¥æº</span></span><br><span class="line">        summary_lines.append(<span class="string">f&quot;=== æ—¥å¿—æ–‡ä»¶<span class="subst">&#123;idx&#125;</span>ï¼š<span class="subst">&#123;log_file&#125;</span> ===\n&quot;</span>)</span><br><span class="line">        summary_lines.extend([line <span class="keyword">for</span> line <span class="keyword">in</span> f])  <span class="comment"># è¯»å–æ–‡ä»¶æ‰€æœ‰è¡Œï¼Œæ·»åŠ åˆ°åˆ—è¡¨</span></span><br><span class="line">        summary_lines.append(<span class="string">&quot;\n&quot;</span>)  <span class="comment"># æ¯ä¸ªæ–‡ä»¶å†…å®¹åæ·»åŠ ç©ºè¡Œåˆ†éš”</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¹é‡å†™å…¥æ±‡æ€»æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;log_summary.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.writelines(summary_lines)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å¤šæ—¥å¿—æ–‡ä»¶åˆå¹¶å®Œæˆ&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®é™…åº”ç”¨2ï¼šç»“æ„åŒ–æ•°æ®æ ¼å¼åŒ–æ‰¹é‡å†™å…¥ï¼ˆç”ŸæˆCSVæ–‡ä»¶ï¼‰</span></span><br><span class="line"><span class="comment"># åœºæ™¯ï¼šå°†å­—å…¸åˆ—è¡¨æ ¼å¼çš„ç”¨æˆ·æ•°æ®ï¼Œè½¬ä¸ºCSVè¡Œåæ‰¹é‡å†™å…¥</span></span><br><span class="line">user_list = [</span><br><span class="line">    &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">25</span>, <span class="string">&quot;city&quot;</span>: <span class="string">&quot;åŒ—äº¬&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;æå››&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">30</span>, <span class="string">&quot;city&quot;</span>: <span class="string">&quot;ä¸Šæµ·&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;ç‹äº”&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">28</span>, <span class="string">&quot;city&quot;</span>: <span class="string">&quot;å¹¿å·&quot;</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…ˆæ„é€ CSVè¡¨å¤´å’Œå†…å®¹è¡Œï¼ˆè½¬ä¸ºå­—ç¬¦ä¸²åˆ—è¡¨ï¼‰</span></span><br><span class="line">csv_lines = [<span class="string">&quot;å§“å,å¹´é¾„,åŸå¸‚\n&quot;</span>]  <span class="comment"># è¡¨å¤´</span></span><br><span class="line"><span class="keyword">for</span> user <span class="keyword">in</span> user_list:</span><br><span class="line">    <span class="comment"># æ ¼å¼åŒ–æ¯ä¸ªç”¨æˆ·æ•°æ®ä¸ºCSVè¡Œå­—ç¬¦ä¸²</span></span><br><span class="line">    csv_line = <span class="string">f&quot;<span class="subst">&#123;user[<span class="string">&#x27;name&#x27;</span>]&#125;</span>,<span class="subst">&#123;user[<span class="string">&#x27;age&#x27;</span>]&#125;</span>,<span class="subst">&#123;user[<span class="string">&#x27;city&#x27;</span>]&#125;</span>\n&quot;</span></span><br><span class="line">    csv_lines.append(csv_line)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¹é‡å†™å…¥CSVæ–‡ä»¶</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;user_info.csv&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.writelines(csv_lines)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;ç”¨æˆ·æ•°æ®CSVæ–‡ä»¶ç”Ÿæˆå®Œæˆ&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="5-è¯»å†™æ¨¡å¼ï¼ˆr-ã€w-ã€a-ï¼‰">5.è¯»å†™æ¨¡å¼ï¼ˆr+ã€w+ã€a+ï¼‰</h2>
<p>è‹¥éœ€åŒæ—¶å®ç°è¯»å†™æ“ä½œï¼Œå¯ä½¿ç”¨å¸¦â€œ+â€çš„æ¨¡å¼ï¼Œæ ¸å¿ƒåŒºåˆ«å¦‚ä¸‹ï¼š<br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260111211850795.png" alt=""><br>
<strong>æ³¨æ„</strong>ï¼šå¯è¯»å¯å†™æ¨¡å¼ä¸‹ï¼Œâ€œè¯»â€ã€â€œå†™â€å…±ç”¨ä¸€ä¸ªâ€œæ–‡ä»¶æŒ‡é’ˆâ€ï¼Œä¼šç›¸äº’å½±å“</p>
<h3 id="ï¼ˆ1ï¼‰r-æ¨¡å¼ï¼šè¯»å†™ï¼ˆæ–‡ä»¶å¿…é¡»å­˜åœ¨ï¼‰">ï¼ˆ1ï¼‰r+ æ¨¡å¼ï¼šè¯»å†™ï¼ˆæ–‡ä»¶å¿…é¡»å­˜åœ¨ï¼‰</h3>
<p>å‡è®¾ test.txt åˆå§‹å†…å®¹ä¸ºï¼š</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">Hello World</span><br><span class="line">Python <span class="keyword">File</span></span><br><span class="line"><span class="keyword">End</span> of <span class="keyword">File</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># r+ æ¨¡å¼ï¼šä»æ–‡ä»¶å¼€å¤´å¼€å§‹ï¼Œå¯è¯»å¯å†™</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;r+&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="comment"># 1. å…ˆè¯»å–å†…å®¹</span></span><br><span class="line">    content = f.read()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;è¯»å–å†…å®¹ï¼š\n<span class="subst">&#123;content&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;è¯»å–åæŒ‡é’ˆä½ç½®ï¼š<span class="subst">&#123;f.tell()&#125;</span>&quot;</span>)  <span class="comment"># æŒ‡é’ˆåœ¨æ–‡ä»¶æœ«å°¾</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. ç›´æ¥å†™å…¥ï¼ˆä¼šè¿½åŠ åˆ°æœ«å°¾ï¼Œå› ä¸ºæŒ‡é’ˆåœ¨æœ«å°¾ï¼‰</span></span><br><span class="line">    f.write(<span class="string">&quot;\næ–°å¢å†…å®¹1&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. ç§»åŠ¨æŒ‡é’ˆåˆ°å¼€å¤´å†å†™å…¥ï¼ˆä¼šè¦†ç›–åŸå†…å®¹ï¼‰</span></span><br><span class="line">    f.seek(<span class="number">0</span>)</span><br><span class="line">    f.write(<span class="string">&quot;COVER&quot;</span>)  <span class="comment"># è¦†ç›–å‰5ä¸ªå­—ç¬¦ &quot;Hello&quot; -&gt; &quot;COVER&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 4. è¯»å–æœ€ç»ˆå†…å®¹</span></span><br><span class="line">    f.seek(<span class="number">0</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æœ€ç»ˆå†…å®¹ï¼š\n<span class="subst">&#123;f.read()&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight vhdl"><table><tr><td class="code"><pre><span class="line">è¯»å–å†…å®¹ï¼š</span><br><span class="line">Hello World</span><br><span class="line">Python <span class="keyword">File</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">of</span> <span class="keyword">File</span></span><br><span class="line">è¯»å–åæŒ‡é’ˆä½ç½®ï¼š<span class="number">35</span></span><br><span class="line">æœ€ç»ˆå†…å®¹ï¼š</span><br><span class="line"><span class="keyword">COVER</span> World</span><br><span class="line">Python <span class="keyword">File</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">of</span> <span class="keyword">File</span></span><br><span class="line">æ–°å¢å†…å®¹<span class="number">1</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰w-æ¨¡å¼ï¼šè¯»å†™ï¼ˆæ¸…ç©ºæ–‡ä»¶-åˆ›å»ºæ–°æ–‡ä»¶ï¼‰">ï¼ˆ2ï¼‰w+ æ¨¡å¼ï¼šè¯»å†™ï¼ˆæ¸…ç©ºæ–‡ä»¶/åˆ›å»ºæ–°æ–‡ä»¶ï¼‰</h3>
<p>å‡è®¾ test.txt åˆå§‹å†…å®¹ä¸ºï¼š</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">Hello World</span><br><span class="line">Python <span class="keyword">File</span></span><br><span class="line"><span class="keyword">End</span> of <span class="keyword">File</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># w+ æ¨¡å¼ï¼šæ‰“å¼€æ—¶æ¸…ç©ºæ–‡ä»¶ï¼Œå¯è¯»å¯å†™</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;w+&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="comment"># 1. æ–‡ä»¶å·²è¢«æ¸…ç©ºï¼Œç›´æ¥è¯»å–ä¸ºç©º</span></span><br><span class="line">    content = f.read()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æ‰“å¼€åè¯»å–ï¼š&#x27;<span class="subst">&#123;content&#125;</span>&#x27;&quot;</span>)  <span class="comment"># ç©ºå­—ç¬¦ä¸²</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. å†™å…¥æ–°å†…å®¹</span></span><br><span class="line">    f.write(<span class="string">&quot;ç¬¬ä¸€è¡Œ\n&quot;</span>)</span><br><span class="line">    f.write(<span class="string">&quot;ç¬¬äºŒè¡Œ\n&quot;</span>)</span><br><span class="line">    f.write(<span class="string">&quot;ç¬¬ä¸‰è¡Œ&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å†™å…¥åæŒ‡é’ˆä½ç½®ï¼š<span class="subst">&#123;f.tell()&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. å¿…é¡»ç§»åŠ¨æŒ‡é’ˆæ‰èƒ½è¯»å–</span></span><br><span class="line">    f.seek(<span class="number">0</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;è¯»å–å†™å…¥çš„å†…å®¹ï¼š\n<span class="subst">&#123;f.read()&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">æ‰“å¼€åè¯»å–ï¼š&#x27;&#x27;</span><br><span class="line">å†™å…¥åæŒ‡é’ˆä½ç½®ï¼š<span class="number">21</span></span><br><span class="line">è¯»å–å†™å…¥çš„å†…å®¹ï¼š</span><br><span class="line">ç¬¬ä¸€è¡Œ</span><br><span class="line">ç¬¬äºŒè¡Œ</span><br><span class="line">ç¬¬ä¸‰è¡Œ</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰a-æ¨¡å¼ï¼šè¿½åŠ è¯»å†™ï¼ˆä¸æ¸…ç©º-åˆ›å»ºæ–°æ–‡ä»¶ï¼‰">ï¼ˆ3ï¼‰a+ æ¨¡å¼ï¼šè¿½åŠ è¯»å†™ï¼ˆä¸æ¸…ç©º/åˆ›å»ºæ–°æ–‡ä»¶ï¼‰</h3>
<p>å‡è®¾ test.txt åˆå§‹å†…å®¹ä¸ºï¼š</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">Hello World</span><br><span class="line">Python <span class="keyword">File</span></span><br><span class="line"><span class="keyword">End</span> of <span class="keyword">File</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># a+ æ¨¡å¼ï¼šå†™å…¥æ°¸è¿œåœ¨æœ«å°¾ï¼Œè¯»å–éœ€è¦ç§»åŠ¨æŒ‡é’ˆ</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;a+&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="comment"># 1. æ‰“å¼€æ—¶æŒ‡é’ˆåœ¨æœ«å°¾</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æ‰“å¼€æ—¶æŒ‡é’ˆä½ç½®ï¼š<span class="subst">&#123;f.tell()&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. ç›´æ¥è¯»å–ä¸ºç©ºï¼ˆæŒ‡é’ˆåœ¨æœ«å°¾ï¼‰</span></span><br><span class="line">    content = f.read()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ç›´æ¥è¯»å–ï¼š&#x27;<span class="subst">&#123;content&#125;</span>&#x27;&quot;</span>)  <span class="comment"># ç©º</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. ç§»åŠ¨æŒ‡é’ˆåˆ°å¼€å¤´å†è¯»å–</span></span><br><span class="line">    f.seek(<span class="number">0</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ç§»åŠ¨æŒ‡é’ˆåè¯»å–ï¼š\n<span class="subst">&#123;f.read()&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 4. å†™å…¥å†…å®¹ï¼ˆæ— è®ºæŒ‡é’ˆåœ¨å“ªï¼Œéƒ½è¿½åŠ åˆ°æœ«å°¾ï¼‰</span></span><br><span class="line">    f.seek(<span class="number">0</span>)  <span class="comment"># å³ä½¿ç§»åŠ¨åˆ°å¼€å¤´</span></span><br><span class="line">    f.write(<span class="string">&quot;\nè¿½åŠ çš„å†…å®¹&quot;</span>)  <span class="comment"># ä»ç„¶å†™åˆ°æœ«å°¾</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 5. éªŒè¯</span></span><br><span class="line">    f.seek(<span class="number">0</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æœ€ç»ˆå†…å®¹ï¼š\n<span class="subst">&#123;f.read()&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight delphi"><table><tr><td class="code"><pre><span class="line">æ‰“å¼€æ—¶æŒ‡é’ˆä½ç½®ï¼š<span class="number">35</span></span><br><span class="line">ç›´æ¥è¯»å–ï¼š<span class="string">&#x27;&#x27;</span></span><br><span class="line">ç§»åŠ¨æŒ‡é’ˆåè¯»å–ï¼š</span><br><span class="line">Hello World</span><br><span class="line">Python <span class="keyword">File</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">of</span> <span class="keyword">File</span></span><br><span class="line">æœ€ç»ˆå†…å®¹ï¼š</span><br><span class="line">Hello World</span><br><span class="line">Python <span class="keyword">File</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">of</span> <span class="keyword">File</span></span><br><span class="line">è¿½åŠ çš„å†…å®¹</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ4ï¼‰æŒ‡é’ˆå½±å“æ¼”ç¤º">ï¼ˆ4ï¼‰æŒ‡é’ˆå½±å“æ¼”ç¤º</h3>
<p>å‡è®¾ test.txt åˆå§‹å†…å®¹ä¸ºï¼š</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">Hello World</span><br><span class="line">Python <span class="keyword">File</span></span><br><span class="line"><span class="keyword">End</span> of <span class="keyword">File</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;demo.txt&quot;</span>, <span class="string">&quot;w+&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="comment"># å†™å…¥å†…å®¹</span></span><br><span class="line">    f.write(<span class="string">&quot;ABCDEFGHIJ&quot;</span>)  <span class="comment"># æŒ‡é’ˆåœ¨ä½ç½®10</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ä¸ç§»åŠ¨æŒ‡é’ˆç›´æ¥è¯»å–</span></span><br><span class="line">    result1 = f.read()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å†™å…¥åç›´æ¥è¯»ï¼š&#x27;<span class="subst">&#123;result1&#125;</span>&#x27;&quot;</span>)  <span class="comment"># ç©ºï¼Œå› ä¸ºæŒ‡é’ˆåœ¨æœ«å°¾</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ç§»åŠ¨åˆ°ä½ç½®5</span></span><br><span class="line">    f.seek(<span class="number">5</span>)</span><br><span class="line">    result2 = f.read()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ä»ä½ç½®5è¯»å–ï¼š&#x27;<span class="subst">&#123;result2&#125;</span>&#x27;&quot;</span>)  <span class="comment"># FGHIJ</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># åœ¨ä½ç½®3å†™å…¥ï¼Œä¼šè¦†ç›–</span></span><br><span class="line">    f.seek(<span class="number">3</span>)</span><br><span class="line">    f.write(<span class="string">&quot;XYZ&quot;</span>)  <span class="comment"># è¦†ç›– DEF -&gt; XYZ</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è¯»å–å…¨éƒ¨</span></span><br><span class="line">    f.seek(<span class="number">0</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æœ€ç»ˆå†…å®¹ï¼š&#x27;<span class="subst">&#123;f.read()&#125;</span>&#x27;&quot;</span>)  <span class="comment"># ABCXYZGHIJ</span></span><br></pre></td></tr></table></figure>
<p>è¾“å‡º</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">å†™å…¥åç›´æ¥è¯»ï¼š&#x27;&#x27;</span><br><span class="line">ä»ä½ç½®<span class="number">5</span>è¯»å–ï¼š&#x27;FGHIJ&#x27;</span><br><span class="line">æœ€ç»ˆå†…å®¹ï¼š&#x27;ABCXYZGHIJ&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="è¡¥å……1ï¼šseek-å‡½æ•°">è¡¥å……1ï¼šseek() å‡½æ•°</h3>
<p>åœ¨è¯»å†™æ¨¡å¼ä¸‹ï¼Œæ–‡ä»¶æŒ‡é’ˆçš„ä½ç½®ç›´æ¥å½±å“è¯»å†™ç»“æœï¼Œ<strong>seekå‡½æ•°</strong>ç”¨äºæ‰‹åŠ¨ç§»åŠ¨æ–‡ä»¶æŒ‡é’ˆï¼Œæ˜¯å®ç°ç²¾å‡†è¯»å†™çš„å…³é”®ã€‚</p>
<ul>
<li><strong>æ ¸å¿ƒåŠŸèƒ½</strong>ï¼š
<ul>
<li>ç§»åŠ¨æ–‡ä»¶æŒ‡é’ˆåˆ°æŒ‡å®šä½ç½®ï¼Œæ”¯æŒæ–‡æœ¬æ¨¡å¼å’ŒäºŒè¿›åˆ¶æ¨¡å¼ï¼ˆäºŒè¿›åˆ¶æ¨¡å¼æ›´ç²¾å‡†ï¼Œæ–‡æœ¬æ¨¡å¼ä¸‹ offset å»ºè®®ä¸º 0ï¼‰</li>
</ul>
</li>
<li><strong>è¯­æ³•</strong>ï¼š
<ul>
<li><strong>seek(offset, whence)</strong></li>
</ul>
</li>
<li><strong>å‚æ•°è¯´æ˜</strong>ï¼š
<ul>
<li><strong>offset</strong>ï¼šåç§»é‡ï¼Œå³æŒ‡é’ˆç§»åŠ¨çš„å­—èŠ‚æ•°
<ul>
<li>æ­£æ•°å‘å³ç§»åŠ¨</li>
<li>è´Ÿæ•°å‘å·¦ç§»åŠ¨</li>
<li>æ–‡æœ¬æ¨¡å¼ä¸‹ä¸æ”¯æŒè´Ÿæ•°åç§»</li>
</ul>
</li>
<li><strong>whence</strong>ï¼šåŸºå‡†ä½ç½®ï¼Œå¯é€‰å€¼ä¸º 0ã€1ã€2ï¼ˆ<strong>é»˜è®¤å€¼ä¸º 0</strong>ï¼‰
<ul>
<li><strong>whence=0</strong>ï¼šä»¥æ–‡ä»¶å¼€å¤´ä¸ºåŸºå‡†ï¼ˆæœ€å¸¸ç”¨ï¼Œæ”¯æŒæ‰€æœ‰æ¨¡å¼ï¼‰ï¼›</li>
<li><strong>whence=1</strong>ï¼šä»¥å½“å‰æŒ‡é’ˆä½ç½®ä¸ºåŸºå‡†ï¼ˆä»…æ”¯æŒäºŒè¿›åˆ¶æ¨¡å¼ï¼‰ï¼›</li>
<li><strong>whence=2</strong>ï¼šä»¥æ–‡ä»¶æœ«å°¾ä¸ºåŸºå‡†ï¼ˆä»…æ”¯æŒäºŒè¿›åˆ¶æ¨¡å¼ï¼‰ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><strong>å¸¸è§ç”¨æ³•</strong>ï¼š
<ul>
<li>f.seek(0)ï¼šæŒ‡é’ˆç§»åˆ°æ–‡ä»¶å¼€å¤´ï¼ˆè¯»å†™æ¨¡å¼ä¸‹è¯»å–å‰å¿…ç”¨ï¼‰ï¼›</li>
<li>f.seek(0, 2)ï¼šæŒ‡é’ˆç§»åˆ°æ–‡ä»¶æœ«å°¾ï¼ˆè¿½åŠ å†…å®¹å‰å¯ç”¨ï¼Œç­‰åŒäº a æ¨¡å¼ï¼‰ï¼›</li>
<li>f.seek(5)ï¼šæŒ‡é’ˆä»æ–‡ä»¶å¼€å¤´å‘å³ç§»åŠ¨ 5 ä¸ªå­—èŠ‚ï¼ˆç²¾å‡†å®šä½ä¿®æ”¹ä½ç½®ï¼‰ã€‚</li>
</ul>
</li>
<li>**æ³¨æ„ï¼š**æ–‡æœ¬æ¨¡å¼ä¸‹ seek() çš„é™åˆ¶
<ul>
<li>whence=1 å’Œ whence=2 ä»…æ”¯æŒäºŒè¿›åˆ¶æ¨¡å¼</li>
<li>æ–‡æœ¬æ¨¡å¼ä¸‹ offset å¿…é¡»ä¸º 0ï¼Œæˆ–è€…æ˜¯ tell() è¿”å›çš„å€¼
<ul>
<li>å¦åˆ™ä¼šæŠ¥é”™ï¼šio.UnsupportedOperation: canâ€™t do nonzero cur-relative seeks</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="è¡¥å……2ï¼štell-å‡½æ•°">è¡¥å……2ï¼štell() å‡½æ•°</h3>
<p>tell() æ˜¯æ–‡ä»¶å¯¹è±¡çš„æ–¹æ³•ï¼Œç”¨äº<strong>è·å–å½“å‰æ–‡ä»¶æŒ‡é’ˆçš„ä½ç½®</strong>ã€‚</p>
<h4 id="1-ä»‹ç»-3">&lt;1&gt;ä»‹ç»</h4>
<ul>
<li><strong>åŸºæœ¬è¯­æ³•</strong>ï¼š</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">position = f.tell()  <span class="comment"># è¿”å›å½“å‰æŒ‡é’ˆä½ç½®ï¼ˆå­—èŠ‚æ•°ï¼‰</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>æ ¸å¿ƒç‰¹ç‚¹</strong><br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260111220721101.png" alt=""></li>
<li><strong>ä¸seek()çš„é…åˆå…³ç³»</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tell() â”€â”€â–º è·å–å½“å‰ä½ç½®ï¼ˆåªè¯»ï¼‰</span><br><span class="line">seek() â”€â”€â–º è®¾ç½®æŒ‡é’ˆä½ç½®ï¼ˆå¯å†™ï¼‰</span><br><span class="line"></span><br><span class="line">å¸¸è§ç»„åˆï¼š</span><br><span class="line"><span class="number">1.</span> pos = f.tell()   <span class="comment"># ä¿å­˜ä½ç½®</span></span><br><span class="line"><span class="number">2.</span> f.read(...)      <span class="comment"># è¯»å–æ“ä½œ</span></span><br><span class="line"><span class="number">3.</span> f.seek(pos)      <span class="comment"># æ¢å¤ä½ç½®</span></span><br></pre></td></tr></table></figure>
<h4 id="2-ä½¿ç”¨ç¤ºä¾‹">&lt;2&gt;ä½¿ç”¨ç¤ºä¾‹</h4>
<h5 id="1ï¼‰åŸºæœ¬ç”¨æ³•">1ï¼‰åŸºæœ¬ç”¨æ³•</h5>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="built_in">print</span>(f.tell())      <span class="comment"># è¾“å‡ºï¼š0ï¼ˆåˆšæ‰“å¼€ï¼ŒæŒ‡é’ˆåœ¨å¼€å¤´ï¼‰</span></span><br><span class="line">    </span><br><span class="line">    f.read(<span class="number">5</span>)            <span class="comment"># è¯»å– 5 ä¸ªå­—ç¬¦</span></span><br><span class="line">    <span class="built_in">print</span>(f.tell())      <span class="comment"># è¾“å‡ºï¼š5ï¼ˆè‹±æ–‡ï¼‰æˆ–æ›´å¤§ï¼ˆå«ä¸­æ–‡æ—¶ï¼‰</span></span><br><span class="line">    </span><br><span class="line">    f.read()             <span class="comment"># è¯»å–å‰©ä½™å…¨éƒ¨å†…å®¹</span></span><br><span class="line">    <span class="built_in">print</span>(f.tell())      <span class="comment"># è¾“å‡ºï¼šæ–‡ä»¶æ€»å­—èŠ‚æ•°ï¼ˆæŒ‡é’ˆåœ¨æœ«å°¾ï¼‰</span></span><br></pre></td></tr></table></figure>
<h5 id="2ï¼‰é…åˆ-seek-ä½¿ç”¨">2ï¼‰é…åˆ seek() ä½¿ç”¨</h5>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.read(<span class="number">10</span>)</span><br><span class="line">    pos = f.tell()       <span class="comment"># è®°å½•å½“å‰ä½ç½®</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å½“å‰ä½ç½®ï¼š<span class="subst">&#123;pos&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    content = f.read(<span class="number">5</span>)  <span class="comment"># ç»§ç»­è¯»å–</span></span><br><span class="line">    </span><br><span class="line">    f.seek(pos)          <span class="comment"># å›åˆ°ä¹‹å‰è®°å½•çš„ä½ç½®</span></span><br><span class="line">    <span class="built_in">print</span>(f.tell())      <span class="comment"># è¾“å‡ºï¼šä¸ä¹‹å‰çš„ pos ç›¸åŒ</span></span><br></pre></td></tr></table></figure>
<h5 id="3ï¼‰è¯»å†™æ¨¡å¼ä¸‹è·Ÿè¸ªæŒ‡é’ˆ">3ï¼‰è¯»å†™æ¨¡å¼ä¸‹è·Ÿè¸ªæŒ‡é’ˆ</h5>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;demo.txt&quot;</span>, <span class="string">&quot;w+&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å†™å…¥å‰ï¼š<span class="subst">&#123;f.tell()&#125;</span>&quot;</span>)   <span class="comment"># è¾“å‡ºï¼š0</span></span><br><span class="line">    </span><br><span class="line">    f.write(<span class="string">&quot;Hello Python&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;å†™å…¥åï¼š<span class="subst">&#123;f.tell()&#125;</span>&quot;</span>)   <span class="comment"># è¾“å‡ºï¼š12</span></span><br><span class="line">    </span><br><span class="line">    f.seek(<span class="number">0</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;seekåï¼š<span class="subst">&#123;f.tell()&#125;</span>&quot;</span>)   <span class="comment"># è¾“å‡ºï¼š0</span></span><br><span class="line">    </span><br><span class="line">    f.read(<span class="number">5</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;è¯»å–åï¼š<span class="subst">&#123;f.tell()&#125;</span>&quot;</span>)   <span class="comment"># è¾“å‡ºï¼š5</span></span><br></pre></td></tr></table></figure>
<h5 id="4ï¼‰ä¸­æ–‡å­—ç¬¦çš„å­—èŠ‚è®¡ç®—">4ï¼‰ä¸­æ–‡å­—ç¬¦çš„å­—èŠ‚è®¡ç®—</h5>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># UTF-8 ç¼–ç ä¸‹ï¼Œä¸­æ–‡å­—ç¬¦å  3 ä¸ªå­—èŠ‚</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;chinese.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">&quot;ä½ å¥½ä¸–ç•Œ&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;chinese.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.read(<span class="number">1</span>)            <span class="comment"># è¯»å– 1 ä¸ªå­—ç¬¦ï¼ˆ&quot;ä½ &quot;ï¼‰</span></span><br><span class="line">    <span class="built_in">print</span>(f.tell())      <span class="comment"># è¾“å‡ºï¼š3ï¼ˆ1ä¸ªä¸­æ–‡ = 3å­—èŠ‚ï¼‰</span></span><br><span class="line">    </span><br><span class="line">    f.read(<span class="number">1</span>)            <span class="comment"># è¯»å– 1 ä¸ªå­—ç¬¦ï¼ˆ&quot;å¥½&quot;ï¼‰</span></span><br><span class="line">    <span class="built_in">print</span>(f.tell())      <span class="comment"># è¾“å‡ºï¼š6</span></span><br></pre></td></tr></table></figure>
<h5 id="5ï¼‰ä½¿ç”¨åœºæ™¯">5ï¼‰ä½¿ç”¨åœºæ™¯</h5>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœºæ™¯1ï¼šè®°å½•è¯»å–è¿›åº¦ï¼ˆæ–­ç‚¹ç»­è¯»ï¼‰</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;large_file.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> i, line <span class="keyword">in</span> <span class="built_in">enumerate</span>(f):</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">100</span>:</span><br><span class="line">            checkpoint = f.tell()  <span class="comment"># è®°å½•ç¬¬100è¡Œåçš„ä½ç½®</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;æ£€æŸ¥ç‚¹ä½ç½®ï¼š<span class="subst">&#123;checkpoint&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœºæ™¯2ï¼šè®¡ç®—æ–‡ä»¶å¤§å°</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.seek(<span class="number">0</span>, <span class="number">2</span>)         <span class="comment"># ç§»åŠ¨åˆ°æ–‡ä»¶æœ«å°¾</span></span><br><span class="line">    file_size = f.tell() <span class="comment"># è·å–æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æ–‡ä»¶å¤§å°ï¼š<span class="subst">&#123;file_size&#125;</span> å­—èŠ‚&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="6-ç»“æ„åŒ–æ•°æ®å­˜å‚¨ï¼šJSONï¼ˆæŒä¹…åŒ–å­˜å‚¨ï¼‰">6.ç»“æ„åŒ–æ•°æ®å­˜å‚¨ï¼šJSONï¼ˆæŒä¹…åŒ–å­˜å‚¨ï¼‰</h2>
<ul>
<li>å½“éœ€è¦å­˜å‚¨åˆ—è¡¨ã€å­—å…¸ã€ç±»å®ä¾‹ç­‰ç»“æ„åŒ–æ•°æ®æ—¶ï¼Œç›´æ¥ç”¨æ–‡æœ¬æ–‡ä»¶è¯»å†™ä¼šå¯¼è‡´æ ¼å¼æ··ä¹±ï¼Œæ¨èä½¿ç”¨ Python æ ‡å‡†åº“æä¾›çš„åºåˆ—åŒ–å·¥å…·ï¼šjsonï¼ˆé€šç”¨æ ¼å¼ï¼Œè·¨è¯­è¨€å…¼å®¹ï¼‰ã€pickleï¼ˆPython ä¸“å±æ ¼å¼ï¼Œæ”¯æŒæ›´å¤šæ•°æ®ç±»å‹ï¼‰ã€‚</li>
<li>JSONï¼ˆJavaScript Object Notationï¼‰æ˜¯è½»é‡çº§æ•°æ®äº¤æ¢æ ¼å¼
<ul>
<li>æ”¯æŒ<strong>å­—ç¬¦ä¸²</strong>ã€<strong>æ•°å­—</strong>ã€<strong>åˆ—è¡¨</strong>ã€<strong>å­—å…¸</strong>ç­‰åŸºç¡€æ•°æ®ç±»å‹</li>
<li>ä¸æ”¯æŒ Python ä¸“å±ç±»å‹ï¼ˆå¦‚<strong>ç±»å®ä¾‹</strong>ã€<strong>å…ƒç»„</strong>ã€<strong>é›†åˆ</strong>ï¼‰
<ul>
<li><strong>è¡¥å……</strong>ï¼šJSON ä¸­æ•°ç»„ä¼šè¢«è½¬ä¸º Python åˆ—è¡¨ï¼ŒPython å…ƒç»„åºåˆ—åŒ–åä¼šå˜æˆåˆ—è¡¨ã€‚è¯»å–æ—¶æ— æ³•è¿˜åŸä¸ºå…ƒç»„ã€‚</li>
</ul>
</li>
<li><strong>json.dump()</strong>ï¼šå†™å…¥æ–‡ä»¶,å®ç°åºåˆ—åŒ–</li>
<li><strong>json.load()</strong>ï¼šè¯»å–æ–‡ä»¶ï¼Œå®ç°ååºåˆ—åŒ–</li>
</ul>
</li>
</ul>
<h3 id="ï¼ˆ1ï¼‰å†™å…¥JSONæ•°æ®ï¼ˆåºåˆ—åŒ–ï¼‰">ï¼ˆ1ï¼‰å†™å…¥JSONæ•°æ®ï¼ˆåºåˆ—åŒ–ï¼‰</h3>
<h4 id="1-json-dump-å‡½æ•°">&lt;1&gt;json.dump() å‡½æ•°</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> æ ¸å¿ƒä½œç”¨ï¼šå°† Python ç»“æ„åŒ–æ•°æ®ï¼ˆå¦‚å­—å…¸ã€åˆ—è¡¨ï¼‰åºåˆ—åŒ–ï¼ˆè½¬æ¢ï¼‰ä¸º JSON æ ¼å¼å­—ç¬¦ä¸²ï¼Œç›´æ¥å†™å…¥æ–‡ä»¶</span><br><span class="line"><span class="number">2.</span> å‡½æ•°è¯­æ³•ï¼šjson.dump(obj, fp, ensure_ascii=<span class="literal">True</span>, indent=<span class="literal">None</span>, separators=<span class="literal">None</span>, sort_keys=<span class="literal">False</span>, ...)</span><br><span class="line"><span class="number">3.</span> å…³é”®å‚æ•°è¯´æ˜ï¼š</span><br><span class="line">    - objï¼šå¿…ä¼ å‚æ•°ï¼Œè¦åºåˆ—åŒ–çš„ Python æ•°æ®ï¼ˆæ”¯æŒå­—å…¸ã€åˆ—è¡¨ã€å­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ã€<span class="literal">None</span>ï¼‰ï¼›</span><br><span class="line">    - fpï¼šå¿…ä¼ å‚æ•°ï¼Œæ–‡ä»¶å¯¹è±¡ï¼ˆéœ€ä»¥æ–‡æœ¬æ¨¡å¼ <span class="string">&quot;w&quot;</span> æˆ– <span class="string">&quot;a&quot;</span> æ‰“å¼€ï¼‰ï¼Œç”¨äºæ¥æ”¶ JSON æ•°æ®ï¼›</span><br><span class="line">    - ensure_asciiï¼šå¯é€‰å‚æ•°ï¼Œé»˜è®¤ <span class="literal">True</span>ï¼Œé ASCII å­—ç¬¦ï¼ˆå¦‚ä¸­æ–‡ï¼‰ä¼šè½¬ä¸º Unicode è½¬ä¹‰ç¬¦ï¼ˆ\uXXXï¼‰ï¼›è®¾ä¸º <span class="literal">False</span> å¯ä¿ç•™ä¸­æ–‡åŸæ ·ï¼›</span><br><span class="line">    - indentï¼šå¯é€‰å‚æ•°ï¼Œé»˜è®¤ <span class="literal">None</span>ï¼ˆæ— æ ¼å¼åŒ–ï¼‰ï¼Œä¼ å…¥æ•´æ•°æ—¶è¡¨ç¤ºç¼©è¿›ç©ºæ ¼æ•°ï¼Œç”¨äºæ ¼å¼åŒ– JSON è¾“å‡ºï¼ˆä¾¿äºé˜…è¯»ï¼‰ï¼›</span><br><span class="line">    - sort_keysï¼šå¯é€‰å‚æ•°ï¼Œé»˜è®¤ <span class="literal">False</span>ï¼Œè®¾ä¸º <span class="literal">True</span> æ—¶ä¼šæŒ‰å­—å…¸çš„é”®ï¼ˆkeyï¼‰å‡åºæ’åºè¾“å‡ºã€‚</span><br></pre></td></tr></table></figure>
<h4 id="2-ä½¿ç”¨ç¤ºä¾‹-2">&lt;2&gt;ä½¿ç”¨ç¤ºä¾‹</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®é™…ç¤ºä¾‹ï¼šå†™å…¥ JSON æ•°æ®</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¦å­˜å‚¨çš„ç»“æ„åŒ–æ•°æ®ï¼ˆå­—å…¸ï¼‰</span></span><br><span class="line">user_data = &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;å¼ ä¸‰&quot;</span>,</span><br><span class="line">    <span class="string">&quot;age&quot;</span>: <span class="number">25</span>,</span><br><span class="line">    <span class="string">&quot;hobbies&quot;</span>: [<span class="string">&quot;ç¯®çƒ&quot;</span>, <span class="string">&quot;ç¼–ç¨‹&quot;</span>],</span><br><span class="line">    <span class="string">&quot;is_student&quot;</span>: <span class="literal">False</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†™å…¥ JSON æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;user_data.json&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="comment"># ensure_ascii=False ç¡®ä¿ä¸­æ–‡æ­£å¸¸æ˜¾ç¤ºï¼Œindent=2 æ ¼å¼åŒ–è¾“å‡ºï¼ˆä¾¿äºé˜…è¯»ï¼‰</span></span><br><span class="line">    json.dump(user_data, f, ensure_ascii=<span class="literal">False</span>, indent=<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰è¯»å–-JSON-æ•°æ®ï¼ˆååºåˆ—åŒ–ï¼‰">ï¼ˆ2ï¼‰è¯»å– JSON æ•°æ®ï¼ˆååºåˆ—åŒ–ï¼‰</h3>
<h4 id="1-json-load-å‡½æ•°">&lt;1&gt;json.load()å‡½æ•°</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> æ ¸å¿ƒä½œç”¨ï¼šä»å·²æ‰“å¼€çš„ JSON æ–‡ä»¶ä¸­è¯»å– JSON æ ¼å¼å­—ç¬¦ä¸²ï¼Œååºåˆ—åŒ–ä¸º Python å¯¹åº”æ•°æ®ç±»å‹ï¼ˆå­—å…¸/åˆ—è¡¨ç­‰ï¼‰</span><br><span class="line"><span class="number">2.</span> å‡½æ•°è¯­æ³•ï¼šjson.load(fp, cls=<span class="literal">None</span>, object_hook=<span class="literal">None</span>, parse_float=<span class="literal">None</span>, parse_int=<span class="literal">None</span>, parse_constant=<span class="literal">None</span>, object_pairs_hook=<span class="literal">None</span>, ...)</span><br><span class="line"><span class="number">3.</span> å…³é”®å‚æ•°è¯´æ˜ï¼š</span><br><span class="line">   - fpï¼šå¿…ä¼ å‚æ•°ï¼Œæ–‡ä»¶å¯¹è±¡ï¼ˆéœ€ä»¥æ–‡æœ¬æ¨¡å¼ <span class="string">&quot;r&quot;</span> æ‰“å¼€ï¼‰ï¼Œç”¨äºè¯»å– JSON æ•°æ®ï¼›</span><br><span class="line">   - object_hookï¼šå¯é€‰å‚æ•°ï¼Œè‡ªå®šä¹‰ååºåˆ—åŒ–è§„åˆ™ï¼Œæ¥æ”¶ä¸€ä¸ªå­—å…¸å‚æ•°ï¼Œè¿”å›å¤„ç†åçš„å¯¹è±¡ï¼ˆå¦‚å°† JSON å­—å…¸è½¬ä¸ºè‡ªå®šä¹‰ç±»å®ä¾‹ï¼‰ï¼›</span><br><span class="line">   - parse_float/parse_intï¼šå¯é€‰å‚æ•°ï¼Œè‡ªå®šä¹‰æµ®ç‚¹æ•°/æ•´æ•°çš„è§£æè§„åˆ™ï¼ˆå¦‚å°†æµ®ç‚¹æ•°è½¬ä¸º Decimal ç±»å‹ï¼Œé¿å…ç²¾åº¦ä¸¢å¤±ï¼‰ï¼›</span><br><span class="line">   - clsï¼šå¯é€‰å‚æ•°ï¼ŒæŒ‡å®šè‡ªå®šä¹‰çš„ JSON è§£ç å™¨ç±»ï¼Œç”¨äºæ‰©å±•ååºåˆ—åŒ–åŠŸèƒ½ï¼›</span><br><span class="line">   - å…¶ä»–å‚æ•°ï¼ˆå¦‚ object_pairs_hookï¼‰ï¼šç”¨äºæ§åˆ¶ JSON å¯¹è±¡çš„è§£æé¡ºåºï¼ˆå¦‚ä¿ç•™é”®çš„æ’å…¥é¡ºåºï¼‰ã€‚</span><br><span class="line"><span class="number">4.</span> è¿”å›å€¼ç‰¹å¾ï¼š</span><br><span class="line">   - ååºåˆ—åŒ–åçš„è¿”å›å€¼ç±»å‹ä¸ JSON æ•°æ®ç»“æ„å¯¹åº”ï¼š</span><br><span class="line">       - JSON å¯¹è±¡ â†’ Python å­—å…¸</span><br><span class="line">       - JSON æ•°ç»„ â†’ Python åˆ—è¡¨</span><br><span class="line">       - JSON å­—ç¬¦ä¸² â†’ Python å­—ç¬¦ä¸²</span><br><span class="line">       - JSON æ•°å­— â†’ Python æ•´æ•°/æµ®ç‚¹æ•°</span><br><span class="line">       - JSON true/false/null â†’ Python <span class="literal">True</span>/<span class="literal">False</span>/<span class="literal">None</span>ã€‚</span><br></pre></td></tr></table></figure>
<h4 id="2-ä½¿ç”¨ç¤ºä¾‹-3">&lt;2&gt;ä½¿ç”¨ç¤ºä¾‹</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŸºç¡€ç¤ºä¾‹ï¼šè¯»å– JSON æ–‡ä»¶ï¼ˆååºåˆ—åŒ–ï¼‰</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å– JSON æ–‡ä»¶ï¼ˆæ–‡ä»¶å¯¹è±¡éœ€ä»¥ &quot;r&quot; æ¨¡å¼æ‰“å¼€ï¼ŒæŒ‡å®šæ­£ç¡®ç¼–ç ï¼‰</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;user_data.json&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    loaded_data = json.load(f)  <span class="comment"># ååºåˆ—åŒ–ä¸º Python å­—å…¸</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨è¯»å–çš„æ•°æ®ï¼ˆéªŒè¯è¿”å›å€¼ç±»å‹ä¸æ•°æ®å¯ç”¨æ€§ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(loaded_data))  <span class="comment"># è¾“å‡ºï¼š&lt;class &#x27;dict&#x27;&gt;ï¼ŒéªŒè¯è¿”å›å€¼ä¸ºå­—å…¸ç±»å‹</span></span><br><span class="line"><span class="built_in">print</span>(loaded_data[<span class="string">&quot;name&quot;</span>])  <span class="comment"># è¾“å‡ºï¼šå¼ ä¸‰ï¼ˆæ­£å¸¸è®¿é—®å­—å…¸é”®å€¼ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(loaded_data[<span class="string">&quot;hobbies&quot;</span>][<span class="number">0</span>])  <span class="comment"># è¾“å‡ºï¼šç¯®çƒï¼ˆè®¿é—®å­—å…¸ä¸­çš„åˆ—è¡¨å…ƒç´ ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰©å±•ç¤ºä¾‹ï¼šä½¿ç”¨ object_hook è‡ªå®šä¹‰ååºåˆ—åŒ–ï¼ˆå°† JSON å­—å…¸è½¬ä¸ºè‡ªå®šä¹‰ç±»å®ä¾‹ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age, hobbies, is_student</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line">        <span class="variable language_">self</span>.hobbies = hobbies</span><br><span class="line">        <span class="variable language_">self</span>.is_student = is_student</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">introduce</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æˆ‘æ˜¯<span class="subst">&#123;self.name&#125;</span>ï¼Œ<span class="subst">&#123;self.age&#125;</span>å²ï¼Œçˆ±å¥½<span class="subst">&#123;<span class="string">&#x27;,&#x27;</span>.join(self.hobbies)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰è‡ªå®šä¹‰ååºåˆ—åŒ–å‡½æ•°ï¼Œä¼ å…¥ object_hook</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">json_to_user</span>(<span class="params">dict_data</span>):</span><br><span class="line">    <span class="keyword">return</span> User(dict_data[<span class="string">&quot;name&quot;</span>], dict_data[<span class="string">&quot;age&quot;</span>], dict_data[<span class="string">&quot;hobbies&quot;</span>], dict_data[<span class="string">&quot;is_student&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å– JSON å¹¶è½¬ä¸º User å®ä¾‹</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;user_data.json&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    user_instance = json.load(f, object_hook=json_to_user)</span><br><span class="line"></span><br><span class="line">user_instance.introduce()  <span class="comment"># è¾“å‡ºï¼šæˆ‘æ˜¯å¼ ä¸‰ï¼Œ25å²ï¼Œçˆ±å¥½ç¯®çƒ,ç¼–ç¨‹</span></span><br></pre></td></tr></table></figure>
<h4 id="3-è¡¥å……ç¤ºä¾‹">&lt;3&gt;è¡¥å……ç¤ºä¾‹</h4>
<p>JSON ä¸­æ•°ç»„ä¼šè¢«è½¬ä¸º Python åˆ—è¡¨ï¼ŒPython å…ƒç»„åºåˆ—åŒ–åä¼šå˜æˆåˆ—è¡¨,è¯»å–æ—¶æ— æ³•è¿˜åŸä¸ºå…ƒç»„</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">&quot;coords&quot;</span>: (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)&#125;  <span class="comment"># å…ƒç»„</span></span><br><span class="line">json_str = json.dumps(data)</span><br><span class="line"><span class="built_in">print</span>(json_str)  <span class="comment"># &#123;&quot;coords&quot;: [1, 2, 3]&#125;  â† å˜æˆäº†æ•°ç»„</span></span><br><span class="line"></span><br><span class="line">loaded = json.loads(json_str)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(loaded[<span class="string">&quot;coords&quot;</span>]))  <span class="comment"># &lt;class &#x27;list&#x27;&gt;  â† æ— æ³•è¿˜åŸä¸ºå…ƒç»„</span></span><br></pre></td></tr></table></figure>
<h2 id="7-ç»“æ„åŒ–æ•°æ®å­˜å‚¨ï¼šPickleï¼ˆPython-ä¸“å±åœºæ™¯ï¼‰">7.ç»“æ„åŒ–æ•°æ®å­˜å‚¨ï¼šPickleï¼ˆPython ä¸“å±åœºæ™¯ï¼‰</h2>
<p>Pickle æ˜¯ Python ä¸“å±åºåˆ—åŒ–å·¥å…·ï¼Œæ”¯æŒå‡ ä¹æ‰€æœ‰ Python æ•°æ®ç±»å‹ï¼ˆåŒ…æ‹¬ç±»å®ä¾‹ã€å…ƒç»„ã€é›†åˆã€å‡½æ•°ç­‰ï¼‰ï¼Œä½†ç”Ÿæˆçš„æ–‡ä»¶åªèƒ½è¢« Python è§£æï¼Œä¸æ”¯æŒè·¨è¯­è¨€ã€‚æ ¸å¿ƒé€šè¿‡ pickle.dump()ï¼ˆå†™å…¥ï¼‰å’Œ pickle.load()ï¼ˆè¯»å–ï¼‰å®ç°ã€‚</p>
<h3 id="ï¼ˆ1ï¼‰å†™å…¥-Pickle-æ•°æ®ï¼ˆåºåˆ—åŒ–ï¼‰">ï¼ˆ1ï¼‰å†™å…¥ Pickle æ•°æ®ï¼ˆåºåˆ—åŒ–ï¼‰</h3>
<h4 id="1-pickle-dump-å‡½æ•°">&lt;1&gt;pickle.dump() å‡½æ•°</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> æ ¸å¿ƒä½œç”¨ï¼šå°† Python ä»»æ„æ•°æ®ç±»å‹ï¼ˆå¦‚ç±»å®ä¾‹ã€å­—å…¸ã€åˆ—è¡¨ã€å…ƒç»„ç­‰ï¼‰åºåˆ—åŒ–ï¼ˆè½¬æ¢ï¼‰ä¸ºäºŒè¿›åˆ¶å­—èŠ‚æµï¼Œç›´æ¥å†™å…¥æ–‡ä»¶</span><br><span class="line"><span class="number">2.</span> å‡½æ•°è¯­æ³•ï¼špickle.dump(obj, file, protocol=<span class="literal">None</span>, fix_imports=<span class="literal">True</span>, buffer_callback=<span class="literal">None</span>)</span><br><span class="line"><span class="number">3.</span> å…³é”®å‚æ•°è¯´æ˜ï¼š</span><br><span class="line">   - objï¼šå¿…ä¼ å‚æ•°ï¼Œè¦åºåˆ—åŒ–çš„ Python æ•°æ®ï¼ˆæ”¯æŒå‡ ä¹æ‰€æœ‰ Python ç±»å‹ï¼ŒåŒ…æ‹¬ç±»å®ä¾‹ã€å‡½æ•°ã€é›†åˆã€å…ƒç»„ç­‰ï¼‰ï¼›</span><br><span class="line">   - fileï¼šå¿…ä¼ å‚æ•°ï¼Œæ–‡ä»¶å¯¹è±¡ï¼ˆéœ€ä»¥äºŒè¿›åˆ¶æ¨¡å¼ <span class="string">&quot;wb&quot;</span> æˆ– <span class="string">&quot;ab&quot;</span> æ‰“å¼€ï¼‰ï¼Œç”¨äºæ¥æ”¶åºåˆ—åŒ–åçš„äºŒè¿›åˆ¶å­—èŠ‚æµï¼›</span><br><span class="line">   - protocolï¼šå¯é€‰å‚æ•°ï¼ŒæŒ‡å®šåºåˆ—åŒ–åè®®ç‰ˆæœ¬ï¼ˆé»˜è®¤ä½¿ç”¨æœ€é«˜å…¼å®¹ç‰ˆæœ¬ï¼‰ï¼Œå–å€¼èŒƒå›´ <span class="number">0</span>-<span class="number">5</span>ï¼š</span><br><span class="line">     - protocol=<span class="number">0</span>ï¼šæ–‡æœ¬æ ¼å¼åºåˆ—åŒ–ï¼ˆå…¼å®¹æ€§æœ€å¼ºï¼Œé€Ÿåº¦æ…¢ï¼Œä¸æ¨èï¼‰ï¼›</span><br><span class="line">     - protocol&gt;=<span class="number">1</span>ï¼šäºŒè¿›åˆ¶æ ¼å¼åºåˆ—åŒ–ï¼ˆæ¨èï¼Œé€Ÿåº¦å¿«ã€ä½“ç§¯å°ï¼‰ï¼Œç‰ˆæœ¬è¶Šé«˜åŠŸèƒ½è¶Šå…¨ï¼Œéœ€æ³¨æ„ Python ç‰ˆæœ¬å…¼å®¹æ€§ï¼›</span><br><span class="line">   - fix_importsï¼šå¯é€‰å‚æ•°ï¼Œé»˜è®¤ <span class="literal">True</span>ï¼Œç”¨äºåœ¨ Python <span class="number">2</span> å’Œ Python <span class="number">3</span> ä¹‹é—´å…¼å®¹ï¼Œå¤„ç†å¯¼å…¥è·¯å¾„å·®å¼‚ï¼›</span><br><span class="line">   - buffer_callbackï¼šå¯é€‰å‚æ•°ï¼Œç”¨äºå¤„ç†å¤§æ•°æ®å¯¹è±¡çš„ç¼“å†²ï¼Œè‡ªå®šä¹‰å­—èŠ‚æµå†™å…¥æ–¹å¼ï¼ˆè¿›é˜¶ç”¨æ³•ï¼‰ã€‚</span><br><span class="line"><span class="number">4.</span> æ ¸å¿ƒç‰¹å¾ï¼š</span><br><span class="line">   - æ”¯æŒ Python ä¸“å±ç±»å‹ï¼šè¿™æ˜¯ä¸ json.dump() çš„æ ¸å¿ƒåŒºåˆ«ï¼Œå¯ç›´æ¥åºåˆ—åŒ–ç±»å®ä¾‹ã€å‡½æ•°ç­‰ JSON ä¸æ”¯æŒçš„ç±»å‹ï¼›</span><br><span class="line">   - äºŒè¿›åˆ¶è¾“å‡ºï¼šåºåˆ—åŒ–åçš„æ•°æ®æ˜¯äºŒè¿›åˆ¶å­—èŠ‚æµï¼Œéœ€ç”¨äºŒè¿›åˆ¶æ¨¡å¼å†™å…¥æ–‡ä»¶ï¼Œç”Ÿæˆçš„æ–‡ä»¶ä¸å¯ç›´æ¥é˜…è¯»ï¼›</span><br><span class="line">   - Python ä¸“å±ï¼šç”Ÿæˆçš„æ–‡ä»¶åªèƒ½è¢« Python è§£æï¼Œæ— æ³•è·¨è¯­è¨€ä½¿ç”¨ï¼ˆå¦‚ Javaã€JavaScript æ— æ³•è¯»å–ï¼‰ã€‚</span><br></pre></td></tr></table></figure>
<h4 id="2-ä½¿ç”¨ç¤ºä¾‹-4">&lt;2&gt;ä½¿ç”¨ç¤ºä¾‹</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®é™…ç¤ºä¾‹ï¼šå†™å…¥ Pickle æ•°æ®ï¼ˆåºåˆ—åŒ–ç±»å®ä¾‹ï¼‰</span></span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ªç±»ï¼ˆPickle æ”¯æŒç±»å®ä¾‹åºåˆ—åŒ–ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">introduce</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æˆ‘æ˜¯<span class="subst">&#123;self.name&#125;</span>ï¼Œ<span class="subst">&#123;self.age&#125;</span>å²&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºç±»å®ä¾‹</span></span><br><span class="line">person = Person(<span class="string">&quot;æå››&quot;</span>, <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†™å…¥ Pickle æ–‡ä»¶ï¼ˆå¿…é¡»ç”¨äºŒè¿›åˆ¶æ¨¡å¼ &quot;wb&quot;ï¼Œæ— éœ€æŒ‡å®š encodingï¼‰</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;person.pkl&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="comment"># ä½¿ç”¨é»˜è®¤æœ€é«˜åè®®ç‰ˆæœ¬åºåˆ—åŒ–ï¼Œä¹Ÿå¯æŒ‡å®š protocol=4ï¼ˆPython 3.4+ æ”¯æŒï¼‰</span></span><br><span class="line">    pickle.dump(person, f)</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰è¯»å–-Pickle-æ•°æ®ï¼ˆååºåˆ—åŒ–ï¼‰">ï¼ˆ2ï¼‰è¯»å– Pickle æ•°æ®ï¼ˆååºåˆ—åŒ–ï¼‰</h3>
<h4 id="1-pickle-load-å‡½æ•°">&lt;1&gt;pickle.load() å‡½æ•°</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> æ ¸å¿ƒä½œç”¨ï¼šä»å·²æ‰“å¼€çš„ Pickle äºŒè¿›åˆ¶æ–‡ä»¶ä¸­è¯»å–åºåˆ—åŒ–çš„å­—èŠ‚æµï¼Œååºåˆ—åŒ–ä¸ºåŸæœ¬çš„ Python æ•°æ®ç±»å‹ï¼ˆå¦‚ç±»å®ä¾‹ã€å­—å…¸ã€åˆ—è¡¨ç­‰ï¼‰</span><br><span class="line"><span class="number">2.</span> å‡½æ•°è¯­æ³•ï¼špickle.load(file, fix_imports=<span class="literal">True</span>, encoding=<span class="string">&quot;ASCII&quot;</span>, errors=<span class="string">&quot;strict&quot;</span>, buffers=<span class="literal">None</span>)</span><br><span class="line"><span class="number">3.</span> å…³é”®å‚æ•°è¯´æ˜ï¼š</span><br><span class="line">   - fileï¼šå¿…ä¼ å‚æ•°ï¼Œæ–‡ä»¶å¯¹è±¡ï¼ˆéœ€ä»¥äºŒè¿›åˆ¶æ¨¡å¼ <span class="string">&quot;rb&quot;</span> æ‰“å¼€ï¼‰ï¼Œç”¨äºè¯»å–åºåˆ—åŒ–çš„äºŒè¿›åˆ¶å­—èŠ‚æµï¼›</span><br><span class="line">   - fix_importsï¼šå¯é€‰å‚æ•°ï¼Œé»˜è®¤ <span class="literal">True</span>ï¼Œç”¨äºè§£å†³ Python <span class="number">2</span> å’Œ Python <span class="number">3</span> ä¹‹é—´çš„å¯¼å…¥å…¼å®¹æ€§é—®é¢˜ï¼Œè‡ªåŠ¨è°ƒæ•´å¯¼å…¥è·¯å¾„ï¼›</span><br><span class="line">   - encodingï¼šå¯é€‰å‚æ•°ï¼Œé»˜è®¤ <span class="string">&quot;ASCII&quot;</span>ï¼ŒæŒ‡å®šååºåˆ—åŒ–æ—¶å­—ç¬¦ä¸²çš„ç¼–ç æ–¹å¼ï¼ˆé’ˆå¯¹ Python <span class="number">2</span> åºåˆ—åŒ–çš„æ–‡ä»¶ï¼‰ï¼›</span><br><span class="line">     è‹¥è¯»å– Python <span class="number">3</span> åºåˆ—åŒ–çš„æ–‡ä»¶ï¼Œæ— éœ€ä¿®æ”¹æ­¤å‚æ•°ï¼Œä½¿ç”¨é»˜è®¤å€¼å³å¯ï¼›</span><br><span class="line">   - errorsï¼šå¯é€‰å‚æ•°ï¼Œé»˜è®¤ <span class="string">&quot;strict&quot;</span>ï¼ŒæŒ‡å®šç¼–ç é”™è¯¯çš„å¤„ç†æ–¹å¼ï¼ˆå¦‚ <span class="string">&quot;ignore&quot;</span> å¿½ç•¥é”™è¯¯ã€<span class="string">&quot;replace&quot;</span> æ›¿æ¢é”™è¯¯å­—ç¬¦ï¼‰ï¼›</span><br><span class="line">   - buffersï¼šå¯é€‰å‚æ•°ï¼Œè¿›é˜¶ç”¨æ³•ï¼Œç”¨äºå¤„ç†å¤§æ•°æ®å¯¹è±¡çš„ç¼“å†²ï¼Œæ¥æ”¶ä¸€ä¸ªå¯è¿­ä»£çš„ç¼“å†²å¯¹è±¡ã€‚</span><br><span class="line"><span class="number">4.</span> è¿”å›å€¼ç‰¹å¾ï¼š</span><br><span class="line">   - ååºåˆ—åŒ–åçš„è¿”å›å€¼ç±»å‹ä¸åºåˆ—åŒ–å‰çš„åŸå§‹æ•°æ®ç±»å‹å®Œå…¨ä¸€è‡´ï¼ˆæ ¸å¿ƒä¼˜åŠ¿ï¼‰ï¼š</span><br><span class="line">     å¦‚åºåˆ—åŒ–å‰æ˜¯ç±»å®ä¾‹ â†’ ååºåˆ—åŒ–åä»æ˜¯è¯¥ç±»å®ä¾‹ï¼›åºåˆ—åŒ–å‰æ˜¯å­—å…¸ â†’ ååºåˆ—åŒ–åä»æ˜¯å­—å…¸ï¼›</span><br><span class="line">   - æ— éœ€æ‰‹åŠ¨è½¬æ¢ç±»å‹ï¼Œå¯ç›´æ¥ä½¿ç”¨åŸå§‹æ•°æ®çš„å±æ€§å’Œæ–¹æ³•ï¼ˆå¦‚ç±»å®ä¾‹çš„æˆå‘˜æ–¹æ³•ï¼‰ã€‚</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŸºç¡€ç¤ºä¾‹ï¼šè¯»å– Pickle æ–‡ä»¶ï¼ˆååºåˆ—åŒ–ä¸ºåŸå§‹ Python ç±»å‹ï¼‰</span></span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å– Pickle æ–‡ä»¶ï¼ˆå¿…é¡»ç”¨äºŒè¿›åˆ¶æ¨¡å¼ &quot;rb&quot; æ‰“å¼€ï¼Œæ— éœ€æŒ‡å®š encodingï¼‰</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;person.pkl&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    loaded_person = pickle.load(f)  <span class="comment"># ååºåˆ—åŒ–ä¸ºåŸæœ¬çš„ Person ç±»å®ä¾‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># éªŒè¯è¿”å›å€¼ç±»å‹ä¸åŠŸèƒ½å¯ç”¨æ€§</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(loaded_person))  <span class="comment"># è¾“å‡ºï¼š&lt;class &#x27;__main__.Person&#x27;&gt;ï¼Œç¡®è®¤ä¸º Person ç±»å®ä¾‹</span></span><br><span class="line">loaded_person.introduce()  <span class="comment"># è¾“å‡ºï¼šæˆ‘æ˜¯æå››ï¼Œ30å²ï¼ˆå¯ç›´æ¥è°ƒç”¨ç±»å®ä¾‹æ–¹æ³•ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰©å±•ç¤ºä¾‹1ï¼šè¯»å–å¤æ‚ Pickle æ•°æ®ï¼ˆå­—å…¸åµŒå¥—åˆ—è¡¨ã€å…ƒç»„ï¼‰</span></span><br><span class="line"><span class="comment"># å…ˆå‡†å¤‡ä¸€ä¸ªå¤æ‚æ•°æ®å¹¶åºåˆ—åŒ–</span></span><br><span class="line">complex_data = &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;å¼ ä¸‰&quot;</span>,</span><br><span class="line">    <span class="string">&quot;scores&quot;</span>: [<span class="number">90</span>, <span class="number">85</span>, <span class="number">95</span>],</span><br><span class="line">    <span class="string">&quot;info&quot;</span>: (<span class="string">&quot;Pythonå¼€å‘è€…&quot;</span>, <span class="number">25</span>),</span><br><span class="line">    <span class="string">&quot;is_valid&quot;</span>: <span class="literal">True</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;complex_data.pkl&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    pickle.dump(complex_data, f)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ååºåˆ—åŒ–è¯»å–</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;complex_data.pkl&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    loaded_complex = pickle.load(f)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(loaded_complex))  <span class="comment"># è¾“å‡ºï¼š&lt;class &#x27;dict&#x27;&gt;</span></span><br><span class="line"><span class="built_in">print</span>(loaded_complex[<span class="string">&quot;scores&quot;</span>][<span class="number">1</span>])  <span class="comment"># è¾“å‡ºï¼š85ï¼ˆæ­£å¸¸è®¿é—®åˆ—è¡¨å…ƒç´ ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(loaded_complex[<span class="string">&quot;info&quot;</span>][<span class="number">0</span>])  <span class="comment"># è¾“å‡ºï¼šPythonå¼€å‘è€…ï¼ˆæ­£å¸¸è®¿é—®å…ƒç»„å…ƒç´ ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰©å±•ç¤ºä¾‹2ï¼šå¤„ç† Python 2 åºåˆ—åŒ–çš„ Pickle æ–‡ä»¶ï¼ˆå…¼å®¹æ€§åœºæ™¯ï¼‰</span></span><br><span class="line"><span class="comment"># è‹¥è¯»å–çš„æ˜¯ Python 2 ç”Ÿæˆçš„ .pkl æ–‡ä»¶ï¼Œå¯èƒ½éœ€è¦æŒ‡å®š encoding å‚æ•°</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;python2_data.pkl&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="comment"># ç”¨ &quot;latin-1&quot; ç¼–ç å…¼å®¹ Python 2 åºåˆ—åŒ–çš„å­—ç¬¦ä¸²</span></span><br><span class="line">        loaded_py2_data = pickle.load(f, encoding=<span class="string">&quot;latin-1&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Python 2 åºåˆ—åŒ–æ–‡ä»¶è¯»å–æˆåŠŸ&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;è¯»å–å¤±è´¥ï¼š<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="8-Python-æ–‡ä»¶æ“ä½œå‡½æ•°é€ŸæŸ¥è¡¨">8.Python æ–‡ä»¶æ“ä½œå‡½æ•°é€ŸæŸ¥è¡¨</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260111221730929.png" alt=""></p>
<h1>åä¸€ã€å¼‚å¸¸å¤„ç†</h1>
<ul>
<li>åœ¨ Python ç¼–ç¨‹ä¸­ï¼Œå¼‚å¸¸æ˜¯ç¨‹åºè¿è¡Œæ—¶å‘ç”Ÿçš„éé¢„æœŸé”™è¯¯ï¼ˆå¦‚è¯­æ³•é”™è¯¯ã€é€»è¾‘é”™è¯¯ã€èµ„æºè®¿é—®å¤±è´¥ç­‰ï¼‰ï¼Œä¼šå¯¼è‡´ç¨‹åºä¸­æ–­ã€‚</li>
<li>å¼‚å¸¸å¤„ç†çš„æ ¸å¿ƒç›®æ ‡æ˜¯<strong>æ•è·å¹¶å¤„ç†è¿™äº›é”™è¯¯</strong>ï¼Œä¿è¯ç¨‹åºä¼˜é›…è¿è¡Œè€Œéç›´æ¥å´©æºƒï¼ŒåŒæ—¶ä¾¿äºå®šä½é—®é¢˜ã€‚</li>
</ul>
<h2 id="1-å¼‚å¸¸çš„æœ¬è´¨">1.å¼‚å¸¸çš„æœ¬è´¨</h2>
<ul>
<li>Python ä¸­æ‰€æœ‰å¼‚å¸¸éƒ½æ˜¯ <strong>BaseException</strong> ç±»çš„å­ç±»ï¼Œå½¢æˆäº†å±‚çº§åˆ†æ˜çš„å¼‚å¸¸ä½“ç³»</li>
<li>å¸¸è§çš„å¼‚å¸¸ç±»ï¼ˆå¦‚ TypeErrorã€FileNotFoundErrorï¼‰å‡ç»§æ‰¿è‡ª <strong>Exception ç±»</strong>ï¼ˆBaseException çš„å­ç±»ï¼‰</li>
<li>BaseException è¿˜åŒ…å« SystemExitï¼ˆç¨‹åºé€€å‡ºï¼‰ã€KeyboardInterruptï¼ˆç”¨æˆ·ä¸­æ–­ï¼Œå¦‚ Ctrl+Cï¼‰ç­‰ç‰¹æ®Šå¼‚å¸¸ã€‚</li>
</ul>
<h2 id="2-å¸¸è§å¼‚å¸¸ç±»å‹åŠè§¦å‘åœºæ™¯">2.å¸¸è§å¼‚å¸¸ç±»å‹åŠè§¦å‘åœºæ™¯</h2>
<p>Python å†…ç½®äº†å¤§é‡å¼‚å¸¸ç±»ï¼Œè¦†ç›–å¼€å‘ä¸­å¸¸è§çš„é”™è¯¯åœºæ™¯ï¼Œä»¥ä¸‹æ˜¯é«˜é¢‘å¼‚å¸¸ç±»å‹æ±‡æ€»ï¼š<br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260111225712830.png" alt=""><br>
<strong>æ³¨</strong>ï¼šè¿™äº›å¼‚å¸¸ç±»æˆ‘ä»¬å¯ä»¥ç›´æ¥åˆ›å»ºï¼Œå¹¶<a href="#raise">é€šè¿‡raise è¯­å¥ä¸»åŠ¨æŠ›å‡º</a></p>
<h2 id="3-å¼‚å¸¸å¤„ç†æ ¸å¿ƒè¯­æ³•">3.å¼‚å¸¸å¤„ç†æ ¸å¿ƒè¯­æ³•</h2>
<p>Python æä¾› <strong>try-except-else-finally</strong> è¯­å¥å—å®ç°å¼‚å¸¸å¤„ç†ï¼Œå„éƒ¨åˆ†åˆ†å·¥æ˜ç¡®ï¼Œå¯çµæ´»ç»„åˆä½¿ç”¨ã€‚</p>
<h3 id="ï¼ˆ1ï¼‰åŸºç¡€ç»“æ„ï¼štry-except">ï¼ˆ1ï¼‰åŸºç¡€ç»“æ„ï¼štry-except</h3>
<p>æœ€æ ¸å¿ƒçš„å¼‚å¸¸æ•è·ç»“æ„ï¼š</p>
<ul>
<li><strong>try å—</strong>ï¼šåŒ…è£¹å¯èƒ½è§¦å‘å¼‚å¸¸çš„ä»£ç </li>
<li><strong>except å—</strong>ï¼šæ•è·å¹¶å¤„ç†æŒ‡å®šå¼‚å¸¸ã€‚</li>
</ul>
<h4 id="1-è¯­æ³•æ ¼å¼-5">&lt;1&gt;è¯­æ³•æ ¼å¼</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># å¯èƒ½è§¦å‘å¼‚å¸¸çš„ä»£ç å—ï¼ˆè¢«ç›‘æ§çš„ä»£ç ï¼‰</span></span><br><span class="line">    å±é™©æ“ä½œ</span><br><span class="line"><span class="keyword">except</span> å¼‚å¸¸ç±»å‹<span class="number">1</span> [<span class="keyword">as</span> å¼‚å¸¸å¯¹è±¡]:</span><br><span class="line">    <span class="comment"># æ•è·åˆ°â€œå¼‚å¸¸ç±»å‹1â€æ—¶æ‰§è¡Œçš„å¤„ç†é€»è¾‘</span></span><br><span class="line">    å¤„ç†æ–¹æ¡ˆ<span class="number">1</span></span><br><span class="line"><span class="keyword">except</span> å¼‚å¸¸ç±»å‹<span class="number">2</span> [<span class="keyword">as</span> å¼‚å¸¸å¯¹è±¡]:</span><br><span class="line">    <span class="comment"># æ•è·åˆ°â€œå¼‚å¸¸ç±»å‹2â€æ—¶æ‰§è¡Œçš„å¤„ç†é€»è¾‘</span></span><br><span class="line">    å¤„ç†æ–¹æ¡ˆ<span class="number">2</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>as å¼‚å¸¸å¯¹è±¡</strong>(å¯é€‰):
<ul>
<li>ç”¨äºè·å–å¼‚å¸¸çš„è¯¦ç»†ä¿¡æ¯ï¼ˆå¦‚é”™è¯¯åŸå› ï¼‰ï¼Œé€šè¿‡å¼‚å¸¸å¯¹è±¡.args æˆ–ç›´æ¥æ‰“å°å¼‚å¸¸å¯¹è±¡æŸ¥çœ‹ã€‚</li>
</ul>
</li>
<li><strong>å¤š except é¡ºåº</strong>:
<ul>
<li>å¼‚å¸¸ç±»æœ‰å±‚çº§å…³ç³»æ—¶ï¼Œ<strong>éœ€å…ˆæ•è·å­ç±»å¼‚å¸¸ï¼Œå†æ•è·çˆ¶ç±»å¼‚å¸¸</strong>ï¼ˆå¦åˆ™å­ç±»å¼‚å¸¸ä¼šè¢«çˆ¶ç±»å¼‚å¸¸æ•è·ï¼Œæ— æ³•ç²¾å‡†å¤„ç†ï¼‰</li>
</ul>
</li>
<li><strong>æœªæ•è·å¼‚å¸¸</strong>:
<ul>
<li>è‹¥ try å—<strong>è§¦å‘çš„å¼‚å¸¸</strong>æœªè¢«ä»»ä½• except æ•è·ï¼Œç¨‹åºä¼šä¸­æ–­å¹¶æŠ›å‡ºé»˜è®¤é”™è¯¯ä¿¡æ¯ã€‚</li>
</ul>
</li>
</ul>
<h4 id="2-ä½¿ç”¨ç¤ºä¾‹-5">&lt;2&gt;ä½¿ç”¨ç¤ºä¾‹</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¤ºä¾‹1ï¼šæ•è·æŒ‡å®šå¼‚å¸¸ï¼ˆé™¤é›¶é”™è¯¯ï¼‰</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    result = <span class="number">10</span> / <span class="number">0</span>  <span class="comment"># è§¦å‘ ZeroDivisionError</span></span><br><span class="line"><span class="keyword">except</span> ZeroDivisionError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;é™¤é›¶é”™è¯¯ï¼š<span class="subst">&#123;e&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šé™¤é›¶é”™è¯¯ï¼šdivision by zero</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;é”™è¯¯è¯¦æƒ…ï¼š<span class="subst">&#123;e.args&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šé”™è¯¯è¯¦æƒ…ï¼š(&#x27;division by zero&#x27;,)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹2ï¼šå¤šå¼‚å¸¸æ•è·ï¼ˆç±»å‹ä¸åŒ¹é… + é™¤é›¶é”™è¯¯ï¼‰</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    num = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;è¯·è¾“å…¥æ•°å­—ï¼š&quot;</span>))</span><br><span class="line">    result = <span class="number">10</span> / num</span><br><span class="line"><span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;è¾“å…¥é”™è¯¯ï¼š<span class="subst">&#123;e&#125;</span>&quot;</span>)  <span class="comment"># è¾“å…¥éæ•°å­—æ—¶è§¦å‘</span></span><br><span class="line"><span class="keyword">except</span> ZeroDivisionError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;é™¤é›¶é”™è¯¯ï¼š<span class="subst">&#123;e&#125;</span>&quot;</span>)  <span class="comment"># è¾“å…¥0æ—¶è§¦å‘</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹3ï¼šæ•è·å¼‚å¸¸å¹¶ä¿®å¤ï¼ˆç”¨æˆ·è¾“å…¥åœºæ™¯ï¼Œå¼•å¯¼ä¿®æ­£é”™è¯¯ï¼‰</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_valid_number</span>(<span class="params">prompt</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:  <span class="comment"># å¾ªç¯ç›´åˆ°è·å–æœ‰æ•ˆè¾“å…¥</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            num = <span class="built_in">int</span>(<span class="built_in">input</span>(prompt))  <span class="comment"># å°è¯•è½¬æ¢è¾“å…¥ä¸ºæ•´æ•°</span></span><br><span class="line">            <span class="keyword">if</span> num == <span class="number">0</span>:</span><br><span class="line">                <span class="comment"># ä¸»åŠ¨æ£€æµ‹é™¤é›¶é£é™©ï¼ŒæŠ›å‡ºè‡ªå®šä¹‰æç¤ºçš„å¼‚å¸¸</span></span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">&quot;è¾“å…¥ä¸èƒ½ä¸º0ï¼Œå¦åˆ™ä¼šè§¦å‘é™¤é›¶é”™è¯¯&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> num  <span class="comment"># è¾“å…¥æœ‰æ•ˆï¼Œè¿”å›ç»“æœ</span></span><br><span class="line">        <span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="comment"># æ•è·è¾“å…¥é”™è¯¯ï¼Œæç¤ºç”¨æˆ·å¹¶å¼•å¯¼é‡æ–°è¾“å…¥ï¼ˆä¿®å¤å¼‚å¸¸ï¼‰</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;è¾“å…¥æ— æ•ˆï¼š<span class="subst">&#123;e&#125;</span>ï¼Œè¯·é‡æ–°è¾“å…¥ï¼&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨å‡½æ•°è·å–æœ‰æ•ˆæ•°å­—ï¼Œç¡®ä¿åç»­è®¡ç®—æ­£å¸¸æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    num = get_valid_number(<span class="string">&quot;è¯·è¾“å…¥ä¸€ä¸ªéé›¶æ•´æ•°ï¼š&quot;</span>)</span><br><span class="line">    result = <span class="number">10</span> / num</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;è®¡ç®—æˆåŠŸï¼10 Ã· <span class="subst">&#123;num&#125;</span> = <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ç¨‹åºå¼‚å¸¸ï¼š<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰æ‰©å±•ç»“æ„ï¼štry-except-else">ï¼ˆ2ï¼‰æ‰©å±•ç»“æ„ï¼štry-except-else</h3>
<p>å½“ try å—æœªè§¦å‘ä»»ä½•å¼‚å¸¸æ—¶ï¼Œæ‰§è¡Œ else å—ä»£ç ï¼ˆelse å—éœ€ç´§è·Ÿæ‰€æœ‰ except å—ä¹‹åï¼‰ã€‚</p>
<h4 id="1-è¯­æ³•æ ¼å¼-6">&lt;1&gt;è¯­æ³•æ ¼å¼</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    å¯èƒ½è§¦å‘å¼‚å¸¸çš„ä»£ç </span><br><span class="line"><span class="keyword">except</span> å¼‚å¸¸ç±»å‹ <span class="keyword">as</span> e:</span><br><span class="line">    å¼‚å¸¸å¤„ç†é€»è¾‘</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># try å—æ— å¼‚å¸¸æ—¶æ‰§è¡Œ</span></span><br><span class="line">    æ­£å¸¸æ‰§è¡Œçš„åç»­é€»è¾‘</span><br></pre></td></tr></table></figure>
<h4 id="2-ä½¿ç”¨ç¤ºä¾‹-6">&lt;2&gt;ä½¿ç”¨ç¤ºä¾‹</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    num = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;è¯·è¾“å…¥æ•°å­—ï¼š&quot;</span>))</span><br><span class="line">    result = <span class="number">10</span> / num</span><br><span class="line"><span class="keyword">except</span> (ValueError, ZeroDivisionError) <span class="keyword">as</span> e:  <span class="comment"># ç”¨å…ƒç»„æ•è·å¤šä¸ªå¼‚å¸¸</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;é”™è¯¯ï¼š<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;è®¡ç®—æˆåŠŸï¼Œç»“æœï¼š<span class="subst">&#123;result&#125;</span>&quot;</span>)  <span class="comment"># æ— å¼‚å¸¸æ—¶æ‰§è¡Œ</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰å®Œæ•´ç»“æ„ï¼štry-except-else-finally">ï¼ˆ3ï¼‰å®Œæ•´ç»“æ„ï¼štry-except-else-finally</h3>
<p>finally å—ç”¨äºå®šä¹‰â€œæ— è®ºæ˜¯å¦è§¦å‘å¼‚å¸¸ï¼Œéƒ½å¿…é¡»æ‰§è¡Œâ€çš„ä»£ç ï¼ˆå¦‚èµ„æºé‡Šæ”¾ã€æ–‡ä»¶å…³é—­ã€è¿æ¥æ–­å¼€ç­‰ï¼‰ï¼Œæ˜¯èµ„æºç®¡ç†çš„æ ¸å¿ƒã€‚</p>
<h4 id="1-è¯­æ³•æ ¼å¼-7">&lt;1&gt;è¯­æ³•æ ¼å¼</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    å¯èƒ½è§¦å‘å¼‚å¸¸çš„ä»£ç </span><br><span class="line"><span class="keyword">except</span> å¼‚å¸¸ç±»å‹ <span class="keyword">as</span> e:</span><br><span class="line">    å¼‚å¸¸å¤„ç†é€»è¾‘</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    æ— å¼‚å¸¸æ—¶æ‰§è¡Œçš„é€»è¾‘</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="comment"># æ— è®ºæ˜¯å¦å¼‚å¸¸ï¼Œå¿…æ‰§è¡Œ</span></span><br><span class="line">    èµ„æºé‡Šæ”¾/æ¸…ç†é€»è¾‘</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>å…³é”®ç‰¹æ€§</strong>
<ul>
<li><strong>ä¼˜å…ˆçº§æœ€é«˜ï¼ï¼</strong>ï¼šå³ä½¿ tryã€exceptã€else å—ä¸­æœ‰ returnã€break ç­‰è¯­å¥ï¼Œfinally å—ä»ä¼šå…ˆæ‰§è¡Œã€‚</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæ–‡ä»¶å…³é—­ã€æ•°æ®åº“è¿æ¥æ–­å¼€ã€é”é‡Šæ”¾ç­‰å¿…é¡»æ‰§è¡Œçš„æ¸…ç†æ“ä½œï¼ˆæ›¿ä»£æ‰‹åŠ¨å…³é—­ï¼Œé¿å…å¼‚å¸¸å¯¼è‡´èµ„æºæ³„æ¼ï¼‰</li>
</ul>
</li>
</ul>
<h4 id="2-ä½¿ç”¨ç¤ºä¾‹-7">&lt;2&gt;ä½¿ç”¨ç¤ºä¾‹</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¤ºä¾‹ï¼šæ¼”ç¤º finally çš„æ‰§è¡Œç‰¹æ€§ï¼ˆæ³¨æ„ï¼šå®é™…æ–‡ä»¶æ“ä½œæ¨èç”¨ with è¯­å¥ï¼‰</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_config</span>(<span class="params">filename</span>):</span><br><span class="line">    file = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        file = <span class="built_in">open</span>(filename, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">        content = file.read()</span><br><span class="line">        <span class="keyword">return</span> content  <span class="comment"># å³ä½¿è¿™é‡Œ returnï¼Œfinally ä»ä¼šæ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">except</span> FileNotFoundError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æ–‡ä»¶ä¸å­˜åœ¨ï¼š<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">except</span> UnicodeDecodeError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;ç¼–ç é”™è¯¯ï¼š<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="comment"># æ•è·å…¶ä»–æœªé¢„æ–™çš„å¼‚å¸¸ï¼Œé¿å…ç¨‹åºå´©æºƒ</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;è¯»å–æ–‡ä»¶æ—¶å‘ç”ŸæœªçŸ¥é”™è¯¯ï¼š<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="comment"># å…³é”®ï¼šæ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸ï¼Œfinally éƒ½ä¼šæ‰§è¡Œ</span></span><br><span class="line">        <span class="keyword">if</span> file:</span><br><span class="line">            file.close()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;finallyï¼šæ–‡ä»¶å·²å…³é—­&quot;</span>)</span><br><span class="line"></span><br><span class="line">result = read_config(<span class="string">&quot;test.txt&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;è¿”å›å€¼ï¼š<span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºé¡ºåºï¼ˆä»¥æ–‡ä»¶å­˜åœ¨ä¸ºä¾‹ï¼‰ï¼š</span></span><br><span class="line"><span class="comment"># finallyï¼šæ–‡ä»¶å·²å…³é—­</span></span><br><span class="line"><span class="comment"># è¿”å›å€¼ï¼šï¼ˆæ–‡ä»¶å†…å®¹æˆ– Noneï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># âš ï¸ æ³¨æ„ï¼š</span></span><br><span class="line"><span class="comment"># ä¸Šè¿°ä»£ç ä»…ç”¨äºæ¼”ç¤º finally çš„&quot;å¿…æ‰§è¡Œ&quot;ç‰¹æ€§</span></span><br><span class="line"><span class="comment"># å®é™…æ–‡ä»¶æ“ä½œå¼ºçƒˆæ¨èä½¿ç”¨ with è¯­å¥ï¼ˆè‡ªåŠ¨ç®¡ç†èµ„æºï¼Œä»£ç æ›´ç®€æ´å®‰å…¨ï¼‰ï¼š</span></span><br><span class="line"><span class="comment"># with open(&quot;test.txt&quot;, &quot;r&quot;, encoding=&quot;utf-8&quot;) as f:</span></span><br><span class="line"><span class="comment">#     content = f.read()</span></span><br></pre></td></tr></table></figure>
<p><strong>å†æ¬¡å¼ºè°ƒ</strong>ï¼šä¸Šè¿°ä»£ç ä»…ç”¨äºæ¼”ç¤º finally çš„&quot;å¿…æ‰§è¡Œ&quot;ç‰¹æ€§ï¼Œ<strong>å®é™…æ–‡ä»¶æ“ä½œå¼ºçƒˆæ¨èä½¿ç”¨ withï¼ï¼</strong></p>
<h2 id="4-raise-è¯­å¥ï¼ˆä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸ï¼‰-a-id-raise-a">4.raise è¯­å¥ï¼ˆä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸ï¼‰<a id="raise"></a></h2>
<p>é™¤äº†æ•è·ç¨‹åºè¿è¡Œæ—¶çš„è‡ªç„¶å¼‚å¸¸ï¼Œè¿˜å¯é€šè¿‡ raise è¯­å¥ä¸»åŠ¨è§¦å‘å¼‚å¸¸ï¼Œç”¨äºè‡ªå®šä¹‰é”™è¯¯æ ¡éªŒé€»è¾‘ï¼ˆå¦‚å‚æ•°åˆæ³•æ€§æ£€æŸ¥ï¼‰ã€‚</p>
<h3 id="ï¼ˆ1ï¼‰åŸºæœ¬è¯­æ³•">ï¼ˆ1ï¼‰åŸºæœ¬è¯­æ³•</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¯­æ³•1ï¼šæŠ›å‡ºæŒ‡å®šç±»å‹çš„å¼‚å¸¸ï¼ˆæ— è¯¦ç»†ä¿¡æ¯ï¼‰</span></span><br><span class="line"><span class="keyword">raise</span> å¼‚å¸¸ç±»å‹</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯­æ³•2ï¼šæŠ›å‡ºå¼‚å¸¸å¹¶æŒ‡å®šé”™è¯¯ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">raise</span> å¼‚å¸¸ç±»å‹(<span class="string">&quot;é”™è¯¯æè¿°&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯­æ³•3ï¼šé‡æ–°æŠ›å‡ºæ•è·çš„å¼‚å¸¸ï¼ˆä¿ç•™å¼‚å¸¸åŸå§‹ä¿¡æ¯ï¼‰</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    å±é™©æ“ä½œ</span><br><span class="line"><span class="keyword">except</span> å¼‚å¸¸ç±»å‹ <span class="keyword">as</span> e:</span><br><span class="line">    <span class="comment"># å¤„ç†éƒ¨åˆ†é€»è¾‘åï¼Œé‡æ–°æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">raise</span> e  <span class="comment"># æˆ–ç›´æ¥ raiseï¼ˆä¿ç•™å®Œæ•´å¼‚å¸¸æ ˆï¼‰</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰ä½¿ç”¨ç¤ºä¾‹">ï¼ˆ2ï¼‰ä½¿ç”¨ç¤ºä¾‹</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¤ºä¾‹1ï¼šå‚æ•°åˆæ³•æ€§æ ¡éªŒï¼ˆä¸»åŠ¨æŠ›å‡º ValueErrorï¼‰</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>(<span class="params">name, age</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(name, <span class="built_in">str</span>) <span class="keyword">or</span> <span class="built_in">len</span>(name) == <span class="number">0</span>:</span><br><span class="line">        <span class="comment"># ä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸ï¼Œè¯´æ˜å‚æ•°é”™è¯¯</span></span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;ç”¨æˆ·åå¿…é¡»æ˜¯éç©ºå­—ç¬¦ä¸²&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(age, <span class="built_in">int</span>) <span class="keyword">or</span> age &lt; <span class="number">0</span> <span class="keyword">or</span> age &gt; <span class="number">150</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;å¹´é¾„å¿…é¡»æ˜¯ 0-150 ä¹‹é—´çš„æ•´æ•°&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æ³¨å†ŒæˆåŠŸï¼šå§“å=<span class="subst">&#123;name&#125;</span>ï¼Œå¹´é¾„=<span class="subst">&#123;age&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨å‡½æ•°ï¼Œè§¦å‘ä¸»åŠ¨æŠ›å‡ºçš„å¼‚å¸¸</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    register(<span class="string">&quot;&quot;</span>, <span class="number">25</span>)  <span class="comment"># ç”¨æˆ·åç©ºï¼Œè§¦å‘å¼‚å¸¸</span></span><br><span class="line"><span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æ³¨å†Œå¤±è´¥ï¼š<span class="subst">&#123;e&#125;</span>&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šæ³¨å†Œå¤±è´¥ï¼šç”¨æˆ·åå¿…é¡»æ˜¯éç©ºå­—ç¬¦ä¸²</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹2ï¼šé‡æ–°æŠ›å‡ºå¼‚å¸¸ï¼ˆä¿ç•™åŸå§‹é”™è¯¯æ ˆï¼‰</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    register(<span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="number">200</span>)</span><br><span class="line"><span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æ ¡éªŒå¤±è´¥ï¼š<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">raise</span>  <span class="comment"># é‡æ–°æŠ›å‡ºå¼‚å¸¸ï¼Œç¨‹åºä¼šä¸­æ–­å¹¶æ˜¾ç¤ºå®Œæ•´é”™è¯¯æ ˆ</span></span><br></pre></td></tr></table></figure>
<h2 id="5-è‡ªå®šä¹‰å¼‚å¸¸ç±»">5.è‡ªå®šä¹‰å¼‚å¸¸ç±»</h2>
<p>å½“ Python å†…ç½®å¼‚å¸¸æ— æ³•æ»¡è¶³ä¸šåŠ¡éœ€æ±‚æ—¶ï¼ˆå¦‚è‡ªå®šä¹‰ä¸šåŠ¡é”™è¯¯ç±»å‹ï¼‰ï¼Œå¯<strong>é€šè¿‡ç»§æ‰¿ Exception ç±»ï¼ˆæˆ–å…¶å­ç±»ï¼‰åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸</strong>ã€‚</p>
<h3 id="ï¼ˆ1ï¼‰è¯­æ³•è§„åˆ™">ï¼ˆ1ï¼‰è¯­æ³•è§„åˆ™</h3>
<ul>
<li>éœ€ç»§æ‰¿ Exception ç±»æˆ–å…¶åˆæ³•å­ç±»ï¼ˆå¦‚ ValueErrorã€TypeError ç­‰ï¼‰</li>
<li>ä¸å»ºè®®ç›´æ¥ç»§æ‰¿ BaseExceptionï¼ˆé¿å…æ•è·ç³»ç»Ÿçº§å¼‚å¸¸ï¼Œå¦‚KeyboardInterruptï¼‰</li>
<li><strong>é€šå¸¸éœ€é‡å†™__init__ æ–¹æ³•</strong>ï¼šå¯æ·»åŠ è‡ªå®šä¹‰å±æ€§ï¼ˆå¦‚é”™è¯¯ç ã€è¯¦ç»†æè¿°ï¼‰ï¼Œè®©å¼‚å¸¸ä¿¡æ¯æ›´å®Œæ•´ï¼ˆå¯é€‰ï¼Œç®€å•åœºæ™¯å¯ç›´æ¥ä½¿ç”¨çˆ¶ç±»æ„é€ æ–¹æ³•ï¼‰ã€‚</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰ä½¿ç”¨ç¤ºä¾‹-2">ï¼ˆ2ï¼‰ä½¿ç”¨ç¤ºä¾‹</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ==================== è‡ªå®šä¹‰å¼‚å¸¸ç±»ç¤ºä¾‹ ====================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- ç¤ºä¾‹1ï¼šæœ€ç®€å•çš„è‡ªå®šä¹‰å¼‚å¸¸ï¼ˆç›´æ¥ç»§æ‰¿ï¼Œæ— é¢å¤–å±æ€§ï¼‰---</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyBusinessError</span>(<span class="title class_ inherited__">Exception</span>):</span><br><span class="line">   <span class="string">&quot;&quot;&quot;ä¸šåŠ¡é€»è¾‘é”™è¯¯çš„åŸºç±»&quot;&quot;&quot;</span></span><br><span class="line">   <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- ç¤ºä¾‹2ï¼šå¸¦è‡ªå®šä¹‰å±æ€§çš„å¼‚å¸¸ï¼ˆé‡å†™ __init__ï¼‰---</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ValidationError</span>(<span class="title class_ inherited__">Exception</span>):</span><br><span class="line">   <span class="string">&quot;&quot;&quot;æ•°æ®éªŒè¯é”™è¯¯&quot;&quot;&quot;</span></span><br><span class="line">   <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, field, message, error_code=<span class="literal">None</span></span>):</span><br><span class="line">       <span class="variable language_">self</span>.field = field          <span class="comment"># å‡ºé”™çš„å­—æ®µå</span></span><br><span class="line">       <span class="variable language_">self</span>.message = message      <span class="comment"># é”™è¯¯æè¿°</span></span><br><span class="line">       <span class="variable language_">self</span>.error_code = error_code  <span class="comment"># é”™è¯¯ç ï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line">       <span class="comment"># è°ƒç”¨çˆ¶ç±»æ„é€ æ–¹æ³•ï¼Œè®¾ç½®å¼‚å¸¸çš„é»˜è®¤æ¶ˆæ¯</span></span><br><span class="line">       <span class="built_in">super</span>().__init__(<span class="string">f&quot;[<span class="subst">&#123;error_code&#125;</span>] <span class="subst">&#123;field&#125;</span>: <span class="subst">&#123;message&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- ç¤ºä¾‹3ï¼šç»§æ‰¿ç‰¹å®šå¼‚å¸¸å­ç±» ---</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AgeValueError</span>(<span class="title class_ inherited__">ValueError</span>):</span><br><span class="line">   <span class="string">&quot;&quot;&quot;å¹´é¾„å€¼é”™è¯¯ï¼ˆç»§æ‰¿ ValueErrorï¼Œè¯­ä¹‰æ›´æ˜ç¡®ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">   <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, age, message=<span class="string">&quot;å¹´é¾„å¿…é¡»åœ¨ 0-150 ä¹‹é—´&quot;</span></span>):</span><br><span class="line">       <span class="variable language_">self</span>.age = age</span><br><span class="line">       <span class="variable language_">self</span>.message = message</span><br><span class="line">       <span class="built_in">super</span>().__init__(<span class="string">f&quot;<span class="subst">&#123;message&#125;</span>ï¼Œå½“å‰å€¼ï¼š<span class="subst">&#123;age&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ==================== ä½¿ç”¨ç¤ºä¾‹ ====================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register_user</span>(<span class="params">name, age, email</span>):</span><br><span class="line">   <span class="string">&quot;&quot;&quot;ç”¨æˆ·æ³¨å†Œå‡½æ•°ï¼ˆæ¼”ç¤ºè‡ªå®šä¹‰å¼‚å¸¸çš„ä½¿ç”¨ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">   <span class="comment"># éªŒè¯å§“å</span></span><br><span class="line">   <span class="keyword">if</span> <span class="keyword">not</span> name <span class="keyword">or</span> <span class="built_in">len</span>(name) &lt; <span class="number">2</span>:</span><br><span class="line">       <span class="keyword">raise</span> ValidationError(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;å§“åé•¿åº¦ä¸èƒ½å°‘äº2ä¸ªå­—ç¬¦&quot;</span>, <span class="string">&quot;E1001&quot;</span>)</span><br><span class="line">   </span><br><span class="line">   <span class="comment"># éªŒè¯å¹´é¾„</span></span><br><span class="line">   <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(age, <span class="built_in">int</span>) <span class="keyword">or</span> age &lt; <span class="number">0</span> <span class="keyword">or</span> age &gt; <span class="number">150</span>:</span><br><span class="line">       <span class="keyword">raise</span> AgeValueError(age)</span><br><span class="line">   </span><br><span class="line">   <span class="comment"># éªŒè¯é‚®ç®±</span></span><br><span class="line">   <span class="keyword">if</span> <span class="string">&quot;@&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> email:</span><br><span class="line">       <span class="keyword">raise</span> ValidationError(<span class="string">&quot;email&quot;</span>, <span class="string">&quot;é‚®ç®±æ ¼å¼ä¸æ­£ç¡®&quot;</span>, <span class="string">&quot;E1002&quot;</span>)</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">return</span> &#123;<span class="string">&quot;name&quot;</span>: name, <span class="string">&quot;age&quot;</span>: age, <span class="string">&quot;email&quot;</span>: email&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ==================== æ•è·è‡ªå®šä¹‰å¼‚å¸¸ ====================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">   user = register_user(<span class="string">&quot;å¼ &quot;</span>, <span class="number">25</span>, <span class="string">&quot;test@example.com&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> ValidationError <span class="keyword">as</span> e:</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">f&quot;éªŒè¯å¤±è´¥ - å­—æ®µï¼š<span class="subst">&#123;e.field&#125;</span>ï¼ŒåŸå› ï¼š<span class="subst">&#123;e.message&#125;</span>ï¼Œé”™è¯¯ç ï¼š<span class="subst">&#123;e.error_code&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> AgeValueError <span class="keyword">as</span> e:</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">f&quot;å¹´é¾„é”™è¯¯ - <span class="subst">&#123;e.message&#125;</span>ï¼Œè¾“å…¥å€¼ï¼š<span class="subst">&#123;e.age&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">f&quot;æ³¨å†ŒæˆåŠŸï¼š<span class="subst">&#123;user&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºï¼šéªŒè¯å¤±è´¥ - å­—æ®µï¼šnameï¼ŒåŸå› ï¼šå§“åé•¿åº¦ä¸èƒ½å°‘äº2ä¸ªå­—ç¬¦ï¼Œé”™è¯¯ç ï¼šE1001</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1>åäºŒã€ä»£ç æµ‹è¯•</h1>
<h2 id="1-æµ‹è¯•çš„åˆ†ç±»">1.æµ‹è¯•çš„åˆ†ç±»</h2>
<table>
<thead>
<tr>
<th>æµ‹è¯•ç±»å‹</th>
<th>è¯´æ˜</th>
<th>ç²’åº¦</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>å•å…ƒæµ‹è¯•</strong></td>
<td>æµ‹è¯•æœ€å°ä»£ç å•å…ƒï¼ˆå‡½æ•°/æ–¹æ³•ï¼‰</td>
<td>æœ€ç»†</td>
</tr>
<tr>
<td><strong>é›†æˆæµ‹è¯•</strong></td>
<td>æµ‹è¯•æ¨¡å—é—´çš„åä½œ</td>
<td>ä¸­ç­‰</td>
</tr>
<tr>
<td><strong>ç«¯åˆ°ç«¯æµ‹è¯•</strong></td>
<td>æµ‹è¯•å®Œæ•´ä¸šåŠ¡æµç¨‹</td>
<td>æœ€ç²—</td>
</tr>
</tbody>
</table>
<h2 id="2-å¸¸ç”¨æµ‹è¯•æ¡†æ¶">2.å¸¸ç”¨æµ‹è¯•æ¡†æ¶</h2>
<h3 id="ï¼ˆ1ï¼‰unittestï¼ˆæ ‡å‡†åº“ï¼Œå†…ç½®ï¼‰">ï¼ˆ1ï¼‰unittestï¼ˆæ ‡å‡†åº“ï¼Œå†…ç½®ï¼‰</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestAdd</span>(unittest.TestCase):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_add_positive</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.assertEqual(add(<span class="number">1</span>, <span class="number">2</span>), <span class="number">3</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_add_negative</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.assertEqual(add(-<span class="number">1</span>, -<span class="number">2</span>), -<span class="number">3</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_add_zero</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.assertEqual(add(<span class="number">0</span>, <span class="number">0</span>), <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™ä¸ªåˆ¤æ–­çš„ä½œç”¨æ˜¯&quot;å½“ç›´æ¥è¿è¡Œè¯¥æµ‹è¯•æ–‡ä»¶æ—¶æ‰§è¡Œæµ‹è¯•ï¼Œè¢«å¯¼å…¥æ—¶ä¸æ‰§è¡Œ&quot;</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure>
<p><strong>å¸¸ç”¨æ–­è¨€æ–¹æ³•</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>assertEqual(a, b)</code></td>
<td>a == b</td>
</tr>
<tr>
<td><code>assertNotEqual(a, b)</code></td>
<td>a != b</td>
</tr>
<tr>
<td><code>assertTrue(x)</code></td>
<td>x ä¸ºçœŸ</td>
</tr>
<tr>
<td><code>assertFalse(x)</code></td>
<td>x ä¸ºå‡</td>
</tr>
<tr>
<td><code>assertIsNone(x)</code></td>
<td>x is None</td>
</tr>
<tr>
<td><code>assertRaises(Error)</code></td>
<td>æ£€æŸ¥æ˜¯å¦æŠ›å‡ºæŒ‡å®šå¼‚å¸¸</td>
</tr>
</tbody>
</table>
<h3 id="ï¼ˆ2ï¼‰pytestï¼ˆç¬¬ä¸‰æ–¹ï¼Œæ›´æ¨è-â­ï¼‰">ï¼ˆ2ï¼‰pytestï¼ˆç¬¬ä¸‰æ–¹ï¼Œæ›´æ¨è â­ï¼‰</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install pytest</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># test_demo.py</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡½æ•°åä»¥ test_ å¼€å¤´å³å¯ï¼Œæ— éœ€ç»§æ‰¿ç±»</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_add_positive</span>():</span><br><span class="line">    <span class="keyword">assert</span> add(<span class="number">1</span>, <span class="number">2</span>) == <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_add_negative</span>():</span><br><span class="line">    <span class="keyword">assert</span> add(-<span class="number">1</span>, -<span class="number">2</span>) == -<span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•å¼‚å¸¸</span></span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">divide</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;é™¤æ•°ä¸èƒ½ä¸º0&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> a / b</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_divide_by_zero</span>():</span><br><span class="line">    <span class="keyword">with</span> pytest.raises(ValueError):</span><br><span class="line">        divide(<span class="number">10</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p><strong>è¿è¡Œæµ‹è¯•</strong>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pytest                    <span class="comment"># è‡ªåŠ¨å‘ç°å¹¶è¿è¡Œæ‰€æœ‰ test_*.py</span></span><br><span class="line">pytest -v                 <span class="comment"># è¯¦ç»†è¾“å‡º</span></span><br><span class="line">pytest test_demo.py       <span class="comment"># è¿è¡ŒæŒ‡å®šæ–‡ä»¶</span></span><br><span class="line">pytest -k <span class="string">&quot;add&quot;</span>           <span class="comment"># åªè¿è¡Œåç§°åŒ…å« &quot;add&quot; çš„æµ‹è¯•</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ3ï¼‰pytest-å‚æ•°åŒ–æµ‹è¯•ï¼ˆæ‰¹é‡æµ‹è¯•å¤šç»„æ•°æ®ï¼‰">ï¼ˆ3ï¼‰pytest å‚æ•°åŒ–æµ‹è¯•ï¼ˆæ‰¹é‡æµ‹è¯•å¤šç»„æ•°æ®ï¼‰</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&quot;a, b, expected&quot;</span>, [</span></span></span><br><span class="line"><span class="params"><span class="meta">    (<span class="params"><span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span></span>),</span></span></span><br><span class="line"><span class="params"><span class="meta">    (<span class="params">-<span class="number">1</span>, -<span class="number">2</span>, -<span class="number">3</span></span>),</span></span></span><br><span class="line"><span class="params"><span class="meta">    (<span class="params"><span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span></span>),</span></span></span><br><span class="line"><span class="params"><span class="meta">    (<span class="params"><span class="number">100</span>, <span class="number">200</span>, <span class="number">300</span></span>),</span></span></span><br><span class="line"><span class="params"><span class="meta">]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_add</span>(<span class="params">a, b, expected</span>):</span><br><span class="line">    <span class="keyword">assert</span> add(a, b) == expected</span><br></pre></td></tr></table></figure>
<h2 id="3-æµ‹è¯•å¤¹å…·ï¼ˆFixtureï¼‰â€”â€”-æµ‹è¯•å‰åçš„å‡†å¤‡-æ¸…ç†">3.æµ‹è¯•å¤¹å…·ï¼ˆFixtureï¼‰â€”â€” æµ‹è¯•å‰åçš„å‡†å¤‡/æ¸…ç†</h2>
<h3 id="1-unittest-æ–¹å¼">&lt;1&gt;unittest æ–¹å¼</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TestDatabase</span>(unittest.TestCase):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setUp</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ¯ä¸ªæµ‹è¯•æ–¹æ³•å‰æ‰§è¡Œ&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.db = connect_database()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">tearDown</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ¯ä¸ªæµ‹è¯•æ–¹æ³•åæ‰§è¡Œ&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.db.close()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_query</span>(<span class="params">self</span>):</span><br><span class="line">        result = <span class="variable language_">self</span>.db.query(<span class="string">&quot;SELECT 1&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.assertIsNotNone(result)</span><br></pre></td></tr></table></figure>
<h3 id="2-pytest-æ–¹å¼ï¼ˆæ›´çµæ´»ï¼‰">&lt;2&gt;pytest æ–¹å¼ï¼ˆæ›´çµæ´»ï¼‰</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.fixture</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">db_connection</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;å¤¹å…·ï¼šå»ºç«‹æ•°æ®åº“è¿æ¥&quot;&quot;&quot;</span></span><br><span class="line">    conn = connect_database()</span><br><span class="line">    <span class="keyword">yield</span> conn  <span class="comment"># yield ä¹‹å‰æ˜¯ setupï¼Œä¹‹åæ˜¯ teardown</span></span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_query</span>(<span class="params">db_connection</span>):  <span class="comment"># å‚æ•°å = å¤¹å…·å‡½æ•°å</span></span><br><span class="line">    result = db_connection.query(<span class="string">&quot;SELECT 1&quot;</span>)</span><br><span class="line">    <span class="keyword">assert</span> result <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure>
<h2 id="4-Mock-æ¨¡æ‹Ÿï¼ˆéš”ç¦»å¤–éƒ¨ä¾èµ–ï¼‰">4.Mock æ¨¡æ‹Ÿï¼ˆéš”ç¦»å¤–éƒ¨ä¾èµ–ï¼‰</h2>
<p>æµ‹è¯•æ—¶æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚ã€æ•°æ®åº“ã€æ–‡ä»¶ç­‰å¤–éƒ¨ä¾èµ–ï¼Œé¿å…çœŸå®è°ƒç”¨ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> unittest.mock <span class="keyword">import</span> Mock, patch</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹ï¼šæ¨¡æ‹Ÿ API è¯·æ±‚</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_user_name</span>(<span class="params">user_id</span>):</span><br><span class="line">    response = requests.get(<span class="string">f&quot;https://api.example.com/users/<span class="subst">&#123;user_id&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> response.json()[<span class="string">&quot;name&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•æ—¶æ¨¡æ‹Ÿ requests.get</span></span><br><span class="line"><span class="meta">@patch(<span class="params"><span class="string">&quot;requests.get&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_get_user_name</span>(<span class="params">mock_get</span>):</span><br><span class="line">    <span class="comment"># è®¾ç½®æ¨¡æ‹Ÿè¿”å›å€¼</span></span><br><span class="line">    mock_get.return_value.json.return_value = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;å¼ ä¸‰&quot;</span>&#125;</span><br><span class="line">    </span><br><span class="line">    result = get_user_name(<span class="number">123</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">assert</span> result == <span class="string">&quot;å¼ ä¸‰&quot;</span></span><br><span class="line">    mock_get.assert_called_once()  <span class="comment"># éªŒè¯è¢«è°ƒç”¨è¿‡</span></span><br></pre></td></tr></table></figure>
<h2 id="5-æµ‹è¯•è¦†ç›–ç‡">5.æµ‹è¯•è¦†ç›–ç‡</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install pytest-cov</span><br><span class="line">pytest --cov=your_module --cov-report=html</span><br></pre></td></tr></table></figure>
<p>ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Šï¼ŒæŸ¥çœ‹å“ªäº›ä»£ç æœªè¢«æµ‹è¯•è¦†ç›–ã€‚</p>
<h2 id="6-å®é™…å¼€å‘ä¸­çš„æµ‹è¯•æœ€ä½³å®è·µ">6.å®é™…å¼€å‘ä¸­çš„æµ‹è¯•æœ€ä½³å®è·µ</h2>
<table>
<thead>
<tr>
<th>åŸåˆ™</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>æµ‹è¯•æ–‡ä»¶å‘½å</strong></td>
<td><code>test_*.py</code> æˆ– <code>*_test.py</code></td>
</tr>
<tr>
<td><strong>æµ‹è¯•å‡½æ•°å‘½å</strong></td>
<td><code>test_åŠŸèƒ½_åœºæ™¯_é¢„æœŸç»“æœ</code></td>
</tr>
<tr>
<td><strong>ä¸€ä¸ªæµ‹è¯•ä¸€ä¸ªæ–­è¨€</strong></td>
<td>æ¯ä¸ªæµ‹è¯•åªéªŒè¯ä¸€ä¸ªè¡Œä¸º</td>
</tr>
<tr>
<td><strong>ç‹¬ç«‹æ€§</strong></td>
<td>æµ‹è¯•ä¹‹é—´äº’ä¸ä¾èµ–ï¼Œå¯å•ç‹¬è¿è¡Œ</td>
</tr>
<tr>
<td><strong>å¿«é€Ÿ</strong></td>
<td>å•å…ƒæµ‹è¯•åº”æ¯«ç§’çº§å®Œæˆ</td>
</tr>
<tr>
<td><strong>ä½¿ç”¨ Mock</strong></td>
<td>éš”ç¦»å¤–éƒ¨ä¾èµ–ï¼ˆç½‘ç»œã€æ•°æ®åº“ã€æ–‡ä»¶ï¼‰</td>
</tr>
</tbody>
</table>
<h2 id="7-é¡¹ç›®ç»“æ„ç¤ºä¾‹">7.é¡¹ç›®ç»“æ„ç¤ºä¾‹</h2>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">my_project/</span><br><span class="line">â”œâ”€â”€ src/</span><br><span class="line">â”‚   â””â”€â”€ calculator.py</span><br><span class="line">â”œâ”€â”€ tests/</span><br><span class="line">â”‚   â”œâ”€â”€ __init__.py</span><br><span class="line">â”‚   â”œâ”€â”€ test_calculator.py</span><br><span class="line">â”‚   â””â”€â”€ conftest.py        # pytest å…±äº«å¤¹å…·</span><br><span class="line">â”œâ”€â”€ pytest.ini             # pytest é…ç½®</span><br><span class="line">â””â”€â”€ requirements.txt</span><br></pre></td></tr></table></figure>
<h2 id="8-å¿«é€Ÿå¯¹æ¯”">8.å¿«é€Ÿå¯¹æ¯”</h2>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>unittest</th>
<th>pytest</th>
</tr>
</thead>
<tbody>
<tr>
<td>å®‰è£…</td>
<td>å†…ç½®</td>
<td>éœ€å®‰è£…</td>
</tr>
<tr>
<td>è¯­æ³•</td>
<td>ç±» + æ–¹æ³•</td>
<td>å‡½æ•°å³å¯</td>
</tr>
<tr>
<td>æ–­è¨€</td>
<td><code>self.assertEqual()</code></td>
<td>ç›´æ¥ <code>assert</code></td>
</tr>
<tr>
<td>å‚æ•°åŒ–</td>
<td>ç¹ç</td>
<td><code>@pytest.mark.parametrize</code></td>
</tr>
<tr>
<td>å¤¹å…·</td>
<td><code>setUp/tearDown</code></td>
<td><code>@pytest.fixture</code></td>
</tr>
<tr>
<td><strong>æ¨èåº¦</strong></td>
<td>â­â­â­</td>
<td>â­â­â­â­â­</td>
</tr>
</tbody>
</table>
<p><strong>æ€»ç»“</strong>ï¼šå®é™…å¼€å‘ä¸­ <strong>pytest æ˜¯ä¸»æµé€‰æ‹©</strong>ï¼Œè¯­æ³•ç®€æ´ã€åŠŸèƒ½å¼ºå¤§ã€æ’ä»¶ä¸°å¯Œã€‚ç»“åˆ Mock éš”ç¦»ä¾èµ– + è¦†ç›–ç‡æ£€æµ‹ï¼Œå¯æ„å»ºå¯é çš„æµ‹è¯•ä½“ç³»ã€‚</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>ç¬¬ä¸‰ç« ï¼šå­—å…¸å’Œé›†åˆ</title>
    <url>/2026/01/09/Python/%E3%80%8A%E6%B5%81%E7%95%85%E7%9A%84python%E3%80%8B/%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%AD%97%E5%85%B8%E5%92%8C%E9%9B%86%E5%90%88/</url>
    <content><![CDATA[<h1>ä¸‰ã€æ˜ å°„ç±»å‹æ ‡å‡† API</h1>
<p><strong>è¿™é‡Œæœ€å…ˆæï¼Œæ–¹ä¾¿ç†Ÿæ‚‰åæŸ¥è¯¢</strong></p>
<h2 id="1-å¸¸ç”¨æ˜ å°„æ–¹æ³•æ¦‚è¿°">1.å¸¸ç”¨æ˜ å°„æ–¹æ³•æ¦‚è¿°</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109172728193.png" alt=""><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109172753032.png" alt=""><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109172812129.png" alt=""></p>
<h2 id="2-æ’å…¥æˆ–æ›´æ–°å¯å˜çš„å€¼ï¼ˆdict-setdefaultæ–¹æ³•ï¼‰">2.æ’å…¥æˆ–æ›´æ–°å¯å˜çš„å€¼ï¼ˆdict.setdefaultæ–¹æ³•ï¼‰</h2>
<h3 id="ï¼ˆ1ï¼‰å¤„ç†ç¼ºå°‘é”®çš„å¸¸ç”¨æ–¹æ³•">ï¼ˆ1ï¼‰å¤„ç†ç¼ºå°‘é”®çš„å¸¸ç”¨æ–¹æ³•</h3>
<ul>
<li><strong>æŠ›å‡ºé”™è¯¯</strong>ï¼šæ ¹æ® Python çš„â€œå¿«é€Ÿå¤±è´¥â€åŸåˆ™ï¼Œå½“é”® k ä¸å­˜åœ¨æ—¶ï¼Œd[k] æŠ›å‡ºé”™è¯¯ã€‚</li>
<li><strong>è®¾ç½®é»˜è®¤å€¼</strong>ï¼šå¦‚æœè§‰å¾—é»˜è®¤å€¼æ¯”æŠ›å‡º KeyError æ›´å¥½ï¼Œé‚£ä¹ˆå¯ä»¥æŠŠ d[k] æ¢æˆ <strong>d.get(k, default)</strong></li>
</ul>
<p><strong>ç„¶è€Œï¼Œå¦‚æœä½ æƒ³æ›´æ–°å¾—åˆ°çš„å¯å˜å€¼ï¼Œé‚£ä¹ˆè¿˜æœ‰æ›´å¥½çš„æ–¹æ³•ã€‚</strong></p>
<h3 id="ï¼ˆ2ï¼‰ä»£ç ç¤ºä¾‹">ï¼ˆ2ï¼‰ä»£ç ç¤ºä¾‹</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109174026857.png" alt=""><br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109174123769.png" alt=""><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109174153949.png" alt=""><br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109174309417.png" alt=""><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109174349353.png" alt=""></p>
<h1>ä¸€ã€å­—å…¸çš„ç°ä»£å¥æ³•</h1>
<h2 id="1-å­—å…¸æ¨å¯¼å¼">1.å­—å…¸æ¨å¯¼å¼</h2>
<h3 id="ï¼ˆ1ï¼‰ä»‹ç»">ï¼ˆ1ï¼‰ä»‹ç»</h3>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šä»ä»»ä½•å¯è¿­ä»£å¯¹è±¡ä¸­è·å–é”®å€¼å¯¹ï¼Œæ„å»º dict å®ä¾‹ã€‚</li>
<li><strong>æ¥å†</strong>ï¼šç”±åˆ—è¡¨æ¨å¯¼å¼å’Œç”Ÿæˆå™¨è¡¨è¾¾å¼æ”¹é€ è€Œæ¥</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰åŸºç¡€è¯­æ³•ç»“æ„">ï¼ˆ2ï¼‰åŸºç¡€è¯­æ³•ç»“æ„</h3>
<h4 id="1-è¯­æ³•ç»“æ„ï¼š-key-expression-value-expression-for-item-in-iterable-if-condition">&lt;1&gt;è¯­æ³•ç»“æ„ï¼š{key_expression: value_expression for item in iterable [if condition]}</h4>
<ul>
<li><strong>key_expression: ç”¨äºç”Ÿæˆå­—å…¸çš„é”®</strong></li>
<li><strong>value_expression: ç”¨äºç”Ÿæˆå­—å…¸çš„å€¼</strong></li>
<li><strong>for item in iterable: è¿­ä»£æ•°æ®æº</strong></li>
<li><strong>if condition: å¯é€‰çš„è¿‡æ»¤æ¡ä»¶</strong></li>
</ul>
<h4 id="2-ä½¿ç”¨ç¤ºä¾‹">&lt;2&gt;ä½¿ç”¨ç¤ºä¾‹</h4>
<h5 id="ç¤ºä¾‹-1ï¼šæœ€ç®€å­—å…¸æ¨å¯¼å¼ï¼ˆéå†ç”Ÿæˆï¼‰">ç¤ºä¾‹ 1ï¼šæœ€ç®€å­—å…¸æ¨å¯¼å¼ï¼ˆéå†ç”Ÿæˆï¼‰</h5>
<ul>
<li><strong>åªä¿ç•™é•¿åº¦å¤§äº 5 çš„å•è¯</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">words = [<span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;banana&#x27;</span>, <span class="string">&#x27;cherry&#x27;</span>]</span><br><span class="line"><span class="comment"># æ¡ä»¶ï¼šåªä¿ç•™é•¿åº¦&gt;5çš„é”®å€¼å¯¹</span></span><br><span class="line">word_len_filter = &#123;word: <span class="built_in">len</span>(word) <span class="keyword">for</span> word <span class="keyword">in</span> words <span class="keyword">if</span> <span class="built_in">len</span>(word) &gt; <span class="number">5</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(word_len_filter)</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š&#123;&#x27;banana&#x27;: 6, &#x27;cherry&#x27;: 6&#125;</span></span><br></pre></td></tr></table></figure>
<h5 id="ç¤ºä¾‹-2ï¼šéå†ä¸¤ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼ˆzip-é…åˆï¼‰">ç¤ºä¾‹ 2ï¼šéå†ä¸¤ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼ˆzip é…åˆï¼‰</h5>
<ul>
<li><strong>ç”¨ zip é…å¯¹ä¸¤ä¸ªåˆ—è¡¨ï¼Œåˆ†åˆ«ä½œä¸º key å’Œ value</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">keys = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br><span class="line">values = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="comment"># éå†zipåçš„é…å¯¹æ•°æ®</span></span><br><span class="line">my_dict = &#123;k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">zip</span>(keys, values)&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(my_dict)</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š&#123;&#x27;a&#x27;: 1, &#x27;b&#x27;: 2, &#x27;c&#x27;: 3&#125;</span></span><br></pre></td></tr></table></figure>
<p><strong>zip( *iterables)</strong>ï¼šç”¨äºå°†å¤šä¸ªå¯è¿­ä»£å¯¹è±¡ï¼ˆåˆ—è¡¨ã€å…ƒç»„ç­‰ï¼‰â€œæ‰“åŒ…â€ æˆä¸€ä¸ªè¿­ä»£å™¨</p>
<ul>
<li>*iterablesï¼šä¸€ä¸ªæˆ–å¤šä¸ªå¯è¿­ä»£å¯¹è±¡ï¼ˆåˆ—è¡¨ã€å…ƒç»„ã€å­—ç¬¦ä¸²ã€å­—å…¸ç­‰ï¼‰ï¼›</li>
<li>è¿”å›å€¼ï¼šzip å¯¹è±¡ï¼ˆè¿­ä»£å™¨ï¼‰ï¼Œ<strong>å¯é€šè¿‡ list()/dict() è½¬æ¢ä¸ºåˆ—è¡¨ / å­—å…¸ï¼Œæˆ–ç›´æ¥éå†</strong>ã€‚</li>
</ul>
<h5 id="ç¤ºä¾‹-3ï¼šå¯¹åŸå­—å…¸åšè½¬æ¢">ç¤ºä¾‹ 3ï¼šå¯¹åŸå­—å…¸åšè½¬æ¢</h5>
<ul>
<li><strong>ä¿®æ”¹åŸå­—å…¸çš„é”® / å€¼ï¼ˆå¦‚å°† value ç¿»å€ï¼‰</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">original = &#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">3</span>&#125;</span><br><span class="line"><span class="comment"># æ¨å¯¼å¼ä¿®æ”¹value</span></span><br><span class="line">new_dict = &#123;k: v*<span class="number">2</span> <span class="keyword">for</span> k, v <span class="keyword">in</span> original.items()&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(new_dict)</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š&#123;&#x27;a&#x27;: 2, &#x27;b&#x27;: 4, &#x27;c&#x27;: 6&#125;</span></span><br></pre></td></tr></table></figure>
<h5 id="å…³é”®æ³¨æ„äº‹é¡¹ï¼">å…³é”®æ³¨æ„äº‹é¡¹ï¼</h5>
<p>1.<strong>é”®å¿…é¡»å”¯ä¸€</strong>ï¼šå¦‚æœæ¨å¯¼å¼ç”Ÿæˆé‡å¤çš„ keyï¼Œåå‡ºç°çš„ä¼šè¦†ç›–å…ˆå‡ºç°çš„<br>
2.<strong>å¯è¿­ä»£å¯¹è±¡çš„éå†</strong>:éå†å­—å…¸æ—¶éœ€ç”¨items()è·å–é”®å€¼å¯¹ï¼Œè€Œéç›´æ¥éå†ï¼ˆç›´æ¥éå†å­—å…¸é»˜è®¤åªå– keyï¼‰<br>
3.<strong>ç®€åŒ– vs å¯è¯»æ€§</strong>ï¼šæ¨å¯¼å¼é€‚åˆç®€å•é€»è¾‘ï¼Œå¤æ‚é€»è¾‘ï¼ˆå¤šæ¡ä»¶ / å¤šè¿ç®—ï¼‰å»ºè®®ç”¨æ™®é€šå¾ªç¯ï¼Œé¿å…å¯è¯»æ€§å·®ã€‚</p>
<h2 id="2-æ˜ å°„æ‹†åŒ…ï¼ˆ-ï¼‰">2.æ˜ å°„æ‹†åŒ…ï¼ˆ**ï¼‰</h2>
<h3 id="ï¼ˆ1ï¼‰æ¼”ç¤ºä»£ç ">ï¼ˆ1ï¼‰æ¼”ç¤ºä»£ç </h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰å‡½æ•°ï¼š**kwargs ä¼šæ”¶é›†æ‰€æœ‰ä¼ å…¥çš„å…³é”®å­—å‚æ•°ï¼Œæ‰“åŒ…æˆå­—å…¸è¿”å›</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">dump</span>(<span class="params">**kwargs</span>): </span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> kwargs  <span class="comment"># è¿”å›æ”¶é›†åˆ°çš„å…³é”®å­—å‚æ•°å­—å…¸</span></span><br><span class="line"><span class="meta">... </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨å‡½æ•°ï¼šæ··åˆä½¿ç”¨ä¸¤æ¬¡å­—å…¸è§£åŒ…ï¼ˆ**ï¼‰+ ç›´æ¥å…³é”®å­—å‚æ•°ï¼ˆy=2ï¼‰</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dump(**&#123;<span class="string">&#x27;x&#x27;</span>: <span class="number">1</span>&#125;, y=<span class="number">2</span>, **&#123;<span class="string">&#x27;z&#x27;</span>: <span class="number">3</span>&#125;) </span><br><span class="line">&#123;<span class="string">&#x27;x&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;y&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;z&#x27;</span>: <span class="number">3</span>&#125;  <span class="comment"># æœ€ç»ˆæ‰€æœ‰å‚æ•°è¢«åˆå¹¶ä¸ºä¸€ä¸ªå­—å…¸</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰ä»£ç è§£æ">ï¼ˆ2ï¼‰ä»£ç è§£æ</h3>
<h4 id="1-kwargsï¼šå…³é”®å­—å‚æ•°æ”¶é›†">&lt;1&gt;**kwargsï¼šå…³é”®å­—å‚æ•°æ”¶é›†</h4>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šå‡½æ•°å®šä¹‰æ—¶ï¼Œ**kwargs æ˜¯ <strong>ã€Œå…³é”®å­—å‚æ•°æ”¶é›†å™¨ã€</strong>ï¼Œä¼šæŠŠè°ƒç”¨æ—¶ä¼ å…¥çš„æ‰€æœ‰å…³é”®å­—å‚æ•°ï¼ˆå¦‚ y=2ï¼‰ã€ä»¥åŠé€šè¿‡ <strong>**è§£åŒ…</strong> ä¼ å…¥çš„å­—å…¸é”®å€¼å¯¹ï¼Œç»Ÿä¸€æ”¶é›†æˆä¸€ä¸ªå­—å…¸ã€‚</li>
<li><strong>è§„åˆ™</strong>ï¼š
<ul>
<li>kwargs åªæ˜¯çº¦å®šä¿—æˆçš„å˜é‡åï¼Œå¯æ¢æˆä»»æ„åˆæ³•åç§°ï¼ˆå¦‚ **paramsï¼‰ï¼Œä½†è¡Œä¸šæƒ¯ä¾‹ç”¨kwargsï¼ˆkeyword argumentsï¼‰ï¼›</li>
<li><strong>å¿…é¡»æ”¾åœ¨å‡½æ•°å‚æ•°åˆ—è¡¨çš„æœ€å</strong>ï¼ˆå¦åˆ™è¯­æ³•æŠ¥é”™ï¼‰ï¼›</li>
<li><strong>åªä¼šæ”¶é›†ã€Œæœªè¢«æ˜¾å¼å®šä¹‰çš„å…³é”®å­—å‚æ•°ã€</strong>ã€‚</li>
</ul>
</li>
</ul>
<h4 id="2-å‡½æ•°è°ƒç”¨ä¸­çš„-ï¼šå­—å…¸è§£åŒ…ä¼ å‚">&lt;2&gt;å‡½æ•°è°ƒç”¨ä¸­çš„ **ï¼šå­—å…¸è§£åŒ…ä¼ å‚</h4>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šè°ƒç”¨å‡½æ•°æ—¶ï¼Œ<em><strong>**å­—å…¸</strong></em> ä¼šæŠŠå­—å…¸çš„ <strong>ã€Œé”®å€¼å¯¹ã€è§£åŒ…ä¸ºã€Œå…³é”®å­—å‚æ•°ã€</strong>ï¼ˆå¦‚ **{â€˜xâ€™:1} ç­‰ä»·äº x=1ï¼‰ã€‚</li>
<li><strong>å…³é”®è§„åˆ™</strong>ï¼š
<ul>
<li>Python 3.5+ <strong>æ”¯æŒå¤šæ¬¡è§£åŒ…</strong>ï¼ˆå¦‚ç¤ºä¾‹ä¸­ **{â€˜xâ€™:1} + **{â€˜zâ€™:3}ï¼‰ï¼Œä¸”å¯å’Œç›´æ¥çš„å…³é”®å­—å‚æ•°ï¼ˆy=2\ï¼‰æ··åˆä½¿ç”¨ï¼›</li>
<li>è§£åŒ…åçš„é”®å¿…é¡»æ˜¯<strong>å­—ç¬¦ä¸²ç±»å‹</strong>ï¼šå› ä¸ºå…³é”®å­—å‚æ•°åæœ¬è´¨æ˜¯å­—ç¬¦ä¸²ï¼›</li>
<li>è‹¥è§£åŒ… / ç›´æ¥ä¼ å‚å‡ºç°<strong>é‡å¤é”®</strong>ï¼Œåä¼ å…¥çš„ä¼š<strong>è¦†ç›–</strong>å…ˆä¼ å…¥çš„ï¼ˆå¦‚ dump(**{â€˜xâ€™:1}, x=10) â†’ {â€˜xâ€™:10}ï¼‰;</li>
</ul>
</li>
</ul>
<h4 id="3-æ‰§è¡Œè¿‡ç¨‹æ‹†è§£ï¼ˆä»è°ƒç”¨åˆ°è¿”å›ï¼‰">&lt;3&gt;æ‰§è¡Œè¿‡ç¨‹æ‹†è§£ï¼ˆä»è°ƒç”¨åˆ°è¿”å›ï¼‰</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">è°ƒç”¨ dump(**&#123;<span class="string">&#x27;x&#x27;</span>: <span class="number">1</span>&#125;, y=<span class="number">2</span>, **&#123;<span class="string">&#x27;z&#x27;</span>: <span class="number">3</span>&#125;) çš„æ­¥éª¤ï¼š</span><br><span class="line"><span class="number">1.</span> è§£åŒ…ç¬¬ä¸€ä¸ªå­—å…¸ï¼š**&#123;<span class="string">&#x27;x&#x27;</span>:<span class="number">1</span>&#125; â†’ è½¬ä¸ºå…³é”®å­—å‚æ•° x=<span class="number">1</span>ï¼›</span><br><span class="line"><span class="number">2.</span> ä¿ç•™ç›´æ¥ä¼ å…¥çš„å…³é”®å­—å‚æ•°ï¼šy=<span class="number">2</span>ï¼›</span><br><span class="line"><span class="number">3.</span> è§£åŒ…ç¬¬äºŒä¸ªå­—å…¸ï¼š**&#123;<span class="string">&#x27;z&#x27;</span>:<span class="number">3</span>&#125; â†’ è½¬ä¸ºå…³é”®å­—å‚æ•° z=<span class="number">3</span>ï¼›</span><br><span class="line"><span class="number">4.</span> å‡½æ•°å†…çš„ **kwargs æ”¶é›†æ‰€æœ‰å…³é”®å­—å‚æ•° â†’ åˆå¹¶ä¸º &#123;<span class="string">&#x27;x&#x27;</span>:<span class="number">1</span>, <span class="string">&#x27;y&#x27;</span>:<span class="number">2</span>, <span class="string">&#x27;z&#x27;</span>:<span class="number">3</span>&#125;ï¼›</span><br><span class="line"><span class="number">5.</span> å‡½æ•°è¿”å›è¿™ä¸ªåˆå¹¶åçš„å­—å…¸ã€‚</span><br></pre></td></tr></table></figure>
<h2 id="3-ä½¿ç”¨-åˆå¹¶æ˜ å°„">3.ä½¿ç”¨ | åˆå¹¶æ˜ å°„</h2>
<p><strong>Python 3.9 æ”¯æŒä½¿ç”¨ | å’Œ |= åˆå¹¶æ˜ å°„ã€‚è¿™ä¸éš¾ç†è§£ï¼Œå› ä¸ºäºŒè€…ä¹Ÿæ˜¯<br>
å¹¶é›†è¿ç®—ç¬¦ã€‚</strong></p>
<h3 id="ï¼ˆ1ï¼‰-è¿ç®—ç¬¦åˆ›å»ºä¸€ä¸ªæ–°æ˜ å°„">ï¼ˆ1ï¼‰| è¿ç®—ç¬¦åˆ›å»ºä¸€ä¸ªæ–°æ˜ å°„</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109170521809.png" alt=""></p>
<ul>
<li>â€œé”®â€ç›¸åŒæ—¶ï¼Œåè€…è¦†ç›–å‰è€…</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰-è¿ç®—ç¬¦å°±åœ°æ›´æ–°ç°æœ‰æ˜ å°„">ï¼ˆ2ï¼‰|= è¿ç®—ç¬¦å°±åœ°æ›´æ–°ç°æœ‰æ˜ å°„</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109170630056.png" alt=""></p>
<hr>
<h1>äºŒã€ä½¿ç”¨æ¨¡å¼åŒ¹é…å¤„ç†æ˜ å°„</h1>
<p><strong>æ¨¡å¼åŒ¹é…æ˜¯ä¸€ç§å¼ºå¤§çš„å·¥å…·ï¼šä¸åŒç±»å‹çš„æ¨¡å¼å¯ä»¥ç»„åˆå’ŒåµŒå¥—æ¥è¿›è¡ŒåŒ¹é…</strong></p>
<h2 id="1-ç¤ºä¾‹">1.ç¤ºä¾‹</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109171401376.png" alt=""></p>
<ul>
<li><strong>æ¨¡å¼ä¸­é”®çš„é¡ºåºæ— å…³ç´§è¦</strong>
<ul>
<li>å³ä½¿ b2 æ˜¯ä¸€ä¸ª OrderedDictï¼Œä¹Ÿèƒ½ä½œä¸ºåŒ¹é…å¯¹è±¡ã€‚</li>
</ul>
</li>
<li><strong>å°±ç®—åªæœ‰éƒ¨åˆ†åŒ¹é…ï¼Œæ˜ å°„æ¨¡å¼ä¹Ÿç®—æˆåŠŸåŒ¹é…ï¼ˆå³å¯ä»¥æ˜¯&quot;è¶…é›†&quot;ï¼‰</strong>
<ul>
<li>åœ¨ä¸Šè¿°doctest ä¸­ï¼Œb1 å’Œ b2 ä¸¤ä¸ªåŒ¹é…å¯¹è±¡ä¸­éƒ½æœ‰ â€˜titleâ€™ é”®ï¼Œå°½ç®¡ä»»ä½•â€™bookâ€™ æ¨¡å¼ä¸­éƒ½æ²¡æœ‰è¿™ä¸ªé”®ï¼Œä½†ä¾ç„¶å¯ä»¥åŒ¹é…ã€‚</li>
</ul>
</li>
<li><strong>æ²¡æœ‰å¿…è¦ä½¿ç”¨ **extra åŒ¹é…å¤šå‡ºçš„é”®å€¼å¯¹</strong>
<ul>
<li>å€˜è‹¥ä½ æƒ³æŠŠå¤šå‡ºçš„é”®å€¼å¯¹æ•è·åˆ°ä¸€ä¸ª dict ä¸­ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªå˜é‡å‰é¢åŠ ä¸Š **ï¼Œä¸è¿‡<strong>å¿…é¡»æ”¾åœ¨æ¨¡å¼æœ€å</strong>ã€‚</li>
</ul>
</li>
<li><strong>**_ æ˜¯æ— æ•ˆçš„ï¼Œçº¯å±ç”»è›‡æ·»è¶³</strong></li>
</ul>
]]></content>
      <categories>
        <category>Python</category>
        <category>ã€Šæµç•…çš„pythonã€‹</category>
        <category>ç¬¬3ç«  Pythonæ•°æ®æ¨¡å‹</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>ç¬¬ä¸€ç« ï¼šPythonæ•°æ®æ¨¡å‹</title>
    <url>/2026/01/09/Python/%E3%80%8A%E6%B5%81%E7%95%85%E7%9A%84python%E3%80%8B/%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9APython%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B/</url>
    <content><![CDATA[<p><strong>ç‰¹æ®Šæ–¹æ³•å¿«é€ŸæŸ¥è¡¨</strong>ï¼š<a href="#%E4%B8%89%E3%80%81%E7%89%B9%E6%AE%8A%E6%96%B9%E6%B3%95%E6%A6%82%E8%BF%B0">ä¸‰ã€ç‰¹æ®Šæ–¹æ³•æ¦‚è¿°</a></p>
<h1>ä¸€ã€æ¦‚è¿°</h1>
<h2 id="1-ç‰¹æ®Šæ–¹æ³•ï¼ˆâ€œé­”æœ¯æ–¹æ³•â€ï¼‰">1.ç‰¹æ®Šæ–¹æ³•ï¼ˆâ€œé­”æœ¯æ–¹æ³•â€ï¼‰</h2>
<ul>
<li>
<p><strong>ç‰¹å¾</strong>ï¼šåç§°å‰åä¸¤ç«¯éƒ½æœ‰åŒä¸‹åˆ’çº¿ã€‚å¦‚ï¼š</p>
<ul>
<li>åœ¨ obj[key] å¥æ³•èƒŒåæä¾›æ”¯æŒçš„æ˜¯ç‰¹æ®Šæ–¹æ³• <strong>getitem</strong></li>
</ul>
</li>
<li>
<p><strong>ä½œç”¨</strong>ï¼šåœ¨ç‰¹æ®Šè¯­å¥ä¸­è‡ªåŠ¨è§¦å‘è°ƒç”¨ï¼Œä¸éœ€è¦æ˜¾ç¤ºæ‰‹åŠ¨è°ƒç”¨ã€‚å¦‚ï¼š</p>
<ul>
<li>my_collection[key]ï¼šPython è§£é‡Šå™¨è‡ªåŠ¨è°ƒç”¨my_collection.<strong>getitem</strong>(key)ã€‚</li>
<li>print(my_object)ï¼šPython è§£é‡Šå™¨è‡ªåŠ¨è°ƒç”¨print(my_object.<strong>repr</strong>())<br>
<strong>å¾ˆå¤§ç¨‹åº¦ä¸Šæ–¹ä¾¿äº†æˆ‘ä»¬çš„ä½¿ç”¨</strong></li>
</ul>
</li>
<li>
<p><strong>é‡è¦æ€§</strong>ï¼šæƒ³è®©å¯¹è±¡æ”¯æŒä»¥ä¸‹åŸºæœ¬çš„è¯­è¨€ç»“æ„å¹¶ä¸å…¶äº¤äº’ï¼Œå°±éœ€è¦å®ç°ç‰¹æ®Šæ–¹<br>
æ³•ï¼š<br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109141629741.png" alt=""></p>
</li>
</ul>
<h2 id="2-å®ä¾‹ï¼šâ€œçº¸ç‰Œâ€">2.å®ä¾‹ï¼šâ€œçº¸ç‰Œâ€</h2>
<h3 id="1-å®ç°-â€œç‰¹æ®Šæ–¹æ³•â€">(1) å®ç°+â€œç‰¹æ®Šæ–¹æ³•â€</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109142035218.png" alt=""></p>
<ul>
<li><strong>Card</strong>ï¼š çº¸ç‰Œç±»ï¼Œåªæœ‰å±æ€§æ— æ–¹æ³•
<ul>
<li><strong>collections.namedtuple(â€˜ç±»åâ€™, [â€˜å­—æ®µ1â€™, â€˜å­—æ®µ2â€™, â€¦])</strong>ï¼šç”¨äºæ„å»ºåªæœ‰å±æ€§è€Œæ²¡æœ‰è‡ªå®šä¹‰æ–¹æ³•çš„ç±»å¯¹è±¡</li>
</ul>
</li>
<li><strong>FrenchDeck</strong>ï¼š æ³•å¼æ‰‘å…‹ç‰Œç±»ï¼ŒåŒ…å«Cardåˆ—è¡¨ã€<strong>é­”æ³•æ–¹æ³•</strong>
<ul>
<li>[str(n) for n in range(2, 11)] ï¼šâ€œ<strong>åˆ—è¡¨æ¨å¯¼å¼è¯­æ³•</strong>â€ï¼Œä¸‹ä¸€ç« ä¼šå­¦åˆ°</li>
<li><strong>é­”æ³•æ–¹æ³•</strong>ï¼š__getitem__ å’Œ __len__</li>
</ul>
</li>
</ul>
<p><strong>æœ¬èŠ‚å…³é”®ï¼šFrenchDeckç±»</strong></p>
<h3 id="2-â€œFrenchDeckç±»â€çš„ä½¿ç”¨">(2)â€œFrenchDeckç±»â€çš„ä½¿ç”¨</h3>
<h4 id="1-è¿”å›ä¸€æ‘ç‰Œæœ‰å¤šå°‘å¼ ">&lt;1&gt;è¿”å›ä¸€æ‘ç‰Œæœ‰å¤šå°‘å¼ </h4>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109143542901.png" alt=""></p>
<ul>
<li><strong>å¾—ç›Šäº__len__é­”æ³•æ–¹æ³•</strong>ï¼šåº•å±‚è°ƒç”¨äº†è¯¥é­”æ³•æ–¹æ³•</li>
</ul>
<h4 id="2-ä»è¿™æ‘ç‰Œä¸­æŠ½å–æŸä¸€å¼ ">&lt;2&gt;ä»è¿™æ‘ç‰Œä¸­æŠ½å–æŸä¸€å¼ </h4>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109143739371.png" alt=""></p>
<ul>
<li><strong>å¾—ç›Šäº__getitem__é­”æ³•æ–¹æ³•</strong>ï¼šåº•å±‚è°ƒç”¨äº†è¯¥é­”æ³•æ–¹æ³•</li>
</ul>
<h4 id="3-â€œ-getitem-é­”æ³•æ–¹æ³•â€-å…¶å®ƒåŠŸæ•ˆ">&lt;3&gt;â€œ__getitem__é­”æ³•æ–¹æ³•â€ å…¶å®ƒåŠŸæ•ˆ</h4>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109143955133.png" alt=""></p>
<ul>
<li><strong>æ”¯æŒâ€œåˆ‡ç‰‡â€</strong></li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109144028869.png" alt=""><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109144054149.png" alt=""></p>
<ul>
<li><strong>æ”¯æŒâ€œæ­£å‘/åå‘ è¿­ä»£â€</strong></li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109144216884.png" alt=""></p>
<ul>
<li><strong>è¿­ä»£å¾€å¾€æ˜¯éšå¼çš„</strong>ï¼šå¦‚æœä¸€ä¸ªå®¹å™¨æ²¡æœ‰å®ç° <strong>contains</strong> æ–¹æ³•ï¼Œé‚£ä¹ˆ in è¿ç®—ç¬¦å°±ä¼šåšä¸€æ¬¡é¡ºåºæ‰«æ
<ul>
<li>FrenchDeck ç±»æ”¯æŒ in è¿ç®—ç¬¦ï¼Œå› ä¸ºè¯¥ç±»å¯è¿­ä»£ã€‚</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109144536685.png" alt=""><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109144549525.png" alt=""></p>
<ul>
<li><strong>æ”¯æŒâ€œæ’åºâ€</strong></li>
</ul>
<p>1.é€šè¿‡å‰é¢ä½¿ç”¨reversed å’Œ sorted çš„ç¤ºä¾‹å¯ä»¥çœ‹å‡ºï¼Œå®ç° __len__ å’Œ __getitem__ ä¸¤ä¸ªç‰¹æ®Šæ–¹æ³•åï¼ŒFrenchDeck çš„è¡Œä¸ºå°±åƒæ ‡å‡†çš„ Pythonåºåˆ—ä¸€æ ·ï¼Œå—ç›Šäºè¯­è¨€æ ¸å¿ƒç‰¹æ€§ï¼ˆä¾‹å¦‚è¿­ä»£å’Œåˆ‡ç‰‡ï¼‰å’Œæ ‡å‡†åº“ã€‚<br>
2.__len__ å’Œ __getitem__ çš„å®ç°åˆ©ç”¨ç»„åˆæ¨¡å¼ï¼ŒæŠŠæ‰€æœ‰å·¥ä½œå§”æ‰˜ç»™ä¸€ä¸ª list å¯¹è±¡ï¼Œå³ self._cards.</p>
<h1>äºŒã€ç‰¹æ®Šæ–¹æ³•æ˜¯å¦‚ä½•ä½¿ç”¨çš„</h1>
<h2 id="1-æ¦‚è¿°">1.æ¦‚è¿°</h2>
<ul>
<li><strong>ç‰¹æ®Šæ–¹æ³•ä¾› Python è§£é‡Šå™¨è°ƒç”¨ï¼Œè€Œä¸æ˜¯ä½ è‡ªå·±</strong>
<ul>
<li>å¦‚ï¼šæ²¡æœ‰ my_object.__len__() è¿™ç§å†™æ³•ï¼Œæ­£ç¡®çš„å†™æ³•æ˜¯len(my_object)</li>
</ul>
</li>
<li><strong>å¦‚æœmy_object æ˜¯ç”¨æˆ·å®šä¹‰çš„ç±»çš„å®ä¾‹ï¼ŒPythonå°†è°ƒç”¨ä½ å®ç°çš„â€œé­”æ³•æ–¹æ³•â€</strong>
<ul>
<li>å¦‚ï¼š__len__æ–¹æ³•</li>
</ul>
</li>
<li><strong>å¾ˆå¤šæ—¶å€™ï¼Œç‰¹æ®Šæ–¹æ³•æ˜¯â€œéšå¼è°ƒç”¨â€çš„ï¼</strong>
<ul>
<li>å¦‚ï¼šfor i in x: è¯­å¥å…¶å®åœ¨èƒŒåè°ƒç”¨ iter(x)ï¼Œæ¥ç€åˆè°ƒç”¨x.__iter__()ï¼ˆå‰ææ˜¯æœ‰è¯¥æ–¹æ³•ï¼‰æˆ– x.__getitem__()</li>
</ul>
</li>
<li><strong>ç‰¹æ®Šæ–¹æ³•çš„è°ƒç”¨</strong>
<ul>
<li>åœ¨ç¼–å†™ä»£ç æ—¶<strong>ä¸€èˆ¬ä¸ç›´æ¥æ˜¾ç¤ºè°ƒç”¨</strong>ç‰¹æ®Šæ–¹æ³•ï¼Œé™¤éæ¶‰åŠå¤§é‡å…ƒç¼–ç¨‹ã€‚<strong>å”¯ä¸€ä¾‹å¤–çš„æ˜¯__init__ æ–¹æ³•</strong>ï¼Œä¸ºè‡ªå®šä¹‰çš„ç±»å®ç° __init__ æ–¹æ³•æ—¶ç»å¸¸ç›´æ¥è°ƒç”¨å®ƒè°ƒå–è¶…ç±»çš„åˆå§‹åŒ–æ–¹æ³•ã€‚</li>
<li>å¦‚æœéœ€è¦è°ƒç”¨ç‰¹æ®Šæ–¹æ³•ï¼Œåˆ™<strong>æœ€å¥½è°ƒç”¨ç›¸åº”çš„å†…ç½®å‡½æ•°</strong>ï¼Œä¾‹å¦‚lenã€iterã€strç­‰ã€‚è¿™äº›å†…ç½®å‡½æ•°ä¸ä»…è°ƒç”¨å¯¹åº”çš„ç‰¹æ®Šæ–¹æ³•ï¼Œé€šå¸¸è¿˜æä¾›é¢å¤–æœåŠ¡ï¼Œè€Œä¸”å¯¹äºå†…ç½®ç±»å‹æ¥è¯´ï¼Œé€Ÿåº¦æ¯”è°ƒç”¨æ–¹æ³•æ›´å¿«</li>
</ul>
</li>
</ul>
<h2 id="2-å®ä¾‹ï¼šVectorç±»">2.å®ä¾‹ï¼šVectorç±»</h2>
<p><strong>Vectorç±»æ¨¡æ‹Ÿä¸€ä¸ªäºŒç»´å‘é‡ç±»ï¼Œå³æ•°å­¦å’Œç‰©ç†ä¸­ä½¿ç”¨çš„æ¬§å‡ é‡Œå¾—å‘é‡</strong></p>
<h3 id="ï¼ˆ1ï¼‰Vectorç±»çš„å®ç°">ï¼ˆ1ï¼‰Vectorç±»çš„å®ç°</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109150648100.png" alt=""></p>
<ul>
<li><strong>__abs__ï¼šç»å¯¹å€¼</strong></li>
<li><strong>__add__ã€__mul__ï¼šåˆ†åˆ«ç”¨äºå®ç° + å’Œ * è¿ç®—ç¬¦</strong></li>
</ul>
<p><strong>ä½¿ç”¨ï¼š</strong><br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109151219492.png" alt=""></p>
<h3 id="ï¼ˆ2ï¼‰-Vector-ç±»çš„å…¶ä»–ç‰¹æ®Šæ–¹æ³•">ï¼ˆ2ï¼‰ Vector ç±»çš„å…¶ä»–ç‰¹æ®Šæ–¹æ³•</h3>
<h4 id="1-å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼">&lt;1&gt;å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼</h4>
<h5 id="1-repr-ç‰¹æ®Šæ–¹æ³•">1.__repr__ ç‰¹æ®Šæ–¹æ³•</h5>
<ul>
<li><strong>ä¾›å†…ç½®å‡½æ•° repr è°ƒç”¨</strong>ï¼šè·å–å¯¹è±¡çš„<strong>æ ‡å‡†</strong>å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ã€‚
<ul>
<li>å¦‚æœªå®šä¹‰ <strong>repr</strong> æ–¹æ³•ï¼ŒVector å®ä¾‹åœ¨ Python æ§åˆ¶å°ä¸­æ˜¾ç¤ºä¸º &lt;Vector object at 0x10e100070&gt; å½¢å¼</li>
</ul>
</li>
<li><strong><strong>repr</strong> æ–¹æ³•è¿”å›çš„å­—ç¬¦ä¸²åº”å½“æ²¡æœ‰æ­§ä¹‰</strong>ï¼šæœ€å¥½ä¸æºç ä¿æŒä¸€è‡´ï¼Œæ–¹ä¾¿é‡æ–°åˆ›å»ºæ‰€è¡¨ç¤ºçš„å¯¹è±¡ã€‚
<ul>
<li><strong>!r</strong>:   Vector ç±» __repr__ æ–¹æ³•ä¸­çš„ f å­—ç¬¦ä¸²ä½¿ç”¨ !r ä»¥<strong>æ ‡å‡†çš„è¡¨ç¤ºå½¢å¼æ˜¾ç¤ºå±æ€§</strong>ã€‚
<ul>
<li>è¿™æ ·åšæ¯”è¾ƒå¥½ï¼Œå› ä¸º Vector(1, 2) å’ŒVector(â€˜1â€™, â€˜2â€™)ä¹‹é—´æ˜¯æœ‰åŒºåˆ«çš„ï¼Œåè€…åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ä¸å¯ç”¨ï¼Œå› ä¸ºæ„é€ å‡½æ•°æ¥å—çš„å‚æ•°æ˜¯æ•°å€¼è€Œä¸æ˜¯å­—ç¬¦ä¸²ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="2-str-ç‰¹æ®Šæ–¹æ³•">2.__str__ ç‰¹æ®Šæ–¹æ³•</h5>
<ul>
<li><strong>ä¾›å†…ç½®å‡½æ•° str() è°ƒç”¨</strong>ï¼šè¿”å›<strong>å¯¹ç»ˆç«¯ç”¨æˆ·å‹å¥½</strong>çš„å­—ç¬¦ä¸²ã€‚</li>
<li>æœ‰æ—¶ï¼Œ<strong>repr</strong> æ–¹æ³•è¿”å›çš„å­—ç¬¦ä¸²è¶³å¤Ÿå‹å¥½ï¼Œæ— é¡»å†å®šä¹‰ __str__æ–¹æ³•ï¼Œå› ä¸ºç»§æ‰¿è‡ª object ç±»çš„å®ç°æœ€ç»ˆä¼šè°ƒç”¨ __repr__ æ–¹æ³•</li>
</ul>
<h5 id="3-repr-ä¸-str-çš„åŒºåˆ«">3.__repr__ ä¸ __str__ çš„åŒºåˆ«</h5>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109153141165.png" alt=""></p>
<h4 id="2-è‡ªå®šä¹‰ç±»å‹çš„å¸ƒå°”å€¼">&lt;2&gt;è‡ªå®šä¹‰ç±»å‹çš„å¸ƒå°”å€¼</h4>
<ul>
<li><strong>Python æœ‰ä¸€ä¸ª bool ç±»å‹ï¼Œåœ¨éœ€è¦å¸ƒå°”å€¼çš„åœ°æ–¹å¤„ç†å¯¹è±¡</strong>
<ul>
<li>å¦‚ï¼šif æˆ– while è¯­å¥çš„æ¡ä»¶è¡¨è¾¾å¼ï¼Œæˆ–è€… andã€or å’Œ not çš„è¿ç®—å¯¹è±¡ã€‚</li>
</ul>
</li>
<li><strong>ä¸ºäº†ç¡®å®š x è¡¨ç¤ºçš„å€¼ä¸º â€œçœŸâ€ æˆ–ä¸º â€œå‡â€ï¼ŒPython è°ƒç”¨ bool(x)ï¼Œè¿”å› True æˆ– Falseã€‚</strong></li>
<li><strong>é»˜è®¤æƒ…å†µä¸‹ï¼Œç”¨æˆ·å®šä¹‰ç±»çš„å®ä¾‹éƒ½æ˜¯çœŸå€¼ï¼Œé™¤éå®ç°äº† __bool__ æˆ– __len__ æ–¹æ³•</strong>
<ul>
<li><strong>å®ç°äº†__bool__ æ–¹æ³•</strong>ï¼šbool(x) è°ƒç”¨ x.__bool__()ï¼Œä»¥åè€…è¿”å›çš„ç»“æœä¸ºå‡†ã€‚</li>
<li><strong>æ²¡æœ‰å®ç° __bool__ æ–¹æ³•</strong>ï¼šåˆ™ Python å°è¯•è°ƒç”¨x.__len__()ï¼›
<ul>
<li>å¦‚æœè¯¥æ–¹æ³•è¿”å›é›¶å€¼ï¼Œåˆ™ bool å‡½æ•°è¿”å› Falseï¼Œå¦åˆ™è¿”å› True</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="3-è¡¥å……ï¼šPythonä¸­ï¼Œä¸‡ç‰©çš†å¯¹è±¡-â€”â€”-ä¸‡ç‰©çš†æœ‰å¸ƒå°”å€¼">&lt;3&gt;è¡¥å……ï¼šPythonä¸­ï¼Œä¸‡ç‰©çš†å¯¹è±¡ â€”â€”&gt; ä¸‡ç‰©çš†æœ‰å¸ƒå°”å€¼</h4>
<ul>
<li><strong>æœªå®ç°__bool__</strong>ï¼šå¸ƒå°”å€¼æ’ä¸ºTrue</li>
<li><strong>å®ç°äº†__bool__</strong>ï¼šä»¥x.__bool__()è°ƒç”¨ç»“æœä¸ºå‡†
<ul>
<li><strong>ç©ºå®¹å™¨ã€0ã€Noneã€Falseè¢«è§†ä¸ºå‡</strong></li>
<li><strong>å…¶ä»–å€¼è¢«è§†ä¸ºçœŸ</strong></li>
</ul>
</li>
</ul>
<h4 id="4-è‡ªå®šä¹‰API-ï¼ˆå…ˆäº†è§£ï¼Œå¯ä»¥ä¹‹åå†å›å¤´çœ‹ï¼‰">&lt;4&gt;è‡ªå®šä¹‰API ï¼ˆå…ˆäº†è§£ï¼Œå¯ä»¥ä¹‹åå†å›å¤´çœ‹ï¼‰</h4>
<p><strong>æœ¬èŠ‚ç®€è¦è¯´æ˜ Python ä¸­æœ€é‡è¦çš„å®¹å™¨æ¥å£ï¼Œçºµè§ˆå®¹å™¨ç±»å‹å¯¹ç‰¹æ®Šæ–¹æ³•<br>
çš„ä½¿ç”¨æƒ…å†µã€‚</strong><br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109154613470.png" alt=""><br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109154741486.png" alt=""></p>
<h1>ä¸‰ã€ç‰¹æ®Šæ–¹æ³•æ±‡æ€»è¡¨æ ¼</h1>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109155341846.png" alt=""><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109155359478.png" alt=""></p>
]]></content>
      <categories>
        <category>Python</category>
        <category>ã€Šæµç•…çš„pythonã€‹</category>
        <category>ç¬¬1ç«  Pythonæ•°æ®æ¨¡å‹</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>ç¬¬äºŒç« ï¼šä¸°å¯Œçš„åºåˆ—</title>
    <url>/2026/01/06/Python/%E3%80%8A%E6%B5%81%E7%95%85%E7%9A%84python%E3%80%8B/%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E4%B8%B0%E5%AF%8C%E7%9A%84%E5%BA%8F%E5%88%97/</url>
    <content><![CDATA[<h1>ä¸€ã€å†…ç½®åºåˆ—ç±»å‹æ¦‚è§ˆ</h1>
<h2 id="1-â€œåºåˆ—ç±»å‹â€æŒ‰å­˜æ”¾åˆ†ç±»">1.â€œåºåˆ—ç±»å‹â€æŒ‰å­˜æ”¾åˆ†ç±»</h2>
<h3 id="ï¼ˆ1ï¼‰å®¹å™¨åºåˆ—ï¼šlistã€tupleã€collections-deque">ï¼ˆ1ï¼‰å®¹å™¨åºåˆ—ï¼šlistã€tupleã€collections.deque</h3>
<ul>
<li>å¯å­˜æ”¾ä¸åŒç±»å‹çš„é¡¹</li>
<li>å­˜æ”¾çš„æ˜¯æ‰€åŒ…å«å¯¹è±¡çš„å¼•ç”¨ï¼Œå¯¹è±¡å¯ä»¥æ˜¯ä»»æ„ç±»å‹</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰æ‰å¹³åºåˆ—ï¼šstrã€bytesã€array-array">ï¼ˆ2ï¼‰æ‰å¹³åºåˆ—ï¼šstrã€bytesã€array.array</h3>
<ul>
<li>å¯å­˜æ”¾ä¸€ç§ç®€å•ç±»å‹çš„é¡¹</li>
<li>åœ¨è‡ªå·±çš„å†…å­˜ç©ºé—´ä¸­å­˜å‚¨æ‰€å«å†…å®¹çš„å€¼</li>
</ul>
<p><img src="/images/2026.1.6_1.png" alt="å†…å­˜ç®€å›¾"></p>
<h2 id="2-â€œåºåˆ—ç±»å‹â€æŒ‰å¯å˜æ€§åˆ†ç±»">2.â€œåºåˆ—ç±»å‹â€æŒ‰å¯å˜æ€§åˆ†ç±»</h2>
<h3 id="ï¼ˆ1ï¼‰å¯å˜åºåˆ—ï¼šlistã€collections-dequeã€bytearrayã€array-array">ï¼ˆ1ï¼‰å¯å˜åºåˆ—ï¼šlistã€collections.dequeã€bytearrayã€array.array</h3>
<ul>
<li>å¯å˜åºåˆ—ç»§æ‰¿ä¸å¯å˜åºåˆ—çš„æ‰€æœ‰æ–¹æ³•ï¼Œå¦å¤–è¿˜å¤šå®ç°äº†å‡ ä¸ªæ–¹æ³•</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰ä¸å¯å˜åºåˆ—ï¼štupleã€strã€bytes">ï¼ˆ2ï¼‰ä¸å¯å˜åºåˆ—ï¼štupleã€strã€bytes</h3>
<p><img src="/images/2026.1.6_2.png" alt="ç®€åŒ–UMLç±»å›¾"></p>
<hr>
<h1>äºŒã€â€œåˆ—è¡¨æ¨å¯¼å¼ï¼ˆlistcompsï¼‰â€å’Œâ€œç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼ˆgenexpsï¼‰â€</h1>
<ul>
<li>ä½¿ç”¨â€œåˆ—è¡¨æ¨å¯¼å¼â€æˆ–â€œç”Ÿæˆå™¨è¡¨è¾¾å¼â€å¯ä»¥å¿«é€Ÿæ„å»ºä¸€ä¸ªåºåˆ—</li>
<li>ä»£ç æ›´å®¹æ˜“ç†è§£ï¼Œé€Ÿåº¦é€šå¸¸æ›´å¿«</li>
</ul>
<h2 id="1-åˆ—è¡¨æ¨å¯¼å¼ï¼ˆç›®æ ‡ï¼šåˆ—è¡¨ï¼‰">1.åˆ—è¡¨æ¨å¯¼å¼ï¼ˆç›®æ ‡ï¼šåˆ—è¡¨ï¼‰</h2>
<h3 id="ï¼ˆ1ï¼‰åŸºæœ¬è¯­æ³•ç»“æ„ï¼š-expression-for-item-in-iterable-if-condition">ï¼ˆ1ï¼‰åŸºæœ¬è¯­æ³•ç»“æ„ï¼š [ expression for item in iterable [if condition] ]</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¾‹1ï¼šæ— if</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>symbols = <span class="string">&#x27;$Â¢Â£Â¥â‚¬Â¤&#x27;</span> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>codes = [<span class="built_in">ord</span>(symbol) <span class="keyword">for</span> symbol <span class="keyword">in</span> symbols] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>codes </span><br><span class="line">[<span class="number">36</span>, <span class="number">162</span>, <span class="number">163</span>, <span class="number">165</span>, <span class="number">8364</span>, <span class="number">164</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¾‹2ï¼šæœ‰if</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>symbols = <span class="string">&#x27;$Â¢Â£Â¥â‚¬Â¤&#x27;</span> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>beyond_ascii = [<span class="built_in">ord</span>(s) <span class="keyword">for</span> s <span class="keyword">in</span> symbols <span class="keyword">if</span> <span class="built_in">ord</span>(s) &gt; <span class="number">127</span>] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>beyond_ascii </span><br><span class="line">[<span class="number">162</span>, <span class="number">163</span>, <span class="number">165</span>, <span class="number">8364</span>, <span class="number">164</span>] </span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¾‹3ï¼šç”Ÿæˆâ€œç¬›å¡å°”ç§¯â€ï¼ˆåŒå¾ªç¯ï¼‰</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>colors = [<span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;white&#x27;</span>] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sizes = [<span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;L&#x27;</span>] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tshirts = [(color, size) <span class="keyword">for</span> color <span class="keyword">in</span> colors <span class="keyword">for</span> size <span class="keyword">in</span> sizes] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tshirts </span><br><span class="line">[(<span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;S&#x27;</span>), (<span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;M&#x27;</span>), (<span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;L&#x27;</span>), (<span class="string">&#x27;white&#x27;</span>, <span class="string">&#x27;S&#x27;</span>), </span><br><span class="line">    (<span class="string">&#x27;white&#x27;</span>, <span class="string">&#x27;M&#x27;</span>), (<span class="string">&#x27;white&#x27;</span>, <span class="string">&#x27;L&#x27;</span>)]</span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰å»ºè®®">ï¼ˆ2ï¼‰å»ºè®®</h3>
<ul>
<li>å¦‚æœä½ ä¸æ‰“ç®—ä½¿ç”¨ç”Ÿæˆçš„åˆ—è¡¨ï¼Œé‚£å°±ä¸è¦ä½¿ç”¨åˆ—è¡¨æ¨å¯¼å¼å¥æ³•ã€‚</li>
<li>åˆ—è¡¨æ¨å¯¼å¼åº”ä¿æŒç®€çŸ­ï¼Œå¦‚æœè¶…è¿‡ä¸¤è¡Œï¼Œæœ€å¥½æŠŠè¯­å¥æ‹†å¼€ï¼Œæˆ–è€…ä½¿ç”¨ä¼ ç»Ÿçš„ for å¾ªç¯é‡å†™</li>
</ul>
<h2 id="2-ç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼ˆç›®æ ‡ï¼šå…¶å®ƒåºåˆ—ç±»å‹ï¼‰">2.ç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼ˆç›®æ ‡ï¼šå…¶å®ƒåºåˆ—ç±»å‹ï¼‰</h2>
<h3 id="ï¼ˆ1ï¼‰æ¦‚è¿°">ï¼ˆ1ï¼‰æ¦‚è¿°</h3>
<ul>
<li>ç”Ÿæˆå™¨è¡¨è¾¾å¼çš„å¥æ³•è·Ÿåˆ—è¡¨æ¨å¯¼å¼å‡ ä¹ä¸€æ ·ï¼Œåªä¸è¿‡æŠŠæ–¹æ‹¬å·æ¢æˆåœ†æ‹¬å·è€Œå·²ã€‚</li>
<li>è™½ç„¶åˆ—è¡¨æ¨å¯¼å¼ä¹Ÿå¯ä»¥ç”Ÿæˆå…ƒç»„ã€æ•°ç»„æˆ–å…¶ä»–ç±»å‹çš„åºåˆ—ï¼Œä½†æ˜¯ç”Ÿæˆå™¨è¡¨è¾¾å¼å ç”¨çš„å†…å­˜æ›´å°‘ã€‚</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰åŸºæœ¬è¯­æ³•ï¼š-expression-for-item-in-iterable-if-condition">ï¼ˆ2ï¼‰åŸºæœ¬è¯­æ³•ï¼š(expression for item in iterable [if condition])</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¾‹1ï¼šæ„å»ºä¸€ä¸ªå…ƒç»„</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>symbols = <span class="string">&#x27;$Â¢Â£Â¥â‚¬Â¤&#x27;</span> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">tuple</span>(<span class="built_in">ord</span>(symbol) <span class="keyword">for</span> symbol <span class="keyword">in</span> symbols)</span><br><span class="line">(<span class="number">36</span>, <span class="number">162</span>, <span class="number">163</span>, <span class="number">165</span>, <span class="number">8364</span>, <span class="number">164</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¾‹2ï¼šæ„å»ºä¸€ä¸ªæ•°ç»„</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> array </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>array.array(<span class="string">&#x27;I&#x27;</span>, (<span class="built_in">ord</span>(symbol) <span class="keyword">for</span> symbol <span class="keyword">in</span> symbols))</span><br><span class="line">array(<span class="string">&#x27;I&#x27;</span>, [<span class="number">36</span>, <span class="number">162</span>, <span class="number">163</span>, <span class="number">165</span>, <span class="number">8364</span>, <span class="number">164</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¾‹3ï¼šç”Ÿæˆâ€œç¬›å¡å°”ç§¯â€</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>colors = [<span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;white&#x27;</span>] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sizes = [<span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;L&#x27;</span>] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> tshirt <span class="keyword">in</span> (<span class="string">f&#x27;<span class="subst">&#123;c&#125;</span> <span class="subst">&#123;s&#125;</span>&#x27;</span> <span class="keyword">for</span> c <span class="keyword">in</span> colors <span class="keyword">for</span> s <span class="keyword">in</span> sizes): </span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(tshirt) </span><br><span class="line"><span class="meta">... </span></span><br><span class="line">black S </span><br><span class="line">black M </span><br></pre></td></tr></table></figure>
<ul>
<li>å¦‚æœç”Ÿæˆå™¨è¡¨è¾¾å¼æ˜¯å‡½æ•°å”¯ä¸€çš„å‚æ•°ï¼Œåˆ™ä¸éœ€è¦é¢å¤–å†ä½¿ç”¨åœ†æ‹¬å·æ‹¬èµ·æ¥ã€‚</li>
<li>array æ„é€ å‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œå› æ­¤å¿…é¡»åœ¨ç”Ÿæˆå™¨è¡¨è¾¾å¼ä¸¤ä¾§åŠ ä¸Šåœ†æ‹¬å·ã€‚</li>
</ul>
<h2 id="3-ä¸¤è€…å¯¹æ¯”è¡¨">3.ä¸¤è€…å¯¹æ¯”è¡¨</h2>
<h3 id="ï¼ˆ1ï¼‰æ ¸å¿ƒç‰¹ç‚¹å¯¹æ¯”è¡¨">ï¼ˆ1ï¼‰æ ¸å¿ƒç‰¹ç‚¹å¯¹æ¯”è¡¨</h3>
<p><img src="/images/2026.1.6_4.png" alt="å¯¹æ¯”è¡¨"></p>
<h3 id="ï¼ˆ2ï¼‰ä½¿ç”¨åœºæ™¯å¯¹æ¯”è¡¨">ï¼ˆ2ï¼‰ä½¿ç”¨åœºæ™¯å¯¹æ¯”è¡¨</h3>
<p><img src="/images/2026.1.6_3.png" alt="å¯¹æ¯”è¡¨"></p>
<hr>
<h1>ä¸‰ã€å…ƒç»„ä¸ä»…ä»…æ˜¯ä¸å¯å˜åˆ—è¡¨</h1>
<h2 id="1-ç”¨ä½œè®°å½•">1.ç”¨ä½œè®°å½•</h2>
<ul>
<li>ç”¨å…ƒç»„å­˜æ”¾è®°å½•ï¼Œå…ƒç»„ä¸­çš„ä¸€é¡¹å¯¹åº”ä¸€ä¸ªå­—æ®µçš„æ•°æ®ï¼Œé¡¹çš„ä½ç½®å†³å®šæ•°æ®çš„æ„ä¹‰ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ´›æ‰çŸ¶å›½é™…æœºåœºçš„ç»çº¬åº¦ã€‚</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>lax_coordinates = (<span class="number">33.9425</span>, -<span class="number">118.408056</span>)</span><br><span class="line"><span class="comment"># </span></span><br><span class="line">&gt;&gt;&gt;traveler_ids = [(<span class="string">&#x27;USA&#x27;</span>, <span class="string">&#x27;31195855&#x27;</span>), (<span class="string">&#x27;BRA&#x27;</span>, <span class="string">&#x27;CE342567&#x27;</span>),(<span class="string">&#x27;ESP&#x27;</span>, <span class="string">&#x27;XDA205856&#x27;</span>)] </span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> passport <span class="keyword">in</span> <span class="built_in">sorted</span>(traveler_ids): </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;%s/%s&#x27;</span> % passport)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> country, _ <span class="keyword">in</span> traveler_ids:  â» </span><br><span class="line">        <span class="built_in">print</span>(country) </span><br></pre></td></tr></table></figure>
<ul>
<li>% æ ¼å¼åŒ–è¿ç®—ç¬¦ç†è§£å…ƒç»„ç»“æ„ï¼ŒæŠŠæ¯ä¸€é¡¹å½“ä½œä¸åŒçš„å­—æ®µã€‚</li>
<li>for å¾ªç¯çŸ¥é“å¦‚ä½•è·å–å…ƒç»„ä¸­å•ç‹¬çš„æ¯ä¸€é¡¹ï¼Œè¿™å«**â€œå…ƒç»„æ‹†åŒ…â€**ã€‚è¿™é‡Œå¯¹ç¬¬äºŒé¡¹ä¸æ„Ÿå…´è¶£ï¼ŒæŠŠå®ƒèµ‹å€¼ç»™è™šæ‹Ÿå˜é‡ã€‚</li>
</ul>
<h2 id="2-ç”¨ä½œä¸å¯å˜åˆ—è¡¨">2.ç”¨ä½œä¸å¯å˜åˆ—è¡¨</h2>
<h3 id="ï¼ˆ1ï¼‰å¥½å¤„">ï¼ˆ1ï¼‰å¥½å¤„</h3>
<p>1.æ„å›¾æ¸…æ™°ï¼šåªè¦åœ¨æºç ä¸­è§åˆ°å…ƒç»„ï¼Œå°±çŸ¥é“å®ƒçš„é•¿åº¦æ°¸ä¸å¯å˜ã€‚<br>
2.æ€§èƒ½ä¼˜è¶Šï¼šé•¿åº¦ç›¸åŒçš„å…ƒç»„å’Œåˆ—è¡¨ï¼Œå…ƒç»„å ç”¨çš„å†…å­˜æ›´å°‘ï¼Œè€Œä¸” Python å¯å¯¹<br>
å…ƒç»„åšäº›ä¼˜åŒ–ã€‚</p>
<h3 id="ï¼ˆ2ï¼‰æ³¨æ„ç‚¹ï¼š">ï¼ˆ2ï¼‰æ³¨æ„ç‚¹ï¼š</h3>
<p>å…ƒç»„çš„ä¸å¯å˜æ€§ä»…é’ˆå¯¹å…ƒç»„ä¸­çš„å¼•ç”¨è€Œè¨€ã€‚å…ƒç»„ä¸­çš„<br>
å¼•ç”¨ä¸å¯åˆ é™¤ã€ä¸å¯æ›¿æ¢ã€‚å€˜è‹¥å¼•ç”¨çš„æ˜¯å¯å˜å¯¹è±¡ï¼Œæ”¹åŠ¨å¯¹è±¡ä¹‹åï¼Œå…ƒ<br>
ç»„çš„å€¼ä¹Ÿä¼šéšä¹‹å˜åŒ–ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹ b ä¸­çš„æœ€åä¸€é¡¹ï¼Œb å’Œ a ä¸ç›¸ç­‰äº†ã€‚</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = (<span class="number">10</span>, <span class="string">&#x27;alpha&#x27;</span>, [<span class="number">1</span>, <span class="number">2</span>]) </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = (<span class="number">10</span>, <span class="string">&#x27;alpha&#x27;</span>, [<span class="number">1</span>, <span class="number">2</span>]) </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a == b </span><br><span class="line"><span class="literal">True</span> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b[-<span class="number">1</span>].append(<span class="number">99</span>) </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a == b </span><br><span class="line"><span class="literal">False</span> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b </span><br><span class="line">(<span class="number">10</span>, <span class="string">&#x27;alpha&#x27;</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">99</span>])</span><br></pre></td></tr></table></figure>
<h2 id="3-åˆ—è¡¨å’Œå…ƒç»„æ–¹æ³•çš„æ¯”è¾ƒ">3.åˆ—è¡¨å’Œå…ƒç»„æ–¹æ³•çš„æ¯”è¾ƒ</h2>
<p><img src="/images/2026.1.6_5.png" alt="æ¯”è¾ƒå›¾"><br>
<img src="/images/2026.1.6_6.png" alt="æ¯”è¾ƒå›¾"></p>
<hr>
<h1>å››ã€åºåˆ—å’Œå¯è¿­ä»£å¯¹è±¡æ‹†åŒ…</h1>
<p><strong>æ‹†åŒ…çš„ç‰¹ç‚¹æ˜¯ä¸ç”¨æˆ‘ä»¬è‡ªå·±åŠ¨æ‰‹é€šè¿‡ç´¢å¼•ä»åºåˆ—ä¸­æå–å…ƒç´ ï¼Œè¿™æ ·å°±å‡å°‘äº†å‡ºé”™çš„å¯èƒ½ã€‚</strong></p>
<h2 id="1-å¹¶è¡Œèµ‹å€¼">1.å¹¶è¡Œèµ‹å€¼</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>lax_coordinates = (<span class="number">33.9425</span>, -<span class="number">118.408056</span>) </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>latitude, longitude = lax_coordinates  <span class="comment"># æ‹†åŒ… </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>latitude </span><br><span class="line"><span class="number">33.9425</span> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>longitud</span><br></pre></td></tr></table></figure>
<h2 id="2-è°ƒç”¨å‡½æ•°æ—¶åœ¨å‚æ•°å‰é¢åŠ ä¸Šä¸€ä¸ª">2.è°ƒç”¨å‡½æ•°æ—¶åœ¨å‚æ•°å‰é¢åŠ ä¸Šä¸€ä¸ª *</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">divmod</span>(<span class="number">20</span>, <span class="number">8</span>) </span><br><span class="line">(<span class="number">2</span>, <span class="number">4</span>) </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = (<span class="number">20</span>, <span class="number">8</span>) </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">divmod</span>(*t) </span><br><span class="line">(<span class="number">2</span>, <span class="number">4</span>) </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>quotient, remainder = <span class="built_in">divmod</span>(*t) </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>quotient, remainder </span><br><span class="line">(<span class="number">2</span>, <span class="number">4</span>)</span><br></pre></td></tr></table></figure>
<h2 id="3-ä½¿ç”¨-è·å–ä½™ä¸‹çš„é¡¹">3.ä½¿ç”¨ * è·å–ä½™ä¸‹çš„é¡¹</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a, b, *rest = <span class="built_in">range</span>(<span class="number">5</span>) </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a, b, rest </span><br><span class="line">(<span class="number">0</span>, <span class="number">1</span>, [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]) </span><br></pre></td></tr></table></figure>
<p><strong>æ³¨</strong>ï¼š * å‰ç¼€åªèƒ½åº”ç”¨åˆ°ä¸€ä¸ªå˜é‡ä¸Šï¼Œä¸è¿‡å¯ä»¥æ˜¯ä»»ä½•ä½ç½®ä¸Šçš„å˜é‡ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a, *body, c, d = <span class="built_in">range</span>(<span class="number">5</span>) </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a, body, c, d </span><br><span class="line">(<span class="number">0</span>, [<span class="number">1</span>, <span class="number">2</span>], <span class="number">3</span>, <span class="number">4</span>) </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>*head, b, c, d = <span class="built_in">range</span>(<span class="number">5</span>) </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>head, b, c, d </span><br><span class="line">([<span class="number">0</span>, <span class="number">1</span>], <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br></pre></td></tr></table></figure>
<h2 id="4-åœ¨å‡½æ•°è°ƒç”¨å’Œåºåˆ—å­—é¢é‡ä¸­ä½¿ç”¨-æ‹†åŒ…">4.åœ¨å‡½æ•°è°ƒç”¨å’Œåºåˆ—å­—é¢é‡ä¸­ä½¿ç”¨ * æ‹†åŒ…</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¾‹1ï¼šåœ¨å‡½æ•°è°ƒç”¨ä¸­å¯ä»¥å¤šæ¬¡ä½¿ç”¨ *</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">fun</span>(<span class="params">a, b, c, d, *rest</span>): </span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> a, b, c, d, rest </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fun(*[<span class="number">1</span>, <span class="number">2</span>], <span class="number">3</span>, *<span class="built_in">range</span>(<span class="number">4</span>, <span class="number">7</span>)) </span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, (<span class="number">5</span>, <span class="number">6</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¾‹2ï¼šå®šä¹‰åˆ—è¡¨ã€å…ƒç»„æˆ–é›†åˆå­—é¢é‡æ—¶ï¼Œä½¿ç”¨ *</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>*<span class="built_in">range</span>(<span class="number">4</span>), <span class="number">4</span> </span><br><span class="line">(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>) </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[*<span class="built_in">range</span>(<span class="number">4</span>), <span class="number">4</span>] </span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>&#123;*<span class="built_in">range</span>(<span class="number">4</span>), <span class="number">4</span>, *(<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>)&#125; </span><br><span class="line">&#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>&#125;</span><br></pre></td></tr></table></figure>
<h2 id="5-åµŒå¥—æ‹†åŒ…">5.åµŒå¥—æ‹†åŒ…</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt;nested_tuple = ((<span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="number">25</span>), (<span class="string">&quot;æå››&quot;</span>, <span class="number">30</span>))</span><br><span class="line">&gt;&gt;&gt;(name1, age1), (name2, age2) = nested_tuple</span><br></pre></td></tr></table></figure>
<hr>
<h1>äº”ã€åºåˆ—æ¨¡å¼åŒ¹é…ï¼ˆmatch/caseï¼‰</h1>
<h2 id="1-ç¤ºä¾‹1">1.ç¤ºä¾‹1</h2>
<p><img src="/images/2026.1.6_7.png" alt="å›¾ç‰‡"><br>
<img src="/images/2026.1.6_8.png" alt="å›¾ç‰‡"></p>
<h2 id="2-ç¤ºä¾‹2">2.ç¤ºä¾‹2</h2>
<p><img src="/images/2026.1.6_9.png" alt="å›¾ç‰‡"><br>
<img src="/images/2026.1.6_10.png" alt="å›¾ç‰‡"></p>
<h2 id="3-ç¤ºä¾‹3ï¼šaså…³é”®å­—ç»‘å®šå˜é‡">3.ç¤ºä¾‹3ï¼šaså…³é”®å­—ç»‘å®šå˜é‡</h2>
<p><img src="/images/2026.1.6_11.png" alt="å›¾ç‰‡"></p>
<h2 id="4-ç¤ºä¾‹4ï¼šæ·»åŠ ç±»å‹ä¿¡æ¯å¯ä»¥è®©æ¨¡å¼æ›´å…·ä½“">4.ç¤ºä¾‹4ï¼šæ·»åŠ ç±»å‹ä¿¡æ¯å¯ä»¥è®©æ¨¡å¼æ›´å…·ä½“</h2>
<p><img src="/images/2026.1.6_12.png" alt="å›¾ç‰‡"></p>
<h2 id="5-ç¤ºä¾‹5ï¼š-åŒ¹é…ä»»æ„æ•°é‡çš„é¡¹">5.ç¤ºä¾‹5ï¼š*_ åŒ¹é…ä»»æ„æ•°é‡çš„é¡¹</h2>
<ul>
<li>åŒ¹é…ä»»ä½•ä»¥å­—ç¬¦ä¸²å¼€å¤´ã€ä»¥åµŒå¥—ä¸¤ä¸ªæµ®ç‚¹æ•°çš„åºåˆ—ç»“å°¾çš„åºåˆ—<br>
<img src="/images/2026.1.6_13.png" alt="å›¾ç‰‡"></li>
</ul>
<h2 id="6-ç¤ºä¾‹6ï¼šifè¯­å¥">6.ç¤ºä¾‹6ï¼šifè¯­å¥</h2>
<p><img src="/images/2026.1.6_14.png" alt="å›¾ç‰‡"></p>
<hr>
<h1>å…­ã€åˆ‡ç‰‡</h1>
<h2 id="1-ä¸ºä»€ä¹ˆåˆ‡ç‰‡å’ŒåŒºé—´æ’é™¤æœ€åä¸€é¡¹ï¼Ÿ">1.ä¸ºä»€ä¹ˆåˆ‡ç‰‡å’ŒåŒºé—´æ’é™¤æœ€åä¸€é¡¹ï¼Ÿ</h2>
<p><img src="/images/2026.1.6_15.png" alt="è§£æ"></p>
<h2 id="2-åˆ‡ç‰‡å¯¹è±¡slice">2.åˆ‡ç‰‡å¯¹è±¡slice</h2>
<h3 id="ï¼ˆ1ï¼‰seq-start-stop-step-å¥æ³•-â€”â€”-æŒ‡å®šæ­¥è·stepï¼Œè®©åˆ‡ç‰‡æ“ä½œè·³è¿‡éƒ¨åˆ†é¡¹ã€‚æ­¥è·ä¹Ÿå¯ä»¥æ˜¯è´Ÿæ•°ï¼Œåå‘è¿”å›é¡¹ã€‚">ï¼ˆ1ï¼‰seq[start:stop:step] å¥æ³• â€”â€”&gt;æŒ‡å®šæ­¥è·stepï¼Œè®©åˆ‡ç‰‡æ“ä½œè·³è¿‡éƒ¨åˆ†é¡¹ã€‚æ­¥è·ä¹Ÿå¯ä»¥æ˜¯è´Ÿæ•°ï¼Œåå‘è¿”å›é¡¹ã€‚</h3>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">&#x27;bicycle&#x27;</span> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[::<span class="number">3</span>] </span><br><span class="line"><span class="string">&#x27;bye&#x27;</span> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[::-<span class="number">1</span>] </span><br><span class="line"><span class="string">&#x27;elcycib&#x27;</span> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[::-<span class="number">2</span>] </span><br><span class="line"><span class="string">&#x27;eccb&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="ï¼ˆ2ï¼‰å‘½ååˆ‡ç‰‡">ï¼ˆ2ï¼‰å‘½ååˆ‡ç‰‡</h3>
<p><img src="/images/2026.1.6_16.png" alt="ç¤ºä¾‹"></p>
<h3 id="ï¼ˆ3ï¼‰å¤šç»´åˆ‡ç‰‡å’Œçœç•¥å·">ï¼ˆ3ï¼‰å¤šç»´åˆ‡ç‰‡å’Œçœç•¥å·</h3>
<p><img src="/images/2026.1.6_17.png" alt="å›¾ç‰‡"><br>
<img src="/images/2026.1.6_18.png" alt="å›¾ç‰‡"></p>
<h3 id="ï¼ˆ4ï¼‰ä¸ºåˆ‡ç‰‡èµ‹å€¼">ï¼ˆ4ï¼‰ä¸ºåˆ‡ç‰‡èµ‹å€¼</h3>
<p>1.åœ¨èµ‹å€¼è¯­å¥çš„å·¦ä¾§ä½¿ç”¨åˆ‡ç‰‡è¡¨ç¤ºæ³•ï¼Œæˆ–è€…ä½œä¸º del è¯­å¥çš„ç›®æ ‡ï¼Œå¯ä»¥å°±<br>
åœ°ç§»æ¤ã€åˆ‡é™¤æˆ–ä»¥å…¶ä»–æ–¹å¼ä¿®æ”¹å¯å˜åºåˆ—ã€‚<br>
2.å¦‚æœèµ‹å€¼ç›®æ ‡æ˜¯ä¸€ä¸ªåˆ‡ç‰‡ï¼Œåˆ™å³è¾¹å¿…é¡»æ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œå³ä½¿åªæœ‰<br>
ä¸€é¡¹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>l = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">10</span>)) </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l </span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l[<span class="number">2</span>:<span class="number">5</span>] = [<span class="number">20</span>, <span class="number">30</span>] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l </span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> l[<span class="number">5</span>:<span class="number">7</span>] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l </span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">9</span>] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l[<span class="number">3</span>::<span class="number">2</span>] = [<span class="number">11</span>, <span class="number">22</span>] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l </span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">20</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">22</span>, <span class="number">9</span>] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l[<span class="number">2</span>:<span class="number">5</span>] = <span class="number">100</span>  â¶ </span><br><span class="line">Traceback (most recent call last): </span><br><span class="line">    File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt; </span><br><span class="line">TypeError: can only assign an iterable </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l[<span class="number">2</span>:<span class="number">5</span>] = [<span class="number">100</span>] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l </span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">100</span>, <span class="number">22</span>, <span class="number">9</span>]</span><br></pre></td></tr></table></figure>
<h1>ä¸ƒã€ä½¿ç”¨ + å’Œ * å¤„ç†åºåˆ—</h1>
<h2 id="1-æ¦‚è¿°">1.æ¦‚è¿°</h2>
<p>1.é€šå¸¸ï¼Œ+ çš„ä¸¤ä¸ªè¿ç®—å¯¹è±¡å¿…é¡»æ˜¯åŒä¸€ç§åºåˆ—ï¼Œè€Œä¸”éƒ½ä¸å¯ä¿®æ”¹ï¼Œæ‹¼æ¥çš„ç»“æœæ˜¯ä¸€ä¸ªåŒç±»å‹çš„æ–°åºåˆ—ã€‚<br>
2.å¦‚æœæƒ³å¤šæ¬¡æ‹¼æ¥åŒä¸€ä¸ªåºåˆ—ï¼Œå¯ä»¥ä¹˜ä»¥ä¸€ä¸ªæ•´æ•°<br>
3.+ å’Œ * å§‹ç»ˆåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œç»ä¸æ›´æ”¹æ“ä½œæ•°ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>l = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l * <span class="number">5</span> </span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">5</span> * <span class="string">&#x27;abcd&#x27;</span> </span><br><span class="line"><span class="string">&#x27;abcdabcdabcdabcdabcd&#x27;</span></span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„</strong>ï¼š<br>
<img src="/images/2026.1.6_19.png" alt="å›¾ç‰‡"></p>
<h2 id="2-æ„å»ºåµŒå¥—åˆ—è¡¨">2.æ„å»ºåµŒå¥—åˆ—è¡¨</h2>
<p><img src="/images/2026.1.6_20.png" alt="å›¾ç‰‡"><br>
<img src="/images/2026.1.6_21.png" alt="å›¾ç‰‡"><br>
<strong>ä¸ç†è§£æœ¬èŠ‚æ‰€è®²çš„é—®é¢˜æˆ–è§£å†³æ–¹æ¡ˆï¼Œæ²¡å…³ç³»â€”â€”&gt;ç¬¬ 6 ç« <br>
å°±æ˜¯ä¸ºäº†é˜æ˜å¼•ç”¨å’Œå¯å˜å¯¹è±¡çš„æœºåˆ¶å’Œé™·é˜±è€Œç¼–å†™çš„ã€‚</strong></p>
<h2 id="3-ä½¿ç”¨å¢é‡èµ‹å€¼è¿ç®—ç¬¦å¤„ç†åºåˆ—">3.ä½¿ç”¨å¢é‡èµ‹å€¼è¿ç®—ç¬¦å¤„ç†åºåˆ—</h2>
<p>1.å¢é‡èµ‹å€¼è¿ç®—ç¬¦ += å’Œ *= çš„è¡Œä¸ºå·®å¼‚è¾ƒå¤§,<br>
2.ï¼Œæœ¬èŠ‚é‡ç‚¹å…³æ³¨å¢é‡åŠ æ³•è¿ç®—ç¬¦ï¼ˆ+=ï¼‰ï¼Œä¸è¿‡ç›¸å…³æ¦‚å¿µä¹Ÿ<br>
é€‚ç”¨äº * = å’Œå…¶ä»–å¢é‡èµ‹å€¼è¿ç®—ç¬¦</p>
<h3 id="ï¼ˆ1ï¼‰-è¿ç®—ç¬¦">ï¼ˆ1ï¼‰+= è¿ç®—ç¬¦</h3>
<p>1.èƒŒåæ”¯æŒ += è¿ç®—ç¬¦çš„æ˜¯ç‰¹æ®Šæ–¹æ³• __iadd__ï¼ˆå°±åœ°ç›¸åŠ ï¼‰<br>
2.å¦‚æœæ²¡æœ‰å®ç° __iadd__ï¼Œé‚£ä¹ˆ Python è½¬è€Œè°ƒç”¨ __add__<br>
<img src="/images/2026.1.6_22.png" alt="å›¾ç‰‡"></p>
<h3 id="ï¼ˆ2ï¼‰ä¸€ä¸ª-è¿ç®—ç¬¦èµ‹å€¼è°œé¢˜">ï¼ˆ2ï¼‰ä¸€ä¸ª += è¿ç®—ç¬¦èµ‹å€¼è°œé¢˜</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109095902220.png" alt=""><br>
è§£æï¼š</p>
<ul>
<li>1.å¦‚æœtå®ç°äº†â€œ<em>iadd</em>â€,åˆ™t[2]+=[50,60]åï¼Œt[2]è¿˜æ˜¯åŸæ¥å¯¹è±¡çš„å¼•ç”¨ï¼Œæ•…Aæ­£ç¡®</li>
<li>2.å¦‚æœtæ²¡æœ‰å®ç°â€<em>iadd</em>â€œ,åˆ™t[2]+=[50,60]åï¼Œt[2]ä¸åœ¨æ˜¯åŸæ¥å¯¹è±¡çš„å¼•ç”¨ï¼Œè¿åäº†â€å…ƒç»„ä¸­å…ƒç´ å¼•ç”¨æŒ‡å‘ä¸å¯å˜â€œ
<ul>
<li><strong>æ³¨</strong>ï¼šè¿™é‡Œçš„ä¸å¯å˜ï¼ŒæŒ‡â€å¼•ç”¨çš„æŒ‡å‘â€œä¸å¯å˜ï¼Œä½†å¼•ç”¨å¯¹è±¡æœ¬èº«å¯å˜</li>
</ul>
</li>
</ul>
<h1>å…«ã€list.sort ä¸ å†…ç½®å‡½æ•°sorted</h1>
<p><strong>æ¥æ”¶è€…</strong>ï¼šè¢«è°ƒç”¨çš„å¯¹è±¡æœ¬èº«<br>
<strong>æ³¨æ„</strong>ï¼šæœ¬èŠ‚æ‰€è®²çš„å†…å®¹å¤§éƒ½é€‚ç”¨äºä¸€èˆ¬æ„ä¹‰ä¸Šçš„åºåˆ—ï¼Œä¸ä»…é™äºåˆ—è¡¨å’Œå…ƒ<br>
ç»„ã€‚</p>
<h2 id="1-list-sort">1.list.sort</h2>
<ul>
<li><strong>â€œå°±åœ°æ’åºâ€åˆ—è¡¨</strong>ï¼šæ›´æ”¹æ¥æ”¶è€…æœ¬èº«ï¼Œä¸åˆ›å»ºå‰¯æœ¬ï¼Œè¿”å›å€¼ä¸ºâ€œNoneâ€</li>
<li><strong>Python APIçš„ä¸€ä¸ªé‡è¦çº¦å®š</strong>ï¼šâ€œå°±åœ°æ›´æ”¹å¯¹è±¡â€çš„å‡½æ•°æˆ–æ–¹æ³•åº”è¯¥<strong>è¿”å›None</strong>ï¼Œè®©è°ƒç”¨è€…æ¸…æ™°åœ°çŸ¥é“æ¥å—è€…å·²è¢«æ›´æ”¹ï¼Œæ²¡æœ‰åˆ›å»ºå¯¹è±¡
<ul>
<li>ä¾‹å¦‚ï¼šrandom.shuffle(s)å‡½æ•°ä¹Ÿæœ‰ç±»ä¼¼çš„è¡Œä¸ºï¼šå°±åœ°æ··æ´—å¯å˜åºåˆ—sï¼Œè¿”å›None</li>
</ul>
</li>
<li><strong>â€œå°±åœ°æ›´æ”¹â€çš„ç¼ºç‚¹</strong>ï¼šä¸èƒ½â€œçº§è”è°ƒç”¨â€</li>
</ul>
<h2 id="2-å†…ç½®å‡½æ•°sorted">2.å†…ç½®å‡½æ•°sorted</h2>
<ul>
<li><strong>è¿”å›åˆ›å»ºæ–°åˆ—è¡¨</strong>ï¼šæ¥æ”¶ä»»ä½•å¯è¿­ä»£å¯¹è±¡ä½œä¸ºå‚æ•°ï¼ŒåŒ…æ‹¬ä¸å¯å˜åºåˆ—å’Œç”Ÿæˆå™¨ï¼Œæ—¶é’Ÿè¿”å›æ–°åˆ›å»ºçš„åˆ—è¡¨</li>
<li>å¯ä»¥çº§è”ä½¿ç”¨</li>
</ul>
<h2 id="3-ä¸¤è€…å…±åŒçš„â€œè¡Œä¸ºå‚æ•°â€">3.ä¸¤è€…å…±åŒçš„â€œè¡Œä¸ºå‚æ•°â€</h2>
<p><strong>list.sortå’Œsortå‡æ¥å—â€œä¸¤ä¸ªå¯é€‰çš„å…³é”®å­—â€å‚æ•°</strong></p>
<h3 id="ï¼ˆ1ï¼‰reverse">ï¼ˆ1ï¼‰reverse</h3>
<ul>
<li><strong>å€¼ä¸ºFalse</strong>ï¼šå‡åºè¿”å›é¡¹ï¼ˆâ€œé»˜è®¤å€¼â€ï¼‰</li>
<li><strong>å€¼ä¸ºTrue</strong>ï¼šé™åºè¿”å›é¡¹</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰key">ï¼ˆ2ï¼‰key</h3>
<ul>
<li>ä¸€ä¸ªåªæ¥å—ä¸€ä¸ªå‚æ•°çš„å‡½æ•° â€”â€”&gt; åº”ç”¨åˆ°æ¯ä¸€ä¸ªé¡¹ä¸Šï¼Œä½œä¸º<strong>æ’åºä¾æ®</strong>ï¼Œä¾‹å¦‚ï¼š
<ul>
<li>key=str.lowerï¼šæ‰§è¡Œä¸åŒºåˆ†å¤§å°å†™æ’åºï¼ˆstr.loweræ˜¯ä¸€ä¸ªåªæ¥å—ä¸€ä¸ªå‚æ•°çš„å‡½æ•°ï¼‰</li>
<li>key=lenï¼šæŒ‰å­—ç¬¦é•¿åº¦æ’åºå„ä¸ªå­—ç¬¦ä¸²ã€‚</li>
<li><strong>keyçš„é»˜è®¤å€¼</strong>ï¼šâ€œæ’ç­‰å‡½æ•°â€ï¼Œå³æ¯”è¾ƒé¡¹æœ¬èº«</li>
</ul>
</li>
</ul>
<h2 id="4-ä½¿ç”¨ä¾‹å­">4.ä½¿ç”¨ä¾‹å­</h2>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109104257243.png" alt=""></p>
<h1>ä¹ã€å½“åˆ—è¡¨ä¸é€‚ç”¨æ—¶</h1>
<p><strong>list ç±»å‹ç®€å•çµæ´»ï¼Œä¸è¿‡ï¼Œé’ˆå¯¹å…·ä½“çš„éœ€æ±‚ï¼Œæˆ–è®¸è¿˜æœ‰æ›´å¥½çš„é€‰æ‹©ã€‚</strong></p>
<ul>
<li><strong>æ•°ç»„</strong>ï¼šå¤„ç†ä¸Šç™¾ä¸‡ä¸ªæµ®ç‚¹å€¼å¯ä»¥èŠ‚çœå¤§é‡å†…å­˜</li>
<li><strong>deque</strong>ï¼šå¤„ç†éœ€è¦åœ¨åˆ—è¡¨çš„ä¸¤ç«¯æ·»åŠ å’Œåˆ é™¤é¡¹</li>
<li><strong>set</strong>ï¼šåœ¨è¾ƒå¤šé¡¹æ•°æ—¶æ£€æŸ¥å®¹å™¨ä¸­æ˜¯å¦å­˜åœ¨æŸä¸€é¡¹</li>
</ul>
<h2 id="1-æ•°ç»„">1.æ•°ç»„</h2>
<h3 id="ï¼ˆ1ï¼‰æ¦‚è¿°-2">ï¼ˆ1ï¼‰æ¦‚è¿°</h3>
<ul>
<li>å¦‚æœä¸€ä¸ªåˆ—è¡¨åªåŒ…å«æ•°å€¼ï¼Œé‚£ä¹ˆä½¿ç”¨ array.array ä¼šæ›´é«˜æ•ˆ</li>
<li>æ•°ç»„æ”¯<br>
æŒæ‰€æœ‰å¯å˜åºåˆ—æ“ä½œï¼ˆåŒ…æ‹¬ .popã€.insert å’Œ .extendï¼‰</li>
<li>æ•°ç»„è¿˜<br>
æœ‰å¿«é€ŸåŠ è½½é¡¹å’Œä¿å­˜é¡¹çš„æ–¹æ³•ï¼Œä¾‹å¦‚ .frombytes å’Œ .tofile</li>
<li><strong>ä¸å…è®¸å‘æ•°ç»„ä¸­æ·»åŠ ä¸æŒ‡å®šç±»å‹ä¸åŒçš„å€¼</strong></li>
</ul>
<h3 id="ï¼ˆ2ï¼‰ä½¿ç”¨">ï¼ˆ2ï¼‰ä½¿ç”¨</h3>
<p><strong>åˆ›å»ºarray å¯¹è±¡æ—¶è¦æä¾›ç±»å‹ä»£ç ï¼Œå®ƒæ˜¯ä¸€ä¸ªå­—æ¯ï¼Œç”¨æ¥ç¡®å®šåº•å±‚ä½¿ç”¨ä»€ä¹ˆ C ç±»å‹å­˜å‚¨æ•°ç»„ä¸­å„é¡¹ã€‚</strong></p>
<ul>
<li>ä¾‹å¦‚ï¼šç±»å‹ä»£ç  b å¯¹åº” C è¯­è¨€ä¸­çš„ signed char ç±»å‹ï¼Œå³å–å€¼èŒƒå›´æ˜¯ -128~127 çš„æ•´æ•°</li>
</ul>
<h4 id="ç¤ºä¾‹ï¼šåˆ›å»ºä¸€ä¸ªå«æœ‰-1000-ä¸‡ä¸ªéšæœºæµ®ç‚¹æ•°çš„æ•°ç»„ï¼ŒæŠŠè¿™äº›æµ®ç‚¹æ•°å­˜å…¥æ–‡ä»¶ï¼Œå†ä»æ–‡ä»¶ä¸­è¯»å–å‡ºæ¥ã€‚">ç¤ºä¾‹ï¼šåˆ›å»ºä¸€ä¸ªå«æœ‰ 1000 ä¸‡ä¸ªéšæœºæµ®ç‚¹æ•°çš„æ•°ç»„ï¼ŒæŠŠè¿™äº›æµ®ç‚¹æ•°å­˜å…¥æ–‡ä»¶ï¼Œå†ä»æ–‡ä»¶ä¸­è¯»å–å‡ºæ¥ã€‚</h4>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109110350348.png" alt=""></p>
<p><strong>è¡¥å……ï¼š</strong><br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109110106804.png" alt=""></p>
<h3 id="ï¼ˆ3ï¼‰list-å’Œ-array-çš„åŠŸèƒ½å¯¹æ¯”">ï¼ˆ3ï¼‰list å’Œ array çš„åŠŸèƒ½å¯¹æ¯”</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109112208269.png" alt=""><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109112226325.png" alt=""><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109112243893.png" alt=""><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109112305765.png" alt=""><br>
<img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109112416245.png" alt=""></p>
<h2 id="2-memoryview">2.memoryview</h2>
<h3 id="ï¼ˆ1ï¼‰æ¦‚è¿°-3">ï¼ˆ1ï¼‰æ¦‚è¿°</h3>
<ul>
<li>memoryview ç±»æ˜¯ä¸€ç§<strong>å…±äº«å†…å­˜</strong>çš„åºåˆ—ç±»å‹</li>
<li>memoryview åœ¨æ•°æ®ç»“æ„<br>
ï¼ˆä¾‹å¦‚ PIL å›¾åƒã€SQLite æ•°æ®åº“ã€NumPy æ•°ç»„ç­‰ï¼‰ä¹‹é—´å…±äº«å†…<br>
å­˜ï¼Œè€Œä¸æ˜¯äº‹å…ˆå¤åˆ¶ã€‚è¿™å¯¹å¤§å‹æ•°æ®é›†æ¥è¯´éå¸¸é‡è¦</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰ä½¿ç”¨ç¤ºä¾‹">ï¼ˆ2ï¼‰ä½¿ç”¨ç¤ºä¾‹</h3>
<p><strong>memoryview.cast æ–¹æ³•</strong>ï¼šæ˜¯æ”¹<br>
å˜è¯»å†™å¤šå­—èŠ‚å•å…ƒçš„æ–¹å¼ï¼Œæ— é¡»ç§»åŠ¨ä½ã€‚</p>
<h4 id="1-å°†åŒä¸€ä¸ª-6-å­—èŠ‚æ•°ç»„å¤„ç†ä¸ºä¸åŒçš„è§†å›¾ï¼Œåˆ†åˆ«ä»¥-1Ã—6ã€2Ã—3-å’Œ-3Ã—2-çŸ©é˜µçš„è§†å›¾å¤„ç†-6-å­—èŠ‚å†…å­˜">&lt;1&gt;å°†åŒä¸€ä¸ª 6 å­—èŠ‚æ•°ç»„å¤„ç†ä¸ºä¸åŒçš„è§†å›¾ï¼Œåˆ†åˆ«ä»¥ 1Ã—6ã€2Ã—3 å’Œ 3Ã—2 çŸ©é˜µçš„è§†å›¾å¤„ç† 6 å­—èŠ‚å†…å­˜</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> array <span class="keyword">import</span> array </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>octets = array(<span class="string">&#x27;B&#x27;</span>, <span class="built_in">range</span>(<span class="number">6</span>))  <span class="comment"># åˆ›å»ºBç±»å‹ï¼ˆ1å­—èŠ‚æ— ç¬¦å·å­—ç¬¦ï¼‰çš„arrayæ•°ç»„ï¼Œå…ƒç´ æ˜¯0-5ï¼Œå…±6å­—èŠ‚è¿ç»­å†…å­˜</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m1 = <span class="built_in">memoryview</span>(octets)  <span class="comment"># åˆ›å»ºoctetsçš„å†…å­˜è§†å›¾ï¼ŒæŒ‡å‘åŒä¸€å—6å­—èŠ‚å†…å­˜ï¼Œé»˜è®¤ä¸€ç»´ï¼Œæ ¼å¼ä¸º&#x27;B&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m1.tolist()  <span class="comment"># å°†å†…å­˜è§†å›¾è½¬ä¸ºåˆ—è¡¨ï¼Œç›´è§‚æŸ¥çœ‹æ•°æ®</span></span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m2 = m1.cast(<span class="string">&#x27;B&#x27;</span>, [<span class="number">2</span>, <span class="number">3</span>])  <span class="comment"># é›¶æ‹·è´è½¬æ¢ï¼šç±»å‹ä»ä¸º&#x27;B&#x27;ï¼Œå½¢çŠ¶æ”¹ä¸º2è¡Œ3åˆ—çš„äºŒç»´è§†å›¾ï¼ˆæ€»å…ƒç´ æ•°2*3=6ï¼Œä¸åŸå†…å­˜å­—èŠ‚æ•°åŒ¹é…ï¼‰</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m2.tolist()  <span class="comment"># äºŒç»´è§†å›¾çš„å±•ç¤ºå½¢å¼ï¼šæŒ‰2è¡Œ3åˆ—æ’åˆ—åŸæ•°æ®</span></span><br><span class="line">[[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m3 = m1.cast(<span class="string">&#x27;B&#x27;</span>, [<span class="number">3</span>, <span class="number">2</span>])  <span class="comment"># é›¶æ‹·è´è½¬æ¢ï¼šç±»å‹ä»ä¸º&#x27;B&#x27;ï¼Œå½¢çŠ¶æ”¹ä¸º3è¡Œ2åˆ—çš„äºŒç»´è§†å›¾ï¼ˆæ€»å…ƒç´ æ•°3*2=6ï¼ŒåŒ¹é…åŸå†…å­˜å­—èŠ‚æ•°ï¼‰</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m3.tolist()  <span class="comment"># äºŒç»´è§†å›¾çš„å±•ç¤ºå½¢å¼ï¼šæŒ‰3è¡Œ2åˆ—æ’åˆ—åŸæ•°æ®</span></span><br><span class="line">[[<span class="number">0</span>, <span class="number">1</span>], [<span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>]] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m2[<span class="number">1</span>,<span class="number">1</span>] = <span class="number">22</span>  <span class="comment"># ä¿®æ”¹m2è§†å›¾ä¸­ã€Œç¬¬2è¡Œç¬¬2åˆ—ã€çš„å…ƒç´ ï¼ˆå¯¹åº”åŸå†…å­˜ç¬¬4ä¸ªå­—èŠ‚ï¼ŒåŸæ•°å€¼4ï¼‰ï¼Œèµ‹å€¼22</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m3[<span class="number">1</span>,<span class="number">1</span>] = <span class="number">33</span>  <span class="comment"># ä¿®æ”¹m3è§†å›¾ä¸­ã€Œç¬¬2è¡Œç¬¬2åˆ—ã€çš„å…ƒç´ ï¼ˆå¯¹åº”åŸå†…å­˜ç¬¬3ä¸ªå­—èŠ‚ï¼ŒåŸæ•°å€¼3ï¼‰ï¼Œèµ‹å€¼33</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>octets  <span class="comment"># åŸarrayæ•°ç»„è¢«åŒæ­¥ä¿®æ”¹ï¼ˆæ‰€æœ‰è§†å›¾æŒ‡å‘åŒä¸€å—å†…å­˜ï¼‰ï¼Œæœ€ç»ˆå…ƒç´ ä¸º[0,1,2,33,22,5]</span></span><br><span class="line">array(<span class="string">&#x27;B&#x27;</span>, [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">33</span>, <span class="number">22</span>, <span class="number">5</span>])</span><br></pre></td></tr></table></figure>
<h4 id="2-ä¿®æ”¹ä¸€ä¸ª-16-ä½æ•´æ•°æ•°ç»„ä¸­æŸä¸€é¡¹çš„å­—èŠ‚ï¼Œæ”¹å˜è¯¥é¡¹çš„å€¼">&lt;2&gt;ã€€ä¿®æ”¹ä¸€ä¸ª 16 ä½æ•´æ•°æ•°ç»„ä¸­æŸä¸€é¡¹çš„å­—èŠ‚ï¼Œæ”¹å˜è¯¥é¡¹çš„å€¼</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>numbers = array.array(<span class="string">&#x27;h&#x27;</span>, [-<span class="number">2</span>, -<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>])  <span class="comment"># åˆ›å»ºarrayæ•°ç»„ï¼šç±»å‹ç &#x27;h&#x27;å¯¹åº”Cçš„signed short</span></span><br><span class="line"><span class="comment"># å…ƒç´ ä¸º5ä¸ªæ•´æ•°ï¼Œæ€»å†…å­˜5Ã—2=10å­—èŠ‚</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>memv = <span class="built_in">memoryview</span>(numbers)  <span class="comment"># ç”Ÿæˆnumbersçš„å†…å­˜è§†å›¾memvï¼ŒæŒ‡å‘åŒä¸€å—10å­—èŠ‚è¿ç»­å†…å­˜ï¼Œé»˜è®¤æ ¼å¼ä¸º&#x27;h&#x27;ï¼ˆ2å­—èŠ‚çŸ­æ•´å‹ï¼‰</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(memv)  <span class="comment"># æŸ¥çœ‹å†…å­˜è§†å›¾çš„å…ƒç´ ä¸ªæ•°ï¼ˆæŒ‰&#x27;h&#x27;ç±»å‹è§£è¯»ï¼Œ10å­—èŠ‚Ã·2å­—èŠ‚/ä¸ª=5ä¸ªï¼‰</span></span><br><span class="line"><span class="number">5</span> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>memv[<span class="number">0</span>] <span class="comment"># æŒ‰&#x27;h&#x27;ç±»å‹è¯»å–ç¬¬0ä¸ªå…ƒç´ ï¼Œå³åŸæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ -2</span></span><br><span class="line">-<span class="number">2</span> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>memv_oct = memv.cast(<span class="string">&#x27;B&#x27;</span>) <span class="comment"># é›¶æ‹·è´è½¬æ¢ï¼šå°†è§†å›¾æ ¼å¼è½¬ä¸º&#x27;B&#x27;ï¼ˆ1å­—èŠ‚æ— ç¬¦å·å­—ç¬¦ï¼‰ï¼ŒåŸ10å­—èŠ‚å†…å­˜è¢«æ‹†åˆ†ä¸º10ä¸ª1å­—èŠ‚å…ƒç´ è§£è¯»</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>memv_oct.tolist() <span class="comment"># æŒ‰1å­—èŠ‚æ— ç¬¦å·å­—ç¬¦å±•ç¤ºæ‰€æœ‰å†…å­˜ï¼šè¿™é‡Œæ˜¯çŸ­æ•´å‹çš„è¡¥ç å­˜å‚¨ï¼ˆå°ç«¯åºï¼Œä½å­—èŠ‚åœ¨å‰ï¼‰</span></span><br><span class="line"><span class="comment"># å¯¹åº”å…³ç³»ï¼ˆæ¯ä¸ªçŸ­æ•´å‹æ‹†ä¸º2ä¸ªå­—èŠ‚ï¼‰ï¼š</span></span><br><span class="line"><span class="comment"># -2 â†’ è¡¥ç 0xFFFE â†’ å°ç«¯åºå­˜å‚¨ä¸º[254, 255]ï¼›-1 â†’ è¡¥ç 0xFFFF â†’ [255, 255]ï¼›0 â†’ 0x0000 â†’ [0, 0]ï¼›</span></span><br><span class="line"><span class="comment">#1 â†’ 0x0001 â†’ [1, 0]ï¼›2 â†’ 0x0002 â†’ [2, 0]</span></span><br><span class="line">[<span class="number">254</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>memv_oct[<span class="number">5</span>] = <span class="number">4</span> <span class="comment"># ä¿®æ”¹ç¬¬5ä¸ª1å­—èŠ‚å…ƒç´ ï¼ˆç´¢å¼•ä»0å¼€å§‹ï¼‰ï¼šåŸç¬¬5ä¸ªå­—èŠ‚æ˜¯0ï¼ˆå¯¹åº”åŸæ•°ç»„ç¬¬2ä¸ªå…ƒç´ 0çš„é«˜å­—èŠ‚ï¼‰ï¼Œæ”¹ä¸º4</span></span><br><span class="line"><span class="comment"># å…³é”®ï¼šåŸæ•°ç»„ç¬¬2ä¸ªå…ƒç´ ï¼ˆç´¢å¼•2ï¼‰æ˜¯0ï¼Œå¯¹åº”å†…å­˜ä¸ºç¬¬4ã€5å­—èŠ‚ï¼ˆç´¢å¼•4=0ï¼Œç´¢å¼•5=0ï¼‰ï¼›ä¿®æ”¹ç´¢å¼•5ä¸º4åï¼Œè¯¥å…ƒç´ çš„å†…å­˜å˜ä¸º[0, 4]ï¼ˆå°ç«¯åºâ†’å®é™…æ˜¯0x0400ï¼‰</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>numbers  <span class="comment"># æŸ¥çœ‹åŸæ•°ç»„ï¼šç¬¬2ä¸ªå…ƒç´ ä»0å˜ä¸º0x0400å¯¹åº”çš„åè¿›åˆ¶æ•°1024ï¼Œå…¶ä»–å…ƒç´ å› å†…å­˜æœªè¢«ä¿®æ”¹ä¿æŒä¸å˜</span></span><br><span class="line">array(<span class="string">&#x27;h&#x27;</span>, [-<span class="number">2</span>, -<span class="number">1</span>, <span class="number">1024</span>, <span class="number">1</span>, <span class="number">2</span>])</span><br></pre></td></tr></table></figure>
<h2 id="3-Numpy">3.Numpy</h2>
<h3 id="1-æ¦‚è¿°-2">(1)æ¦‚è¿°</h3>
<ul>
<li>ç§‘å­¦è®¡ç®—ç»å¸¸éœ€è¦åšä¸€äº›é«˜çº§æ•°ç»„å’ŒçŸ©é˜µè¿ç®—ï¼Œå¾—ç›Šäº NumPyï¼ŒPythonæˆä¸ºè¿™ä¸€é¢†åŸŸçš„ä¸»æµè¯­è¨€</li>
<li><strong>NumPy</strong> å®ç°äº†å¤šç»´åŒæ„æ•°ç»„å’ŒçŸ©é˜µç±»å‹ï¼Œé™¤äº†å­˜æ”¾æ•°å€¼ä¹‹å¤–ï¼Œè¿˜å¯ä»¥å­˜æ”¾ç”¨æˆ·å®šä¹‰çš„è®°å½•ï¼Œè€Œä¸”æä¾›äº†é«˜æ•ˆçš„å…ƒç´ å±‚é¢æ“ä½œ</li>
<li>åœ¨ NumPy åŸºç¡€ä¹‹ä¸Šç¼–å†™çš„ <strong>SciPy</strong> åº“æä¾›äº†è®¸å¤šç§‘å­¦è®¡ç®—ç®—æ³•ï¼Œä»çº¿æ€§ä»£æ•°åˆ°æ•°å€¼å¾®ç§¯åˆ†å’Œç»Ÿè®¡å­¦ï¼Œä¸ä¸€è€Œè¶³ã€‚</li>
</ul>
<h3 id="2-ä½¿ç”¨ç¤ºä¾‹">(2)ä½¿ç”¨ç¤ºä¾‹</h3>
<h4 id="1-NumPyå¯¹äºŒç»´æ•°ç»„åšä¸€äº›åŸºæœ¬æ“ä½œ">&lt;1&gt;NumPyå¯¹äºŒç»´æ•°ç»„åšä¸€äº›åŸºæœ¬æ“ä½œ</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> numpy <span class="keyword">as</span> np <span class="comment"># å¯¼å…¥numpyåº“å¹¶ç®€å†™ä¸ºnpï¼ˆnumpyå¸¸è§„ç”¨æ³•ï¼Œæ–¹ä¾¿åç»­è°ƒç”¨ï¼‰</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = np.arange(<span class="number">12</span>)  <span class="comment"># ç”Ÿæˆ0-11çš„è¿ç»­æ•´æ•°æ•°ç»„ï¼Œé»˜è®¤æ˜¯1ç»´æ•°ç»„</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a </span><br><span class="line">array([ <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">7</span>,  <span class="number">8</span>,  <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>]) </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(a) </span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">&#x27;numpy.ndarray&#x27;</span>&gt;  <span class="comment"># æŸ¥çœ‹ç±»å‹ï¼Œç¡®è®¤æ˜¯numpyçš„æ•°ç»„ç±»å‹</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.shape  <span class="comment"># æŸ¥çœ‹æ•°ç»„å½¢çŠ¶ï¼š(12,) è¡¨ç¤º1ç»´æ•°ç»„ï¼Œå…±12ä¸ªå…ƒç´ </span></span><br><span class="line">(<span class="number">12</span>,) </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.shape = <span class="number">3</span>, <span class="number">4</span>  <span class="comment"># è°ƒæ•´æ•°ç»„å½¢çŠ¶ä¸º3è¡Œ4åˆ—çš„2ç»´æ•°ç»„ï¼ˆä¸æ”¹å˜æ•°æ®ï¼Œä»…æ”¹å˜è§£è¯»ç»´åº¦ï¼‰</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a </span><br><span class="line">array([[ <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">3</span>], </span><br><span class="line">       [ <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">7</span>], </span><br><span class="line">       [ <span class="number">8</span>,  <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>]]) </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[<span class="number">2</span>]  <span class="comment"># å–ç¬¬3è¡Œï¼ˆç´¢å¼•ä»0å¼€å§‹ï¼‰çš„æ‰€æœ‰å…ƒç´ </span></span><br><span class="line">array([ <span class="number">8</span>,  <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>]) </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[<span class="number">2</span>, <span class="number">1</span>]  <span class="comment"># å–ç¬¬3è¡Œç¬¬2åˆ—çš„å…ƒç´ ï¼ˆè¡Œç´¢å¼•2ï¼Œåˆ—ç´¢å¼•1ï¼‰</span></span><br><span class="line"><span class="number">9</span> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[:, <span class="number">1</span>]  <span class="comment"># å–æ‰€æœ‰è¡Œï¼ˆ:è¡¨ç¤ºå…¨éƒ¨ï¼‰çš„ç¬¬2åˆ—å…ƒç´ </span></span><br><span class="line">array([<span class="number">1</span>, <span class="number">5</span>, <span class="number">9</span>]) </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.transpose()  <span class="comment"># æ•°ç»„è½¬ç½®ï¼ˆè¡Œå˜åˆ—ã€åˆ—å˜è¡Œï¼‰ï¼Œ3è¡Œ4åˆ—è½¬ä¸º4è¡Œ3åˆ—</span></span><br><span class="line">array([[ <span class="number">0</span>,  <span class="number">4</span>,  <span class="number">8</span>], </span><br><span class="line">       [ <span class="number">1</span>,  <span class="number">5</span>,  <span class="number">9</span>], </span><br><span class="line">       [ <span class="number">2</span>,  <span class="number">6</span>, <span class="number">10</span>], </span><br><span class="line">       [ <span class="number">3</span>,  <span class="number">7</span>, <span class="number">11</span>]])</span><br></pre></td></tr></table></figure>
<h4 id="2-NumPyçš„ä¸€äº›é«˜çº§æ“ä½œ">&lt;2&gt;NumPyçš„ä¸€äº›é«˜çº§æ“ä½œ</h4>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> numpy  <span class="comment"># å¯¼å…¥numpyåº“ï¼ˆæœªç®€å†™ï¼Œç›´æ¥ç”¨åº“åè°ƒç”¨ï¼‰</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>floats = numpy.loadtxt(<span class="string">&#x27;floats-10M-lines.txt&#x27;</span>)  <span class="comment"># ä»æ–‡æœ¬æ–‡ä»¶è¯»å–1000ä¸‡è¡Œæµ®ç‚¹æ•°ï¼ŒåŠ è½½ä¸ºnumpyæ•°ç»„ï¼ˆæ³¨æ„ï¼šæ–‡æœ¬è¯»å–é€Ÿåº¦è¾ƒæ…¢ï¼Œé€‚åˆå°/ä¸­å‹æ•°æ®ï¼‰</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>floats[-<span class="number">3</span>:]  <span class="comment"># æŸ¥çœ‹æ•°ç»„æœ€å3ä¸ªå…ƒç´ ï¼ˆéªŒè¯æ•°æ®åŠ è½½æ­£å¸¸ï¼‰</span></span><br><span class="line">array([ <span class="number">3016362.69195522</span>,   <span class="number">535281.10514262</span>,  <span class="number">4566560.44373946</span>]) </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>floats *= <span class="number">.5</span>  <span class="comment"># æ•°ç»„æ‰€æœ‰å…ƒç´ åŸåœ°ä¹˜ä»¥0.5ï¼ˆnumpyå¹¿æ’­æœºåˆ¶ï¼Œæ— éœ€å¾ªç¯ï¼Œæ•ˆç‡é«˜ï¼‰</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>floats[-<span class="number">3</span>:]  <span class="comment"># å†æ¬¡æŸ¥çœ‹æœ€å3ä¸ªå…ƒç´ ï¼Œç¡®è®¤ä¿®æ”¹ç”Ÿæ•ˆ</span></span><br><span class="line">array([ <span class="number">1508181.34597761</span>,   <span class="number">267640.55257131</span>,  <span class="number">2283280.22186973</span>]) </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> time <span class="keyword">import</span> perf_counter <span class="keyword">as</span> pc <span class="comment"># ä»timeæ¨¡å—å¯¼å…¥é«˜ç²¾åº¦è®¡æ—¶å™¨perf_counterï¼Œç®€å†™ä¸ºpcï¼ˆæ–¹ä¾¿è®¡æ—¶ï¼‰</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t0 = pc(); floats /= <span class="number">3</span>; pc() - t0 <span class="comment"># è®¡æ—¶ï¼šè®¡ç®—æ•°ç»„æ‰€æœ‰å…ƒç´ åŸåœ°é™¤ä»¥3çš„è€—æ—¶ï¼Œè¾“å‡ºè€—æ—¶ï¼ˆnumpyæ•°ç»„è¿ç®—æ¯”PythonåŸç”Ÿå¾ªç¯å¿«å¾—å¤šï¼‰</span></span><br><span class="line"><span class="number">0.03690556302899495</span>  <span class="comment"># è¾“å‡ºç»“æœï¼šè€—æ—¶çº¦0.037ç§’ï¼ˆå¤„ç†1000ä¸‡æµ®ç‚¹æ•°ï¼Œä½“ç°numpyé«˜æ•ˆæ€§ï¼‰</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>numpy.save(<span class="string">&#x27;floats-10M&#x27;</span>, floats)  <span class="comment"># å°†æ•°ç»„ä»¥numpyä¸“ç”¨äºŒè¿›åˆ¶æ ¼å¼ï¼ˆ.npyï¼‰ä¿å­˜åˆ°æ–‡ä»¶ï¼ˆäºŒè¿›åˆ¶æ ¼å¼è¯»å†™å¿«ã€å ç”¨ç©ºé—´å°ï¼Œé€‚åˆå¤§æ•°æ®ï¼‰</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>floats2 = numpy.load(<span class="string">&#x27;floats-10M.npy&#x27;</span>, <span class="string">&#x27;r+&#x27;</span>)  <span class="comment"># ä»¥è¯»å†™æ¨¡å¼ï¼ˆr+ï¼‰åŠ è½½.npyæ–‡ä»¶ï¼Œè¿”å›memmapï¼ˆå†…å­˜æ˜ å°„ï¼‰å¯¹è±¡ï¼ˆæ— éœ€å°†æ•´ä¸ªå¤§æ•°æ®è½½å…¥å†…å­˜ï¼ŒèŠ‚çœå†…å­˜ï¼‰</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>floats2 *= <span class="number">6</span>  <span class="comment"># å¯¹memmapå¯¹è±¡åŸåœ°ä¹˜ä»¥6ï¼ˆç›´æ¥æ“ä½œç£ç›˜æ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œä¸å å¤§é‡å†…å­˜ï¼‰</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>floats2[-<span class="number">3</span>:]  <span class="comment"># æŸ¥çœ‹memmapå¯¹è±¡æœ€å3ä¸ªå…ƒç´ ï¼ŒéªŒè¯ä¿®æ”¹ç”Ÿæ•ˆï¼ˆmemmapå¯¹è±¡ç”¨æ³•ä¸numpyæ•°ç»„ä¸€è‡´ï¼‰</span></span><br><span class="line">memmap([ <span class="number">3016362.69195522</span>,   <span class="number">535281.10514262</span>,  <span class="number">4566560.44373946</span>])</span><br></pre></td></tr></table></figure>
<h2 id="4-deque-åŒç«¯é˜Ÿåˆ—">4.deque(åŒç«¯é˜Ÿåˆ—)</h2>
<h3 id="ï¼ˆ1ï¼‰æ¦‚è¿°-4">ï¼ˆ1ï¼‰æ¦‚è¿°</h3>
<ul>
<li>collections.deque ç±»å®ç°ä¸€ç§<strong>çº¿ç¨‹å®‰å…¨çš„åŒç«¯é˜Ÿåˆ—</strong>ï¼Œæ—¨åœ¨å¿«é€Ÿåœ¨ä¸¤ç«¯æ’å…¥å’Œåˆ é™¤é¡¹ã€‚</li>
<li><strong>dequeå¯¹è±¡å¯ä»¥æœ‰ç•Œ</strong>ï¼Œå³é•¿åº¦å›ºå®š â€”â€”&gt; å¯¹è±¡å¡«æ»¡ä¹‹åï¼Œä»ä¸€ç«¯æ·»åŠ æ–°é¡¹ï¼Œå°†ä»å¦ä¸€ç«¯ä¸¢å¼ƒä¸€é¡¹ã€‚</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰ä½¿ç”¨ç¤ºä¾‹-2">ï¼ˆ2ï¼‰ä½¿ç”¨ç¤ºä¾‹</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109115841494.png" alt=""></p>
<h3 id="ï¼ˆ3ï¼‰list-å’Œ-deque-å®ç°çš„æ–¹æ³•å¯¹æ¯”">ï¼ˆ3ï¼‰list å’Œ deque å®ç°çš„æ–¹æ³•å¯¹æ¯”</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109120042686.png" alt=""><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109120103430.png" alt=""><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109120124149.png" alt=""></p>
<h3 id="ï¼ˆ4ï¼‰Python-æ ‡å‡†åº“ä¸­çš„å…¶ä»–åŒ…ä¸­çš„é˜Ÿåˆ—">ï¼ˆ4ï¼‰Python æ ‡å‡†åº“ä¸­çš„å…¶ä»–åŒ…ä¸­çš„é˜Ÿåˆ—</h3>
<h4 id="1-queueåŒ…">&lt;1&gt;queueåŒ…</h4>
<ul>
<li><strong>é˜Ÿåˆ—ç±»</strong>ï¼šSimpleQueueã€Queueã€LifoQueue å’Œ PriorityQueueã€‚
<ul>
<li>è¿™äº›ç±»éƒ½æ˜¯<strong>çº¿ç¨‹å®‰å…¨</strong>çš„ï¼Œå¯åœ¨çº¿ç¨‹ä¹‹é—´å®‰å…¨é€šä¿¡</li>
</ul>
</li>
<li>é™¤SimpleQueue ä¹‹å¤–ï¼Œå…¶ä»–å‡ ä¸ªç±»éƒ½å¯ä»¥æœ‰ç•Œ â€”â€”&gt; ä¸ºæ„é€ å‡½æ•°æä¾›maxsize å‚æ•°ï¼Œè®¾ä¸ºå¤§äº 0 çš„å€¼ã€‚</li>
<li><strong>ä¸dequeçš„åŒºåˆ«</strong>ï¼šä¸åƒ deque é‚£æ ·ä¸ºäº†è…¾å‡ºç©ºé—´è€ŒæŠŠé¡¹ä¸¢å¼ƒï¼Œè€Œæ˜¯åœ¨<strong>é˜Ÿåˆ—å¡«æ»¡åé˜»å¡æ’å…¥æ–°é¡¹</strong>ï¼Œç­‰å¾…å…¶ä»–çº¿ç¨‹ä»é˜Ÿåˆ—ä¸­å–å‡ºä¸€é¡¹ã€‚
<ul>
<li>åˆ©ç”¨è¿™ç§è¡Œä¸ºå¯ä»¥é™åˆ¶æ´»åŠ¨çº¿ç¨‹çš„æ•°é‡ã€‚</li>
</ul>
</li>
</ul>
<h4 id="2-multiprocessingåŒ…">&lt;2&gt;multiprocessingåŒ…</h4>
<ul>
<li><strong>é˜Ÿåˆ—ç±»</strong>ï¼šæ— ç•Œçš„ SimpleQueue å’Œæœ‰ç•Œçš„ Queue
<ul>
<li>è¿™ä¸ queueåŒ…ä¸­çš„é˜Ÿåˆ—ç±»éå¸¸ç›¸ä¼¼ï¼Œåªä¸è¿‡ä¸“é—¨é’ˆå¯¹è¿›ç¨‹é—´é€šä¿¡</li>
</ul>
</li>
<li>ä¸ºä»»åŠ¡ç®¡ç†æä¾›äº†ä¸“ç”¨çš„ multiprocessing.JoinableQueueã€‚</li>
</ul>
<h4 id="3-asyncio">&lt;3&gt;asyncio</h4>
<ul>
<li><strong>é˜Ÿåˆ—ç±»</strong>ï¼šQueueã€LifoQueueã€PriorityQueue å’Œ JoinableQueue</li>
<li>API æºè‡ª queue å’Œ multiprocessing æ¨¡å—ä¸­çš„ç±»ï¼Œä¸è¿‡ä¸ºç®¡ç†å¼‚æ­¥ç¼–ç¨‹ä»»åŠ¡è€Œåšäº†ä¿®æ”¹ã€‚</li>
</ul>
<h4 id="4-heapq">&lt;4&gt;heapq</h4>
<ul>
<li><strong>é˜Ÿåˆ—ç±»</strong>ï¼šæ²¡æœ‰å®ç°ä»»ä½•é˜Ÿåˆ—ç±»</li>
<li><strong>åŠŸèƒ½</strong>ï¼šæä¾›äº†heappush å’Œ heappop ç­‰å‡½æ•°ï¼Œå¯æŠŠå¯å˜åºåˆ—å½“ä½œ<strong>å †é˜Ÿåˆ—</strong>æˆ–<strong>ä¼˜å…ˆçº§é˜Ÿåˆ—</strong>ä½¿ç”¨ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>Python</category>
        <category>ã€Šæµç•…çš„pythonã€‹</category>
        <category>ç¬¬2ç«  ä¸°å¯Œçš„åºåˆ—</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>æ‹¬å·ç”Ÿæˆ</title>
    <url>/2026/01/06/%E7%BC%96%E7%A8%8B%E9%A2%98/%E9%80%92%E5%BD%92/%E6%8B%AC%E5%8F%B7%E7%94%9F%E6%88%90/</url>
    <content><![CDATA[<h1>é¢˜ç›®æè¿°</h1>
<p><img src="/images/2026.1.6-1-oj.png" alt="é¢˜ç›®"></p>
<h1>è§£æ</h1>
<p>1.æ—¶é—´å¤æ‚åº¦O(n) â€”â€”&gt;â€œå›æº¯â€<br>
2.æ˜ å°„ï¼š â€˜(â€™â€”&gt;1   â€˜)â€™â€”&gt;-1<br>
3.sumè¡¨ç¤ºâ€œå’Œâ€ï¼Œsum&gt;=0åˆæ³•ï¼Œsum&lt;0ä¸åˆæ³•<br>
4.æ¯æ¬¡å¢åŠ ä¸€ä¸ªæ‹¬å·</p>
<ul>
<li>â€˜(â€™ : sum+1</li>
<li>â€˜)â€™ : sum-1</li>
<li>åˆ¤æ–­æ˜¯å¦ç»´æŒsum&gt;=0<br>
5.æœ€åï¼šâ€œå·¦/å³æ‹¬å·æ•°â€=0ï¼Œä¸”sum=0 â€”â€”&gt; â€œåˆæ³•ï¼â€</li>
</ul>
<h1>ä»£ç å®ç°</h1>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//res:ç»“æœé›†   tmpResï¼šæ¯æ¬¡çš„ç»“æœ   sumï¼š&quot;å’Œ&quot;  leftNum:&#x27;(&#x27;å‰©ä½™æ•°é‡  right: &#x27;)&#x27;å‰©ä½™æ•°é‡  </span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(vector&lt;string&gt;&amp; res,string&amp; tmpRes,<span class="type">int</span> sum,<span class="type">int</span> leftNum,<span class="type">int</span> rightNum)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(sum&lt;<span class="number">0</span>) <span class="keyword">return</span>; <span class="comment">//sum&lt;0:è¯´æ˜å½“å‰&#x27;)&#x27;æ•°é‡ å¤§äº &#x27;(&#x27;æ•°é‡</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(leftNum==<span class="number">0</span> &amp;&amp; rightNum==<span class="number">0</span> &amp;&amp; sum==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="comment">//æœ€åéƒ½ä¸º0ï¼Œåˆ™ä¸ºåˆæ³•ç»„åˆ</span></span><br><span class="line">        res.<span class="built_in">push_back</span>(tmpRes);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¢åŠ å·¦æ‹¬å·</span></span><br><span class="line">    <span class="keyword">if</span>(leftNum&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        tmpRes.<span class="built_in">push_back</span>(<span class="string">&#x27;(&#x27;</span>);</span><br><span class="line">        <span class="built_in">func</span>(res,tmpRes,sum<span class="number">+1</span>,leftNum<span class="number">-1</span>,rightNum);</span><br><span class="line">        tmpRes.<span class="built_in">pop_back</span>(); <span class="comment">//å›æº¯</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¢åŠ å³æ‹¬å·</span></span><br><span class="line">    <span class="keyword">if</span>(rightNum&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        tmpRes.<span class="built_in">push_back</span>(<span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">        <span class="built_in">func</span>(res,tmpRes,sum<span class="number">-1</span>,leftNum,rightNum<span class="number">-1</span>);</span><br><span class="line">        tmpRes.<span class="built_in">pop_back</span>(); <span class="comment">//å›æº¯</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">vector&lt;string&gt; <span class="title">generateParenthesis</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    vector&lt;string&gt; res;</span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">0</span>) <span class="keyword">return</span> res;</span><br><span class="line">    string tmpRes;</span><br><span class="line">    <span class="built_in">func</span>(res,tmpRes,<span class="number">0</span>,n,n);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>ç¼–ç¨‹é¢˜</category>
        <category>é€’å½’/å›æº¯</category>
      </categories>
      <tags>
        <tag>oj</tag>
        <tag>ç¬”è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>æ²¡æœ‰é‡å¤é¡¹æ•°å­—çš„å…¨æ’åˆ—é—®é¢˜</title>
    <url>/2026/01/02/%E7%BC%96%E7%A8%8B%E9%A2%98/%E9%80%92%E5%BD%92/%E6%B2%A1%E6%9C%89%E9%87%8D%E5%A4%8D%E9%A1%B9%E6%95%B0%E5%AD%97%E7%9A%84%E5%85%A8%E6%8E%92%E5%88%97%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h1>1.é¢˜ç›®æè¿°</h1>
<p><img src="/images/%E6%B2%A1%E6%9C%89%E9%87%8D%E5%A4%8D%E9%A1%B9%E6%95%B0%E5%AD%97%E7%9A%84%E5%85%A8%E6%8E%92%E5%88%97%E9%97%AE%E9%A2%98.png" alt="é¢˜ç›®æè¿°"></p>
<h1>2.é—®é¢˜åˆ†æï¼š</h1>
<pre><code>æ˜æ˜¾çš„ä¸€ç§æƒ³æ³•ï¼š
- ç¬¬ä¸€ä¸ªæ•°æœ‰nç§å¯èƒ½ï¼Œç¬¬äºŒä¸ªæ•°æœ‰n-1ä¸­å¯èƒ½ï¼Œ....,æœ€åä¸€ä¸ªæ•°
- ä»å°åˆ°è¾¾éå†ï¼Œæ¯æ¬¡æŒ‘é€‰ä¸€ä¸ªè¿˜æœªè¢«æŒ‘é€‰çš„æ•°ï¼Œè¢«æŒ‘é€‰äº†çš„åˆ™æ ‡è®°ä¸ºâ€œè¢«è®¿é—®çŠ¶æ€â€
- å¦‚æœç”¨forå¾ªç¯ï¼Œåˆ™éœ€è¦nå±‚ï¼Œè€Œæ˜æ˜¾å†™ä¸å‡ºâ€”â€”&gt;é€’å½’æ­¤æ—¶ä¼¼ä¹æ˜¯å¾ˆç›´è§‚çš„ä¸€ç§é€‰æ‹©
</code></pre>
<h1>3.è§£å†³æ–¹æ³•ï¼šé€’å½’</h1>
<h2 id="1-æ™®é€šæ–¹æ³•">(1) æ™®é€šæ–¹æ³•</h2>
<pre><code>1.æ¯æ¬¡ä»å°åˆ°è¾¾éå†ï¼ŒæŒ‘é€‰ç¬¬ä¸€ä¸ªæœªè¢«æŒ‘é€‰çš„æ•°å­—ï¼Œç„¶åè®¾ç½®ä¸ºâ€œè¢«è®¿é—®â€çŠ¶æ€
2.æ³¨æ„ç‚¹ï¼šè®°å¾—å›æº¯
</code></pre>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//res:å­˜æ”¾ç»“æœ  num:åŸæ•°ç»„  tmp:å­˜å‚¨æ¯æ¬¡é€’å½’çš„ç»“æœ  visit:è®¿é—®æ•°ç»„  floor:é€’å½’å±‚æ•°  size:numæ•°ç»„çš„å¤§å°</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">find</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; res,vector&lt;<span class="type">int</span>&gt;&amp; num,vector&lt;<span class="type">int</span>&gt;tmp,vector&lt;<span class="type">bool</span>&gt;&amp; visit,<span class="type">int</span> floor,<span class="type">int</span> size)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(floor==size) res.<span class="built_in">push_back</span>(tmp); </span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//æ¯æ¬¡ä»0å¼€å§‹éå†æ‰€æœ‰æ•°å­—</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;size;++i)&#123;</span><br><span class="line">            <span class="keyword">if</span>(visit[i]) <span class="keyword">continue</span>; <span class="comment">//è¢«è®¿é—®ï¼Œåˆ™è·³è¿‡</span></span><br><span class="line">            <span class="comment">//tmp[floor]è¡¨ç¤ºå­˜å‚¨è¯¥å±‚è¢«æŒ‘é€‰çš„æ•°å­—</span></span><br><span class="line">            <span class="comment">//num[i]æœªè¢«è®¿é—®ï¼Œåˆ™åŠ å…¥ï¼Œå¹¶å°†å…¶åœ¨visitä¸­çš„çŠ¶æ€è®¾ç½®ä¸ºtrue</span></span><br><span class="line">            tmp[floor]=num[i];</span><br><span class="line">            visit[i]=<span class="literal">true</span>;</span><br><span class="line">            <span class="built_in">find</span>(res,num,tmp,visit,floor<span class="number">+1</span>,size); <span class="comment">//é€’å½’è¿›å…¥ä¸‹ä¸€å±‚</span></span><br><span class="line">            visit[i]=<span class="literal">false</span>; <span class="comment">//å›æº¯:å› ä¸ºåé¢çš„é€’å½’ä»å¯æŒ‘é€‰num[i]</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">permute</span>(vector&lt;<span class="type">int</span>&gt;&amp; num) &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; res;</span><br><span class="line">    <span class="type">int</span> size=num.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">if</span>(size==<span class="number">0</span>) <span class="keyword">return</span> res;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(size==<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        res.<span class="built_in">push_back</span>(num);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; <span class="built_in">tmp</span>(size,<span class="number">-1</span>);</span><br><span class="line">        <span class="function">vector&lt;<span class="type">bool</span>&gt; <span class="title">visit</span><span class="params">(size,<span class="literal">false</span>)</span></span>;</span><br><span class="line">        <span class="built_in">find</span>(res,num,tmp,visit,<span class="number">0</span>,size);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-åŸåœ°äº¤æ¢çš„å›æº¯-ï¼ˆå¸¸è§ã€é«˜æ•ˆã€ç©ºé—´å°‘ï¼‰">(2) åŸåœ°äº¤æ¢çš„å›æº¯ ï¼ˆå¸¸è§ã€é«˜æ•ˆã€ç©ºé—´å°‘ï¼‰</h2>
<p>å…³é”®è§£æï¼š<br>
1.floorè¡¨ç¤ºé€’å½’å±‚æ•°ï¼Œä¹Ÿè¡¨ç¤ºæŒ‘é€‰äº†çš„ä¸ªæ•°ï¼Œä»0â€”â€”&gt;size ä¾æ¬¡é€’å¢ï¼Œfloor==sizeè¡¨ç¤ºå…¨éƒ¨æŒ‘é€‰ï¼ˆç»“æŸé€’å½’ï¼‰<br>
2.æ¯ä¸€æ¬¡è°ƒç”¨ï¼Œnum[floor]å­˜å‚¨å½“å‰è°ƒç”¨æŒ‘é€‰çš„æ•°å­—â€”â€”&gt;é€šè¿‡swap(num[floor],num[i])åŸåœ°äº¤æ¢å®ç°<br>
3.å› ä¸ºnumæ˜¯â€˜å¼•ç”¨ä¼ é€’â€™ï¼Œä¸”flooré€’å¢ï¼Œæ•…å½“ç¬¬floorå±‚æ‰§è¡Œå®Œswapåï¼Œnum[0,floor]éƒ½æ˜¯è¢«æŒ‘é€‰äº†çš„,num[floor+1,size]åˆ™è¿˜æœªè¢«æŒ‘é€‰ï¼ˆå› ä¸º1,2â€¦,floor-1éƒ½æ‰§è¡Œäº†swapï¼‰â€”â€”&gt;è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæ¯ä¸€å±‚éƒ½ä»i=floorå¼€å§‹å¾ªç¯<br>
4.æ³¨æ„ç‚¹ï¼šå› ä¸ºnumæ˜¯â€™å¼•ç”¨ä¼ é€’â€™ï¼Œæ•…é€’å½’è°ƒç”¨å®Œåï¼Œéœ€è¦â€™å›æº¯â€™ï¼ˆäº¤æ¢å›æ¥ï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; res,vector&lt;<span class="type">int</span>&gt;&amp; num,<span class="type">int</span> floor,<span class="type">int</span> size)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(floor==size) res.<span class="built_in">push_back</span>(num);</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=floor;i&lt;size;++i)&#123;</span><br><span class="line">            <span class="built_in">swap</span>(num[floor],num[i]); <span class="comment">//äº¤æ¢åï¼šnum[0,floor]éƒ½æ˜¯è¢«é€‰æ‹©çš„äº†ï¼Œnum[floor+1,size)åˆ™æ˜¯è¿˜æœªè¢«é€‰æ‹©çš„</span></span><br><span class="line">            <span class="built_in">dfs</span>(res,num,floor<span class="number">+1</span>,size); <span class="comment">//é€’å½’ï¼šé€‰æ‹©ä¸‹ä¸€ä¸ª</span></span><br><span class="line">            <span class="built_in">swap</span>(num[i],num[floor]); <span class="comment">//å›æº¯</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">permute</span>(vector&lt;<span class="type">int</span>&gt;&amp; num) &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; res;</span><br><span class="line">    <span class="type">int</span> size=num.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">if</span>(size==<span class="number">0</span>) <span class="keyword">return</span> res;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(size==<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        res.<span class="built_in">push_back</span>(num);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">dfs</span>(res,num,<span class="number">0</span>,size);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>ç¼–ç¨‹é¢˜</category>
        <category>é€’å½’/å›æº¯</category>
      </categories>
      <tags>
        <tag>oj</tag>
        <tag>ç¬”è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>çŸ©é˜µæœ€é•¿é€’å¢è·¯å¾„(é‡ç‚¹)</title>
    <url>/2026/01/06/%E7%BC%96%E7%A8%8B%E9%A2%98/%E9%80%92%E5%BD%92/%E7%9F%A9%E9%98%B5%E6%9C%80%E9%95%BF%E9%80%92%E5%A2%9E%E8%B7%AF%E5%BE%84/</url>
    <content><![CDATA[<h1>é¢˜ç›®æè¿°</h1>
<p><img src="/images/2026.1.6-2-oj.png" alt="é¢˜ç›®"></p>
<h1>è§£æ</h1>
<h3 id="æ–¹æ³•1ï¼šè®°å¿†åŒ–æœç´¢-DFS">æ–¹æ³•1ï¼šè®°å¿†åŒ–æœç´¢ DFS</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> row,col;</span><br><span class="line"><span class="type">int</span> dirs[<span class="number">4</span>][<span class="number">2</span>]=&#123;&#123;<span class="number">-1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">-1</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>&#125;&#125;; <span class="comment">//å››ä¸ªæ–¹å‘</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//dp:è®°å¿†æ•°ç»„  matrix[i][j]:å½“å‰ä½ç½®</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dfs</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp;matrix,vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; dp,<span class="type">int</span> i,<span class="type">int</span> j)</span></span>&#123;</span><br><span class="line">    <span class="comment">//å·²ç»è®¡ç®—è¿‡ï¼Œç›´æ¥è¿”å›â€”â€”&gt;&quot;å‰ªæ&quot;</span></span><br><span class="line">    <span class="keyword">if</span>(dp[i][j]!=<span class="number">0</span>) <span class="keyword">return</span> dp[i][j];</span><br><span class="line">    dp[i][j]=<span class="number">1</span>; <span class="comment">//è‡³å°‘åŒ…å«è‡ªå·±</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;it: dirs)&#123;</span><br><span class="line">        <span class="type">int</span> ni=i+it[<span class="number">0</span>],nj=j+it[<span class="number">1</span>];</span><br><span class="line">        <span class="comment">//åˆ†åˆ«å‘4ä¸ªæ–¹å‘ç§»åŠ¨</span></span><br><span class="line">        <span class="keyword">if</span> (ni &gt;= <span class="number">0</span> &amp;&amp; ni &lt; row &amp;&amp; nj &gt;= <span class="number">0</span> &amp;&amp; nj &lt; col </span><br><span class="line">            &amp;&amp; matrix[ni][nj] &gt; matrix[i][j]) &#123;</span><br><span class="line">            dp[i][j] = <span class="built_in">max</span>(dp[i][j], <span class="number">1</span> + <span class="built_in">dfs</span>(matrix, dp, ni, nj));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[i][j];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">solve</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt; &gt;&amp; matrix)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    row=matrix.<span class="built_in">size</span>();</span><br><span class="line">    col=matrix.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;<span class="built_in">dp</span>(row,<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(col,<span class="number">0</span>));</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;row;++i)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;col;++j)&#123;</span><br><span class="line">            <span class="comment">//å› ä¸ºæ˜¯â€œé€’å¢â€ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°å¾ªç¯ä¾èµ–ï¼Œä¸éœ€è¦è€ƒè™‘visitæ•°ç»„</span></span><br><span class="line">            res=<span class="built_in">max</span>(res,<span class="built_in">dfs</span>(matrix,dp,i,j));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•2ï¼š-æ€è·¯ä¸1ç±»ä¼¼ï¼ˆæ›´å¤æ‚å†—ä½™ï¼Œä½†æ„Ÿè§‰æ›´å®¹æ˜“æƒ³åˆ°ï¼‰">æ–¹æ³•2ï¼š æ€è·¯ä¸1ç±»ä¼¼ï¼ˆæ›´å¤æ‚å†—ä½™ï¼Œä½†æ„Ÿè§‰æ›´å®¹æ˜“æƒ³åˆ°ï¼‰</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//val: å½“å‰ä½ç½®çš„å€¼  d_r: dest_row  d_c: dest_col</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">canMove</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; matrix,<span class="type">int</span> row,<span class="type">int</span> col,<span class="type">int</span> val,<span class="type">int</span> d_r,<span class="type">int</span> d_c)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(d_r&lt;<span class="number">0</span> || d_r&gt;=row) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span>(d_c&lt;<span class="number">0</span> || d_c&gt;=col) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span>(matrix[d_r][d_c]&lt;=val) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; matrix,vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp;dp,vector&lt;vector&lt;<span class="type">bool</span>&gt;&gt;&amp;visit,<span class="type">int</span> row,<span class="type">int</span> col,pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt;src,pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt;cur,<span class="type">int</span> pathLong)</span></span>&#123;</span><br><span class="line">    <span class="comment">//1.å¦‚æœdp[c_f][c_s]!=0,åˆ™å·²ç»æ±‚è¿‡å…¶æœ€é•¿è·¯å¾„â€”â€”&gt;â€œå‰ªæâ€</span></span><br><span class="line">    <span class="type">int</span> c_f=cur.first,c_s=cur.second;</span><br><span class="line">    <span class="type">int</span> s_f=src.first,s_s=src.second;</span><br><span class="line">    <span class="keyword">if</span>(dp[c_f][c_s]&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        pathLong+=dp[c_f][c_s];</span><br><span class="line">        <span class="keyword">if</span>(pathLong&gt;dp[s_f][s_s])&#123;</span><br><span class="line">            dp[s_f][s_s]=pathLong;</span><br><span class="line">            <span class="keyword">if</span>(pathLong&gt;res) res=pathLong;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">//2.å¦‚æœå·²ç»è®¿é—®è¿‡äº†ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œé¿å…â€œå¾ªç¯è®¿é—®â€</span></span><br><span class="line">    <span class="keyword">if</span>(visit[c_f][c_s]) <span class="keyword">return</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//3.å¤„ç†å½“å‰ä½ç½®</span></span><br><span class="line">    visit[c_f][c_s]=<span class="literal">true</span>;</span><br><span class="line">    pathLong+=<span class="number">1</span>; <span class="comment">//æ³¨æ„ï¼špathLongåˆå§‹ä¸º0</span></span><br><span class="line">    <span class="keyword">if</span>(pathLong&gt;dp[s_f][s_s]) dp[s_f][s_s]=pathLong;</span><br><span class="line">    <span class="keyword">if</span>(pathLong&gt;res) res=pathLong;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//4.åˆ†åˆ«å‘â€œä¸Šä¸‹å·¦å³â€å››ä¸ªæ–¹å‘ç§»åŠ¨</span></span><br><span class="line">    <span class="type">int</span> curVal=matrix[c_f][c_s];</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">canMove</span>(matrix,row,col,curVal,c_f<span class="number">-1</span>,c_s))&#123;</span><br><span class="line">        visit[c_f][c_s]=<span class="literal">true</span>;</span><br><span class="line">        cur.first-=<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">func</span>(matrix,dp,visit,row,col,src,cur,pathLong);</span><br><span class="line">        <span class="comment">//å›æº¯</span></span><br><span class="line">        visit[c_f][c_s]=<span class="literal">false</span>;</span><br><span class="line">        cur.first+=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">canMove</span>(matrix,row,col,curVal,c_f<span class="number">+1</span>,c_s))&#123;</span><br><span class="line">        visit[c_f][c_s]=<span class="literal">true</span>; <span class="comment">//é¿å…å‰é¢çš„ifåˆ†æ”¯å½±å“</span></span><br><span class="line">        cur.first+=<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">func</span>(matrix,dp,visit,row,col,src,cur,pathLong);</span><br><span class="line">        <span class="comment">//å›æº¯</span></span><br><span class="line">        visit[c_f][c_s]=<span class="literal">true</span>;</span><br><span class="line">        cur.first-=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">canMove</span>(matrix,row,col,curVal,c_f,c_s<span class="number">-1</span>))&#123;</span><br><span class="line">        visit[c_f][c_s]=<span class="literal">true</span>;</span><br><span class="line">        cur.second-=<span class="number">1</span>;</span><br><span class="line">        <span class="comment">//å›æº¯</span></span><br><span class="line">        <span class="built_in">func</span>(matrix,dp,visit,row,col,src,cur,pathLong);</span><br><span class="line">        visit[c_f][c_s]=<span class="literal">true</span>;</span><br><span class="line">        cur.second+=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">canMove</span>(matrix,row,col,curVal,c_f,c_s<span class="number">+1</span>))&#123;</span><br><span class="line">        visit[c_f][c_s]=<span class="literal">true</span>;</span><br><span class="line">        cur.second+=<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">func</span>(matrix,dp,visit,row,col,src,cur,pathLong);</span><br><span class="line">        <span class="comment">//å›æº¯</span></span><br><span class="line">        visit[c_f][c_s]=<span class="literal">true</span>;</span><br><span class="line">        cur.second-=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span>(visit[c_f][c_s]) visit[c_f][c_s]=<span class="literal">false</span>; <span class="comment">//å›æº¯</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">solve</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; matrix)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    <span class="type">int</span> row=matrix.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> col=matrix[<span class="number">0</span>].<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">if</span>(row==<span class="number">1</span> &amp;&amp; col==<span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//dp[i][j]: matrix[i][j]çš„æœ€é•¿é€’å¢è·¯å¾„</span></span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">dp</span>(row,<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(col,<span class="number">-1</span>));</span><br><span class="line">    vector&lt;vector&lt;<span class="type">bool</span>&gt;&gt; <span class="built_in">visit</span>(row,<span class="built_in">vector</span>&lt;<span class="type">bool</span>&gt;(col,<span class="literal">false</span>));</span><br><span class="line">     </span><br><span class="line">    <span class="comment">//æ±‚å‡ºä»¥æ¯ä¸ªä½ç½®ä¸ºèµ·ç‚¹çš„æœ€é•¿è·¯å¾„</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;row;++i)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;col;++j)&#123;</span><br><span class="line">            pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; src&#123;i,j&#125;;</span><br><span class="line">            pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; cur&#123;i,j&#125;;</span><br><span class="line">            <span class="built_in">func</span>(matrix,dp,visit,row,col,src,cur,<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>å¯ä¼˜åŒ–ç‚¹ï¼š</strong><br>
<strong>- visitæ•°ç»„ä¸éœ€è¦ï¼šå› ä¸ºæ˜¯â€œé€’å¢â€ï¼Œä¸ä¼šå‡ºç°â€œå¾ªç¯è®¿é—®â€ â€¦</strong><br>
<strong>- å°±ç…§ç€â€œæ–¹æ³•1â€å»ä¼˜åŒ–å§</strong></p>
]]></content>
      <categories>
        <category>ç¼–ç¨‹é¢˜</category>
        <category>é€’å½’/å›æº¯</category>
      </categories>
      <tags>
        <tag>oj</tag>
        <tag>ç¬”è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>Nçš‡åé—®é¢˜</title>
    <url>/2026/01/05/%E7%BC%96%E7%A8%8B%E9%A2%98/%E9%80%92%E5%BD%92/N%E7%9A%87%E5%90%8E%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h1>1.é—®é¢˜æè¿°</h1>
<p><img src="/images/N%E7%9A%87%E5%90%8E%E9%97%AE%E9%A2%98.png" alt="é¢˜ç›®æè¿°"></p>
<h1>2.é—®é¢˜åˆ†æï¼š</h1>
<pre><code>æ€è·¯å¾ˆç›´æ¥ï¼šæŒ‰è¡Œæ”¾çš‡åï¼Œæ¯æ”¾ä¸€ä¸ªå°±æ ‡è®°è¯¥åˆ—å’Œä¸¤æ¡å¯¹è§’çº¿è¢«å ç”¨ï¼Œæ”¾å®Œæœ€åä¸€è¡Œæ—¶è®¡æ•°ï¼‹ï¼‹ï¼Œç„¶åå›æº¯æ’¤é”€ã€‚
</code></pre>
<h1>3.è§£å†³æ–¹æ³•ï¼šé€’å½’+å›æº¯</h1>
<h2 id="1-åˆ©ç”¨çŸ©é˜µçš„æ€§è´¨">(1)åˆ©ç”¨çŸ©é˜µçš„æ€§è´¨</h2>
<pre><code>1./ æ–¹å‘çš„æ‰€æœ‰æ ¼å­æ»¡è¶³ i+j == å¸¸é‡
2.\ æ–¹å‘çš„æ‰€æœ‰æ ¼å­æ»¡è¶³ iâˆ’j == å¸¸é‡ï¼Œä¸ºäº†ä¸‹æ ‡éè´Ÿï¼Œåç§»äº† +(nâˆ’1) â€”â€”&gt;æ³¨æ„ï¼šä¸å¯ä»¥ç®€å•çš„ç”¨ç»å¯¹å€¼ï¼Œå¦‚ï¼ˆ1,2ï¼‰ï¼Œ(2,1)
</code></pre>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">backtrace</span><span class="params">(<span class="type">int</span>&amp; res,<span class="type">int</span> row,vector&lt;<span class="type">bool</span>&gt;&amp; col,vector&lt;<span class="type">bool</span>&gt;&amp;diag1,vector&lt;<span class="type">bool</span>&gt;&amp;diag2,<span class="type">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(row==n)&#123;</span><br><span class="line">        res++;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//éå†æ¯ä¸€åˆ—</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;n;++j)&#123;</span><br><span class="line">        <span class="comment">//æ£€æŸ¥æ‰€åœ¨åˆ—ã€å¯¹è§’çº¿æ˜¯å¦è¿˜å¯ç”¨</span></span><br><span class="line">        <span class="comment">//å…³é”®ç‚¹1ï¼šâ€œ/æ–œçº¿ä¸Šï¼šrow+col=å®šå€¼â€ï¼Œâ€œ\æ–œçº¿ä¸Šï¼šrow-col=å®šå€¼â€”â€”&gt;ä¸ºä¿æŒéè´Ÿï¼Œå‘å³åç§»n-1ï¼ˆæ³¨æ„ä¸å¯ä»¥ç®€å•çš„ç”¨â€œç»å¯¹å€¼â€ï¼‰â€</span></span><br><span class="line">        <span class="keyword">if</span>(col[j] || diag1[row+j] || diag2[row-j+n<span class="number">-1</span>]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="comment">//å¯ç”¨ï¼šå ç”¨å¹¶æ›´æ–°colã€diag1ã€diag2</span></span><br><span class="line">        col[j]=diag1[row+j]=diag2[row-j+n<span class="number">-1</span>]=<span class="literal">true</span>;</span><br><span class="line">        <span class="comment">//é€’å½’éå†ä¸‹ä¸€è¡Œ</span></span><br><span class="line">        <span class="built_in">backtrace</span>(res,row<span class="number">+1</span>,col,diag1,diag2,n);</span><br><span class="line">        <span class="comment">//å…³é”®ç‚¹2ï¼šå›æº¯</span></span><br><span class="line">        col[j]=diag1[row+j]=diag2[row-j+n<span class="number">-1</span>]=<span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Nqueen</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    <span class="comment">//colï¼šåŒåˆ—æ˜¯å¦å¯ç”¨   diag1ï¼š/å¯¹è§’çº¿æ˜¯å¦å¯ç”¨  diag2ï¼š\å¯¹è§’çº¿æ˜¯å¦å¯ç”¨  -&gt;false:æœªå ç”¨  true:å ç”¨</span></span><br><span class="line">    <span class="function">vector&lt;<span class="type">bool</span>&gt; <span class="title">col</span><span class="params">(n,<span class="literal">false</span>)</span>,<span class="title">diag1</span><span class="params">(n*<span class="number">2</span>,<span class="literal">false</span>)</span>,<span class="title">diag2</span><span class="params">(n*<span class="number">2</span>,<span class="literal">false</span>)</span></span>;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">backtrace</span>(res,<span class="number">0</span>,col,diag1,diag2,n);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-é€è¡Œè®°å½•å·²æ”¾çš‡åçš„åˆ—ï¼Œå¹¶æ¯æ¬¡éå†å·²æ”¾çš‡åæ£€æŸ¥å†²çªï¼ˆå¦‚æœä¸çŸ¥é“ä¸Šè¿°çŸ©é˜µçš„æ€§è´¨ï¼‰">(2)é€è¡Œè®°å½•å·²æ”¾çš‡åçš„åˆ—ï¼Œå¹¶æ¯æ¬¡éå†å·²æ”¾çš‡åæ£€æŸ¥å†²çªï¼ˆå¦‚æœä¸çŸ¥é“ä¸Šè¿°çŸ©é˜µçš„æ€§è´¨ï¼‰</h2>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">backtrace</span><span class="params">(<span class="type">int</span>&amp; res,<span class="type">int</span> row,vector&lt;<span class="type">int</span>&gt;&amp; pos,<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (row == n) &#123;</span><br><span class="line">        res++;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°è¯•æŠŠç¬¬ row è¡Œçš„çš‡åæ”¾åˆ° col åˆ—</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> col = <span class="number">0</span>; col &lt; n; ++col) &#123;</span><br><span class="line">        <span class="type">bool</span> ok = <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">// æ£€æŸ¥å’Œå‰é¢æ‰€æœ‰è¡Œçš„å†²çª</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> r = <span class="number">0</span>; r &lt; row; ++r) &#123;</span><br><span class="line">            <span class="comment">// åŒåˆ—å†²çª æˆ– åŒå¯¹è§’çº¿å†²çªï¼ˆ|è¡Œå·®|==|åˆ—å·®|ï¼‰</span></span><br><span class="line">            <span class="keyword">if</span> (pos[r] == col || <span class="built_in">abs</span>(row - r) == <span class="built_in">abs</span>(col - pos[r])) &#123;</span><br><span class="line">                ok = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!ok) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="comment">// æ”¾ç½®çš‡å</span></span><br><span class="line">        pos[row] = col;</span><br><span class="line">        <span class="built_in">backtrace</span>(res, row + <span class="number">1</span>, pos, n);</span><br><span class="line">        <span class="comment">// å›æº¯æ—¶ä¸éœ€è¦æ‰‹åŠ¨æ¸…ç† pos[row]ï¼Œä¸‹æ¬¡è¦†ç›–å³å¯</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Nqueen</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">pos</span><span class="params">(n, <span class="number">-1</span>)</span></span>; <span class="comment">//è®°å½•æ¯è¡Œæ”¾ç½®åœ¨å“ªä¸€åˆ—</span></span><br><span class="line">    <span class="built_in">backtrace</span>(res, <span class="number">0</span>, pos, n);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>ç¼–ç¨‹é¢˜</category>
        <category>é€’å½’/å›æº¯</category>
      </categories>
      <tags>
        <tag>oj</tag>
        <tag>ç¬”è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>0.æ€»ç»“</title>
    <url>/2026/01/08/%E7%BC%96%E7%A8%8B%E9%A2%98/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/%E5%AD%97%E7%AC%A6%E4%B8%B2/0.%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E2%80%94%E5%AD%97%E7%AC%A6%E4%B8%B2/</url>
    <content><![CDATA[<h1>ä¸€ã€æ ¸å¿ƒæ€è€ƒæ–¹å‘</h1>
<h2 id="1-çŠ¶æ€å®šä¹‰ï¼šdpæ•°ç»„å«ä¹‰">1.çŠ¶æ€å®šä¹‰ï¼šdpæ•°ç»„å«ä¹‰</h2>
<p><strong>1.å•å­—ç¬¦ä¸²</strong>ï¼š</p>
<ul>
<li>dp[i]
<ul>
<li>è¡¨ç¤º<strong>sçš„å‰iä¸ªå­—ç¬¦</strong>çš„æŸç§æ€§è´¨</li>
<li>è¡¨ç¤º<strong>ä»¥ç¬¬iä¸ªå­—ç¬¦ç»“å°¾</strong>çš„æŸç§æ€§è´¨</li>
</ul>
</li>
<li>dp[i][j]
<ul>
<li>è¡¨ç¤º<strong>s[iâ€¦j]å­ä¸²</strong>çš„æŸç§æ€§è´¨</li>
</ul>
</li>
<li>dp[i][j][k]
<ul>
<li>å¸¦æœ‰<strong>é¢å¤–é™åˆ¶æ¡ä»¶</strong>çš„å­—ç¬¦ä¸²é—®é¢˜<br>
<strong>2.åŒå­—ç¬¦ä¸²</strong>ï¼š</li>
</ul>
</li>
<li>dp[i][j]
<ul>
<li>è¡¨ç¤º<strong>s1çš„å‰iä¸ªå­—ç¬¦</strong>ä¸<strong>s2çš„å‰jä¸ªå­—ç¬¦</strong>çš„æœ€ä¼˜è§£</li>
</ul>
</li>
<li>dp[i][j][k]
<ul>
<li>å¸¦æœ‰<strong>é¢å¤–é™åˆ¶æ¡ä»¶</strong>çš„å­—ç¬¦ä¸²é—®é¢˜</li>
</ul>
</li>
<li>dp[i][j][k][t]
<ul>
<li>s1[iâ€¦j] ä¸ s2[kâ€¦t]çš„æŸç§æ€§è´¨</li>
</ul>
</li>
</ul>
<h2 id="2-è¾¹ç•Œæ¡ä»¶ï¼šåˆå§‹åŒ–dpæ•°ç»„">2.è¾¹ç•Œæ¡ä»¶ï¼šåˆå§‹åŒ–dpæ•°ç»„</h2>
<p>å­—ç¬¦ä¸²DPçš„è¾¹ç•Œé€šå¸¸å¯¹åº”<strong>ç©ºä¸²</strong>åœºæ™¯ï¼Œæ˜¯<strong>çŠ¶æ€è½¬ç§»çš„èµ·ç‚¹</strong>,ä¾‹å¦‚ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="type">int</span> len1=s<span class="number">1.</span><span class="built_in">size</span>();</span><br><span class="line"><span class="type">int</span> len2=s<span class="number">2.</span><span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//dp[0][j]=0 dp[i][0]=0 éƒ½è¡¨ç¤ºå…¶ä¸­ä¸€ä¸ªä¸ºâ€œç©ºä¸²â€ï¼Œæ•…éƒ½è®¾ç½®ä¸º0</span></span><br><span class="line"><span class="comment">//dp[i][j]è¡¨ç¤ºs1çš„å‰iä¸ªå­—ç¬¦ï¼Œs2çš„å‰jä¸ªå­—ç¬¦ï¼ˆä»1å¼€å§‹ï¼‰</span></span><br><span class="line">vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">dp</span>(len1<span class="number">+1</span>,<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(len2<span class="number">+1</span>,<span class="number">0</span>));</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=len1;++i)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=len2;++j)&#123;</span><br><span class="line">        <span class="keyword">if</span>(s1[i<span class="number">-1</span>]==s2[j<span class="number">-1</span>])&#123;</span><br><span class="line">            ......</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            ......</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-çŠ¶æ€è½¬ç§»">3.çŠ¶æ€è½¬ç§»</h2>
<p>1.<strong>s1=[i-1]==s2[j-1]</strong>:</p>
<ul>
<li>dp[i][j]=opt(dp[i-1][j-1])ï¼šopt()è¡¨ç¤ºdp[i-1][j-1]è¿›è¡ŒæŸç§å¤„ç†ï¼Œå¦‚dp[i-1][j-1]+1</li>
</ul>
<p>2.<strong>s1[i-1]!=s2[j-1]</strong></p>
<ul>
<li>dp[i][j]=( opt(dp[i-1][j]) || opt(dp[i][j-1]) || opt(dp[i-1][j-1]) )</li>
</ul>
<h2 id="4-éå†é¡ºåº">4.éå†é¡ºåº</h2>
<ul>
<li>å·¦ä¸Šåˆ°å³ä¸‹ï¼ˆäºŒç»´DPå…¸å‹æ–¹å‘ï¼‰</li>
<li>æ–œå¯¹è§’éå†ï¼ˆå¤„ç†å­ä¸²æˆ–å›æ–‡ç›¸å…³é—®é¢˜ï¼‰</li>
<li>ä»çŸ­åˆ°é•¿é€’æ¨ï¼ˆåŒºé—´DPï¼‰</li>
</ul>
<h1>äºŒã€å¸¸è§æŠ€å·§</h1>
<h2 id="1-ç©ºé—´ä¼˜åŒ–">1.ç©ºé—´ä¼˜åŒ–</h2>
<ul>
<li><strong>æ»šåŠ¨æ•°ç»„</strong>ï¼šç”¨ä¸¤è¡Œæˆ–ä¸€è¡Œæ›¿ä»£æ•´ä¸ªäºŒç»´æ•°ç»„
<ul>
<li>ä¾‹ï¼š<a href="/2026/01/09/%E7%BC%96%E7%A8%8B%E9%A2%98/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/%E5%AD%97%E7%AC%A6%E4%B8%B2/1.%E6%9C%80%E9%95%BF%E5%85%AC%E5%85%B1%E5%AD%90%E5%BA%8F%E5%88%97(%E4%B8%80)/" title="1.æœ€é•¿å…¬å…±å­åºåˆ—(ä¸€)">æœ€é•¿å…¬å…±å­åºåˆ—ï¼ˆä¸€ï¼‰</a></li>
</ul>
</li>
<li>ä½¿ç”¨å•ä¸€æ•°ç»„+ä¸´æ—¶å˜é‡è®°å½•å·¦ä¸Šè§’å€¼</li>
<li>æ ¹æ®ä¾èµ–æ–¹å‘è°ƒæ•´éå†é¡ºåºï¼ˆå¦‚ä»å³åˆ°å·¦ï¼‰</li>
</ul>
<h2 id="2-å›æº¯æ„å»ºç»“æœ">2.å›æº¯æ„å»ºç»“æœ</h2>
<ul>
<li>ä½¿ç”¨DPè¡¨<strong>ä»ç»ˆç‚¹å›æº¯åˆ°èµ·ç‚¹</strong>é‡å»ºç»“æœ
<ul>
<li>ä¾‹ï¼š<a href="/2026/01/08/%E7%BC%96%E7%A8%8B%E9%A2%98/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/%E5%AD%97%E7%AC%A6%E4%B8%B2/2.%E6%9C%80%E9%95%BF%E5%85%AC%E5%85%B1%E5%AD%90%E5%BA%8F%E5%88%97(%E4%BA%8C)/" title="2.æœ€é•¿å…¬å…±å­åºåˆ—(äºŒ)">æœ€é•¿å…¬å…±å­åºåˆ—ï¼ˆäºŒï¼‰</a></li>
</ul>
</li>
<li>åœ¨DPè¿‡ç¨‹ä¸­è®°å½•è½¬ç§»æ¥æºï¼ˆè·¯å¾„æ•°ç»„ï¼‰</li>
</ul>
<h2 id="3-é¢„å¤„ç†æŠ€å·§">3.é¢„å¤„ç†æŠ€å·§</h2>
<ul>
<li><strong>å“ˆå¸Œ</strong>æˆ–<strong>å‰ç¼€å’Œ</strong>åŠ é€Ÿå­ä¸²æŸ¥è¯¢</li>
<li>é¢„å…ˆè®¡ç®—ç‰¹å®šå­—ç¬¦çš„ä½ç½®ä¿¡æ¯</li>
</ul>
<h2 id="4-çŠ¶æ€å‹ç¼©æŠ€å·§">4.çŠ¶æ€å‹ç¼©æŠ€å·§</h2>
<ul>
<li>å¯¹äºçŸ­å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç”¨<strong>ä½è¿ç®—è¡¨ç¤ºçŠ¶æ€</strong>ï¼ŒåŠ é€ŸDPè¿‡ç¨‹</li>
</ul>
<h2 id="5-é€’å½’-è®°å¿†åŒ–æœç´¢">5.é€’å½’+è®°å¿†åŒ–æœç´¢</h2>
<ul>
<li>æŸäº›å­—ç¬¦ä¸²DPé—®é¢˜ç”¨è‡ªé¡¶å‘ä¸‹çš„è®°å¿†åŒ–æœç´¢æ›´ç›´è§‚</li>
<li>ç‰¹åˆ«æ˜¯çŠ¶æ€è½¬ç§»å¤æ‚æˆ–æ¡ä»¶å¤šçš„æƒ…å†µ</li>
</ul>
<h2 id="6-å›æ–‡ç±»é—®é¢˜çš„ç‰¹æ®Šå¤„ç†">6.å›æ–‡ç±»é—®é¢˜çš„ç‰¹æ®Šå¤„ç†</h2>
<ul>
<li><strong>ä¸­å¿ƒæ‰©å±•æ³•ç»“åˆ DP</strong>ï¼šå¯¹æ¯ä¸ªå­—ç¬¦ / æ¯ä¸¤ä¸ªå­—ç¬¦ä½œä¸ºä¸­å¿ƒï¼Œå‘ä¸¤è¾¹æ‰©å±•ï¼Œç»“åˆ DP è®°å½•å·²åˆ¤æ–­çš„å›æ–‡å­ä¸²ï¼ˆé¿å…é‡å¤è®¡ç®—ï¼‰ï¼›</li>
<li><strong>Manacher ç®—æ³•</strong>ï¼šçº¿æ€§æ—¶é—´æ±‚è§£æœ€é•¿å›æ–‡å­ä¸²ï¼ˆé’ˆå¯¹ DP çš„ O (nÂ²) ä¼˜åŒ–ï¼‰ï¼Œæ ¸å¿ƒæ˜¯åˆ©ç”¨å›æ–‡çš„å¯¹ç§°æ€§å‡å°‘é‡å¤åˆ¤æ–­ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>ç¼–ç¨‹é¢˜</category>
        <category>åŠ¨æ€è§„åˆ’</category>
        <category>å­—ç¬¦ä¸²</category>
      </categories>
      <tags>
        <tag>oj</tag>
        <tag>ç¬”è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>ç¬¬4ç«  è§‚æµ‹å·¥å…·</title>
    <url>/2026/01/06/%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/%E3%80%8A%E6%80%A7%E8%83%BD%E4%B9%8B%E5%B7%85%E3%80%8B/%E7%AC%AC4%E7%AB%A0-%E8%A7%82%E6%B5%8B%E5%B7%A5%E5%85%B7/</url>
    <content><![CDATA[<h1>å·¥å…·ç±»å‹</h1>
<p><strong>æ¦‚è¿°ï¼šæ€§èƒ½è§‚æµ‹å·¥å…·å¯ä»¥æŒ‰ç…§â€œç³»ç»Ÿçº§åˆ«â€å’Œâ€œè¿›ç¨‹çº§åˆ«â€æ¥åˆ†ç±»ï¼Œå¤šæ•°çš„å·¥å…·è¦ä¹ˆåŸºäºâ€œè®¡æ•°å™¨â€è¦ä¹ˆåŸºäºâ€œè·Ÿè¸ªâ€</strong><br>
<img src="/images/2026.1.6-1.png" alt="å›¾ç‰‡"></p>
<ul>
<li>æœ‰äº›å·¥å…·ä¸åªé€‚ç”¨äºä¸€ä¸ªè±¡é™ï¼Œä¾‹å¦‚ï¼Œtop(1)è¿˜æœ‰ä¸€ä¸ªç³»ç»Ÿçº§åˆ«çš„è§†å›¾ï¼ŒDTraceä¹Ÿæœ‰è¿›ç¨‹çº§åˆ«çš„èƒ½åŠ›ã€‚</li>
</ul>
<h2 id="è®¡æ•°å™¨">è®¡æ•°å™¨</h2>
<p>1.å†…æ ¸ç»´æŠ¤äº†å„ç§ç»Ÿè®¡æ•°æ®ï¼Œç§°ä¸ºâ€œè®¡æ•°å™¨â€ï¼Œç”¨äºå¯¹äº‹ä»¶è®¡æ•°ã€‚<br>
2.è®¡æ•°å™¨çš„ä½¿ç”¨å¯ä»¥è®¤ä¸ºæ˜¯â€œé›¶å¼€é”€â€çš„ï¼Œå› ä¸ºå®ƒä»¬é»˜è®¤æ˜¯å¼€å¯çš„ï¼Œè€Œä¸”å§‹ç»ˆç”±å†…æ ¸ç»´æŠ¤ã€‚<br>
<img src="/images/2026.1.6-2.png" alt="å›¾ç‰‡1"><img src="/images/2026.1.6-3.png" alt="å›¾ç‰‡2"></p>
<p><strong>ä¸€èˆ¬æ¥è¯´ï¼Œä¸Šè¿°è¿™äº›å·¥å…·æ˜¯ä»/procæ–‡ä»¶ç³»ç»Ÿé‡Œè¯»å–ç»Ÿè®¡ä¿¡æ¯çš„</strong></p>
<h2 id="è·Ÿè¸ª">è·Ÿè¸ª</h2>
<p>1.è·Ÿè¸ªæ”¶é›†æ¯ä¸€ä¸ªæ—¶é—´çš„æ•°æ®ä»¥ä¾›åˆ†æã€‚<br>
2.è·Ÿè¸ªæ¡†æ¶ä¸€èˆ¬é»˜è®¤æ˜¯ä¸å¯ç”¨çš„ï¼Œå› ä¸ºè·Ÿè¸ªæ•è·æ•°æ®ä¼šæœ‰CPUå¼€é”€ï¼Œå¦å¤–è¿˜éœ€è¦ä¸å°çš„å­˜å‚¨ç©ºé—´æ¥å­˜æ”¾æ•°æ®ã€‚<br>
3.è¿™äº›å¼€é”€ä¼šæ‹–æ…¢æ‰€è·Ÿè¸ªçš„å¯¹è±¡ï¼Œåœ¨è§£é‡Šæµ‹é‡æ—¶é—´çš„æ—¶å€™éœ€è¦åŠ ä»¥è€ƒè™‘ã€‚<br>
4.æ—¥å¿—ï¼ŒåŒ…æ‹¬ç³»ç»Ÿæ—¥å¿—ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç§é»˜è®¤å¼€å¯çš„ä½é¢‘è·Ÿè¸ªã€‚<br>
<img src="/images/2026.1.6-4.png" alt="å›¾ç‰‡"><img src="/images/2026.1.6-5.png" alt="å›¾ç‰‡"></p>
<h2 id="å‰–æ">å‰–æ</h2>
<p>1.å‰–æï¼ˆprofilingï¼‰é€šè¿‡å¯¹ç›®æ ‡æ”¶é›†é‡‡æ ·æˆ–å¿«ç…§æ¥å½’çº³ç›®æ ‡ç‰¹å¾</p>
<ul>
<li>å¦‚å¯¹äºCPUçš„ä½¿ç”¨ç‡ï¼Œå¯¹ç¨‹åºè®¡æ•°å™¨é‡‡æ ·ï¼Œæˆ–è·Ÿè¸ªæ¥æ‰¾åˆ°æ¶ˆè€—CPUå‘¨æœŸçš„ä»£ç è·¯å¾„ã€‚è¿™äº›æ ·æœ¬é‡‡é›†å¯¹äºæ‰€æœ‰çš„CPUéƒ½æ˜¯æŒ‰ç¦é¼é¢‘ç‡è¿›è¡Œçš„</li>
</ul>
<p>2.å‰–æä¹Ÿèƒ½åŸºäºéè®¡æ—¶çš„ç¡¬ä»¶æ—¶é—´</p>
<ul>
<li>å¦‚CPUç¡¬ä»¶ç¼“å­˜æœªå‘½ä¸­æˆ–è€…æ€»çº¿æ´»åŠ¨</li>
<li>å¯ä»¥æ˜¾ç¤ºå‡ºå“ªè¡Œä»£ç è·¯å¾„è´Ÿè´£ä»»ï¼Œè¿™ç±»ä¿¡æ¯å°¤å…¶å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜é’ˆå¯¹ç³»ç»Ÿèµ„æºçš„ä½¿ç”¨æ¥ä¼˜åŒ–è‡ªå·±çš„ä»£ç </li>
</ul>
<p><img src="/images/2026.1.6-6.png" alt="å›¾ç‰‡"></p>
<h2 id="ç›‘è§†ï¼ˆsarï¼‰">ç›‘è§†ï¼ˆsarï¼‰</h2>
<p>1.æœ€å¹¿æ³›ç”¨äºç›‘è§†å•ä¸€æ“ä½œç³»ç»Ÿçš„å·¥å…·æ˜¯star(1)ã€‚<br>
2.sar(1)æ˜¯åŸºäºè®¡æ•°å™¨çš„ï¼Œåœ¨é¢„å®šçš„æ—¶é—´ï¼ˆé€šè¿‡cronï¼‰æ‰§è¡Œä»¥è®°å½•ç³»ç»Ÿè®¡æ•°å™¨çš„çŠ¶æ€<br>
3.sar(1)å·¥å…·æ”¯æŒç”¨å‘½ä»¤è¡Œæ¥æŸ¥çœ‹è¿™äº›æ•°æ®<br>
<img src="/images/2026.1.6-7.png" alt="å›¾ç‰‡"></p>
<hr>
<h1>è§‚æµ‹æ¥æº</h1>
<h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>
<p>1.æœ¬èŠ‚ä»‹ç»ç»™è§‚æµ‹å·¥å…·æä¾›ç»Ÿè®¡æ•°æ®çš„å„ç§æ¥å£å’Œæ¡†æ¶<br>
2.ç³»ç»Ÿæ€§èƒ½ç»Ÿè®¡çš„ä¸»è¦æ¥æºæ˜¯ï¼š/procã€/sysã€/kstat<br>
<img src="/images/2026.1.6-8.png" alt="å›¾ç‰‡"></p>
<h2 id="proc">/proc</h2>
<h4 id="æ¦‚è¿°-2">æ¦‚è¿°</h4>
<p>1.è¿™æ˜¯ä¸€ä¸ªæä¾›å†…æ ¸ç»Ÿè®¡ä¿¡æ¯çš„æ–‡ä»¶ç³»ç»Ÿæ¥å£<br>
2.å…¶ä¸­<strong>ä»¥è¿›ç¨‹IDå‘½åçš„ç›®å½•ä»£è¡¨çš„å°±æ˜¯å“ªä¸ªè¿›ç¨‹</strong><br>
3.è¿™äº›ç›®å½•ä¸‹çš„ä¼—å¤šæ–‡ä»¶åŒ…å«äº†è¿›ç¨‹çš„ä¿¡æ¯å’Œç»Ÿè®¡æ•°æ®ï¼Œç”±å†…æ ¸ç»“æ„æ˜ å°„è€Œæ¥<br>
4./procæ˜¯å¤šæ€åˆ›å»ºçš„ï¼Œä¸éœ€è¦ä»»ä½•å­˜å‚¨è®¾å¤‡ï¼ˆåœ¨å†…å­˜ä¸­è¿è¡Œï¼‰ã€‚<br>
5.å¤šæ•°æ–‡ä»¶æ˜¯åªè¯»çš„ï¼Œä¸ºè§‚æµ‹å·¥å…·æä¾›ç»Ÿè®¡æ•°æ®ï¼›ä¸€éƒ¨åˆ†æ–‡ä»¶æ˜¯å¯å†™çš„ï¼Œç”¨äºæ§åˆ¶è¿›ç¨‹å’Œå†…æ ¸çš„è¡Œä¸º<br>
<img src="/images/2026.1.6-9.png" alt="å›¾ç‰‡"></p>
]]></content>
      <categories>
        <category>ã€Šæ€§èƒ½ä¹‹å·…ã€‹</category>
        <category>ç¬¬4ç«  è§‚æµ‹å·¥å…·</category>
      </categories>
      <tags>
        <tag>ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>1.æœ€é•¿å…¬å…±å­åºåˆ—(ä¸€)</title>
    <url>/2026/01/09/%E7%BC%96%E7%A8%8B%E9%A2%98/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/%E5%AD%97%E7%AC%A6%E4%B8%B2/1.%E6%9C%80%E9%95%BF%E5%85%AC%E5%85%B1%E5%AD%90%E5%BA%8F%E5%88%97(%E4%B8%80)/</url>
    <content><![CDATA[<h1>1.é¢˜ç›®</h1>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260109001047053.png" alt=""></p>
<h1>2.ä»£ç å®ç°</h1>
<h2 id="1-æ™®é€šç‰ˆ">1.æ™®é€šç‰ˆ</h2>
<p><strong>æ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦ï¼šO(mÃ—n)</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">LCS</span><span class="params">(string s1, string s2)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    <span class="type">int</span> m = s<span class="number">1.</span><span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> n = s<span class="number">2.</span><span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">if</span> (m == <span class="number">0</span> || n == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åªå­˜å‚¨é•¿åº¦çš„DPè¡¨</span></span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">dp</span>(m + <span class="number">1</span>, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n + <span class="number">1</span>, <span class="number">0</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¡«å……DPè¡¨</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (s1[i - <span class="number">1</span>] == s2[j - <span class="number">1</span>]) &#123;</span><br><span class="line">                dp[i][j] = dp[i - <span class="number">1</span>][j - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                dp[i][j] = <span class="built_in">max</span>(dp[i - <span class="number">1</span>][j], dp[i][j - <span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[m][n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-ç©ºé—´ä¼˜åŒ–ç‰ˆï¼ˆæ»šåŠ¨æ•°ç»„ï¼‰">2.ç©ºé—´ä¼˜åŒ–ç‰ˆï¼ˆæ»šåŠ¨æ•°ç»„ï¼‰</h2>
<p><strong>æ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦ï¼šO(mÃ—n)æ—¶é—´ å’Œ O(n)ç©ºé—´ï¼‰</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">LCS</span><span class="params">(string s1, string s2)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> m = s<span class="number">1.</span><span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> n = s<span class="number">2.</span><span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">if</span> (m == <span class="number">0</span> || n == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨ä¸€ç»´æ•°ç»„</span></span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dp</span><span class="params">(n + <span class="number">1</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">        <span class="type">int</span> prev = <span class="number">0</span>;  <span class="comment">// å­˜å‚¨ä¸Šä¸€è½®çš„dp[j-1]ï¼Œå³å·¦ä¸Šè§’å…ƒç´ </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">            <span class="type">int</span> temp = dp[j];  <span class="comment">// æš‚å­˜å½“å‰dp[j]ï¼Œä¸‹ä¸€è½®å°†æˆä¸ºæ–°çš„å·¦ä¸Šè§’å…ƒç´ </span></span><br><span class="line">            <span class="keyword">if</span> (s1[i - <span class="number">1</span>] == s2[j - <span class="number">1</span>]) &#123;</span><br><span class="line">                dp[j] = prev + <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                dp[j] = <span class="built_in">max</span>(dp[j], dp[j - <span class="number">1</span>]); <span class="comment">// dp[j]æ­¤æ—¶ä¿å­˜çš„æ˜¯dp[i-1][j]ï¼Œdp[j-1]å·²æ›´æ–°ä¸ºdp[i][j-1]</span></span><br><span class="line">            &#125;</span><br><span class="line">            prev = temp;  <span class="comment">// æ›´æ–°å·¦ä¸Šè§’å…ƒç´ </span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dp[n];</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="åŸç†è§£æï¼š">åŸç†è§£æï¼š</h3>
<h4 id="1-å…ˆçœ‹â€œæ™®é€šç‰ˆæœ¬â€">1.å…ˆçœ‹â€œæ™®é€šç‰ˆæœ¬â€</h4>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/7ded7ab8ec9bb8f8d473272ae01f5aa3.jpg" alt=""></p>
<ul>
<li>dp[i][j]æ˜¯æˆ‘ä»¬å½“å‰éœ€è¦æ±‚çš„ï¼Œç”±â€œæ™®é€šç‰ˆâ€å¯çŸ¥ï¼Œå®ƒä¸dp[i-1][j-1]ã€dp[i][j-1]ã€dp[i-1][j]æœ‰å…³</li>
<li>ç”±å›¾å¯çŸ¥ï¼šdp[i-1][j-1]ã€dp[i][j-1]ã€dp[i-1][j]åˆ†åˆ«ä½äºdp[i][j]çš„â€œå·¦ä¸Šè§’â€ã€â€œä¸Šæ–¹â€ã€â€œå·¦æ–¹â€</li>
<li>æ˜¾ç„¶ï¼šåœ¨æ±‚ç¬¬iè¡Œdp[i,j]æ—¶ï¼Œåªéœ€ç”¨åˆ°dp[i-1][j-1]ã€dp[i][j-1]ã€dp[i-1][j] â€”â€”&gt;å³â€œä¸Šä¸€è¡Œçš„å€¼â€+â€œdp[i][j-1]â€çš„å€¼ â€”â€”&gt;dpä¸ºä¸€ç»´æ•°ç»„å³å¯
<ul>
<li>ä¸ºä»€ä¹ˆä¸Šä¸€è¡Œçš„å€¼éƒ½éœ€è¦å­˜å‚¨ï¼Ÿ å› ä¸ºè¦æ±‚å–ç¬¬iè¡Œæ¯ä¸€åˆ—</li>
</ul>
</li>
</ul>
<h3 id="2-å†çœ‹â€œæ»šåŠ¨æ•°ç»„â€ç‰ˆæœ¬">2.å†çœ‹â€œæ»šåŠ¨æ•°ç»„â€ç‰ˆæœ¬</h3>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/9965aa62cf907c149bfafaf73fdf7a58.jpg" alt=""><br>
<strong>ä¸ºä¸1ä¸­dpåŒºåˆ†ï¼Œè¿™é‡Œç”¨DPä»£æ›¿dp</strong></p>
<ul>
<li>æˆ‘ä»¬å·²çŸ¥ï¼šç”¨ä¸€ç»´æ•°ç»„DP[j]å­˜å‚¨ä¸Šä¸€è¡Œçš„å€¼ï¼ˆè¿™ç§è¯´æ³•å¹¶ä¸å‡†ç¡®ï¼Œè§ä¸‹æ–‡ï¼‰</li>
<li>ç”±å›¾+ä»£ç å®ç°ï¼š prevå­˜å‚¨â€œå·¦ä¸Šè§’å…ƒç´ â€
<ul>
<li>å½“j=1æ—¶ï¼šæ²¡æœ‰â€œå·¦ä¸Šè§’å…ƒç´ â€ï¼Œè®¾ç½®ä¸º0å³å¯ï¼ˆæˆ–è€…è¯´æœ‰(i,0),è¡¨ç¤ºç©ºä¸²,DP[0]=0ï¼‰</li>
<li>å½“j!=1æ—¶ï¼šæ˜¾ç„¶æˆ‘ä»¬å·²ç»å¯è·å–dp[i-1][j-1]ï¼ˆpreå­˜å‚¨ï¼‰ã€dp[i][j-1]ï¼ˆDP[j]å­˜å‚¨ï¼‰,é‚£dp[i-1][j]å‘¢ï¼Ÿ</li>
</ul>
</li>
<li>å½“æˆ‘ä»¬åœ¨æ±‚dp[i][j]æ—¶ï¼Œæ˜¾ç„¶dp[i][j-1]æˆ‘ä»¬å·²ç»æ±‚å–äº†ï¼Œæˆ‘ä»¬ä¼šå°†DP[j-1]æ›´æ–°ä¸ºdp[i][j-1]ï¼ˆè§ä»£ç ï¼‰â€”â€”&gt;æ•…æ­¤æ—¶DP[j-1]=dp[i-1][j] ï¼ˆå‡†ç¡®è¯´DP[j-k]éƒ½æ›´æ–°äº†ï¼ï¼‰â€”â€”&gt;æˆ‘æƒ³è¿™ä¹Ÿæ˜¯<strong>æ»šåŠ¨æ•°ç»„</strong>çš„ç”±æ¥
<ul>
<li>è¿™é‡Œä¹Ÿè§£é‡Šäº†DP[j]å­˜å‚¨ä¸Šä¸€è¡Œçš„å€¼â€œå¹¶ä¸å‡†ç¡®â€ï¼šåº”è¯¥è¯´DPåœ¨æ¯ä¸€è½®å¼€å§‹æ—¶ï¼Œå­˜å‚¨äº†ä¸Šä¸€è¡Œçš„å€¼</li>
</ul>
</li>
<li>å› æ­¤åœ¨æ±‚å–dp[i][j]åï¼ŒDP[j]ä¼šè¢«æ›´æ–°ä¸ºdp[i][j],æ‰€ä»¥éœ€è¦ç”¨ä¸€ä¸ªtempå­˜å‚¨ï¼Œä¹Ÿå°†ä½œä¸ºä¸‹ä¸€è½®çš„â€œå·¦ä¸Šè§’å…ƒç´ â€ï¼Œèµ‹äºˆåˆ°prevä¸­</li>
<li>è‡³æ­¤ï¼Œç»“åˆâ€œä»£ç å®ç°â€+â€œå›¾â€åº”è¯¥èƒ½å¤Ÿç†è§£æ•´ä¸ªè¿‡ç¨‹</li>
</ul>
]]></content>
      <categories>
        <category>ç¼–ç¨‹é¢˜</category>
        <category>åŠ¨æ€è§„åˆ’</category>
        <category>å­—ç¬¦ä¸²</category>
      </categories>
      <tags>
        <tag>oj</tag>
        <tag>ç¬”è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>2.æœ€é•¿å…¬å…±å­åºåˆ—(äºŒ)</title>
    <url>/2026/01/08/%E7%BC%96%E7%A8%8B%E9%A2%98/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/%E5%AD%97%E7%AC%A6%E4%B8%B2/2.%E6%9C%80%E9%95%BF%E5%85%AC%E5%85%B1%E5%AD%90%E5%BA%8F%E5%88%97(%E4%BA%8C)/</url>
    <content><![CDATA[<h1>1.é¢˜ç›®</h1>
<p><img src="https://cdn.jsdelivr.net/gh/xianyubuxian-TXY/hexo-images/images/20260108234255173.png" alt=""></p>
<h1>2.ä»£ç å®ç°</h1>
<p><strong>æ¶‰åŠæŠ€å·§ï¼šå›æº¯æ„å»ºç»“æœ</strong></p>
<h2 id="1-äºŒç»´æ•°ç»„dpå®ç°">1.äºŒç»´æ•°ç»„dpå®ç°</h2>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">string <span class="title">LCS</span><span class="params">(string s1, string s2)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    <span class="type">int</span> m = s<span class="number">1.</span><span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> n = s<span class="number">2.</span><span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">if</span> (m == <span class="number">0</span> || n == <span class="number">0</span>) <span class="keyword">return</span> <span class="string">&quot;-1&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åªå­˜å‚¨é•¿åº¦çš„DPè¡¨</span></span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">dp</span>(m + <span class="number">1</span>, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n + <span class="number">1</span>, <span class="number">0</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¡«å……DPè¡¨</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (s1[i - <span class="number">1</span>] == s2[j - <span class="number">1</span>]) &#123;</span><br><span class="line">                dp[i][j] = dp[i - <span class="number">1</span>][j - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                dp[i][j] = <span class="built_in">max</span>(dp[i - <span class="number">1</span>][j], dp[i][j - <span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ£€æŸ¥æ˜¯å¦å­˜åœ¨å…¬å…±å­åºåˆ—</span></span><br><span class="line">    <span class="keyword">if</span> (dp[m][n] == <span class="number">0</span>) <span class="keyword">return</span> <span class="string">&quot;-1&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å›æº¯æ„å»ºç»“æœ</span></span><br><span class="line">    string result;</span><br><span class="line">    <span class="type">int</span> i = m, j = n;</span><br><span class="line">    <span class="keyword">while</span> (i &gt; <span class="number">0</span> &amp;&amp; j &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (s1[i - <span class="number">1</span>] == s2[j - <span class="number">1</span>]) &#123;</span><br><span class="line">            result.<span class="built_in">push_back</span>(s1[i - <span class="number">1</span>]);</span><br><span class="line">            i--; j--;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (dp[i - <span class="number">1</span>][j] &gt; dp[i][j - <span class="number">1</span>]) &#123;</span><br><span class="line">            i--;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            j--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">reverse</span>(result.<span class="built_in">begin</span>(), result.<span class="built_in">end</span>());</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>ç¼–ç¨‹é¢˜</category>
        <category>åŠ¨æ€è§„åˆ’ - å­—ç¬¦ä¸²</category>
      </categories>
      <tags>
        <tag>oj</tag>
        <tag>ç¬”è¯•</tag>
      </tags>
  </entry>
</search>
